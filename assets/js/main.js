/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/@emotion/hash/dist/hash.browser.cjs.js":
/*!*************************************************************!*\
  !*** ./node_modules/@emotion/hash/dist/hash.browser.cjs.js ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports) => {

"use strict";


Object.defineProperty(exports, "__esModule", ({ value: true }));

/* eslint-disable */
// murmurhash2 via https://github.com/garycourt/murmurhash-js/blob/master/murmurhash2_gc.js
function murmurhash2_32_gc(str) {
  var l = str.length,
      h = l ^ l,
      i = 0,
      k;

  while (l >= 4) {
    k = str.charCodeAt(i) & 0xff | (str.charCodeAt(++i) & 0xff) << 8 | (str.charCodeAt(++i) & 0xff) << 16 | (str.charCodeAt(++i) & 0xff) << 24;
    k = (k & 0xffff) * 0x5bd1e995 + (((k >>> 16) * 0x5bd1e995 & 0xffff) << 16);
    k ^= k >>> 24;
    k = (k & 0xffff) * 0x5bd1e995 + (((k >>> 16) * 0x5bd1e995 & 0xffff) << 16);
    h = (h & 0xffff) * 0x5bd1e995 + (((h >>> 16) * 0x5bd1e995 & 0xffff) << 16) ^ k;
    l -= 4;
    ++i;
  }

  switch (l) {
    case 3:
      h ^= (str.charCodeAt(i + 2) & 0xff) << 16;

    case 2:
      h ^= (str.charCodeAt(i + 1) & 0xff) << 8;

    case 1:
      h ^= str.charCodeAt(i) & 0xff;
      h = (h & 0xffff) * 0x5bd1e995 + (((h >>> 16) * 0x5bd1e995 & 0xffff) << 16);
  }

  h ^= h >>> 13;
  h = (h & 0xffff) * 0x5bd1e995 + (((h >>> 16) * 0x5bd1e995 & 0xffff) << 16);
  h ^= h >>> 15;
  return (h >>> 0).toString(36);
}

exports["default"] = murmurhash2_32_gc;


/***/ }),

/***/ "./node_modules/array-unique/index.js":
/*!********************************************!*\
  !*** ./node_modules/array-unique/index.js ***!
  \********************************************/
/***/ ((module) => {

"use strict";
/*!
 * array-unique <https://github.com/jonschlinkert/array-unique>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */



module.exports = function unique(arr) {
  if (!Array.isArray(arr)) {
    throw new TypeError('array-unique expects an array.');
  }

  var len = arr.length;
  var i = -1;

  while (i++ < len) {
    var j = i + 1;

    for (; j < arr.length; ++j) {
      if (arr[i] === arr[j]) {
        arr.splice(j--, 1);
      }
    }
  }
  return arr;
};

module.exports.immutable = function uniqueImmutable(arr) {
  if (!Array.isArray(arr)) {
    throw new TypeError('array-unique expects an array.');
  }

  var arrLen = arr.length;
  var newArr = new Array(arrLen);

  for (var i = 0; i < arrLen; i++) {
    newArr[i] = arr[i];
  }

  return module.exports(newArr);
};


/***/ }),

/***/ "./node_modules/chunk/src/chunk.js":
/*!*****************************************!*\
  !*** ./node_modules/chunk/src/chunk.js ***!
  \*****************************************/
/***/ (function(module, exports) {

"use strict";


(function () {

    function chunk (collection, size) {
    
        var result = [];
        
        // default size to two item
        size = parseInt(size) || 2;
        
        // add each chunk to the result
        for (var x = 0; x < Math.ceil(collection.length / size); x++) {
            
            var start = x * size;
            var end = start + size;
            
            result.push(collection.slice(start, end));
            
        }
        
        return result;
        
    };

    // export in node or browser
    if (true) {
        if ( true && module.exports) {
            exports = module.exports = chunk;
        }
        exports.chunk = chunk;
    } else // removed by dead control flow
{}

}.call(this));


/***/ }),

/***/ "./node_modules/cross-fetch/dist/browser-ponyfill.js":
/*!***********************************************************!*\
  !*** ./node_modules/cross-fetch/dist/browser-ponyfill.js ***!
  \***********************************************************/
/***/ ((module, exports, __webpack_require__) => {

// Save global object in a variable
var __global__ =
(typeof globalThis !== 'undefined' && globalThis) ||
(typeof self !== 'undefined' && self) ||
(typeof __webpack_require__.g !== 'undefined' && __webpack_require__.g);
// Create an object that extends from __global__ without the fetch function
var __globalThis__ = (function () {
function F() {
this.fetch = false;
this.DOMException = __global__.DOMException
}
F.prototype = __global__; // Needed for feature detection on whatwg-fetch's code
return new F();
})();
// Wraps whatwg-fetch with a function scope to hijack the global object
// "globalThis" that's going to be patched
(function(globalThis) {

var irrelevant = (function (exports) {

  /* eslint-disable no-prototype-builtins */
  var g =
    (typeof globalThis !== 'undefined' && globalThis) ||
    (typeof self !== 'undefined' && self) ||
    // eslint-disable-next-line no-undef
    (typeof __webpack_require__.g !== 'undefined' && __webpack_require__.g) ||
    {};

  var support = {
    searchParams: 'URLSearchParams' in g,
    iterable: 'Symbol' in g && 'iterator' in Symbol,
    blob:
      'FileReader' in g &&
      'Blob' in g &&
      (function() {
        try {
          new Blob();
          return true
        } catch (e) {
          return false
        }
      })(),
    formData: 'FormData' in g,
    arrayBuffer: 'ArrayBuffer' in g
  };

  function isDataView(obj) {
    return obj && DataView.prototype.isPrototypeOf(obj)
  }

  if (support.arrayBuffer) {
    var viewClasses = [
      '[object Int8Array]',
      '[object Uint8Array]',
      '[object Uint8ClampedArray]',
      '[object Int16Array]',
      '[object Uint16Array]',
      '[object Int32Array]',
      '[object Uint32Array]',
      '[object Float32Array]',
      '[object Float64Array]'
    ];

    var isArrayBufferView =
      ArrayBuffer.isView ||
      function(obj) {
        return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1
      };
  }

  function normalizeName(name) {
    if (typeof name !== 'string') {
      name = String(name);
    }
    if (/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(name) || name === '') {
      throw new TypeError('Invalid character in header field name: "' + name + '"')
    }
    return name.toLowerCase()
  }

  function normalizeValue(value) {
    if (typeof value !== 'string') {
      value = String(value);
    }
    return value
  }

  // Build a destructive iterator for the value list
  function iteratorFor(items) {
    var iterator = {
      next: function() {
        var value = items.shift();
        return {done: value === undefined, value: value}
      }
    };

    if (support.iterable) {
      iterator[Symbol.iterator] = function() {
        return iterator
      };
    }

    return iterator
  }

  function Headers(headers) {
    this.map = {};

    if (headers instanceof Headers) {
      headers.forEach(function(value, name) {
        this.append(name, value);
      }, this);
    } else if (Array.isArray(headers)) {
      headers.forEach(function(header) {
        if (header.length != 2) {
          throw new TypeError('Headers constructor: expected name/value pair to be length 2, found' + header.length)
        }
        this.append(header[0], header[1]);
      }, this);
    } else if (headers) {
      Object.getOwnPropertyNames(headers).forEach(function(name) {
        this.append(name, headers[name]);
      }, this);
    }
  }

  Headers.prototype.append = function(name, value) {
    name = normalizeName(name);
    value = normalizeValue(value);
    var oldValue = this.map[name];
    this.map[name] = oldValue ? oldValue + ', ' + value : value;
  };

  Headers.prototype['delete'] = function(name) {
    delete this.map[normalizeName(name)];
  };

  Headers.prototype.get = function(name) {
    name = normalizeName(name);
    return this.has(name) ? this.map[name] : null
  };

  Headers.prototype.has = function(name) {
    return this.map.hasOwnProperty(normalizeName(name))
  };

  Headers.prototype.set = function(name, value) {
    this.map[normalizeName(name)] = normalizeValue(value);
  };

  Headers.prototype.forEach = function(callback, thisArg) {
    for (var name in this.map) {
      if (this.map.hasOwnProperty(name)) {
        callback.call(thisArg, this.map[name], name, this);
      }
    }
  };

  Headers.prototype.keys = function() {
    var items = [];
    this.forEach(function(value, name) {
      items.push(name);
    });
    return iteratorFor(items)
  };

  Headers.prototype.values = function() {
    var items = [];
    this.forEach(function(value) {
      items.push(value);
    });
    return iteratorFor(items)
  };

  Headers.prototype.entries = function() {
    var items = [];
    this.forEach(function(value, name) {
      items.push([name, value]);
    });
    return iteratorFor(items)
  };

  if (support.iterable) {
    Headers.prototype[Symbol.iterator] = Headers.prototype.entries;
  }

  function consumed(body) {
    if (body._noBody) return
    if (body.bodyUsed) {
      return Promise.reject(new TypeError('Already read'))
    }
    body.bodyUsed = true;
  }

  function fileReaderReady(reader) {
    return new Promise(function(resolve, reject) {
      reader.onload = function() {
        resolve(reader.result);
      };
      reader.onerror = function() {
        reject(reader.error);
      };
    })
  }

  function readBlobAsArrayBuffer(blob) {
    var reader = new FileReader();
    var promise = fileReaderReady(reader);
    reader.readAsArrayBuffer(blob);
    return promise
  }

  function readBlobAsText(blob) {
    var reader = new FileReader();
    var promise = fileReaderReady(reader);
    var match = /charset=([A-Za-z0-9_-]+)/.exec(blob.type);
    var encoding = match ? match[1] : 'utf-8';
    reader.readAsText(blob, encoding);
    return promise
  }

  function readArrayBufferAsText(buf) {
    var view = new Uint8Array(buf);
    var chars = new Array(view.length);

    for (var i = 0; i < view.length; i++) {
      chars[i] = String.fromCharCode(view[i]);
    }
    return chars.join('')
  }

  function bufferClone(buf) {
    if (buf.slice) {
      return buf.slice(0)
    } else {
      var view = new Uint8Array(buf.byteLength);
      view.set(new Uint8Array(buf));
      return view.buffer
    }
  }

  function Body() {
    this.bodyUsed = false;

    this._initBody = function(body) {
      /*
        fetch-mock wraps the Response object in an ES6 Proxy to
        provide useful test harness features such as flush. However, on
        ES5 browsers without fetch or Proxy support pollyfills must be used;
        the proxy-pollyfill is unable to proxy an attribute unless it exists
        on the object before the Proxy is created. This change ensures
        Response.bodyUsed exists on the instance, while maintaining the
        semantic of setting Request.bodyUsed in the constructor before
        _initBody is called.
      */
      // eslint-disable-next-line no-self-assign
      this.bodyUsed = this.bodyUsed;
      this._bodyInit = body;
      if (!body) {
        this._noBody = true;
        this._bodyText = '';
      } else if (typeof body === 'string') {
        this._bodyText = body;
      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {
        this._bodyBlob = body;
      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {
        this._bodyFormData = body;
      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {
        this._bodyText = body.toString();
      } else if (support.arrayBuffer && support.blob && isDataView(body)) {
        this._bodyArrayBuffer = bufferClone(body.buffer);
        // IE 10-11 can't handle a DataView body.
        this._bodyInit = new Blob([this._bodyArrayBuffer]);
      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {
        this._bodyArrayBuffer = bufferClone(body);
      } else {
        this._bodyText = body = Object.prototype.toString.call(body);
      }

      if (!this.headers.get('content-type')) {
        if (typeof body === 'string') {
          this.headers.set('content-type', 'text/plain;charset=UTF-8');
        } else if (this._bodyBlob && this._bodyBlob.type) {
          this.headers.set('content-type', this._bodyBlob.type);
        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {
          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
        }
      }
    };

    if (support.blob) {
      this.blob = function() {
        var rejected = consumed(this);
        if (rejected) {
          return rejected
        }

        if (this._bodyBlob) {
          return Promise.resolve(this._bodyBlob)
        } else if (this._bodyArrayBuffer) {
          return Promise.resolve(new Blob([this._bodyArrayBuffer]))
        } else if (this._bodyFormData) {
          throw new Error('could not read FormData body as blob')
        } else {
          return Promise.resolve(new Blob([this._bodyText]))
        }
      };
    }

    this.arrayBuffer = function() {
      if (this._bodyArrayBuffer) {
        var isConsumed = consumed(this);
        if (isConsumed) {
          return isConsumed
        } else if (ArrayBuffer.isView(this._bodyArrayBuffer)) {
          return Promise.resolve(
            this._bodyArrayBuffer.buffer.slice(
              this._bodyArrayBuffer.byteOffset,
              this._bodyArrayBuffer.byteOffset + this._bodyArrayBuffer.byteLength
            )
          )
        } else {
          return Promise.resolve(this._bodyArrayBuffer)
        }
      } else if (support.blob) {
        return this.blob().then(readBlobAsArrayBuffer)
      } else {
        throw new Error('could not read as ArrayBuffer')
      }
    };

    this.text = function() {
      var rejected = consumed(this);
      if (rejected) {
        return rejected
      }

      if (this._bodyBlob) {
        return readBlobAsText(this._bodyBlob)
      } else if (this._bodyArrayBuffer) {
        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))
      } else if (this._bodyFormData) {
        throw new Error('could not read FormData body as text')
      } else {
        return Promise.resolve(this._bodyText)
      }
    };

    if (support.formData) {
      this.formData = function() {
        return this.text().then(decode)
      };
    }

    this.json = function() {
      return this.text().then(JSON.parse)
    };

    return this
  }

  // HTTP methods whose capitalization should be normalized
  var methods = ['CONNECT', 'DELETE', 'GET', 'HEAD', 'OPTIONS', 'PATCH', 'POST', 'PUT', 'TRACE'];

  function normalizeMethod(method) {
    var upcased = method.toUpperCase();
    return methods.indexOf(upcased) > -1 ? upcased : method
  }

  function Request(input, options) {
    if (!(this instanceof Request)) {
      throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.')
    }

    options = options || {};
    var body = options.body;

    if (input instanceof Request) {
      if (input.bodyUsed) {
        throw new TypeError('Already read')
      }
      this.url = input.url;
      this.credentials = input.credentials;
      if (!options.headers) {
        this.headers = new Headers(input.headers);
      }
      this.method = input.method;
      this.mode = input.mode;
      this.signal = input.signal;
      if (!body && input._bodyInit != null) {
        body = input._bodyInit;
        input.bodyUsed = true;
      }
    } else {
      this.url = String(input);
    }

    this.credentials = options.credentials || this.credentials || 'same-origin';
    if (options.headers || !this.headers) {
      this.headers = new Headers(options.headers);
    }
    this.method = normalizeMethod(options.method || this.method || 'GET');
    this.mode = options.mode || this.mode || null;
    this.signal = options.signal || this.signal || (function () {
      if ('AbortController' in g) {
        var ctrl = new AbortController();
        return ctrl.signal;
      }
    }());
    this.referrer = null;

    if ((this.method === 'GET' || this.method === 'HEAD') && body) {
      throw new TypeError('Body not allowed for GET or HEAD requests')
    }
    this._initBody(body);

    if (this.method === 'GET' || this.method === 'HEAD') {
      if (options.cache === 'no-store' || options.cache === 'no-cache') {
        // Search for a '_' parameter in the query string
        var reParamSearch = /([?&])_=[^&]*/;
        if (reParamSearch.test(this.url)) {
          // If it already exists then set the value with the current time
          this.url = this.url.replace(reParamSearch, '$1_=' + new Date().getTime());
        } else {
          // Otherwise add a new '_' parameter to the end with the current time
          var reQueryString = /\?/;
          this.url += (reQueryString.test(this.url) ? '&' : '?') + '_=' + new Date().getTime();
        }
      }
    }
  }

  Request.prototype.clone = function() {
    return new Request(this, {body: this._bodyInit})
  };

  function decode(body) {
    var form = new FormData();
    body
      .trim()
      .split('&')
      .forEach(function(bytes) {
        if (bytes) {
          var split = bytes.split('=');
          var name = split.shift().replace(/\+/g, ' ');
          var value = split.join('=').replace(/\+/g, ' ');
          form.append(decodeURIComponent(name), decodeURIComponent(value));
        }
      });
    return form
  }

  function parseHeaders(rawHeaders) {
    var headers = new Headers();
    // Replace instances of \r\n and \n followed by at least one space or horizontal tab with a space
    // https://tools.ietf.org/html/rfc7230#section-3.2
    var preProcessedHeaders = rawHeaders.replace(/\r?\n[\t ]+/g, ' ');
    // Avoiding split via regex to work around a common IE11 bug with the core-js 3.6.0 regex polyfill
    // https://github.com/github/fetch/issues/748
    // https://github.com/zloirock/core-js/issues/751
    preProcessedHeaders
      .split('\r')
      .map(function(header) {
        return header.indexOf('\n') === 0 ? header.substr(1, header.length) : header
      })
      .forEach(function(line) {
        var parts = line.split(':');
        var key = parts.shift().trim();
        if (key) {
          var value = parts.join(':').trim();
          try {
            headers.append(key, value);
          } catch (error) {
            console.warn('Response ' + error.message);
          }
        }
      });
    return headers
  }

  Body.call(Request.prototype);

  function Response(bodyInit, options) {
    if (!(this instanceof Response)) {
      throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.')
    }
    if (!options) {
      options = {};
    }

    this.type = 'default';
    this.status = options.status === undefined ? 200 : options.status;
    if (this.status < 200 || this.status > 599) {
      throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].")
    }
    this.ok = this.status >= 200 && this.status < 300;
    this.statusText = options.statusText === undefined ? '' : '' + options.statusText;
    this.headers = new Headers(options.headers);
    this.url = options.url || '';
    this._initBody(bodyInit);
  }

  Body.call(Response.prototype);

  Response.prototype.clone = function() {
    return new Response(this._bodyInit, {
      status: this.status,
      statusText: this.statusText,
      headers: new Headers(this.headers),
      url: this.url
    })
  };

  Response.error = function() {
    var response = new Response(null, {status: 200, statusText: ''});
    response.ok = false;
    response.status = 0;
    response.type = 'error';
    return response
  };

  var redirectStatuses = [301, 302, 303, 307, 308];

  Response.redirect = function(url, status) {
    if (redirectStatuses.indexOf(status) === -1) {
      throw new RangeError('Invalid status code')
    }

    return new Response(null, {status: status, headers: {location: url}})
  };

  exports.DOMException = g.DOMException;
  try {
    new exports.DOMException();
  } catch (err) {
    exports.DOMException = function(message, name) {
      this.message = message;
      this.name = name;
      var error = Error(message);
      this.stack = error.stack;
    };
    exports.DOMException.prototype = Object.create(Error.prototype);
    exports.DOMException.prototype.constructor = exports.DOMException;
  }

  function fetch(input, init) {
    return new Promise(function(resolve, reject) {
      var request = new Request(input, init);

      if (request.signal && request.signal.aborted) {
        return reject(new exports.DOMException('Aborted', 'AbortError'))
      }

      var xhr = new XMLHttpRequest();

      function abortXhr() {
        xhr.abort();
      }

      xhr.onload = function() {
        var options = {
          statusText: xhr.statusText,
          headers: parseHeaders(xhr.getAllResponseHeaders() || '')
        };
        // This check if specifically for when a user fetches a file locally from the file system
        // Only if the status is out of a normal range
        if (request.url.indexOf('file://') === 0 && (xhr.status < 200 || xhr.status > 599)) {
          options.status = 200;
        } else {
          options.status = xhr.status;
        }
        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL');
        var body = 'response' in xhr ? xhr.response : xhr.responseText;
        setTimeout(function() {
          resolve(new Response(body, options));
        }, 0);
      };

      xhr.onerror = function() {
        setTimeout(function() {
          reject(new TypeError('Network request failed'));
        }, 0);
      };

      xhr.ontimeout = function() {
        setTimeout(function() {
          reject(new TypeError('Network request timed out'));
        }, 0);
      };

      xhr.onabort = function() {
        setTimeout(function() {
          reject(new exports.DOMException('Aborted', 'AbortError'));
        }, 0);
      };

      function fixUrl(url) {
        try {
          return url === '' && g.location.href ? g.location.href : url
        } catch (e) {
          return url
        }
      }

      xhr.open(request.method, fixUrl(request.url), true);

      if (request.credentials === 'include') {
        xhr.withCredentials = true;
      } else if (request.credentials === 'omit') {
        xhr.withCredentials = false;
      }

      if ('responseType' in xhr) {
        if (support.blob) {
          xhr.responseType = 'blob';
        } else if (
          support.arrayBuffer
        ) {
          xhr.responseType = 'arraybuffer';
        }
      }

      if (init && typeof init.headers === 'object' && !(init.headers instanceof Headers || (g.Headers && init.headers instanceof g.Headers))) {
        var names = [];
        Object.getOwnPropertyNames(init.headers).forEach(function(name) {
          names.push(normalizeName(name));
          xhr.setRequestHeader(name, normalizeValue(init.headers[name]));
        });
        request.headers.forEach(function(value, name) {
          if (names.indexOf(name) === -1) {
            xhr.setRequestHeader(name, value);
          }
        });
      } else {
        request.headers.forEach(function(value, name) {
          xhr.setRequestHeader(name, value);
        });
      }

      if (request.signal) {
        request.signal.addEventListener('abort', abortXhr);

        xhr.onreadystatechange = function() {
          // DONE (success or failure)
          if (xhr.readyState === 4) {
            request.signal.removeEventListener('abort', abortXhr);
          }
        };
      }

      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit);
    })
  }

  fetch.polyfill = true;

  if (!g.fetch) {
    g.fetch = fetch;
    g.Headers = Headers;
    g.Request = Request;
    g.Response = Response;
  }

  exports.Headers = Headers;
  exports.Request = Request;
  exports.Response = Response;
  exports.fetch = fetch;

  Object.defineProperty(exports, '__esModule', { value: true });

  return exports;

})({});
})(__globalThis__);
// This is a ponyfill, so...
__globalThis__.fetch.ponyfill = true;
delete __globalThis__.fetch.polyfill;
// Choose between native implementation (__global__) or custom implementation (__globalThis__)
var ctx = __global__.fetch ? __global__ : __globalThis__;
exports = ctx.fetch // To enable: import fetch from 'cross-fetch'
exports["default"] = ctx.fetch // For TypeScript consumers without esModuleInterop.
exports.fetch = ctx.fetch // To enable: import {fetch} from 'cross-fetch'
exports.Headers = ctx.Headers
exports.Request = ctx.Request
exports.Response = ctx.Response
module.exports = exports


/***/ }),

/***/ "./node_modules/debounce/index.js":
/*!****************************************!*\
  !*** ./node_modules/debounce/index.js ***!
  \****************************************/
/***/ ((module) => {

/**
 * Returns a function, that, as long as it continues to be invoked, will not
 * be triggered. The function will be called after it stops being called for
 * N milliseconds. If `immediate` is passed, trigger the function on the
 * leading edge, instead of the trailing. The function also has a property 'clear' 
 * that is a function which will clear the timer to prevent previously scheduled executions. 
 *
 * @source underscore.js
 * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/
 * @param {Function} function to wrap
 * @param {Number} timeout in ms (`100`)
 * @param {Boolean} whether to execute at the beginning (`false`)
 * @api public
 */
function debounce(func, wait, immediate){
  var timeout, args, context, timestamp, result;
  if (null == wait) wait = 100;

  function later() {
    var last = Date.now() - timestamp;

    if (last < wait && last >= 0) {
      timeout = setTimeout(later, wait - last);
    } else {
      timeout = null;
      if (!immediate) {
        result = func.apply(context, args);
        context = args = null;
      }
    }
  };

  var debounced = function(){
    context = this;
    args = arguments;
    timestamp = Date.now();
    var callNow = immediate && !timeout;
    if (!timeout) timeout = setTimeout(later, wait);
    if (callNow) {
      result = func.apply(context, args);
      context = args = null;
    }

    return result;
  };

  debounced.clear = function() {
    if (timeout) {
      clearTimeout(timeout);
      timeout = null;
    }
  };
  
  debounced.flush = function() {
    if (timeout) {
      result = func.apply(context, args);
      context = args = null;
      
      clearTimeout(timeout);
      timeout = null;
    }
  };

  return debounced;
};

// Adds compatibility for ES modules
debounce.debounce = debounce;

module.exports = debounce;


/***/ }),

/***/ "./node_modules/fast-get/src/index.js":
/*!********************************************!*\
  !*** ./node_modules/fast-get/src/index.js ***!
  \********************************************/
/***/ ((module) => {

const regexCloseSquareBracket = /]|^\[/g
const regexOpenSquareBracket = /\.?\[/g

module.exports = function (object, path, defaultValue) {
  // Handle the case that the object is undefined or not an object
  if (!object || Object(object) !== object) {
    return defaultValue
  }

  // A) If the path is an array, we can just use that
  // B) If the path is a string, convert it into an array by migrating
  //    array-style `[foo]` accessors into object-style `.foo` accessors
  const cleanPath = Array.isArray(path)
    ? path
    : path.replace(regexCloseSquareBracket, '').replace(regexOpenSquareBracket, '.').split('.')

  return get(object, cleanPath, defaultValue)
}

function get (object, path, defaultValue) {
  let current = object

  for (const segment of path) {
    current = current[segment]

    if (current == null) {
      return defaultValue
    }
  }

  return current
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/cache/browser.js":
/*!*********************************************************!*\
  !*** ./node_modules/gw2api-client/src/cache/browser.js ***!
  \*********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const debounce = __webpack_require__(/*! debounce */ "./node_modules/debounce/index.js")
const idbKeyval = __webpack_require__(/*! idb-keyval */ "./node_modules/idb-keyval/dist/idb-keyval.mjs")

module.exports = function (configuration) {
  configuration = Object.assign({
    storageKey: 'gw2api-cache',
    gcTick: 5 * 60 * 1000,
    persistDebounce: 3 * 1000,
    storageEngine: idbKeyval
  }, configuration)

  let _storage = {}
  const storageEngine = configuration.storageEngine
  const storageKey = configuration.storageKey
  const persist = debounce(_persist, configuration.persistDebounce)

  function get (key) {
    return Promise.resolve(_get(key))
  }

  function set (key, value, expiry) {
    _set(key, value, expiry)
    return Promise.resolve(true)
  }

  function mget (keys) {
    let values = keys.map(key => _get(key))
    return Promise.resolve(values)
  }

  function mset (values) {
    values.map(value => {
      _set(value[0], value[1], value[2])
    })

    return Promise.resolve(true)
  }

  function _get (key) {
    let value = _storage[key]
    let now = (new Date()).getTime()
    return value && value.expiry > now ? value.value : null
  }

  function _set (key, value, expiry) {
    _storage[key] = { value, expiry: (new Date()).getTime() + expiry * 1000 }
    persist()
  }

  function _persist () {
    storageEngine.set(storageKey, _storage)
      .catch(/* istanbul ignore next */ err => {
        console.warn('Failed persisting cache', err)
      })
  }

  function hydrate () {
    storageEngine.get(storageKey)
      .then(value => {
        if (value) {
          _storage = value
        }
      })
  }

  function flush () {
    _storage = {}
    storageEngine.delete(storageKey)
    return Promise.resolve(true)
  }

  function _getStorage () {
    return _storage
  }

  function garbageCollection () {
    const now = (new Date()).getTime()
    const keys = Object.keys(_storage)

    for (let i = 0; i !== keys.length; i++) {
      if (_storage[keys[i]].expiry < now) {
        delete _storage[keys[i]]
      }
    }

    persist()
  }

  setInterval(garbageCollection, configuration.gcTick)
  hydrate()
  garbageCollection()

  return { get, set, mget, mset, flush, _getStorage }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/cache/memory.js":
/*!********************************************************!*\
  !*** ./node_modules/gw2api-client/src/cache/memory.js ***!
  \********************************************************/
/***/ ((module) => {

module.exports = function (configuration) {
  configuration = Object.assign({
    gcTick: 5 * 60 * 1000
  }, configuration)

  // Scope the storage to the function, so multiple instances don't interfere
  let _storage = {}

  function get (key) {
    return Promise.resolve(_get(key))
  }

  function _get (key) {
    let value = _storage[key]
    let now = (new Date()).getTime()
    return value && value.expiry > now ? value.value : null
  }

  function set (key, value, expiry) {
    _set(key, value, expiry)
    return Promise.resolve(true)
  }

  function _set (key, value, expiry) {
    _storage[key] = { value, expiry: (new Date()).getTime() + expiry * 1000 }
  }

  function mget (keys) {
    let values = keys.map(key => _get(key))
    return Promise.resolve(values)
  }

  function mset (values) {
    values.map(value => {
      _set(value[0], value[1], value[2])
    })

    return Promise.resolve(true)
  }

  function flush () {
    _storage = {}
    return Promise.resolve(true)
  }

  function _getStorage () {
    return _storage
  }

  function garbageCollection () {
    const now = (new Date()).getTime()
    const keys = Object.keys(_storage)

    for (let i = 0; i !== keys.length; i++) {
      if (_storage[keys[i]].expiry < now) {
        delete _storage[keys[i]]
      }
    }
  }

  setInterval(garbageCollection, configuration.gcTick)
  garbageCollection()

  return { get, set, mget, mset, flush, _getStorage }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/cache/null.js":
/*!******************************************************!*\
  !*** ./node_modules/gw2api-client/src/cache/null.js ***!
  \******************************************************/
/***/ ((module) => {

module.exports = function () {
  return { get, set, mget, mset, flush }
}

function get () {
  return Promise.resolve(null)
}

function set () {
  return Promise.resolve(true)
}

function mget (keys) {
  const values = keys.map(x => null)
  return Promise.resolve(values)
}

function mset () {
  return Promise.resolve(true)
}

function flush () {
  return Promise.resolve(true)
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/client.js":
/*!**************************************************!*\
  !*** ./node_modules/gw2api-client/src/client.js ***!
  \**************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const fetch = __webpack_require__(/*! lets-fetch */ "./node_modules/lets-fetch/src/index.js")
const nullCache = __webpack_require__(/*! ./cache/null */ "./node_modules/gw2api-client/src/cache/null.js")
const endpoints = __webpack_require__(/*! ./endpoints */ "./node_modules/gw2api-client/src/endpoints/index.js")
const flow = __webpack_require__(/*! ./flow */ "./node_modules/gw2api-client/src/flow.js")

module.exports = class Client {
  constructor () {
    this.schemaVersion = '2019-03-20T00:00:00.000Z'
    this.lang = 'en'
    this.apiKey = false
    this.fetch = fetch
    this.caches = [nullCache()]
    this.debug = false
    this.client = this
  }

  // Set the schema version
  schema (schema) {
    this.schemaVersion = schema
    this.debugMessage(`set the schema to ${schema}`)
    return this
  }

  // Set the language for locale-aware endpoints
  language (lang) {
    this.lang = lang
    this.debugMessage(`set the language to ${lang}`)
    return this
  }

  // Set the api key for authenticated endpoints
  authenticate (apiKey) {
    this.apiKey = apiKey
    this.debugMessage(`set the api key to ${apiKey}`)
    return this
  }

  // Set the caching storage method(s)
  cacheStorage (caches) {
    this.caches = [].concat(caches)
    this.debugMessage(`updated the cache storage`)
    return this
  }

  // Set the debugging flag
  debugging (flag) {
    this.debug = flag
    return this
  }

  // Print out a debug message if debugging is enabled
  debugMessage (string) {
    if (this.debug) {
      console.log(`[gw2api-client] ${string}`)
    }
  }

  // Make sure we get the new content if the game updates
  flushCacheIfGameUpdated () {
    const buildEndpoint = this.build()
    const promises = {
      cacheBuildId: () => buildEndpoint._cacheGetSingle('cacheBuildId'),
      buildId: () => buildEndpoint.live().get()
    }

    return flow.parallel(promises).then(resp => {
      let flushPromises = []

      // Flush the caches if the cached build id is set (as a safety measure)
      // and the cached build id is older than the current one
      if (resp.cacheBuildId && resp.cacheBuildId < resp.buildId) {
        this.debugMessage(`flushing the cache because of a new build`)
        flushPromises = this.caches.map(cache => () => cache.flush())
      }

      // Flush the caches (if needed) and save the current build id
      return flow.parallel(flushPromises)
        .then(() => buildEndpoint._cacheSetSingle('cacheBuildId', resp.buildId))
    })
  }

  // All the different API endpoints
  account () {
    return new endpoints.AccountEndpoint(this)
  }

  achievements () {
    return new endpoints.AchievementsEndpoint(this)
  }

  backstory () {
    return new endpoints.BackstoryEndpoint(this)
  }

  build () {
    return new endpoints.BuildEndpoint(this)
  }

  cats () {
    return new endpoints.CatsEndpoint(this)
  }

  characters (name) {
    return new endpoints.CharactersEndpoint(this, name)
  }

  colors () {
    return new endpoints.ColorsEndpoint(this)
  }

  commerce () {
    return new endpoints.CommerceEndpoint(this)
  }

  continents () {
    return new endpoints.ContinentsEndpoint(this)
  }

  currencies () {
    return new endpoints.CurrenciesEndpoint(this)
  }

  dailycrafting () {
    return new endpoints.DailycraftingEndpoint(this)
  }

  dungeons () {
    return new endpoints.DungeonsEndpoint(this)
  }

  emblem () {
    return new endpoints.EmblemEndpoint(this)
  }

  emotes () {
    return new endpoints.EmotesEndpoint(this)
  }

  events () {
    return new endpoints.EventsEndpoint(this)
  }

  files () {
    return new endpoints.FilesEndpoint(this)
  }

  finishers () {
    return new endpoints.FinishersEndpoint(this)
  }

  gliders () {
    return new endpoints.GlidersEndpoint(this)
  }

  guild (id) {
    return new endpoints.GuildEndpoint(this, id)
  }

  home () {
    return new endpoints.HomeEndpoint(this)
  }

  homestead () {
    return new endpoints.HomesteadEndpoint(this)
  }

  items () {
    return new endpoints.ItemsEndpoint(this)
  }

  itemstats () {
    return new endpoints.ItemstatsEndpoint(this)
  }

  jadebots () {
    return new endpoints.JadebotsEndpoint(this)
  }

  legendaryarmory () {
    return new endpoints.LegendaryarmoryEndpoint(this)
  }

  legends () {
    return new endpoints.LegendsEndpoint(this)
  }

  mailcarriers () {
    return new endpoints.MailcarriersEndpoint(this)
  }

  mapchests () {
    return new endpoints.MapchestsEndpoint(this)
  }

  maps () {
    return new endpoints.MapsEndpoint(this)
  }

  masteries () {
    return new endpoints.MasteriesEndpoint(this)
  }

  materials () {
    return new endpoints.MaterialsEndpoint(this)
  }

  minis () {
    return new endpoints.MinisEndpoint(this)
  }

  mounts () {
    return new endpoints.MountsEndpoint(this)
  }

  nodes () {
    return new endpoints.NodesEndpoint(this)
  }

  novelties () {
    return new endpoints.NoveltiesEndpoint(this)
  }

  outfits () {
    return new endpoints.OutfitsEndpoint(this)
  }

  pets () {
    return new endpoints.PetsEndpoint(this)
  }

  professions () {
    return new endpoints.ProfessionsEndpoint(this)
  }

  pvp () {
    return new endpoints.PvpEndpoint(this)
  }

  quaggans () {
    return new endpoints.QuaggansEndpoint(this)
  }

  quests () {
    return new endpoints.QuestsEndpoint(this)
  }

  races () {
    return new endpoints.RacesEndpoint(this)
  }

  raids () {
    return new endpoints.RaidsEndpoint(this)
  }

  recipes () {
    return new endpoints.RecipesEndpoint(this)
  }

  skiffs () {
    return new endpoints.SkiffsEndpoint(this)
  }

  skills () {
    return new endpoints.SkillsEndpoint(this)
  }

  skins () {
    return new endpoints.SkinsEndpoint(this)
  }

  specializations () {
    return new endpoints.SpecializationsEndpoint(this)
  }

  stories () {
    return new endpoints.StoriesEndpoint(this)
  }

  titles () {
    return new endpoints.TitlesEndpoint(this)
  }

  tokeninfo () {
    return new endpoints.TokeninfoEndpoint(this)
  }

  traits () {
    return new endpoints.TraitsEndpoint(this)
  }

  wizardsvault () {
    return new endpoints.WizardsvaultEndpoint(this)
  }

  worldbosses () {
    return new endpoints.WorldbossesEndpoint(this)
  }

  worlds () {
    return new endpoints.WorldsEndpoint(this)
  }

  wvw () {
    return new endpoints.WvwEndpoint(this)
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoint.js":
/*!****************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoint.js ***!
  \****************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const qs = __webpack_require__(/*! querystringify */ "./node_modules/querystringify/index.js")
const unique = __webpack_require__(/*! array-unique */ "./node_modules/array-unique/index.js")
const chunk = __webpack_require__(/*! chunk */ "./node_modules/chunk/src/chunk.js")
const hashString = __webpack_require__(/*! ./hash */ "./node_modules/gw2api-client/src/hash.js")

const clone = (x) => JSON.parse(JSON.stringify(x))

module.exports = class AbstractEndpoint {
  constructor (parent) {
    this.client = parent.client
    this.schemaVersion = parent.schemaVersion || '2019-03-20T00:00:00.000Z'
    this.lang = parent.lang
    this.apiKey = parent.apiKey
    this.fetch = parent.fetch
    this.caches = parent.caches
    this.debug = parent.debug

    this.baseUrl = 'https://api.guildwars2.com'
    this.isPaginated = false
    this.maxPageSize = 200
    this.isBulk = false
    this.bulkId = 'id'
    this.supportsBulkAll = true
    this.isLocalized = false
    this.isAuthenticated = false
    this.isOptionallyAuthenticated = false
    this.credentials = false

    this._skipCache = false
  }

  // Set the schema version
  schema (schema) {
    this.schemaVersion = schema
    this.debugMessage(`set the schema to ${schema}`)
    return this
  }

  // Check if the schema version includes a specific version
  _schemaIncludes (date) {
    return this.schemaVersion >= date
  }

  // Set the language for locale-aware endpoints
  language (lang) {
    this.lang = lang
    this.debugMessage(`set the language to ${lang}`)
    return this
  }

  // Set the api key for authenticated endpoints
  authenticate (apiKey) {
    this.apiKey = apiKey
    this.debugMessage(`set the api key to ${apiKey}`)
    return this
  }

  // Set the debugging flag
  debugging (flag) {
    this.debug = flag
    return this
  }

  // Print out a debug message if debugging is enabled
  debugMessage (string) {
    if (this.debug) {
      console.log(`[gw2api-client] ${string}`)
    }
  }

  // Skip caching and get the live data
  live () {
    this._skipCache = true
    this.debugMessage(`skipping cache`)
    return this
  }

  // Get all ids
  ids () {
    this.debugMessage(`ids(${this.url}) called`)

    if (!this.isBulk) {
      return Promise.reject(new Error('"ids" is only available for bulk expanding endpoints'))
    }

    // There is no cache time set, so always use the live data
    if (!this.cacheTime) {
      return this._ids()
    }

    // Get as much as possible out of the cache
    const hash = this._cacheHash('ids')
    const handleCacheContent = (cached) => {
      if (cached) {
        this.debugMessage(`ids(${this.url}) resolving from cache`)
        return cached
      }

      return this._ids().then(content => {
        this._cacheSetSingle(hash, content)
        return content
      })
    }

    // Get the content either from the cache or API, write it into the cache and return a clone
    const contentPromise = this._skipCache
      ? Promise.resolve(false).then(handleCacheContent)
      : this._cacheGetSingle(hash).then(handleCacheContent)

    return contentPromise.then(clone)
  }

  // Get all ids from the live API
  _ids () {
    this.debugMessage(`ids(${this.url}) requesting from api`)
    return this._request(this.url)
  }

  // Get a single entry by id
  get (id, url = false) {
    this.debugMessage(`get(${this.url}) called`)

    if (!id && this.isBulk && !url) {
      return Promise.reject(new Error('"get" requires an id'))
    }

    // There is no cache time set, so always use the live data
    if (!this.cacheTime) {
      return this._get(id, url)
    }

    // Get as much as possible out of the cache
    const hash = this._cacheHash(id)
    const handleCacheContent = (cached) => {
      if (cached) {
        this.debugMessage(`get(${this.url}) resolving from cache`)
        return cached
      }

      return this._get(id, url).then(content => {
        this._cacheSetSingle(hash, content)
        return content
      })
    }

    // Get the content either from the cache or API, write it into the cache and return a clone
    const contentPromise = this._skipCache
      ? Promise.resolve(false).then(handleCacheContent)
      : this._cacheGetSingle(hash).then(handleCacheContent)

    return contentPromise.then(clone)
  }

  // Get a single entry by id from the live API
  _get (id, url) {
    this.debugMessage(`get(${this.url}) requesting from api`)

    // Request the single id if the endpoint a bulk endpoint
    if (this.isBulk && !url) {
      return this._request(`${this.url}?id=${id}`)
    }

    // We are dealing with a custom url instead
    if (url) {
      return this._request(this.url + id)
    }

    // Just request the base url
    return this._request(this.url)
  }

  // Get multiple entries by ids
  many (ids) {
    this.debugMessage(`many(${this.url}) called (${ids.length} ids)`)

    if (!this.isBulk) {
      return Promise.reject(new Error('"many" is only available for bulk expanding endpoints'))
    }

    // Exit out early if we don't request any ids
    if (ids.length === 0) {
      return Promise.resolve([])
    }

    // Always only work on unique ids, since that's how the API works
    ids = unique.immutable(ids)

    // There is no cache time set, so always use the live data
    if (!this.cacheTime) {
      return this._many(ids)
    }

    // Get as much as possible out of the cache
    const hashes = ids.map(id => this._cacheHash(id))
    const handleCacheContent = (cached) => {
      cached = cached.filter(x => x)

      if (cached.length === ids.length) {
        this.debugMessage(`many(${this.url}) resolving fully from cache`)
        return cached
      }

      this.debugMessage(`many(${this.url}) resolving partially from cache (${cached.length} ids)`)
      const missingIds = getMissingIds(ids, cached)
      return this._many(missingIds, cached.length > 0).then(content => {
        const cacheContent = content.map(value => [this._cacheHash(value[this.bulkId]), value])
        this._cacheSetMany(cacheContent)

        // Merge the new content with the cached content and guarantee element order
        content = content.concat(cached)
        return this._sortByIdList(content, ids)
      })
    }

    // Find the ids that are missing in the cached data
    const getMissingIds = (ids, cached) => {
      const cachedIds = {}
      cached.map(x => {
        cachedIds[x[this.bulkId]] = 1
      })

      return ids.filter(x => cachedIds[x] !== 1)
    }

    // Get the content either from the cache or API, write it into the cache and return a clone
    const contentPromise = this._skipCache
      ? Promise.resolve([]).then(handleCacheContent)
      : this._cacheGetMany(hashes).then(handleCacheContent)

    return contentPromise.then(clone)
  }

  // Get multiple entries by ids from the live API
  _many (ids, partialRequest = false) {
    this.debugMessage(`many(${this.url}) requesting from api (${ids.length} ids)`)

    // Chunk the requests to the max page size
    const pages = chunk(ids, this.maxPageSize)
    const requests = pages.map(page => `${this.url}?ids=${page.join(',')}`)

    // If we are partially caching and all not-cached ids are all invalid,
    // simulate the API behaviour by silently swallowing errors.
    let handleMissingIds = (err) => {
      /* istanbul ignore else */
      if (partialRequest && err.response && err.response.status === 404) {
        return Promise.resolve([])
      }

      /* istanbul ignore next */
      return Promise.reject(err)
    }

    // Work on all requests in parallel and then flatten the responses into one
    return this._requestMany(requests)
      .then(responses => responses.reduce((x, y) => x.concat(y), []))
      .catch(handleMissingIds)
  }

  // Get a single page
  page (page, size = this.maxPageSize) {
    this.debugMessage(`page(${this.url}) called`)

    if (!this.isBulk && !this.isPaginated) {
      return Promise.reject(new Error('"page" is only available for bulk expanding or paginated endpoints'))
    }

    if (size > this.maxPageSize || size <= 0) {
      return Promise.reject(new Error(`"size" has to be between 0 and ${this.maxPageSize}, was ${size}`))
    }

    if (page < 0) {
      return Promise.reject(new Error('page has to be 0 or greater'))
    }

    // There is no cache time set, so always use the live data
    if (!this.cacheTime) {
      return this._page(page, size)
    }

    // Get as much as possible out of the cache
    const hash = this._cacheHash('page-' + page + '/' + size)
    const handleCacheContent = (cached) => {
      if (cached) {
        this.debugMessage(`page(${this.url}) resolving from cache`)
        return cached
      }

      return this._page(page, size).then(content => {
        let cacheContent = [[hash, content]]

        if (this.isBulk) {
          cacheContent = cacheContent.concat(content.map(value => [this._cacheHash(value[this.bulkId]), value]))
        }

        this._cacheSetMany(cacheContent)
        return content
      })
    }

    // Get the content either from the cache or API, write it into the cache and return a clone
    const contentPromise = this._skipCache
      ? Promise.resolve(false).then(handleCacheContent)
      : this._cacheGetSingle(hash).then(handleCacheContent)

    return contentPromise.then(clone)
  }

  // Get a single page from the live API
  _page (page, size) {
    this.debugMessage(`page(${this.url}) requesting from api`)
    return this._request(`${this.url}?page=${page}&page_size=${size}`)
  }

  // Get all entries
  all () {
    this.debugMessage(`all(${this.url}) called`)

    if (!this.isBulk && !this.isPaginated) {
      return Promise.reject(new Error('"all" is only available for bulk expanding or paginated endpoints'))
    }

    // There is no cache time set, so always use the live data
    if (!this.cacheTime) {
      return this._all()
    }

    // Get as much as possible out of the cache
    const hash = this._cacheHash('all')
    const handleCacheContent = (cached) => {
      if (cached) {
        this.debugMessage(`all(${this.url}) resolving from cache`)
        return cached
      }

      return this._all().then(content => {
        let cacheContent = [[hash, content]]

        if (this.isBulk) {
          cacheContent = cacheContent.concat(content.map(value => [this._cacheHash(value[this.bulkId]), value]))
        }

        this._cacheSetMany(cacheContent)
        return content
      })
    }

    // Get the content either from the cache or API, write it into the cache and return a clone
    const contentPromise = this._skipCache
      ? Promise.resolve(false).then(handleCacheContent)
      : this._cacheGetSingle(hash).then(handleCacheContent)

    return contentPromise.then(clone)
  }

  // Get all entries from the live API
  _all () {
    this.debugMessage(`all(${this.url}) requesting from api`)

    // Use bulk expansion if the endpoint supports the "all" keyword
    if (this.isBulk && this.supportsBulkAll) {
      return this._request(`${this.url}?ids=all`)
    }

    // Get everything via all pages instead
    let totalEntries
    return this._request(`${this.url}?page=0&page_size=${this.maxPageSize}`, 'response')
      .then(firstPage => {
        // Get the total number of entries off the first page's headers
        totalEntries = firstPage.headers.get('X-Result-Total')
        return firstPage.json()
      })
      .then(result => {
        // Return early if the first page already includes all entries
        if (totalEntries <= this.maxPageSize) {
          return result
        }

        // Request all missing pages in parallel
        let requests = []
        for (let page = 1; page < Math.ceil(totalEntries / this.maxPageSize); page++) {
          requests.push(`${this.url}?page=${page}&page_size=${this.maxPageSize}`)
        }

        return this._requestMany(requests).then(responses => {
          responses = responses.reduce((x, y) => x.concat(y), [])
          return result.concat(responses)
        })
      })
  }

  // Set a single cache key in all connected cache storages
  _cacheSetSingle (key, value) {
    this.caches.map(cache => {
      cache.set(key, value, this.cacheTime).catch(error => {
        console.warn('[gw2api-client] Errored during _cacheSetSingle', { error, cache, key, value })
      })
    })
  }

  // Set multiples cache key in all connected cache storages
  _cacheSetMany (values) {
    values = values.map(value => [value[0], value[1], this.cacheTime])
    this.caches.map(cache => {
      cache.mset(values).catch(error => {
        console.warn('[gw2api-client] Errored during _cacheSetMany', { error, cache, values })
      })
    })
  }

  // Get a cached value out of the first possible connected cache storages
  _cacheGetSingle (key, index = 0) {
    return this.caches[index].get(key).then(value => {
      if (value || index === this.caches.length - 1) {
        return value
      }

      return this._cacheGetSingle(key, ++index)
    })
  }

  // Get multiple cached values out of the first possible connected cache storages
  _cacheGetMany (keys, index = 0) {
    return this.caches[index].mget(keys).then(values => {
      const cleanValues = values.filter(x => x)

      // We got all the requested keys or are through all storages
      if (cleanValues.length === keys.length || index === this.caches.length - 1) {
        return values
      }

      // Try to ask the next storage for the keys that we didn't get
      let missingKeys = values
        .map((value, i) => value ? false : keys[i])
        .filter(value => value)

      // Then merge the values of the next storage into the missing slots
      return this._cacheGetMany(missingKeys, ++index).then(missingValues => {
        let i = 0
        return values.map(value => value || missingValues[i++])
      })
    })
  }

  // Get a cache hash for an identifier
  _cacheHash (id) {
    let hash = hashString(this.baseUrl + this.url + ':' + this.schemaVersion)

    if (id) {
      hash += ':' + id
    }

    if (this.isLocalized) {
      hash += ':' + this.lang
    }

    if (this._usesApiKey()) {
      hash += ':' + hashString(this.apiKey + '')
    }

    return hash
  }

  // Execute a single request
  _request (url, type = 'json') {
    url = this._buildUrl(url)

    /* istanbul ignore next */
    const credentials = this.credentials ? 'include' : undefined

    return this.fetch.single(url, { type, credentials })
  }

  // Execute multiple requests in parallel
  _requestMany (urls, type = 'json') {
    urls = urls.map(url => this._buildUrl(url))

    /* istanbul ignore next */
    const credentials = this.credentials ? 'include' : undefined

    return this.fetch.many(urls, { type, credentials })
  }

  // Build the headers for localization and authentication
  _buildUrl (url) {
    // Add the base url
    url = this.baseUrl + url

    // Parse a possibly existing query
    const parsedUrl = url.split('?')
    let parsedQuery = qs.parse(parsedUrl[1] || '')

    let query = {}

    // Set the schema version
    query['v'] = this.schemaVersion

    // Only set the API key for authenticated endpoints,
    // when it is required or optional and set on the client
    if (this._usesApiKey()) {
      query['access_token'] = this.apiKey
    }

    // Set the language for localized endpoints
    if (this.isLocalized) {
      query['lang'] = this.lang
    }

    // Merge the parsed query parts out of the url
    query = Object.assign(query, parsedQuery)

    // Build the url with the finished query
    query = qs.stringify(query, true).replace(/%2C/g, ',')
    return parsedUrl[0] + query
  }

  // Guarantee the element order of bulk results
  _sortByIdList (entries, ids) {
    // Hash map of the indexes for better time complexity on big arrays
    let indexMap = {}
    ids.map((x, i) => {
      indexMap[x] = i
    })

    // Sort by the indexes
    entries.sort((a, b) => indexMap[a[this.bulkId]] - indexMap[b[this.bulkId]])
    return entries
  }

  _usesApiKey () {
    return this.isAuthenticated && (!this.isOptionallyAuthenticated || this.apiKey)
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/account-blob.js":
/*!******************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/account-blob.js ***!
  \******************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const _get = __webpack_require__(/*! fast-get */ "./node_modules/fast-get/src/index.js")
const flow = __webpack_require__(/*! ../flow.js */ "./node_modules/gw2api-client/src/flow.js")

function blob (parent) {
  const client = parent.client

  const requests = {
    account: wrap(() => client.account().get()),
    achievements: wrap(() => client.account().achievements().get()),
    bank: wrap(() => client.account().bank().get()),
    characters: wrap(() => client.characters().all()),
    'commerce.buys': wrap(() => client.commerce().transactions().current().buys().all()),
    'commerce.delivery': wrap(() => client.commerce().delivery().get()),
    'commerce.sells': wrap(() => client.commerce().transactions().current().sells().all()),
    dungeons: wrap(() => client.account().dungeons().get()),
    dyes: wrap(() => client.account().dyes().get()),
    emotes: wrap(() => client.account().emotes().get()),
    finishers: wrap(() => client.account().finishers().get()),
    gliders: wrap(() => client.account().gliders().get()),
    guilds: wrap(() => accountGuilds(client)),
    'home.cats': wrap(() => client.account().home().cats().get()),
    'home.nodes': wrap(() => client.account().home().nodes().get()),
    'homestead.decorations': wrap(() => client.account().homestead().decorations().get()),
    'homestead.glyphs': wrap(() => client.account().homestead().glyphs().get()),
    jadebots: wrap(() => client.account().jadebots().get()),
    legendaryarmory: wrap(() => client.account().legendaryarmory().get()),
    luck: wrap(() => client.account().luck().get()),
    mailcarriers: wrap(() => client.account().mailcarriers().get()),
    masteries: wrap(() => client.account().masteries().get()),
    'mastery.points': wrap(() => client.account().mastery().points().get()),
    materials: wrap(() => client.account().materials().get()),
    minis: wrap(() => client.account().minis().get()),
    'mounts.skins': wrap(() => client.account().mounts().skins().get()),
    'mounts.types': wrap(() => client.account().mounts().types().get()),
    novelties: wrap(() => client.account().novelties().get()),
    outfits: wrap(() => client.account().outfits().get()),
    'pvp.games': wrap(() => client.account().pvp().games().all()),
    'pvp.heroes': wrap(() => client.account().pvp().heroes().get()),
    'pvp.standings': wrap(() => client.account().pvp().standings().get()),
    'pvp.stats': wrap(() => client.account().pvp().stats().get()),
    raids: wrap(() => client.account().raids().get()),
    recipes: wrap(() => client.account().recipes().get()),
    shared: wrap(() => client.account().inventory().get()),
    skiffs: wrap(() => client.account().skiffs().get()),
    skins: wrap(() => client.account().skins().get()),
    titles: wrap(() => client.account().titles().get()),
    wallet: wrap(() => client.account().wallet().get())
  }

  return flow.parallel(requests).then(data => {
    data = unflatten(data)
    data.characters = filterBetaCharacters(data.characters)
    return data
  })
}

// Get the guild data accessible for the account
function accountGuilds (client) {
  return client.account().get().then(account => {
    if (!account.guild_leader) {
      return []
    }

    let requests = account.guild_leader.map(id => wrap(() => guildData(id)))
    return flow.parallel(requests)
  })

  function guildData (id) {
    let requests = {
      data: wrap(() => client.guild().get(id)),
      members: wrap(() => client.guild(id).members().get()),
      ranks: wrap(() => client.guild(id).ranks().get()),
      stash: wrap(() => client.guild(id).stash().get()),
      teams: wrap(() => Promise.resolve(null)),
      treasury: wrap(() => client.guild(id).treasury().get()),
      upgrades: wrap(() => client.guild(id).upgrades().get())
    }

    return flow.parallel(requests)
  }
}

// Filter out beta characters from the total account blob, since they are
// technically not part of the actual live account and live on a different server
function filterBetaCharacters (characters) {
  /* istanbul ignore next */
  if (!characters) {
    return null
  }

  return characters.filter(x => !x.flags || !x.flags.includes('Beta'))
}

// Wrap a promise function so all errors that have to do with the API
// just result in an empty response instead of throwing an error
// This prevents API errors / changes breaking the entire infrastructure
function wrap (func) {
  return () => new Promise((resolve, reject) => {
    func()
      .then(x => resolve(x))
      .catch(err => {
        let status = _get(err, 'response.status')
        let text = _get(err, 'content.text')

        if (
          status ||
          text ||
          ['network', 'fetch'].some(x => err.message.toLowerCase().includes(x))
        ) {
          console.warn(`API error: ${text} (${status})`)
          return resolve(null)
        }

        reject(err)
      })
  })
}

// Unflatten an object with keys describing a nested structure
function unflatten (object) {
  let result = {}

  for (let key in object) {
    _set(result, key, object[key])
  }

  return result
}

// Set the value of an object based on a flat key ("a.b.c")
function _set (object, key, value) {
  const keyParts = key.split('.')

  let walking = object
  keyParts.forEach((key, index) => {
    // Create the nested object if it does not exist
    if (!walking[key]) {
      walking[key] = {}
    }

    // If we reached the last part, set the value and exit out
    if (index === keyParts.length - 1) {
      walking[key] = value
      return
    }

    // Set the next part of the key
    walking = walking[key]
  })
}

module.exports = blob
module.exports.wrap = wrap


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/account.js":
/*!*************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/account.js ***!
  \*************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")
const CharactersEndpoint = __webpack_require__(/*! ./characters */ "./node_modules/gw2api-client/src/endpoints/characters.js")
const PvpEndpoint = __webpack_require__(/*! ./pvp */ "./node_modules/gw2api-client/src/endpoints/pvp.js")
const CommerceEndpoint = __webpack_require__(/*! ./commerce */ "./node_modules/gw2api-client/src/endpoints/commerce.js")
const WizardsvaultEndpoint = __webpack_require__(/*! ./wizardsvault */ "./node_modules/gw2api-client/src/endpoints/wizardsvault.js")
const accountBlob = __webpack_require__(/*! ./account-blob.js */ "./node_modules/gw2api-client/src/endpoints/account-blob.js")
const resetTime = __webpack_require__(/*! ../helpers/resetTime */ "./node_modules/gw2api-client/src/helpers/resetTime.js")

class AccountEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  achievements () {
    return new AchievementsEndpoint(this)
  }

  bank () {
    return new BankEndpoint(this)
  }

  characters (name) {
    return new CharactersEndpoint(this, name)
  }

  dailycrafting () {
    return new DailycraftingEndpoint(this)
  }

  delivery () {
    return new CommerceEndpoint(this).delivery()
  }

  dungeons () {
    return new DungeonsEndpoint(this)
  }

  dyes () {
    return new DyesEndpoint(this)
  }

  emotes () {
    return new EmotesEndpoint(this)
  }

  finishers () {
    return new FinishersEndpoint(this)
  }

  gliders () {
    return new GlidersEndpoint(this)
  }

  home () {
    return {
      cats: () => new HomeCatsEndpoint(this),
      nodes: () => new HomeNodesEndpoint(this)
    }
  }

  homestead () {
    return {
      decorations: () => new HomesteadDecorationsEndpoint(this),
      glyphs: () => new HomesteadGlyphsEndpoint(this)
    }
  }

  inventory () {
    return new InventoryEndpoint(this)
  }

  jadebots () {
    return new JadebotsEndpoint(this)
  }

  legendaryarmory () {
    return new LegendaryarmoryEndpoint(this)
  }

  luck () {
    return new LuckEndpoint(this)
  }

  mailcarriers () {
    return new MailcarriersEndpoint(this)
  }

  masteries () {
    return new MasteriesEndpoint(this)
  }

  mapchests () {
    return new MapchestsEndpoint(this)
  }

  mastery () {
    return {
      points: () => new MasteryPointsEndpoint(this)
    }
  }

  materials () {
    return new MaterialsEndpoint(this)
  }

  minis () {
    return new MinisEndpoint(this)
  }

  mounts () {
    return {
      skins: () => new MountSkinsEndpoint(this),
      types: () => new MountTypesEndpoint(this)
    }
  }

  novelties () {
    return new NoveltiesEndpoint(this)
  }

  outfits () {
    return new OutfitsEndpoint(this)
  }

  pvp () {
    return new PvpEndpoint(this, true)
  }

  raids () {
    return new RaidsEndpoint(this)
  }

  recipes () {
    return new RecipesEndpoint(this)
  }

  skiffs () {
    return new SkiffsEndpoint(this)
  }

  skins () {
    return new SkinsEndpoint(this)
  }

  titles () {
    return new TitlesEndpoint(this)
  }

  transactions () {
    return new CommerceEndpoint(this).transactions()
  }

  wallet () {
    return new WalletEndpoint(this)
  }

  wizardsvault () {
    return {
      listings: () => new WizardsvaultListingsEndpoint(this),
      daily: () => new WizardsvaultDailyEndpoint(this),
      weekly: () => new WizardsvaultWeeklyEndpoint(this),
      special: () => new WizardsvaultSpecialEndpoint(this)
    }
  }

  worldbosses () {
    return new WorldbossesEndpoint(this)
  }

  // All data available for the account in a single object
  blob () {
    return accountBlob(this)
  }
}

class AchievementsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/achievements'
    this.isAuthenticated = true
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 5 * 60
  }

  ids () {
    return Promise.reject(new Error('method not supported for this endpoint'))
  }

  get (id) {
    if (id) {
      return super.get(id)
    }

    // This endpoint returns all entries if the url gets requested
    // without any parameters, analogue to the other account endpoints
    return this.all()
  }

  all () {
    return super.get('', true)
  }
}

class BankEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/bank'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class DailycraftingEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/dailycrafting'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  async get () {
    return await isStaleDailyData(this) ? [] : super.get()
  }
}

class DungeonsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/dungeons'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  async get () {
    return await isStaleDailyData(this) ? [] : super.get()
  }
}

class DyesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/dyes'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class EmotesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/emotes'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class FinishersEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/finishers'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class GlidersEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/gliders'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class HomeCatsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/home/cats'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class HomeNodesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/home/nodes'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class HomesteadDecorationsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/homestead/decorations'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class HomesteadGlyphsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/homestead/glyphs'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class InventoryEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/inventory'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class JadebotsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/jadebots'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class LegendaryarmoryEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/legendaryarmory'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class LuckEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/luck'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  async get () {
    const response = await super.get()
    // [API PATCH #0] If the account does not have any luck, the API erroneously returns `[]`
    if (response.length === 0) return 0
    return response[0].value
  }
}

class MailcarriersEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/mailcarriers'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class MapchestsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/mapchests'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  async get () {
    return await isStaleDailyData(this) ? [] : super.get()
  }
}

class MasteriesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/masteries'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class MasteryPointsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/mastery/points'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class MaterialsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/materials'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class MinisEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/minis'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class MountSkinsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/mounts/skins'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class MountTypesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/mounts/types'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class NoveltiesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/novelties'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class OutfitsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/outfits'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class RaidsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/raids'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  async get () {
    return await isStaleWeeklyData(this) ? [] : super.get()
  }
}

class RecipesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/recipes'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class SkiffsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/skiffs'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class SkinsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/skins'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class TitlesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/titles'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class WalletEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/wallet'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class WorldbossesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/worldbosses'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  async get () {
    return await isStaleDailyData(this) ? [] : super.get()
  }
}

class WizardsvaultListingsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/wizardsvault/listings'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class WizardsvaultDailyEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/wizardsvault/daily'
    this.isAuthenticated = true
    this.isLocalized = true
    this.cacheTime = 5 * 60
  }

  async get () {
    const [response, isStale] = await Promise.all([
      super.get(),
      isStaleDailyData(this)
    ])

    if (isStale) {
      response.meta_progress_current = 0
      response.meta_reward_claimed = false
      response.objectives = []
    }

    return response
  }
}

class WizardsvaultWeeklyEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/wizardsvault/weekly'
    this.isAuthenticated = true
    this.isLocalized = true
    this.cacheTime = 5 * 60
  }

  async get () {
    const [response, isStale] = await Promise.all([
      super.get(),
      isStaleWeeklyData(this)
    ])

    if (isStale) {
      response.meta_progress_current = 0
      response.meta_reward_claimed = false
      response.objectives = []
    }

    return response
  }
}

class WizardsvaultSpecialEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/wizardsvault/special'
    this.isAuthenticated = true
    this.isLocalized = true
    this.cacheTime = 5 * 60
  }

  async get () {
    const season = await new WizardsvaultEndpoint(this).get()

    const [response, isStale] = await Promise.all([
      super.get(),
      isStaleData(this, new Date(season.start))
    ])

    if (isStale) {
      response.objectives = []
    }

    return response
  }
}

// Stale data can happen if the last account update was before the last daily reset
async function isStaleDailyData (endpointInstance) {
  return isStaleData(endpointInstance, resetTime.getLastDailyReset())
}

// Stale data can happen if the last account update was before the last weekly reset
async function isStaleWeeklyData (endpointInstance) {
  return isStaleData(endpointInstance, resetTime.getLastWeeklyReset())
}

async function isStaleData (endpointInstance, resetDate) {
  const account = await new AccountEndpoint(endpointInstance).schema('2019-03-26').get()
  return new Date(account.last_modified) < resetDate
}

module.exports = AccountEndpoint


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/achievements.js":
/*!******************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/achievements.js ***!
  \******************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class AchievementsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/achievements'
    this.isPaginated = true
    this.isBulk = true
    this.supportsBulkAll = false
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }

  categories () {
    return new CategoriesEndpoint(this)
  }

  groups () {
    return new GroupsEndpoint(this)
  }

  daily () {
    return new DailyEndpoint(this)
  }

  dailyTomorrow () {
    return new DailyTomorrowEndpoint(this)
  }
}

class CategoriesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/achievements/categories'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class GroupsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/achievements/groups'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class DailyEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/achievements/daily'
    this.cacheTime = 60 * 60
  }
}

class DailyTomorrowEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/achievements/daily/tomorrow'
    this.cacheTime = 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/backstory.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/backstory.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class BackstoryEndpoint extends AbstractEndpoint {
  answers () {
    return new AnswersEndpoint(this)
  }

  questions () {
    return new QuestionsEndpoint(this)
  }
}

class AnswersEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/backstory/answers'
    this.isPaginated = true
    this.isBulk = true
    this.supportsBulkAll = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class QuestionsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/backstory/questions'
    this.isPaginated = true
    this.isBulk = true
    this.supportsBulkAll = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/build.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/build.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class BuildEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/build'
    this.cacheTime = 60
  }

  get () {
    return super.get().then(result => result.id)
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/cats.js":
/*!**********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/cats.js ***!
  \**********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class CatsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/cats'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/characters.js":
/*!****************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/characters.js ***!
  \****************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class CharactersEndpoint extends AbstractEndpoint {
  constructor (client, name) {
    super(client)
    this.name = name
    this.url = '/v2/characters'
    this.isPaginated = true
    this.isBulk = true
    this.bulkId = 'name'
    this.supportsBulkAll = false
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  backstory () {
    return new BackstoryEndpoint(this, this.name)
  }

  core () {
    return new CoreEndpoint(this, this.name)
  }

  crafting () {
    return new CraftingEndpoint(this, this.name)
  }

  equipment () {
    return new EquipmentEndpoint(this, this.name)
  }

  heropoints () {
    return new HeropointsEndpoint(this, this.name)
  }

  inventory () {
    return new InventoryEndpoint(this, this.name)
  }

  quests () {
    return new QuestsEndpoint(this, this.name)
  }

  recipes () {
    return new RecipesEndpoint(this, this.name)
  }

  sab () {
    return new SabEndpoint(this, this.name)
  }

  skills () {
    return new SkillsEndpoint(this, this.name)
  }

  specializations () {
    return new SpecializationsEndpoint(this, this.name)
  }

  training () {
    return new TrainingEndpoint(this, this.name)
  }
}

class BackstoryEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/backstory`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  get () {
    return super.get().then(result => result.backstory)
  }
}

class CoreEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/core`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class CraftingEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/crafting`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  get () {
    return super.get().then(result => result.crafting)
  }
}

class EquipmentEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/equipment`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  get () {
    return super.get().then(result => result.equipment)
  }
}

class HeropointsEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/heropoints`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class InventoryEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/inventory`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  get () {
    return super.get().then(result => result.bags)
  }
}

class QuestsEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/quests`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class RecipesEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/recipes`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  get () {
    return super.get().then(result => result.recipes)
  }
}

class SabEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/sab`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class SkillsEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/skills`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  get () {
    return super.get().then(result => result.skills)
  }
}

class SpecializationsEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/specializations`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  get () {
    return super.get().then(result => result.specializations)
  }
}

class TrainingEndpoint extends AbstractEndpoint {
  constructor (client, character) {
    super(client)
    this.url = `/v2/characters/${encodeURIComponent(character)}/training`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  get () {
    return super.get().then(result => result.training)
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/colors.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/colors.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class ColorsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/colors'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/commerce.js":
/*!**************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/commerce.js ***!
  \**************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class CommerceEndpoint extends AbstractEndpoint {
  // Current things to grab in the delivery box
  delivery () {
    return new DeliveryEndpoint(this)
  }

  // Current gem/coin exchange rates
  exchange () {
    return new ExchangeEndpoint(this)
  }

  // Current tradingpost listings
  listings () {
    return new ListingsEndpoint(this)
  }

  // Current tradingpost prices
  prices () {
    return new PricesEndpoint(this)
  }

  // Current and completed transactions
  transactions () {
    return {
      current: () => ({
        buys: () => new TransactionsEndpoint(this, 'current', 'buys'),
        sells: () => new TransactionsEndpoint(this, 'current', 'sells')
      }),
      history: () => ({
        buys: () => new TransactionsEndpoint(this, 'history', 'buys'),
        sells: () => new TransactionsEndpoint(this, 'history', 'sells')
      })
    }
  }
}

class DeliveryEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = `/v2/commerce/delivery`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class ExchangeEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/commerce/exchange'
    this.cacheTime = 10 * 60
  }

  gems (quantity) {
    return super.get(`/gems?quantity=${quantity}`, true)
  }

  coins (quantity) {
    return super.get(`/coins?quantity=${quantity}`, true)
  }
}

class ListingsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/commerce/listings'
    this.isPaginated = true
    this.isBulk = true
    this.supportsBulkAll = false
    this.cacheTime = 2 * 60
  }
}

class PricesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/commerce/prices'
    this.isPaginated = true
    this.isBulk = true
    this.supportsBulkAll = false
    this.cacheTime = 60
  }
}

class TransactionsEndpoint extends AbstractEndpoint {
  constructor (client, type, list) {
    super(client)
    this.url = `/v2/commerce/transactions/${type}/${list}`
    this.isPaginated = true
    this.isAuthenticated = true
    this.cacheTime = 10 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/continents.js":
/*!****************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/continents.js ***!
  \****************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class ContinentsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/continents'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }

  floors (id) {
    return new FloorsEndpoint(this, id)
  }
}

class FloorsEndpoint extends AbstractEndpoint {
  constructor (client, continentId) {
    super(client)
    this.url = `/v2/continents/${continentId}/floors`
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/currencies.js":
/*!****************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/currencies.js ***!
  \****************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class CurrenciesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/currencies'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/dailycrafting.js":
/*!*******************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/dailycrafting.js ***!
  \*******************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class DailycraftingEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/dailycrafting'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/dungeons.js":
/*!**************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/dungeons.js ***!
  \**************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class DungeonsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/dungeons'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/emblem.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/emblem.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class EmblemEndpoint extends AbstractEndpoint {
  backgrounds () {
    return new LayersEndpoint(this, 'backgrounds')
  }

  foregrounds () {
    return new LayersEndpoint(this, 'foregrounds')
  }
}

class LayersEndpoint extends AbstractEndpoint {
  constructor (client, layer) {
    super(client)
    this.url = `/v2/emblem/${layer}`
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/emotes.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/emotes.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class EmotesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/emotes'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/events.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/events.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class EventsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v1/event_details.json'
    this.cacheTime = 24 * 60 * 60
  }

  all () {
    return super.get().then(transformV1Format)
  }

  get (id) {
    return super.get(`?event_id=${id}`, true).then(json => transformV1Format(json)[0])
  }
}

function transformV1Format (json) {
  let events = json.events
  let transformed = []
  const keys = Object.keys(events)

  for (let i = 0; i !== keys.length; i++) {
    transformed.push(Object.assign({ id: keys[i] }, events[keys[i]]))
  }

  return transformed
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/files.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/files.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class FilesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/files'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/finishers.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/finishers.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class FinishersEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/finishers'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/gliders.js":
/*!*************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/gliders.js ***!
  \*************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class GlidersEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/gliders'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/guild.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/guild.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class GuildEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.id = id
    this.url = '/v2/guild'
    this.isAuthenticated = true
    this.isOptionallyAuthenticated = true
    this.cacheTime = 60 * 60
  }

  get (id) {
    return super.get(`/${id}`, true)
  }

  permissions () {
    return new PermissionsEndpoint(this)
  }

  search (name) {
    return new SearchEndpoint(this, name)
  }

  upgrades () {
    if (this.id === undefined) {
      return new AllUpgradesEndpoint(this)
    }

    return new UpgradesEndpoint(this, this.id)
  }

  log () {
    return new LogEndpoint(this, this.id)
  }

  members () {
    return new MembersEndpoint(this, this.id)
  }

  ranks () {
    return new RanksEndpoint(this, this.id)
  }

  stash () {
    return new StashEndpoint(this, this.id)
  }

  storage () {
    return new StorageEndpoint(this, this.id)
  }

  teams () {
    return new TeamsEndpoint(this, this.id)
  }

  treasury () {
    return new TreasuryEndpoint(this, this.id)
  }
}

class PermissionsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/guild/permissions'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class SearchEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/guild/search'
    this.cacheTime = 60 * 60
  }

  name (name) {
    return super.get(`?name=${encodeURIComponent(name)}`, true)
      .then(result => result[0])
  }
}

class AllUpgradesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/guild/upgrades'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class LogEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.url = `/v2/guild/${encodeURIComponent(id)}/log`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }

  since (logId) {
    return super.get(`?since=${logId}`, true)
  }
}

class MembersEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.url = `/v2/guild/${encodeURIComponent(id)}/members`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class RanksEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.url = `/v2/guild/${encodeURIComponent(id)}/ranks`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class StashEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.url = `/v2/guild/${encodeURIComponent(id)}/stash`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class StorageEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.url = `/v2/guild/${encodeURIComponent(id)}/storage`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class TeamsEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.url = `/v2/guild/${encodeURIComponent(id)}/teams`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class TreasuryEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.url = `/v2/guild/${encodeURIComponent(id)}/treasury`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class UpgradesEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.url = `/v2/guild/${encodeURIComponent(id)}/upgrades`
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/home.js":
/*!**********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/home.js ***!
  \**********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class HomeEndpoint extends AbstractEndpoint {
  cats () {
    return new CatsEndpoint(this)
  }

  nodes () {
    return new NodesEndpoint(this)
  }
}

class CatsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/home/cats'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}

class NodesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/home/nodes'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/homestead.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/homestead.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class HomesteadEndpoint extends AbstractEndpoint {
  decorations () {
    return new DecorationsEndpoint(this)
  }

  glyphs () {
    return new GlyphsEndpoint(this)
  }
}

class DecorationsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/homestead/decorations'
    this.isPaginated = true
    this.isLocalized = true
    this.isBulk = true
    this.supportsBulkAll = false
    this.cacheTime = 24 * 60 * 60
  }

  categories () {
    return new DecorationsCategoriesEndpoint(this)
  }
}

class GlyphsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/homestead/glyphs'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}

class DecorationsCategoriesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/homestead/decorations/categories'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/index.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/index.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = {
  AccountEndpoint: __webpack_require__(/*! ./account */ "./node_modules/gw2api-client/src/endpoints/account.js"),
  AchievementsEndpoint: __webpack_require__(/*! ./achievements */ "./node_modules/gw2api-client/src/endpoints/achievements.js"),
  BackstoryEndpoint: __webpack_require__(/*! ./backstory */ "./node_modules/gw2api-client/src/endpoints/backstory.js"),
  BuildEndpoint: __webpack_require__(/*! ./build */ "./node_modules/gw2api-client/src/endpoints/build.js"),
  CatsEndpoint: __webpack_require__(/*! ./cats */ "./node_modules/gw2api-client/src/endpoints/cats.js"),
  CharactersEndpoint: __webpack_require__(/*! ./characters */ "./node_modules/gw2api-client/src/endpoints/characters.js"),
  ColorsEndpoint: __webpack_require__(/*! ./colors */ "./node_modules/gw2api-client/src/endpoints/colors.js"),
  CommerceEndpoint: __webpack_require__(/*! ./commerce */ "./node_modules/gw2api-client/src/endpoints/commerce.js"),
  ContinentsEndpoint: __webpack_require__(/*! ./continents */ "./node_modules/gw2api-client/src/endpoints/continents.js"),
  CurrenciesEndpoint: __webpack_require__(/*! ./currencies */ "./node_modules/gw2api-client/src/endpoints/currencies.js"),
  DailycraftingEndpoint: __webpack_require__(/*! ./dailycrafting */ "./node_modules/gw2api-client/src/endpoints/dailycrafting.js"),
  DungeonsEndpoint: __webpack_require__(/*! ./dungeons */ "./node_modules/gw2api-client/src/endpoints/dungeons.js"),
  EmblemEndpoint: __webpack_require__(/*! ./emblem */ "./node_modules/gw2api-client/src/endpoints/emblem.js"),
  EmotesEndpoint: __webpack_require__(/*! ./emotes */ "./node_modules/gw2api-client/src/endpoints/emotes.js"),
  EventsEndpoint: __webpack_require__(/*! ./events */ "./node_modules/gw2api-client/src/endpoints/events.js"),
  FilesEndpoint: __webpack_require__(/*! ./files */ "./node_modules/gw2api-client/src/endpoints/files.js"),
  FinishersEndpoint: __webpack_require__(/*! ./finishers */ "./node_modules/gw2api-client/src/endpoints/finishers.js"),
  GlidersEndpoint: __webpack_require__(/*! ./gliders */ "./node_modules/gw2api-client/src/endpoints/gliders.js"),
  GuildEndpoint: __webpack_require__(/*! ./guild */ "./node_modules/gw2api-client/src/endpoints/guild.js"),
  HomeEndpoint: __webpack_require__(/*! ./home */ "./node_modules/gw2api-client/src/endpoints/home.js"),
  HomesteadEndpoint: __webpack_require__(/*! ./homestead */ "./node_modules/gw2api-client/src/endpoints/homestead.js"),
  ItemsEndpoint: __webpack_require__(/*! ./items */ "./node_modules/gw2api-client/src/endpoints/items.js"),
  ItemstatsEndpoint: __webpack_require__(/*! ./itemstats */ "./node_modules/gw2api-client/src/endpoints/itemstats.js"),
  JadebotsEndpoint: __webpack_require__(/*! ./jadebots */ "./node_modules/gw2api-client/src/endpoints/jadebots.js"),
  LegendaryarmoryEndpoint: __webpack_require__(/*! ./legendaryarmory */ "./node_modules/gw2api-client/src/endpoints/legendaryarmory.js"),
  LegendsEndpoint: __webpack_require__(/*! ./legends */ "./node_modules/gw2api-client/src/endpoints/legends.js"),
  MailcarriersEndpoint: __webpack_require__(/*! ./mailcarriers */ "./node_modules/gw2api-client/src/endpoints/mailcarriers.js"),
  MapchestsEndpoint: __webpack_require__(/*! ./mapchests */ "./node_modules/gw2api-client/src/endpoints/mapchests.js"),
  MapsEndpoint: __webpack_require__(/*! ./maps */ "./node_modules/gw2api-client/src/endpoints/maps.js"),
  MasteriesEndpoint: __webpack_require__(/*! ./masteries */ "./node_modules/gw2api-client/src/endpoints/masteries.js"),
  MaterialsEndpoint: __webpack_require__(/*! ./materials */ "./node_modules/gw2api-client/src/endpoints/materials.js"),
  MinisEndpoint: __webpack_require__(/*! ./minis */ "./node_modules/gw2api-client/src/endpoints/minis.js"),
  MountsEndpoint: __webpack_require__(/*! ./mounts */ "./node_modules/gw2api-client/src/endpoints/mounts.js"),
  NodesEndpoint: __webpack_require__(/*! ./nodes */ "./node_modules/gw2api-client/src/endpoints/nodes.js"),
  NoveltiesEndpoint: __webpack_require__(/*! ./novelties */ "./node_modules/gw2api-client/src/endpoints/novelties.js"),
  OutfitsEndpoint: __webpack_require__(/*! ./outfits */ "./node_modules/gw2api-client/src/endpoints/outfits.js"),
  PetsEndpoint: __webpack_require__(/*! ./pets */ "./node_modules/gw2api-client/src/endpoints/pets.js"),
  ProfessionsEndpoint: __webpack_require__(/*! ./professions */ "./node_modules/gw2api-client/src/endpoints/professions.js"),
  PvpEndpoint: __webpack_require__(/*! ./pvp */ "./node_modules/gw2api-client/src/endpoints/pvp.js"),
  QuaggansEndpoint: __webpack_require__(/*! ./quaggans */ "./node_modules/gw2api-client/src/endpoints/quaggans.js"),
  QuestsEndpoint: __webpack_require__(/*! ./quests */ "./node_modules/gw2api-client/src/endpoints/quests.js"),
  RacesEndpoint: __webpack_require__(/*! ./races */ "./node_modules/gw2api-client/src/endpoints/races.js"),
  RaidsEndpoint: __webpack_require__(/*! ./raids */ "./node_modules/gw2api-client/src/endpoints/raids.js"),
  RecipesEndpoint: __webpack_require__(/*! ./recipes */ "./node_modules/gw2api-client/src/endpoints/recipes.js"),
  SkiffsEndpoint: __webpack_require__(/*! ./skiffs */ "./node_modules/gw2api-client/src/endpoints/skiffs.js"),
  SkillsEndpoint: __webpack_require__(/*! ./skills */ "./node_modules/gw2api-client/src/endpoints/skills.js"),
  SkinsEndpoint: __webpack_require__(/*! ./skins */ "./node_modules/gw2api-client/src/endpoints/skins.js"),
  SpecializationsEndpoint: __webpack_require__(/*! ./specializations */ "./node_modules/gw2api-client/src/endpoints/specializations.js"),
  StoriesEndpoint: __webpack_require__(/*! ./stories */ "./node_modules/gw2api-client/src/endpoints/stories.js"),
  TitlesEndpoint: __webpack_require__(/*! ./titles */ "./node_modules/gw2api-client/src/endpoints/titles.js"),
  TokeninfoEndpoint: __webpack_require__(/*! ./tokeninfo */ "./node_modules/gw2api-client/src/endpoints/tokeninfo.js"),
  TraitsEndpoint: __webpack_require__(/*! ./traits */ "./node_modules/gw2api-client/src/endpoints/traits.js"),
  WizardsvaultEndpoint: __webpack_require__(/*! ./wizardsvault */ "./node_modules/gw2api-client/src/endpoints/wizardsvault.js"),
  WorldbossesEndpoint: __webpack_require__(/*! ./worldbosses */ "./node_modules/gw2api-client/src/endpoints/worldbosses.js"),
  WorldsEndpoint: __webpack_require__(/*! ./worlds */ "./node_modules/gw2api-client/src/endpoints/worlds.js"),
  WvwEndpoint: __webpack_require__(/*! ./wvw */ "./node_modules/gw2api-client/src/endpoints/wvw.js")
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/items.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/items.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class ItemsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/items'
    this.isPaginated = true
    this.isBulk = true
    this.supportsBulkAll = false
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/itemstats.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/itemstats.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class ItemstatsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/itemstats'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/jadebots.js":
/*!**************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/jadebots.js ***!
  \**************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class JadebotsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/jadebots'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/legendaryarmory.js":
/*!*********************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/legendaryarmory.js ***!
  \*********************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class LegendaryarmoryEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/legendaryarmory'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/legends.js":
/*!*************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/legends.js ***!
  \*************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class LegendsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/legends'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/mailcarriers.js":
/*!******************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/mailcarriers.js ***!
  \******************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class MailcarriersEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/mailcarriers'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/mapchests.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/mapchests.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class MapchestsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/mapchests'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/maps.js":
/*!**********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/maps.js ***!
  \**********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class MapsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/maps'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/masteries.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/masteries.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class MasteriesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/masteries'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/materials.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/materials.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class MaterialsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/materials'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/minis.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/minis.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class MinisEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/minis'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/mounts.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/mounts.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class MountsEndpoint extends AbstractEndpoint {
  skins () {
    return new SkinsEndpoint(this)
  }

  types () {
    return new TypesEndpoint(this)
  }
}

class SkinsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/mounts/skins'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class TypesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/mounts/types'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/nodes.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/nodes.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class NodesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/nodes'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/novelties.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/novelties.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class NoveltiesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/novelties'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/outfits.js":
/*!*************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/outfits.js ***!
  \*************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class OutfitsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/outfits'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/pets.js":
/*!**********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/pets.js ***!
  \**********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class PetsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/pets'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/professions.js":
/*!*****************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/professions.js ***!
  \*****************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class ProfessionsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/professions'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/pvp.js":
/*!*********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/pvp.js ***!
  \*********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class PvpEndpoint extends AbstractEndpoint {
  constructor (client, fromAccount) {
    super(client)
    this.fromAccount = fromAccount
  }

  amulets () {
    return new AmuletsEndpoint(this)
  }

  games () {
    return new GamesEndpoint(this)
  }

  heroes () {
    if (this.fromAccount) {
      return new AccountHeroesEndpoint(this)
    }

    return new HeroesEndpoint(this)
  }

  ranks () {
    return new RanksEndpoint(this)
  }

  seasons (id) {
    return new SeasonsEndpoint(this, id)
  }

  standings () {
    return new StandingsEndpoint(this)
  }

  stats () {
    return new StatsEndpoint(this)
  }
}

class AccountHeroesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/account/pvp/heroes'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class AmuletsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/pvp/amulets'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class GamesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/pvp/games'
    this.isPaginated = true
    this.isBulk = true
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class HeroesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/pvp/heroes'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class RanksEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/pvp/ranks'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class SeasonsEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.id = id
    this.url = '/v2/pvp/seasons'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }

  leaderboards () {
    return new SeasonLeaderboardEndpoint(this, this.id)
  }
}

class SeasonLeaderboardEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.id = id
    this.url = `/v2/pvp/seasons/${id}/leaderboards`
    this.cacheTime = 24 * 60 * 60
  }

  ids () {
    return super.get('', true)
  }

  board (board, region) {
    return new SeasonLeaderboardBoardEndpoint(this, this.id, board, region)
  }
}

class SeasonLeaderboardBoardEndpoint extends AbstractEndpoint {
  constructor (client, id, board, region) {
    super(client)
    this.url = `/v2/pvp/seasons/${id}/leaderboards/${board}/${region}`
    this.isPaginated = true
    this.cacheTime = 5 * 60
  }
}

class StandingsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/pvp/standings'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}

class StatsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/pvp/stats'
    this.isAuthenticated = true
    this.cacheTime = 5 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/quaggans.js":
/*!**************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/quaggans.js ***!
  \**************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class QuaggansEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/quaggans'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/quests.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/quests.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class QuestsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/quests'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/races.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/races.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class RacesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/races'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/raids.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/raids.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class RaidsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/raids'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/recipes.js":
/*!*************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/recipes.js ***!
  \*************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class RecipesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/recipes'
    this.isPaginated = true
    this.isBulk = true
    this.supportsBulkAll = false
    this.cacheTime = 24 * 60 * 60
  }

  search () {
    return new SearchEndpoint(this)
  }
}

class SearchEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/recipes/search'
    this.cacheTime = 24 * 60 * 60
  }

  input (id) {
    return super.get(`?input=${id}`, true)
  }

  output (id) {
    return super.get(`?output=${id}`, true)
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/skiffs.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/skiffs.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class SkiffsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/skiffs'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/skills.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/skills.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class SkillsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/skills'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/skins.js":
/*!***********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/skins.js ***!
  \***********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class SkinsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/skins'
    this.isPaginated = true
    this.isBulk = true
    this.supportsBulkAll = false
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/specializations.js":
/*!*********************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/specializations.js ***!
  \*********************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class SpecializationsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/specializations'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/stories.js":
/*!*************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/stories.js ***!
  \*************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class StoriesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/stories'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }

  seasons () {
    return new SeasonsEndpoint(this)
  }
}

class SeasonsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/stories/seasons'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/titles.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/titles.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class TitlesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/titles'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/tokeninfo.js":
/*!***************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/tokeninfo.js ***!
  \***************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class TokeninfoEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/tokeninfo'
    this.isAuthenticated = true
    this.cacheTime = 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/traits.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/traits.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class TraitsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/traits'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/wizardsvault.js":
/*!******************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/wizardsvault.js ***!
  \******************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class WizardsvaultEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wizardsvault'
    this.isLocalized = true
    this.cacheTime = 60 * 60
  }

  listings () {
    return new ListingsEndpoint(this)
  }

  objectives () {
    return new ObjectivesEndpoint(this)
  }
}

class ListingsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wizardsvault/listings'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = false
    this.cacheTime = 60 * 60
  }
}

class ObjectivesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wizardsvault/objectives'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/worldbosses.js":
/*!*****************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/worldbosses.js ***!
  \*****************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class WorldbossesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/worldbosses'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/worlds.js":
/*!************************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/worlds.js ***!
  \************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class WorldsEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/worlds'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/endpoints/wvw.js":
/*!*********************************************************!*\
  !*** ./node_modules/gw2api-client/src/endpoints/wvw.js ***!
  \*********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const AbstractEndpoint = __webpack_require__(/*! ../endpoint */ "./node_modules/gw2api-client/src/endpoint.js")

module.exports = class WvwEndpoint extends AbstractEndpoint {
  abilities () {
    return new AbilitiesEndpoint(this)
  }

  matches () {
    return new MatchesEndpoint(this)
  }

  objectives () {
    return new ObjectivesEndpoint(this)
  }

  upgrades () {
    return new UpgradesEndpoint(this)
  }

  ranks () {
    return new RanksEndpoint(this)
  }
}

class AbilitiesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wvw/abilities'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class MatchesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wvw/matches'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 30
  }

  world (worldId) {
    return super.get(`?world=${worldId}`, true)
  }

  overview () {
    return new MatchesOverviewEndpoint(this)
  }

  scores () {
    return new MatchesScoresEndpoint(this)
  }

  stats (id) {
    return new MatchesStatsEndpoint(this, id)
  }
}

class TeamsEndpoint extends AbstractEndpoint {
  constructor (client, id, team) {
    super(client)
    this.team = team
    this.id = id
    this.url = `/v2/wvw/matches/stats/${id}/teams`
  }

  top (which) {
    return new TopStatsEndpoint(this, this.id, this.team, which)
  }
}

class TopStatsEndpoint extends AbstractEndpoint {
  constructor (client, id, team, which) {
    super(client)
    this.which = which
    this.url = `/v2/wvw/matches/stats/${id}/teams/${team}/top/${which}`
  }
}

class MatchesOverviewEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wvw/matches/overview'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 30
  }

  world (worldId) {
    return super.get(`?world=${worldId}`, true)
  }
}

class MatchesScoresEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wvw/matches/scores'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 30
  }

  world (worldId) {
    return super.get(`?world=${worldId}`, true)
  }
}

class MatchesStatsEndpoint extends AbstractEndpoint {
  constructor (client, id) {
    super(client)
    this.id = id
    this.url = '/v2/wvw/matches/stats'
    this.isPaginated = true
    this.isBulk = true
    this.cacheTime = 30
  }

  world (worldId) {
    return super.get(`?world=${worldId}`, true)
  }

  teams (team) {
    return new TeamsEndpoint(this, this.id, team)
  }
}

class ObjectivesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wvw/objectives'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class UpgradesEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wvw/upgrades'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}

class RanksEndpoint extends AbstractEndpoint {
  constructor (client) {
    super(client)
    this.url = '/v2/wvw/ranks'
    this.isPaginated = true
    this.isBulk = true
    this.isLocalized = true
    this.cacheTime = 24 * 60 * 60
  }
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/flow.js":
/*!************************************************!*\
  !*** ./node_modules/gw2api-client/src/flow.js ***!
  \************************************************/
/***/ ((module) => {

async function parallel (promises) {
  const results = await Promise.all(
    Object.values(promises).map(func => func())
  )

  // If the initial structure was an array, just return the array of results
  if (Array.isArray(promises)) {
    return results
  }

  // If the initial structure was an object, rebuild an object with the results
  const keys = Object.keys(promises)
  return results.reduce((object, resultPart, index) => {
    object[keys[index]] = resultPart
    return object
  }, {})
}

module.exports = { parallel }


/***/ }),

/***/ "./node_modules/gw2api-client/src/hash.js":
/*!************************************************!*\
  !*** ./node_modules/gw2api-client/src/hash.js ***!
  \************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const emotionHash = (__webpack_require__(/*! @emotion/hash/dist/hash.browser.cjs.js */ "./node_modules/@emotion/hash/dist/hash.browser.cjs.js")["default"])

let cache = {}

function hash (string) {
  if (!cache[string]) {
    cache[string] = emotionHash(string)
  }

  return cache[string]
}

module.exports = hash


/***/ }),

/***/ "./node_modules/gw2api-client/src/helpers/resetTime.js":
/*!*************************************************************!*\
  !*** ./node_modules/gw2api-client/src/helpers/resetTime.js ***!
  \*************************************************************/
/***/ ((module) => {

const DAY_MS = 24 * 60 * 60 * 1000

function getDateAtTime (date, time) {
  return new Date(date.toISOString().replace(/T.*Z/, `T${time}.000Z`))
}

function getDailyReset (date) {
  date = date ? new Date(date) : new Date()

  date = new Date(date.getTime() + DAY_MS)
  return getDateAtTime(date, '00:00:00')
}

function getLastDailyReset (date) {
  return new Date(getDailyReset(date).getTime() - DAY_MS)
}

function getWeeklyReset (date) {
  date = date ? new Date(date) : new Date()

  const weekday = date.getUTCDay()
  const hours = date.getUTCHours()
  const minutes = date.getUTCMinutes()
  let dayDiff = 0

  switch (weekday) {
    case 0:
      // 0 -> 1 sunday
      dayDiff = 1
      break
    case 1:
      // 1 -> 0 monday (if before reset)
      // 1 -> 7 monday (if after reset)
      const pastReset = hours > 7 || (hours === 7 && minutes >= 30)
      dayDiff = pastReset ? 7 : 0
      break
    default:
      // 2 -> 6 tuesday
      // 3 -> 5 wednesday
      // 4 -> 4 thursday
      // 5 -> 3 friday
      // 6 -> 2 saturday
      dayDiff = 8 - weekday
      break
  }

  date = new Date(date.getTime() + dayDiff * DAY_MS)
  return getDateAtTime(date, '07:30:00')
}

function getLastWeeklyReset (date) {
  return new Date(getWeeklyReset(date).getTime() - 7 * DAY_MS)
}

module.exports = {
  getDateAtTime,
  getDailyReset,
  getLastDailyReset,
  getWeeklyReset,
  getLastWeeklyReset
}


/***/ }),

/***/ "./node_modules/gw2api-client/src/index.js":
/*!*************************************************!*\
  !*** ./node_modules/gw2api-client/src/index.js ***!
  \*************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const Client = __webpack_require__(/*! ./client */ "./node_modules/gw2api-client/src/client.js")

// Each time the api wrapper is called, we give back a new instance
module.exports = function () {
  return new Client()
}


/***/ }),

/***/ "./node_modules/idb-keyval/dist/idb-keyval.mjs":
/*!*****************************************************!*\
  !*** ./node_modules/idb-keyval/dist/idb-keyval.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Store: () => (/* binding */ Store),
/* harmony export */   clear: () => (/* binding */ clear),
/* harmony export */   del: () => (/* binding */ del),
/* harmony export */   get: () => (/* binding */ get),
/* harmony export */   keys: () => (/* binding */ keys),
/* harmony export */   set: () => (/* binding */ set)
/* harmony export */ });
class Store {
    constructor(dbName = 'keyval-store', storeName = 'keyval') {
        this.storeName = storeName;
        this._dbp = new Promise((resolve, reject) => {
            const openreq = indexedDB.open(dbName, 1);
            openreq.onerror = () => reject(openreq.error);
            openreq.onsuccess = () => resolve(openreq.result);
            // First time setup: create an empty object store
            openreq.onupgradeneeded = () => {
                openreq.result.createObjectStore(storeName);
            };
        });
    }
    _withIDBStore(type, callback) {
        return this._dbp.then(db => new Promise((resolve, reject) => {
            const transaction = db.transaction(this.storeName, type);
            transaction.oncomplete = () => resolve();
            transaction.onabort = transaction.onerror = () => reject(transaction.error);
            callback(transaction.objectStore(this.storeName));
        }));
    }
}
let store;
function getDefaultStore() {
    if (!store)
        store = new Store();
    return store;
}
function get(key, store = getDefaultStore()) {
    let req;
    return store._withIDBStore('readonly', store => {
        req = store.get(key);
    }).then(() => req.result);
}
function set(key, value, store = getDefaultStore()) {
    return store._withIDBStore('readwrite', store => {
        store.put(value, key);
    });
}
function del(key, store = getDefaultStore()) {
    return store._withIDBStore('readwrite', store => {
        store.delete(key);
    });
}
function clear(store = getDefaultStore()) {
    return store._withIDBStore('readwrite', store => {
        store.clear();
    });
}
function keys(store = getDefaultStore()) {
    const keys = [];
    return store._withIDBStore('readonly', store => {
        // This would be store.getAllKeys(), but it isn't supported by Edge or Safari.
        // And openKeyCursor isn't supported by Safari.
        (store.openKeyCursor || store.openCursor).call(store).onsuccess = function () {
            if (!this.result)
                return;
            keys.push(this.result.key);
            this.result.continue();
        };
    }).then(() => keys);
}




/***/ }),

/***/ "./node_modules/lets-fetch/src/flow.js":
/*!*********************************************!*\
  !*** ./node_modules/lets-fetch/src/flow.js ***!
  \*********************************************/
/***/ ((module) => {

async function series (array) {
  let results = []

  for (let i = 0; i !== array.length; i++) {
    results.push(await array[i]())
  }

  return results
}

function parallel (array) {
  return Promise.all(array.map(func => func()))
}

module.exports = {
  series,
  parallel
}


/***/ }),

/***/ "./node_modules/lets-fetch/src/index.js":
/*!**********************************************!*\
  !*** ./node_modules/lets-fetch/src/index.js ***!
  \**********************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

const fetch = __webpack_require__(/*! cross-fetch */ "./node_modules/cross-fetch/dist/browser-ponyfill.js")
const flow = __webpack_require__(/*! ./flow.js */ "./node_modules/lets-fetch/src/flow.js")

const defaultOptions = {
  type: 'json',
  method: 'GET',
  headers: {},
  body: undefined
}

let internalRetry = () => false
let internalRetryWait = () => false

// istanbul ignore next
let internalLogger = () => false

module.exports = { retry, retryWait, logger, single, many }

// Set a custom decider function that decides to retry
// based on the number of tries and the previous error
function retry (decider) {
  internalRetry = decider
}

// Set a custom function that sets how long we should
// sleep between each failed request
function retryWait (callback) {
  internalRetryWait = callback
}

// Set a custom function that logs out information about each request
function logger (callback) {
  internalLogger = callback
}

// Request a single url
function single (url, options = {}) {
  let tries = 1

  // Execute the request and retry if there are errors (and the
  // retry decider decided that we should try our luck again)
  const callRequest = () => {
    let start = new Date()

    return request(url, options)
      .then((data) => {
        internalLogger({ url, duration: new Date() - start, status: 200, retries: tries - 1 })

        return data
      })
      .catch(err => {
        internalLogger({ url, duration: new Date() - start, status: err && err.response && err.response.status, retries: tries - 1 })

        if (internalRetry(++tries, err)) {
          return wait(callRequest, internalRetryWait(tries))
        }

        throw err
      })
  }

  return callRequest()
}

// Send a request using the underlying fetch API
function request (url, options) {
  options = Object.assign({}, defaultOptions, options)
  let savedContent
  let savedResponse

  return new Promise((resolve, reject) => {
    fetch(url, options)
      .then(handleResponse)
      .then(handleBody)
      .catch(handleError)

    function handleResponse (response) {
      // Save the response for checking the status later
      savedResponse = response

      // Decode the response body
      switch (options.type) {
        case 'response':
          return response
        case 'json':
          return response.json()
        default:
          return response.text()
      }
    }

    function handleBody (content) {
      // Bubble an error if the response status is not okay
      if (savedResponse && savedResponse.status >= 400) {
        savedContent = content
        throw new Error(`Response status indicates error`)
      }

      // All is well!
      resolve(content)
    }

    function handleError (err) {
      // Overwrite potential decoding errors when the actual problem was the response
      if (savedResponse && savedResponse.status >= 400) {
        err = new Error(`Status ${savedResponse.status}`)
      }

      // Enrich the error message with the response and the content
      let error = new Error(err.message)
      error.response = savedResponse
      error.content = savedContent
      reject(error)
    }
  })
}

// Request multiple pages
function many (urls, options = {}) {
  let flowMethod = (options.waitTime) ? flow.series : flow.parallel

  // Call the single method while respecting the wait time in between tasks
  const callSingle = (url) => single(url, options)
    .then(content => wait(() => content, options.waitTime))

  // Map over the urls and call them using the method the user chose
  let promises = urls.map(url => () => callSingle(url))
  return flowMethod(promises)
}

// Wait a specific time before executing a callback
function wait (callback, ms) {
  return new Promise(resolve => {
    setTimeout(() => resolve(callback()), ms || 0)
  })
}


/***/ }),

/***/ "./node_modules/querystringify/index.js":
/*!**********************************************!*\
  !*** ./node_modules/querystringify/index.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, exports) => {

"use strict";


var has = Object.prototype.hasOwnProperty
  , undef;

/**
 * Decode a URI encoded string.
 *
 * @param {String} input The URI encoded string.
 * @returns {String|Null} The decoded string.
 * @api private
 */
function decode(input) {
  try {
    return decodeURIComponent(input.replace(/\+/g, ' '));
  } catch (e) {
    return null;
  }
}

/**
 * Attempts to encode a given input.
 *
 * @param {String} input The string that needs to be encoded.
 * @returns {String|Null} The encoded string.
 * @api private
 */
function encode(input) {
  try {
    return encodeURIComponent(input);
  } catch (e) {
    return null;
  }
}

/**
 * Simple query string parser.
 *
 * @param {String} query The query string that needs to be parsed.
 * @returns {Object}
 * @api public
 */
function querystring(query) {
  var parser = /([^=?#&]+)=?([^&]*)/g
    , result = {}
    , part;

  while (part = parser.exec(query)) {
    var key = decode(part[1])
      , value = decode(part[2]);

    //
    // Prevent overriding of existing properties. This ensures that build-in
    // methods like `toString` or __proto__ are not overriden by malicious
    // querystrings.
    //
    // In the case if failed decoding, we want to omit the key/value pairs
    // from the result.
    //
    if (key === null || value === null || key in result) continue;
    result[key] = value;
  }

  return result;
}

/**
 * Transform a query string to an object.
 *
 * @param {Object} obj Object that should be transformed.
 * @param {String} prefix Optional prefix.
 * @returns {String}
 * @api public
 */
function querystringify(obj, prefix) {
  prefix = prefix || '';

  var pairs = []
    , value
    , key;

  //
  // Optionally prefix with a '?' if needed
  //
  if ('string' !== typeof prefix) prefix = '?';

  for (key in obj) {
    if (has.call(obj, key)) {
      value = obj[key];

      //
      // Edge cases where we actually want to encode the value to an empty
      // string instead of the stringified value.
      //
      if (!value && (value === null || value === undef || isNaN(value))) {
        value = '';
      }

      key = encode(key);
      value = encode(value);

      //
      // If we failed to encode the strings, we should bail out as we don't
      // want to add invalid strings to the query.
      //
      if (key === null || value === null) continue;
      pairs.push(key +'='+ value);
    }
  }

  return pairs.length ? prefix + pairs.join('&') : '';
}

//
// Expose the module.
//
exports.stringify = querystringify;
exports.parse = querystring;


/***/ }),

/***/ "./node_modules/tabulator-tables/dist/js/tabulator_esm.mjs":
/*!*****************************************************************!*\
  !*** ./node_modules/tabulator-tables/dist/js/tabulator_esm.mjs ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AccessorModule: () => (/* binding */ Accessor),
/* harmony export */   AjaxModule: () => (/* binding */ Ajax),
/* harmony export */   CalcComponent: () => (/* binding */ CalcComponent),
/* harmony export */   CellComponent: () => (/* binding */ CellComponent),
/* harmony export */   ClipboardModule: () => (/* binding */ Clipboard),
/* harmony export */   ColumnCalcsModule: () => (/* binding */ ColumnCalcs),
/* harmony export */   ColumnComponent: () => (/* binding */ ColumnComponent),
/* harmony export */   DataTreeModule: () => (/* binding */ DataTree),
/* harmony export */   DownloadModule: () => (/* binding */ Download),
/* harmony export */   EditModule: () => (/* binding */ Edit),
/* harmony export */   ExportModule: () => (/* binding */ Export),
/* harmony export */   FilterModule: () => (/* binding */ Filter),
/* harmony export */   FormatModule: () => (/* binding */ Format),
/* harmony export */   FrozenColumnsModule: () => (/* binding */ FrozenColumns),
/* harmony export */   FrozenRowsModule: () => (/* binding */ FrozenRows),
/* harmony export */   GroupComponent: () => (/* binding */ GroupComponent),
/* harmony export */   GroupRowsModule: () => (/* binding */ GroupRows),
/* harmony export */   HistoryModule: () => (/* binding */ History),
/* harmony export */   HtmlTableImportModule: () => (/* binding */ HtmlTableImport),
/* harmony export */   ImportModule: () => (/* binding */ Import),
/* harmony export */   InteractionModule: () => (/* binding */ Interaction),
/* harmony export */   KeybindingsModule: () => (/* binding */ Keybindings),
/* harmony export */   MenuModule: () => (/* binding */ Menu),
/* harmony export */   Module: () => (/* binding */ Module),
/* harmony export */   MoveColumnsModule: () => (/* binding */ MoveColumns),
/* harmony export */   MoveRowsModule: () => (/* binding */ MoveRows),
/* harmony export */   MutatorModule: () => (/* binding */ Mutator),
/* harmony export */   PageModule: () => (/* binding */ Page),
/* harmony export */   PersistenceModule: () => (/* binding */ Persistence),
/* harmony export */   PopupModule: () => (/* binding */ Popup),
/* harmony export */   PrintModule: () => (/* binding */ Print),
/* harmony export */   PseudoRow: () => (/* binding */ PseudoRow),
/* harmony export */   RangeComponent: () => (/* binding */ RangeComponent),
/* harmony export */   ReactiveDataModule: () => (/* binding */ ReactiveData),
/* harmony export */   Renderer: () => (/* binding */ Renderer),
/* harmony export */   ResizeColumnsModule: () => (/* binding */ ResizeColumns),
/* harmony export */   ResizeRowsModule: () => (/* binding */ ResizeRows),
/* harmony export */   ResizeTableModule: () => (/* binding */ ResizeTable),
/* harmony export */   ResponsiveLayoutModule: () => (/* binding */ ResponsiveLayout),
/* harmony export */   RowComponent: () => (/* binding */ RowComponent),
/* harmony export */   SelectRangeModule: () => (/* binding */ SelectRange),
/* harmony export */   SelectRowModule: () => (/* binding */ SelectRow),
/* harmony export */   SheetComponent: () => (/* binding */ SheetComponent),
/* harmony export */   SortModule: () => (/* binding */ Sort),
/* harmony export */   SpreadsheetModule: () => (/* binding */ Spreadsheet),
/* harmony export */   Tabulator: () => (/* binding */ Tabulator$1),
/* harmony export */   TabulatorFull: () => (/* binding */ TabulatorFull$1),
/* harmony export */   TooltipModule: () => (/* binding */ Tooltip),
/* harmony export */   ValidateModule: () => (/* binding */ Validate)
/* harmony export */ });
/* Tabulator v6.3.1 (c) Oliver Folkerd 2025 */
class CoreFeature{

	constructor(table){
		this.table = table;
	}

	//////////////////////////////////////////
	/////////////// DataLoad /////////////////
	//////////////////////////////////////////

	reloadData(data, silent, columnsChanged){
		return this.table.dataLoader.load(data, undefined, undefined, undefined, silent, columnsChanged);
	}

	//////////////////////////////////////////
	///////////// Localization ///////////////
	//////////////////////////////////////////

	langText(){
		return this.table.modules.localize.getText(...arguments);
	}

	langBind(){
		return this.table.modules.localize.bind(...arguments);
	}

	langLocale(){
		return this.table.modules.localize.getLocale(...arguments);
	}


	//////////////////////////////////////////
	////////// Inter Table Comms /////////////
	//////////////////////////////////////////

	commsConnections(){
		return this.table.modules.comms.getConnections(...arguments);
	}

	commsSend(){
		return this.table.modules.comms.send(...arguments);
	}

	//////////////////////////////////////////
	//////////////// Layout  /////////////////
	//////////////////////////////////////////

	layoutMode(){
		return this.table.modules.layout.getMode();
	}

	layoutRefresh(force){
		return this.table.modules.layout.layout(force);
	}


	//////////////////////////////////////////
	/////////////// Event Bus ////////////////
	//////////////////////////////////////////

	subscribe(){
		return this.table.eventBus.subscribe(...arguments);
	}

	unsubscribe(){
		return this.table.eventBus.unsubscribe(...arguments);
	}

	subscribed(key){
		return this.table.eventBus.subscribed(key);
	}

	subscriptionChange(){
		return this.table.eventBus.subscriptionChange(...arguments);
	}

	dispatch(){
		return this.table.eventBus.dispatch(...arguments);
	}

	chain(){
		return this.table.eventBus.chain(...arguments);
	}

	confirm(){
		return this.table.eventBus.confirm(...arguments);
	}

	dispatchExternal(){
		return this.table.externalEvents.dispatch(...arguments);
	}

	subscribedExternal(key){
		return this.table.externalEvents.subscribed(key);
	}

	subscriptionChangeExternal(){
		return this.table.externalEvents.subscriptionChange(...arguments);
	}

	//////////////////////////////////////////
	//////////////// Options /////////////////
	//////////////////////////////////////////

	options(key){
		return this.table.options[key];
	}

	setOption(key, value){
		if(typeof value !== "undefined"){
			this.table.options[key] = value;
		}

		return this.table.options[key];
	}

	//////////////////////////////////////////
	/////////// Deprecation Checks ///////////
	//////////////////////////////////////////

	deprecationCheck(oldOption, newOption,  convert){
		return this.table.deprecationAdvisor.check(oldOption, newOption,  convert);
	}

	deprecationCheckMsg(oldOption, msg){
		return this.table.deprecationAdvisor.checkMsg(oldOption, msg);
	}

	deprecationMsg(msg){
		return this.table.deprecationAdvisor.msg(msg);
	}
	//////////////////////////////////////////
	//////////////// Modules /////////////////
	//////////////////////////////////////////

	module(key){
		return this.table.module(key);
	}
}

class Helpers{

	static elVisible(el){
		return !(el.offsetWidth <= 0 && el.offsetHeight <= 0);
	}

	static elOffset(el){
		var box = el.getBoundingClientRect();

		return {
			top: box.top + window.pageYOffset - document.documentElement.clientTop,
			left: box.left + window.pageXOffset - document.documentElement.clientLeft
		};
	}

	static retrieveNestedData(separator, field, data){
		var structure = separator ? field.split(separator) : [field],
		length = structure.length,
		output;

		for(let i = 0; i < length; i++){

			data = data[structure[i]];

			output = data;

			if(!data){
				break;
			}
		}

		return output;
	}

	static deepClone(obj, clone, list = []){
		var objectProto = {}.__proto__,
		arrayProto = [].__proto__;

		if (!clone){
			clone = Object.assign(Array.isArray(obj) ? [] : {}, obj);
		}

		for(var i in obj) {
			let subject = obj[i],
			match, copy;

			if(subject != null && typeof subject === "object" && (subject.__proto__ === objectProto || subject.__proto__ === arrayProto)){
				match = list.findIndex((item) => {
					return item.subject === subject;
				});

				if(match > -1){
					clone[i] = list[match].copy;
				}else {
					copy = Object.assign(Array.isArray(subject) ? [] : {}, subject);

					list.unshift({subject, copy});

					clone[i] = this.deepClone(subject, copy, list);
				}
			}
		}

		return clone;
	}
}

let Popup$1 = class Popup extends CoreFeature{
	constructor(table, element, parent){
		super(table);
		
		this.element = element;
		this.container = this._lookupContainer();
		
		this.parent = parent;
		
		this.reversedX = false;
		this.childPopup = null;
		this.blurable = false;
		this.blurCallback = null;
		this.blurEventsBound = false;
		this.renderedCallback = null;
		
		this.visible = false;
		this.hideable = true;
		
		this.element.classList.add("tabulator-popup-container");
		
		this.blurEvent = this.hide.bind(this, false);
		this.escEvent = this._escapeCheck.bind(this);
		
		this.destroyBinding = this.tableDestroyed.bind(this);
		this.destroyed = false;
	}
	
	tableDestroyed(){
		this.destroyed = true;
		this.hide(true);
	}
	
	_lookupContainer(){
		var container = this.table.options.popupContainer;
		
		if(typeof container === "string"){
			container = document.querySelector(container);
			
			if(!container){
				console.warn("Menu Error - no container element found matching selector:",  this.table.options.popupContainer , "(defaulting to document body)");
			}
		}else if (container === true){
			container = this.table.element;
		}
		
		if(container && !this._checkContainerIsParent(container)){
			container = false;
			console.warn("Menu Error - container element does not contain this table:",  this.table.options.popupContainer , "(defaulting to document body)");
		}
		
		if(!container){
			container = document.body;
		}
		
		return container;
	}
	
	_checkContainerIsParent(container, element = this.table.element){
		if(container === element){
			return true;
		}else {
			return element.parentNode ? this._checkContainerIsParent(container, element.parentNode) : false;
		}
	}
	
	renderCallback(callback){
		this.renderedCallback = callback;
	}
	
	containerEventCoords(e){
		var touch = !(e instanceof MouseEvent);
		
		var x = touch ? e.touches[0].pageX : e.pageX;
		var y = touch ? e.touches[0].pageY : e.pageY;
		
		if(this.container !== document.body){
			let parentOffset = Helpers.elOffset(this.container);
			
			x -= parentOffset.left;
			y -= parentOffset.top;
		}
		
		return {x, y};
	}
	
	elementPositionCoords(element, position = "right"){
		var offset = Helpers.elOffset(element),
		containerOffset, x, y;
		
		if(this.container !== document.body){
			containerOffset = Helpers.elOffset(this.container);
			
			offset.left -= containerOffset.left;
			offset.top -= containerOffset.top;
		}
		
		switch(position){
			case "right":
				x = offset.left + element.offsetWidth;
				y = offset.top - 1;
				break;
			
			case "bottom":
				x = offset.left;
				y = offset.top + element.offsetHeight;
				break;
			
			case "left":
				x = offset.left;
				y = offset.top - 1;
				break;
			
			case "top":
				x = offset.left;
				y = offset.top;
				break;
			
			case "center":
				x = offset.left + (element.offsetWidth / 2);
				y = offset.top + (element.offsetHeight / 2);
				break;
			
		}
		
		return {x, y, offset};
	}
	
	show(origin, position){
		var x, y, parentEl, parentOffset, coords;
		
		if(this.destroyed || this.table.destroyed){
			return this;
		}
		
		if(origin instanceof HTMLElement){
			parentEl = origin;
			coords = this.elementPositionCoords(origin, position);
			
			parentOffset = coords.offset;
			x = coords.x;
			y = coords.y;
			
		}else if(typeof origin === "number"){
			parentOffset = {top:0, left:0};
			x = origin;
			y = position;
		}else {
			coords = this.containerEventCoords(origin);
			
			x = coords.x;
			y = coords.y;
			
			this.reversedX = false;
		}
		
		this.element.style.top = y + "px";
		this.element.style.left = x + "px";
		
		this.container.appendChild(this.element);
		
		if(typeof this.renderedCallback === "function"){
			this.renderedCallback();
		}
		
		this._fitToScreen(x, y, parentEl, parentOffset, position);
		
		this.visible = true;
		
		this.subscribe("table-destroy", this.destroyBinding);
		
		this.element.addEventListener("mousedown", (e) => {
			e.stopPropagation();
		});
		
		return this;
	}
	
	_fitToScreen(x, y, parentEl, parentOffset, position){
		var scrollTop = this.container === document.body ? document.documentElement.scrollTop : this.container.scrollTop;
		
		//move menu to start on right edge if it is too close to the edge of the screen
		if((x + this.element.offsetWidth) >= this.container.offsetWidth || this.reversedX){
			this.element.style.left = "";
			
			if(parentEl){
				this.element.style.right = (this.container.offsetWidth - parentOffset.left) + "px";
			}else {
				this.element.style.right = (this.container.offsetWidth - x) + "px";
			}
			
			this.reversedX = true;
		}
		
		//move menu to start on bottom edge if it is too close to the edge of the screen
		let offsetHeight = Math.max(this.container.offsetHeight, scrollTop ? this.container.scrollHeight : 0);
		if((y + this.element.offsetHeight) > offsetHeight) {
			if(parentEl){
				switch(position){
					case "bottom":
						this.element.style.top = (parseInt(this.element.style.top) - this.element.offsetHeight - parentEl.offsetHeight - 1) + "px";
						break;
					
					default:
						this.element.style.top = (parseInt(this.element.style.top) - this.element.offsetHeight + parentEl.offsetHeight + 1) + "px";
				}
				
			}else {
				this.element.style.height = offsetHeight + "px";
			}
		}
	}
	
	isVisible(){
		return this.visible;
	}
	
	hideOnBlur(callback){
		this.blurable = true;
		
		if(this.visible){
			setTimeout(() => {
				if(this.visible){
					this.table.rowManager.element.addEventListener("scroll", this.blurEvent);
					this.subscribe("cell-editing", this.blurEvent);
					document.body.addEventListener("click", this.blurEvent);
					document.body.addEventListener("contextmenu", this.blurEvent);
					document.body.addEventListener("mousedown", this.blurEvent);
					window.addEventListener("resize", this.blurEvent);
					document.body.addEventListener("keydown", this.escEvent);

					this.blurEventsBound = true;
				}
			}, 100);
			
			this.blurCallback = callback;
		}
		
		return this;
	}
	
	_escapeCheck(e){
		if(e.keyCode == 27){
			this.hide();
		}
	}
	
	blockHide(){
		this.hideable = false;
	}
	
	restoreHide(){
		this.hideable = true;
	}
	
	hide(silent = false){
		if(this.visible && this.hideable){
			if(this.blurable && this.blurEventsBound){
				document.body.removeEventListener("keydown", this.escEvent);
				document.body.removeEventListener("click", this.blurEvent);
				document.body.removeEventListener("contextmenu", this.blurEvent);
				document.body.removeEventListener("mousedown", this.blurEvent);
				window.removeEventListener("resize", this.blurEvent);
				this.table.rowManager.element.removeEventListener("scroll", this.blurEvent);
				this.unsubscribe("cell-editing", this.blurEvent);

				this.blurEventsBound = false;
			}
			
			if(this.childPopup){
				this.childPopup.hide();
			}
			
			if(this.parent){
				this.parent.childPopup = null;
			}
			
			if(this.element.parentNode){
				this.element.parentNode.removeChild(this.element);
			}
			
			this.visible = false;
			
			if(this.blurCallback && !silent){
				this.blurCallback();
			}
			
			this.unsubscribe("table-destroy", this.destroyBinding);
		}
		
		return this;
	}
	
	child(element){
		if(this.childPopup){
			this.childPopup.hide();
		}
		
		this.childPopup = new Popup(this.table, element, this);
		
		return this.childPopup;
	}
};

class Module extends CoreFeature{
	
	constructor(table, name){
		super(table);
		
		this._handler = null;
	}
	
	initialize(){
		// setup module when table is initialized, to be overridden in module
	}
	
	
	///////////////////////////////////
	////// Options Registration ///////
	///////////////////////////////////
	
	registerTableOption(key, value){
		this.table.optionsList.register(key, value);
	}
	
	registerColumnOption(key, value){
		this.table.columnManager.optionsList.register(key, value);
	}
	
	///////////////////////////////////
	/// Public Function Registration ///
	///////////////////////////////////
	
	registerTableFunction(name, func){
		if(typeof this.table[name] === "undefined"){
			this.table[name] = (...args) => {
				this.table.initGuard(name);
				
				return func(...args);
			};
		}else {
			console.warn("Unable to bind table function, name already in use", name);
		}
	}
	
	registerComponentFunction(component, func, handler){
		return this.table.componentFunctionBinder.bind(component, func, handler);
	}
	
	///////////////////////////////////
	////////// Data Pipeline //////////
	///////////////////////////////////
	
	registerDataHandler(handler, priority){
		this.table.rowManager.registerDataPipelineHandler(handler, priority);
		this._handler = handler;
	}
	
	registerDisplayHandler(handler, priority){
		this.table.rowManager.registerDisplayPipelineHandler(handler, priority);
		this._handler = handler;
	}
	
	displayRows(adjust){
		var index = this.table.rowManager.displayRows.length - 1, 
		lookupIndex;
		
		if(this._handler){
			lookupIndex = this.table.rowManager.displayPipeline.findIndex((item) => {
				return item.handler === this._handler;
			});

			if(lookupIndex > -1){
				index = lookupIndex;
			}
		}
		
		if(adjust){
			index = index + adjust;
		}

		if(this._handler){
			if(index > -1){
				return this.table.rowManager.getDisplayRows(index);
			}else {
				return this.activeRows();
			}
		}	
	}
	
	activeRows(){
		return this.table.rowManager.activeRows;
	}
	
	refreshData(renderInPosition, handler){
		if(!handler){
			handler = this._handler;
		}
		
		if(handler){
			this.table.rowManager.refreshActiveData(handler, false, renderInPosition);
		}
	}
	
	///////////////////////////////////
	//////// Footer Management ////////
	///////////////////////////////////
	
	footerAppend(element){
		return this.table.footerManager.append(element);
	}
	
	footerPrepend(element){
		return this.table.footerManager.prepend(element);
	}
	
	footerRemove(element){
		return this.table.footerManager.remove(element);
	} 
	
	///////////////////////////////////
	//////// Popups Management ////////
	///////////////////////////////////
	
	popup(menuEl, menuContainer){
		return new Popup$1(this.table, menuEl, menuContainer);
	}
	
	///////////////////////////////////
	//////// Alert Management ////////
	///////////////////////////////////
	
	alert(content, type){
		return this.table.alertManager.alert(content, type);
	}
	
	clearAlert(){
		return this.table.alertManager.clear();
	}
	
}

var defaultAccessors = {
	rownum:function(value, data, type, params, column, row){
		return row.getPosition();
	}
};

class Accessor extends Module{
	
	static moduleName = "accessor";

	//load defaults
	static accessors = defaultAccessors;

	constructor(table){
		super(table);

		this.allowedTypes = ["", "data", "download", "clipboard", "print", "htmlOutput"]; //list of accessor types

		this.registerColumnOption("accessor");
		this.registerColumnOption("accessorParams");
		this.registerColumnOption("accessorData");
		this.registerColumnOption("accessorDataParams");
		this.registerColumnOption("accessorDownload");
		this.registerColumnOption("accessorDownloadParams");
		this.registerColumnOption("accessorClipboard");
		this.registerColumnOption("accessorClipboardParams");
		this.registerColumnOption("accessorPrint");
		this.registerColumnOption("accessorPrintParams");
		this.registerColumnOption("accessorHtmlOutput");
		this.registerColumnOption("accessorHtmlOutputParams");
	}

	initialize(){
		this.subscribe("column-layout", this.initializeColumn.bind(this));
		this.subscribe("row-data-retrieve", this.transformRow.bind(this));
	}

	//initialize column accessor
	initializeColumn(column){
		var match = false,
		config = {};

		this.allowedTypes.forEach((type) => {
			var key = "accessor" + (type.charAt(0).toUpperCase() + type.slice(1)),
			accessor;

			if(column.definition[key]){
				accessor = this.lookupAccessor(column.definition[key]);

				if(accessor){
					match = true;

					config[key] = {
						accessor:accessor,
						params: column.definition[key + "Params"] || {},
					};
				}
			}
		});

		if(match){
			column.modules.accessor = config;
		}
	}

	lookupAccessor(value){
		var accessor = false;

		//set column accessor
		switch(typeof value){
			case "string":
				if(Accessor.accessors[value]){
					accessor = Accessor.accessors[value];
				}else {
					console.warn("Accessor Error - No such accessor found, ignoring: ", value);
				}
				break;

			case "function":
				accessor = value;
				break;
		}

		return accessor;
	}

	//apply accessor to row
	transformRow(row, type){
		var key = "accessor" + (type.charAt(0).toUpperCase() + type.slice(1)),
		rowComponent = row.getComponent();

		//clone data object with deep copy to isolate internal data from returned result
		var data = Helpers.deepClone(row.data || {});

		this.table.columnManager.traverse(function(column){
			var value, accessor, params, colComponent;

			if(column.modules.accessor){

				accessor = column.modules.accessor[key] || column.modules.accessor.accessor || false;

				if(accessor){
					value = column.getFieldValue(data);

					if(value != "undefined"){
						colComponent = column.getComponent();
						params = typeof accessor.params === "function" ? accessor.params(value, data, type, colComponent, rowComponent) : accessor.params;
						column.setFieldValue(data, accessor.accessor(value, data, type, params, colComponent, rowComponent));
					}
				}
			}
		});

		return data;
	}
}

var defaultConfig = {
	method: "GET",
};

function generateParamsList$1(data, prefix){
	var output = [];

	prefix = prefix || "";

	if(Array.isArray(data)){
		data.forEach((item, i) => {
			output = output.concat(generateParamsList$1(item, prefix ? prefix + "[" + i + "]" : i));
		});
	}else if (typeof data === "object"){
		for (var key in data){
			output = output.concat(generateParamsList$1(data[key], prefix ? prefix + "[" + key + "]" : key));
		}
	}else {
		output.push({key:prefix, value:data});
	}

	return output;
}

function serializeParams(params){
	var output = generateParamsList$1(params),
	encoded = [];

	output.forEach(function(item){
		encoded.push(encodeURIComponent(item.key) + "=" + encodeURIComponent(item.value));
	});

	return encoded.join("&");
}

function urlBuilder(url, config, params){
	if(url){
		if(params && Object.keys(params).length){
			if(!config.method || config.method.toLowerCase() == "get"){
				config.method = "get";

				url += (url.includes("?") ? "&" : "?") + serializeParams(params);
			}
		}
	}

	return url;
}

function defaultLoaderPromise(url, config, params){
	var contentType;

	return new Promise((resolve, reject) => {
		//set url
		url = this.urlGenerator.call(this.table, url, config, params);

		//set body content if not GET request
		if(config.method.toUpperCase() != "GET"){
			contentType = typeof this.table.options.ajaxContentType === "object" ?  this.table.options.ajaxContentType : this.contentTypeFormatters[this.table.options.ajaxContentType];
			if(contentType){

				for(var key in contentType.headers){
					if(!config.headers){
						config.headers = {};
					}

					if(typeof config.headers[key] === "undefined"){
						config.headers[key] = contentType.headers[key];
					}
				}

				config.body = contentType.body.call(this, url, config, params);

			}else {
				console.warn("Ajax Error - Invalid ajaxContentType value:", this.table.options.ajaxContentType);
			}
		}

		if(url){
			//configure headers
			if(typeof config.headers === "undefined"){
				config.headers = {};
			}

			if(typeof config.headers.Accept === "undefined"){
				config.headers.Accept = "application/json";
			}

			if(typeof config.headers["X-Requested-With"] === "undefined"){
				config.headers["X-Requested-With"] = "XMLHttpRequest";
			}

			if(typeof config.mode === "undefined"){
				config.mode = "cors";
			}

			if(config.mode == "cors"){
				if(typeof config.headers["Origin"] === "undefined"){
					config.headers["Origin"] = window.location.origin;
				}
        
				if(typeof config.credentials === "undefined"){
					config.credentials = 'same-origin';
				}
			}else {
				if(typeof config.credentials === "undefined"){
					config.credentials = 'include';
				}
			}

			//send request
			fetch(url, config)
				.then((response)=>{
					if(response.ok) {
						response.json()
							.then((data)=>{
								resolve(data);
							}).catch((error)=>{
								reject(error);
								console.warn("Ajax Load Error - Invalid JSON returned", error);
							});
					}else {
						console.error("Ajax Load Error - Connection Error: " + response.status, response.statusText);
						reject(response);
					}
				})
				.catch((error)=>{
					console.error("Ajax Load Error - Connection Error: ", error);
					reject(error);
				});
		}else {
			console.warn("Ajax Load Error - No URL Set");
			resolve([]);
		}
	});
}

function generateParamsList(data, prefix){
	var output = [];

	prefix = prefix || "";

	if(Array.isArray(data)){
		data.forEach((item, i) => {
			output = output.concat(generateParamsList(item, prefix ? prefix + "[" + i + "]" : i));
		});
	}else if (typeof data === "object"){
		for (var key in data){
			output = output.concat(generateParamsList(data[key], prefix ? prefix + "[" + key + "]" : key));
		}
	}else {
		output.push({key:prefix, value:data});
	}

	return output;
}

var defaultContentTypeFormatters = {
	"json":{
		headers:{
			'Content-Type': 'application/json',
		},
		body:function(url, config, params){
			return JSON.stringify(params);
		},
	},
	"form":{
		headers:{
		},
		body:function(url, config, params){

			var output = generateParamsList(params),
			form = new FormData();

			output.forEach(function(item){
				form.append(item.key, item.value);
			});

			return form;
		},
	},
};

class Ajax extends Module{

	static moduleName = "ajax";

	//load defaults
	static defaultConfig = defaultConfig;
	static defaultURLGenerator = urlBuilder;
	static defaultLoaderPromise = defaultLoaderPromise;
	static contentTypeFormatters = defaultContentTypeFormatters;
	
	constructor(table){
		super(table);
		
		this.config = {}; //hold config object for ajax request
		this.url = ""; //request URL
		this.urlGenerator = false;
		this.params = false; //request parameters
		
		this.loaderPromise = false;
		
		this.registerTableOption("ajaxURL", false); //url for ajax loading
		this.registerTableOption("ajaxURLGenerator", false);
		this.registerTableOption("ajaxParams", {});  //params for ajax loading
		this.registerTableOption("ajaxConfig", "get"); //ajax request type
		this.registerTableOption("ajaxContentType", "form"); //ajax request type
		this.registerTableOption("ajaxRequestFunc", false); //promise function
		
		this.registerTableOption("ajaxRequesting", function(){});
		this.registerTableOption("ajaxResponse", false);
		
		this.contentTypeFormatters = Ajax.contentTypeFormatters;
	}
	
	//initialize setup options
	initialize(){
		this.loaderPromise = this.table.options.ajaxRequestFunc || Ajax.defaultLoaderPromise;
		this.urlGenerator = this.table.options.ajaxURLGenerator || Ajax.defaultURLGenerator;
		
		if(this.table.options.ajaxURL){
			this.setUrl(this.table.options.ajaxURL);
		}


		this.setDefaultConfig(this.table.options.ajaxConfig);
		
		this.registerTableFunction("getAjaxUrl", this.getUrl.bind(this));
		
		this.subscribe("data-loading", this.requestDataCheck.bind(this));
		this.subscribe("data-params", this.requestParams.bind(this));
		this.subscribe("data-load", this.requestData.bind(this));
	}
	
	requestParams(data, config, silent, params){
		var ajaxParams = this.table.options.ajaxParams;
		
		if(ajaxParams){
			if(typeof ajaxParams === "function"){
				ajaxParams = ajaxParams.call(this.table);
			}
			
			params = Object.assign(Object.assign({}, ajaxParams), params);
		}		
		
		return params;
	}
	
	requestDataCheck(data, params, config, silent){
		return !!((!data && this.url) || typeof data === "string");
	}
	
	requestData(url, params, config, silent, previousData){
		var ajaxConfig;
		
		if(!previousData && this.requestDataCheck(url)){
			if(url){
				this.setUrl(url);
			}
			
			ajaxConfig = this.generateConfig(config);
			
			return this.sendRequest(this.url, params, ajaxConfig);
		}else {
			return previousData;
		}
	}
	
	setDefaultConfig(config = {}){
		this.config = Object.assign({}, Ajax.defaultConfig);

		if(typeof config == "string"){
			this.config.method = config;
		}else {
			Object.assign(this.config, config);
		}
	}
	
	//load config object
	generateConfig(config = {}){
		var ajaxConfig = Object.assign({}, this.config);
		
		if(typeof config == "string"){
			ajaxConfig.method = config;
		}else {
			Object.assign(ajaxConfig, config);
		}
		
		return ajaxConfig;
	}
	
	//set request url
	setUrl(url){
		this.url = url;
	}
	
	//get request url
	getUrl(){
		return this.url;
	}
	
	//send ajax request
	sendRequest(url, params, config){
		if(this.table.options.ajaxRequesting.call(this.table, url, params) !== false){
			return this.loaderPromise(url, config, params)
				.then((data)=>{
					if(this.table.options.ajaxResponse){
						data = this.table.options.ajaxResponse.call(this.table, url, params, data);
					}
				
					return data;
				});
		}else {
			return Promise.reject();
		}
	}
}

var defaultPasteActions = {
	replace:function(data){
		return this.table.setData(data);
	},
	update:function(data){
		return this.table.updateOrAddData(data);
	},
	insert:function(data){
		return this.table.addData(data);
	},
};

var defaultPasteParsers = {
	table:function(clipboard){
		var data = [],
		headerFindSuccess = true,
		columns = this.table.columnManager.columns,
		columnMap = [],
		rows = [];
		
		//get data from clipboard into array of columns and rows.
		clipboard = clipboard.split("\n");
		
		clipboard.forEach(function(row){
			data.push(row.split("\t"));
		});
		
		if(data.length && !(data.length === 1 && data[0].length < 2)){
			
			//check if headers are present by title
			data[0].forEach(function(value){
				var column = columns.find(function(column){
					return value && column.definition.title && value.trim() && column.definition.title.trim() === value.trim();
				});
				
				if(column){
					columnMap.push(column);
				}else {
					headerFindSuccess = false;
				}
			});
			
			//check if column headers are present by field
			if(!headerFindSuccess){
				headerFindSuccess = true;
				columnMap = [];
				
				data[0].forEach(function(value){
					var column = columns.find(function(column){
						return value && column.field && value.trim() && column.field.trim() === value.trim();
					});
					
					if(column){
						columnMap.push(column);
					}else {
						headerFindSuccess = false;
					}
				});
				
				if(!headerFindSuccess){
					columnMap = this.table.columnManager.columnsByIndex;
				}
			}
			
			//remove header row if found
			if(headerFindSuccess){
				data.shift();
			}
			
			data.forEach(function(item){
				var row = {};
				
				item.forEach(function(value, i){
					if(columnMap[i]){
						row[columnMap[i].field] = value;
					}
				});
				
				rows.push(row);
			});
			
			return rows;
		}else {
			return false;
		}
	},
};

var bindings$2 = {
	copyToClipboard:["ctrl + 67", "meta + 67"],
};

var actions$2 = {
	copyToClipboard:function(e){
		if(!this.table.modules.edit.currentCell){
			if(this.table.modExists("clipboard", true)){
				this.table.modules.clipboard.copy(false, true);
			}
		}
	},
};

var extensions$4 = {
	keybindings:{
		bindings:bindings$2,
		actions:actions$2
	},
};

class Clipboard extends Module{

	static moduleName = "clipboard";
	static moduleExtensions = extensions$4;

	//load defaults
	static pasteActions = defaultPasteActions;
	static pasteParsers = defaultPasteParsers;

	constructor(table){
		super(table);

		this.mode = true;
		this.pasteParser = function(){};
		this.pasteAction = function(){};
		this.customSelection = false;
		this.rowRange = false;
		this.blocked = true; //block copy actions not originating from this command

		this.registerTableOption("clipboard", false); //enable clipboard
		this.registerTableOption("clipboardCopyStyled", true); //formatted table data
		this.registerTableOption("clipboardCopyConfig", false); //clipboard config
		this.registerTableOption("clipboardCopyFormatter", false); //DEPRECATED - REMOVE in 5.0
		this.registerTableOption("clipboardCopyRowRange", "active"); //restrict clipboard to visible rows only
		this.registerTableOption("clipboardPasteParser", "table"); //convert pasted clipboard data to rows
		this.registerTableOption("clipboardPasteAction", "insert"); //how to insert pasted data into the table

		this.registerColumnOption("clipboard");
		this.registerColumnOption("titleClipboard");
	}

	initialize(){
		this.mode = this.table.options.clipboard;

		this.rowRange = this.table.options.clipboardCopyRowRange;

		if(this.mode === true || this.mode === "copy"){
			this.table.element.addEventListener("copy", (e) => {
				var plain, html, list;

				if(!this.blocked){
					e.preventDefault();

					if(this.customSelection){
						plain = this.customSelection;

						if(this.table.options.clipboardCopyFormatter){
							plain = this.table.options.clipboardCopyFormatter("plain", plain);
						}
					}else {

						list = this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig, this.table.options.clipboardCopyStyled, this.rowRange, "clipboard");

						html = this.table.modules.export.generateHTMLTable(list);
						plain = html ? this.generatePlainContent(list) : "";

						if(this.table.options.clipboardCopyFormatter){
							plain = this.table.options.clipboardCopyFormatter("plain", plain);
							html = this.table.options.clipboardCopyFormatter("html", html);
						}
					}

					if (window.clipboardData && window.clipboardData.setData) {
						window.clipboardData.setData('Text', plain);
					} else if (e.clipboardData && e.clipboardData.setData) {
						e.clipboardData.setData('text/plain', plain);
						if(html){
							e.clipboardData.setData('text/html', html);
						}
					} else if (e.originalEvent && e.originalEvent.clipboardData.setData) {
						e.originalEvent.clipboardData.setData('text/plain', plain);
						if(html){
							e.originalEvent.clipboardData.setData('text/html', html);
						}
					}

					this.dispatchExternal("clipboardCopied", plain, html);

					this.reset();
				}
			});
		}

		if(this.mode === true || this.mode === "paste"){
			this.table.element.addEventListener("paste", (e) => {
				this.paste(e);
			});
		}

		this.setPasteParser(this.table.options.clipboardPasteParser);
		this.setPasteAction(this.table.options.clipboardPasteAction);

		this.registerTableFunction("copyToClipboard", this.copy.bind(this));
	}

	reset(){
		this.blocked = true;
		this.customSelection = false;
	}

	generatePlainContent (list) {
		var output = [];

		list.forEach((row) => {
			var rowData = [];

			row.columns.forEach((col) => {
				var value = "";

				if(col){

					if(row.type === "group"){
						col.value = col.component.getKey();
					}

					if(col.value === null){
						value = "";
					}else {
						switch(typeof col.value){
							case "object":
								value = JSON.stringify(col.value);
								break;

							case "undefined":
								value = "";
								break;

							default:
								value = col.value;
						}
					}
				}

				rowData.push(value);
			});

			output.push(rowData.join("\t"));
		});

		return output.join("\n");
	}

	copy (range, internal) {
		var sel, textRange;
		this.blocked = false;
		this.customSelection = false;
	

		if (this.mode === true || this.mode === "copy") {

			this.rowRange = range || this.table.options.clipboardCopyRowRange;

			if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
				range = document.createRange();
				range.selectNodeContents(this.table.element);
				sel = window.getSelection();

				if (sel.toString() && internal) {
					this.customSelection = sel.toString();
				}

				sel.removeAllRanges();
				sel.addRange(range);
			} else if (typeof document.selection != "undefined" && typeof document.body.createTextRange != "undefined") {
				textRange = document.body.createTextRange();
				textRange.moveToElementText(this.table.element);
				textRange.select();
			}

			document.execCommand('copy');

			if (sel) {
				sel.removeAllRanges();
			}
		}
	}

	//PASTE EVENT HANDLING
	setPasteAction(action){

		switch(typeof action){
			case "string":
				this.pasteAction = Clipboard.pasteActions[action];

				if(!this.pasteAction){
					console.warn("Clipboard Error - No such paste action found:", action);
				}
				break;

			case "function":
				this.pasteAction = action;
				break;
		}
	}

	setPasteParser(parser){
		switch(typeof parser){
			case "string":
				this.pasteParser = Clipboard.pasteParsers[parser];

				if(!this.pasteParser){
					console.warn("Clipboard Error - No such paste parser found:", parser);
				}
				break;

			case "function":
				this.pasteParser = parser;
				break;
		}
	}

	paste(e){
		var data, rowData, rows;

		if(this.checkPasteOrigin(e)){

			data = this.getPasteData(e);

			rowData = this.pasteParser.call(this, data);

			if(rowData){
				e.preventDefault();

				if(this.table.modExists("mutator")){
					rowData = this.mutateData(rowData);
				}

				rows = this.pasteAction.call(this, rowData);

				this.dispatchExternal("clipboardPasted", data, rowData, rows);
			}else {
				this.dispatchExternal("clipboardPasteError", data);
			}
		}
	}

	mutateData(data){
		var output = [];

		if(Array.isArray(data)){
			data.forEach((row) => {
				output.push(this.table.modules.mutator.transformRow(row, "clipboard"));
			});
		}else {
			output = data;
		}

		return output;
	}


	checkPasteOrigin(e){
		var valid = true;
		var blocked = this.confirm("clipboard-paste", [e]);

		if(blocked || !["DIV", "SPAN"].includes(e.target.tagName)){
			valid = false;
		}

		return valid;
	}

	getPasteData(e){
		var data;

		if (window.clipboardData && window.clipboardData.getData) {
			data = window.clipboardData.getData('Text');
		} else if (e.clipboardData && e.clipboardData.getData) {
			data = e.clipboardData.getData('text/plain');
		} else if (e.originalEvent && e.originalEvent.clipboardData.getData) {
			data = e.originalEvent.clipboardData.getData('text/plain');
		}

		return data;
	}
}

class CalcComponent{
	constructor (row){
		this._row = row;

		return new Proxy(this, {
			get: function(target, name, receiver) {
				if (typeof target[name] !== "undefined") {
					return target[name];
				}else {
					return target._row.table.componentFunctionBinder.handle("row", target._row, name);
				}
			}
		});
	}

	getData(transform){
		return this._row.getData(transform);
	}

	getElement(){
		return this._row.getElement();
	}

	getTable(){
		return this._row.table;
	}

	getCells(){
		var cells = [];

		this._row.getCells().forEach(function(cell){
			cells.push(cell.getComponent());
		});

		return cells;
	}

	getCell(column){
		var cell = this._row.getCell(column);
		return cell ? cell.getComponent() : false;
	}

	_getSelf(){
		return this._row;
	}
}

//public cell object
class CellComponent {

	constructor (cell){
		this._cell = cell;

		return new Proxy(this, {
			get: function(target, name, receiver) {
				if (typeof target[name] !== "undefined") {
					return target[name];
				}else {
					return target._cell.table.componentFunctionBinder.handle("cell", target._cell, name);
				}
			}
		});
	}

	getValue(){
		return this._cell.getValue();
	}

	getOldValue(){
		return this._cell.getOldValue();
	}

	getInitialValue(){
		return this._cell.initialValue;
	}

	getElement(){
		return this._cell.getElement();
	}

	getRow(){
		return this._cell.row.getComponent();
	}

	getData(transform){
		return this._cell.row.getData(transform);
	}
	getType(){
		return "cell";
	}
	getField(){
		return this._cell.column.getField();
	}

	getColumn(){
		return this._cell.column.getComponent();
	}

	setValue(value, mutate){
		if(typeof mutate == "undefined"){
			mutate = true;
		}

		this._cell.setValue(value, mutate);
	}

	restoreOldValue(){
		this._cell.setValueActual(this._cell.getOldValue());
	}

	restoreInitialValue(){
		this._cell.setValueActual(this._cell.initialValue);
	}

	checkHeight(){
		this._cell.checkHeight();
	}

	getTable(){
		return this._cell.table;
	}

	_getSelf(){
		return this._cell;
	}
}

class Cell extends CoreFeature{
	constructor(column, row){
		super(column.table);

		this.table = column.table;
		this.column = column;
		this.row = row;
		this.element = null;
		this.value = null;
		this.initialValue;
		this.oldValue = null;
		this.modules = {};

		this.height = null;
		this.width = null;
		this.minWidth = null;

		this.component = null;

		this.loaded = false; //track if the cell has been added to the DOM yet

		this.build();
	}

	//////////////// Setup Functions /////////////////
	//generate element
	build(){
		this.generateElement();

		this.setWidth();

		this._configureCell();

		this.setValueActual(this.column.getFieldValue(this.row.data));

		this.initialValue = this.value;
	}

	generateElement(){
		this.element = document.createElement('div');
		this.element.className = "tabulator-cell";
		this.element.setAttribute("role", "gridcell");

		if(this.column.isRowHeader){
			this.element.classList.add("tabulator-row-header");
		}
	}

	_configureCell(){
		var element = this.element,
		field = this.column.getField(),
		vertAligns = {
			top:"flex-start",
			bottom:"flex-end",
			middle:"center",
		},
		hozAligns = {
			left:"flex-start",
			right:"flex-end",
			center:"center",
		};

		//set text alignment
		element.style.textAlign = this.column.hozAlign;

		if(this.column.vertAlign){
			element.style.display = "inline-flex";

			element.style.alignItems = vertAligns[this.column.vertAlign] || "";

			if(this.column.hozAlign){
				element.style.justifyContent = hozAligns[this.column.hozAlign] || "";
			}
		}

		if(field){
			element.setAttribute("tabulator-field", field);
		}

		//add class to cell if needed
		if(this.column.definition.cssClass){
			var classNames = this.column.definition.cssClass.split(" ");
			classNames.forEach((className) => {
				element.classList.add(className);
			});
		}

		this.dispatch("cell-init", this);

		//hide cell if not visible
		if(!this.column.visible){
			this.hide();
		}
	}

	//generate cell contents
	_generateContents(){
		var val;

		val = this.chain("cell-format", this, null, () => {
			return this.element.innerHTML = this.value;
		});

		switch(typeof val){
			case "object":
				if(val instanceof Node){

					//clear previous cell contents
					while(this.element.firstChild) this.element.removeChild(this.element.firstChild);

					this.element.appendChild(val);
				}else {
					this.element.innerHTML = "";

					if(val != null){
						console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:", val);
					}
				}
				break;
			case "undefined":
				this.element.innerHTML = "";
				break;
			default:
				this.element.innerHTML = val;
		}
	}

	cellRendered(){
		this.dispatch("cell-rendered", this);
	}

	//////////////////// Getters ////////////////////
	getElement(containerOnly){
		if(!this.loaded){
			this.loaded = true;
			if(!containerOnly){
				this.layoutElement();
			}
		}

		return this.element;
	}

	getValue(){
		return this.value;
	}

	getOldValue(){
		return this.oldValue;
	}

	//////////////////// Actions ////////////////////
	setValue(value, mutate, force){
		var changed = this.setValueProcessData(value, mutate, force);

		if(changed){
			this.dispatch("cell-value-updated", this);

			this.cellRendered();

			if(this.column.definition.cellEdited){
				this.column.definition.cellEdited.call(this.table, this.getComponent());
			}

			this.dispatchExternal("cellEdited", this.getComponent());

			if(this.subscribedExternal("dataChanged")){
				this.dispatchExternal("dataChanged", this.table.rowManager.getData());
			}
		}
	}

	setValueProcessData(value, mutate, force){
		var changed = false;

		if(this.value !== value || force){

			changed = true;

			if(mutate){
				value = this.chain("cell-value-changing", [this, value], null, value);
			}
		}

		this.setValueActual(value);

		if(changed){
			this.dispatch("cell-value-changed", this);
		}

		return changed;
	}

	setValueActual(value){
		this.oldValue = this.value;

		this.value = value;

		this.dispatch("cell-value-save-before", this);

		this.column.setFieldValue(this.row.data, value);

		this.dispatch("cell-value-save-after", this);

		if(this.loaded){
			this.layoutElement();
		}
	}

	layoutElement(){
		this._generateContents();

		this.dispatch("cell-layout", this);
	}

	setWidth(){
		this.width = this.column.width;
		this.element.style.width = this.column.widthStyled;
	}

	clearWidth(){
		this.width = "";
		this.element.style.width = "";
	}

	getWidth(){
		return this.width || this.element.offsetWidth;
	}

	setMinWidth(){
		this.minWidth = this.column.minWidth;
		this.element.style.minWidth = this.column.minWidthStyled;
	}

	setMaxWidth(){
		this.maxWidth = this.column.maxWidth;
		this.element.style.maxWidth = this.column.maxWidthStyled;
	}

	checkHeight(){
		// var height = this.element.css("height");
		this.row.reinitializeHeight();
	}

	clearHeight(){
		this.element.style.height = "";
		this.height = null;

		this.dispatch("cell-height", this, "");
	}

	setHeight(){
		this.height = this.row.height;
		this.element.style.height = this.row.heightStyled;

		this.dispatch("cell-height", this, this.row.heightStyled);
	}

	getHeight(){
		return this.height || this.element.offsetHeight;
	}

	show(){
		this.element.style.display = this.column.vertAlign ? "inline-flex" : "";
	}

	hide(){
		this.element.style.display = "none";
	}

	delete(){
		this.dispatch("cell-delete", this);

		if(!this.table.rowManager.redrawBlock && this.element.parentNode){
			this.element.parentNode.removeChild(this.element);
		}

		this.element = false;
		this.column.deleteCell(this);
		this.row.deleteCell(this);
		this.calcs = {};
	}

	getIndex(){
		return this.row.getCellIndex(this);
	}

	//////////////// Object Generation /////////////////
	getComponent(){
		if(!this.component){
			this.component = new CellComponent(this);
		}

		return this.component;
	}
}

//public column object
class ColumnComponent {
	constructor (column){
		this._column = column;
		this.type = "ColumnComponent";

		return new Proxy(this, {
			get: function(target, name, receiver) {
				if (typeof target[name] !== "undefined") {
					return target[name];
				}else {
					return target._column.table.componentFunctionBinder.handle("column", target._column, name);
				}
			}
		});
	}

	getElement(){
		return this._column.getElement();
	}

	getDefinition(){
		return this._column.getDefinition();
	}

	getField(){
		return this._column.getField();
	}

	getTitleDownload() {
		return this._column.getTitleDownload();
	}

	getCells(){
		var cells = [];

		this._column.cells.forEach(function(cell){
			cells.push(cell.getComponent());
		});

		return cells;
	}

	isVisible(){
		return this._column.visible;
	}

	show(){
		if(this._column.isGroup){
			this._column.columns.forEach(function(column){
				column.show();
			});
		}else {
			this._column.show();
		}
	}

	hide(){
		if(this._column.isGroup){
			this._column.columns.forEach(function(column){
				column.hide();
			});
		}else {
			this._column.hide();
		}
	}

	toggle(){
		if(this._column.visible){
			this.hide();
		}else {
			this.show();
		}
	}

	delete(){
		return this._column.delete();
	}

	getSubColumns(){
		var output = [];

		if(this._column.columns.length){
			this._column.columns.forEach(function(column){
				output.push(column.getComponent());
			});
		}

		return output;
	}

	getParentColumn(){
		return this._column.getParentComponent();
	}

	_getSelf(){
		return this._column;
	}

	scrollTo(position, ifVisible){
		return this._column.table.columnManager.scrollToColumn(this._column, position, ifVisible);
	}

	getTable(){
		return this._column.table;
	}

	move(to, after){
		var toColumn = this._column.table.columnManager.findColumn(to);

		if(toColumn){
			this._column.table.columnManager.moveColumn(this._column, toColumn, after);
		}else {
			console.warn("Move Error - No matching column found:", toColumn);
		}
	}

	getNextColumn(){
		var nextCol = this._column.nextColumn();

		return nextCol ? nextCol.getComponent() : false;
	}

	getPrevColumn(){
		var prevCol = this._column.prevColumn();

		return prevCol ? prevCol.getComponent() : false;
	}

	updateDefinition(updates){
		return this._column.updateDefinition(updates);
	}

	getWidth(){
		return this._column.getWidth();
	}

	setWidth(width){
		var result;

		if(width === true){
			result =  this._column.reinitializeWidth(true);
		}else {
			result =  this._column.setWidth(width);
		}

		this._column.table.columnManager.rerenderColumns(true);

		return result;
	}
}

var defaultColumnOptions = {
	"title": undefined,
	"field": undefined,
	"columns": undefined,
	"visible": undefined,
	"hozAlign": undefined,
	"vertAlign": undefined,
	"width": undefined,
	"minWidth": 40,
	"maxWidth": undefined,
	"maxInitialWidth": undefined,
	"cssClass": undefined,
	"variableHeight": undefined,
	"headerVertical": undefined,
	"headerHozAlign": undefined,
	"headerWordWrap": false,
	"editableTitle": undefined,
};

class Column extends CoreFeature{
	
	static defaultOptionList = defaultColumnOptions;
	
	constructor(def, parent, rowHeader){
		super(parent.table);
		
		this.definition = def; //column definition
		this.parent = parent; //hold parent object
		this.type = "column"; //type of element
		this.columns = []; //child columns
		this.cells = []; //cells bound to this column
		this.isGroup = false;
		this.isRowHeader = rowHeader;
		this.element = this.createElement(); //column header element
		this.contentElement = false;
		this.titleHolderElement = false;
		this.titleElement = false;
		this.groupElement = this.createGroupElement(); //column group holder element
		this.hozAlign = ""; //horizontal text alignment
		this.vertAlign = ""; //vert text alignment
		
		//multi dimensional filed handling
		this.field ="";
		this.fieldStructure = "";
		this.getFieldValue = "";
		this.setFieldValue = "";
		
		this.titleDownload = null;
		this.titleFormatterRendered = false;
		
		this.mapDefinitions();
		
		this.setField(this.definition.field);
		
		this.modules = {}; //hold module variables;
		
		this.width = null; //column width
		this.widthStyled = ""; //column width pre-styled to improve render efficiency
		this.maxWidth = null; //column maximum width
		this.maxWidthStyled = ""; //column maximum pre-styled to improve render efficiency
		this.maxInitialWidth = null;
		this.minWidth = null; //column minimum width
		this.minWidthStyled = ""; //column minimum pre-styled to improve render efficiency
		this.widthFixed = false; //user has specified a width for this column
		
		this.visible = true; //default visible state
		
		this.component = null;
		
		//initialize column
		if(this.definition.columns){
			
			this.isGroup = true;
			
			this.definition.columns.forEach((def, i) => {
				var newCol = new Column(def, this);
				this.attachColumn(newCol);
			});
			
			this.checkColumnVisibility();
		}else {
			parent.registerColumnField(this);
		}
		
		this._initialize();
	}
	
	createElement (){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-col");
		el.setAttribute("role", "columnheader");
		el.setAttribute("aria-sort", "none");

		if(this.isRowHeader){
			el.classList.add("tabulator-row-header");
		}
		
		switch(this.table.options.columnHeaderVertAlign){
			case "middle":
				el.style.justifyContent = "center";
				break;
			case "bottom":
				el.style.justifyContent = "flex-end";
				break;
		}
		
		return el;
	}
	
	createGroupElement (){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-col-group-cols");
		
		return el;
	}
	
	mapDefinitions(){
		var defaults = this.table.options.columnDefaults;
		
		//map columnDefaults onto column definitions
		if(defaults){
			for(let key in defaults){
				if(typeof this.definition[key] === "undefined"){
					this.definition[key] = defaults[key];
				}
			}
		}
		
		this.definition = this.table.columnManager.optionsList.generate(Column.defaultOptionList, this.definition);
	}
	
	checkDefinition(){
		Object.keys(this.definition).forEach((key) => {
			if(Column.defaultOptionList.indexOf(key) === -1){
				console.warn("Invalid column definition option in '" + (this.field || this.definition.title) + "' column:", key);
			}
		});
	}

	setField(field){
		this.field = field;
		this.fieldStructure = field ? (this.table.options.nestedFieldSeparator ? field.split(this.table.options.nestedFieldSeparator) : [field]) : [];
		this.getFieldValue = this.fieldStructure.length > 1 ? this._getNestedData : this._getFlatData;
		this.setFieldValue = this.fieldStructure.length > 1 ? this._setNestedData : this._setFlatData;
	}
	
	//register column position with column manager
	registerColumnPosition(column){
		this.parent.registerColumnPosition(column);
	}
	
	//register column position with column manager
	registerColumnField(column){
		this.parent.registerColumnField(column);
	}
	
	//trigger position registration
	reRegisterPosition(){
		if(this.isGroup){
			this.columns.forEach(function(column){
				column.reRegisterPosition();
			});
		}else {
			this.registerColumnPosition(this);
		}
	}
	
	//build header element
	_initialize(){
		var def = this.definition;
		
		while(this.element.firstChild) this.element.removeChild(this.element.firstChild);
		
		if(def.headerVertical){
			this.element.classList.add("tabulator-col-vertical");
			
			if(def.headerVertical === "flip"){
				this.element.classList.add("tabulator-col-vertical-flip");
			}
		}
		
		this.contentElement = this._buildColumnHeaderContent();
		
		this.element.appendChild(this.contentElement);
		
		if(this.isGroup){
			this._buildGroupHeader();
		}else {
			this._buildColumnHeader();
		}
		
		this.dispatch("column-init", this);
	}
	
	//build header element for header
	_buildColumnHeader(){
		var def = this.definition;
		
		this.dispatch("column-layout", this);
		
		//set column visibility
		if(typeof def.visible != "undefined"){
			if(def.visible){
				this.show(true);
			}else {
				this.hide(true);
			}
		}
		
		//assign additional css classes to column header
		if(def.cssClass){
			var classNames = def.cssClass.split(" ");
			classNames.forEach((className) => {
				this.element.classList.add(className);
			});
		}
		
		if(def.field){
			this.element.setAttribute("tabulator-field", def.field);
		}
		
		//set min width if present
		this.setMinWidth(parseInt(def.minWidth));
		
		if (def.maxInitialWidth) {
			this.maxInitialWidth = parseInt(def.maxInitialWidth);
		}
		
		if(def.maxWidth){
			this.setMaxWidth(parseInt(def.maxWidth));
		}
		
		this.reinitializeWidth();
		
		//set horizontal text alignment
		this.hozAlign = this.definition.hozAlign;
		this.vertAlign = this.definition.vertAlign;
		
		this.titleElement.style.textAlign = this.definition.headerHozAlign;
	}
	
	_buildColumnHeaderContent(){
		var contentElement = document.createElement("div");
		contentElement.classList.add("tabulator-col-content");
		
		this.titleHolderElement = document.createElement("div");
		this.titleHolderElement.classList.add("tabulator-col-title-holder");
		
		contentElement.appendChild(this.titleHolderElement);
		
		this.titleElement = this._buildColumnHeaderTitle();
		
		this.titleHolderElement.appendChild(this.titleElement);
		
		return contentElement;
	}
	
	//build title element of column
	_buildColumnHeaderTitle(){
		var def = this.definition;
		
		var titleHolderElement = document.createElement("div");
		titleHolderElement.classList.add("tabulator-col-title");
		
		if(def.headerWordWrap){
			titleHolderElement.classList.add("tabulator-col-title-wrap");
		}
		
		if(def.editableTitle){
			var titleElement = document.createElement("input");
			titleElement.classList.add("tabulator-title-editor");
			
			titleElement.addEventListener("click", (e) => {
				e.stopPropagation();
				titleElement.focus();
			});
			
			titleElement.addEventListener("mousedown", (e) => {
				e.stopPropagation();
			});
			
			titleElement.addEventListener("change", () => {
				def.title = titleElement.value;
				this.dispatchExternal("columnTitleChanged", this.getComponent());
			});
			
			titleHolderElement.appendChild(titleElement);
			
			if(def.field){
				this.langBind("columns|" + def.field, (text) => {
					titleElement.value = text || (def.title || "&nbsp;");
				});
			}else {
				titleElement.value  = def.title || "&nbsp;";
			}
			
		}else {
			if(def.field){
				this.langBind("columns|" + def.field, (text) => {
					this._formatColumnHeaderTitle(titleHolderElement, text || (def.title || "&nbsp;"));
				});
			}else {
				this._formatColumnHeaderTitle(titleHolderElement, def.title || "&nbsp;");
			}
		}
		
		return titleHolderElement;
	}
	
	_formatColumnHeaderTitle(el, title){
		var contents = this.chain("column-format", [this, title, el], null, () => {
			return title;
		});
		
		switch(typeof contents){
			case "object":
				if(contents instanceof Node){
					el.appendChild(contents);
				}else {
					el.innerHTML = "";
					console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:", contents);
				}
				break;
			case "undefined":
				el.innerHTML = "";
				break;
			default:
				el.innerHTML = contents;
		}
	}
	
	//build header element for column group
	_buildGroupHeader(){
		this.element.classList.add("tabulator-col-group");
		this.element.setAttribute("role", "columngroup");
		this.element.setAttribute("aria-title", this.definition.title);
		
		//asign additional css classes to column header
		if(this.definition.cssClass){
			var classNames = this.definition.cssClass.split(" ");
			classNames.forEach((className) => {
				this.element.classList.add(className);
			});
		}
		
		this.titleElement.style.textAlign = this.definition.headerHozAlign;
		
		this.element.appendChild(this.groupElement);
	}
	
	//flat field lookup
	_getFlatData(data){
		return data[this.field];
	}
	
	//nested field lookup
	_getNestedData(data){
		var dataObj = data,
		structure = this.fieldStructure,
		length = structure.length,
		output;
		
		for(let i = 0; i < length; i++){
			
			dataObj = dataObj[structure[i]];
			
			output = dataObj;
			
			if(!dataObj){
				break;
			}
		}
		
		return output;
	}
	
	//flat field set
	_setFlatData(data, value){
		if(this.field){
			data[this.field] = value;
		}
	}
	
	//nested field set
	_setNestedData(data, value){
		var dataObj = data,
		structure = this.fieldStructure,
		length = structure.length;
		
		for(let i = 0; i < length; i++){
			
			if(i == length -1){
				dataObj[structure[i]] = value;
			}else {
				if(!dataObj[structure[i]]){
					if(typeof value !== "undefined"){
						dataObj[structure[i]] = {};
					}else {
						break;
					}
				}
				
				dataObj = dataObj[structure[i]];
			}
		}
	}
	
	//attach column to this group
	attachColumn(column){
		if(this.groupElement){
			this.columns.push(column);
			this.groupElement.appendChild(column.getElement());
			
			column.columnRendered();
		}else {
			console.warn("Column Warning - Column being attached to another column instead of column group");
		}
	}
	
	//vertically align header in column
	verticalAlign(alignment, height){
		
		//calculate height of column header and group holder element
		var parentHeight = this.parent.isGroup ? this.parent.getGroupElement().clientHeight : (height || this.parent.getHeadersElement().clientHeight);
		// var parentHeight = this.parent.isGroup ? this.parent.getGroupElement().clientHeight : this.parent.getHeadersElement().clientHeight;
		
		this.element.style.height = parentHeight + "px";
		
		this.dispatch("column-height", this, this.element.style.height);
		
		if(this.isGroup){
			this.groupElement.style.minHeight = (parentHeight - this.contentElement.offsetHeight) + "px";
		}
		
		//vertically align cell contents
		// if(!this.isGroup && alignment !== "top"){
		// 	if(alignment === "bottom"){
		// 		this.element.style.paddingTop = (this.element.clientHeight - this.contentElement.offsetHeight) + "px";
		// 	}else{
		// 		this.element.style.paddingTop = ((this.element.clientHeight - this.contentElement.offsetHeight) / 2) + "px";
		// 	}
		// }
		
		this.columns.forEach(function(column){
			column.verticalAlign(alignment);
		});
	}
	
	//clear vertical alignment
	clearVerticalAlign(){
		this.element.style.paddingTop = "";
		this.element.style.height = "";
		this.element.style.minHeight = "";
		this.groupElement.style.minHeight = "";
		
		this.columns.forEach(function(column){
			column.clearVerticalAlign();
		});
		
		this.dispatch("column-height", this, "");
	}
	
	//// Retrieve Column Information ////
	//return column header element
	getElement(){
		return this.element;
	}
	
	//return column group element
	getGroupElement(){
		return this.groupElement;
	}
	
	//return field name
	getField(){
		return this.field;
	}
	
	getTitleDownload() {
		return this.titleDownload;
	}
	
	//return the first column in a group
	getFirstColumn(){
		if(!this.isGroup){
			return this;
		}else {
			if(this.columns.length){
				return this.columns[0].getFirstColumn();
			}else {
				return false;
			}
		}
	}
	
	//return the last column in a group
	getLastColumn(){
		if(!this.isGroup){
			return this;
		}else {
			if(this.columns.length){
				return this.columns[this.columns.length -1].getLastColumn();
			}else {
				return false;
			}
		}
	}
	
	//return all columns in a group
	getColumns(traverse){
		var columns = [];
		
		if(traverse){
			this.columns.forEach((column) => {
				columns.push(column);
				
				columns = columns.concat(column.getColumns(true));
			});
		}else {
			columns = this.columns;
		}
		
		return columns;
	}
	
	//return all columns in a group
	getCells(){
		return this.cells;
	}
	
	//retrieve the top column in a group of columns
	getTopColumn(){
		if(this.parent.isGroup){
			return this.parent.getTopColumn();
		}else {
			return this;
		}
	}
	
	//return column definition object
	getDefinition(updateBranches){
		var colDefs = [];
		
		if(this.isGroup && updateBranches){
			this.columns.forEach(function(column){
				colDefs.push(column.getDefinition(true));
			});
			
			this.definition.columns = colDefs;
		}
		
		return this.definition;
	}
	
	//////////////////// Actions ////////////////////
	checkColumnVisibility(){
		var visible = false;
		
		this.columns.forEach(function(column){
			if(column.visible){
				visible = true;
			}
		});
		
		if(visible){
			this.show();
			this.dispatchExternal("columnVisibilityChanged", this.getComponent(), false);
		}else {
			this.hide();
		}
	}
	
	//show column
	show(silent, responsiveToggle){
		if(!this.visible){
			this.visible = true;
			
			this.element.style.display = "";
			
			if(this.parent.isGroup){
				this.parent.checkColumnVisibility();
			}
			
			this.cells.forEach(function(cell){
				cell.show();
			});
			
			if(!this.isGroup && this.width === null){
				this.reinitializeWidth();
			}
			
			this.table.columnManager.verticalAlignHeaders();
			
			this.dispatch("column-show", this, responsiveToggle);
			
			if(!silent){
				this.dispatchExternal("columnVisibilityChanged", this.getComponent(), true);
			}
			
			if(this.parent.isGroup){
				this.parent.matchChildWidths();
			}
			
			if(!this.silent){
				this.table.columnManager.rerenderColumns();
			}
		}
	}
	
	//hide column
	hide(silent, responsiveToggle){
		if(this.visible){
			this.visible = false;
			
			this.element.style.display = "none";
			
			this.table.columnManager.verticalAlignHeaders();
			
			if(this.parent.isGroup){
				this.parent.checkColumnVisibility();
			}
			
			this.cells.forEach(function(cell){
				cell.hide();
			});
			
			this.dispatch("column-hide", this, responsiveToggle);
			
			if(!silent){
				this.dispatchExternal("columnVisibilityChanged", this.getComponent(), false);
			}
			
			if(this.parent.isGroup){
				this.parent.matchChildWidths();
			}
			
			if(!this.silent){
				this.table.columnManager.rerenderColumns();
			}
		}
	}
	
	matchChildWidths(){
		var childWidth = 0;
		
		if(this.contentElement && this.columns.length){
			this.columns.forEach(function(column){
				if(column.visible){
					childWidth += column.getWidth();
				}
			});
			
			this.contentElement.style.maxWidth = (childWidth - 1) + "px";
			if (this.table.initialized) {
				this.element.style.width = childWidth + "px";
			}
			
			if(this.parent.isGroup){
				this.parent.matchChildWidths();
			}
		}
	}
	
	removeChild(child){
		var index = this.columns.indexOf(child);
		
		if(index > -1){
			this.columns.splice(index, 1);
		}
		
		if(!this.columns.length){
			this.delete();
		}
	}
	
	setWidth(width){
		this.widthFixed = true;
		this.setWidthActual(width);
	}
	
	setWidthActual(width){
		if(isNaN(width)){
			width = Math.floor((this.table.element.clientWidth/100) * parseInt(width));
		}
		
		width = Math.max(this.minWidth, width);
		
		if(this.maxWidth){
			width = Math.min(this.maxWidth, width);
		}
		
		this.width = width;
		this.widthStyled = width ? width + "px" : "";
		
		this.element.style.width = this.widthStyled;
		
		if(!this.isGroup){
			this.cells.forEach(function(cell){
				cell.setWidth();
			});
		}
		
		if(this.parent.isGroup){
			this.parent.matchChildWidths();
		}
		
		this.dispatch("column-width", this);
		
		if(this.subscribedExternal("columnWidth")){
			this.dispatchExternal("columnWidth", this.getComponent());
		}
	}
	
	checkCellHeights(){
		var rows = [];
		
		this.cells.forEach(function(cell){
			if(cell.row.heightInitialized){
				if(cell.row.getElement().offsetParent !== null){
					rows.push(cell.row);
					cell.row.clearCellHeight();
				}else {
					cell.row.heightInitialized = false;
				}
			}
		});
		
		rows.forEach(function(row){
			row.calcHeight();
		});
		
		rows.forEach(function(row){
			row.setCellHeight();
		});
	}
	
	getWidth(){
		var width = 0;
		
		if(this.isGroup){
			this.columns.forEach(function(column){
				if(column.visible){
					width += column.getWidth();
				}
			});
		}else {
			width = this.width;
		}
		
		return width;
	}
	
	getLeftOffset(){
		var offset = this.element.offsetLeft;
		
		if(this.parent.isGroup){
			offset += this.parent.getLeftOffset();
		}
		
		return offset;
	}
	
	getHeight(){
		return Math.ceil(this.element.getBoundingClientRect().height);
	}
	
	setMinWidth(minWidth){
		if(this.maxWidth && minWidth > this.maxWidth){
			minWidth = this.maxWidth;
			
			console.warn("the minWidth ("+ minWidth + "px) for column '" + this.field + "' cannot be bigger that its maxWidth ("+ this.maxWidthStyled + ")");
		}
		
		this.minWidth = minWidth;
		this.minWidthStyled = minWidth ? minWidth + "px" : "";
		
		this.element.style.minWidth = this.minWidthStyled;
		
		this.cells.forEach(function(cell){
			cell.setMinWidth();
		});
	}
	
	setMaxWidth(maxWidth){
		if(this.minWidth && maxWidth < this.minWidth){
			maxWidth = this.minWidth;
			
			console.warn("the maxWidth ("+ maxWidth + "px) for column '" + this.field + "' cannot be smaller that its minWidth ("+ this.minWidthStyled + ")");
		}
		
		this.maxWidth = maxWidth;
		this.maxWidthStyled = maxWidth ? maxWidth + "px" : "";
		
		this.element.style.maxWidth = this.maxWidthStyled;
		
		this.cells.forEach(function(cell){
			cell.setMaxWidth();
		});
	}
	
	delete(){
		return new Promise((resolve, reject) => {
			if(this.isGroup){
				this.columns.forEach(function(column){
					column.delete();
				});
			}
			
			this.dispatch("column-delete", this);
			
			var cellCount = this.cells.length;
			
			for(let i = 0; i < cellCount; i++){
				this.cells[0].delete();
			}
			
			if(this.element.parentNode){
				this.element.parentNode.removeChild(this.element);
			}
			
			this.element = false;
			this.contentElement = false;
			this.titleElement = false;
			this.groupElement = false;
			
			if(this.parent.isGroup){
				this.parent.removeChild(this);
			}
			
			this.table.columnManager.deregisterColumn(this);
			
			this.table.columnManager.rerenderColumns(true);
			
			this.dispatch("column-deleted", this);
			
			resolve();
		});
	}
	
	columnRendered(){
		if(this.titleFormatterRendered){
			this.titleFormatterRendered();
		}
		
		this.dispatch("column-rendered", this);
	}
	
	//////////////// Cell Management /////////////////
	//generate cell for this column
	generateCell(row){
		var cell = new Cell(this, row);
		
		this.cells.push(cell);
		
		return cell;
	}
	
	nextColumn(){
		var index = this.table.columnManager.findColumnIndex(this);
		return index > -1 ? this._nextVisibleColumn(index + 1) : false;
	}
	
	_nextVisibleColumn(index){
		var column = this.table.columnManager.getColumnByIndex(index);
		return !column || column.visible ? column : this._nextVisibleColumn(index + 1);
	}
	
	prevColumn(){
		var index = this.table.columnManager.findColumnIndex(this);
		return index > -1 ? this._prevVisibleColumn(index - 1) : false;
	}
	
	_prevVisibleColumn(index){
		var column = this.table.columnManager.getColumnByIndex(index);
		return !column || column.visible ? column : this._prevVisibleColumn(index - 1);
	}
	
	reinitializeWidth(force){
		this.widthFixed = false;
		
		//set width if present
		if(typeof this.definition.width !== "undefined" && !force){
			// maxInitialWidth ignored here as width specified
			this.setWidth(this.definition.width);
		}
		
		this.dispatch("column-width-fit-before", this);
		
		this.fitToData(force);
		
		this.dispatch("column-width-fit-after", this);
	}
	
	//set column width to maximum cell width for non group columns
	fitToData(force){
		if(this.isGroup){
			return;
		}
		
		if(!this.widthFixed){
			this.element.style.width = "";
			
			this.cells.forEach((cell) => {
				cell.clearWidth();
			});
		}
		
		var maxWidth = this.element.offsetWidth;
		
		if(!this.width || !this.widthFixed){
			this.cells.forEach((cell) => {
				var width = cell.getWidth();
				
				if(width > maxWidth){
					maxWidth = width;
				}
			});
			
			if(maxWidth){
				var setTo = maxWidth + 1;
				
				if(force){
					this.setWidth(setTo);
				}else {
					if (this.maxInitialWidth && !force) {
						setTo = Math.min(setTo, this.maxInitialWidth);
					}
					this.setWidthActual(setTo);
				}
			}
		}
	}
	
	updateDefinition(updates){
		var definition;
		
		if(!this.isGroup){
			if(!this.parent.isGroup){
				definition = Object.assign({}, this.getDefinition());
				definition = Object.assign(definition, updates);
				
				return this.table.columnManager.addColumn(definition, false, this)
					.then((column) => {
					
						if(definition.field == this.field){
							this.field = false; //clear field name to prevent deletion of duplicate column from arrays
						}
					
						return this.delete()
							.then(() => {
								return column.getComponent();
							});
					
					});
			}else {
				console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns");
				return Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups");
			}
		}else {
			console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns");
			return Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups");
		}
	}
	
	deleteCell(cell){
		var index = this.cells.indexOf(cell);
		
		if(index > -1){
			this.cells.splice(index, 1);
		}
	}
	
	//////////////// Object Generation /////////////////
	getComponent(){
		if(!this.component){
			this.component = new ColumnComponent(this);
		}
		
		return this.component;
	}
	
	getPosition(){
		return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this) + 1;
	}
	
	getParentComponent(){
		return this.parent instanceof Column ? this.parent.getComponent() : false;
	}
}

//public row object
class RowComponent {

	constructor (row){
		this._row = row;

		return new Proxy(this, {
			get: function(target, name, receiver) {
				if (typeof target[name] !== "undefined") {
					return target[name];
				}else {
					return target._row.table.componentFunctionBinder.handle("row", target._row, name);
				}
			}
		});
	}

	getData(transform){
		return this._row.getData(transform);
	}

	getElement(){
		return this._row.getElement();
	}

	getCells(){
		var cells = [];

		this._row.getCells().forEach(function(cell){
			cells.push(cell.getComponent());
		});

		return cells;
	}

	getCell(column){
		var cell = this._row.getCell(column);
		return cell ? cell.getComponent() : false;
	}

	getIndex(){
		return this._row.getData("data")[this._row.table.options.index];
	}

	getPosition(){
		return this._row.getPosition();
	}

	watchPosition(callback){
		return this._row.watchPosition(callback);
	}

	delete(){
		return this._row.delete();
	}

	scrollTo(position, ifVisible){
		return this._row.table.rowManager.scrollToRow(this._row, position, ifVisible);
	}

	move(to, after){
		this._row.moveToRow(to, after);
	}

	update(data){
		return this._row.updateData(data);
	}

	normalizeHeight(){
		this._row.normalizeHeight(true);
	}

	_getSelf(){
		return this._row;
	}

	reformat(){
		return this._row.reinitialize();
	}

	getTable(){
		return this._row.table;
	}

	getNextRow(){
		var row = this._row.nextRow();
		return row ? row.getComponent() : row;
	}

	getPrevRow(){
		var row = this._row.prevRow();
		return row ? row.getComponent() : row;
	}
}

class Row extends CoreFeature{
	constructor (data, parent, type = "row"){
		super(parent.table);
		
		this.parent = parent;
		this.data = {};
		this.type = type; //type of element
		this.element = false;
		this.modules = {}; //hold module variables;
		this.cells = [];
		this.height = 0; //hold element height
		this.heightStyled = ""; //hold element height pre-styled to improve render efficiency
		this.manualHeight = false; //user has manually set row height
		this.outerHeight = 0; //hold elements outer height
		this.initialized = false; //element has been rendered
		this.heightInitialized = false; //element has resized cells to fit
		this.position = 0; //store position of element in row list
		this.positionWatchers = [];
		
		this.component = null;
		
		this.created = false;
		
		this.setData(data);
	}
	
	create(){
		if(!this.created){
			this.created = true;
			this.generateElement();
		}
	}
	
	createElement (){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-row");
		el.setAttribute("role", "row");
		
		this.element = el;
	}
	
	getElement(){
		this.create();
		return this.element;
	}
	
	detachElement(){
		if (this.element && this.element.parentNode){
			this.element.parentNode.removeChild(this.element);
		}
	}
	
	generateElement(){
		this.createElement();
		this.dispatch("row-init", this);
	}
	
	generateCells(){
		this.cells = this.table.columnManager.generateCells(this);
	}
	
	//functions to setup on first render
	initialize(force, inFragment){
		this.create();
		
		if(!this.initialized || force){
			
			this.deleteCells();
			
			while(this.element.firstChild) this.element.removeChild(this.element.firstChild);
			
			this.dispatch("row-layout-before", this);
			
			this.generateCells();
			
			this.initialized = true;
			
			this.table.columnManager.renderer.renderRowCells(this, inFragment);
			
			if(force){
				this.normalizeHeight();
			}
			
			this.dispatch("row-layout", this);
			
			if(this.table.options.rowFormatter){
				this.table.options.rowFormatter(this.getComponent());
			}
			
			this.dispatch("row-layout-after", this);
		}else {
			this.table.columnManager.renderer.rerenderRowCells(this, inFragment);
		}
	}

	rendered(){
		this.cells.forEach((cell) => {
			cell.cellRendered();
		});
	}
	
	reinitializeHeight(){
		this.heightInitialized = false;
		
		if(this.element && this.element.offsetParent !== null){
			this.normalizeHeight(true);
		}
	}

	deinitialize(){
		this.initialized = false;
	}
	
	deinitializeHeight(){
		this.heightInitialized = false;
	}
	
	reinitialize(children){
		this.initialized = false;
		this.heightInitialized = false;
		
		if(!this.manualHeight){
			this.height = 0;
			this.heightStyled = "";
		}
		
		if(this.element && this.element.offsetParent !== null){
			this.initialize(true);
		}
		
		this.dispatch("row-relayout", this);
	}
	
	//get heights when doing bulk row style calcs in virtual DOM
	calcHeight(force){
		var maxHeight = 0, minHeight  = 0;

		if(this.table.options.rowHeight){
			this.height = this.table.options.rowHeight;
		}else {
			minHeight = this.calcMinHeight();
			maxHeight = this.calcMaxHeight();
			
			if(force){
				this.height = Math.max(maxHeight, minHeight);
			}else {
				this.height = this.manualHeight ? this.height : Math.max(maxHeight, minHeight);
			}
		}
		
		this.heightStyled = this.height ? this.height + "px" : "";
		this.outerHeight = this.element.offsetHeight;
	}

	calcMinHeight(){
		return this.table.options.resizableRows ? this.element.clientHeight : 0;
	}

	calcMaxHeight(){
		var maxHeight = 0;

		this.cells.forEach(function(cell){
			var height = cell.getHeight();

			if(height > maxHeight){
				maxHeight = height;
			}
		});

		return maxHeight;
	}
	
	//set of cells
	setCellHeight(){
		this.cells.forEach(function(cell){
			cell.setHeight();
		});
		
		this.heightInitialized = true;
	}
	
	clearCellHeight(){
		this.cells.forEach(function(cell){
			cell.clearHeight();
		});
	}
	
	//normalize the height of elements in the row
	normalizeHeight(force){
		if(force && !this.table.options.rowHeight){
			this.clearCellHeight();
		}
		
		this.calcHeight(force);
		
		this.setCellHeight();
	}
	
	//set height of rows
	setHeight(height, force){
		if(this.height != height || force){
			
			this.manualHeight = true;
			
			this.height = height;
			this.heightStyled = height ? height + "px" : "";
			
			this.setCellHeight();
			
			// this.outerHeight = this.element.outerHeight();
			this.outerHeight = this.element.offsetHeight;

			if(this.subscribedExternal("rowHeight")){
				this.dispatchExternal("rowHeight", this.getComponent());
			}
		}
	}
	
	//return rows outer height
	getHeight(){
		return this.outerHeight;
	}
	
	//return rows outer Width
	getWidth(){
		return this.element.offsetWidth;
	}
	
	//////////////// Cell Management /////////////////
	deleteCell(cell){
		var index = this.cells.indexOf(cell);
		
		if(index > -1){
			this.cells.splice(index, 1);
		}
	}
	
	//////////////// Data Management /////////////////
	setData(data){
		this.data = this.chain("row-data-init-before", [this, data], undefined, data);
		
		this.dispatch("row-data-init-after", this);
	}
	
	//update the rows data
	updateData(updatedData){
		var visible = this.element && Helpers.elVisible(this.element),
		tempData = {},
		newRowData;
		
		return new Promise((resolve, reject) => {
			
			if(typeof updatedData === "string"){
				updatedData = JSON.parse(updatedData);
			}
			
			this.dispatch("row-data-save-before", this);
			
			if(this.subscribed("row-data-changing")){
				tempData = Object.assign(tempData, this.data);
				tempData = Object.assign(tempData, updatedData);
			}
			
			newRowData = this.chain("row-data-changing", [this, tempData, updatedData], null, updatedData);
			
			//set data
			for (let attrname in newRowData) {
				this.data[attrname] = newRowData[attrname];
			}
			
			this.dispatch("row-data-save-after", this);
			
			//update affected cells only
			for (let attrname in updatedData) {
				
				let columns = this.table.columnManager.getColumnsByFieldRoot(attrname);
				
				columns.forEach((column) => {
					let cell = this.getCell(column.getField());
					
					if(cell){
						let value = column.getFieldValue(newRowData);
						if(cell.getValue() !== value){
							cell.setValueProcessData(value);
							
							if(visible){
								cell.cellRendered();
							}
						}
					}
				});
			}
			
			//Partial reinitialization if visible
			if(visible){
				this.normalizeHeight(true);
				
				if(this.table.options.rowFormatter){
					this.table.options.rowFormatter(this.getComponent());
				}
			}else {
				this.initialized = false;
				this.height = 0;
				this.heightStyled = "";
			}
			
			this.dispatch("row-data-changed", this, visible, updatedData);
			
			//this.reinitialize();
			
			this.dispatchExternal("rowUpdated", this.getComponent());
			
			if(this.subscribedExternal("dataChanged")){
				this.dispatchExternal("dataChanged", this.table.rowManager.getData());
			}
			
			resolve();
		});
	}
	
	getData(transform){
		if(transform){
			return this.chain("row-data-retrieve", [this, transform], null, this.data);
		}
		
		return this.data;
	}
	
	getCell(column){
		var match = false;
		
		column = this.table.columnManager.findColumn(column);
		
		if(!this.initialized && this.cells.length === 0){
			this.generateCells();
		}
		
		match = this.cells.find(function(cell){
			return cell.column === column;
		});
		
		return match;
	}
	
	getCellIndex(findCell){
		return this.cells.findIndex(function(cell){
			return cell === findCell;
		});
	}
	
	findCell(subject){
		return this.cells.find((cell) => {
			return cell.element === subject;
		});
	}
	
	getCells(){
		if(!this.initialized && this.cells.length === 0){
			this.generateCells();
		}
		
		return this.cells;
	}
	
	nextRow(){
		var row = this.table.rowManager.nextDisplayRow(this, true);
		return row || false;
	}
	
	prevRow(){
		var row = this.table.rowManager.prevDisplayRow(this, true);
		return row || false;
	}
	
	moveToRow(to, before){
		var toRow = this.table.rowManager.findRow(to);
		
		if(toRow){
			this.table.rowManager.moveRowActual(this, toRow, !before);
			this.table.rowManager.refreshActiveData("display", false, true);
		}else {
			console.warn("Move Error - No matching row found:", to);
		}
	}
	
	///////////////////// Actions  /////////////////////
	delete(){
		this.dispatch("row-delete", this);
		
		this.deleteActual();
		
		return Promise.resolve();
	}
	
	deleteActual(blockRedraw){
		this.detachModules();
		
		this.table.rowManager.deleteRow(this, blockRedraw);
		
		this.deleteCells();
		
		this.initialized = false;
		this.heightInitialized = false;
		this.element = false;
		
		this.dispatch("row-deleted", this);
	}
	
	detachModules(){
		this.dispatch("row-deleting", this);
	}
	
	deleteCells(){
		var cellCount = this.cells.length;
		
		for(let i = 0; i < cellCount; i++){
			this.cells[0].delete();
		}
	}
	
	wipe(){
		this.detachModules();
		this.deleteCells();
		
		if(this.element){
			while(this.element.firstChild) this.element.removeChild(this.element.firstChild);
			
			if(this.element.parentNode){
				this.element.parentNode.removeChild(this.element);
			}
		}
		
		this.element = false;
		this.modules = {};
	}

	isDisplayed(){
		return this.table.rowManager.getDisplayRows().includes(this);
	}

	getPosition(){
		return this.isDisplayed() ? this.position : false;
	}

	setPosition(position){
		if(position != this.position){
			this.position = position;

			this.positionWatchers.forEach((callback) => {
				callback(this.position);
			});
		}
	}

	watchPosition(callback){
		this.positionWatchers.push(callback);

		callback(this.position);
	}
	
	getGroup(){
		return this.modules.group || false;
	}
	
	//////////////// Object Generation /////////////////
	getComponent(){
		if(!this.component){
			this.component = new RowComponent(this);
		}
		
		return this.component;
	}
}

var defaultCalculations = {
	"avg":function(values, data, calcParams){
		var output = 0,
		precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : 2;

		if(values.length){
			output = values.reduce(function(sum, value){
				return Number(sum) + Number(value);
			});

			output = output / values.length;

			output = precision !== false ? output.toFixed(precision) : output;
		}

		return parseFloat(output).toString();
	},
	"max":function(values, data, calcParams){
		var output = null,
		precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

		values.forEach(function(value){

			value = Number(value);

			if(value > output || output === null){
				output = value;
			}
		});

		return output !== null ? (precision !== false ? output.toFixed(precision) : output) : "";
	},
	"min":function(values, data, calcParams){
		var output = null,
		precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

		values.forEach(function(value){

			value = Number(value);

			if(value < output || output === null){
				output = value;
			}
		});

		return output !== null ? (precision !== false ? output.toFixed(precision) : output) : "";
	},
	"sum":function(values, data, calcParams){
		var output = 0,
		precision = typeof calcParams.precision !== "undefined" ? calcParams.precision : false;

		if(values.length){
			values.forEach(function(value){
				value = Number(value);

				output += !isNaN(value) ? Number(value) : 0;
			});
		}

		return precision !== false ? output.toFixed(precision) : output;
	},
	"concat":function(values, data, calcParams){
		var output = 0;

		if(values.length){
			output = values.reduce(function(sum, value){
				return String(sum) + String(value);
			});
		}

		return output;
	},
	"count":function(values, data, calcParams){
		var output = 0;

		if(values.length){
			values.forEach(function(value){
				if(value){
					output ++;
				}
			});
		}

		return output;
	},
	"unique":function(values, data, calcParams){
		var unique = values.filter((value, index) => {
			return (values || value === 0) && values.indexOf(value) === index;
		});

		return unique.length;
	},
};

class ColumnCalcs extends Module{

	static moduleName = "columnCalcs";

	//load defaults
	static calculations = defaultCalculations;
	
	constructor(table){
		super(table);
		
		this.topCalcs = [];
		this.botCalcs = [];
		this.genColumn = false;
		this.topElement = this.createElement();
		this.botElement = this.createElement();
		this.topRow = false;
		this.botRow = false;
		this.topInitialized = false;
		this.botInitialized = false;
		
		this.blocked = false;
		this.recalcAfterBlock = false;
		
		this.registerTableOption("columnCalcs", true);
		
		this.registerColumnOption("topCalc");
		this.registerColumnOption("topCalcParams");
		this.registerColumnOption("topCalcFormatter");
		this.registerColumnOption("topCalcFormatterParams");
		this.registerColumnOption("bottomCalc");
		this.registerColumnOption("bottomCalcParams");
		this.registerColumnOption("bottomCalcFormatter");
		this.registerColumnOption("bottomCalcFormatterParams");
	}
	
	createElement (){
		var el = document.createElement("div");
		el.classList.add("tabulator-calcs-holder");
		return el;
	}
	
	initialize(){
		this.genColumn = new Column({field:"value"}, this);
		
		this.subscribe("cell-value-changed", this.cellValueChanged.bind(this));
		this.subscribe("column-init", this.initializeColumnCheck.bind(this));
		this.subscribe("row-deleted", this.rowsUpdated.bind(this));
		this.subscribe("scroll-horizontal", this.scrollHorizontal.bind(this));
		this.subscribe("row-added", this.rowsUpdated.bind(this));
		this.subscribe("column-moved", this.recalcActiveRows.bind(this));
		this.subscribe("column-add", this.recalcActiveRows.bind(this));
		this.subscribe("data-refreshed", this.recalcActiveRowsRefresh.bind(this));
		this.subscribe("table-redraw", this.tableRedraw.bind(this));
		this.subscribe("rows-visible", this.visibleRows.bind(this));
		this.subscribe("scrollbar-vertical", this.adjustForScrollbar.bind(this));
		
		this.subscribe("redraw-blocked", this.blockRedraw.bind(this));
		this.subscribe("redraw-restored", this.restoreRedraw.bind(this));

		this.subscribe("table-redrawing", this.resizeHolderWidth.bind(this));
		this.subscribe("column-resized", this.resizeHolderWidth.bind(this));
		this.subscribe("column-show", this.resizeHolderWidth.bind(this));
		this.subscribe("column-hide", this.resizeHolderWidth.bind(this));
		
		this.registerTableFunction("getCalcResults", this.getResults.bind(this));
		this.registerTableFunction("recalc", this.userRecalc.bind(this));


		this.resizeHolderWidth();
	}

	resizeHolderWidth(){
		this.topElement.style.minWidth = this.table.columnManager.headersElement.offsetWidth + "px";
	}

	
	tableRedraw(force){
		this.recalc(this.table.rowManager.activeRows);
		
		if(force){
			this.redraw();
		}
	}
	
	blockRedraw(){
		this.blocked = true;
		this.recalcAfterBlock = false;
	}
	
	
	restoreRedraw(){
		this.blocked = false;
		
		if(this.recalcAfterBlock){
			this.recalcAfterBlock = false;
			this.recalcActiveRowsRefresh();
		}
	}
	
	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////
	userRecalc(){
		this.recalc(this.table.rowManager.activeRows);
	}
	
	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////
	
	blockCheck(){
		if(this.blocked){
			this.recalcAfterBlock = true;
		}
		
		return this.blocked;
	}
	
	visibleRows(viewable, rows){
		if(this.topRow){
			rows.unshift(this.topRow);
		}
		
		if(this.botRow){
			rows.push(this.botRow);
		}
		
		return rows;
	}
	
	rowsUpdated(row){
		if(this.table.options.groupBy){
			this.recalcRowGroup(row);
		}else {
			this.recalcActiveRows();
		}
	}
	
	recalcActiveRowsRefresh(){
		if(this.table.options.groupBy && this.table.options.dataTreeStartExpanded && this.table.options.dataTree){
			this.recalcAll();
		}else {
			this.recalcActiveRows();
		}
	}
	
	recalcActiveRows(){
		this.recalc(this.table.rowManager.activeRows);
	}
	
	cellValueChanged(cell){
		if(cell.column.definition.topCalc || cell.column.definition.bottomCalc){
			if(this.table.options.groupBy){
				if(this.table.options.columnCalcs == "table" || this.table.options.columnCalcs == "both"){
					this.recalcActiveRows();
				}
				
				if(this.table.options.columnCalcs != "table"){
					this.recalcRowGroup(cell.row);
				}
			}else {
				this.recalcActiveRows();
			}
		}
	}
	
	initializeColumnCheck(column){
		if(column.definition.topCalc || column.definition.bottomCalc){
			this.initializeColumn(column);
		}
	}
	
	//initialize column calcs
	initializeColumn(column){
		var def = column.definition;
		
		var config = {
			topCalcParams:def.topCalcParams || {},
			botCalcParams:def.bottomCalcParams || {},
		};
		
		if(def.topCalc){
			
			switch(typeof def.topCalc){
				case "string":
					if(ColumnCalcs.calculations[def.topCalc]){
						config.topCalc = ColumnCalcs.calculations[def.topCalc];
					}else {
						console.warn("Column Calc Error - No such calculation found, ignoring: ", def.topCalc);
					}
					break;
				
				case "function":
					config.topCalc = def.topCalc;
					break;
				
			}
			
			if(config.topCalc){
				column.modules.columnCalcs = config;
				this.topCalcs.push(column);
				
				if(this.table.options.columnCalcs != "group"){
					this.initializeTopRow();
				}
			}
			
		}
		
		if(def.bottomCalc){
			switch(typeof def.bottomCalc){
				case "string":
					if(ColumnCalcs.calculations[def.bottomCalc]){
						config.botCalc = ColumnCalcs.calculations[def.bottomCalc];
					}else {
						console.warn("Column Calc Error - No such calculation found, ignoring: ", def.bottomCalc);
					}
					break;
				
				case "function":
					config.botCalc = def.bottomCalc;
					break;
				
			}
			
			if(config.botCalc){
				column.modules.columnCalcs = config;
				this.botCalcs.push(column);
				
				if(this.table.options.columnCalcs != "group"){
					this.initializeBottomRow();
				}
			}
		}
		
	}
	
	//dummy functions to handle being mock column manager
	registerColumnField(){}
	
	removeCalcs(){
		var changed = false;
		
		if(this.topInitialized){
			this.topInitialized = false;
			this.topElement.parentNode.removeChild(this.topElement);
			changed = true;
		}
		
		if(this.botInitialized){
			this.botInitialized = false;
			this.footerRemove(this.botElement);
			changed = true;
		}
		
		if(changed){
			this.table.rowManager.adjustTableSize();
		}
	}
	
	reinitializeCalcs(){
		if(this.topCalcs.length){
			this.initializeTopRow();
		}

		if(this.botCalcs.length){
			this.initializeBottomRow();
		}
	}
	
	initializeTopRow(){
		var	fragment = document.createDocumentFragment();
		
		if(!this.topInitialized){

			fragment.appendChild(document.createElement("br"));
			fragment.appendChild(this.topElement);

			this.table.columnManager.getContentsElement().insertBefore(fragment, this.table.columnManager.headersElement.nextSibling);
			this.topInitialized = true;
		}
	}
	
	initializeBottomRow(){
		if(!this.botInitialized){
			this.footerPrepend(this.botElement);
			this.botInitialized = true;
		}
	}
	
	scrollHorizontal(left){
		if(this.botInitialized && this.botRow){
			this.botElement.scrollLeft = left;
		}
	}
	
	recalc(rows){
		var data, row;
		
		if(!this.blockCheck()){
			if(this.topInitialized || this.botInitialized){
				data = this.rowsToData(rows);
				
				if(this.topInitialized){
					if(this.topRow){
						this.topRow.deleteCells();
					}
					
					row = this.generateRow("top", data);
					this.topRow = row;
					while(this.topElement.firstChild) this.topElement.removeChild(this.topElement.firstChild);
					this.topElement.appendChild(row.getElement());
					row.initialize(true);
				}
				
				if(this.botInitialized){
					if(this.botRow){
						this.botRow.deleteCells();
					}
					
					row = this.generateRow("bottom", data);
					this.botRow = row;
					while(this.botElement.firstChild) this.botElement.removeChild(this.botElement.firstChild);
					this.botElement.appendChild(row.getElement());
					row.initialize(true);
				}
				
				this.table.rowManager.adjustTableSize();
				
				//set resizable handles
				if(this.table.modExists("frozenColumns")){
					this.table.modules.frozenColumns.layout();
				}
			}
		}
	}
	
	recalcRowGroup(row){
		this.recalcGroup(this.table.modules.groupRows.getRowGroup(row));
	}
	
	recalcAll(){
		if(this.topCalcs.length || this.botCalcs.length){
			if(this.table.options.columnCalcs !== "group"){
				this.recalcActiveRows();
			}
			
			if(this.table.options.groupBy && this.table.options.columnCalcs !== "table"){
				
				var groups = this.table.modules.groupRows.getChildGroups();
				
				groups.forEach((group) => {
					this.recalcGroup(group);
				});
			}
		}
	}
	
	recalcGroup(group){
		var data, rowData;
		
		if(!this.blockCheck()){
			if(group){
				if(group.calcs){
					if(group.calcs.bottom){
						data = this.rowsToData(group.rows);
						rowData = this.generateRowData("bottom", data);
						
						group.calcs.bottom.updateData(rowData);
						group.calcs.bottom.reinitialize();
					}
					
					if(group.calcs.top){
						data = this.rowsToData(group.rows);
						rowData = this.generateRowData("top", data);
						
						group.calcs.top.updateData(rowData);
						group.calcs.top.reinitialize();
					}
				}
			}
		}
	}
	
	//generate top stats row
	generateTopRow(rows){
		return this.generateRow("top", this.rowsToData(rows));
	}
	//generate bottom stats row
	generateBottomRow(rows){
		return this.generateRow("bottom", this.rowsToData(rows));
	}
	
	rowsToData(rows){
		var data = [],
		hasDataTreeColumnCalcs = this.table.options.dataTree && this.table.options.dataTreeChildColumnCalcs,
		dataTree = this.table.modules.dataTree;

		rows.forEach((row) => {
			data.push(row.getData());

			if(hasDataTreeColumnCalcs && row.modules.dataTree?.open){
				this.rowsToData(dataTree.getFilteredTreeChildren(row)).forEach(dataRow =>{
					data.push(row);
				});
			}
		});
		return data;
	}
	
	//generate stats row
	generateRow(pos, data){
		var rowData = this.generateRowData(pos, data),
		row;
		
		if(this.table.modExists("mutator")){
			this.table.modules.mutator.disable();
		}
		
		row = new Row(rowData, this, "calc");
		
		if(this.table.modExists("mutator")){
			this.table.modules.mutator.enable();
		}
		
		row.getElement().classList.add("tabulator-calcs", "tabulator-calcs-" + pos);
		
		row.component = false;
		
		row.getComponent = () => {
			if(!row.component){
				row.component = new CalcComponent(row);
			}
			
			return row.component;
		};
		
		row.generateCells = () => {
			
			var cells = [];
			
			this.table.columnManager.columnsByIndex.forEach((column) => {
				
				//set field name of mock column
				this.genColumn.setField(column.getField());
				this.genColumn.hozAlign = column.hozAlign;
				
				if(column.definition[pos + "CalcFormatter"] && this.table.modExists("format")){
					this.genColumn.modules.format = {
						formatter: this.table.modules.format.lookupFormatter(column.definition[pos + "CalcFormatter"]),
						params: column.definition[pos + "CalcFormatterParams"] || {},
					};
				}else {
					this.genColumn.modules.format = {
						formatter: this.table.modules.format.lookupFormatter("plaintext"),
						params:{}
					};
				}
				
				//ensure css class definition is replicated to calculation cell
				this.genColumn.definition.cssClass = column.definition.cssClass;
				
				//generate cell and assign to correct column
				var cell = new Cell(this.genColumn, row);
				cell.getElement();
				cell.column = column;
				cell.setWidth();
				
				column.cells.push(cell);
				cells.push(cell);
				
				if(!column.visible){
					cell.hide();
				}
			});
			
			row.cells = cells;
		};
		
		return row;
	}
	
	//generate stats row
	generateRowData(pos, data){
		var rowData = {},
		calcs = pos == "top" ? this.topCalcs : this.botCalcs,
		type = pos == "top" ? "topCalc" : "botCalc",
		params, paramKey;
		
		calcs.forEach(function(column){
			var values = [];
			
			if(column.modules.columnCalcs && column.modules.columnCalcs[type]){
				data.forEach(function(item){
					values.push(column.getFieldValue(item));
				});
				
				paramKey = type + "Params";
				params = typeof column.modules.columnCalcs[paramKey] === "function" ? column.modules.columnCalcs[paramKey](values, data) : column.modules.columnCalcs[paramKey];
				
				column.setFieldValue(rowData, column.modules.columnCalcs[type](values, data, params));
			}
		});
		
		return rowData;
	}
	
	hasTopCalcs(){
		return	!!(this.topCalcs.length);
	}
	
	hasBottomCalcs(){
		return	!!(this.botCalcs.length);
	}
	
	//handle table redraw
	redraw(){
		if(this.topRow){
			this.topRow.normalizeHeight(true);
		}
		if(this.botRow){
			this.botRow.normalizeHeight(true);
		}
	}
	
	//return the calculated
	getResults(){
		var results = {},
		groups;
		
		if(this.table.options.groupBy && this.table.modExists("groupRows")){
			groups = this.table.modules.groupRows.getGroups(true);
			
			groups.forEach((group) => {
				results[group.getKey()] = this.getGroupResults(group);
			});
		}else {
			results = {
				top: this.topRow ? this.topRow.getData() : {},
				bottom: this.botRow ? this.botRow.getData() : {},
			};
		}
		
		return results;
	}
	
	//get results from a group
	getGroupResults(group){
		var groupObj = group._getSelf(),
		subGroups = group.getSubGroups(),
		subGroupResults = {},
		results = {};
		
		subGroups.forEach((subgroup) => {
			subGroupResults[subgroup.getKey()] = this.getGroupResults(subgroup);
		});
		
		results = {
			top: groupObj.calcs.top ? groupObj.calcs.top.getData() : {},
			bottom: groupObj.calcs.bottom ? groupObj.calcs.bottom.getData() : {},
			groups: subGroupResults,
		};
		
		return results;
	}
	
	adjustForScrollbar(width){
		if(this.botRow){
			if(this.table.rtl){
				this.botElement.style.paddingLeft = width + "px";
			}else {
				this.botElement.style.paddingRight = width + "px";
			}
		}
	}
}

class DataTree extends Module{

	static moduleName = "dataTree";

	constructor(table){
		super(table);

		this.indent = 10;
		this.field = "";
		this.collapseEl = null;
		this.expandEl = null;
		this.branchEl = null;
		this.elementField = false;

		this.startOpen = function(){};

		this.registerTableOption("dataTree", false); //enable data tree
		this.registerTableOption("dataTreeFilter", true); //filter child rows
		this.registerTableOption("dataTreeSort", true); //sort child rows
		this.registerTableOption("dataTreeElementColumn", false);
		this.registerTableOption("dataTreeBranchElement", true);//show data tree branch element
		this.registerTableOption("dataTreeChildIndent", 9); //data tree child indent in px
		this.registerTableOption("dataTreeChildField", "_children");//data tre column field to look for child rows
		this.registerTableOption("dataTreeCollapseElement", false);//data tree row collapse element
		this.registerTableOption("dataTreeExpandElement", false);//data tree row expand element
		this.registerTableOption("dataTreeStartExpanded", false);
		this.registerTableOption("dataTreeChildColumnCalcs", false);//include visible data tree rows in column calculations
		this.registerTableOption("dataTreeSelectPropagate", false);//selecting a parent row selects its children

		//register component functions
		this.registerComponentFunction("row", "treeCollapse", this.collapseRow.bind(this));
		this.registerComponentFunction("row", "treeExpand", this.expandRow.bind(this));
		this.registerComponentFunction("row", "treeToggle", this.toggleRow.bind(this));
		this.registerComponentFunction("row", "getTreeParent", this.getTreeParent.bind(this));
		this.registerComponentFunction("row", "getTreeChildren", this.getRowChildren.bind(this));
		this.registerComponentFunction("row", "addTreeChild", this.addTreeChildRow.bind(this));
		this.registerComponentFunction("row", "isTreeExpanded", this.isRowExpanded.bind(this));
	}

	initialize(){
		if(this.table.options.dataTree){
			var dummyEl = null,
			options = this.table.options;

			this.field = options.dataTreeChildField;
			this.indent = options.dataTreeChildIndent;

			if(this.options("movableRows")){
				console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior");
			}

			if(options.dataTreeBranchElement){

				if(options.dataTreeBranchElement === true){
					this.branchEl = document.createElement("div");
					this.branchEl.classList.add("tabulator-data-tree-branch");
				}else {
					if(typeof options.dataTreeBranchElement === "string"){
						dummyEl = document.createElement("div");
						dummyEl.innerHTML = options.dataTreeBranchElement;
						this.branchEl = dummyEl.firstChild;
					}else {
						this.branchEl = options.dataTreeBranchElement;
					}
				}
			}else {
				this.branchEl = document.createElement("div");
				this.branchEl.classList.add("tabulator-data-tree-branch-empty");
			}

			if(options.dataTreeCollapseElement){
				if(typeof options.dataTreeCollapseElement === "string"){
					dummyEl = document.createElement("div");
					dummyEl.innerHTML = options.dataTreeCollapseElement;
					this.collapseEl = dummyEl.firstChild;
				}else {
					this.collapseEl = options.dataTreeCollapseElement;
				}
			}else {
				this.collapseEl = document.createElement("div");
				this.collapseEl.classList.add("tabulator-data-tree-control");
				this.collapseEl.tabIndex = 0;
				this.collapseEl.innerHTML = "<div class='tabulator-data-tree-control-collapse'></div>";
			}

			if(options.dataTreeExpandElement){
				if(typeof options.dataTreeExpandElement === "string"){
					dummyEl = document.createElement("div");
					dummyEl.innerHTML = options.dataTreeExpandElement;
					this.expandEl = dummyEl.firstChild;
				}else {
					this.expandEl = options.dataTreeExpandElement;
				}
			}else {
				this.expandEl = document.createElement("div");
				this.expandEl.classList.add("tabulator-data-tree-control");
				this.expandEl.tabIndex = 0;
				this.expandEl.innerHTML = "<div class='tabulator-data-tree-control-expand'></div>";
			}


			switch(typeof options.dataTreeStartExpanded){
				case "boolean":
					this.startOpen = function(row, index){
						return options.dataTreeStartExpanded;
					};
					break;

				case "function":
					this.startOpen = options.dataTreeStartExpanded;
					break;

				default:
					this.startOpen = function(row, index){
						return options.dataTreeStartExpanded[index];
					};
					break;
			}

			this.subscribe("row-init", this.initializeRow.bind(this));
			this.subscribe("row-layout-after", this.layoutRow.bind(this));
			this.subscribe("row-deleting", this.rowDeleting.bind(this));
			this.subscribe("row-deleted", this.rowDelete.bind(this),0);
			this.subscribe("row-data-changed", this.rowDataChanged.bind(this), 10);
			this.subscribe("cell-value-updated", this.cellValueChanged.bind(this));
			this.subscribe("edit-cancelled", this.cellValueChanged.bind(this));
			this.subscribe("column-moving-rows", this.columnMoving.bind(this));
			this.subscribe("table-built", this.initializeElementField.bind(this));
			this.subscribe("table-redrawing", this.tableRedrawing.bind(this));

			this.registerDisplayHandler(this.getRows.bind(this), 30);
		}
	}

	tableRedrawing(force){
		var rows;

		if(force){
			rows = this.table.rowManager.getRows();
			
			rows.forEach((row) => {
				this.reinitializeRowChildren(row);
			});
		}
	}

	initializeElementField(){
		var firstCol = this.table.columnManager.getFirstVisibleColumn();

		this.elementField = this.table.options.dataTreeElementColumn || (firstCol ? firstCol.field : false);
	}
	
	getRowChildren(row){
		return this.getTreeChildren(row, true);
	}

	columnMoving(){
		var rows = [];

		this.table.rowManager.rows.forEach((row) => {
			rows = rows.concat(this.getTreeChildren(row, false, true));
		});

		return rows;
	}

	rowDataChanged(row, visible, updatedData){
		if(this.redrawNeeded(updatedData)){
			this.initializeRow(row);

			if(visible){
				this.layoutRow(row);
				this.refreshData(true);
			}
		}
	}

	cellValueChanged(cell){
		var field = cell.column.getField();

		if(field === this.elementField){
			this.layoutRow(cell.row);
		}
	}

	initializeRow(row){
		var childArray = row.getData()[this.field];
		var isArray = Array.isArray(childArray);

		var children = isArray || (!isArray && typeof childArray === "object" && childArray !== null);

		if(!children && row.modules.dataTree && row.modules.dataTree.branchEl){
			row.modules.dataTree.branchEl.parentNode.removeChild(row.modules.dataTree.branchEl);
		}

		if(!children && row.modules.dataTree && row.modules.dataTree.controlEl){
			row.modules.dataTree.controlEl.parentNode.removeChild(row.modules.dataTree.controlEl);
		}

		row.modules.dataTree = {
			index: row.modules.dataTree ? row.modules.dataTree.index : 0,
			open: children ? (row.modules.dataTree ? row.modules.dataTree.open : this.startOpen(row.getComponent(), 0)) : false,
			controlEl: row.modules.dataTree && children ? row.modules.dataTree.controlEl : false,
			branchEl: row.modules.dataTree && children ? row.modules.dataTree.branchEl : false,
			parent: row.modules.dataTree ? row.modules.dataTree.parent : false,
			children:children,
		};
	}

	reinitializeRowChildren(row){
		var children = this.getTreeChildren(row, false, true);

		children.forEach(function(child){
			child.reinitialize(true);
		});
	}

	layoutRow(row){
		var cell = this.elementField ? row.getCell(this.elementField) : row.getCells()[0],
		el = cell.getElement(),
		config = row.modules.dataTree;

		if(config.branchEl){
			if(config.branchEl.parentNode){
				config.branchEl.parentNode.removeChild(config.branchEl);
			}
			config.branchEl = false;
		}

		if(config.controlEl){
			if(config.controlEl.parentNode){
				config.controlEl.parentNode.removeChild(config.controlEl);
			}
			config.controlEl = false;
		}

		this.generateControlElement(row, el);

		row.getElement().classList.add("tabulator-tree-level-" + config.index);

		if(config.index){
			if(this.branchEl){
				config.branchEl = this.branchEl.cloneNode(true);
				el.insertBefore(config.branchEl, el.firstChild);

				if(this.table.rtl){
					config.branchEl.style.marginRight = (((config.branchEl.offsetWidth + config.branchEl.style.marginLeft) * (config.index - 1)) + (config.index * this.indent)) + "px";
				}else {
					config.branchEl.style.marginLeft = (((config.branchEl.offsetWidth + config.branchEl.style.marginRight) * (config.index - 1)) + (config.index * this.indent)) + "px";
				}
			}else {

				if(this.table.rtl){
					el.style.paddingRight = parseInt(window.getComputedStyle(el, null).getPropertyValue('padding-right')) + (config.index * this.indent) + "px";
				}else {
					el.style.paddingLeft = parseInt(window.getComputedStyle(el, null).getPropertyValue('padding-left')) + (config.index * this.indent) + "px";
				}
			}
		}
	}

	generateControlElement(row, el){
		var config = row.modules.dataTree,
		oldControl = config.controlEl;

		el = el || row.getCells()[0].getElement();

		if(config.children !== false){

			if(config.open){
				config.controlEl = this.collapseEl.cloneNode(true);
				config.controlEl.addEventListener("click", (e) => {
					e.stopPropagation();
					this.collapseRow(row);
				});
			}else {
				config.controlEl = this.expandEl.cloneNode(true);
				config.controlEl.addEventListener("click", (e) => {
					e.stopPropagation();
					this.expandRow(row);
				});
			}

			config.controlEl.addEventListener("mousedown", (e) => {
				e.stopPropagation();
			});

			if(oldControl && oldControl.parentNode === el){
				oldControl.parentNode.replaceChild(config.controlEl,oldControl);
			}else {
				el.insertBefore(config.controlEl, el.firstChild);
			}
		}
	}

	getRows(rows){
		var output = [];

		rows.forEach((row, i) => {
			var config, children;

			output.push(row);

			if(row instanceof Row){

				row.create();

				config = row.modules.dataTree;

				if(!config.index && config.children !== false){
					children = this.getChildren(row, false, true);

					children.forEach((child) => {
						child.create();
						output.push(child);
					});
				}
			}
		});

		return output;
	}

	getChildren(row, allChildren, sortOnly){
		var config = row.modules.dataTree,
		children = [],
		output = [];

		if(config.children !== false && (config.open || allChildren)){
			if(!Array.isArray(config.children)){
				config.children = this.generateChildren(row);
			}

			if(this.table.modExists("filter") && this.table.options.dataTreeFilter){
				children = this.table.modules.filter.filter(config.children);
			}else {
				children = config.children;
			}

			if(this.table.modExists("sort") && this.table.options.dataTreeSort){
				this.table.modules.sort.sort(children, sortOnly);
			}

			children.forEach((child) => {
				output.push(child);

				var subChildren = this.getChildren(child, false, true);

				subChildren.forEach((sub) => {
					output.push(sub);
				});
			});
		}

		return output;
	}

	generateChildren(row){
		var children = [];

		var childArray = row.getData()[this.field];

		if(!Array.isArray(childArray)){
			childArray = [childArray];
		}

		childArray.forEach((childData) => {
			var childRow = new Row(childData || {}, this.table.rowManager);

			childRow.create();

			childRow.modules.dataTree.index = row.modules.dataTree.index + 1;
			childRow.modules.dataTree.parent = row;

			if(childRow.modules.dataTree.children){
				childRow.modules.dataTree.open = this.startOpen(childRow.getComponent(), childRow.modules.dataTree.index);
			}
			children.push(childRow);
		});

		return children;
	}

	expandRow(row, silent){
		var config = row.modules.dataTree;

		if(config.children !== false){
			config.open = true;

			row.reinitialize();

			this.refreshData(true);

			this.dispatchExternal("dataTreeRowExpanded", row.getComponent(), row.modules.dataTree.index);
		}
	}

	collapseRow(row){
		var config = row.modules.dataTree;

		if(config.children !== false){
			config.open = false;

			row.reinitialize();

			this.refreshData(true);

			this.dispatchExternal("dataTreeRowCollapsed", row.getComponent(), row.modules.dataTree.index);
		}
	}

	toggleRow(row){
		var config = row.modules.dataTree;

		if(config.children !== false){
			if(config.open){
				this.collapseRow(row);
			}else {
				this.expandRow(row);
			}
		}
	}

	isRowExpanded(row){
		return row.modules.dataTree.open;
	}

	getTreeParent(row){
		return row.modules.dataTree.parent ? row.modules.dataTree.parent.getComponent() : false;
	}

	getTreeParentRoot(row){
		return row.modules.dataTree && row.modules.dataTree.parent ? this.getTreeParentRoot(row.modules.dataTree.parent) : row;
	}

	getFilteredTreeChildren(row){
		var config = row.modules.dataTree,
		output = [], children;

		if(config.children){

			if(!Array.isArray(config.children)){
				config.children = this.generateChildren(row);
			}

			if(this.table.modExists("filter") && this.table.options.dataTreeFilter){
				children = this.table.modules.filter.filter(config.children);
			}else {
				children = config.children;
			}

			children.forEach((childRow) => {
				if(childRow instanceof Row){
					output.push(childRow);
				}
			});
		}

		return output;
	}

	rowDeleting(row){
		var config = row.modules.dataTree;

		if (config && config.children && Array.isArray(config.children)){
			config.children.forEach((childRow) => {
				if(childRow instanceof Row){
					childRow.wipe();
				}
			});
		}
	}

	rowDelete(row){
		var parent = row.modules.dataTree.parent,
		childIndex;

		if(parent){
			childIndex = this.findChildIndex(row, parent);

			if(childIndex !== false){
				parent.data[this.field].splice(childIndex, 1);
			}

			if(!parent.data[this.field].length){
				delete parent.data[this.field];
			}

			this.initializeRow(parent);
			this.layoutRow(parent);
		}

		this.refreshData(true);
	}

	addTreeChildRow(row, data, top, index){
		var childIndex = false;

		if(typeof data === "string"){
			data = JSON.parse(data);
		}

		if(!Array.isArray(row.data[this.field])){
			row.data[this.field] = [];

			row.modules.dataTree.open = this.startOpen(row.getComponent(), row.modules.dataTree.index);
		}

		if(typeof index !== "undefined"){
			childIndex = this.findChildIndex(index, row);

			if(childIndex !== false){
				row.data[this.field].splice((top ? childIndex : childIndex + 1), 0, data);
			}
		}

		if(childIndex === false){
			if(top){
				row.data[this.field].unshift(data);
			}else {
				row.data[this.field].push(data);
			}
		}

		this.initializeRow(row);
		this.layoutRow(row);

		this.refreshData(true);
	}

	findChildIndex(subject, parent){
		var match = false;

		if(typeof subject == "object"){

			if(subject instanceof Row){
				//subject is row element
				match = subject.data;
			}else if(subject instanceof RowComponent){
				//subject is public row component
				match = subject._getSelf().data;
			}else if(typeof HTMLElement !== "undefined" && subject instanceof HTMLElement){
				if(parent.modules.dataTree){
					match = parent.modules.dataTree.children.find((childRow) => {
						return childRow instanceof Row ? childRow.element === subject : false;
					});

					if(match){
						match = match.data;
					}
				}
			}else if(subject === null){
				match = false;
			}

		}else if(typeof subject == "undefined"){
			match = false;
		}else {
			//subject should be treated as the index of the row
			match = parent.data[this.field].find((row) => {
				return row.data[this.table.options.index] == subject;
			});
		}

		if(match){

			if(Array.isArray(parent.data[this.field])){
				match = parent.data[this.field].indexOf(match);
			}

			if(match == -1){
				match = false;
			}
		}

		//catch all for any other type of input

		return match;
	}

	getTreeChildren(row, component, recurse){
		var config = row.modules.dataTree,
		output = [];

		if(config && config.children){

			if(!Array.isArray(config.children)){
				config.children = this.generateChildren(row);
			}

			config.children.forEach((childRow) => {
				if(childRow instanceof Row){
					output.push(component ? childRow.getComponent() : childRow);

					if(recurse){
						this.getTreeChildren(childRow, component, recurse).forEach(child => {
							output.push(child);
						});
					}
				}
			});
		}

		return output;
	}

	getChildField(){
		return this.field;
	}

	redrawNeeded(data){
		return (this.field ? typeof data[this.field] !== "undefined" : false) || (this.elementField ? typeof data[this.elementField] !== "undefined" : false);
	}
}

function csv$1(list, options = {}, setFileContents){
	var delimiter = options.delimiter ? options.delimiter : ",",
	fileContents = [],
	headers = [];

	list.forEach((row) => {
		var item = [];

		switch(row.type){
			case "group":
				console.warn("Download Warning - CSV downloader cannot process row groups");
				break;

			case "calc":
				console.warn("Download Warning - CSV downloader cannot process column calculations");
				break;

			case "header":
				row.columns.forEach((col, i) => {
					if(col && col.depth === 1){
						headers[i] = typeof col.value == "undefined"  || col.value === null ? "" : ('"' + String(col.value).split('"').join('""') + '"');
					}
				});
				break;

			case "row":
				row.columns.forEach((col) => {

					if(col){

						switch(typeof col.value){
							case "object":
								col.value = col.value !== null ? JSON.stringify(col.value) : "";
								break;

							case "undefined":
								col.value = "";
								break;
						}

						item.push('"' + String(col.value).split('"').join('""') + '"');
					}
				});

				fileContents.push(item.join(delimiter));
				break;
		}
	});

	if(headers.length){
		fileContents.unshift(headers.join(delimiter));
	}

	fileContents = fileContents.join("\n");

	if(options.bom){
		fileContents = "\ufeff" + fileContents;
	}

	setFileContents(fileContents, "text/csv");
}

function json$2(list, options, setFileContents){
	var fileContents = [];

	list.forEach((row) => {
		var item = {};

		switch(row.type){
			case "header":
				break;

			case "group":
				console.warn("Download Warning - JSON downloader cannot process row groups");
				break;

			case "calc":
				console.warn("Download Warning - JSON downloader cannot process column calculations");
				break;

			case "row":
				row.columns.forEach((col) => {
					if(col){
						item[col.component.getTitleDownload() || col.component.getField()] = col.value;
					}
				});

				fileContents.push(item);
				break;
		}
	});

	fileContents = JSON.stringify(fileContents, null, '\t');

	setFileContents(fileContents, "application/json");
}

function pdf(list, options = {}, setFileContents){
	var header = [],
	body = [],
	autoTableParams = {},
	rowGroupStyles = options.rowGroupStyles || {
		fontStyle: "bold",
		fontSize: 12,
		cellPadding: 6,
		fillColor: 220,
	},
	rowCalcStyles = options.rowCalcStyles || {
		fontStyle: "bold",
		fontSize: 10,
		cellPadding: 4,
		fillColor: 232,
	},
	jsPDFParams = options.jsPDF || {},
	title = options.title ? options.title : "",
	jspdfLib, doc;

	if(!jsPDFParams.orientation){
		jsPDFParams.orientation = options.orientation || "landscape";
	}

	if(!jsPDFParams.unit){
		jsPDFParams.unit = "pt";
	}

	//parse row list
	list.forEach((row) => {
		switch(row.type){
			case "header":
				header.push(parseRow(row));
				break;

			case "group":
				body.push(parseRow(row, rowGroupStyles));
				break;

			case "calc":
				body.push(parseRow(row, rowCalcStyles));
				break;

			case "row":
				body.push(parseRow(row));
				break;
		}
	});

	function parseRow(row, styles){
		var rowData = [];

		row.columns.forEach((col) =>{
			var cell;

			if(col){
				switch(typeof col.value){
					case "object":
						col.value = col.value !== null ? JSON.stringify(col.value) : "";
						break;

					case "undefined":
						col.value = "";
						break;
				}

				cell = {
					content:col.value,
					colSpan:col.width,
					rowSpan:col.height,
				};

				if(styles){
					cell.styles = styles;
				}

				rowData.push(cell);
			}
		});

		return rowData;
	}


	//configure PDF
	jspdfLib = this.dependencyRegistry.lookup("jspdf", "jsPDF");
	doc = new jspdfLib(jsPDFParams); //set document to landscape, better for most tables

	if(options.autoTable){
		if(typeof options.autoTable === "function"){
			autoTableParams = options.autoTable(doc) || {};
		}else {
			autoTableParams = options.autoTable;
		}
	}

	if(title){
		autoTableParams.didDrawPage = function(data) {
			doc.text(title, 40, 30);
		};
	}

	autoTableParams.head = header;
	autoTableParams.body = body;

	doc.autoTable(autoTableParams);

	if(options.documentProcessing){
		options.documentProcessing(doc);
	}

	setFileContents(doc.output("arraybuffer"), "application/pdf");
}

function xlsx$1(list, options, setFileContents){
	var self = this,
	sheetName = options.sheetName || "Sheet1",
	XLSXLib = this.dependencyRegistry.lookup("XLSX"),
	workbook = XLSXLib.utils.book_new(),
	tableFeatures = new CoreFeature(this),
	compression =  'compress' in options ? options.compress : true,
	writeOptions = options.writeOptions || {bookType:'xlsx', bookSST:true, compression},
	output;

	writeOptions.type = 'binary';

	workbook.SheetNames = [];
	workbook.Sheets = {};

	function generateSheet(){
		var rows = [],
		merges = [],
		worksheet = {},
		range = {s: {c:0, r:0}, e: {c:(list[0] ? list[0].columns.reduce((a, b) => a + (b && b.width ? b.width : 1), 0) : 0), r:list.length }};

		//parse row list
		list.forEach((row, i) => {
			var rowData = [];

			row.columns.forEach(function(col, j){

				if(col){
					rowData.push(!(col.value instanceof Date) && typeof col.value === "object" ? JSON.stringify(col.value) : col.value);

					if(col.width > 1 || col.height > -1){
						if(col.height > 1 || col.width > 1){
							merges.push({s:{r:i,c:j},e:{r:i + col.height - 1,c:j + col.width - 1}});
						}
					}
				}else {
					rowData.push("");
				}
			});

			rows.push(rowData);
		});

		//convert rows to worksheet
		XLSXLib.utils.sheet_add_aoa(worksheet, rows);

		worksheet['!ref'] = XLSXLib.utils.encode_range(range);

		if(merges.length){
			worksheet["!merges"] = merges;
		}

		return worksheet;
	}

	if(options.sheetOnly){
		setFileContents(generateSheet());
		return;
	}

	if(options.sheets){
		for(var sheet in options.sheets){

			if(options.sheets[sheet] === true){
				workbook.SheetNames.push(sheet);
				workbook.Sheets[sheet] = generateSheet();
			}else {

				workbook.SheetNames.push(sheet);

				tableFeatures.commsSend(options.sheets[sheet], "download", "intercept",{
					type:"xlsx",
					options:{sheetOnly:true},
					active:self.active,
					intercept:function(data){
						workbook.Sheets[sheet] = data;
					}
				});
			}
		}
	}else {
		workbook.SheetNames.push(sheetName);
		workbook.Sheets[sheetName] = generateSheet();
	}

	if(options.documentProcessing){
		workbook = options.documentProcessing(workbook);
	}

	//convert workbook to binary array
	function s2ab(s) {
		var buf = new ArrayBuffer(s.length);
		var view = new Uint8Array(buf);
		for (var i=0; i!=s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
		return buf;
	}

	output = XLSXLib.write(workbook, writeOptions);

	setFileContents(s2ab(output), "application/octet-stream");
}

function html$1(list, options, setFileContents){
	if(this.modExists("export", true)){
		setFileContents(this.modules.export.generateHTMLTable(list), "text/html");
	}
}

function jsonLines (list, options, setFileContents) {
	const fileContents = [];

	list.forEach((row) => {
		const item = {};

		switch (row.type) {
			case "header":
				break;

			case "group":
				console.warn("Download Warning - JSON downloader cannot process row groups");
				break;

			case "calc":
				console.warn("Download Warning - JSON downloader cannot process column calculations");
				break;

			case "row":
				row.columns.forEach((col) => {
					if (col) {
						item[col.component.getTitleDownload() || col.component.getField()] = col.value;
					}
				});

				fileContents.push(JSON.stringify(item));
				break;
		}
	});

	setFileContents(fileContents.join("\n"), "application/x-ndjson");
}

var defaultDownloaders = {
	csv:csv$1,
	json:json$2,
	jsonLines:jsonLines,
	pdf:pdf,
	xlsx:xlsx$1,
	html:html$1,
};

class Download extends Module{

	static moduleName = "download";

	//load defaults
	static downloaders = defaultDownloaders;

	constructor(table){
		super(table);

		this.registerTableOption("downloadEncoder", function(data, mimeType){
			return new Blob([data],{type:mimeType});
		}); //function to manipulate download data
		this.registerTableOption("downloadConfig", {}); //download config
		this.registerTableOption("downloadRowRange", "active"); //restrict download to active rows only

		this.registerColumnOption("download");
		this.registerColumnOption("titleDownload");
	}

	initialize(){
		this.deprecatedOptionsCheck();

		this.registerTableFunction("download", this.download.bind(this));
		this.registerTableFunction("downloadToTab", this.downloadToTab.bind(this));
	}

	deprecatedOptionsCheck(){

	}	

	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////

	downloadToTab(type, filename, options, active){
		this.download(type, filename, options, active, true);
	}

	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////

	//trigger file download
	download(type, filename, options, range, interceptCallback){
		var downloadFunc = false;

		function buildLink(data, mime){
			if(interceptCallback){
				if(interceptCallback === true){
					this.triggerDownload(data, mime, type, filename, true);
				}else {
					interceptCallback(data);
				}

			}else {
				this.triggerDownload(data, mime, type, filename);
			}
		}

		if(typeof type == "function"){
			downloadFunc = type;
		}else {
			if(Download.downloaders[type]){
				downloadFunc = Download.downloaders[type];
			}else {
				console.warn("Download Error - No such download type found: ", type);
			}
		}

		if(downloadFunc){
			var list = this.generateExportList(range);

			downloadFunc.call(this.table, list , options || {}, buildLink.bind(this));
		}
	}

	generateExportList(range){
		var list = this.table.modules.export.generateExportList(this.table.options.downloadConfig, false, range || this.table.options.downloadRowRange, "download");

		//assign group header formatter
		var groupHeader = this.table.options.groupHeaderDownload;

		if(groupHeader && !Array.isArray(groupHeader)){
			groupHeader = [groupHeader];
		}

		list.forEach((row) => {
			var group;

			if(row.type === "group"){
				group = row.columns[0];

				if(groupHeader && groupHeader[row.indent]){
					group.value = groupHeader[row.indent](group.value, row.component._group.getRowCount(), row.component._group.getData(), row.component);
				}
			}
		});

		return list;
	}

	triggerDownload(data, mime, type, filename, newTab){
		var element = document.createElement('a'),
		blob = this.table.options.downloadEncoder(data, mime);

		if(blob){
			if(newTab){
				window.open(window.URL.createObjectURL(blob));
			}else {
				filename = filename || "Tabulator." + (typeof type === "function" ? "txt" : type);
				
				if(navigator.msSaveOrOpenBlob){
					navigator.msSaveOrOpenBlob(blob, filename);
				}else {
					element.setAttribute('href', window.URL.createObjectURL(blob));

					//set file title
					element.setAttribute('download', filename);

					//trigger download
					element.style.display = 'none';
					document.body.appendChild(element);
					element.click();

					//remove temporary link element
					document.body.removeChild(element);
				}
			}

			this.dispatchExternal("downloadComplete");
		}
	}

	commsReceived(table, action, data){
		switch(action){
			case "intercept":
				this.download(data.type, "", data.options, data.active, data.intercept);
				break;
		}
	}
}

function maskInput(el, options){
	var mask = options.mask,
	maskLetter = typeof options.maskLetterChar !== "undefined" ? options.maskLetterChar : "A",
	maskNumber = typeof options.maskNumberChar !== "undefined" ? options.maskNumberChar : "9",
	maskWildcard = typeof options.maskWildcardChar !== "undefined" ? options.maskWildcardChar : "*";

	function fillSymbols(index){
		var symbol = mask[index];
		if(typeof symbol !== "undefined" && symbol !== maskWildcard && symbol !== maskLetter && symbol !== maskNumber){
			el.value = el.value + "" + symbol;
			fillSymbols(index+1);
		}
	}

	el.addEventListener("keydown", (e) => {
		var index = el.value.length,
		char = e.key;

		if(e.keyCode > 46 && !e.ctrlKey && !e.metaKey){
			if(index >= mask.length){
				e.preventDefault();
				e.stopPropagation();
				return false;
			}else {
				switch(mask[index]){
					case maskLetter:
						if(char.toUpperCase() == char.toLowerCase()){
							e.preventDefault();
							e.stopPropagation();
							return false;
						}
						break;

					case maskNumber:
						if(isNaN(char)){
							e.preventDefault();
							e.stopPropagation();
							return false;
						}
						break;

					case maskWildcard:
						break;

					default:
						if(char !== mask[index]){
							e.preventDefault();
							e.stopPropagation();
							return false;
						}
				}
			}
		}

		return;
	});

	el.addEventListener("keyup", (e) => {
		if(e.keyCode > 46){
			if(options.maskAutoFill){
				fillSymbols(el.value.length);
			}
		}
	});


	if(!el.placeholder){
		el.placeholder = mask;
	}

	if(options.maskAutoFill){
		fillSymbols(el.value.length);
	}
}

//input element
function input(cell, onRendered, success, cancel, editorParams){
	//create and style input
	var cellValue = cell.getValue(),
	input = document.createElement("input");

	input.setAttribute("type", editorParams.search ? "search" : "text");

	input.style.padding = "4px";
	input.style.width = "100%";
	input.style.boxSizing = "border-box";

	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				input.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}

	input.value = typeof cellValue !== "undefined" ? cellValue : "";

	onRendered(function(){
		if(cell.getType() === "cell"){
			input.focus({preventScroll: true});
			input.style.height = "100%";

			if(editorParams.selectContents){
				input.select();
			}
		}
	});

	function onChange(e){
		if(((cellValue === null || typeof cellValue === "undefined") && input.value !== "") || input.value !== cellValue){
			if(success(input.value)){
				cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
			}
		}else {
			cancel();
		}
	}

	//submit new value on blur or change
	input.addEventListener("change", onChange);
	input.addEventListener("blur", onChange);

	//submit new value on enter
	input.addEventListener("keydown", function(e){
		switch(e.keyCode){
			// case 9:
			case 13:
				onChange();
				break;

			case 27:
				cancel();
				break;

			case 35:
			case 36:
				e.stopPropagation();
				break;
		}
	});

	if(editorParams.mask){
		maskInput(input, editorParams);
	}

	return input;
}

//resizable text area element
function textarea$1(cell, onRendered, success, cancel, editorParams){
	var cellValue = cell.getValue(),
	vertNav = editorParams.verticalNavigation || "hybrid",
	value = String(cellValue !== null && typeof cellValue !== "undefined"  ? cellValue : ""),
	input = document.createElement("textarea"),
	scrollHeight = 0;

	//create and style input
	input.style.display = "block";
	input.style.padding = "2px";
	input.style.height = "100%";
	input.style.width = "100%";
	input.style.boxSizing = "border-box";
	input.style.whiteSpace = "pre-wrap";
	input.style.resize = "none";

	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				input.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}

	input.value = value;

	onRendered(function(){
		if(cell.getType() === "cell"){
			input.focus({preventScroll: true});
			input.style.height = "100%";

			input.scrollHeight;
			input.style.height = input.scrollHeight + "px";
			cell.getRow().normalizeHeight();

			if(editorParams.selectContents){
				input.select();
			}
		}
	});

	function onChange(e){

		if(((cellValue === null || typeof cellValue === "undefined") && input.value !== "") || input.value !== cellValue){

			if(success(input.value)){
				cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
			}

			setTimeout(function(){
				cell.getRow().normalizeHeight();
			},300);
		}else {
			cancel();
		}
	}

	//submit new value on blur or change
	input.addEventListener("change", onChange);
	input.addEventListener("blur", onChange);

	input.addEventListener("keyup", function(){

		input.style.height = "";

		var heightNow = input.scrollHeight;

		input.style.height = heightNow + "px";

		if(heightNow != scrollHeight){
			scrollHeight = heightNow;
			cell.getRow().normalizeHeight();
		}
	});

	input.addEventListener("keydown", function(e){

		switch(e.keyCode){

			case 13:
				if(e.shiftKey && editorParams.shiftEnterSubmit){
					onChange();
				}
				break;

			case 27:
				cancel();
				break;

			case 38: //up arrow
				if(vertNav == "editor" || (vertNav == "hybrid" && input.selectionStart)){
					e.stopImmediatePropagation();
					e.stopPropagation();
				}

				break;

			case 40: //down arrow
				if(vertNav == "editor" || (vertNav == "hybrid" && input.selectionStart !== input.value.length)){
					e.stopImmediatePropagation();
					e.stopPropagation();
				}
				break;

			case 35:
			case 36:
				e.stopPropagation();
				break;
		}
	});

	if(editorParams.mask){
		maskInput(input, editorParams);
	}

	return input;
}

//input element with type of number
function number$1(cell, onRendered, success, cancel, editorParams){
	var cellValue = cell.getValue(),
	vertNav = editorParams.verticalNavigation || "editor",
	input = document.createElement("input");

	input.setAttribute("type", "number");

	if(typeof editorParams.max != "undefined"){
		input.setAttribute("max", editorParams.max);
	}

	if(typeof editorParams.min != "undefined"){
		input.setAttribute("min", editorParams.min);
	}

	if(typeof editorParams.step != "undefined"){
		input.setAttribute("step", editorParams.step);
	}

	//create and style input
	input.style.padding = "4px";
	input.style.width = "100%";
	input.style.boxSizing = "border-box";

	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				input.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}

	input.value = cellValue;

	var blurFunc = function(e){
		onChange();
	};

	onRendered(function () {
		if(cell.getType() === "cell"){
			//submit new value on blur
			input.removeEventListener("blur", blurFunc);

			input.focus({preventScroll: true});
			input.style.height = "100%";

			//submit new value on blur
			input.addEventListener("blur", blurFunc);

			if(editorParams.selectContents){
				input.select();
			}
		}
	});

	function onChange(){
		var value = input.value;

		if(!isNaN(value) && value !==""){
			value = Number(value);
		}

		if(value !== cellValue){
			if(success(value)){
				cellValue = value; //persist value if successfully validated incase editor is used as header filter
			}
		}else {
			cancel();
		}
	}

	//submit new value on enter
	input.addEventListener("keydown", function(e){
		switch(e.keyCode){
			case 13:
			// case 9:
				onChange();
				break;

			case 27:
				cancel();
				break;

			case 38: //up arrow
			case 40: //down arrow
				if(vertNav == "editor"){
					e.stopImmediatePropagation();
					e.stopPropagation();
				}
				break;

			case 35:
			case 36:
				e.stopPropagation();
				break;
		}
	});

	if(editorParams.mask){
		maskInput(input, editorParams);
	}

	return input;
}

//input element with type of number
function range(cell, onRendered, success, cancel, editorParams){
	var cellValue = cell.getValue(),
	input = document.createElement("input");
	
	input.setAttribute("type", "range");
	
	if (typeof editorParams.max != "undefined") {
		input.setAttribute("max", editorParams.max);
	}
	
	if (typeof editorParams.min != "undefined") {
		input.setAttribute("min", editorParams.min);
	}
	
	if (typeof editorParams.step != "undefined") {
		input.setAttribute("step", editorParams.step);
	}
	
	//create and style input
	input.style.padding = "4px";
	input.style.width = "100%";
	input.style.boxSizing = "border-box";
	
	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				input.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}
	
	input.value = cellValue;
	
	onRendered(function () {
		if(cell.getType() === "cell"){
			input.focus({preventScroll: true});
			input.style.height = "100%";
		}
	});
	
	function onChange(){
		var value = input.value;
		
		if(!isNaN(value) && value !==""){
			value = Number(value);
		}
		
		if(value != cellValue){
			if(success(value)){
				cellValue = value; //persist value if successfully validated incase editor is used as header filter
			}
		}else {
			cancel();
		}
	}
	
	//submit new value on blur
	input.addEventListener("blur", function(e){
		onChange();
	});
	
	//submit new value on enter
	input.addEventListener("keydown", function(e){
		switch(e.keyCode){
			case 13:
			// case 9:
				onChange();
				break;
			
			case 27:
				cancel();
				break;
		}
	});
	
	return input;
}

//input element
function date$1(cell, onRendered, success, cancel, editorParams){
	var inputFormat = editorParams.format,
	vertNav = editorParams.verticalNavigation || "editor",
	DT = inputFormat ? (window.DateTime || luxon.DateTime) : null;
	
	//create and style input
	var cellValue = cell.getValue(),
	input = document.createElement("input");
	
	function convertDate(value){
		var newDatetime;
		
		if(DT.isDateTime(value)){
			newDatetime = value;
		}else if(inputFormat === "iso"){
			newDatetime = DT.fromISO(String(value));
		}else {
			newDatetime = DT.fromFormat(String(value), inputFormat);
		}
		
		return newDatetime.toFormat("yyyy-MM-dd");
	}
	
	input.type = "date";
	input.style.padding = "4px";
	input.style.width = "100%";
	input.style.boxSizing = "border-box";

	if(editorParams.max){
		input.setAttribute("max", inputFormat ? convertDate(editorParams.max) : editorParams.max);
	}

	if(editorParams.min){
		input.setAttribute("min", inputFormat ? convertDate(editorParams.min) : editorParams.min);
	}
	
	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				input.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}
	
	cellValue = typeof cellValue !== "undefined" ? cellValue : "";
	
	if(inputFormat){
		if(DT){		
			cellValue = convertDate(cellValue);			
		}else {
			console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js");
		}
	}
	
	input.value = cellValue;
	
	onRendered(function(){
		if(cell.getType() === "cell"){
			input.focus({preventScroll: true});
			input.style.height = "100%";
			
			if(editorParams.selectContents){
				input.select();
			}
		}
	});
	
	function onChange(){
		var value = input.value,
		luxDate;
		
		if(((cellValue === null || typeof cellValue === "undefined") && value !== "") || value !== cellValue){
			
			if(value && inputFormat){
				luxDate = DT.fromFormat(String(value), "yyyy-MM-dd");

				switch(inputFormat){
					case true:
						value = luxDate;
						break;

					case "iso":
						value = luxDate.toISO();
						break;

					default:
						value = luxDate.toFormat(inputFormat);
				}
			}
			
			if(success(value)){
				cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
			}
		}else {
			cancel();
		}
	}
	
	//submit new value on blur
	input.addEventListener("blur", function(e) {
		if (e.relatedTarget || e.rangeParent || e.explicitOriginalTarget !== input) {
			onChange(); // only on a "true" blur; not when focusing browser's date/time picker
		}
	});
	
	//submit new value on enter
	input.addEventListener("keydown", function(e){
		switch(e.keyCode){
			// case 9:
			case 13:
				onChange();
				break;
			
			case 27:
				cancel();
				break;
			
			case 35:
			case 36:
				e.stopPropagation();
				break;
			
			case 38: //up arrow
			case 40: //down arrow
				if(vertNav == "editor"){
					e.stopImmediatePropagation();
					e.stopPropagation();
				}
				break;
		}
	});
	
	return input;
}

//input element
function time$1(cell, onRendered, success, cancel, editorParams){
	var inputFormat = editorParams.format,
	vertNav = editorParams.verticalNavigation || "editor",
	DT = inputFormat ? (window.DateTime || luxon.DateTime) : null, 
	newDatetime;
	
	//create and style input
	var cellValue = cell.getValue(),
	input = document.createElement("input");
	
	input.type = "time";
	input.style.padding = "4px";
	input.style.width = "100%";
	input.style.boxSizing = "border-box";
	
	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				input.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}
	
	cellValue = typeof cellValue !== "undefined" ? cellValue : "";
	
	if(inputFormat){
		if(DT){
			if(DT.isDateTime(cellValue)){
				newDatetime = cellValue;
			}else if(inputFormat === "iso"){
				newDatetime = DT.fromISO(String(cellValue));
			}else {
				newDatetime = DT.fromFormat(String(cellValue), inputFormat);
			}
			
			cellValue = newDatetime.toFormat("HH:mm");
			
		}else {
			console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js");
		}
	}
	
	input.value = cellValue;
	
	onRendered(function(){
		if(cell.getType() == "cell"){
			input.focus({preventScroll: true});
			input.style.height = "100%";
			
			if(editorParams.selectContents){
				input.select();
			}
		}
	});
	
	function onChange(){
		var value = input.value,
		luxTime;
		
		if(((cellValue === null || typeof cellValue === "undefined") && value !== "") || value !== cellValue){
			
			if(value && inputFormat){
				luxTime = DT.fromFormat(String(value), "hh:mm");

				switch(inputFormat){
					case true:
						value = luxTime;
						break;

					case "iso":
						value = luxTime.toISO();
						break;

					default:
						value = luxTime.toFormat(inputFormat);
				}
			}
			
			if(success(value)){
				cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
			}
		}else {
			cancel();
		}
	}
	
	//submit new value on blur
	input.addEventListener("blur", function(e) {
		if (e.relatedTarget || e.rangeParent || e.explicitOriginalTarget !== input) {
			onChange(); // only on a "true" blur; not when focusing browser's date/time picker
		}
	});
	
	//submit new value on enter
	input.addEventListener("keydown", function(e){
		switch(e.keyCode){
			// case 9:
			case 13:
				onChange();
				break;
			
			case 27:
				cancel();
				break;
			
			case 35:
			case 36:
				e.stopPropagation();
				break;

			case 38: //up arrow
			case 40: //down arrow
				if(vertNav == "editor"){
					e.stopImmediatePropagation();
					e.stopPropagation();
				}
				break;
		}
	});
	
	return input;
}

//input element
function datetime$2(cell, onRendered, success, cancel, editorParams){
	var inputFormat = editorParams.format,
	vertNav = editorParams.verticalNavigation || "editor",
	DT = inputFormat ? (this.table.dependencyRegistry.lookup(["luxon", "DateTime"], "DateTime")) : null, 
	newDatetime;
	
	//create and style input
	var cellValue = cell.getValue(),
	input = document.createElement("input");
	
	input.type = "datetime-local";
	input.style.padding = "4px";
	input.style.width = "100%";
	input.style.boxSizing = "border-box";
	
	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				input.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}
	
	cellValue = typeof cellValue !== "undefined" ? cellValue : "";
	
	if(inputFormat){
		if(DT){
			if(DT.isDateTime(cellValue)){
				newDatetime = cellValue;
			}else if(inputFormat === "iso"){
				newDatetime = DT.fromISO(String(cellValue));
			}else {
				newDatetime = DT.fromFormat(String(cellValue), inputFormat);
			}
			
			cellValue = newDatetime.toFormat("yyyy-MM-dd")  + "T" + newDatetime.toFormat("HH:mm");
		}else {
			console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js");
		}
	}
	
	input.value = cellValue;
	
	onRendered(function(){
		if(cell.getType() === "cell"){
			input.focus({preventScroll: true});
			input.style.height = "100%";
			
			if(editorParams.selectContents){
				input.select();
			}
		}
	});
	
	function onChange(){
		var value = input.value,
		luxDateTime;
		
		if(((cellValue === null || typeof cellValue === "undefined") && value !== "") || value !== cellValue){

			if(value && inputFormat){
				luxDateTime = DT.fromISO(String(value));

				switch(inputFormat){
					case true:
						value = luxDateTime;
						break;

					case "iso":
						value = luxDateTime.toISO();
						break;

					default:
						value = luxDateTime.toFormat(inputFormat);
				}
			}
			
			if(success(value)){
				cellValue = input.value; //persist value if successfully validated incase editor is used as header filter
			}
		}else {
			cancel();
		}
	}
	
	//submit new value on blur
	input.addEventListener("blur", function(e) {
		if (e.relatedTarget || e.rangeParent || e.explicitOriginalTarget !== input) {
			onChange(); // only on a "true" blur; not when focusing browser's date/time picker
		}
	});
	
	//submit new value on enter
	input.addEventListener("keydown", function(e){
		switch(e.keyCode){
			// case 9:
			case 13:
				onChange();
				break;
			
			case 27:
				cancel();
				break;
			
			case 35:
			case 36:
				e.stopPropagation();
				break;

			case 38: //up arrow
			case 40: //down arrow
				if(vertNav == "editor"){
					e.stopImmediatePropagation();
					e.stopPropagation();
				}
				break;
		}
	});
	
	return input;
}

let Edit$1 = class Edit{
	constructor(editor, cell, onRendered, success, cancel, editorParams){
		this.edit = editor;
		this.table = editor.table;
		this.cell = cell;
		this.params = this._initializeParams(editorParams);
		
		this.data = [];
		this.displayItems = [];
		this.currentItems = [];
		this.focusedItem = null;
		
		this.input = this._createInputElement();
		this.listEl = this._createListElement();
		
		this.initialValues = null; 
		
		this.isFilter = cell.getType() === "header";
		
		this.filterTimeout = null;
		this.filtered = false;
		this.typing = false;
		
		this.values = []; 
		this.popup = null;  
		
		this.listIteration = 0;
		
		this.lastAction="";
		this.filterTerm="";
		
		this.blurable = true;
		
		this.actions = {
			success:success,
			cancel:cancel
		};
		
		this._deprecatedOptionsCheck();
		this._initializeValue();
		
		onRendered(this._onRendered.bind(this));
	}
	
	_deprecatedOptionsCheck(){
		// if(this.params.listItemFormatter){
		// 	this.cell.getTable().deprecationAdvisor.msg("The listItemFormatter editor param has been deprecated, please see the latest editor documentation for updated options");
		// }
		
		// if(this.params.sortValuesList){
		// 	this.cell.getTable().deprecationAdvisor.msg("The sortValuesList editor param has been deprecated, please see the latest editor documentation for updated options");
		// }
		
		// if(this.params.searchFunc){
		// 	this.cell.getTable().deprecationAdvisor.msg("The searchFunc editor param has been deprecated, please see the latest editor documentation for updated options");
		// }
		
		// if(this.params.searchingPlaceholder){
		// 	this.cell.getTable().deprecationAdvisor.msg("The searchingPlaceholder editor param has been deprecated, please see the latest editor documentation for updated options");
		// }
	}
	
	_initializeValue(){
		var initialValue = this.cell.getValue();
		
		if(typeof initialValue === "undefined" && typeof this.params.defaultValue !== "undefined"){
			initialValue = this.params.defaultValue;
		}
		
		this.initialValues = this.params.multiselect ? initialValue : [initialValue];
		
		if(this.isFilter){
			this.input.value = this.initialValues ? this.initialValues.join(",") : "";
			this.headerFilterInitialListGen();            
		}
	}
	
	_onRendered(){
		var cellEl = this.cell.getElement();
		
		function clickStop(e){
			e.stopPropagation();
		}	
		
		if(!this.isFilter){
			this.input.style.height = "100%";
			this.input.focus({preventScroll: true});
		}
		
		
		cellEl.addEventListener("click", clickStop);
		
		setTimeout(() => {
			cellEl.removeEventListener("click", clickStop);
		}, 1000);
		
		this.input.addEventListener("mousedown", this._preventPopupBlur.bind(this));
	}
	
	_createListElement(){
		var listEl = document.createElement("div");
		listEl.classList.add("tabulator-edit-list");
		
		listEl.addEventListener("mousedown", this._preventBlur.bind(this));
		listEl.addEventListener("keydown", this._inputKeyDown.bind(this));
		
		return listEl;
	}
	
	_setListWidth(){
		var element = this.isFilter ? this.input : this.cell.getElement();
		
		this.listEl.style.minWidth = element.offsetWidth + "px";
		
		if(this.params.maxWidth){
			if(this.params.maxWidth === true){
				this.listEl.style.maxWidth = element.offsetWidth + "px";
			}else if(typeof this.params.maxWidth === "number"){
				this.listEl.style.maxWidth = this.params.maxWidth + "px";
			}else {
				this.listEl.style.maxWidth = this.params.maxWidth;
			}
		}
		
	}
	
	_createInputElement(){
		var attribs = this.params.elementAttributes;
		var input = document.createElement("input");
		
		input.setAttribute("type", this.params.clearable ? "search" : "text");
		
		input.style.padding = "4px";
		input.style.width = "100%";
		input.style.boxSizing = "border-box";
		
		if(!this.params.autocomplete){
			input.style.cursor = "default";
			input.style.caretColor = "transparent";
			// input.readOnly = (this.edit.currentCell != false);
		}
		
		if(attribs && typeof attribs == "object"){
			for (let key in attribs){
				if(key.charAt(0) == "+"){
					key = key.slice(1);
					input.setAttribute(key, input.getAttribute(key) + attribs["+" + key]);
				}else {
					input.setAttribute(key, attribs[key]);
				}
			}
		}
		
		if(this.params.mask){
			maskInput(input, this.params);
		}
		
		this._bindInputEvents(input);
		
		return input;
	}
	
	_initializeParams(params){
		var valueKeys = ["values", "valuesURL", "valuesLookup"],
		valueCheck;
		
		params = Object.assign({}, params);
		
		params.verticalNavigation = params.verticalNavigation || "editor";
		params.placeholderLoading = typeof params.placeholderLoading === "undefined" ? "Searching ..." : params.placeholderLoading;
		params.placeholderEmpty = typeof params.placeholderEmpty === "undefined" ? "No Results Found" : params.placeholderEmpty;
		params.filterDelay = typeof params.filterDelay === "undefined" ? 300 : params.filterDelay;
		
		params.emptyValue = Object.keys(params).includes("emptyValue") ? params.emptyValue : "";
		
		valueCheck = Object.keys(params).filter(key => valueKeys.includes(key)).length;
		
		if(!valueCheck){
			console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set");
		}else if(valueCheck > 1){
			console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor");
		}
		
		if(params.autocomplete){
			if(params.multiselect){
				params.multiselect = false;
				console.warn("list editor config error - multiselect option is not available when autocomplete is enabled");
			}
		}else {
			if(params.freetext){
				params.freetext = false;
				console.warn("list editor config error - freetext option is only available when autocomplete is enabled");
			}
			
			if(params.filterFunc){
				params.filterFunc = false;
				console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled");
			}
			
			if(params.filterRemote){
				params.filterRemote = false;
				console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled");
			}
			
			if(params.mask){
				params.mask = false;
				console.warn("list editor config error - mask option is only available when autocomplete is enabled");
			}
			
			if(params.allowEmpty){
				params.allowEmpty = false;
				console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled");
			}
			
			if(params.listOnEmpty){
				params.listOnEmpty = false;
				console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled");
			}
		}
		
		if(params.filterRemote && !(typeof params.valuesLookup === "function" || params.valuesURL)){
			params.filterRemote = false;
			console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source");
		}
		return params;
	}
	//////////////////////////////////////
	////////// Event Handling ////////////
	//////////////////////////////////////
	
	_bindInputEvents(input){
		input.addEventListener("focus", this._inputFocus.bind(this));
		input.addEventListener("click", this._inputClick.bind(this));
		input.addEventListener("blur", this._inputBlur.bind(this));
		input.addEventListener("keydown", this._inputKeyDown.bind(this));
		input.addEventListener("search", this._inputSearch.bind(this));
		
		if(this.params.autocomplete){
			input.addEventListener("keyup", this._inputKeyUp.bind(this));
		}
	}
	
	
	_inputFocus(e){
		this.rebuildOptionsList();
	}
	
	_filter(){
		if(this.params.filterRemote){
			clearTimeout(this.filterTimeout);
			
			this.filterTimeout = setTimeout(() => {
				this.rebuildOptionsList();
			}, this.params.filterDelay);
		}else {
			this._filterList();
		}
	}
	
	_inputClick(e){
		e.stopPropagation();
	}
	
	_inputBlur(e){
		if(this.blurable){
			if(this.popup){
				this.popup.hide();
			}else {
				this._resolveValue(true);
			}
		}
	}
	
	_inputSearch(){
		this._clearChoices();
	}
	
	_inputKeyDown(e){
		switch(e.keyCode){
			
			case 38: //up arrow
				this._keyUp(e);
				break;
			
			case 40: //down arrow
				this._keyDown(e);
				break;
			
			case 37: //left arrow
			case 39: //right arrow
				this._keySide(e);
				break;
			
			case 13: //enter
				this._keyEnter();
				break;
			
			case 27: //escape
				this._keyEsc();
				break;
			
			case 36: //home
			case 35: //end
				this._keyHomeEnd(e);
				break;
			
			case 9: //tab
				this._keyTab(e);
				break;
			
			default:
				this._keySelectLetter(e);
		}
	}
	
	_inputKeyUp(e){
		switch(e.keyCode){
			case 38: //up arrow
			case 37: //left arrow
			case 39: //up arrow
			case 40: //right arrow
			case 13: //enter
			case 27: //escape
				break;
			
			default:
				this._keyAutoCompLetter(e);
		}
	}
	
	_preventPopupBlur(){
		if(this.popup){
			this.popup.blockHide();
		}
		
		setTimeout(() =>{
			if(this.popup){
				this.popup.restoreHide();
			}
		}, 10);
	}
	
	_preventBlur(){
		this.blurable = false;
		
		setTimeout(() =>{
			this.blurable = true;
		}, 10);
	}
	
	//////////////////////////////////////
	//////// Keyboard Navigation /////////
	//////////////////////////////////////
	
	_keyTab(e){
		if(this.params.autocomplete && this.lastAction === "typing"){
			this._resolveValue(true);
		}else {
			if(this.focusedItem){
				this._chooseItem(this.focusedItem, true);
			}
		}
	}
	
	_keyUp(e){
		var index = this.displayItems.indexOf(this.focusedItem);
		
		if(this.params.verticalNavigation == "editor" || (this.params.verticalNavigation == "hybrid" && index)){
			e.stopImmediatePropagation();
			e.stopPropagation();
			e.preventDefault();
			
			if(index > 0){
				this._focusItem(this.displayItems[index - 1]);
			}
		}
	}
	
	_keyDown(e){
		var index = this.displayItems.indexOf(this.focusedItem);
		
		if(this.params.verticalNavigation == "editor" || (this.params.verticalNavigation == "hybrid" && index < this.displayItems.length - 1)){
			e.stopImmediatePropagation();
			e.stopPropagation();
			e.preventDefault();
			
			if(index < this.displayItems.length - 1){
				if(index == -1){
					this._focusItem(this.displayItems[0]);
				}else {
					this._focusItem(this.displayItems[index + 1]);
				}
			}
		}
	}
	
	_keySide(e){
		if(!this.params.autocomplete){
			e.stopImmediatePropagation();
			e.stopPropagation();
			e.preventDefault();
		}
	}
	
	_keyEnter(e){
		if(this.params.autocomplete && this.lastAction === "typing"){
			this._resolveValue(true);
		}else {
			if(this.focusedItem){
				this._chooseItem(this.focusedItem);
			}
		}
	}
	
	_keyEsc(e){
		this._cancel();
	}
	
	_keyHomeEnd(e){
		if(this.params.autocomplete){
			//prevent table navigation while using input element
			e.stopImmediatePropagation();
		}
	}
	
	_keySelectLetter(e){
		if(!this.params.autocomplete){
			// if(this.edit.currentCell === false){
			e.preventDefault();
			// }
			
			if(e.keyCode >= 38 && e.keyCode <= 90){
				this._scrollToValue(e.keyCode);
			}
		}
	}
	
	_keyAutoCompLetter(e){
		this._filter();
		this.lastAction = "typing";
		this.typing = true;
	}
	
	
	_scrollToValue(char){
		clearTimeout(this.filterTimeout);
		
		var character = String.fromCharCode(char).toLowerCase();
		this.filterTerm += character.toLowerCase();
		
		var match = this.displayItems.find((item) => {
			return typeof item.label !== "undefined" && item.label.toLowerCase().startsWith(this.filterTerm);
		});
		
		if(match){
			this._focusItem(match);
		}
		
		this.filterTimeout = setTimeout(() => {
			this.filterTerm = "";
		}, 800);
	}
	
	_focusItem(item){
		this.lastAction = "focus";
		
		if(this.focusedItem && this.focusedItem.element){
			this.focusedItem.element.classList.remove("focused");
		}
		
		this.focusedItem = item;
		
		if(item && item.element){
			item.element.classList.add("focused");
			item.element.scrollIntoView({behavior: 'smooth', block: 'nearest', inline: 'start'});
		}
	}
	
	
	//////////////////////////////////////
	/////// Data List Generation /////////
	//////////////////////////////////////
	headerFilterInitialListGen(){
		this._generateOptions(true);
	}
	
	rebuildOptionsList(){
		this._generateOptions()
			.then(this._sortOptions.bind(this))
			.then(this._buildList.bind(this))
			.then(this._showList.bind(this))
			.catch((e) => {
				if(!Number.isInteger(e)){
					console.error("List generation error", e);
				}
			});
	}
	
	_filterList(){
		this._buildList(this._filterOptions());
		this._showList();
	}
	
	_generateOptions(silent){
		var values = [];
		var iteration = ++ this.listIteration;
		
		this.filtered = false;
		
		if(this.params.values){
			values = this.params.values;
		}else if (this.params.valuesURL){
			values = this._ajaxRequest(this.params.valuesURL, this.input.value);
		}else {
			if(typeof this.params.valuesLookup === "function"){
				values = this.params.valuesLookup(this.cell, this.input.value);
			}else if(this.params.valuesLookup){
				values = this._uniqueColumnValues(this.params.valuesLookupField);
			}
		}
		
		if(values instanceof Promise){
			if(!silent){
				this._addPlaceholder(this.params.placeholderLoading);
			}
			
			return values.then()
				.then((responseValues) => {
					if(this.listIteration === iteration){
						return this._parseList(responseValues);
					}else {
						return Promise.reject(iteration);
					}
				});
		}else {
			return Promise.resolve(this._parseList(values));
		}
	}
	
	_addPlaceholder(contents){
		var placeholder = document.createElement("div");
		
		if(typeof contents === "function"){
			contents = contents(this.cell.getComponent(), this.listEl);
		}
		
		if(contents){
			this._clearList();
			
			if(contents instanceof HTMLElement){
				placeholder = contents;
			}else {
				placeholder.classList.add("tabulator-edit-list-placeholder");
				placeholder.innerHTML = contents;
			}
			
			this.listEl.appendChild(placeholder);
			
			this._showList();
		}
	}
	
	_ajaxRequest(url, term){
		var params = this.params.filterRemote ? {term:term} : {};
		url = urlBuilder(url, {}, params);
		
		return fetch(url)
			.then((response)=>{
				if(response.ok) {
					return response.json()
						.catch((error)=>{
							console.warn("List Ajax Load Error - Invalid JSON returned", error);
							return Promise.reject(error);
						});
				}else {
					console.error("List Ajax Load Error - Connection Error: " + response.status, response.statusText);
					return Promise.reject(response);
				}
			})
			.catch((error)=>{
				console.error("List Ajax Load Error - Connection Error: ", error);
				return Promise.reject(error);
			});
	}
	
	_uniqueColumnValues(field){
		var output = {},
		data = this.table.getData(this.params.valuesLookup),
		column;
		
		if(field){
			column = this.table.columnManager.getColumnByField(field);
		}else {
			column = this.cell.getColumn()._getSelf();
		}
		
		if(column){
			data.forEach((row) => {
				var val = column.getFieldValue(row);
				
				if(!this._emptyValueCheck(val)){
					if(this.params.multiselect && Array.isArray(val)){
						val.forEach((item) => {
							if(!this._emptyValueCheck(item)){
								output[item] = true;
							}
						});
					}else {
						output[val] = true;
					}
					
				}
			});
		}else {
			console.warn("unable to find matching column to create select lookup list:", field);
			output = [];
		}
		
		return Object.keys(output);
	}

	_emptyValueCheck(value){
		return value === null || typeof value === "undefined" || value === "";
	}
	
	_parseList(inputValues){
		var data = [];
		
		if(!Array.isArray(inputValues)){
			inputValues = Object.entries(inputValues).map(([key, value]) => {
				return {
					label:value,
					value:key,
				};
			});
		}
		
		inputValues.forEach((value) => {
			if(typeof value !== "object"){
				value = {
					label:value,
					value:value,
				};
			}
			
			this._parseListItem(value, data, 0);
		});
		
		if(!this.currentItems.length && this.params.freetext){
			this.input.value = this.initialValues;
			this.typing = true;
			this.lastAction = "typing";
		}
		
		this.data = data;
		
		return data;    
	}
	
	_parseListItem(option, data, level){
		var item = {};
		
		if(option.options){
			item = this._parseListGroup(option, level + 1);
		}else {
			item = {
				label:option.label,
				value:option.value,
				itemParams:option.itemParams,
				elementAttributes: option.elementAttributes,
				element:false,
				selected:false,
				visible:true,
				level:level,
				original:option,
			};
			
			if(this.initialValues && this.initialValues.indexOf(option.value) > -1){
				this._chooseItem(item, true);
			}
		}
		
		data.push(item);
	}
	
	_parseListGroup(option, level){
		var item = {
			label:option.label,
			group:true,
			itemParams:option.itemParams,
			elementAttributes:option.elementAttributes,
			element:false,
			visible:true,
			level:level,
			options:[],
			original:option,
		};
		
		option.options.forEach((child) => {
			this._parseListItem(child, item.options, level);
		});
		
		return item;
	}
	
	_sortOptions(options){
		var sorter;
		
		if(this.params.sort){
			sorter = typeof this.params.sort === "function" ? this.params.sort : this._defaultSortFunction.bind(this);
			
			this._sortGroup(sorter, options);
		}
		
		return options;
	}
	
	_sortGroup(sorter, options){
		options.sort((a,b) => {
			return sorter(a.label, b.label, a.value, b.value, a.original, b.original);
		});
		
		options.forEach((option) => {
			if(option.group){
				this._sortGroup(sorter, option.options);
			}
		});
	}
	
	_defaultSortFunction(as, bs){
		var a, b, a1, b1, i= 0, L, rx = /(\d+)|(\D+)/g, rd = /\d/;
		var emptyAlign = 0;
		
		if(this.params.sort === "desc"){
			[as, bs] = [bs, as];
		}
		
		//handle empty values
		if(!as && as!== 0){
			emptyAlign =  !bs && bs!== 0 ? 0 : -1;
		}else if(!bs && bs!== 0){
			emptyAlign =  1;
		}else {
			if(isFinite(as) && isFinite(bs)) return as - bs;
			a = String(as).toLowerCase();
			b = String(bs).toLowerCase();
			if(a === b) return 0;
			if(!(rd.test(a) && rd.test(b))) return a > b ? 1 : -1;
			a = a.match(rx);
			b = b.match(rx);
			L = a.length > b.length ? b.length : a.length;
			while(i < L){
				a1= a[i];
				b1= b[i++];
				if(a1 !== b1){
					if(isFinite(a1) && isFinite(b1)){
						if(a1.charAt(0) === "0") a1 = "." + a1;
						if(b1.charAt(0) === "0") b1 = "." + b1;
						return a1 - b1;
					}
					else return a1 > b1 ? 1 : -1;
				}
			}
			
			return a.length > b.length;
		}
		
		return emptyAlign;
	}
	
	_filterOptions(){
		var filterFunc = this.params.filterFunc || this._defaultFilterFunc,
		term = this.input.value;
		
		if(term){
			this.filtered = true;
			
			this.data.forEach((item) => {
				this._filterItem(filterFunc, term, item);
			});
		}else {
			this.filtered = false;
		}
		
		return this.data;
	}
	
	_filterItem(func, term, item){
		var matches = false;
		
		if(!item.group){
			item.visible = func(term, item.label, item.value, item.original);
		}else {
			item.options.forEach((option) => {
				if(this._filterItem(func, term, option)){
					matches = true;
				}
			});
			
			item.visible = matches;
		}
		
		return item.visible;
	}
	
	_defaultFilterFunc(term, label, value, item){
		term = String(term).toLowerCase();
		
		if(label !== null && typeof label !== "undefined"){
			if(String(label).toLowerCase().indexOf(term) > -1 || String(value).toLowerCase().indexOf(term) > -1){
				return true;
			}
		}
		
		return false;
	}
	
	//////////////////////////////////////
	/////////// Display List /////////////
	//////////////////////////////////////
	
	_clearList(){
		while(this.listEl.firstChild) this.listEl.removeChild(this.listEl.firstChild);
		
		this.displayItems = [];
	}
	
	_buildList(data){
		this._clearList();
		
		data.forEach((option) => {
			this._buildItem(option);
		});
		
		if(!this.displayItems.length){
			this._addPlaceholder(this.params.placeholderEmpty);
		}  
	}
	
	_buildItem(item){
		var el = item.element,
		contents;
		
		if(!this.filtered || item.visible){
			
			if(!el){
				el = document.createElement("div");
				el.tabIndex = 0;
				
				contents = this.params.itemFormatter ? this.params.itemFormatter(item.label, item.value, item.original, el) : item.label;
				
				if(contents instanceof HTMLElement){
					el.appendChild(contents);
				}else {
					el.innerHTML = contents;
				}
				
				if(item.group){
					el.classList.add("tabulator-edit-list-group");
				}else {
					el.classList.add("tabulator-edit-list-item");
				}
				
				el.classList.add("tabulator-edit-list-group-level-" + item.level);
				
				if(item.elementAttributes && typeof item.elementAttributes == "object"){
					for (let key in item.elementAttributes){
						if(key.charAt(0) == "+"){
							key = key.slice(1);
							el.setAttribute(key, this.input.getAttribute(key) + item.elementAttributes["+" + key]);
						}else {
							el.setAttribute(key, item.elementAttributes[key]);
						}
					}
				}
				
				if(item.group){
					el.addEventListener("click", this._groupClick.bind(this, item));
				}else {
					el.addEventListener("click", this._itemClick.bind(this, item));
				}
				
				el.addEventListener("mousedown", this._preventBlur.bind(this));
				
				item.element = el;
			}
			
			this._styleItem(item);
			
			this.listEl.appendChild(el);
			
			if(item.group){
				item.options.forEach((option) => {
					this._buildItem(option);
				});
			}else {
				this.displayItems.push(item);
			}
		}
	}
	
	_showList(){
		var startVis = this.popup && this.popup.isVisible();
		
		if(this.input.parentNode){
			if(this.params.autocomplete && this.input.value === "" && !this.params.listOnEmpty){
				if(this.popup){
					this.popup.hide(true);
				}
				return;
			}
			
			this._setListWidth();
			
			if(!this.popup){
				this.popup = this.edit.popup(this.listEl);
			}
			
			this.popup.show(this.cell.getElement(), "bottom");
			
			if(!startVis){
				setTimeout(() => {
					this.popup.hideOnBlur(this._resolveValue.bind(this, true));
				}, 10);
			}
		}
	}
	
	_styleItem(item){
		if(item && item.element){
			if(item.selected){
				item.element.classList.add("active");
			}else {
				item.element.classList.remove("active");
			}
		}
	}
	
	//////////////////////////////////////
	///////// User Interaction ///////////
	//////////////////////////////////////
	
	_itemClick(item, e){
		e.stopPropagation();
		
		this._chooseItem(item);
	}
	
	_groupClick(item, e){
		e.stopPropagation();
	}
	
	
	//////////////////////////////////////
	////// Current Item Management ///////
	//////////////////////////////////////
	
	_cancel(){
		this.popup.hide(true);
		this.actions.cancel();
	}
	
	_clearChoices(){
		this.typing = true;
		
		this.currentItems.forEach((item) => {
			item.selected = false;
			this._styleItem(item);
		});
		
		this.currentItems = [];
		
		this.focusedItem = null;
	}
	
	_chooseItem(item, silent){
		var index;
		
		this.typing = false;
		
		if(this.params.multiselect){
			index = this.currentItems.indexOf(item);
			
			if(index > -1){
				this.currentItems.splice(index, 1);
				item.selected = false;
			}else {
				this.currentItems.push(item);
				item.selected = true;
			}
			
			this.input.value = this.currentItems.map(item => item.label).join(",");
			
			this._styleItem(item);
			
		}else {
			this.currentItems = [item];
			item.selected = true;
			
			this.input.value = item.label;
			
			this._styleItem(item);
			
			if(!silent){
				this._resolveValue();
			}
		}
		
		this._focusItem(item);
	}
	
	_resolveValue(blur){
		var output, initialValue;
		
		if(this.popup){
			this.popup.hide(true);
		}
		
		if(this.params.multiselect){
			output = this.currentItems.map(item => item.value);
		}else {
			if(blur && this.params.autocomplete && this.typing){
				if(this.params.freetext || (this.params.allowEmpty && this.input.value === "")){
					output = this.input.value;
				}else {
					this.actions.cancel();
					return;
				}
			}else {
				if(this.currentItems[0]){
					output = this.currentItems[0].value;
				}else {
					initialValue = Array.isArray(this.initialValues) ? this.initialValues[0] : this.initialValues;
					
					if(initialValue === null || typeof initialValue === "undefined" || initialValue === ""){
						output = initialValue;
					}else {
						output = this.params.emptyValue;
					}
				}
				
			}
		}
		
		if(output === ""){
			output = this.params.emptyValue;
		}
		
		this.actions.success(output);
		
		if(this.isFilter){
			this.initialValues = output && !Array.isArray(output) ? [output] : output;
			this.currentItems = [];
		}
	}
	
};

function list(cell, onRendered, success, cancel, editorParams){
	var list = new Edit$1(this, cell, onRendered, success, cancel, editorParams);

	return list.input;
}

//star rating
function star$1(cell, onRendered, success, cancel, editorParams){
	var self = this,
	element = cell.getElement(),
	value = cell.getValue(),
	maxStars = element.getElementsByTagName("svg").length || 5,
	size = element.getElementsByTagName("svg")[0] ? element.getElementsByTagName("svg")[0].getAttribute("width") : 14,
	stars = [],
	starsHolder = document.createElement("div"),
	star = document.createElementNS('http://www.w3.org/2000/svg', "svg");


	//change star type
	function starChange(val){
		stars.forEach(function(star, i){
			if(i < val){
				if(self.table.browser == "ie"){
					star.setAttribute("class", "tabulator-star-active");
				}else {
					star.classList.replace("tabulator-star-inactive", "tabulator-star-active");
				}

				star.innerHTML = '<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';
			}else {
				if(self.table.browser == "ie"){
					star.setAttribute("class", "tabulator-star-inactive");
				}else {
					star.classList.replace("tabulator-star-active", "tabulator-star-inactive");
				}

				star.innerHTML = '<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';
			}
		});
	}

	//build stars
	function buildStar(i){

		var starHolder =  document.createElement("span");
		var nextStar = star.cloneNode(true);

		stars.push(nextStar);

		starHolder.addEventListener("mouseenter", function(e){
			e.stopPropagation();
			e.stopImmediatePropagation();
			starChange(i);
		});

		starHolder.addEventListener("mousemove", function(e){
			e.stopPropagation();
			e.stopImmediatePropagation();
		});

		starHolder.addEventListener("click", function(e){
			e.stopPropagation();
			e.stopImmediatePropagation();
			success(i);
			element.blur();
		});

		starHolder.appendChild(nextStar);
		starsHolder.appendChild(starHolder);

	}

	//handle keyboard navigation value change
	function changeValue(val){
		value = val;
		starChange(val);
	}

	//style cell
	element.style.whiteSpace = "nowrap";
	element.style.overflow = "hidden";
	element.style.textOverflow = "ellipsis";

	//style holding element
	starsHolder.style.verticalAlign = "middle";
	starsHolder.style.display = "inline-block";
	starsHolder.style.padding = "4px";

	//style star
	star.setAttribute("width", size);
	star.setAttribute("height", size);
	star.setAttribute("viewBox", "0 0 512 512");
	star.setAttribute("xml:space", "preserve");
	star.style.padding = "0 1px";

	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				starsHolder.setAttribute(key, starsHolder.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				starsHolder.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}

	//create correct number of stars
	for(var i=1;i<= maxStars;i++){
		buildStar(i);
	}

	//ensure value does not exceed number of stars
	value = Math.min(parseInt(value), maxStars);

	// set initial styling of stars
	starChange(value);

	starsHolder.addEventListener("mousemove", function(e){
		starChange(0);
	});

	starsHolder.addEventListener("click", function(e){
		success(0);
	});

	element.addEventListener("blur", function(e){
		cancel();
	});

	//allow key based navigation
	element.addEventListener("keydown", function(e){
		switch(e.keyCode){
			case 39: //right arrow
				changeValue(value + 1);
				break;

			case 37: //left arrow
				changeValue(value - 1);
				break;

			case 13: //enter
				success(value);
				break;

			case 27: //escape
				cancel();
				break;
		}
	});

	return starsHolder;
}

//draggable progress bar
function progress$1(cell, onRendered, success, cancel, editorParams){
	var element = cell.getElement(),
	max = typeof editorParams.max === "undefined" ? ((element.getElementsByTagName("div")[0] && element.getElementsByTagName("div")[0].getAttribute("max")) || 100) : editorParams.max,
	min = typeof editorParams.min === "undefined" ? ((element.getElementsByTagName("div")[0] && element.getElementsByTagName("div")[0].getAttribute("min")) || 0) : editorParams.min,
	percent = (max - min) / 100,
	value = cell.getValue() || 0,
	handle = document.createElement("div"),
	bar = document.createElement("div"),
	mouseDrag, mouseDragWidth;

	//set new value
	function updateValue(){
		var style = window.getComputedStyle(element, null);

		var calcVal = (percent * Math.round(bar.offsetWidth / ((element.clientWidth - parseInt(style.getPropertyValue("padding-left")) - parseInt(style.getPropertyValue("padding-right")))/100))) + min;
		success(calcVal);
		element.setAttribute("aria-valuenow", calcVal);
		element.setAttribute("aria-label", value);
	}

	//style handle
	handle.style.position = "absolute";
	handle.style.right = "0";
	handle.style.top = "0";
	handle.style.bottom = "0";
	handle.style.width = "5px";
	handle.classList.add("tabulator-progress-handle");

	//style bar
	bar.style.display = "inline-block";
	bar.style.position = "relative";
	// bar.style.top = "8px";
	// bar.style.bottom = "8px";
	// bar.style.left = "4px";
	// bar.style.marginRight = "4px";
	bar.style.height = "100%";
	bar.style.backgroundColor = "#488CE9";
	bar.style.maxWidth = "100%";
	bar.style.minWidth = "0%";

	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				bar.setAttribute(key, bar.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				bar.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}

	//style cell
	element.style.padding = "4px 4px";

	//make sure value is in range
	value = Math.min(parseFloat(value), max);
	value = Math.max(parseFloat(value), min);

	//workout percentage
	value = Math.round((value - min) / percent);
	// bar.style.right = value + "%";
	bar.style.width = value + "%";

	element.setAttribute("aria-valuemin", min);
	element.setAttribute("aria-valuemax", max);

	bar.appendChild(handle);

	handle.addEventListener("mousedown", function(e){
		mouseDrag = e.screenX;
		mouseDragWidth = bar.offsetWidth;
	});

	handle.addEventListener("mouseover", function(){
		handle.style.cursor = "ew-resize";
	});

	element.addEventListener("mousemove", function(e){
		if(mouseDrag){
			bar.style.width = (mouseDragWidth + e.screenX - mouseDrag) + "px";
		}
	});

	element.addEventListener("mouseup", function(e){
		if(mouseDrag){
			e.stopPropagation();
			e.stopImmediatePropagation();

			mouseDrag = false;
			mouseDragWidth = false;

			updateValue();
		}
	});

	//allow key based navigation
	element.addEventListener("keydown", function(e){
		switch(e.keyCode){
			case 39: //right arrow
				e.preventDefault();
				bar.style.width = (bar.clientWidth + element.clientWidth/100) + "px";
				break;

			case 37: //left arrow
				e.preventDefault();
				bar.style.width = (bar.clientWidth - element.clientWidth/100) + "px";
				break;

			case 9: //tab
			case 13: //enter
				updateValue();
				break;

			case 27: //escape
				cancel();
				break;

		}
	});

	element.addEventListener("blur", function(){
		cancel();
	});

	return bar;
}

//checkbox
function tickCross$1(cell, onRendered, success, cancel, editorParams){
	var value = cell.getValue(),
	input = document.createElement("input"),
	tristate = editorParams.tristate,
	indetermValue = typeof editorParams.indeterminateValue === "undefined" ? null : editorParams.indeterminateValue,
	indetermState = false,
	trueValueSet = Object.keys(editorParams).includes("trueValue"),
	falseValueSet = Object.keys(editorParams).includes("falseValue");
	
	input.setAttribute("type", "checkbox");
	input.style.marginTop = "5px";
	input.style.boxSizing = "border-box";
	
	if(editorParams.elementAttributes && typeof editorParams.elementAttributes == "object"){
		for (let key in editorParams.elementAttributes){
			if(key.charAt(0) == "+"){
				key = key.slice(1);
				input.setAttribute(key, input.getAttribute(key) + editorParams.elementAttributes["+" + key]);
			}else {
				input.setAttribute(key, editorParams.elementAttributes[key]);
			}
		}
	}
	
	input.value = value;
	
	if(tristate && (typeof value === "undefined" || value === indetermValue || value === "")){
		indetermState = true;
		input.indeterminate = true;
	}
	
	if(this.table.browser != "firefox" && this.table.browser != "safari"){ //prevent blur issue on mac firefox
		onRendered(function(){
			if(cell.getType() === "cell"){
				input.focus({preventScroll: true});
			}
		});
	}
	
	input.checked = trueValueSet ? value === editorParams.trueValue : (value === true || value === "true" || value === "True" || value === 1);
	
	function setValue(blur){
		var checkedValue = input.checked;
		
		if(trueValueSet && checkedValue){
			checkedValue = editorParams.trueValue;
		}else if(falseValueSet && !checkedValue){
			checkedValue = editorParams.falseValue;
		}
		
		if(tristate){
			if(!blur){
				if(input.checked && !indetermState){
					input.checked = false;
					input.indeterminate = true;
					indetermState = true;
					return indetermValue;
				}else {
					indetermState = false;
					return checkedValue;
				}
			}else {
				if(indetermState){
					return indetermValue;
				}else {
					return checkedValue;
				}
			}
		}else {
			return checkedValue;
		}
	}
	
	//submit new value on blur
	input.addEventListener("change", function(e){
		success(setValue());
	});

	input.addEventListener("blur", function(e){
		success(setValue(true));
	});
	
	//submit new value on enter
	input.addEventListener("keydown", function(e){
		if(e.keyCode == 13){
			success(setValue());
		}
		if(e.keyCode == 27){
			cancel();
		}
	});
	
	return input;
}

function adaptable$1(cell, onRendered, success, cancel, params){
	var column = cell._getSelf().column,
	lookup, editorFunc, editorParams;
    
	function defaultLookup(cell){
		var value = cell.getValue(),
		editor = "input";
        
		switch(typeof value){
			case "number":
				editor = "number";
				break;
            
			case "boolean":
				editor = "tickCross";
				break;
            
			case "string":
				if(value.includes("\n")){
					editor = "textarea";
				}
				break;
		}
        
		return editor;
	}
    
	lookup = params.editorLookup ? params.editorLookup(cell) : defaultLookup(cell);

	if(params.paramsLookup){
		editorParams = typeof params.paramsLookup === "function" ? params.paramsLookup(lookup, cell) : params.paramsLookup[lookup];
	}

	editorFunc = this.table.modules.edit.lookupEditor(lookup, column);
    
	return  editorFunc.call(this, cell, onRendered, success, cancel, editorParams || {});
}

var defaultEditors = {
	input:input,
	textarea:textarea$1,
	number:number$1,
	range:range,
	date:date$1,
	time:time$1,
	datetime:datetime$2,
	list:list,
	star:star$1,
	progress:progress$1,
	tickCross:tickCross$1,
	adaptable:adaptable$1,
};

class Edit extends Module{

	static moduleName = "edit";

	//load defaults
	static editors = defaultEditors;
	
	constructor(table){
		super(table);
		
		this.currentCell = false; //hold currently editing cell
		this.mouseClick = false; //hold mousedown state to prevent click binding being overridden by editor opening
		this.recursionBlock = false; //prevent focus recursion
		this.invalidEdit = false;
		this.editedCells = [];
		this.convertEmptyValues = false;
		
		this.editors = Edit.editors;
	
		this.registerTableOption("editTriggerEvent", "focus");
		this.registerTableOption("editorEmptyValue");
		this.registerTableOption("editorEmptyValueFunc", this.emptyValueCheck.bind(this));

		this.registerColumnOption("editable");
		this.registerColumnOption("editor");
		this.registerColumnOption("editorParams");
		this.registerColumnOption("editorEmptyValue");
		this.registerColumnOption("editorEmptyValueFunc");
		
		this.registerColumnOption("cellEditing");
		this.registerColumnOption("cellEdited");
		this.registerColumnOption("cellEditCancelled");
		
		this.registerTableFunction("getEditedCells", this.getEditedCells.bind(this));
		this.registerTableFunction("clearCellEdited", this.clearCellEdited.bind(this));
		this.registerTableFunction("navigatePrev", this.navigatePrev.bind(this));
		this.registerTableFunction("navigateNext", this.navigateNext.bind(this));
		this.registerTableFunction("navigateLeft", this.navigateLeft.bind(this));
		this.registerTableFunction("navigateRight", this.navigateRight.bind(this));
		this.registerTableFunction("navigateUp", this.navigateUp.bind(this));
		this.registerTableFunction("navigateDown", this.navigateDown.bind(this));
		
		this.registerComponentFunction("cell", "isEdited", this.cellIsEdited.bind(this));
		this.registerComponentFunction("cell", "clearEdited", this.clearEdited.bind(this));
		this.registerComponentFunction("cell", "edit", this.editCell.bind(this));
		this.registerComponentFunction("cell", "cancelEdit", this.cellCancelEdit.bind(this));
		
		this.registerComponentFunction("cell", "navigatePrev", this.navigatePrev.bind(this));
		this.registerComponentFunction("cell", "navigateNext", this.navigateNext.bind(this));
		this.registerComponentFunction("cell", "navigateLeft", this.navigateLeft.bind(this));
		this.registerComponentFunction("cell", "navigateRight", this.navigateRight.bind(this));
		this.registerComponentFunction("cell", "navigateUp", this.navigateUp.bind(this));
		this.registerComponentFunction("cell", "navigateDown", this.navigateDown.bind(this));
	}
	
	initialize(){
		this.subscribe("cell-init", this.bindEditor.bind(this));
		this.subscribe("cell-delete", this.clearEdited.bind(this));
		this.subscribe("cell-value-changed", this.updateCellClass.bind(this));
		this.subscribe("column-layout", this.initializeColumnCheck.bind(this));
		this.subscribe("column-delete", this.columnDeleteCheck.bind(this));
		this.subscribe("row-deleting", this.rowDeleteCheck.bind(this));
		this.subscribe("row-layout", this.rowEditableCheck.bind(this));
		this.subscribe("data-refreshing", this.cancelEdit.bind(this));
		this.subscribe("clipboard-paste", this.pasteBlocker.bind(this));
		
		this.subscribe("keybinding-nav-prev", this.navigatePrev.bind(this, undefined));
		this.subscribe("keybinding-nav-next", this.keybindingNavigateNext.bind(this));
		
		// this.subscribe("keybinding-nav-left", this.navigateLeft.bind(this, undefined));
		// this.subscribe("keybinding-nav-right", this.navigateRight.bind(this, undefined));
		this.subscribe("keybinding-nav-up", this.navigateUp.bind(this, undefined));
		this.subscribe("keybinding-nav-down", this.navigateDown.bind(this, undefined));

		if(Object.keys(this.table.options).includes("editorEmptyValue")){
			this.convertEmptyValues = true;
		}
	}
	
	
	///////////////////////////////////
	///////// Paste Negation //////////
	///////////////////////////////////
	
	pasteBlocker(e){
		if(this.currentCell){
			return true;
		}
	}
	
	
	///////////////////////////////////
	////// Keybinding Functions ///////
	///////////////////////////////////
	
	keybindingNavigateNext(e){
		var cell = this.currentCell,
		newRow = this.options("tabEndNewRow");

		if(cell){
			if(!this.navigateNext(cell, e)){
				if(newRow){
					cell.getElement().firstChild.blur();
					
					if(!this.invalidEdit){
						
						if(newRow === true){
							newRow = this.table.addRow({});
						}else {
							if(typeof newRow == "function"){
								newRow = this.table.addRow(newRow(cell.row.getComponent()));
							}else {
								newRow = this.table.addRow(Object.assign({}, newRow));
							}
						}
						
						newRow.then(() => {
							setTimeout(() => {
								cell.getComponent().navigateNext();
							});
						});
					}
				}
			}
		}
	}
	
	///////////////////////////////////
	///////// Cell Functions //////////
	///////////////////////////////////
	
	cellIsEdited(cell){
		return !! cell.modules.edit && cell.modules.edit.edited;
	}
	
	cellCancelEdit(cell){
		if(cell === this.currentCell){
			this.table.modules.edit.cancelEdit();
		}else {
			console.warn("Cancel Editor Error - This cell is not currently being edited ");
		}
	}
	
	
	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////
	updateCellClass(cell){
		if(this.allowEdit(cell)) {
			cell.getElement().classList.add("tabulator-editable");
		}
		else {
			cell.getElement().classList.remove("tabulator-editable");
		}
	}
	
	clearCellEdited(cells){
		if(!cells){
			cells = this.table.modules.edit.getEditedCells();
		}
		
		if(!Array.isArray(cells)){
			cells = [cells];
		}
		
		cells.forEach((cell) => {
			this.table.modules.edit.clearEdited(cell._getSelf());
		});
	}
	
	navigatePrev(cell = this.currentCell, e){
		var nextCell, prevRow;
		
		if(cell){
			
			if(e){
				e.preventDefault();
			}
			
			nextCell = this.navigateLeft();
			
			if(nextCell){
				return true;
			}else {
				prevRow = this.table.rowManager.prevDisplayRow(cell.row, true);
				
				if(prevRow){
					nextCell = this.findPrevEditableCell(prevRow, prevRow.cells.length);
					
					if(nextCell){
						nextCell.getComponent().edit();
						return true;
					}
				}
			}
		}
		
		return false;
	}
	
	navigateNext(cell = this.currentCell, e){
		var nextCell, nextRow;
		
		if(cell){
			
			if(e){
				e.preventDefault();
			}
			
			nextCell = this.navigateRight();
			
			if(nextCell){
				return true;
			}else {
				nextRow = this.table.rowManager.nextDisplayRow(cell.row, true);
				
				if(nextRow){
					nextCell = this.findNextEditableCell(nextRow, -1);
					
					if(nextCell){
						nextCell.getComponent().edit();
						return true;
					}
				}
			}
		}
		
		return false;
	}
	
	navigateLeft(cell = this.currentCell, e){
		var index, nextCell;
		
		if(cell){
			
			if(e){
				e.preventDefault();
			}
			
			index = cell.getIndex();
			nextCell = this.findPrevEditableCell(cell.row, index);
			
			if(nextCell){
				nextCell.getComponent().edit();
				return true;
			}
		}
		
		return false;
	}
	
	navigateRight(cell = this.currentCell, e){
		var index, nextCell;
		
		if(cell){
			
			if(e){
				e.preventDefault();
			}
			
			index = cell.getIndex();
			nextCell = this.findNextEditableCell(cell.row, index);
			
			if(nextCell){
				nextCell.getComponent().edit();
				return true;
			}
		}
		
		return false;
	}
	
	navigateUp(cell = this.currentCell, e){
		var index, nextRow;
		
		if(cell){
			
			if(e){
				e.preventDefault();
			}
			
			index = cell.getIndex();
			nextRow = this.table.rowManager.prevDisplayRow(cell.row, true);
			
			if(nextRow){
				nextRow.cells[index].getComponent().edit();
				return true;
			}
		}
		
		return false;
	}
	
	navigateDown(cell = this.currentCell, e){
		var index, nextRow;
		
		if(cell){
			
			if(e){
				e.preventDefault();
			}
			
			index = cell.getIndex();
			nextRow = this.table.rowManager.nextDisplayRow(cell.row, true);
			
			if(nextRow){
				nextRow.cells[index].getComponent().edit();
				return true;
			}
		}
		
		return false;
	}
	
	findNextEditableCell(row, index){
		var nextCell = false;
		
		if(index < row.cells.length-1){
			for(var i = index+1; i < row.cells.length; i++){
				let cell = row.cells[i];
				
				if(cell.column.modules.edit && Helpers.elVisible(cell.getElement())){
					let allowEdit = this.allowEdit(cell);
					
					if(allowEdit){
						nextCell = cell;
						break;
					}
				}
			}
		}
		
		return nextCell;
	}
	
	findPrevEditableCell(row, index){
		var prevCell = false;
		
		if(index > 0){
			for(var i = index-1; i >= 0; i--){
				let cell = row.cells[i];
				
				if(cell.column.modules.edit && Helpers.elVisible(cell.getElement())){
					let allowEdit = this.allowEdit(cell);
					
					if(allowEdit){
						prevCell = cell;
						break;
					}
				}
			}
		}
		
		return prevCell;
	}
	
	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////
	
	initializeColumnCheck(column){
		if(typeof column.definition.editor !== "undefined"){
			this.initializeColumn(column);
		}
	}
	
	columnDeleteCheck(column){
		if(this.currentCell && this.currentCell.column === column){
			this.cancelEdit();
		}
	}
	
	rowDeleteCheck(row){
		if(this.currentCell && this.currentCell.row === row){
			this.cancelEdit();
		}
	}
	
	rowEditableCheck(row){
		row.getCells().forEach((cell) => {
			if(cell.column.modules.edit && typeof cell.column.modules.edit.check === "function"){
				this.updateCellClass(cell);
			}
		});
	}
	
	//initialize column editor
	initializeColumn(column){
		var convertEmpty = Object.keys(column.definition).includes("editorEmptyValue");

		var config = {
			editor:false,
			blocked:false,
			check:column.definition.editable,
			params:column.definition.editorParams || {},
			convertEmptyValues:convertEmpty,
			editorEmptyValue:column.definition.editorEmptyValue,
			editorEmptyValueFunc:column.definition.editorEmptyValueFunc,
		};
		
		//set column editor
		config.editor = this.lookupEditor(column.definition.editor, column);
		
		if(config.editor){
			column.modules.edit = config;
		}
	}

	lookupEditor(editor, column){
		var editorFunc;

		switch(typeof editor){
			case "string":
				if(this.editors[editor]){
					editorFunc = this.editors[editor];
				}else {
					console.warn("Editor Error - No such editor found: ", editor);
				}
				break;
			
			case "function":
				editorFunc = editor;
				break;
			
			case "boolean":
				if(editor === true){
					if(typeof column.definition.formatter !== "function"){
						if(this.editors[column.definition.formatter]){
							editorFunc = this.editors[column.definition.formatter];
						}else {
							editorFunc = this.editors["input"];
						}
					}else {
						console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ", column.definition.formatter);
					}
				}
				break;
		}

		return editorFunc;
	}
	
	getCurrentCell(){
		return this.currentCell ? this.currentCell.getComponent() : false;
	}
	
	clearEditor(cancel){
		var cell = this.currentCell,
		cellEl;
		
		this.invalidEdit = false;
		
		if(cell){
			this.currentCell = false;
			
			cellEl = cell.getElement();
			
			this.dispatch("edit-editor-clear", cell, cancel);
			
			cellEl.classList.remove("tabulator-editing");
			
			while(cellEl.firstChild) cellEl.removeChild(cellEl.firstChild);
			
			cell.row.getElement().classList.remove("tabulator-editing");
			
			cell.table.element.classList.remove("tabulator-editing");
		}
	}
	
	cancelEdit(){
		if(this.currentCell){
			var cell = this.currentCell;
			var component = this.currentCell.getComponent();
			
			this.clearEditor(true);
			cell.setValueActual(cell.getValue());
			cell.cellRendered();
			
			if(cell.column.definition.editor == "textarea" || cell.column.definition.variableHeight){
				cell.row.normalizeHeight(true);
			}
			
			if(cell.column.definition.cellEditCancelled){
				cell.column.definition.cellEditCancelled.call(this.table, component);
			}
			
			this.dispatch("edit-cancelled", cell);
			this.dispatchExternal("cellEditCancelled", component);
		}
	}
	
	//return a formatted value for a cell
	bindEditor(cell){
		if(cell.column.modules.edit){
			var self = this,
			element = cell.getElement(true);
			
			this.updateCellClass(cell);
			element.setAttribute("tabindex", 0);
			
			element.addEventListener("mousedown", function(e){
				if (e.button === 2) {
					e.preventDefault();
				}else {
					self.mouseClick = true;
				}
			});

			if(this.options("editTriggerEvent") === "dblclick"){
				element.addEventListener("dblclick", function(e){
					if(!element.classList.contains("tabulator-editing")){
						element.focus({preventScroll: true});
						self.edit(cell, e, false);
					}
				});
			}
			
			
			if(this.options("editTriggerEvent") === "focus" || this.options("editTriggerEvent") === "click"){
				element.addEventListener("click", function(e){
					if(!element.classList.contains("tabulator-editing")){
						element.focus({preventScroll: true});
						self.edit(cell, e, false);
					}
				});
			}
			
			if(this.options("editTriggerEvent") === "focus"){
				element.addEventListener("focus", function(e){
					if(!self.recursionBlock){
						self.edit(cell, e, false);
					}
				});
			}
		}
	}
	
	focusCellNoEvent(cell, block){
		this.recursionBlock = true;
		
		if(!(block && this.table.browser === "ie")){
			cell.getElement().focus({preventScroll: true});
		}
		
		this.recursionBlock = false;
	}
	
	editCell(cell, forceEdit){
		this.focusCellNoEvent(cell);
		this.edit(cell, false, forceEdit);
	}
	
	focusScrollAdjust(cell){
		if(this.table.rowManager.getRenderMode() == "virtual"){
			var topEdge = this.table.rowManager.element.scrollTop,
			bottomEdge = this.table.rowManager.element.clientHeight + this.table.rowManager.element.scrollTop,
			rowEl = cell.row.getElement();
			
			if(rowEl.offsetTop < topEdge){
				this.table.rowManager.element.scrollTop -= (topEdge - rowEl.offsetTop);
			}else {
				if(rowEl.offsetTop + rowEl.offsetHeight  > bottomEdge){
					this.table.rowManager.element.scrollTop += (rowEl.offsetTop + rowEl.offsetHeight - bottomEdge);
				}
			}
			
			var leftEdge = this.table.rowManager.element.scrollLeft,
			rightEdge = this.table.rowManager.element.clientWidth + this.table.rowManager.element.scrollLeft,
			cellEl = cell.getElement();
			
			if(this.table.modExists("frozenColumns")){
				leftEdge += parseInt(this.table.modules.frozenColumns.leftMargin || 0);
				rightEdge -= parseInt(this.table.modules.frozenColumns.rightMargin || 0);
			}
			
			if(this.table.options.renderHorizontal === "virtual"){
				leftEdge -= parseInt(this.table.columnManager.renderer.vDomPadLeft);
				rightEdge -= parseInt(this.table.columnManager.renderer.vDomPadLeft);
			}
			
			if(cellEl.offsetLeft < leftEdge){
				this.table.rowManager.element.scrollLeft -= (leftEdge - cellEl.offsetLeft);
			}else {
				if(cellEl.offsetLeft + cellEl.offsetWidth  > rightEdge){
					this.table.rowManager.element.scrollLeft += (cellEl.offsetLeft + cellEl.offsetWidth - rightEdge);
				}
			}
		}
	}
	
	allowEdit(cell) {
		var check = cell.column.modules.edit ? true : false;
		
		if(cell.column.modules.edit){
			switch(typeof cell.column.modules.edit.check){
				case "function":
					if(cell.row.initialized){
						check = cell.column.modules.edit.check(cell.getComponent());
					}
					break;
				
				case "string":
					check = !!cell.row.data[cell.column.modules.edit.check];
					break;
				
				case "boolean":
					check = cell.column.modules.edit.check;
					break;
			}
		}
		
		return check;
	}
	
	edit(cell, e, forceEdit){
		var self = this,
		allowEdit = true,
		rendered = function(){},
		element = cell.getElement(),
		editFinished = false,
		cellEditor, component, params;

		//prevent editing if another cell is refusing to leave focus (eg. validation fail)
		
		if(this.currentCell){
			if(!this.invalidEdit && this.currentCell !== cell){
				this.cancelEdit();
			}
			return;
		}
		
		//handle successful value change
		function success(value){
			if(self.currentCell === cell && !editFinished){
				var valid = self.chain("edit-success", [cell, value], true, true);

				if(valid === true || self.table.options.validationMode === "highlight"){

					editFinished = true;

					self.clearEditor();
					
					if(!cell.modules.edit){
						cell.modules.edit = {};
					}
					
					cell.modules.edit.edited = true;
					
					if(self.editedCells.indexOf(cell) == -1){
						self.editedCells.push(cell);
					}

					value = self.transformEmptyValues(value, cell);
					
					cell.setValue(value, true);

					return valid === true;
				}else {
					editFinished = true;
					self.invalidEdit = true;
					self.focusCellNoEvent(cell, true);
					rendered();

					setTimeout(() => {
						editFinished = false;
					}, 10);
					return false;
				}
			}
		}
		
		//handle aborted edit
		function cancel(){
			// editFinished = true;

			if(self.currentCell === cell && !editFinished){
				self.cancelEdit();
			}
		}
		
		function onRendered(callback){
			rendered = callback;
		}
		
		if(!cell.column.modules.edit.blocked){
			if(e){
				e.stopPropagation();
			}
			
			allowEdit = this.allowEdit(cell);
			
			if(allowEdit || forceEdit){
				self.cancelEdit();
				
				self.currentCell = cell;
				
				this.focusScrollAdjust(cell);
				
				component = cell.getComponent();
				
				if(this.mouseClick){
					this.mouseClick = false;
					
					if(cell.column.definition.cellClick){
						cell.column.definition.cellClick.call(this.table, e, component);
					}
				}
				
				if(cell.column.definition.cellEditing){
					cell.column.definition.cellEditing.call(this.table, component);
				}
				
				this.dispatch("cell-editing", cell);
				this.dispatchExternal("cellEditing", component);
				
				params = typeof cell.column.modules.edit.params === "function" ? cell.column.modules.edit.params(component) : cell.column.modules.edit.params;
				
				cellEditor = cell.column.modules.edit.editor.call(self, component, onRendered, success, cancel, params);
				
				//if editor returned, add to DOM, if false, abort edit
				if(this.currentCell && cellEditor !== false){
					if(cellEditor instanceof Node){
						element.classList.add("tabulator-editing");
						cell.row.getElement().classList.add("tabulator-editing");
						cell.table.element.classList.add("tabulator-editing");
						while(element.firstChild) element.removeChild(element.firstChild);
						element.appendChild(cellEditor);
						
						//trigger onRendered Callback
						rendered();
						
						//prevent editing from triggering rowClick event
						var children = element.children;
						
						for (var i = 0; i < children.length; i++) {
							children[i].addEventListener("click", function(e){
								e.stopPropagation();
							});
						}
					}else {
						console.warn("Edit Error - Editor should return an instance of Node, the editor returned:", cellEditor);
						this.blur(element);
						return false;
					}
				}else {
					this.blur(element);
					return false;
				}
				
				return true;
			}else {
				this.mouseClick = false;
				this.blur(element);
				return false;
			}
		}else {
			this.mouseClick = false;
			this.blur(element);
			return false;
		}
	}

	emptyValueCheck(value){
		return value === "" || value === null || typeof value === "undefined";
	}

	transformEmptyValues(value, cell){
		var mod = cell.column.modules.edit, 
		convert = mod.convertEmptyValues || this.convertEmptyValues,
		checkFunc;
		
		if(convert){
			checkFunc = mod.editorEmptyValueFunc || this.options("editorEmptyValueFunc");

			if(checkFunc && checkFunc(value)){
				value = mod.convertEmptyValues ? mod.editorEmptyValue : this.options("editorEmptyValue");
			}
		}
		
		return value;
	}
	
	blur(element){
		if(!this.confirm("edit-blur", [element]) ){
			element.blur();
		}
	}
	
	getEditedCells(){
		var output = [];
		
		this.editedCells.forEach((cell) => {
			output.push(cell.getComponent());
		});
		
		return output;
	}
	
	clearEdited(cell){
		var editIndex;
		
		if(cell.modules.edit && cell.modules.edit.edited){
			cell.modules.edit.edited = false;
			
			this.dispatch("edit-edited-clear", cell);
		}
		
		editIndex = this.editedCells.indexOf(cell);
		
		if(editIndex > -1){
			this.editedCells.splice(editIndex, 1);
		}
	}
}

class ExportRow{
	constructor(type, columns, component, indent){
		this.type = type;
		this.columns = columns;
		this.component = component || false;
		this.indent = indent || 0;
	}
}

class ExportColumn{
	constructor(value, component, width, height, depth){
		this.value = value;
		this.component = component || false;
		this.width = width;
		this.height = height;
		this.depth = depth;
	}
}

var columnLookups$1 = {

};

var rowLookups$1 = {
	visible:function(){
		return this.rowManager.getVisibleRows(false, true);
	},
	all:function(){
		return this.rowManager.rows;
	},
	selected:function(){
		return this.modules.selectRow.selectedRows;
	},
	active:function(){
		if(this.options.pagination){
			return this.rowManager.getDisplayRows(this.rowManager.displayRows.length - 2);
		}else {
			return this.rowManager.getDisplayRows();
		}
	},
};

class Export extends Module{

	static moduleName = "export";

	static columnLookups = columnLookups$1;
	static rowLookups = rowLookups$1;
	
	constructor(table){
		super(table);
		
		this.config = {};
		this.cloneTableStyle = true;
		this.colVisProp = "";
		this.colVisPropAttach = "";
		
		this.registerTableOption("htmlOutputConfig", false); //html output config
		
		this.registerColumnOption("htmlOutput");
		this.registerColumnOption("titleHtmlOutput");
	}
	
	initialize(){
		this.registerTableFunction("getHtml", this.getHtml.bind(this));
	}
	
	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////
	
	generateExportList(config, style, range, colVisProp){
		var headers, body, columns, colLookup;

		this.cloneTableStyle = style;
		this.config = config || {};
		this.colVisProp = colVisProp;
		this.colVisPropAttach = this.colVisProp.charAt(0).toUpperCase() + this.colVisProp.slice(1);

		colLookup = Export.columnLookups[range];

		if(colLookup){
			columns = colLookup.call(this.table);
			columns = columns.filter(col => this.columnVisCheck(col));
		}

		headers = this.config.columnHeaders !== false ? this.headersToExportRows(this.generateColumnGroupHeaders(columns)) : [];

		if(columns){
			columns = columns.map(col => col.getComponent());
		}
		
		body = this.bodyToExportRows(this.rowLookup(range), columns);

		return headers.concat(body);
	}
	
	generateTable(config, style, range, colVisProp){
		var list = this.generateExportList(config, style, range, colVisProp);
		
		return this.generateTableElement(list);
	}
	
	rowLookup(range){
		var rows = [], 
		rowLookup;
		
		if(typeof range == "function"){
			range.call(this.table).forEach((row) =>{
				row = this.table.rowManager.findRow(row);
				
				if(row){
					rows.push(row);
				}
			});
		}else {
			rowLookup = Export.rowLookups[range] || Export.rowLookups["active"];

			rows = rowLookup.call(this.table);
		}
		
		return Object.assign([], rows);
	}
	
	generateColumnGroupHeaders(columns){
		var output = [];
		
		if (!columns) {
			columns = this.config.columnGroups !== false ? this.table.columnManager.columns : this.table.columnManager.columnsByIndex;
		}
		
		columns.forEach((column) => {
			var colData = this.processColumnGroup(column);
			
			if(colData){
				output.push(colData);
			}
		});



		return output;
	}
	
	processColumnGroup(column){
		var subGroups = column.columns,
		maxDepth = 0,
		title = column.definition["title" + (this.colVisPropAttach)] || column.definition.title;
		
		var groupData = {
			title:title,
			column:column,
			depth:1,
		};
		
		if(subGroups.length){
			groupData.subGroups = [];
			groupData.width = 0;
			
			subGroups.forEach((subGroup) => {
				var subGroupData = this.processColumnGroup(subGroup);
				
				if(subGroupData){
					groupData.width += subGroupData.width;
					groupData.subGroups.push(subGroupData);
					
					if(subGroupData.depth > maxDepth){
						maxDepth = subGroupData.depth;
					}
				}
			});
			
			groupData.depth += maxDepth;
			
			if(!groupData.width){
				return false;
			}
		}else {
			if(this.columnVisCheck(column)){
				groupData.width = 1;
			}else {
				return false;
			}
		}
		
		return groupData;
	}
	
	columnVisCheck(column){
		var visProp = column.definition[this.colVisProp];

		if(this.config.rowHeaders === false && column.isRowHeader){
			return false;
		}
		
		if(typeof visProp === "function"){
			visProp = visProp.call(this.table, column.getComponent());
		}

		if(visProp === false || visProp === true){
			return visProp;
		}

		return column.visible && column.field;
	}
	
	headersToExportRows(columns){
		var headers = [],
		headerDepth = 0,
		exportRows = [];
		
		function parseColumnGroup(column, level){
			
			var depth = headerDepth - level;
			
			if(typeof headers[level] === "undefined"){
				headers[level] = [];
			}
			
			column.height = column.subGroups ? 1 : (depth - column.depth) + 1;
			
			headers[level].push(column);
			
			if(column.height > 1){
				for(let i = 1; i < column.height; i ++){
					
					if(typeof headers[level + i] === "undefined"){
						headers[level + i] = [];
					}
					
					headers[level + i].push(false);
				}
			}
			
			if(column.width > 1){
				for(let i = 1; i < column.width; i ++){
					headers[level].push(false);
				}
			}
			
			if(column.subGroups){
				column.subGroups.forEach(function(subGroup){
					parseColumnGroup(subGroup, level+1);
				});
			}
		}
		
		//calculate maximum header depth
		columns.forEach(function(column){
			if(column.depth > headerDepth){
				headerDepth = column.depth;
			}
		});
		
		columns.forEach(function(column){
			parseColumnGroup(column,0);
		});
		
		headers.forEach((header) => {
			var columns = [];
			
			header.forEach((col) => {
				if(col){
					let title = typeof col.title === "undefined" ? "" : col.title;
					columns.push(new ExportColumn(title, col.column.getComponent(), col.width, col.height, col.depth));
				}else {
					columns.push(null);
				}
			});
			
			exportRows.push(new ExportRow("header", columns));
		});
		
		return exportRows;
	}
	
	bodyToExportRows(rows, columns = []){
		var exportRows = [];
		
		if (columns.length === 0) {
			this.table.columnManager.columnsByIndex.forEach((column) => {
				if (this.columnVisCheck(column)) {
					columns.push(column.getComponent());
				}
			});
		}
		
		if(this.config.columnCalcs !== false && this.table.modExists("columnCalcs")){
			if(this.table.modules.columnCalcs.topInitialized){
				rows.unshift(this.table.modules.columnCalcs.topRow);
			}
			
			if(this.table.modules.columnCalcs.botInitialized){
				rows.push(this.table.modules.columnCalcs.botRow);
			}
		}

		rows = rows.filter((row) => {
			switch(row.type){
				case "group":
					return this.config.rowGroups !== false;
				
				case "calc":
					return this.config.columnCalcs !== false;
				
				case "row":
					return !(this.table.options.dataTree && this.config.dataTree === false && row.modules.dataTree.parent);
			}
			
			return true;
		});
		
		rows.forEach((row, i) => {
			var rowData = row.getData(this.colVisProp);
			var exportCols = [];
			var indent = 0;
			
			switch(row.type){
				case "group":
					indent = row.level;
					exportCols.push(new ExportColumn(row.key, row.getComponent(), columns.length, 1));
					break;
				
				case "calc" :
				case "row" :
					columns.forEach((col) => {
						exportCols.push(new ExportColumn(col._column.getFieldValue(rowData), col, 1, 1));
					});
				
					if(this.table.options.dataTree && this.config.dataTree !== false){
						indent = row.modules.dataTree.index;
					}
					break;
			}
			
			exportRows.push(new ExportRow(row.type, exportCols, row.getComponent(), indent));
		});
		
		return exportRows;
	}
	
	generateTableElement(list){
		var table = document.createElement("table"),
		headerEl = document.createElement("thead"),
		bodyEl = document.createElement("tbody"),
		styles = this.lookupTableStyles(),
		rowFormatter = this.table.options["rowFormatter" + (this.colVisPropAttach)],
		setup = {};
		
		setup.rowFormatter = rowFormatter !== null ? rowFormatter : this.table.options.rowFormatter;
		
		if(this.table.options.dataTree &&this.config.dataTree !== false && this.table.modExists("columnCalcs")){
			setup.treeElementField = this.table.modules.dataTree.elementField;
		}
		
		//assign group header formatter
		setup.groupHeader = this.table.options["groupHeader" + (this.colVisPropAttach)];
		
		if(setup.groupHeader && !Array.isArray(setup.groupHeader)){
			setup.groupHeader = [setup.groupHeader];
		}
		
		table.classList.add("tabulator-print-table");
		
		this.mapElementStyles(this.table.columnManager.getHeadersElement(), headerEl, ["border-top", "border-left", "border-right", "border-bottom", "background-color", "color", "font-weight", "font-family", "font-size"]);

		if(list.length > 1000){
			console.warn("It may take a long time to render an HTML table with more than 1000 rows");
		}
		
		list.forEach((row, i) => {
			let rowEl;
			
			switch(row.type){
				case "header":
					headerEl.appendChild(this.generateHeaderElement(row, setup, styles));
					break;
				
				case "group":
					bodyEl.appendChild(this.generateGroupElement(row, setup, styles));
					break;
				
				case "calc":
					bodyEl.appendChild(this.generateCalcElement(row, setup, styles));
					break;
				
				case "row":
					rowEl = this.generateRowElement(row, setup, styles);
				
					this.mapElementStyles(((i % 2) && styles.evenRow) ? styles.evenRow : styles.oddRow, rowEl, ["border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "background-color"]);
					bodyEl.appendChild(rowEl);
					break;
			}
		});
		
		if(headerEl.innerHTML){
			table.appendChild(headerEl);
		}
		
		table.appendChild(bodyEl);
		
		
		this.mapElementStyles(this.table.element, table, ["border-top", "border-left", "border-right", "border-bottom"]);
		return table;
	}
	
	lookupTableStyles(){
		var styles = {};
		
		//lookup row styles
		if(this.cloneTableStyle && window.getComputedStyle){
			styles.oddRow = this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)");
			styles.evenRow = this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)");
			styles.calcRow = this.table.element.querySelector(".tabulator-row.tabulator-calcs");
			styles.firstRow = this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)");
			styles.firstGroup = this.table.element.getElementsByClassName("tabulator-group")[0];
			
			if(styles.firstRow){
				styles.styleCells = styles.firstRow.getElementsByClassName("tabulator-cell");
				styles.styleRowHeader = styles.firstRow.getElementsByClassName("tabulator-row-header")[0];
				styles.firstCell = styles.styleCells[0];
				styles.lastCell = styles.styleCells[styles.styleCells.length - 1];
			}
		}
		
		return styles;
	}
	
	generateHeaderElement(row, setup, styles){
		var rowEl = document.createElement("tr");
		
		row.columns.forEach((column) => {
			if(column){
				var cellEl = document.createElement("th");
				var classNames = column.component._column.definition.cssClass ? column.component._column.definition.cssClass.split(" ") : [];
				
				cellEl.colSpan = column.width;
				cellEl.rowSpan = column.height;
				
				cellEl.innerHTML = column.value;
				
				if(this.cloneTableStyle){
					cellEl.style.boxSizing = "border-box";
				}
				
				classNames.forEach(function(className) {
					cellEl.classList.add(className);
				});
				
				this.mapElementStyles(column.component.getElement(), cellEl, ["text-align", "border-left", "border-right", "background-color", "color", "font-weight", "font-family", "font-size"]);
				this.mapElementStyles(column.component._column.contentElement, cellEl, ["padding-top", "padding-left", "padding-right", "padding-bottom"]);
		
				if(column.component._column.visible){
					this.mapElementStyles(column.component.getElement(), cellEl, ["width"]);
				}else {
					if(column.component._column.definition.width){
						cellEl.style.width = column.component._column.definition.width + "px";
					}
				}
				
				if(column.component._column.parent && column.component._column.parent.isGroup){
					this.mapElementStyles(column.component._column.parent.groupElement, cellEl, ["border-top"]);
				}else {
					this.mapElementStyles(column.component.getElement(), cellEl, ["border-top"]);
				}
				
				if(column.component._column.isGroup){
					this.mapElementStyles(column.component.getElement(), cellEl, ["border-bottom"]);
				}else {
					this.mapElementStyles(this.table.columnManager.getElement(), cellEl, ["border-bottom"]);
				}
				
				rowEl.appendChild(cellEl);
			}
		});
		
		return rowEl;
	}
	
	generateGroupElement(row, setup, styles){
		
		var rowEl = document.createElement("tr"),
		cellEl = document.createElement("td"),
		group = row.columns[0];
		
		rowEl.classList.add("tabulator-print-table-row");
		
		if(setup.groupHeader && setup.groupHeader[row.indent]){
			group.value = setup.groupHeader[row.indent](group.value, row.component._group.getRowCount(), row.component._group.getData(), row.component);
		}else {
			if(setup.groupHeader !== false){
				group.value = row.component._group.generator(group.value, row.component._group.getRowCount(), row.component._group.getData(), row.component);
			}
		}
		
		cellEl.colSpan = group.width;
		cellEl.innerHTML = group.value;
		
		rowEl.classList.add("tabulator-print-table-group");
		rowEl.classList.add("tabulator-group-level-" + row.indent);
		
		if(group.component.isVisible()){
			rowEl.classList.add("tabulator-group-visible");
		}
		
		this.mapElementStyles(styles.firstGroup, rowEl, ["border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "background-color"]);
		this.mapElementStyles(styles.firstGroup, cellEl, ["padding-top", "padding-left", "padding-right", "padding-bottom"]);
		
		rowEl.appendChild(cellEl);
		
		return rowEl;
	}
	
	generateCalcElement(row, setup, styles){
		var rowEl = this.generateRowElement(row, setup, styles);
		
		rowEl.classList.add("tabulator-print-table-calcs");
		this.mapElementStyles(styles.calcRow, rowEl, ["border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "background-color"]);
		
		return rowEl;
	}
	
	generateRowElement(row, setup, styles){
		var rowEl = document.createElement("tr");
		
		rowEl.classList.add("tabulator-print-table-row");
		
		row.columns.forEach((col, i) => {
			if(col){
				var cellEl = document.createElement("td"),
				column = col.component._column,
				table =  this.table,
				index = table.columnManager.findColumnIndex(column),
				value = col.value,
				cellStyle, styleProps;
				
				var cellWrapper = {
					modules:{},
					getValue:function(){
						return value;
					},
					getField:function(){
						return column.definition.field;
					},
					getElement:function(){
						return cellEl;
					},
					getType:function(){
						return "cell";
					},
					getColumn:function(){
						return column.getComponent();
					},
					getData:function(){
						return row.component.getData();
					},
					getRow:function(){
						return row.component;
					},
					getTable:function(){
						return table;
					},
					getComponent:function(){
						return cellWrapper;
					},
					column:column,
				};
				
				var classNames = column.definition.cssClass ? column.definition.cssClass.split(" ") : [];
				
				classNames.forEach(function(className) {
					cellEl.classList.add(className);
				});
				
				if(this.table.modExists("format") && this.config.formatCells !== false){
					value = this.table.modules.format.formatExportValue(cellWrapper, this.colVisProp);
				}else {
					switch(typeof value){
						case "object":
							value = value !== null ? JSON.stringify(value) : "";
							break;
						
						case "undefined":
							value = "";
							break;
					}
				}
				
				if(value instanceof Node){
					cellEl.appendChild(value);
				}else {
					cellEl.innerHTML = value;
				}

				styleProps = ["padding-top", "padding-left", "padding-right", "padding-bottom", "border-top", "border-left", "border-right", "border-bottom", "color", "font-weight", "font-family", "font-size", "text-align"];

				if(column.isRowHeader){
					cellStyle = styles.styleRowHeader;
					styleProps.push("background-color");
				}else {
					cellStyle = styles.styleCells && styles.styleCells[index] ? styles.styleCells[index] : styles.firstCell;
				}
				
				if(cellStyle){
					this.mapElementStyles(cellStyle, cellEl, styleProps);
					
					if(column.definition.align){
						cellEl.style.textAlign = column.definition.align;
					}
				}
				
				if(this.table.options.dataTree && this.config.dataTree !== false){
					if((setup.treeElementField && setup.treeElementField == column.field) || (!setup.treeElementField && i == 0)){
						if(row.component._row.modules.dataTree.controlEl){
							cellEl.insertBefore(row.component._row.modules.dataTree.controlEl.cloneNode(true), cellEl.firstChild);
						}
						if(row.component._row.modules.dataTree.branchEl){
							cellEl.insertBefore(row.component._row.modules.dataTree.branchEl.cloneNode(true), cellEl.firstChild);
						}
					}
				}
				
				rowEl.appendChild(cellEl);
				
				if(cellWrapper.modules.format && cellWrapper.modules.format.renderedCallback){
					cellWrapper.modules.format.renderedCallback();
				}
			}
		});
		
		if(setup.rowFormatter && row.type === "row" && this.config.formatCells !== false){
			let formatComponent = Object.assign(row.component);

			formatComponent.getElement = function(){return rowEl;};

			setup.rowFormatter(row.component);
		}
		
		return rowEl;
	}
	
	generateHTMLTable(list){
		var holder = document.createElement("div");
		
		holder.appendChild(this.generateTableElement(list));
		
		return holder.innerHTML;
	}
	
	getHtml(visible, style, config, colVisProp){
		var list = this.generateExportList(config || this.table.options.htmlOutputConfig, style, visible, colVisProp || "htmlOutput");
		
		return this.generateHTMLTable(list);
	}
	
	mapElementStyles(from, to, props){
		if(this.cloneTableStyle && from && to){
			
			var lookup = {
				"background-color" : "backgroundColor",
				"color" : "fontColor",
				"width" : "width",
				"font-weight" : "fontWeight",
				"font-family" : "fontFamily",
				"font-size" : "fontSize",
				"text-align" : "textAlign",
				"border-top" : "borderTop",
				"border-left" : "borderLeft",
				"border-right" : "borderRight",
				"border-bottom" : "borderBottom",
				"padding-top" : "paddingTop",
				"padding-left" : "paddingLeft",
				"padding-right" : "paddingRight",
				"padding-bottom" : "paddingBottom",
			};
			
			if(window.getComputedStyle){
				var fromStyle = window.getComputedStyle(from);

				props.forEach(function(prop){
					if(!to.style[lookup[prop]]){
						to.style[lookup[prop]] = fromStyle.getPropertyValue(prop);
					}
				});
			}
		}
	}
}

var defaultFilters = {

	//equal to
	"=":function(filterVal, rowVal, rowData, filterParams){
		return rowVal == filterVal ? true : false;
	},

	//less than
	"<":function(filterVal, rowVal, rowData, filterParams){
		return rowVal < filterVal ? true : false;
	},

	//less than or equal to
	"<=":function(filterVal, rowVal, rowData, filterParams){
		return rowVal <= filterVal ? true : false;
	},

	//greater than
	">":function(filterVal, rowVal, rowData, filterParams){
		return rowVal > filterVal ? true : false;
	},

	//greater than or equal to
	">=":function(filterVal, rowVal, rowData, filterParams){
		return rowVal >= filterVal ? true : false;
	},

	//not equal to
	"!=":function(filterVal, rowVal, rowData, filterParams){
		return rowVal != filterVal ? true : false;
	},

	"regex":function(filterVal, rowVal, rowData, filterParams){

		if(typeof filterVal == "string"){
			filterVal = new RegExp(filterVal);
		}

		return filterVal.test(rowVal);
	},

	//contains the string
	"like":function(filterVal, rowVal, rowData, filterParams){
		if(filterVal === null || typeof filterVal === "undefined"){
			return rowVal === filterVal ? true : false;
		}else {
			if(typeof rowVal !== 'undefined' && rowVal !== null){
				return String(rowVal).toLowerCase().indexOf(filterVal.toLowerCase()) > -1;
			}
			else {
				return false;
			}
		}
	},

	//contains the keywords
	"keywords":function(filterVal, rowVal, rowData, filterParams){
		var keywords = filterVal.toLowerCase().split(typeof filterParams.separator === "undefined" ? " " : filterParams.separator),
		value = String(rowVal === null || typeof rowVal === "undefined" ? "" : rowVal).toLowerCase(),
		matches = [];

		keywords.forEach((keyword) =>{
			if(value.includes(keyword)){
				matches.push(true);
			}
		});

		return filterParams.matchAll ? matches.length === keywords.length : !!matches.length;
	},

	//starts with the string
	"starts":function(filterVal, rowVal, rowData, filterParams){
		if(filterVal === null || typeof filterVal === "undefined"){
			return rowVal === filterVal ? true : false;
		}else {
			if(typeof rowVal !== 'undefined' && rowVal !== null){
				return String(rowVal).toLowerCase().startsWith(filterVal.toLowerCase());
			}
			else {
				return false;
			}
		}
	},

	//ends with the string
	"ends":function(filterVal, rowVal, rowData, filterParams){
		if(filterVal === null || typeof filterVal === "undefined"){
			return rowVal === filterVal ? true : false;
		}else {
			if(typeof rowVal !== 'undefined' && rowVal !== null){
				return String(rowVal).toLowerCase().endsWith(filterVal.toLowerCase());
			}
			else {
				return false;
			}
		}
	},

	//in array
	"in":function(filterVal, rowVal, rowData, filterParams){
		if(Array.isArray(filterVal)){
			return filterVal.length ? filterVal.indexOf(rowVal) > -1 : true;
		}else {
			console.warn("Filter Error - filter value is not an array:", filterVal);
			return false;
		}
	},
};

class Filter extends Module{

	static moduleName = "filter";

	//load defaults
	static filters = defaultFilters;

	constructor(table){
		super(table);

		this.filterList = []; //hold filter list
		this.headerFilters = {}; //hold column filters
		this.headerFilterColumns = []; //hold columns that use header filters

		this.prevHeaderFilterChangeCheck = "";
		this.prevHeaderFilterChangeCheck = "{}";

		this.changed = false; //has filtering changed since last render
		this.tableInitialized = false;

		this.registerTableOption("filterMode", "local"); //local or remote filtering

		this.registerTableOption("initialFilter", false); //initial filtering criteria
		this.registerTableOption("initialHeaderFilter", false); //initial header filtering criteria
		this.registerTableOption("headerFilterLiveFilterDelay", 300); //delay before updating column after user types in header filter
		this.registerTableOption("placeholderHeaderFilter", false); //placeholder when header filter is empty

		this.registerColumnOption("headerFilter");
		this.registerColumnOption("headerFilterPlaceholder");
		this.registerColumnOption("headerFilterParams");
		this.registerColumnOption("headerFilterEmptyCheck");
		this.registerColumnOption("headerFilterFunc");
		this.registerColumnOption("headerFilterFuncParams");
		this.registerColumnOption("headerFilterLiveFilter");

		this.registerTableFunction("searchRows", this.searchRows.bind(this));
		this.registerTableFunction("searchData", this.searchData.bind(this));

		this.registerTableFunction("setFilter", this.userSetFilter.bind(this));
		this.registerTableFunction("refreshFilter", this.userRefreshFilter.bind(this));
		this.registerTableFunction("addFilter", this.userAddFilter.bind(this));
		this.registerTableFunction("getFilters", this.getFilters.bind(this));
		this.registerTableFunction("setHeaderFilterFocus", this.userSetHeaderFilterFocus.bind(this));
		this.registerTableFunction("getHeaderFilterValue", this.userGetHeaderFilterValue.bind(this));
		this.registerTableFunction("setHeaderFilterValue", this.userSetHeaderFilterValue.bind(this));
		this.registerTableFunction("getHeaderFilters", this.getHeaderFilters.bind(this));
		this.registerTableFunction("removeFilter", this.userRemoveFilter.bind(this));
		this.registerTableFunction("clearFilter", this.userClearFilter.bind(this));
		this.registerTableFunction("clearHeaderFilter", this.userClearHeaderFilter.bind(this));

		this.registerComponentFunction("column", "headerFilterFocus", this.setHeaderFilterFocus.bind(this));
		this.registerComponentFunction("column", "reloadHeaderFilter", this.reloadHeaderFilter.bind(this));
		this.registerComponentFunction("column", "getHeaderFilterValue", this.getHeaderFilterValue.bind(this));
		this.registerComponentFunction("column", "setHeaderFilterValue", this.setHeaderFilterValue.bind(this));
	}

	initialize(){
		this.subscribe("column-init", this.initializeColumnHeaderFilter.bind(this));
		this.subscribe("column-width-fit-before", this.hideHeaderFilterElements.bind(this));
		this.subscribe("column-width-fit-after", this.showHeaderFilterElements.bind(this));
		this.subscribe("table-built", this.tableBuilt.bind(this));
		this.subscribe("placeholder", this.generatePlaceholder.bind(this));

		if(this.table.options.filterMode === "remote"){
			this.subscribe("data-params", this.remoteFilterParams.bind(this));
		}

		this.registerDataHandler(this.filter.bind(this), 10);
	}

	tableBuilt(){
		if(this.table.options.initialFilter){
			this.setFilter(this.table.options.initialFilter);
		}

		if(this.table.options.initialHeaderFilter){
			this.table.options.initialHeaderFilter.forEach((item) => {

				var column = this.table.columnManager.findColumn(item.field);

				if(column){
					this.setHeaderFilterValue(column, item.value);
				}else {
					console.warn("Column Filter Error - No matching column found:", item.field);
					return false;
				}
			});
		}

		this.tableInitialized = true;
	}

	remoteFilterParams(data, config, silent, params){
		params.filter = this.getFilters(true, true);
		return params;
	}

	generatePlaceholder(text){
		if(this.table.options.placeholderHeaderFilter && Object.keys(this.headerFilters).length){
			return this.table.options.placeholderHeaderFilter;
		}
	}

	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////

	//set standard filters
	userSetFilter(field, type, value, params){
		this.setFilter(field, type, value, params);
		this.refreshFilter();
	}

	//set standard filters
	userRefreshFilter(){
		this.refreshFilter();
	}

	//add filter to array
	userAddFilter(field, type, value, params){
		this.addFilter(field, type, value, params);
		this.refreshFilter();
	}

	userSetHeaderFilterFocus(field){
		var column = this.table.columnManager.findColumn(field);

		if(column){
			this.setHeaderFilterFocus(column);
		}else {
			console.warn("Column Filter Focus Error - No matching column found:", field);
			return false;
		}
	}

	userGetHeaderFilterValue(field) {
		var column = this.table.columnManager.findColumn(field);

		if(column){
			return this.getHeaderFilterValue(column);
		}else {
			console.warn("Column Filter Error - No matching column found:", field);
		}
	}

	userSetHeaderFilterValue(field, value){
		var column = this.table.columnManager.findColumn(field);

		if(column){
			this.setHeaderFilterValue(column, value);
		}else {
			console.warn("Column Filter Error - No matching column found:", field);
			return false;
		}
	}

	//remove filter from array
	userRemoveFilter(field, type, value){
		this.removeFilter(field, type, value);
		this.refreshFilter();
	}

	//clear filters
	userClearFilter(all){
		this.clearFilter(all);
		this.refreshFilter();
	}

	//clear header filters
	userClearHeaderFilter(){
		this.clearHeaderFilter();
		this.refreshFilter();
	}


	//search for specific row components
	searchRows(field, type, value){
		return this.search("rows", field, type, value);
	}

	//search for specific data
	searchData(field, type, value){
		return this.search("data", field, type, value);
	}

	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////

	initializeColumnHeaderFilter(column){
		var def = column.definition;

		if(def.headerFilter){
			this.initializeColumn(column);
		}
	}

	//initialize column header filter
	initializeColumn(column, value){
		var self = this,
		field = column.getField();

		//handle successfully value change
		function success(value){
			var filterType = (column.modules.filter.tagType == "input" && column.modules.filter.attrType == "text") || column.modules.filter.tagType == "textarea" ? "partial" : "match",
			type = "",
			filterChangeCheck = "",
			filterFunc;

			if(typeof column.modules.filter.prevSuccess === "undefined" || column.modules.filter.prevSuccess !== value){

				column.modules.filter.prevSuccess = value;

				if(!column.modules.filter.emptyFunc(value)){
					column.modules.filter.value = value;

					switch(typeof column.definition.headerFilterFunc){
						case "string":
							if(Filter.filters[column.definition.headerFilterFunc]){
								type = column.definition.headerFilterFunc;
								filterFunc = function(data){
									var params = column.definition.headerFilterFuncParams || {};
									var fieldVal = column.getFieldValue(data);

									params = typeof params === "function" ? params(value, fieldVal, data) : params;

									return Filter.filters[column.definition.headerFilterFunc](value, fieldVal, data, params);
								};
							}else {
								console.warn("Header Filter Error - Matching filter function not found: ", column.definition.headerFilterFunc);
							}
							break;

						case "function":
							filterFunc = function(data){
								var params = column.definition.headerFilterFuncParams || {};
								var fieldVal = column.getFieldValue(data);

								params = typeof params === "function" ? params(value, fieldVal, data) : params;

								return column.definition.headerFilterFunc(value, fieldVal, data, params);
							};

							type = filterFunc;
							break;
					}

					if(!filterFunc){
						switch(filterType){
							case "partial":
								filterFunc = function(data){
									var colVal = column.getFieldValue(data);

									if(typeof colVal !== 'undefined' && colVal !== null){
										return String(colVal).toLowerCase().indexOf(String(value).toLowerCase()) > -1;
									}else {
										return false;
									}
								};
								type = "like";
								break;

							default:
								filterFunc = function(data){
									return column.getFieldValue(data) == value;
								};
								type = "=";
						}
					}

					self.headerFilters[field] = {value:value, func:filterFunc, type:type};
				}else {
					delete self.headerFilters[field];
				}

				column.modules.filter.value = value;

				filterChangeCheck = JSON.stringify(self.headerFilters);

				if(self.prevHeaderFilterChangeCheck !== filterChangeCheck){
					self.prevHeaderFilterChangeCheck = filterChangeCheck;

					self.trackChanges();
					self.refreshFilter();
				}
			}

			return true;
		}

		column.modules.filter = {
			success:success,
			attrType:false,
			tagType:false,
			emptyFunc:false,
		};

		this.generateHeaderFilterElement(column);
	}

	generateHeaderFilterElement(column, initialValue, reinitialize){
		var self = this,
		success = column.modules.filter.success,
		field = column.getField(),
		filterElement, editor, editorElement, cellWrapper, typingTimer, searchTrigger, params, onRenderedCallback;

		column.modules.filter.value = initialValue;

		//handle aborted edit
		function cancel(){}

		function onRendered(callback){
			onRenderedCallback = callback;
		}

		if(column.modules.filter.headerElement && column.modules.filter.headerElement.parentNode){
			column.contentElement.removeChild(column.modules.filter.headerElement.parentNode);
		}

		if(field){

			//set empty value function
			column.modules.filter.emptyFunc = column.definition.headerFilterEmptyCheck || function(value){
				return !value && value !== 0;
			};

			filterElement = document.createElement("div");
			filterElement.classList.add("tabulator-header-filter");

			//set column editor
			switch(typeof column.definition.headerFilter){
				case "string":
					if(self.table.modules.edit.editors[column.definition.headerFilter]){
						editor = self.table.modules.edit.editors[column.definition.headerFilter];

						if((column.definition.headerFilter === "tick" || column.definition.headerFilter === "tickCross") && !column.definition.headerFilterEmptyCheck){
							column.modules.filter.emptyFunc = function(value){
								return value !== true && value !== false;
							};
						}
					}else {
						console.warn("Filter Error - Cannot build header filter, No such editor found: ", column.definition.editor);
					}
					break;

				case "function":
					editor = column.definition.headerFilter;
					break;

				case "boolean":
					if(column.modules.edit && column.modules.edit.editor){
						editor = column.modules.edit.editor;
					}else {
						if(column.definition.formatter && self.table.modules.edit.editors[column.definition.formatter]){
							editor = self.table.modules.edit.editors[column.definition.formatter];

							if((column.definition.formatter === "tick" || column.definition.formatter === "tickCross") && !column.definition.headerFilterEmptyCheck){
								column.modules.filter.emptyFunc = function(value){
									return value !== true && value !== false;
								};
							}
						}else {
							editor = self.table.modules.edit.editors["input"];
						}
					}
					break;
			}

			if(editor){

				cellWrapper = {
					getValue:function(){
						return typeof initialValue !== "undefined" ? initialValue : "";
					},
					getField:function(){
						return column.definition.field;
					},
					getElement:function(){
						return filterElement;
					},
					getColumn:function(){
						return column.getComponent();
					},
					getTable:() => {
						return this.table;
					},
					getType:() => {
						return "header";
					},
					getRow:function(){
						return {
							normalizeHeight:function(){

							}
						};
					}
				};

				params = column.definition.headerFilterParams || {};

				params = typeof params === "function" ? params.call(self.table, cellWrapper) : params;

				editorElement = editor.call(this.table.modules.edit, cellWrapper, onRendered, success, cancel, params);

				if(!editorElement){
					console.warn("Filter Error - Cannot add filter to " + field + " column, editor returned a value of false");
					return;
				}

				if(!(editorElement instanceof Node)){
					console.warn("Filter Error - Cannot add filter to " + field + " column, editor should return an instance of Node, the editor returned:", editorElement);
					return;
				}

				//set Placeholder Text
				self.langBind("headerFilters|columns|" + column.definition.field, function(value){
					editorElement.setAttribute("placeholder", typeof value !== "undefined" && value ? value : (column.definition.headerFilterPlaceholder || self.langText("headerFilters|default")));
				});

				//focus on element on click
				editorElement.addEventListener("click", function(e){
					e.stopPropagation();
					editorElement.focus();
				});

				editorElement.addEventListener("focus", (e) => {
					var left = this.table.columnManager.contentsElement.scrollLeft;

					var headerPos = this.table.rowManager.element.scrollLeft;

					if(left !== headerPos){
						this.table.rowManager.scrollHorizontal(left);
						this.table.columnManager.scrollHorizontal(left);
					}
				});

				//live update filters as user types
				typingTimer = false;

				searchTrigger = function(e){
					if(typingTimer){
						clearTimeout(typingTimer);
					}

					typingTimer = setTimeout(function(){
						success(editorElement.value);
					},self.table.options.headerFilterLiveFilterDelay);
				};

				column.modules.filter.headerElement = editorElement;
				column.modules.filter.attrType = editorElement.hasAttribute("type") ? editorElement.getAttribute("type").toLowerCase() : "" ;
				column.modules.filter.tagType = editorElement.tagName.toLowerCase();

				if(column.definition.headerFilterLiveFilter !== false){

					if (
						!(
							column.definition.headerFilter === 'autocomplete' ||
							column.definition.headerFilter === 'tickCross' ||
							((column.definition.editor === 'autocomplete' ||
								column.definition.editor === 'tickCross') &&
							column.definition.headerFilter === true)
						)
					) {
						editorElement.addEventListener("keyup", searchTrigger);
						editorElement.addEventListener("search", searchTrigger);


						//update number filtered columns on change
						if(column.modules.filter.attrType == "number"){
							editorElement.addEventListener("change", function(e){
								success(editorElement.value);
							});
						}

						//change text inputs to search inputs to allow for clearing of field
						if(column.modules.filter.attrType == "text" && this.table.browser !== "ie"){
							editorElement.setAttribute("type", "search");
						// editorElement.off("change blur"); //prevent blur from triggering filter and preventing selection click
						}

					}

					//prevent input and select elements from propagating click to column sorters etc
					if(column.modules.filter.tagType == "input" || column.modules.filter.tagType == "select" || column.modules.filter.tagType == "textarea"){
						editorElement.addEventListener("mousedown",function(e){
							e.stopPropagation();
						});
					}
				}

				filterElement.appendChild(editorElement);

				column.contentElement.appendChild(filterElement);

				if(!reinitialize){
					self.headerFilterColumns.push(column);
				}

				if(onRenderedCallback){
					onRenderedCallback();
				}
			}
		}else {
			console.warn("Filter Error - Cannot add header filter, column has no field set:", column.definition.title);
		}
	}

	//hide all header filter elements (used to ensure correct column widths in "fitData" layout mode)
	hideHeaderFilterElements(){
		this.headerFilterColumns.forEach(function(column){
			if(column.modules.filter && column.modules.filter.headerElement){
				column.modules.filter.headerElement.style.display = 'none';
			}
		});
	}

	//show all header filter elements (used to ensure correct column widths in "fitData" layout mode)
	showHeaderFilterElements(){
		this.headerFilterColumns.forEach(function(column){
			if(column.modules.filter && column.modules.filter.headerElement){
				column.modules.filter.headerElement.style.display = '';
			}
		});
	}

	//programmatically set focus of header filter
	setHeaderFilterFocus(column){
		if(column.modules.filter && column.modules.filter.headerElement){
			column.modules.filter.headerElement.focus();
		}else {
			console.warn("Column Filter Focus Error - No header filter set on column:", column.getField());
		}
	}

	//programmatically get value of header filter
	getHeaderFilterValue(column){
		if(column.modules.filter && column.modules.filter.headerElement){
			return column.modules.filter.value;
		} else {
			console.warn("Column Filter Error - No header filter set on column:", column.getField());
		}
	}

	//programmatically set value of header filter
	setHeaderFilterValue(column, value){
		if (column){
			if(column.modules.filter && column.modules.filter.headerElement){
				this.generateHeaderFilterElement(column, value, true);
				column.modules.filter.success(value);
			}else {
				console.warn("Column Filter Error - No header filter set on column:", column.getField());
			}
		}
	}

	reloadHeaderFilter(column){
		if (column){
			if(column.modules.filter && column.modules.filter.headerElement){
				this.generateHeaderFilterElement(column, column.modules.filter.value, true);
			}else {
				console.warn("Column Filter Error - No header filter set on column:", column.getField());
			}
		}
	}

	refreshFilter(){
		if(this.tableInitialized){
			if(this.table.options.filterMode === "remote"){
				this.reloadData(null, false, false);
			}else {
				this.refreshData(true);
			}
		}

		//TODO - Persist left position of row manager
		// left = this.scrollLeft;
		// this.scrollHorizontal(left);
	}

	//check if the filters has changed since last use
	trackChanges(){
		this.changed = true;
		this.dispatch("filter-changed");
	}

	//check if the filters has changed since last use
	hasChanged(){
		var changed = this.changed;
		this.changed = false;
		return changed;
	}

	//set standard filters
	setFilter(field, type, value, params){
		this.filterList = [];

		if(!Array.isArray(field)){
			field = [{field:field, type:type, value:value, params:params}];
		}

		this.addFilter(field);
	}

	//add filter to array
	addFilter(field, type, value, params){
		var changed = false;

		if(!Array.isArray(field)){
			field = [{field:field, type:type, value:value, params:params}];
		}

		field.forEach((filter) => {
			filter = this.findFilter(filter);

			if(filter){
				this.filterList.push(filter);
				changed = true;
			}
		});

		if(changed){
			this.trackChanges();
		}
	}

	findFilter(filter){
		var column;

		if(Array.isArray(filter)){
			return this.findSubFilters(filter);
		}

		var filterFunc = false;

		if(typeof filter.field == "function"){
			filterFunc = function(data){
				return filter.field(data, filter.type || {});// pass params to custom filter function
			};
		}else {

			if(Filter.filters[filter.type]){

				column = this.table.columnManager.getColumnByField(filter.field);

				if(column){
					filterFunc = function(data){
						return Filter.filters[filter.type](filter.value, column.getFieldValue(data), data, filter.params || {});
					};
				}else {
					filterFunc = function(data){
						return Filter.filters[filter.type](filter.value, data[filter.field], data, filter.params || {});
					};
				}


			}else {
				console.warn("Filter Error - No such filter type found, ignoring: ", filter.type);
			}
		}

		filter.func = filterFunc;

		return filter.func ? filter : false;
	}

	findSubFilters(filters){
		var output = [];

		filters.forEach((filter) => {
			filter = this.findFilter(filter);

			if(filter){
				output.push(filter);
			}
		});

		return output.length ? output : false;
	}

	//get all filters
	getFilters(all, ajax){
		var output = [];

		if(all){
			output = this.getHeaderFilters();
		}

		if(ajax){
			output.forEach(function(item){
				if(typeof item.type == "function"){
					item.type = "function";
				}
			});
		}

		output = output.concat(this.filtersToArray(this.filterList, ajax));

		return output;
	}

	//filter to Object
	filtersToArray(filterList, ajax){
		var output = [];

		filterList.forEach((filter) => {
			var item;

			if(Array.isArray(filter)){
				output.push(this.filtersToArray(filter, ajax));
			}else {
				item = {field:filter.field, type:filter.type, value:filter.value};

				if(ajax){
					if(typeof item.type == "function"){
						item.type = "function";
					}
				}

				output.push(item);
			}
		});

		return output;
	}

	//get all filters
	getHeaderFilters(){
		var output = [];

		for(var key in this.headerFilters){
			output.push({field:key, type:this.headerFilters[key].type, value:this.headerFilters[key].value});
		}

		return output;
	}

	//remove filter from array
	removeFilter(field, type, value){
		if(!Array.isArray(field)){
			field = [{field:field, type:type, value:value}];
		}

		field.forEach((filter) => {
			var index = -1;

			if(typeof filter.field == "object"){
				index = this.filterList.findIndex((element) => {
					return filter === element;
				});
			}else {
				index = this.filterList.findIndex((element) => {
					return filter.field === element.field && filter.type === element.type  && filter.value === element.value;
				});
			}

			if(index > -1){
				this.filterList.splice(index, 1);
			}else {
				console.warn("Filter Error - No matching filter type found, ignoring: ", filter.type);
			}
		});

		this.trackChanges();
	}

	//clear filters
	clearFilter(all){
		this.filterList = [];

		if(all){
			this.clearHeaderFilter();
		}

		this.trackChanges();
	}

	//clear header filters
	clearHeaderFilter(){
		this.headerFilters = {};
		this.prevHeaderFilterChangeCheck = "{}";

		this.headerFilterColumns.forEach((column) => {
			if(typeof column.modules.filter.value !== "undefined"){
				delete column.modules.filter.value;
			}
			column.modules.filter.prevSuccess = undefined;
			this.reloadHeaderFilter(column);
		});

		this.trackChanges();
	}

	//search data and return matching rows
	search (searchType, field, type, value){
		var activeRows = [],
		filterList = [];

		if(!Array.isArray(field)){
			field = [{field:field, type:type, value:value}];
		}

		field.forEach((filter) => {
			filter = this.findFilter(filter);

			if(filter){
				filterList.push(filter);
			}
		});

		this.table.rowManager.rows.forEach((row) => {
			var match = true;

			filterList.forEach((filter) => {
				if(!this.filterRecurse(filter, row.getData())){
					match = false;
				}
			});

			if(match){
				activeRows.push(searchType === "data" ? row.getData("data") : row.getComponent());
			}

		});

		return activeRows;
	}

	//filter row array
	filter(rowList, filters){
		var activeRows = [],
		activeRowComponents = [];

		if(this.subscribedExternal("dataFiltering")){
			this.dispatchExternal("dataFiltering", this.getFilters(true));
		}

		if(this.table.options.filterMode !== "remote" && (this.filterList.length || Object.keys(this.headerFilters).length)){

			rowList.forEach((row) => {
				if(this.filterRow(row)){
					activeRows.push(row);
				}
			});

		}else {
			activeRows = rowList.slice(0);
		}

		if(this.subscribedExternal("dataFiltered")){

			activeRows.forEach((row) => {
				activeRowComponents.push(row.getComponent());
			});

			this.dispatchExternal("dataFiltered", this.getFilters(true), activeRowComponents);
		}

		return activeRows;
	}

	//filter individual row
	filterRow(row, filters){
		var match = true,
		data = row.getData();

		this.filterList.forEach((filter) => {
			if(!this.filterRecurse(filter, data)){
				match = false;
			}
		});


		for(var field in this.headerFilters){
			if(!this.headerFilters[field].func(data)){
				match = false;
			}
		}

		return match;
	}

	filterRecurse(filter, data){
		var match = false;

		if(Array.isArray(filter)){
			filter.forEach((subFilter) => {
				if(this.filterRecurse(subFilter, data)){
					match = true;
				}
			});
		}else {
			match = filter.func(data);
		}

		return match;
	}
}

function plaintext(cell, formatterParams, onRendered){
	return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
}

function html(cell, formatterParams, onRendered){
	return cell.getValue();
}

function textarea(cell, formatterParams, onRendered){
	cell.getElement().style.whiteSpace = "pre-wrap";
	return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
}

function money(cell, formatterParams, onRendered){
	var floatVal = parseFloat(cell.getValue()),
	sign = "",
	number, integer, decimal, rgx, value;

	var decimalSym = formatterParams.decimal || ".";
	var thousandSym = formatterParams.thousand || ",";
	var negativeSign = formatterParams.negativeSign || "-";
	var symbol = formatterParams.symbol || "";
	var after = !!formatterParams.symbolAfter;
	var precision = typeof formatterParams.precision !== "undefined" ? formatterParams.precision : 2;

	if(isNaN(floatVal)){
		return this.emptyToSpace(this.sanitizeHTML(cell.getValue()));
	}

	if(floatVal < 0){
		floatVal = Math.abs(floatVal);
		sign = negativeSign;
	}

	number = precision !== false ? floatVal.toFixed(precision) : floatVal;
	number = String(number).split(".");

	integer = number[0];
	decimal = number.length > 1 ? decimalSym + number[1] : "";

	if (formatterParams.thousand !== false) {
		rgx = /(\d+)(\d{3})/;

		while (rgx.test(integer)){
			integer = integer.replace(rgx, "$1" + thousandSym + "$2");
		}
	}

	value = integer + decimal;
	
	if(sign === true){
		value = "(" + value  + ")";
		return after ? value + symbol : symbol + value;
	}else {
		return after ? sign + value + symbol : sign + symbol + value;
	}
}

function link(cell, formatterParams, onRendered){
	var value = cell.getValue(),
	urlPrefix = formatterParams.urlPrefix || "",
	download = formatterParams.download,
	label = value,
	el = document.createElement("a"),
	data;

	function labelTraverse(path, data){
		var item = path.shift(),
		value = data[item];
		
		if(path.length && typeof value === "object"){
			return labelTraverse(path, value);
		}

		return value;
	}

	if(formatterParams.labelField){
		data = cell.getData();
		label = labelTraverse(formatterParams.labelField.split(this.table.options.nestedFieldSeparator), data);
	}

	if(formatterParams.label){
		switch(typeof formatterParams.label){
			case "string":
				label = formatterParams.label;
				break;

			case "function":
				label = formatterParams.label(cell);
				break;
		}
	}

	if(label){
		if(formatterParams.urlField){
			data = cell.getData();

			value = Helpers.retrieveNestedData(this.table.options.nestedFieldSeparator, formatterParams.urlField, data);
		}

		if(formatterParams.url){
			switch(typeof formatterParams.url){
				case "string":
					value = formatterParams.url;
					break;

				case "function":
					value = formatterParams.url(cell);
					break;
			}
		}

		el.setAttribute("href", urlPrefix + value);

		if(formatterParams.target){
			el.setAttribute("target", formatterParams.target);
		}

		if(formatterParams.download){

			if(typeof download == "function"){
				download = download(cell);
			}else {
				download = download === true ? "" : download;
			}

			el.setAttribute("download", download);
		}

		el.innerHTML = this.emptyToSpace(this.sanitizeHTML(label));

		return el;
	}else {
		return "&nbsp;";
	}
}

function image(cell, formatterParams, onRendered){
	var el = document.createElement("img"),
	src = cell.getValue();

	if(formatterParams.urlPrefix){
		src = formatterParams.urlPrefix + cell.getValue();
	}

	if(formatterParams.urlSuffix){
		src = src + formatterParams.urlSuffix;
	}

	el.setAttribute("src", src);

	switch(typeof formatterParams.height){
		case "number":
			el.style.height = formatterParams.height + "px";
			break;

		case "string":
			el.style.height = formatterParams.height;
			break;
	}

	switch(typeof formatterParams.width){
		case "number":
			el.style.width = formatterParams.width + "px";
			break;

		case "string":
			el.style.width = formatterParams.width;
			break;
	}

	el.addEventListener("load", function(){
		cell.getRow().normalizeHeight();
	});

	return el;
}

function tickCross(cell, formatterParams, onRendered){
	var value = cell.getValue(),
	element = cell.getElement(),
	empty = formatterParams.allowEmpty,
	truthy = formatterParams.allowTruthy,
	trueValueSet = Object.keys(formatterParams).includes("trueValue"),
	tick = typeof formatterParams.tickElement !== "undefined" ? formatterParams.tickElement : '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',
	cross = typeof formatterParams.crossElement !== "undefined" ? formatterParams.crossElement : '<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';

	if((trueValueSet && value === formatterParams.trueValue) || (!trueValueSet && ((truthy && value) || (value === true || value === "true" || value === "True" || value === 1 || value === "1")))){
		element.setAttribute("aria-checked", true);
		return tick || "";
	}else {
		if(empty && (value === "null" || value === "" || value === null || typeof value === "undefined")){
			element.setAttribute("aria-checked", "mixed");
			return "";
		}else {
			element.setAttribute("aria-checked", false);
			return cross || "";
		}
	}
}

function datetime$1(cell, formatterParams, onRendered){
	var DT = this.table.dependencyRegistry.lookup(["luxon", "DateTime"], "DateTime");
	var inputFormat = formatterParams.inputFormat || "yyyy-MM-dd HH:mm:ss";
	var	outputFormat = formatterParams.outputFormat || "dd/MM/yyyy HH:mm:ss";
	var	invalid = typeof formatterParams.invalidPlaceholder !== "undefined" ? formatterParams.invalidPlaceholder : "";
	var value = cell.getValue();

	if(typeof DT != "undefined"){
		var newDatetime;

		if(DT.isDateTime(value)){
			newDatetime = value;
		}else if(inputFormat === "iso"){
			newDatetime = DT.fromISO(String(value));
		}else {
			newDatetime = DT.fromFormat(String(value), inputFormat);
		}

		if(newDatetime.isValid){
			if(formatterParams.timezone){
				newDatetime = newDatetime.setZone(formatterParams.timezone);
			}

			return newDatetime.toFormat(outputFormat);
		}else {
			if(invalid === true || !value){
				return value;
			}else if(typeof invalid === "function"){
				return invalid(value);
			}else {
				return invalid;
			}
		}
	}else {
		console.error("Format Error - 'datetime' formatter is dependant on luxon.js");
	}
}

function datetimediff (cell, formatterParams, onRendered) {
	var DT = this.table.dependencyRegistry.lookup(["luxon", "DateTime"], "DateTime");
	var inputFormat = formatterParams.inputFormat || "yyyy-MM-dd HH:mm:ss";
	var invalid = typeof formatterParams.invalidPlaceholder !== "undefined" ? formatterParams.invalidPlaceholder : "";
	var suffix = typeof formatterParams.suffix !== "undefined" ? formatterParams.suffix : false;
	var unit = typeof formatterParams.unit !== "undefined" ? formatterParams.unit : "days";
	var humanize = typeof formatterParams.humanize !== "undefined" ? formatterParams.humanize : false;
	var date = typeof formatterParams.date !== "undefined" ? formatterParams.date : DT.now();
	var value = cell.getValue();

	if(typeof DT != "undefined"){
		var newDatetime;

		if(DT.isDateTime(value)){
			newDatetime = value;
		}else if(inputFormat === "iso"){
			newDatetime = DT.fromISO(String(value));
		}else {
			newDatetime = DT.fromFormat(String(value), inputFormat);
		}

		if (newDatetime.isValid){
			if(humanize){
				return newDatetime.diff(date, unit).toHuman()  + (suffix ? " " + suffix : "");
			}else {
				return parseInt(newDatetime.diff(date, unit)[unit]) + (suffix ? " " + suffix : "");
			}
		} else {

			if (invalid === true) {
				return value;
			} else if (typeof invalid === "function") {
				return invalid(value);
			} else {
				return invalid;
			}
		}
	}else {
		console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js");
	}
}

function lookup (cell, formatterParams, onRendered) {
	var value = cell.getValue();

	if (typeof formatterParams[value] === "undefined") {
		console.warn('Missing display value for ' + value);
		return value;
	}

	return formatterParams[value];
}

function star(cell, formatterParams, onRendered){
	var value = cell.getValue(),
	element = cell.getElement(),
	maxStars = formatterParams && formatterParams.stars ? formatterParams.stars : 5,
	stars = document.createElement("span"),
	star = document.createElementNS('http://www.w3.org/2000/svg', "svg"),
	starActive = '<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',
	starInactive = '<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';

	//style stars holder
	stars.style.verticalAlign = "middle";

	//style star
	star.setAttribute("width", "14");
	star.setAttribute("height", "14");
	star.setAttribute("viewBox", "0 0 512 512");
	star.setAttribute("xml:space", "preserve");
	star.style.padding = "0 1px";

	value = value && !isNaN(value) ? parseInt(value) : 0;

	value = Math.max(0, Math.min(value, maxStars));

	for(var i=1;i<= maxStars;i++){
		var nextStar = star.cloneNode(true);
		nextStar.innerHTML = i <= value ? starActive : starInactive;

		stars.appendChild(nextStar);
	}

	element.style.whiteSpace = "nowrap";
	element.style.overflow = "hidden";
	element.style.textOverflow = "ellipsis";

	element.setAttribute("aria-label", value);

	return stars;
}

function traffic(cell, formatterParams, onRendered){
	var value = this.sanitizeHTML(cell.getValue()) || 0,
	el = document.createElement("span"),
	max = formatterParams && formatterParams.max ? formatterParams.max : 100,
	min = formatterParams && formatterParams.min ? formatterParams.min : 0,
	colors = formatterParams && typeof formatterParams.color !== "undefined" ? formatterParams.color : ["red", "orange", "green"],
	color = "#666666",
	percent, percentValue;

	if(isNaN(value) || typeof cell.getValue() === "undefined"){
		return;
	}

	el.classList.add("tabulator-traffic-light");

	//make sure value is in range
	percentValue = parseFloat(value) <= max ? parseFloat(value) : max;
	percentValue = parseFloat(percentValue) >= min ? parseFloat(percentValue) : min;

	//workout percentage
	percent = (max - min) / 100;
	percentValue = Math.round((percentValue - min) / percent);

	//set color
	switch(typeof colors){
		case "string":
			color = colors;
			break;
		case "function":
			color = colors(value);
			break;
		case "object":
			if(Array.isArray(colors)){
				var unit = 100 / colors.length;
				var index = Math.floor(percentValue / unit);

				index = Math.min(index, colors.length - 1);
				index = Math.max(index, 0);
				color = colors[index];
				break;
			}
	}

	el.style.backgroundColor = color;

	return el;
}

function progress(cell, formatterParams = {}, onRendered){ //progress bar
	var value = this.sanitizeHTML(cell.getValue()) || 0,
	element = cell.getElement(),
	max = formatterParams.max ? formatterParams.max : 100,
	min = formatterParams.min ? formatterParams.min : 0,
	legendAlign = formatterParams.legendAlign ? formatterParams.legendAlign : "center",
	percent, percentValue, color, legend, legendColor;

	//make sure value is in range
	percentValue = parseFloat(value) <= max ? parseFloat(value) : max;
	percentValue = parseFloat(percentValue) >= min ? parseFloat(percentValue) : min;

	//workout percentage
	percent = (max - min) / 100;
	percentValue = Math.round((percentValue - min) / percent);

	//set bar color
	switch(typeof formatterParams.color){
		case "string":
			color = formatterParams.color;
			break;
		case "function":
			color = formatterParams.color(value);
			break;
		case "object":
			if(Array.isArray(formatterParams.color)){
				let unit = 100 / formatterParams.color.length;
				let index = Math.floor(percentValue / unit);

				index = Math.min(index, formatterParams.color.length - 1);
				index = Math.max(index, 0);
				color = formatterParams.color[index];
				break;
			}
		default:
			color = "#2DC214";
	}

	//generate legend
	switch(typeof formatterParams.legend){
		case "string":
			legend = formatterParams.legend;
			break;
		case "function":
			legend = formatterParams.legend(value);
			break;
		case "boolean":
			legend = value;
			break;
		default:
			legend = false;
	}

	//set legend color
	switch(typeof formatterParams.legendColor){
		case "string":
			legendColor = formatterParams.legendColor;
			break;
		case "function":
			legendColor = formatterParams.legendColor(value);
			break;
		case "object":
			if(Array.isArray(formatterParams.legendColor)){
				let unit = 100 / formatterParams.legendColor.length;
				let index = Math.floor(percentValue / unit);

				index = Math.min(index, formatterParams.legendColor.length - 1);
				index = Math.max(index, 0);
				legendColor = formatterParams.legendColor[index];
			}
			break;
		default:
			legendColor = "#000";
	}

	element.style.minWidth = "30px";
	element.style.position = "relative";

	element.setAttribute("aria-label", percentValue);

	var barEl = document.createElement("div");
	barEl.style.display = "inline-block";
	barEl.style.width = percentValue + "%";
	barEl.style.backgroundColor = color;
	barEl.style.height = "100%";

	barEl.setAttribute('data-max', max);
	barEl.setAttribute('data-min', min);

	var barContainer = document.createElement("div");
	barContainer.style.position = "relative";
	barContainer.style.width = "100%";
	barContainer.style.height = "100%";

	if(legend){
		var legendEl = document.createElement("div");
		legendEl.style.position = "absolute";
		legendEl.style.top = 0;
		legendEl.style.left = 0;
		legendEl.style.textAlign = legendAlign;
		legendEl.style.width = "100%";
		legendEl.style.color = legendColor;
		legendEl.innerHTML = legend;
	}

	onRendered(function(){

		//handle custom element needed if formatter is to be included in printed/downloaded output
		if(!(cell instanceof CellComponent)){
			var holderEl = document.createElement("div");
			holderEl.style.position = "absolute";
			holderEl.style.top = "4px";
			holderEl.style.bottom = "4px";
			holderEl.style.left = "4px";
			holderEl.style.right = "4px";

			element.appendChild(holderEl);

			element = holderEl;
		}

		element.appendChild(barContainer);
		barContainer.appendChild(barEl);

		if(legend){
			barContainer.appendChild(legendEl);
		}
	});

	return "";
}

function color(cell, formatterParams, onRendered){
	cell.getElement().style.backgroundColor = this.sanitizeHTML(cell.getValue());
	return "";
}

function buttonTick(cell, formatterParams, onRendered){
	return '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>';
}

function buttonCross(cell, formatterParams, onRendered){
	return '<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';
}

function toggle(cell, formatterParams, onRendered){
	var value = cell.getValue(),
	size = formatterParams.size ||15,
	sizePx = size + "px",
	containEl, switchEl,
	onValue = formatterParams.hasOwnProperty("onValue") ? formatterParams.onValue : true,
	offValue = formatterParams.hasOwnProperty("offValue") ? formatterParams.offValue : false,


	state = formatterParams.onTruthy ? value : value === onValue;

	
	containEl = document.createElement("div");
	containEl.classList.add("tabulator-toggle");

	if(state){
		containEl.classList.add("tabulator-toggle-on");
		containEl.style.flexDirection = "row-reverse";

		if(formatterParams.onColor){
			containEl.style.background = formatterParams.onColor;
		}
	}else {
		if(formatterParams.offColor){
			containEl.style.background = formatterParams.offColor;
		}
	}

	containEl.style.width = (2.5 * size) + "px";
	containEl.style.borderRadius = sizePx;

	if(formatterParams.clickable){
		containEl.addEventListener("click", (e) => {
			cell.setValue(state ? offValue : onValue);
		});
	}

	switchEl = document.createElement("div");
	switchEl.classList.add("tabulator-toggle-switch");

	switchEl.style.height = sizePx;
	switchEl.style.width = sizePx;
	switchEl.style.borderRadius = sizePx;
	
	containEl.appendChild(switchEl);
	
	return containEl;
}

function rownum(cell, formatterParams, onRendered){
	var content = document.createElement("span");
	var row = cell.getRow();
	var table = cell.getTable();

	row.watchPosition((position) => {
		if (formatterParams.relativeToPage) {
			position += table.modules.page.getPageSize() * (table.modules.page.getPage() - 1);
		}
		content.innerText = position;
	});
	
	return content;
}

function handle(cell, formatterParams, onRendered){
	cell.getElement().classList.add("tabulator-row-handle");
	return "<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>";
}

function adaptable(cell, params, onRendered){
	var lookup, formatterFunc, formatterParams;
    
	function defaultLookup(cell){
		var value = cell.getValue(),
		formatter = "plaintext";
        
		switch(typeof value){           
			case "boolean":
				formatter = "tickCross";
				break;
            
			case "string":
				if(value.includes("\n")){
					formatter = "textarea";
				}
				break;
		}
        
		return formatter;
	}
    
	lookup = params.formatterLookup ? params.formatterLookup(cell) : defaultLookup(cell);

	if(params.paramsLookup){
		formatterParams = typeof params.paramsLookup === "function" ? params.paramsLookup(lookup, cell) : params.paramsLookup[lookup];
	}

	formatterFunc = this.table.modules.format.lookupFormatter(lookup);
    
	return  formatterFunc.call(this, cell, formatterParams || {}, onRendered);
}

function array$2(cell, formatterParams, onRendered){
	var delimiter = formatterParams.delimiter || ",",
	value = cell.getValue(),
	table = this.table,
	valueMap;
	
	if(formatterParams.valueMap){
		if(typeof formatterParams.valueMap === "string"){
			valueMap = function(value){
				return value.map((item) => {
					return Helpers.retrieveNestedData(table.options.nestedFieldSeparator, formatterParams.valueMap, item);
				});
			};
		}else {
			valueMap = formatterParams.valueMap;
		}
	}

	if(Array.isArray(value)){
		if(valueMap){
			value = valueMap(value);
		}

		return value.join(delimiter);
	}else {
		return value;
	}
}

function json$1(cell, formatterParams, onRendered){
	var indent = formatterParams.indent || "\t",
	multiline = typeof formatterParams.multiline === "undefined" ? true : formatterParams.multiline,
	replacer = formatterParams.replacer || null,
	value = cell.getValue();
	
	if(multiline){
		cell.getElement().style.whiteSpace = "pre-wrap";
	}

	return JSON.stringify(value, replacer, indent);
}

var defaultFormatters = {
	plaintext:plaintext,
	html:html,
	textarea:textarea,
	money:money,
	link:link,
	image:image,
	tickCross:tickCross,
	datetime:datetime$1,
	datetimediff:datetimediff,
	lookup:lookup,
	star:star,
	traffic:traffic,
	progress:progress,
	color:color,
	buttonTick:buttonTick,
	buttonCross:buttonCross,
	toggle:toggle,
	rownum:rownum,
	handle:handle,
	adaptable:adaptable,
	array:array$2,
	json:json$1,
};

class Format extends Module{
	
	static moduleName = "format";
	
	//load defaults
	static formatters = defaultFormatters;
	
	constructor(table){
		super(table);
		
		this.registerColumnOption("formatter");
		this.registerColumnOption("formatterParams");
		
		this.registerColumnOption("formatterPrint");
		this.registerColumnOption("formatterPrintParams");
		this.registerColumnOption("formatterClipboard");
		this.registerColumnOption("formatterClipboardParams");
		this.registerColumnOption("formatterHtmlOutput");
		this.registerColumnOption("formatterHtmlOutputParams");
		this.registerColumnOption("titleFormatter");
		this.registerColumnOption("titleFormatterParams");
	}
	
	initialize(){
		this.subscribe("cell-format", this.formatValue.bind(this));
		this.subscribe("cell-rendered", this.cellRendered.bind(this));
		this.subscribe("column-layout", this.initializeColumn.bind(this));
		this.subscribe("column-format", this.formatHeader.bind(this));
	}
	
	//initialize column formatter
	initializeColumn(column){
		column.modules.format = this.lookupTypeFormatter(column, "");
		
		if(typeof column.definition.formatterPrint !== "undefined"){
			column.modules.format.print = this.lookupTypeFormatter(column, "Print");
		}
		
		if(typeof column.definition.formatterClipboard !== "undefined"){
			column.modules.format.clipboard = this.lookupTypeFormatter(column, "Clipboard");
		}
		
		if(typeof column.definition.formatterHtmlOutput !== "undefined"){
			column.modules.format.htmlOutput = this.lookupTypeFormatter(column, "HtmlOutput");
		}
	}
	
	lookupTypeFormatter(column, type){
		var config = {params:column.definition["formatter" + type + "Params"] || {}},
		formatter = column.definition["formatter" + type];
		
		config.formatter = this.lookupFormatter(formatter);
		
		return config;
	}
	
	
	lookupFormatter(formatter){
		var formatterFunc;

		//set column formatter
		switch(typeof formatter){
			case "string":
				if(Format.formatters[formatter]){
					formatterFunc = Format.formatters[formatter];
				}else {
					console.warn("Formatter Error - No such formatter found: ", formatter);
					formatterFunc = Format.formatters.plaintext;
				}
				break;
			
			case "function":
				formatterFunc = formatter;
				break;
			
			default:
				formatterFunc = Format.formatters.plaintext;
				break;
		}
		
		return formatterFunc;
	}
	
	cellRendered(cell){
		if(cell.modules.format && cell.modules.format.renderedCallback && !cell.modules.format.rendered){
			cell.modules.format.renderedCallback();
			cell.modules.format.rendered = true;
		}
	}
	
	//return a formatted value for a column header
	formatHeader(column, title, el){
		var formatter, params, onRendered, mockCell;
		
		if(column.definition.titleFormatter){
			formatter = this.lookupFormatter(column.definition.titleFormatter);
			
			onRendered = (callback) => {
				column.titleFormatterRendered = callback;
			};
			
			mockCell = {
				getValue:function(){
					return title;
				},
				getElement:function(){
					return el;
				},
				getType:function(){
					return "header";
				},
				getColumn:function(){
					return column.getComponent();
				},
				getTable:() => {
					return this.table;
				}
			};
			
			params = column.definition.titleFormatterParams || {};
			
			params = typeof params === "function" ? params() : params;
			
			return formatter.call(this, mockCell, params, onRendered);
		}else {
			return title;
		}
	}
	
	
	//return a formatted value for a cell
	formatValue(cell){
		var component = cell.getComponent(),
		params = typeof cell.column.modules.format.params === "function" ? cell.column.modules.format.params(component) : cell.column.modules.format.params;
		
		function onRendered(callback){
			if(!cell.modules.format){
				cell.modules.format = {};
			}
			
			cell.modules.format.renderedCallback = callback;
			cell.modules.format.rendered = false;
		}
		
		return cell.column.modules.format.formatter.call(this, component, params, onRendered);
	}
	
	formatExportValue(cell, type){
		var formatter = cell.column.modules.format[type],
		params;
		
		if(formatter){
			params = typeof formatter.params === "function" ? formatter.params(cell.getComponent()) : formatter.params;
			
			function onRendered(callback){
				if(!cell.modules.format){
					cell.modules.format = {};
				}
				
				cell.modules.format.renderedCallback = callback;
				cell.modules.format.rendered = false;
			}
			
			return formatter.formatter.call(this, cell.getComponent(), params, onRendered);
			
		}else {
			return this.formatValue(cell);
		}
	}
	
	sanitizeHTML(value){
		if(value){
			var entityMap = {
				'&': '&amp;',
				'<': '&lt;',
				'>': '&gt;',
				'"': '&quot;',
				"'": '&#39;',
				'/': '&#x2F;',
				'`': '&#x60;',
				'=': '&#x3D;'
			};
			
			return String(value).replace(/[&<>"'`=/]/g, function (s) {
				return entityMap[s];
			});
		}else {
			return value;
		}
	}
	
	emptyToSpace(value){
		return value === null || typeof value === "undefined" || value === "" ? "&nbsp;" : value;
	}
	
}

class FrozenColumns extends Module{

	static moduleName = "frozenColumns";
	
	constructor(table){
		super(table);
		
		this.leftColumns = [];
		this.rightColumns = [];
		this.initializationMode = "left";
		this.active = false;
		this.blocked = true;
		
		this.registerColumnOption("frozen");
	}
	
	//reset initial state
	reset(){
		this.initializationMode = "left";
		this.leftColumns = [];
		this.rightColumns = [];
		this.active = false;
	}
	
	initialize(){
		this.subscribe("cell-layout", this.layoutCell.bind(this));
		this.subscribe("column-init", this.initializeColumn.bind(this));
		this.subscribe("column-width", this.layout.bind(this));
		this.subscribe("row-layout-after", this.layoutRow.bind(this));
		this.subscribe("table-layout", this.layout.bind(this));
		this.subscribe("columns-loading", this.reset.bind(this));
		
		this.subscribe("column-add", this.reinitializeColumns.bind(this));
		this.subscribe("column-deleted", this.reinitializeColumns.bind(this));
		this.subscribe("column-hide", this.reinitializeColumns.bind(this));
		this.subscribe("column-show", this.reinitializeColumns.bind(this));
		this.subscribe("columns-loaded", this.reinitializeColumns.bind(this));
		
		this.subscribe("table-redraw", this.layout.bind(this));
		this.subscribe("layout-refreshing", this.blockLayout.bind(this));
		this.subscribe("layout-refreshed", this.unblockLayout.bind(this));
		this.subscribe("scrollbar-vertical", this.adjustForScrollbar.bind(this));
	}
	
	blockLayout(){
		this.blocked = true;
	}
	
	unblockLayout(){
		this.blocked = false;
	}
	
	layoutCell(cell){
		this.layoutElement(cell.element, cell.column);
	}
	
	reinitializeColumns(){
		this.reset();
		
		this.table.columnManager.columnsByIndex.forEach((column) => {
			this.initializeColumn(column);
		});

		this.layout();
	}
	
	//initialize specific column
	initializeColumn(column){
		var config = {margin:0, edge:false};
		
		if(!column.isGroup){			
			if(this.frozenCheck(column)){
				config.position = this.initializationMode;
				
				if(this.initializationMode == "left"){
					this.leftColumns.push(column);
				}else {
					this.rightColumns.unshift(column);
				}
				
				this.active = true;
				
				column.modules.frozen = config;
			}else {
				this.initializationMode = "right";
			}
		}
	}
	
	frozenCheck(column){
		if(column.parent.isGroup && column.definition.frozen){
			console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups");
		}
		
		if(column.parent.isGroup){
			return this.frozenCheck(column.parent);
		}else {
			return column.definition.frozen;
		}
	}
	
	//layout calculation rows
	layoutCalcRows(){
		if(this.table.modExists("columnCalcs")){
			if(this.table.modules.columnCalcs.topInitialized && this.table.modules.columnCalcs.topRow){
				this.layoutRow(this.table.modules.columnCalcs.topRow);
			}
			
			if(this.table.modules.columnCalcs.botInitialized && this.table.modules.columnCalcs.botRow){
				this.layoutRow(this.table.modules.columnCalcs.botRow);
			}
			
			if(this.table.modExists("groupRows")){
				this.layoutGroupCalcs(this.table.modules.groupRows.getGroups());
			}
		}
	}
	
	layoutGroupCalcs(groups){
		groups.forEach((group) => {
			if(group.calcs.top){
				this.layoutRow(group.calcs.top);
			}
			
			if(group.calcs.bottom){
				this.layoutRow(group.calcs.bottom);
			}
			
			if(group.groupList && group.groupList.length){
				this.layoutGroupCalcs(group.groupList);
			}
		});
	}
	
	//calculate column positions and layout headers
	layoutColumnPosition(allCells){
		var leftParents = [];
		
		var leftMargin = 0;
		var rightMargin = 0;
		
		this.leftColumns.forEach((column, i) => {	
			column.modules.frozen.marginValue = leftMargin;
			column.modules.frozen.margin = column.modules.frozen.marginValue + "px";
			
			if(column.visible){
				leftMargin += column.getWidth();
			}
			
			if(i == this.leftColumns.length - 1){
				column.modules.frozen.edge = true;
			}else {
				column.modules.frozen.edge = false;
			}
			
			if(column.parent.isGroup){
				var parentEl = this.getColGroupParentElement(column);
				if(!leftParents.includes(parentEl)){
					this.layoutElement(parentEl, column);
					leftParents.push(parentEl);
				}
				
				parentEl.classList.toggle("tabulator-frozen-left",  column.modules.frozen.edge && column.modules.frozen.position === "left");
				parentEl.classList.toggle("tabulator-frozen-right", column.modules.frozen.edge && column.modules.frozen.position === "right");
			}else {
				this.layoutElement(column.getElement(), column);
			}
			
			if(allCells){
				column.cells.forEach((cell) => {
					this.layoutElement(cell.getElement(true), column);
				});
			}
		});
		
		this.rightColumns.forEach((column, i) => {
			
			column.modules.frozen.marginValue = rightMargin;
			column.modules.frozen.margin = column.modules.frozen.marginValue + "px";
			
			if(column.visible){
				rightMargin += column.getWidth();
			}
			
			if(i == this.rightColumns.length - 1){
				column.modules.frozen.edge = true;
			}else {
				column.modules.frozen.edge = false;
			}
			
			if(column.parent.isGroup){
				this.layoutElement(this.getColGroupParentElement(column), column);
			}else {
				this.layoutElement(column.getElement(), column);
			}
			
			if(allCells){
				column.cells.forEach((cell) => {
					this.layoutElement(cell.getElement(true), column);
				});
			}
		});
	}
	
	getColGroupParentElement(column){
		return column.parent.isGroup ? this.getColGroupParentElement(column.parent) : column.getElement();
	}
	
	//layout columns appropriately
	layout(){	
		if(this.active && !this.blocked){
			//calculate left columns
			this.layoutColumnPosition();
			
			this.reinitializeRows();
			
			this.layoutCalcRows();
		}
	}
	
	reinitializeRows(){
		var visibleRows = this.table.rowManager.getVisibleRows(true);
		var otherRows = this.table.rowManager.getRows().filter(row => !visibleRows.includes(row));
		
		otherRows.forEach((row) =>{
			row.deinitialize();
		});
		
		visibleRows.forEach((row) =>{
			if(row.type === "row"){
				this.layoutRow(row);
			}
		});
	}
	
	layoutRow(row){
		if(this.table.options.layout === "fitDataFill" && this.rightColumns.length){
			this.table.rowManager.getTableElement().style.minWidth = "calc(100% - " + this.rightMargin + ")";
		}
		
		this.leftColumns.forEach((column) => {
			var cell = row.getCell(column);
			
			if(cell){
				this.layoutElement(cell.getElement(true), column);
			}
		});
		
		this.rightColumns.forEach((column) => {
			var cell = row.getCell(column);
			
			if(cell){
				this.layoutElement(cell.getElement(true), column);
			}
		});
	}
	
	layoutElement(element, column){
		var position;
		
		if(column.modules.frozen && element){
			element.style.position = "sticky";

			if(this.table.rtl){
				position = column.modules.frozen.position === "left" ? "right" : "left";
			}else {
				position = column.modules.frozen.position;
			}
		
			element.style[position] = column.modules.frozen.margin;

			element.classList.add("tabulator-frozen");
			
			element.classList.toggle("tabulator-frozen-left",  column.modules.frozen.edge && column.modules.frozen.position === "left");
			element.classList.toggle("tabulator-frozen-right", column.modules.frozen.edge && column.modules.frozen.position === "right");
		}
	}

	adjustForScrollbar(width){
		if(this.rightColumns.length){
			this.table.columnManager.getContentsElement().style.width = "calc(100% - " + width + "px)";
		}
	}

	getFrozenColumns(){
		return this.leftColumns.concat(this.rightColumns);
	}
	
	_calcSpace(columns, index){
		var width = 0;
		
		for (let i = 0; i < index; i++){
			if(columns[i].visible){
				width += columns[i].getWidth();
			}
		}
		
		return width;
	}
}

class FrozenRows extends Module{

	static moduleName = "frozenRows";

	constructor(table){
		super(table);

		this.topElement = document.createElement("div");
		this.rows = [];

		//register component functions
		this.registerComponentFunction("row", "freeze", this.freezeRow.bind(this));
		this.registerComponentFunction("row", "unfreeze", this.unfreezeRow.bind(this));
		this.registerComponentFunction("row", "isFrozen", this.isRowFrozen.bind(this));

		//register table options
		this.registerTableOption("frozenRowsField", "id"); //field to choose frozen rows by
		this.registerTableOption("frozenRows", false); //holder for frozen row identifiers
	}

	initialize(){
		var	fragment = document.createDocumentFragment();
		
		this.rows = [];

		this.topElement.classList.add("tabulator-frozen-rows-holder");
		
		fragment.appendChild(document.createElement("br"));
		fragment.appendChild(this.topElement);

		// this.table.columnManager.element.append(this.topElement);
		this.table.columnManager.getContentsElement().insertBefore(fragment, this.table.columnManager.headersElement.nextSibling);

		this.subscribe("row-deleting", this.detachRow.bind(this));
		this.subscribe("rows-visible", this.visibleRows.bind(this));

		this.registerDisplayHandler(this.getRows.bind(this), 10);

		if(this.table.options.frozenRows){
			this.subscribe("data-processed", this.initializeRows.bind(this));
			this.subscribe("row-added", this.initializeRow.bind(this));
			this.subscribe("table-redrawing", this.resizeHolderWidth.bind(this));
			this.subscribe("column-resized", this.resizeHolderWidth.bind(this));
			this.subscribe("column-show", this.resizeHolderWidth.bind(this));
			this.subscribe("column-hide", this.resizeHolderWidth.bind(this));
		}

		this.resizeHolderWidth();
	}

	resizeHolderWidth(){
		this.topElement.style.minWidth = this.table.columnManager.headersElement.offsetWidth + "px";
	}

	initializeRows(){
		this.table.rowManager.getRows().forEach((row) => {
			this.initializeRow(row);
		});
	}

	initializeRow(row){
		var frozenRows = this.table.options.frozenRows,
		rowType = typeof frozenRows;

		if(rowType === "number"){
			if(row.getPosition() && (row.getPosition() + this.rows.length) <= frozenRows){
				this.freezeRow(row);
			}
		}else if(rowType === "function"){
			if(frozenRows.call(this.table, row.getComponent())){
				this.freezeRow(row);
			}
		}else if(Array.isArray(frozenRows)){
			if(frozenRows.includes(row.data[this.options("frozenRowsField")])){
				this.freezeRow(row);
			}
		}
	}

	isRowFrozen(row){
		var index = this.rows.indexOf(row);
		return index > -1;
	}

	isFrozen(){
		return !!this.rows.length;
	}

	visibleRows(viewable, rows){
		this.rows.forEach((row) => {
			rows.push(row);
		});

		return rows;
	}

	//filter frozen rows out of display data
	getRows(rows){
		var output = rows.slice(0);

		this.rows.forEach(function(row){
			var index = output.indexOf(row);

			if(index > -1){
				output.splice(index, 1);
			}
		});

		return output;
	}

	freezeRow(row){
		if(!row.modules.frozen){
			row.modules.frozen = true;
			this.topElement.appendChild(row.getElement());
			row.initialize();
			row.normalizeHeight();
		
			this.rows.push(row);

			this.refreshData(false, "display");

			this.table.rowManager.adjustTableSize();

			this.styleRows();

		}else {
			console.warn("Freeze Error - Row is already frozen");
		}
	}

	unfreezeRow(row){
		if(row.modules.frozen){

			row.modules.frozen = false;

			this.detachRow(row);

			this.table.rowManager.adjustTableSize();

			this.refreshData(false, "display");

			if(this.rows.length){
				this.styleRows();
			}

		}else {
			console.warn("Freeze Error - Row is already unfrozen");
		}
	}

	detachRow(row){
		var index = this.rows.indexOf(row);

		if(index > -1){
			var rowEl = row.getElement();

			if(rowEl.parentNode){
				rowEl.parentNode.removeChild(rowEl);
			}

			this.rows.splice(index, 1);
		}
	}

	styleRows(row){
		this.rows.forEach((row, i) => {
			this.table.rowManager.styleRow(row, i);
		});
	}
}

//public group object
class GroupComponent {
	constructor (group){
		this._group = group;
		this.type = "GroupComponent";

		return new Proxy(this, {
			get: function(target, name, receiver) {
				if (typeof target[name] !== "undefined") {
					return target[name];
				}else {
					return target._group.groupManager.table.componentFunctionBinder.handle("group", target._group, name);
				}
			}
		});
	}

	getKey(){
		return this._group.key;
	}

	getField(){
		return this._group.field;
	}

	getElement(){
		return this._group.element;
	}

	getRows(){
		return this._group.getRows(true);
	}

	getSubGroups(){
		return this._group.getSubGroups(true);
	}

	getParentGroup(){
		return this._group.parent ? this._group.parent.getComponent() : false;
	}

	isVisible(){
		return this._group.visible;
	}

	show(){
		this._group.show();
	}

	hide(){
		this._group.hide();
	}

	toggle(){
		this._group.toggleVisibility();
	}

	scrollTo(position, ifVisible){
		return this._group.groupManager.table.rowManager.scrollToRow(this._group, position, ifVisible);
	}

	_getSelf(){
		return this._group;
	}

	getTable(){
		return this._group.groupManager.table;
	}
}

//Group functions
class Group{
	
	constructor(groupManager, parent, level, key, field, generator, oldGroup){
		this.groupManager = groupManager;
		this.parent = parent;
		this.key = key;
		this.level = level;
		this.field = field;
		this.hasSubGroups = level < (groupManager.groupIDLookups.length - 1);
		this.addRow = this.hasSubGroups ? this._addRowToGroup : this._addRow;
		this.type = "group"; //type of element
		this.old = oldGroup;
		this.rows = [];
		this.groups = [];
		this.groupList = [];
		this.generator = generator;
		this.element = false;
		this.elementContents = false;
		this.height = 0;
		this.outerHeight = 0;
		this.initialized = false;
		this.calcs = {};
		this.initialized = false;
		this.modules = {};
		this.arrowElement = false;
		
		this.visible = oldGroup ? oldGroup.visible : (typeof groupManager.startOpen[level] !== "undefined" ? groupManager.startOpen[level] : groupManager.startOpen[0]);
		
		this.component = null;
		
		this.createElements();
		this.addBindings();
		
		this.createValueGroups();
	}
	
	wipe(elementsOnly){
		if(!elementsOnly){
			if(this.groupList.length){
				this.groupList.forEach(function(group){
					group.wipe();
				});
			}else {
				this.rows.forEach((row) => {
					if(row.modules){
						delete row.modules.group;
					}
				});
			}
		}
		
		this.element = false;
		this.arrowElement = false;
		this.elementContents = false;
	}
	
	createElements(){
		var arrow = document.createElement("div");
		arrow.classList.add("tabulator-arrow");
		
		this.element = document.createElement("div");
		this.element.classList.add("tabulator-row");
		this.element.classList.add("tabulator-group");
		this.element.classList.add("tabulator-group-level-" + this.level);
		this.element.setAttribute("role", "rowgroup");
		
		this.arrowElement = document.createElement("div");
		this.arrowElement.classList.add("tabulator-group-toggle");
		this.arrowElement.appendChild(arrow);
		
		//setup movable rows
		if(this.groupManager.table.options.movableRows !== false && this.groupManager.table.modExists("moveRow")){
			this.groupManager.table.modules.moveRow.initializeGroupHeader(this);
		}
	}
	
	createValueGroups(){
		var level = this.level + 1;
		if(this.groupManager.allowedValues && this.groupManager.allowedValues[level]){
			this.groupManager.allowedValues[level].forEach((value) => {
				this._createGroup(value, level);
			});
		}
	}
	
	addBindings(){
		var toggleElement;
		
		if(this.groupManager.table.options.groupToggleElement){
			toggleElement = this.groupManager.table.options.groupToggleElement == "arrow" ? this.arrowElement : this.element;
			
			toggleElement.addEventListener("click", (e) => {
				if(this.groupManager.table.options.groupToggleElement === "arrow"){
					e.stopPropagation();
					e.stopImmediatePropagation();
				}

				//allow click event to propagate before toggling visibility
				setTimeout(() => {
					this.toggleVisibility();
				});
			});
		}
	}
	
	_createGroup(groupID, level){
		var groupKey = level + "_" + groupID;
		var group = new Group(this.groupManager, this, level, groupID,  this.groupManager.groupIDLookups[level].field, this.groupManager.headerGenerator[level] || this.groupManager.headerGenerator[0], this.old ? this.old.groups[groupKey] : false);
		
		this.groups[groupKey] = group;
		this.groupList.push(group);
	}
	
	_addRowToGroup(row){
		
		var level = this.level + 1;
		
		if(this.hasSubGroups){
			var groupID = this.groupManager.groupIDLookups[level].func(row.getData()),
			groupKey = level + "_" + groupID;
			
			if(this.groupManager.allowedValues && this.groupManager.allowedValues[level]){
				if(this.groups[groupKey]){
					this.groups[groupKey].addRow(row);
				}
			}else {
				if(!this.groups[groupKey]){
					this._createGroup(groupID, level);
				}
				
				this.groups[groupKey].addRow(row);
			}
		}
	}
	
	_addRow(row){
		this.rows.push(row);
		row.modules.group = this;
	}
	
	insertRow(row, to, after){
		var data = this.conformRowData({});
		
		row.updateData(data);
		
		var toIndex = this.rows.indexOf(to);
		
		if(toIndex > -1){
			if(after){
				this.rows.splice(toIndex+1, 0, row);
			}else {
				this.rows.splice(toIndex, 0, row);
			}
		}else {
			if(after){
				this.rows.push(row);
			}else {
				this.rows.unshift(row);
			}
		}
		
		row.modules.group = this;
		
		// this.generateGroupHeaderContents();
		
		if(this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.options.columnCalcs != "table"){
			this.groupManager.table.modules.columnCalcs.recalcGroup(this);
		}
		
		this.groupManager.updateGroupRows(true);
	}
	
	scrollHeader(left){
		if(this.arrowElement){
			this.arrowElement.style.marginLeft = left;
			
			this.groupList.forEach(function(child){
				child.scrollHeader(left);
			});
		}
	}
	
	getRowIndex(row){}
	
	//update row data to match grouping constraints
	conformRowData(data){
		if(this.field){
			data[this.field] = this.key;
		}else {
			console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function");
		}
		
		if(this.parent){
			data = this.parent.conformRowData(data);
		}
		
		return data;
	}
	
	removeRow(row){
		var index = this.rows.indexOf(row);
		var el = row.getElement();
		
		if(index > -1){
			this.rows.splice(index, 1);
		}
		
		if(!this.groupManager.table.options.groupValues && !this.rows.length){
			if(this.parent){
				this.parent.removeGroup(this);
			}else {
				this.groupManager.removeGroup(this);
			}		
			
			this.groupManager.updateGroupRows(true);
			
		}else {
			
			if(el.parentNode){
				el.parentNode.removeChild(el);
			}
			
			if(!this.groupManager.blockRedraw){
				this.generateGroupHeaderContents();
				
				if(this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.options.columnCalcs != "table"){
					this.groupManager.table.modules.columnCalcs.recalcGroup(this);
				}
			}
			
		}
	}
	
	removeGroup(group){
		var groupKey = group.level + "_" + group.key,
		index;
		
		if(this.groups[groupKey]){
			delete this.groups[groupKey];
			
			index = this.groupList.indexOf(group);
			
			if(index > -1){
				this.groupList.splice(index, 1);
			}
			
			if(!this.groupList.length){
				if(this.parent){
					this.parent.removeGroup(this);
				}else {
					this.groupManager.removeGroup(this);
				}
			}
		}
	}
	
	getHeadersAndRows(){
		var output = [];
		
		output.push(this);
		
		this._visSet();
		
		
		if(this.calcs.top){
			this.calcs.top.detachElement();
			this.calcs.top.deleteCells();
		}
		
		if(this.calcs.bottom){
			this.calcs.bottom.detachElement();
			this.calcs.bottom.deleteCells();
		}
		
		
		
		if(this.visible){
			if(this.groupList.length){
				this.groupList.forEach(function(group){
					output = output.concat(group.getHeadersAndRows());
				});
				
			}else {
				if(this.groupManager.table.options.columnCalcs != "table" && this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.modules.columnCalcs.hasTopCalcs()){
					this.calcs.top = this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);
					output.push(this.calcs.top);
				}
				
				output = output.concat(this.rows);
				
				if(this.groupManager.table.options.columnCalcs != "table" &&  this.groupManager.table.modExists("columnCalcs") && this.groupManager.table.modules.columnCalcs.hasBottomCalcs()){
					this.calcs.bottom = this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);
					output.push(this.calcs.bottom);
				}
			}
		}else {
			if(!this.groupList.length && this.groupManager.table.options.columnCalcs != "table"){
				
				if(this.groupManager.table.modExists("columnCalcs")){
					if(this.groupManager.table.modules.columnCalcs.hasTopCalcs()){
						if(this.groupManager.table.options.groupClosedShowCalcs){
							this.calcs.top = this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows);
							output.push(this.calcs.top);
						}
					}
					
					if(this.groupManager.table.modules.columnCalcs.hasBottomCalcs()){						
						if(this.groupManager.table.options.groupClosedShowCalcs){
							this.calcs.bottom = this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows);
							output.push(this.calcs.bottom);
						}
					}
				}
			}
			
		}
		
		return output;
	}
	
	getData(visible, transform){
		var output = [];
		
		this._visSet();
		
		if(!visible || (visible && this.visible)){
			this.rows.forEach((row) => {
				output.push(row.getData(transform || "data"));
			});
		}
		
		return output;
	}
	
	getRowCount(){
		var count = 0;
		
		if(this.groupList.length){
			this.groupList.forEach((group) => {
				count += group.getRowCount();
			});
		}else {
			count = this.rows.length;
		}
		return count;
	}

	
	toggleVisibility(){
		if(this.visible){
			this.hide();
		}else {
			this.show();
		}
	}
	
	hide(){
		this.visible = false;
		
		if(this.groupManager.table.rowManager.getRenderMode() == "basic" && !this.groupManager.table.options.pagination){
			
			this.element.classList.remove("tabulator-group-visible");
			
			if(this.groupList.length){
				this.groupList.forEach((group) => {
					
					var rows = group.getHeadersAndRows();
					
					rows.forEach((row) => {
						row.detachElement();
					});
				});
				
			}else {
				this.rows.forEach((row) => {
					var rowEl = row.getElement();
					rowEl.parentNode.removeChild(rowEl);
				});
			}
			
			this.groupManager.updateGroupRows(true);
			
		}else {
			this.groupManager.updateGroupRows(true);
		}
		
		this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged", this.getComponent(), false);
	}
	
	show(){
		this.visible = true;
		
		if(this.groupManager.table.rowManager.getRenderMode() == "basic" && !this.groupManager.table.options.pagination){
			
			this.element.classList.add("tabulator-group-visible");
			
			var prev = this.generateElement();
			
			if(this.groupList.length){
				this.groupList.forEach((group) => {
					var rows = group.getHeadersAndRows();
					
					rows.forEach((row) => {
						var rowEl = row.getElement();
						prev.parentNode.insertBefore(rowEl, prev.nextSibling);
						row.initialize();
						prev = rowEl;
					});
				});
				
			}else {
				this.rows.forEach((row) => {
					var rowEl = row.getElement();
					prev.parentNode.insertBefore(rowEl, prev.nextSibling);
					row.initialize();
					prev = rowEl;
				});
			}
			
			this.groupManager.updateGroupRows(true);
		}else {
			this.groupManager.updateGroupRows(true);
		}
		
		this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged", this.getComponent(), true);
	}
	
	_visSet(){
		var data = [];
		
		if(typeof this.visible == "function"){
			
			this.rows.forEach(function(row){
				data.push(row.getData());
			});
			
			this.visible = this.visible(this.key, this.getRowCount(), data, this.getComponent());
		}
	}
	
	getRowGroup(row){
		var match = false;
		if(this.groupList.length){
			this.groupList.forEach(function(group){
				var result = group.getRowGroup(row);
				
				if(result){
					match = result;
				}
			});
		}else {
			if(this.rows.find(function(item){
				return item === row;
			})){
				match = this;
			}
		}
		
		return match;
	}
	
	getSubGroups(component){
		var output = [];
		
		this.groupList.forEach(function(child){
			output.push(component ? child.getComponent() : child);
		});
		
		return output;
	}
	
	getRows(component, includeChildren){
		var output = [];
		
		if(includeChildren && this.groupList.length){
			this.groupList.forEach((group) => {
				output = output.concat(group.getRows(component, includeChildren));
			});
		}else {
			this.rows.forEach(function(row){
				output.push(component ? row.getComponent() : row);
			});
		}
		
		return output;
	}
	
	generateGroupHeaderContents(){
		var data = [];
		
		var rows = this.getRows(false, true);
		
		rows.forEach(function(row){
			data.push(row.getData());
		});
		
		this.elementContents = this.generator(this.key, this.getRowCount(), data, this.getComponent());
		
		while(this.element.firstChild) this.element.removeChild(this.element.firstChild);
		
		if(typeof this.elementContents === "string"){
			this.element.innerHTML = this.elementContents;
		}else {
			this.element.appendChild(this.elementContents);
		}
		
		this.element.insertBefore(this.arrowElement, this.element.firstChild);
	}
	
	getPath(path = []) {
		path.unshift(this.key);
		if(this.parent) {
			this.parent.getPath(path);
		}
		return path;
	}
	
	////////////// Standard Row Functions //////////////
	
	getElement(){
		return this.elementContents ? this.element : this.generateElement();
	}
	
	generateElement(){
		this.addBindings = false;
		
		this._visSet();
		
		if(this.visible){
			this.element.classList.add("tabulator-group-visible");
		}else {
			this.element.classList.remove("tabulator-group-visible");
		}
		
		for(var i = 0; i < this.element.childNodes.length; ++i){
			this.element.childNodes[i].parentNode.removeChild(this.element.childNodes[i]);
		}
		
		this.generateGroupHeaderContents();
		
		// this.addBindings();
		
		return this.element;
	}
	
	detachElement(){
		if (this.element && this.element.parentNode){
			this.element.parentNode.removeChild(this.element);
		}
	}
	
	//normalize the height of elements in the row
	normalizeHeight(){
		this.setHeight(this.element.clientHeight);
	}
	
	initialize(force){
		if(!this.initialized || force){
			this.normalizeHeight();
			this.initialized = true;
		}
	}
	
	reinitialize(){
		this.initialized = false;
		this.height = 0;
		
		if(Helpers.elVisible(this.element)){
			this.initialize(true);
		}
	}
	
	setHeight(height){
		if(this.height != height){
			this.height = height;
			this.outerHeight = this.element.offsetHeight;
		}
	}
	
	//return rows outer height
	getHeight(){
		return this.outerHeight;
	}
	
	getGroup(){
		return this;
	}
	
	reinitializeHeight(){}
	
	calcHeight(){}
	
	setCellHeight(){}
	
	clearCellHeight(){}
	
	deinitializeHeight(){}

	rendered(){}
	
	//////////////// Object Generation /////////////////
	getComponent(){
		if(!this.component){
			this.component = new GroupComponent(this);
		}
		
		return this.component;
	}
}

class GroupRows extends Module{

	static moduleName = "groupRows";
	
	constructor(table){
		super(table);
		
		this.groupIDLookups = false; //enable table grouping and set field to group by
		this.startOpen = [function(){return false;}]; //starting state of group
		this.headerGenerator = [function(){return "";}];
		this.groupList = []; //ordered list of groups
		this.allowedValues = false;
		this.groups = {}; //hold row groups
		
		this.displayHandler = this.getRows.bind(this);

		this.blockRedraw = false;
		
		//register table options
		this.registerTableOption("groupBy", false); //enable table grouping and set field to group by
		this.registerTableOption("groupStartOpen", true); //starting state of group
		this.registerTableOption("groupValues", false);
		this.registerTableOption("groupUpdateOnCellEdit", false);
		this.registerTableOption("groupHeader", false); //header generation function
		this.registerTableOption("groupHeaderPrint", null);
		this.registerTableOption("groupHeaderClipboard", null);
		this.registerTableOption("groupHeaderHtmlOutput", null);
		this.registerTableOption("groupHeaderDownload", null);
		this.registerTableOption("groupToggleElement", "arrow");
		this.registerTableOption("groupClosedShowCalcs", false);
		
		//register table functions
		this.registerTableFunction("setGroupBy", this.setGroupBy.bind(this));
		this.registerTableFunction("setGroupValues", this.setGroupValues.bind(this));
		this.registerTableFunction("setGroupStartOpen", this.setGroupStartOpen.bind(this));
		this.registerTableFunction("setGroupHeader", this.setGroupHeader.bind(this));
		this.registerTableFunction("getGroups", this.userGetGroups.bind(this));
		this.registerTableFunction("getGroupedData", this.userGetGroupedData.bind(this));
		
		//register component functions
		this.registerComponentFunction("row", "getGroup", this.rowGetGroup.bind(this));
	}
	
	//initialize group configuration
	initialize(){
		this.subscribe("table-destroy", this._blockRedrawing.bind(this));
		this.subscribe("rows-wipe", this._blockRedrawing.bind(this));
		this.subscribe("rows-wiped", this._restore_redrawing.bind(this));

		if(this.table.options.groupBy){
			if(this.table.options.groupUpdateOnCellEdit){
				this.subscribe("cell-value-updated", this.cellUpdated.bind(this));
				this.subscribe("row-data-changed", this.reassignRowToGroup.bind(this), 0);
			}
			
			this.subscribe("table-built", this.configureGroupSetup.bind(this));
			
			this.subscribe("row-deleting", this.rowDeleting.bind(this));
			this.subscribe("row-deleted", this.rowsUpdated.bind(this));
			this.subscribe("scroll-horizontal", this.scrollHeaders.bind(this));
			this.subscribe("rows-wipe", this.wipe.bind(this));
			this.subscribe("rows-added", this.rowsUpdated.bind(this));
			this.subscribe("row-moving", this.rowMoving.bind(this));
			this.subscribe("row-adding-index", this.rowAddingIndex.bind(this));
			
			this.subscribe("rows-sample", this.rowSample.bind(this));
			
			this.subscribe("render-virtual-fill", this.virtualRenderFill.bind(this));
			
			this.registerDisplayHandler(this.displayHandler, 20);
			
			this.initialized = true;
		}
	}
	
	_blockRedrawing(){
		this.blockRedraw = true;
	}

	_restore_redrawing(){
		this.blockRedraw = false;
	}

	configureGroupSetup(){
		if(this.table.options.groupBy){
			var groupBy = this.table.options.groupBy,
			startOpen = this.table.options.groupStartOpen,
			groupHeader = this.table.options.groupHeader;
			
			this.allowedValues = this.table.options.groupValues;
			
			if(Array.isArray(groupBy) && Array.isArray(groupHeader) && groupBy.length > groupHeader.length){
				console.warn("Error creating group headers, groupHeader array is shorter than groupBy array");
			}
			
			this.headerGenerator = [function(){return "";}];
			this.startOpen = [function(){return false;}]; //starting state of group
			
			this.langBind("groups|item", (langValue, lang) => {
				this.headerGenerator[0] = (value, count, data) => { //header layout function
					return (typeof value === "undefined" ? "" : value) + "<span>(" + count + " " + ((count === 1) ? langValue : lang.groups.items) + ")</span>";
				};
			});
			
			this.groupIDLookups = [];
			
			if(groupBy){
				if(this.table.modExists("columnCalcs") && this.table.options.columnCalcs != "table" && this.table.options.columnCalcs != "both"){
					this.table.modules.columnCalcs.removeCalcs();
				}
			}else {
				if(this.table.modExists("columnCalcs") && this.table.options.columnCalcs != "group"){
					
					var cols = this.table.columnManager.getRealColumns();
					
					cols.forEach((col) => {
						if(col.definition.topCalc){
							this.table.modules.columnCalcs.initializeTopRow();
						}
						
						if(col.definition.bottomCalc){
							this.table.modules.columnCalcs.initializeBottomRow();
						}
					});
				}
			}
			
			if(!Array.isArray(groupBy)){
				groupBy = [groupBy];
			}
			
			groupBy.forEach((group, i) => {
				var lookupFunc, column;
				
				if(typeof group == "function"){
					lookupFunc = group;
				}else {
					column = this.table.columnManager.getColumnByField(group);
					
					if(column){
						lookupFunc = function(data){
							return column.getFieldValue(data);
						};
					}else {
						lookupFunc = function(data){
							return data[group];
						};
					}
				}
				
				this.groupIDLookups.push({
					field: typeof group === "function" ? false : group,
					func:lookupFunc,
					values:this.allowedValues ? this.allowedValues[i] : false,
				});
			});
			
			if(startOpen){
				if(!Array.isArray(startOpen)){
					startOpen = [startOpen];
				}
				
				startOpen.forEach((level) => {
				});
				
				this.startOpen = startOpen;
			}
			
			if(groupHeader){
				this.headerGenerator = Array.isArray(groupHeader) ? groupHeader : [groupHeader];
			}
		}else {
			this.groupList = [];
			this.groups = {};
		}
	}
	
	rowSample(rows, prevValue){
		if(this.table.options.groupBy){
			var group = this.getGroups(false)[0];
			
			prevValue.push(group.getRows(false)[0]);
		}
		
		return prevValue;
	}
	
	virtualRenderFill(){
		var el = this.table.rowManager.tableElement;
		var rows = this.table.rowManager.getVisibleRows();
		
		if(this.table.options.groupBy){
			rows = rows.filter((row) => {
				return row.type !== "group";
			});
			
			el.style.minWidth = !rows.length ? this.table.columnManager.getWidth() + "px" : "";
		}else {
			return rows;
		}
	}
	
	rowAddingIndex(row, index, top){
		if(this.table.options.groupBy){
			this.assignRowToGroup(row);
			
			var groupRows = row.modules.group.rows;
			
			if(groupRows.length > 1){
				if(!index || (index && groupRows.indexOf(index) == -1)){
					if(top){
						if(groupRows[0] !== row){
							index = groupRows[0];
							this.table.rowManager.moveRowInArray(row.modules.group.rows, row, index, !top);
						}
					}else {
						if(groupRows[groupRows.length -1] !== row){
							index = groupRows[groupRows.length -1];
							this.table.rowManager.moveRowInArray(row.modules.group.rows, row, index, !top);
						}
					}
				}else {
					this.table.rowManager.moveRowInArray(row.modules.group.rows, row, index, !top);
				}
			}
			
			return index;
		}
	}
	
	trackChanges(){
		this.dispatch("group-changed");
	}
	
	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////
	
	setGroupBy(groups){
		this.table.options.groupBy = groups;
		
		if(!this.initialized){
			this.initialize();
		}
		
		this.configureGroupSetup();

		if(!groups && this.table.modExists("columnCalcs") && this.table.options.columnCalcs === true){
			this.table.modules.columnCalcs.reinitializeCalcs();
		}
		
		this.refreshData();
		
		this.trackChanges();
	}
	
	setGroupValues(groupValues){
		this.table.options.groupValues = groupValues;
		this.configureGroupSetup();
		this.refreshData();
		
		this.trackChanges();
	}
	
	setGroupStartOpen(values){
		this.table.options.groupStartOpen = values;
		this.configureGroupSetup();
		
		if(this.table.options.groupBy){
			this.refreshData();
			
			this.trackChanges();
		}else {
			console.warn("Grouping Update - cant refresh view, no groups have been set");
		}
	}
	
	setGroupHeader(values){
		this.table.options.groupHeader = values;
		this.configureGroupSetup();
		
		if(this.table.options.groupBy){
			this.refreshData();
			
			this.trackChanges();
		}else {
			console.warn("Grouping Update - cant refresh view, no groups have been set");
		}
	}
	
	userGetGroups(values){
		return this.getGroups(true);
	}
	
	// get grouped table data in the same format as getData()
	userGetGroupedData(){
		return this.table.options.groupBy ? this.getGroupedData() : this.getData();
	}
	
	
	///////////////////////////////////////
	///////// Component Functions /////////
	///////////////////////////////////////
	
	rowGetGroup(row){
		return row.modules.group ? row.modules.group.getComponent() : false;
	}
	
	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////
	
	rowMoving(from, to, after){
		if(this.table.options.groupBy){
			if(!after && to instanceof Group){
				to = this.table.rowManager.prevDisplayRow(from) || to;
			}
			
			var toGroup = to instanceof Group ? to : to.modules.group;
			var fromGroup = from instanceof Group ? from : from.modules.group;
			
			if(toGroup === fromGroup){
				this.table.rowManager.moveRowInArray(toGroup.rows, from, to, after);
			}else {
				if(fromGroup){
					fromGroup.removeRow(from);
				}
				
				toGroup.insertRow(from, to, after);
			}
		}
	}
	
	
	rowDeleting(row){
		//remove from group
		if(this.table.options.groupBy && row.modules.group){
			row.modules.group.removeRow(row);
		}
	}
	
	rowsUpdated(row){
		if(this.table.options.groupBy){
			this.updateGroupRows(true);
		}	
	}
	
	cellUpdated(cell){
		if(this.table.options.groupBy){
			this.reassignRowToGroup(cell.row);
		}
	}
	
	//return appropriate rows with group headers
	getRows(rows){
		if(this.table.options.groupBy && this.groupIDLookups.length){
			
			this.dispatchExternal("dataGrouping");
			
			this.generateGroups(rows);
			
			if(this.subscribedExternal("dataGrouped")){
				this.dispatchExternal("dataGrouped", this.getGroups(true));
			}
			
			return this.updateGroupRows();
			
		}else {
			return rows.slice(0);
		}
	}
	
	getGroups(component){
		var groupComponents = [];
		
		this.groupList.forEach(function(group){
			groupComponents.push(component ? group.getComponent() : group);
		});
		
		return groupComponents;
	}
	
	getChildGroups(group){
		var groupComponents = [];
		
		if(!group){
			group = this;
		}
		
		group.groupList.forEach((child) => {
			if(child.groupList.length){
				groupComponents = groupComponents.concat(this.getChildGroups(child));
			}else {
				groupComponents.push(child);
			}
		});
		
		return groupComponents;
	}
	
	wipe(){
		if(this.table.options.groupBy){
			this.groupList.forEach(function(group){
				group.wipe();
			});
			
			this.groupList = [];
			this.groups = {};
		}
	}
	
	pullGroupListData(groupList) {
		var groupListData = [];
		
		groupList.forEach((group) => {
			var groupHeader = {};
			groupHeader.level = 0;
			groupHeader.rowCount = 0;
			groupHeader.headerContent = "";
			var childData = [];
			
			if (group.hasSubGroups) {
				childData = this.pullGroupListData(group.groupList);
				
				groupHeader.level = group.level;
				groupHeader.rowCount = childData.length - group.groupList.length; // data length minus number of sub-headers
				groupHeader.headerContent = group.generator(group.key, groupHeader.rowCount, group.rows, group);
				
				groupListData.push(groupHeader);
				groupListData = groupListData.concat(childData);
			}
			
			else {
				groupHeader.level = group.level;
				groupHeader.headerContent = group.generator(group.key, group.rows.length, group.rows, group);
				groupHeader.rowCount = group.getRows().length;
				
				groupListData.push(groupHeader);
				
				group.getRows().forEach((row) => {
					groupListData.push(row.getData("data"));
				});
			}
		});
		
		return groupListData;
	}
	
	getGroupedData(){
		
		return this.pullGroupListData(this.groupList);
	}
	
	getRowGroup(row){
		var match = false;
		
		if(this.options("dataTree")){
			row = this.table.modules.dataTree.getTreeParentRoot(row);
		}
		
		this.groupList.forEach((group) => {
			var result = group.getRowGroup(row);
			
			if(result){
				match = result;
			}
		});
		
		return match;
	}
	
	countGroups(){
		return this.groupList.length;
	}
	
	generateGroups(rows){
		var oldGroups = this.groups;
		
		this.groups = {};
		this.groupList = [];
		
		if(this.allowedValues && this.allowedValues[0]){
			this.allowedValues[0].forEach((value) => {
				this.createGroup(value, 0, oldGroups);
			});
			
			rows.forEach((row) => {
				this.assignRowToExistingGroup(row, oldGroups);
			});
		}else {
			rows.forEach((row) => {
				this.assignRowToGroup(row, oldGroups);
			});
		}
		
		Object.values(oldGroups).forEach((group) => {
			group.wipe(true);
		});	
	}
	
	
	createGroup(groupID, level, oldGroups){
		var groupKey = level + "_" + groupID,
		group;
		
		oldGroups = oldGroups || [];
		
		group = new Group(this, false, level, groupID, this.groupIDLookups[0].field, this.headerGenerator[0], oldGroups[groupKey]);
		
		this.groups[groupKey] = group;
		this.groupList.push(group);
	}
	
	assignRowToExistingGroup(row, oldGroups){
		var groupID = this.groupIDLookups[0].func(row.getData()),
		groupKey = "0_" + groupID;
		
		if(this.groups[groupKey]){
			this.groups[groupKey].addRow(row);
		}
	}
	
	assignRowToGroup(row, oldGroups){
		var groupID = this.groupIDLookups[0].func(row.getData()),
		newGroupNeeded = !this.groups["0_" + groupID];
		
		if(newGroupNeeded){
			this.createGroup(groupID, 0, oldGroups);
		}
		
		this.groups["0_" + groupID].addRow(row);
		
		return !newGroupNeeded;
	}
	
	reassignRowToGroup(row){
		if(row.type === "row"){
			var oldRowGroup = row.modules.group,
			oldGroupPath = oldRowGroup.getPath(),
			newGroupPath = this.getExpectedPath(row),
			samePath;
			
			// figure out if new group path is the same as old group path
			samePath = (oldGroupPath.length == newGroupPath.length) && oldGroupPath.every((element, index) => {
				return element === newGroupPath[index];
			});
			
			// refresh if they new path and old path aren't the same (aka the row's groupings have changed)
			if(!samePath) {
				oldRowGroup.removeRow(row);
				this.assignRowToGroup(row, this.groups);
				this.refreshData(true);
			}
		}
	}
	
	getExpectedPath(row) {
		var groupPath = [], rowData = row.getData();
		
		this.groupIDLookups.forEach((groupId) => {
			groupPath.push(groupId.func(rowData));
		});
		
		return groupPath;
	}
	
	updateGroupRows(force){
		var output = [];

		if(!this.blockRedraw){
			this.groupList.forEach((group) => {
				output = output.concat(group.getHeadersAndRows());
			});
			
			if(force){
				this.refreshData(true);
			}
		}
		
		return output;
	}
	
	scrollHeaders(left){
		if(this.table.options.groupBy){
			if(this.table.options.renderHorizontal === "virtual"){
				left -= this.table.columnManager.renderer.vDomPadLeft;
			}
			
			left = left + "px";
			
			this.groupList.forEach((group) => {
				group.scrollHeader(left);
			});
		}
	}
	
	removeGroup(group){
		var groupKey = group.level + "_" + group.key,
		index;
		
		if(this.groups[groupKey]){
			delete this.groups[groupKey];
			
			index = this.groupList.indexOf(group);
			
			if(index > -1){
				this.groupList.splice(index, 1);
			}
		}
	}
	
	checkBasicModeGroupHeaderWidth(){
		var element = this.table.rowManager.tableElement,
		onlyGroupHeaders = true;
		
		this.table.rowManager.getDisplayRows().forEach((row, index) =>{
			this.table.rowManager.styleRow(row, index);
			element.appendChild(row.getElement());
			row.initialize(true);
			
			if(row.type !== "group"){
				onlyGroupHeaders = false;
			}
		});
		
		if(onlyGroupHeaders){
			element.style.minWidth = this.table.columnManager.getWidth() + "px";
		}else {
			element.style.minWidth = "";
		}
	}
	
}

var defaultUndoers = {
	cellEdit: function(action){
		action.component.setValueProcessData(action.data.oldValue);
		action.component.cellRendered();
	},

	rowAdd: function(action){
		action.component.deleteActual();

		this.table.rowManager.checkPlaceholder();
	},

	rowDelete: function(action){
		var newRow = this.table.rowManager.addRowActual(action.data.data, action.data.pos, action.data.index);

		if(this.table.options.groupBy && this.table.modExists("groupRows")){
			this.table.modules.groupRows.updateGroupRows(true);
		}

		this._rebindRow(action.component, newRow);

		this.table.rowManager.checkPlaceholder();
	},

	rowMove: function(action){
		var after = (action.data.posFrom  - action.data.posTo) > 0;

		this.table.rowManager.moveRowActual(action.component, this.table.rowManager.getRowFromPosition(action.data.posFrom), after);

		this.table.rowManager.regenerateRowPositions();
		this.table.rowManager.reRenderInPosition();
	},
};

var defaultRedoers = {
	cellEdit: function(action){
		action.component.setValueProcessData(action.data.newValue);
		action.component.cellRendered();
	},

	rowAdd: function(action){
		var newRow = this.table.rowManager.addRowActual(action.data.data, action.data.pos, action.data.index);

		if(this.table.options.groupBy && this.table.modExists("groupRows")){
			this.table.modules.groupRows.updateGroupRows(true);
		}

		this._rebindRow(action.component, newRow);

		this.table.rowManager.checkPlaceholder();
	},

	rowDelete:function(action){
		action.component.deleteActual();

		this.table.rowManager.checkPlaceholder();
	},

	rowMove: function(action){
		this.table.rowManager.moveRowActual(action.component, this.table.rowManager.getRowFromPosition(action.data.posTo), action.data.after);
		
		this.table.rowManager.regenerateRowPositions();
		this.table.rowManager.reRenderInPosition();
	},
};

var bindings$1 = {
	undo:["ctrl + 90", "meta + 90"],
	redo:["ctrl + 89", "meta + 89"],
};

var actions$1 = {
	undo:function(e){
		var cell = false;
		if(this.table.options.history && this.table.modExists("history") && this.table.modExists("edit")){

			cell = this.table.modules.edit.currentCell;

			if(!cell){
				e.preventDefault();
				this.table.modules.history.undo();
			}
		}
	},

	redo:function(e){
		var cell = false;
		if(this.table.options.history && this.table.modExists("history") && this.table.modExists("edit")){

			cell = this.table.modules.edit.currentCell;

			if(!cell){
				e.preventDefault();
				this.table.modules.history.redo();
			}
		}
	},
};

var extensions$3 = {
	keybindings:{
		bindings:bindings$1,
		actions:actions$1
	},
};

class History extends Module{

	static moduleName = "history";
	static moduleExtensions = extensions$3;

	//load defaults
	static undoers = defaultUndoers;
	static redoers = defaultRedoers;

	constructor(table){
		super(table);

		this.history = [];
		this.index = -1;

		this.registerTableOption("history", false); //enable edit history
	}

	initialize(){
		if(this.table.options.history){
			this.subscribe("cell-value-updated", this.cellUpdated.bind(this));
			this.subscribe("cell-delete", this.clearComponentHistory.bind(this));
			this.subscribe("row-delete", this.rowDeleted.bind(this));
			this.subscribe("rows-wipe", this.clear.bind(this));
			this.subscribe("row-added", this.rowAdded.bind(this));
			this.subscribe("row-move", this.rowMoved.bind(this));
		}

		this.registerTableFunction("undo", this.undo.bind(this));
		this.registerTableFunction("redo", this.redo.bind(this));
		this.registerTableFunction("getHistoryUndoSize", this.getHistoryUndoSize.bind(this));
		this.registerTableFunction("getHistoryRedoSize", this.getHistoryRedoSize.bind(this));
		this.registerTableFunction("clearHistory", this.clear.bind(this));
	}

	rowMoved(from, to, after){
		this.action("rowMove", from, {posFrom:from.getPosition(), posTo:to.getPosition(), to:to, after:after});
	}

	rowAdded(row, data, pos, index){
		this.action("rowAdd", row, {data:data, pos:pos, index:index});
	}

	rowDeleted(row){
		var index, rows;

		if(this.table.options.groupBy){

			rows = row.getComponent().getGroup()._getSelf().rows;
			index = rows.indexOf(row);

			if(index){
				index = rows[index-1];
			}
		}else {
			index = row.table.rowManager.getRowIndex(row);

			if(index){
				index = row.table.rowManager.rows[index-1];
			}
		}

		this.action("rowDelete", row, {data:row.getData(), pos:!index, index:index});
	}

	cellUpdated(cell){
		this.action("cellEdit", cell, {oldValue:cell.oldValue, newValue:cell.value});
	}

	clear(){
		this.history = [];
		this.index = -1;
	}

	action(type, component, data){
		this.history = this.history.slice(0, this.index + 1);

		this.history.push({
			type:type,
			component:component,
			data:data,
		});

		this.index ++;
	}

	getHistoryUndoSize(){
		return this.index + 1;
	}

	getHistoryRedoSize(){
		return this.history.length - (this.index + 1);
	}

	clearComponentHistory(component){
		var index = this.history.findIndex(function(item){
			return item.component === component;
		});

		if(index > -1){
			this.history.splice(index, 1);
			if(index <= this.index){
				this.index--;
			}

			this.clearComponentHistory(component);
		}
	}

	undo(){
		if(this.index > -1){
			let action = this.history[this.index];

			History.undoers[action.type].call(this, action);

			this.index--;

			this.dispatchExternal("historyUndo", action.type, action.component.getComponent(), action.data);

			return true;
		}else {
			console.warn(this.options("history") ? "History Undo Error - No more history to undo" : "History module not enabled");
			return false;
		}
	}

	redo(){
		if(this.history.length-1 > this.index){

			this.index++;

			let action = this.history[this.index];

			History.redoers[action.type].call(this, action);

			this.dispatchExternal("historyRedo", action.type, action.component.getComponent(), action.data);

			return true;
		}else {
			console.warn(this.options("history") ? "History Redo Error - No more history to redo" : "History module not enabled");
			return false;
		}
	}

	//rebind rows to new element after deletion
	_rebindRow(oldRow, newRow){
		this.history.forEach(function(action){
			if(action.component instanceof Row){
				if(action.component === oldRow){
					action.component = newRow;
				}
			}else if(action.component instanceof Cell){
				if(action.component.row === oldRow){
					var field = action.component.column.getField();

					if(field){
						action.component = newRow.getCell(field);
					}

				}
			}
		});
	}
}

class HtmlTableImport extends Module{

	static moduleName = "htmlTableImport";

	constructor(table){
		super(table);

		this.fieldIndex = [];
		this.hasIndex = false;
	}

	initialize(){
		this.tableElementCheck();
	}

	tableElementCheck(){
		if(this.table.originalElement && this.table.originalElement.tagName === "TABLE"){
			if(this.table.originalElement.childNodes.length){
				this.parseTable();
			}else {
				console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element.");
			}
		}
	}

	parseTable(){
		var element = this.table.originalElement,
		options = this.table.options,
		headers = element.getElementsByTagName("th"),
		rows = element.getElementsByTagName("tbody")[0],
		data = [];

		this.hasIndex = false;

		this.dispatchExternal("htmlImporting");

		rows = rows ? rows.getElementsByTagName("tr") : [];

		//check for Tabulator inline options
		this._extractOptions(element, options);

		if(headers.length){
			this._extractHeaders(headers, rows);
		}else {
			this._generateBlankHeaders(headers, rows);
		}

		//iterate through table rows and build data set
		for(var index = 0; index < rows.length; index++){
			var row = rows[index],
			cells = row.getElementsByTagName("td"),
			item = {};

			//create index if the don't exist in table
			if(!this.hasIndex){
				item[options.index] = index;
			}

			for(var i = 0; i < cells.length; i++){
				var cell = cells[i];
				if(typeof this.fieldIndex[i] !== "undefined"){
					item[this.fieldIndex[i]] = cell.innerHTML;
				}
			}

			//add row data to item
			data.push(item);
		}

		options.data = data;

		this.dispatchExternal("htmlImported");
	}

	//extract tabulator attribute options
	_extractOptions(element, options, defaultOptions){
		var attributes = element.attributes;
		var optionsArr = defaultOptions ? Object.keys(defaultOptions) : Object.keys(options);
		var optionsList = {};

		optionsArr.forEach((item) => {
			optionsList[item.toLowerCase()] = item;
		});

		for(var index in attributes){
			var attrib = attributes[index];
			var name;

			if(attrib && typeof attrib == "object" && attrib.name && attrib.name.indexOf("tabulator-") === 0){
				name = attrib.name.replace("tabulator-", "");

				if(typeof optionsList[name] !== "undefined"){
					options[optionsList[name]] = this._attribValue(attrib.value);
				}
			}
		}
	}

	//get value of attribute
	_attribValue(value){
		if(value === "true"){
			return true;
		}

		if(value === "false"){
			return false;
		}

		return value;
	}

	//find column if it has already been defined
	_findCol(title){
		var match = this.table.options.columns.find((column) => {
			return column.title === title;
		});

		return match || false;
	}

	//extract column from headers
	_extractHeaders(headers, rows){
		for(var index = 0; index < headers.length; index++){
			var header = headers[index],
			exists = false,
			col = this._findCol(header.textContent),
			width;

			if(col){
				exists = true;
			}else {
				col = {title:header.textContent.trim()};
			}

			if(!col.field) {
				col.field = header.textContent.trim().toLowerCase().replaceAll(" ", "_");
			}

			width = header.getAttribute("width");

			if(width && !col.width)	{
				col.width = width;
			}

			//check for Tabulator inline options
			this._extractOptions(header, col, this.table.columnManager.optionsList.registeredDefaults);

			this.fieldIndex[index] = col.field;

			if(col.field == this.table.options.index){
				this.hasIndex = true;
			}

			if(!exists){
				this.table.options.columns.push(col);
			}

		}
	}

	//generate blank headers
	_generateBlankHeaders(headers, rows){
		for(var index = 0; index < headers.length; index++){
			var header = headers[index],
			col = {title:"", field:"col" + index};

			this.fieldIndex[index] = col.field;

			var width = header.getAttribute("width");

			if(width){
				col.width = width;
			}

			this.table.options.columns.push(col);
		}
	}
}

function csv(input){
	var data = [],
	row = 0, 
	col = 0,
	inQuote = false;
    
	//Iterate over each character
	for (let index = 0; index < input.length; index++) {
		let char = input[index], 
		nextChar = input[index+1];      
        
		//Initialize empty row
		if(!data[row]){
			data[row] = [];
		}

		//Initialize empty column
		if(!data[row][col]){
			data[row][col] = "";
		}
        
		//Handle quotation mark inside string
		if (char == '"' && inQuote && nextChar == '"') { 
			data[row][col] += char; 
			index++;
			continue; 
		}
        
		//Begin / End Quote
		if (char == '"') { 
			inQuote = !inQuote;
			continue;
		}
        
		//Next column (if not in quote)
		if (char == ',' && !inQuote) { 
			col++;
			continue; 
		}
        
		//New row if new line and not in quote (CRLF) 
		if (char == '\r' && nextChar == '\n' && !inQuote) { 
			col = 0; 
			row++; 
			index++; 
			continue; 
		}
        
		//New row if new line and not in quote (CR or LF) 
		if ((char == '\r' || char == '\n') && !inQuote) { 
			col = 0;
			row++;
			continue; 
		}

		//Normal Character, append to column
		data[row][col] += char;
	}

	return data;
}

function json(input){
	try {
		return JSON.parse(input);
	} catch(e) {
		console.warn("JSON Import Error - File contents is invalid JSON", e);
		return Promise.reject();
	}
}

function array$1 (input){
	return input;
}

function xlsx(input){
	var XLSXLib = this.dependencyRegistry.lookup("XLSX"),
	workbook2 = XLSXLib.read(input),
	sheet = workbook2.Sheets[workbook2.SheetNames[0]];
	
	return XLSXLib.utils.sheet_to_json(sheet, {header: 1 });
}

var defaultImporters = {
	csv:csv,
	json:json,
	array:array$1,
	xlsx:xlsx,
};

class Import extends Module{
	
	static moduleName = "import";
	
	//load defaults
	static importers = defaultImporters;
	
	constructor(table){
		super(table);
		
		this.registerTableOption("importFormat");
		this.registerTableOption("importReader", "text");
		this.registerTableOption("importHeaderTransform");
		this.registerTableOption("importValueTransform");
		this.registerTableOption("importDataValidator");
		this.registerTableOption("importFileValidator");
	}
	
	initialize(){
		this.registerTableFunction("import", this.importFromFile.bind(this));
		
		if(this.table.options.importFormat){
			this.subscribe("data-loading", this.loadDataCheck.bind(this), 10);
			this.subscribe("data-load", this.loadData.bind(this), 10);
		}
	}
	
	loadDataCheck(data){
		return this.table.options.importFormat && (typeof data === "string" || (Array.isArray(data) && data.length && Array.isArray(data)));
	}
	
	loadData(data, params, config, silent, previousData){
		return this.importData(this.lookupImporter(), data)
			.then(this.structureData.bind(this))
			.catch((err) => {
				console.error("Import Error:", err || "Unable to import data");
				return Promise.reject(err);
			});
	}
	
	lookupImporter(importFormat){
		var importer;
		
		if(!importFormat){
			importFormat = this.table.options.importFormat;
		}
		
		if(typeof importFormat === "string"){
			importer = Import.importers[importFormat];
		}else {
			importer = importFormat;
		}
		
		if(!importer){
			console.error("Import Error - Importer not found:", importFormat);
		}
		
		return importer;
	}
	
	importFromFile(importFormat, extension, importReader){
		var importer = this.lookupImporter(importFormat);
		
		if(importer){
			return this.pickFile(extension, importReader)
				.then(this.importData.bind(this, importer))
				.then(this.structureData.bind(this))
				.then(this.mutateData.bind(this))
				.then(this.validateData.bind(this))
				.then(this.setData.bind(this))
				.catch((err) => {
					this.dispatch("import-error", err);
					this.dispatchExternal("importError", err);
					
					console.error("Import Error:", err || "Unable to import file");
					
					this.table.dataLoader.alertError();

					setTimeout(() => {
						this.table.dataLoader.clearAlert();
					}, 3000);
					
					return Promise.reject(err);
				});
		}
	}
	
	pickFile(extensions, importReader){
		return new Promise((resolve, reject) => {
			var input = document.createElement("input");
			input.type = "file";
			input.accept = extensions;
			
			input.addEventListener("change", (e) => {
				var file = input.files[0],
				reader = new FileReader(),
				valid = this.validateFile(file);

				if(valid === true){
				
					this.dispatch("import-importing", input.files);
					this.dispatchExternal("importImporting", input.files);
				
					switch(importReader || this.table.options.importReader){
						case "buffer":
							reader.readAsArrayBuffer(file);
							break;
						
						case "binary":
							reader.readAsBinaryString(file);
							break;
						
						case "url":
							reader.readAsDataURL(file);
							break;
						
						case "text":
						default:
							reader.readAsText(file);
					}
					
					reader.onload = (e) => {
						resolve(reader.result);
					};
					
					reader.onerror = (e) => {
						console.warn("File Load Error - Unable to read file");
						reject(e);
					};
				}else {
					reject(valid);
				}
			});
			
			this.dispatch("import-choose");
			this.dispatchExternal("importChoose");
			input.click();
		});
	}
	
	importData(importer, fileContents){
		var data;
		
		this.table.dataLoader.alertLoader();
		
		return new Promise((resolve, reject) => {
			setTimeout(() => {
				data = importer.call(this.table, fileContents);
				
				if(data instanceof Promise){
					resolve(data);
				}else {
					data ? resolve(data) : reject();
				}
			}, 10);
		});
	}
	
	structureData(parsedData){
		var data = [];
		
		if(Array.isArray(parsedData) && parsedData.length && Array.isArray(parsedData[0])){
			if(this.table.options.autoColumns){
				data = this.structureArrayToObject(parsedData);
			}else {
				data = this.structureArrayToColumns(parsedData);
			}
			
			return data;
		}else {
			return parsedData;
		}
	}
	
	mutateData(data){
		var output = [];
		
		if(Array.isArray(data)){
			data.forEach((row) => {
				output.push(this.table.modules.mutator.transformRow(row, "import"));
			});
		}else {
			output = data;
		}
		
		return output;
	}
	
	transformHeader(headers){
		var output = [];
		
		if(this.table.options.importHeaderTransform){
			headers.forEach((item) => {
				output.push(this.table.options.importHeaderTransform.call(this.table, item, headers));
			});
		}else {
			return headers;
		}
		
		return output;
	}
	
	transformData(row){
		var output = [];

		if(this.table.options.importValueTransform){
			row.forEach((item) => {
				output.push(this.table.options.importValueTransform.call(this.table, item, row));
			});
		}else {
			return row;
		}
		
		return output;
	}
	
	structureArrayToObject(parsedData){
		var columns = this.transformHeader(parsedData.shift());	
		
		var data = parsedData.map((values) => {
			var row = {};

			values = this.transformData(values);
			
			columns.forEach((key, i) => {
				row[key] = values[i];
			});
			
			return row;
		});
		
		return data;
	}
	
	structureArrayToColumns(parsedData){
		var data = [],
		firstRow = this.transformHeader(parsedData[0]),
		columns = this.table.getColumns();
		
		//remove first row if it is the column names
		if(columns[0] && firstRow[0]){
			if(columns[0].getDefinition().title === firstRow[0]){
				parsedData.shift();
			}
		}
		
		//convert row arrays to objects
		parsedData.forEach((rowData) => {
			var row = {};

			rowData = this.transformData(rowData);
			
			rowData.forEach((value, index) => {
				var column = columns[index];
				
				if(column){
					row[column.getField()] = value;
				}
			});
			
			data.push(row);
		});
		
		return data;
	}

	validateFile(file){
		if(this.table.options.importFileValidator){
			return this.table.options.importFileValidator.call(this.table, file);
		}

		return true;
	}

	validateData(data){
		var result;

		if(this.table.options.importDataValidator){
			result = this.table.options.importDataValidator.call(this.table, data);

			if(result === true){
				return data;
			}else {
				return Promise.reject(result);
			}
		}

		return data;
	}
	
	setData(data){
		this.dispatch("import-imported", data);
		this.dispatchExternal("importImported", data);
		
		this.table.dataLoader.clearAlert();
		
		return this.table.setData(data);
	}
}

class Interaction extends Module{

	static moduleName = "interaction";

	constructor(table){
		super(table);

		this.eventMap = {
			//row events
			rowClick:"row-click",
			rowDblClick:"row-dblclick",
			rowContext:"row-contextmenu",
			rowMouseEnter:"row-mouseenter",
			rowMouseLeave:"row-mouseleave",
			rowMouseOver:"row-mouseover",
			rowMouseOut:"row-mouseout",
			rowMouseMove:"row-mousemove",
			rowMouseDown:"row-mousedown",
			rowMouseUp:"row-mouseup",
			rowTap:"row",
			rowDblTap:"row",
			rowTapHold:"row",

			//cell events
			cellClick:"cell-click",
			cellDblClick:"cell-dblclick",
			cellContext:"cell-contextmenu",
			cellMouseEnter:"cell-mouseenter",
			cellMouseLeave:"cell-mouseleave",
			cellMouseOver:"cell-mouseover",
			cellMouseOut:"cell-mouseout",
			cellMouseMove:"cell-mousemove",
			cellMouseDown:"cell-mousedown",
			cellMouseUp:"cell-mouseup",
			cellTap:"cell",
			cellDblTap:"cell",
			cellTapHold:"cell",

			//column header events
			headerClick:"column-click",
			headerDblClick:"column-dblclick",
			headerContext:"column-contextmenu",
			headerMouseEnter:"column-mouseenter",
			headerMouseLeave:"column-mouseleave",
			headerMouseOver:"column-mouseover",
			headerMouseOut:"column-mouseout",
			headerMouseMove:"column-mousemove",
			headerMouseDown:"column-mousedown",
			headerMouseUp:"column-mouseup",
			headerTap:"column",
			headerDblTap:"column",
			headerTapHold:"column",

			//group header
			groupClick:"group-click",
			groupDblClick:"group-dblclick",
			groupContext:"group-contextmenu",
			groupMouseEnter:"group-mouseenter",
			groupMouseLeave:"group-mouseleave",
			groupMouseOver:"group-mouseover",
			groupMouseOut:"group-mouseout",
			groupMouseMove:"group-mousemove",
			groupMouseDown:"group-mousedown",
			groupMouseUp:"group-mouseup",
			groupTap:"group",
			groupDblTap:"group",
			groupTapHold:"group",
		};

		this.subscribers = {};

		this.touchSubscribers = {};

		this.columnSubscribers = {};

		this.touchWatchers = {
			row:{
				tap:null,
				tapDbl:null,
				tapHold:null,
			},
			cell:{
				tap:null,
				tapDbl:null,
				tapHold:null,
			},
			column:{
				tap:null,
				tapDbl:null,
				tapHold:null,
			},
			group:{
				tap:null,
				tapDbl:null,
				tapHold:null,
			}
		};

		this.registerColumnOption("headerClick");
		this.registerColumnOption("headerDblClick");
		this.registerColumnOption("headerContext");
		this.registerColumnOption("headerMouseEnter");
		this.registerColumnOption("headerMouseLeave");
		this.registerColumnOption("headerMouseOver");
		this.registerColumnOption("headerMouseOut");
		this.registerColumnOption("headerMouseMove");
		this.registerColumnOption("headerMouseDown");
		this.registerColumnOption("headerMouseUp");
		this.registerColumnOption("headerTap");
		this.registerColumnOption("headerDblTap");
		this.registerColumnOption("headerTapHold");

		this.registerColumnOption("cellClick");
		this.registerColumnOption("cellDblClick");
		this.registerColumnOption("cellContext");
		this.registerColumnOption("cellMouseEnter");
		this.registerColumnOption("cellMouseLeave");
		this.registerColumnOption("cellMouseOver");
		this.registerColumnOption("cellMouseOut");
		this.registerColumnOption("cellMouseMove");
		this.registerColumnOption("cellMouseDown");
		this.registerColumnOption("cellMouseUp");
		this.registerColumnOption("cellTap");
		this.registerColumnOption("cellDblTap");
		this.registerColumnOption("cellTapHold");

	}

	initialize(){
		this.initializeExternalEvents();

		this.subscribe("column-init", this.initializeColumn.bind(this));
		this.subscribe("cell-dblclick", this.cellContentsSelectionFixer.bind(this));
		this.subscribe("scroll-horizontal", this.clearTouchWatchers.bind(this));
		this.subscribe("scroll-vertical", this.clearTouchWatchers.bind(this));
	}

	clearTouchWatchers(){
		var types = Object.values(this.touchWatchers);

		types.forEach((type) => {
			for(let key in type){
				type[key] = null;
			}
		});
	}
		
	cellContentsSelectionFixer(e, cell){
		var range;

		if(this.table.modExists("edit")){
			if (this.table.modules.edit.currentCell === cell){
				return; //prevent instant selection of editor content
			}
		}

		e.preventDefault();

		try{
			if (document.selection) { // IE
				range = document.body.createTextRange();
				range.moveToElementText(cell.getElement());
				range.select();
			} else if (window.getSelection) {
				range = document.createRange();
				range.selectNode(cell.getElement());
				window.getSelection().removeAllRanges();
				window.getSelection().addRange(range);
			}
		}catch(e){}
	}

	initializeExternalEvents(){
		for(let key in this.eventMap){
			this.subscriptionChangeExternal(key, this.subscriptionChanged.bind(this, key));
		}
	}

	subscriptionChanged(key, added){
		if(added){
			if(!this.subscribers[key]){
				if(this.eventMap[key].includes("-")){
					this.subscribers[key] = this.handle.bind(this, key);
					this.subscribe(this.eventMap[key], this.subscribers[key]);
				}else {
					this.subscribeTouchEvents(key);
				}
			}
		}else {
			if(this.eventMap[key].includes("-")){
				if(this.subscribers[key] && !this.columnSubscribers[key]  && !this.subscribedExternal(key)){
					this.unsubscribe(this.eventMap[key], this.subscribers[key]);
					delete this.subscribers[key];
				}
			}else {
				this.unsubscribeTouchEvents(key);
			}
		}
	}


	subscribeTouchEvents(key){
		var type = this.eventMap[key];

		if(!this.touchSubscribers[type + "-touchstart"]){
			this.touchSubscribers[type + "-touchstart"] = this.handleTouch.bind(this, type, "start");
			this.touchSubscribers[type + "-touchend"] = this.handleTouch.bind(this, type, "end");

			this.subscribe(type + "-touchstart", this.touchSubscribers[type + "-touchstart"]);
			this.subscribe(type + "-touchend", this.touchSubscribers[type + "-touchend"]);
		}

		this.subscribers[key] = true;
	}

	unsubscribeTouchEvents(key){
		var noTouch = true,
		type = this.eventMap[key];

		if(this.subscribers[key] && !this.subscribedExternal(key)){
			delete this.subscribers[key];

			for(let i in this.eventMap){
				if(this.eventMap[i] === type){
					if(this.subscribers[i]){
						noTouch = false;
					}
				}
			}

			if(noTouch){
				this.unsubscribe(type + "-touchstart", this.touchSubscribers[type + "-touchstart"]);
				this.unsubscribe(type + "-touchend", this.touchSubscribers[type + "-touchend"]);

				delete this.touchSubscribers[type + "-touchstart"];
				delete this.touchSubscribers[type + "-touchend"];
			}
		}
	}

	initializeColumn(column){
		var def = column.definition;

		for(let key in this.eventMap){
			if(def[key]){
				this.subscriptionChanged(key, true);

				if(!this.columnSubscribers[key]){
					this.columnSubscribers[key] = [];
				}

				this.columnSubscribers[key].push(column);
			}
		}
	}

	handle(action, e, component){
		this.dispatchEvent(action, e, component);
	}

	handleTouch(type, action, e, component){
		var watchers = this.touchWatchers[type];

		if(type === "column"){
			type = "header";
		}

		switch(action){
			case "start":
				watchers.tap = true;

				clearTimeout(watchers.tapHold);

				watchers.tapHold = setTimeout(() => {
					clearTimeout(watchers.tapHold);
					watchers.tapHold = null;

					watchers.tap = null;
					clearTimeout(watchers.tapDbl);
					watchers.tapDbl = null;

					this.dispatchEvent(type + "TapHold", e,  component);
				}, 1000);
				break;

			case "end":
				if(watchers.tap){

					watchers.tap = null;
					this.dispatchEvent(type + "Tap", e,  component);
				}

				if(watchers.tapDbl){
					clearTimeout(watchers.tapDbl);
					watchers.tapDbl = null;

					this.dispatchEvent(type + "DblTap", e,  component);
				}else {
					watchers.tapDbl = setTimeout(() => {
						clearTimeout(watchers.tapDbl);
						watchers.tapDbl = null;
					}, 300);
				}

				clearTimeout(watchers.tapHold);
				watchers.tapHold = null;
				break;
		}
	}

	dispatchEvent(action, e, component){
		var componentObj = component.getComponent(),
		callback;

		if(this.columnSubscribers[action]){

			if(component instanceof Cell){
				callback = component.column.definition[action];
			}else if(component instanceof Column){
				callback = component.definition[action];
			}

			if(callback){
				callback(e, componentObj);
			}
		}

		this.dispatchExternal(action, e, componentObj);
	}
}

var defaultBindings = {
	navPrev:"shift + 9",
	navNext:9,
	navUp:38,
	navDown:40,
	navLeft:37,
	navRight:39,
	scrollPageUp:33,
	scrollPageDown:34,
	scrollToStart:36,
	scrollToEnd:35,
};

var defaultActions = {
	keyBlock:function(e){
		e.stopPropagation();
		e.preventDefault();
	},

	scrollPageUp:function(e){
		var rowManager = this.table.rowManager,
		newPos = rowManager.scrollTop - rowManager.element.clientHeight;

		e.preventDefault();

		if(rowManager.displayRowsCount){
			if(newPos >= 0){
				rowManager.element.scrollTop = newPos;
			}else {
				rowManager.scrollToRow(rowManager.getDisplayRows()[0]);
			}
		}

		this.table.element.focus();
	},

	scrollPageDown:function(e){
		var rowManager = this.table.rowManager,
		newPos = rowManager.scrollTop + rowManager.element.clientHeight,
		scrollMax = rowManager.element.scrollHeight;

		e.preventDefault();

		if(rowManager.displayRowsCount){
			if(newPos <= scrollMax){
				rowManager.element.scrollTop = newPos;
			}else {
				rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount - 1]);
			}
		}

		this.table.element.focus();

	},

	scrollToStart:function(e){
		var rowManager = this.table.rowManager;

		e.preventDefault();

		if(rowManager.displayRowsCount){
			rowManager.scrollToRow(rowManager.getDisplayRows()[0]);
		}

		this.table.element.focus();
	},

	scrollToEnd:function(e){
		var rowManager = this.table.rowManager;

		e.preventDefault();

		if(rowManager.displayRowsCount){
			rowManager.scrollToRow(rowManager.getDisplayRows()[rowManager.displayRowsCount - 1]);
		}

		this.table.element.focus();
	},

	navPrev:function(e){
		this.dispatch("keybinding-nav-prev", e);
	},

	navNext:function(e){
		this.dispatch("keybinding-nav-next", e);
	},

	navLeft:function(e){
		this.dispatch("keybinding-nav-left", e);
	},

	navRight:function(e){
		this.dispatch("keybinding-nav-right", e);
	},

	navUp:function(e){
		this.dispatch("keybinding-nav-up", e);
	},

	navDown:function(e){
		this.dispatch("keybinding-nav-down", e);
	},
};

class Keybindings extends Module{

	static moduleName = "keybindings";

	//load defaults
	static bindings = defaultBindings;
	static actions = defaultActions;

	constructor(table){
		super(table);

		this.watchKeys = null;
		this.pressedKeys = null;
		this.keyupBinding = false;
		this.keydownBinding = false;

		this.registerTableOption("keybindings", {}); //array for keybindings
		this.registerTableOption("tabEndNewRow", false); //create new row when tab to end of table
	}

	initialize(){
		var bindings = this.table.options.keybindings,
		mergedBindings = {};

		this.watchKeys = {};
		this.pressedKeys = [];

		if(bindings !== false){
			Object.assign(mergedBindings, Keybindings.bindings);
			Object.assign(mergedBindings, bindings);

			this.mapBindings(mergedBindings);
			this.bindEvents();
		}

		this.subscribe("table-destroy", this.clearBindings.bind(this));
	}

	mapBindings(bindings){
		for(let key in bindings){
			if(Keybindings.actions[key]){
				if(bindings[key]){
					if(typeof bindings[key] !== "object"){
						bindings[key] = [bindings[key]];
					}

					bindings[key].forEach((binding) => {
						var bindingList = Array.isArray(binding) ?  binding : [binding];
						
						bindingList.forEach((item) => {
							this.mapBinding(key, item);
						});						
					});
				}
			}else {
				console.warn("Key Binding Error - no such action:", key);
			}
		}
	}

	mapBinding(action, symbolsList){
		var binding = {
			action: Keybindings.actions[action],
			keys: [],
			ctrl: false,
			shift: false,
			meta: false,
		};

		var symbols = symbolsList.toString().toLowerCase().split(" ").join("").split("+");

		symbols.forEach((symbol) => {
			switch(symbol){
				case "ctrl":
					binding.ctrl = true;
					break;

				case "shift":
					binding.shift = true;
					break;

				case "meta":
					binding.meta = true;
					break;

				default:
					symbol = isNaN(symbol) ? symbol.toUpperCase().charCodeAt(0) : parseInt(symbol);
					binding.keys.push(symbol);

					if(!this.watchKeys[symbol]){
						this.watchKeys[symbol] = [];
					}

					this.watchKeys[symbol].push(binding);
			}
		});
	}

	bindEvents(){
		var self = this;

		this.keyupBinding = function(e){
			var code = e.keyCode;
			var bindings = self.watchKeys[code];

			if(bindings){

				self.pressedKeys.push(code);

				bindings.forEach(function(binding){
					self.checkBinding(e, binding);
				});
			}
		};

		this.keydownBinding = function(e){
			var code = e.keyCode;
			var bindings = self.watchKeys[code];

			if(bindings){

				var index = self.pressedKeys.indexOf(code);

				if(index > -1){
					self.pressedKeys.splice(index, 1);
				}
			}
		};

		this.table.element.addEventListener("keydown", this.keyupBinding);

		this.table.element.addEventListener("keyup", this.keydownBinding);
	}

	clearBindings(){
		if(this.keyupBinding){
			this.table.element.removeEventListener("keydown", this.keyupBinding);
		}

		if(this.keydownBinding){
			this.table.element.removeEventListener("keyup", this.keydownBinding);
		}
	}

	checkBinding(e, binding){
		var match = true;

		if(e.ctrlKey == binding.ctrl && e.shiftKey == binding.shift && e.metaKey == binding.meta){
			binding.keys.forEach((key) => {
				var index = this.pressedKeys.indexOf(key);

				if(index == -1){
					match = false;
				}
			});

			if(match){
				binding.action.call(this, e);
			}

			return true;
		}

		return false;
	}
}

class Menu extends Module{

	static moduleName = "menu";
	
	constructor(table){
		super(table);
		
		this.menuContainer = null;
		this.nestedMenuBlock = false;
		
		this.currentComponent = null;
		this.rootPopup = null;
		
		this.columnSubscribers = {};
		
		// this.registerTableOption("menuContainer", undefined); //deprecated
		
		this.registerTableOption("rowContextMenu", false);
		this.registerTableOption("rowClickMenu", false);
		this.registerTableOption("rowDblClickMenu", false);
		this.registerTableOption("groupContextMenu", false);
		this.registerTableOption("groupClickMenu", false);
		this.registerTableOption("groupDblClickMenu", false);
		
		this.registerColumnOption("headerContextMenu");
		this.registerColumnOption("headerClickMenu");
		this.registerColumnOption("headerDblClickMenu");
		this.registerColumnOption("headerMenu");
		this.registerColumnOption("headerMenuIcon");
		this.registerColumnOption("contextMenu");
		this.registerColumnOption("clickMenu");
		this.registerColumnOption("dblClickMenu");
		
	}
	
	initialize(){
		this.deprecatedOptionsCheck();
		this.initializeRowWatchers();
		this.initializeGroupWatchers();
		
		this.subscribe("column-init", this.initializeColumn.bind(this));
	}
	
	deprecatedOptionsCheck(){
		// if(!this.deprecationCheck("menuContainer", "popupContainer")){
		// 	this.table.options.popupContainer = this.table.options.menuContainer;
		// }
	}	
	
	initializeRowWatchers(){
		if(this.table.options.rowContextMenu){
			this.subscribe("row-contextmenu", this.loadMenuEvent.bind(this, this.table.options.rowContextMenu));
			this.table.on("rowTapHold", this.loadMenuEvent.bind(this, this.table.options.rowContextMenu));
		}
		
		if(this.table.options.rowClickMenu){
			this.subscribe("row-click", this.loadMenuEvent.bind(this, this.table.options.rowClickMenu));
		}
		
		if(this.table.options.rowDblClickMenu){
			this.subscribe("row-dblclick", this.loadMenuEvent.bind(this, this.table.options.rowDblClickMenu));
		}
	}
	
	initializeGroupWatchers(){
		if(this.table.options.groupContextMenu){
			this.subscribe("group-contextmenu", this.loadMenuEvent.bind(this, this.table.options.groupContextMenu));
			this.table.on("groupTapHold", this.loadMenuEvent.bind(this, this.table.options.groupContextMenu));
		}
		
		if(this.table.options.groupClickMenu){
			this.subscribe("group-click", this.loadMenuEvent.bind(this, this.table.options.groupClickMenu));
		}
		
		if(this.table.options.groupDblClickMenu){
			this.subscribe("group-dblclick", this.loadMenuEvent.bind(this, this.table.options.groupDblClickMenu));
		}
	}

	initializeColumn(column){
		var	def = column.definition;
		
		//handle column events
		if(def.headerContextMenu && !this.columnSubscribers.headerContextMenu){
			this.columnSubscribers.headerContextMenu = this.loadMenuTableColumnEvent.bind(this, "headerContextMenu");
			this.subscribe("column-contextmenu", this.columnSubscribers.headerContextMenu);
			this.table.on("headerTapHold", this.loadMenuTableColumnEvent.bind(this, "headerContextMenu"));
		}
		
		if(def.headerClickMenu && !this.columnSubscribers.headerClickMenu){
			this.columnSubscribers.headerClickMenu = this.loadMenuTableColumnEvent.bind(this, "headerClickMenu");
			this.subscribe("column-click", this.columnSubscribers.headerClickMenu);
		}
		
		if(def.headerDblClickMenu && !this.columnSubscribers.headerDblClickMenu){
			this.columnSubscribers.headerDblClickMenu = this.loadMenuTableColumnEvent.bind(this, "headerDblClickMenu");
			this.subscribe("column-dblclick", this.columnSubscribers.headerDblClickMenu);
		}
		
		if(def.headerMenu){
			this.initializeColumnHeaderMenu(column);
		}
		
		//handle cell events
		if(def.contextMenu && !this.columnSubscribers.contextMenu){
			this.columnSubscribers.contextMenu = this.loadMenuTableCellEvent.bind(this, "contextMenu");
			this.subscribe("cell-contextmenu", this.columnSubscribers.contextMenu);
			this.table.on("cellTapHold", this.loadMenuTableCellEvent.bind(this, "contextMenu"));
		}
		
		if(def.clickMenu && !this.columnSubscribers.clickMenu){
			this.columnSubscribers.clickMenu = this.loadMenuTableCellEvent.bind(this, "clickMenu");
			this.subscribe("cell-click", this.columnSubscribers.clickMenu);
		}
		
		if(def.dblClickMenu && !this.columnSubscribers.dblClickMenu){
			this.columnSubscribers.dblClickMenu = this.loadMenuTableCellEvent.bind(this, "dblClickMenu");
			this.subscribe("cell-dblclick", this.columnSubscribers.dblClickMenu);
		}
	}
	
	initializeColumnHeaderMenu(column){
		var icon = column.definition.headerMenuIcon,
		headerMenuEl;
		
		headerMenuEl = document.createElement("span");
		headerMenuEl.classList.add("tabulator-header-popup-button");
		
		if(icon){
			if(typeof icon === "function"){
				icon = icon(column.getComponent());
			}
			
			if(icon instanceof HTMLElement){
				headerMenuEl.appendChild(icon);
			}else {
				headerMenuEl.innerHTML = icon;
			}
		}else {
			headerMenuEl.innerHTML = "&vellip;";
		}
		
		headerMenuEl.addEventListener("click", (e) => {
			e.stopPropagation();
			e.preventDefault();
			
			this.loadMenuEvent(column.definition.headerMenu, e, column);
		});
		
		column.titleElement.insertBefore(headerMenuEl, column.titleElement.firstChild);
	}
	
	loadMenuTableCellEvent(option, e, cell){
		if(cell._cell){
			cell = cell._cell;
		}
		
		if(cell.column.definition[option]){
			this.loadMenuEvent(cell.column.definition[option], e, cell);
		}
	}
	
	loadMenuTableColumnEvent(option, e, column){
		if(column._column){
			column = column._column;
		}
		
		if(column.definition[option]){
			this.loadMenuEvent(column.definition[option], e, column);
		}
	}
	
	loadMenuEvent(menu, e, component){
		if(component._group){
			component = component._group;
		}else if(component._row){
			component = component._row;
		}
		
		menu = typeof menu == "function" ? menu.call(this.table, e, component.getComponent()) : menu;
		
		this.loadMenu(e, component, menu);
	}
	
	loadMenu(e, component, menu, parentEl, parentPopup){
		var touch = !(e instanceof MouseEvent),		
		menuEl = document.createElement("div"),
		popup;
		
		menuEl.classList.add("tabulator-menu");
		
		if(!touch){
			e.preventDefault();
		}
		
		//abort if no menu set
		if(!menu || !menu.length){
			return;
		}
		
		if(!parentEl){
			if(this.nestedMenuBlock){
				//abort if child menu already open
				if(this.rootPopup){
					return;
				}
			}else {
				this.nestedMenuBlock = setTimeout(() => {
					this.nestedMenuBlock = false;
				}, 100);
			}
			
			if(this.rootPopup){
				this.rootPopup.hide();	
			}
			
			this.rootPopup = popup = this.popup(menuEl);
			
		}else {
			popup = parentPopup.child(menuEl);
		}
		
		menu.forEach((item) => {
			var itemEl = document.createElement("div"),
			label = item.label,
			disabled = item.disabled;
			
			if(item.separator){
				itemEl.classList.add("tabulator-menu-separator");
			}else {
				itemEl.classList.add("tabulator-menu-item");
				
				if(typeof label == "function"){
					label = label.call(this.table, component.getComponent());
				}
				
				if(label instanceof Node){
					itemEl.appendChild(label);
				}else {
					itemEl.innerHTML = label;
				}
				
				if(typeof disabled == "function"){
					disabled = disabled.call(this.table, component.getComponent());
				}
				
				if(disabled){
					itemEl.classList.add("tabulator-menu-item-disabled");
					itemEl.addEventListener("click", (e) => {
						e.stopPropagation();
					});
				}else {
					if(item.menu && item.menu.length){
						itemEl.addEventListener("click", (e) => {
							e.stopPropagation();
							this.loadMenu(e, component, item.menu, itemEl, popup);
						});
					}else {
						if(item.action){
							itemEl.addEventListener("click", (e) => {
								item.action(e, component.getComponent());
							});
						}
					}
				}
				
				if(item.menu && item.menu.length){
					itemEl.classList.add("tabulator-menu-item-submenu");
				}
			}
			
			menuEl.appendChild(itemEl);
		});
		
		menuEl.addEventListener("click", (e) => {
			if(this.rootPopup){
				this.rootPopup.hide();
			}
		});
		
		popup.show(parentEl || e);
		
		if(popup === this.rootPopup){
			this.rootPopup.hideOnBlur(() => {
				this.rootPopup = null;
				
				if(this.currentComponent){
					this.dispatch("menu-closed", menu, popup);
					this.dispatchExternal("menuClosed", this.currentComponent.getComponent());
					this.currentComponent = null;
				}
			});
			
			this.currentComponent = component;
			
			this.dispatch("menu-opened", menu, popup);
			this.dispatchExternal("menuOpened", component.getComponent());
		}
	}
}

class MoveColumns extends Module{

	static moduleName = "moveColumn";
	
	constructor(table){
		super(table);
		
		this.placeholderElement = this.createPlaceholderElement();
		this.hoverElement = false; //floating column header element
		this.checkTimeout = false; //click check timeout holder
		this.checkPeriod = 250; //period to wait on mousedown to consider this a move and not a click
		this.moving = false; //currently moving column
		this.toCol = false; //destination column
		this.toColAfter = false; //position of moving column relative to the destination column
		this.startX = 0; //starting position within header element
		this.autoScrollMargin = 40; //auto scroll on edge when within margin
		this.autoScrollStep = 5; //auto scroll distance in pixels
		this.autoScrollTimeout = false; //auto scroll timeout
		this.touchMove = false;
		
		this.moveHover = this.moveHover.bind(this);
		this.endMove = this.endMove.bind(this);
		
		this.registerTableOption("movableColumns", false); //enable movable columns
	}
	
	createPlaceholderElement(){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-col");
		el.classList.add("tabulator-col-placeholder");
		
		return el;
	}
	
	initialize(){
		if(this.table.options.movableColumns){
			this.subscribe("column-init", this.initializeColumn.bind(this));
			this.subscribe("alert-show", this.abortMove.bind(this));
		}
	}

	abortMove(){
		clearTimeout(this.checkTimeout);
	}
	
	initializeColumn(column){
		var self = this,
		config = {},
		colEl;

		if(!column.modules.frozen && !column.isGroup && !column.isRowHeader){
			colEl = column.getElement();
			
			config.mousemove = function(e){
				if(column.parent === self.moving.parent){
					if((((self.touchMove ? e.touches[0].pageX : e.pageX) - Helpers.elOffset(colEl).left) + self.table.columnManager.contentsElement.scrollLeft) > (column.getWidth() / 2)){
						if(self.toCol !== column || !self.toColAfter){
							colEl.parentNode.insertBefore(self.placeholderElement, colEl.nextSibling);
							self.moveColumn(column, true);
						}
					}else {
						if(self.toCol !== column || self.toColAfter){
							colEl.parentNode.insertBefore(self.placeholderElement, colEl);
							self.moveColumn(column, false);
						}
					}
				}
			}.bind(self);
			
			colEl.addEventListener("mousedown", function(e){
				self.touchMove = false;
				if(e.which === 1){
					self.checkTimeout = setTimeout(function(){
						self.startMove(e, column);
					}, self.checkPeriod);
				}
			});
			
			colEl.addEventListener("mouseup", function(e){
				if(e.which === 1){
					if(self.checkTimeout){
						clearTimeout(self.checkTimeout);
					}
				}
			});
			
			self.bindTouchEvents(column);
		}
		
		column.modules.moveColumn = config;
	}
	
	bindTouchEvents(column){
		var colEl = column.getElement(),
		startXMove = false, //shifting center position of the cell
		nextCol, prevCol, nextColWidth, prevColWidth, nextColWidthLast, prevColWidthLast;
		
		colEl.addEventListener("touchstart", (e) => {
			this.checkTimeout = setTimeout(() => {
				this.touchMove = true;
				nextCol = column.nextColumn();
				nextColWidth = nextCol ? nextCol.getWidth()/2 : 0;
				prevCol = column.prevColumn();
				prevColWidth = prevCol ? prevCol.getWidth()/2 : 0;
				nextColWidthLast = 0;
				prevColWidthLast = 0;
				startXMove = false;
				
				this.startMove(e, column);
			}, this.checkPeriod);
		}, {passive: true});
		
		colEl.addEventListener("touchmove", (e) => {
			var diff, moveToCol;
			
			if(this.moving){
				this.moveHover(e);
				
				if(!startXMove){
					startXMove = e.touches[0].pageX;
				}
				
				diff = e.touches[0].pageX - startXMove;
				
				if(diff > 0){
					if(nextCol && diff - nextColWidthLast > nextColWidth){
						moveToCol = nextCol;
						
						if(moveToCol !== column){
							startXMove = e.touches[0].pageX;
							moveToCol.getElement().parentNode.insertBefore(this.placeholderElement, moveToCol.getElement().nextSibling);
							this.moveColumn(moveToCol, true);
						}
					}
				}else {
					if(prevCol && -diff - prevColWidthLast >  prevColWidth){
						moveToCol = prevCol;
						
						if(moveToCol !== column){
							startXMove = e.touches[0].pageX;
							moveToCol.getElement().parentNode.insertBefore(this.placeholderElement, moveToCol.getElement());
							this.moveColumn(moveToCol, false);
						}
					}
				}
				
				if(moveToCol){
					nextCol = moveToCol.nextColumn();
					nextColWidthLast = nextColWidth;
					nextColWidth = nextCol ? nextCol.getWidth() / 2 : 0;
					prevCol = moveToCol.prevColumn();
					prevColWidthLast = prevColWidth;
					prevColWidth = prevCol ? prevCol.getWidth() / 2 : 0;
				}
			}
		}, {passive: true});
		
		colEl.addEventListener("touchend", (e) => {
			if(this.checkTimeout){
				clearTimeout(this.checkTimeout);
			}
			if(this.moving){
				this.endMove(e);
			}
		});
	}
	
	startMove(e, column){
		var element = column.getElement(),
		headerElement = this.table.columnManager.getContentsElement(),
		headersElement = this.table.columnManager.getHeadersElement();
		
		//Prevent moving columns when range selection is active
		if(this.table.modules.selectRange && this.table.modules.selectRange.columnSelection){
			if(this.table.modules.selectRange.mousedown && this.table.modules.selectRange.selecting === "column"){
				return;
			}
		}

		this.moving = column;
		this.startX = (this.touchMove ? e.touches[0].pageX : e.pageX) - Helpers.elOffset(element).left;
		
		this.table.element.classList.add("tabulator-block-select");
		
		//create placeholder
		this.placeholderElement.style.width = column.getWidth() + "px";
		this.placeholderElement.style.height = column.getHeight() + "px";
		
		element.parentNode.insertBefore(this.placeholderElement, element);
		element.parentNode.removeChild(element);
		
		//create hover element
		this.hoverElement = element.cloneNode(true);
		this.hoverElement.classList.add("tabulator-moving");
		
		headerElement.appendChild(this.hoverElement);
		
		this.hoverElement.style.left = "0";
		this.hoverElement.style.bottom = (headerElement.clientHeight - headersElement.offsetHeight) + "px";
		
		if(!this.touchMove){
			this._bindMouseMove();
			
			document.body.addEventListener("mousemove", this.moveHover);
			document.body.addEventListener("mouseup", this.endMove);
		}
		
		this.moveHover(e);

		this.dispatch("column-moving", e, this.moving);
	}
	
	_bindMouseMove(){
		this.table.columnManager.columnsByIndex.forEach(function(column){
			if(column.modules.moveColumn.mousemove){
				column.getElement().addEventListener("mousemove", column.modules.moveColumn.mousemove);
			}
		});
	}
	
	_unbindMouseMove(){
		this.table.columnManager.columnsByIndex.forEach(function(column){
			if(column.modules.moveColumn.mousemove){
				column.getElement().removeEventListener("mousemove", column.modules.moveColumn.mousemove);
			}
		});
	}
	
	moveColumn(column, after){
		var movingCells = this.moving.getCells();
		
		this.toCol = column;
		this.toColAfter = after;
		
		if(after){
			column.getCells().forEach(function(cell, i){
				var cellEl = cell.getElement(true);
				
				if(cellEl.parentNode && movingCells[i]){
					cellEl.parentNode.insertBefore(movingCells[i].getElement(), cellEl.nextSibling);
				}
			});
		}else {
			column.getCells().forEach(function(cell, i){
				var cellEl = cell.getElement(true);
				
				if(cellEl.parentNode && movingCells[i]){
					cellEl.parentNode.insertBefore(movingCells[i].getElement(), cellEl);
				}
			});
		}
	}
	
	endMove(e){
		if(e.which === 1 || this.touchMove){
			this._unbindMouseMove();
			
			this.placeholderElement.parentNode.insertBefore(this.moving.getElement(), this.placeholderElement.nextSibling);
			this.placeholderElement.parentNode.removeChild(this.placeholderElement);
			this.hoverElement.parentNode.removeChild(this.hoverElement);
			
			this.table.element.classList.remove("tabulator-block-select");
			
			if(this.toCol){
				this.table.columnManager.moveColumnActual(this.moving, this.toCol, this.toColAfter);
			}

			this.moving = false;
			this.toCol = false;
			this.toColAfter = false;
			
			if(!this.touchMove){
				document.body.removeEventListener("mousemove", this.moveHover);
				document.body.removeEventListener("mouseup", this.endMove);
			}
		}
	}
	
	moveHover(e){
		var columnHolder = this.table.columnManager.getContentsElement(),
		scrollLeft = columnHolder.scrollLeft,
		xPos = ((this.touchMove ? e.touches[0].pageX : e.pageX) - Helpers.elOffset(columnHolder).left) + scrollLeft,
		scrollPos;
		
		this.hoverElement.style.left = (xPos - this.startX) + "px";
		
		if(xPos - scrollLeft < this.autoScrollMargin){
			if(!this.autoScrollTimeout){
				this.autoScrollTimeout = setTimeout(() => {
					scrollPos = Math.max(0,scrollLeft-5);
					this.table.rowManager.getElement().scrollLeft = scrollPos;
					this.autoScrollTimeout = false;
				}, 1);
			}
		}
		
		if(scrollLeft + columnHolder.clientWidth - xPos < this.autoScrollMargin){
			if(!this.autoScrollTimeout){
				this.autoScrollTimeout = setTimeout(() => {
					scrollPos = Math.min(columnHolder.clientWidth, scrollLeft+5);
					this.table.rowManager.getElement().scrollLeft = scrollPos;
					this.autoScrollTimeout = false;
				}, 1);
			}
		}
	}
}

var defaultSenders = {
	delete:function(fromRow, toRow, toTable){
		fromRow.delete();
	}
};

var defaultReceivers = {
	insert:function(fromRow, toRow, fromTable){
		this.table.addRow(fromRow.getData(), undefined, toRow);
		return true;
	},

	add:function(fromRow, toRow, fromTable){
		this.table.addRow(fromRow.getData());
		return true;
	},

	update:function(fromRow, toRow, fromTable){
		if(toRow){
			toRow.update(fromRow.getData());
			return true;
		}

		return false;
	},

	replace:function(fromRow, toRow, fromTable){
		if(toRow){
			this.table.addRow(fromRow.getData(), undefined, toRow);
			toRow.delete();
			return true;
		}

		return false;
	},
};

class MoveRows extends Module{

	static moduleName = "moveRow";

	//load defaults
	static senders = defaultSenders;
	static receivers = defaultReceivers;

	constructor(table){
		super(table);

		this.placeholderElement = this.createPlaceholderElement();
		this.hoverElement = false; //floating row header element
		this.checkTimeout = false; //click check timeout holder
		this.checkPeriod = 150; //period to wait on mousedown to consider this a move and not a click
		this.moving = false; //currently moving row
		this.toRow = false; //destination row
		this.toRowAfter = false; //position of moving row relative to the destination row
		this.hasHandle = false; //row has handle instead of fully movable row
		this.startY = 0; //starting Y position within header element
		this.startX = 0; //starting X position within header element

		this.moveHover = this.moveHover.bind(this);
		this.endMove = this.endMove.bind(this);
		this.tableRowDropEvent = false;

		this.touchMove = false;

		this.connection = false;
		this.connectionSelectorsTables = false;
		this.connectionSelectorsElements = false;
		this.connectionElements = [];
		this.connections = [];

		this.connectedTable = false;
		this.connectedRow = false;

		this.registerTableOption("movableRows", false); //enable movable rows
		this.registerTableOption("movableRowsConnectedTables", false); //tables for movable rows to be connected to
		this.registerTableOption("movableRowsConnectedElements", false); //other elements for movable rows to be connected to
		this.registerTableOption("movableRowsSender", false);
		this.registerTableOption("movableRowsReceiver", "insert");

		this.registerColumnOption("rowHandle");
	}

	createPlaceholderElement(){
		var el = document.createElement("div");

		el.classList.add("tabulator-row");
		el.classList.add("tabulator-row-placeholder");

		return el;
	}

	initialize(){
		if(this.table.options.movableRows){
			this.connectionSelectorsTables = this.table.options.movableRowsConnectedTables;
			this.connectionSelectorsElements = this.table.options.movableRowsConnectedElements;

			this.connection = this.connectionSelectorsTables || this.connectionSelectorsElements;

			this.subscribe("cell-init", this.initializeCell.bind(this));
			this.subscribe("column-init", this.initializeColumn.bind(this));
			this.subscribe("row-init", this.initializeRow.bind(this));
		}
	}

	initializeGroupHeader(group){
		var self = this,
		config = {};

		//inter table drag drop
		config.mouseup = function(e){
			self.tableRowDrop(e, group);
		}.bind(self);

		//same table drag drop
		config.mousemove = function(e){
			var rowEl;

			if(((e.pageY - Helpers.elOffset(group.element).top) + self.table.rowManager.element.scrollTop) > (group.getHeight() / 2)){
				if(self.toRow !== group || !self.toRowAfter){
					rowEl = group.getElement();
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl.nextSibling);
					self.moveRow(group, true);
				}
			}else {
				if(self.toRow !== group || self.toRowAfter){
					rowEl = group.getElement();
					if(rowEl.previousSibling){
						rowEl.parentNode.insertBefore(self.placeholderElement, rowEl);
						self.moveRow(group, false);
					}
				}
			}
		}.bind(self);

		group.modules.moveRow = config;
	}

	initializeRow(row){
		var self = this,
		config = {},
		rowEl;

		//inter table drag drop
		config.mouseup = function(e){
			self.tableRowDrop(e, row);
		}.bind(self);

		//same table drag drop
		config.mousemove = function(e){
			var rowEl = row.getElement();

			if(((e.pageY - Helpers.elOffset(rowEl).top) + self.table.rowManager.element.scrollTop) > (row.getHeight() / 2)){
				if(self.toRow !== row || !self.toRowAfter){
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl.nextSibling);
					self.moveRow(row, true);
				}
			}else {
				if(self.toRow !== row || self.toRowAfter){
					rowEl.parentNode.insertBefore(self.placeholderElement, rowEl);
					self.moveRow(row, false);
				}
			}
		}.bind(self);


		if(!this.hasHandle){

			rowEl = row.getElement();

			rowEl.addEventListener("mousedown", function(e){
				if(e.which === 1){
					self.checkTimeout = setTimeout(function(){
						self.startMove(e, row);
					}, self.checkPeriod);
				}
			});

			rowEl.addEventListener("mouseup", function(e){
				if(e.which === 1){
					if(self.checkTimeout){
						clearTimeout(self.checkTimeout);
					}
				}
			});

			this.bindTouchEvents(row, row.getElement());
		}

		row.modules.moveRow = config;
	}

	initializeColumn(column){
		if(column.definition.rowHandle && this.table.options.movableRows !== false){
			this.hasHandle = true;
		}
	}

	initializeCell(cell){
		if(cell.column.definition.rowHandle && this.table.options.movableRows !== false){
			var self = this,
			cellEl = cell.getElement(true);

			cellEl.addEventListener("mousedown", function(e){
				if(e.which === 1){
					self.checkTimeout = setTimeout(function(){
						self.startMove(e, cell.row);
					}, self.checkPeriod);
				}
			});

			cellEl.addEventListener("mouseup", function(e){
				if(e.which === 1){
					if(self.checkTimeout){
						clearTimeout(self.checkTimeout);
					}
				}
			});

			this.bindTouchEvents(cell.row, cellEl);
		}
	}

	bindTouchEvents(row, element){
		var startYMove = false, //shifting center position of the cell
		nextRow, prevRow, nextRowHeight, prevRowHeight, nextRowHeightLast, prevRowHeightLast;

		element.addEventListener("touchstart", (e) => {
			this.checkTimeout = setTimeout(() => {
				this.touchMove = true;
				nextRow = row.nextRow();
				nextRowHeight = nextRow ? nextRow.getHeight()/2 : 0;
				prevRow = row.prevRow();
				prevRowHeight = prevRow ? prevRow.getHeight()/2 : 0;
				nextRowHeightLast = 0;
				prevRowHeightLast = 0;
				startYMove = false;

				this.startMove(e, row);
			}, this.checkPeriod);
		}, {passive: true});
		this.moving, this.toRow, this.toRowAfter;
		element.addEventListener("touchmove", (e) => {

			var diff, moveToRow;

			if(this.moving){
				e.preventDefault();

				this.moveHover(e);

				if(!startYMove){
					startYMove = e.touches[0].pageY;
				}

				diff = e.touches[0].pageY - startYMove;

				if(diff > 0){
					if(nextRow && diff - nextRowHeightLast > nextRowHeight){
						moveToRow = nextRow;

						if(moveToRow !== row){
							startYMove = e.touches[0].pageY;
							moveToRow.getElement().parentNode.insertBefore(this.placeholderElement, moveToRow.getElement().nextSibling);
							this.moveRow(moveToRow, true);
						}
					}
				}else {
					if(prevRow && -diff - prevRowHeightLast >  prevRowHeight){
						moveToRow = prevRow;

						if(moveToRow !== row){
							startYMove = e.touches[0].pageY;
							moveToRow.getElement().parentNode.insertBefore(this.placeholderElement, moveToRow.getElement());
							this.moveRow(moveToRow, false);
						}
					}
				}

				if(moveToRow){
					nextRow = moveToRow.nextRow();
					nextRowHeightLast = nextRowHeight;
					nextRowHeight = nextRow ? nextRow.getHeight() / 2 : 0;
					prevRow = moveToRow.prevRow();
					prevRowHeightLast = prevRowHeight;
					prevRowHeight = prevRow ? prevRow.getHeight() / 2 : 0;
				}
			}
		});

		element.addEventListener("touchend", (e) => {
			if(this.checkTimeout){
				clearTimeout(this.checkTimeout);
			}
			if(this.moving){
				this.endMove(e);
				this.touchMove = false;
			}
		});
	}

	_bindMouseMove(){
		this.table.rowManager.getDisplayRows().forEach((row) => {
			if((row.type === "row" || row.type === "group") && row.modules.moveRow && row.modules.moveRow.mousemove){
				row.getElement().addEventListener("mousemove", row.modules.moveRow.mousemove);
			}
		});
	}

	_unbindMouseMove(){
		this.table.rowManager.getDisplayRows().forEach((row) => {
			if((row.type === "row" || row.type === "group") && row.modules.moveRow && row.modules.moveRow.mousemove){
				row.getElement().removeEventListener("mousemove", row.modules.moveRow.mousemove);
			}
		});
	}

	startMove(e, row){
		var element = row.getElement();

		this.setStartPosition(e, row);

		this.moving = row;

		this.table.element.classList.add("tabulator-block-select");

		//create placeholder
		this.placeholderElement.style.width = row.getWidth() + "px";
		this.placeholderElement.style.height = row.getHeight() + "px";

		if(!this.connection){
			element.parentNode.insertBefore(this.placeholderElement, element);
			element.parentNode.removeChild(element);
		}else {
			this.table.element.classList.add("tabulator-movingrow-sending");
			this.connectToTables(row);
		}

		//create hover element
		this.hoverElement = element.cloneNode(true);
		this.hoverElement.classList.add("tabulator-moving");

		if(this.connection){
			document.body.appendChild(this.hoverElement);
			this.hoverElement.style.left = "0";
			this.hoverElement.style.top = "0";
			this.hoverElement.style.width = this.table.element.clientWidth + "px";
			this.hoverElement.style.whiteSpace = "nowrap";
			this.hoverElement.style.overflow = "hidden";
			this.hoverElement.style.pointerEvents = "none";
		}else {
			this.table.rowManager.getTableElement().appendChild(this.hoverElement);

			this.hoverElement.style.left = "0";
			this.hoverElement.style.top = "0";

			this._bindMouseMove();
		}

		document.body.addEventListener("mousemove", this.moveHover);
		document.body.addEventListener("mouseup", this.endMove);

		this.dispatchExternal("rowMoving", row.getComponent());

		this.moveHover(e);
	}

	setStartPosition(e, row){
		var pageX = this.touchMove ? e.touches[0].pageX : e.pageX,
		pageY = this.touchMove ? e.touches[0].pageY : e.pageY,
		element, position;

		element = row.getElement();
		if(this.connection){
			position = element.getBoundingClientRect();

			this.startX = position.left - pageX + window.pageXOffset;
			this.startY = position.top - pageY + window.pageYOffset;
		}else {
			this.startY = (pageY - element.getBoundingClientRect().top);
		}
	}

	endMove(e){
		if(!e || e.which === 1 || this.touchMove){
			this._unbindMouseMove();

			if(!this.connection){
				this.placeholderElement.parentNode.insertBefore(this.moving.getElement(), this.placeholderElement.nextSibling);
				this.placeholderElement.parentNode.removeChild(this.placeholderElement);
			}

			this.hoverElement.parentNode.removeChild(this.hoverElement);

			this.table.element.classList.remove("tabulator-block-select");

			if(this.toRow){
				this.table.rowManager.moveRow(this.moving, this.toRow, this.toRowAfter);
			}else {
				this.dispatchExternal("rowMoveCancelled", this.moving.getComponent());
			}

			this.moving = false;
			this.toRow = false;
			this.toRowAfter = false;

			document.body.removeEventListener("mousemove", this.moveHover);
			document.body.removeEventListener("mouseup", this.endMove);

			if(this.connection){
				this.table.element.classList.remove("tabulator-movingrow-sending");
				this.disconnectFromTables();
			}
		}
	}

	moveRow(row, after){
		this.toRow = row;
		this.toRowAfter = after;
	}

	moveHover(e){
		if(this.connection){
			this.moveHoverConnections.call(this, e);
		}else {
			this.moveHoverTable.call(this, e);
		}
	}

	moveHoverTable(e){
		var rowHolder = this.table.rowManager.getElement(),
		scrollTop = rowHolder.scrollTop,
		yPos = ((this.touchMove ? e.touches[0].pageY : e.pageY) - rowHolder.getBoundingClientRect().top) + scrollTop;
		
		this.hoverElement.style.top = Math.min(yPos - this.startY, this.table.rowManager.element.scrollHeight - this.hoverElement.offsetHeight) + "px";
	}

	moveHoverConnections(e){
		this.hoverElement.style.left = (this.startX + (this.touchMove ? e.touches[0].pageX : e.pageX)) + "px";
		this.hoverElement.style.top = (this.startY + (this.touchMove ? e.touches[0].pageY : e.pageY)) + "px";
	}

	elementRowDrop(e, element, row){
		this.dispatchExternal("movableRowsElementDrop", e, element, row ? row.getComponent() : false);
	}

	//establish connection with other tables
	connectToTables(row){
		var connectionTables;

		if(this.connectionSelectorsTables){
			connectionTables = this.commsConnections(this.connectionSelectorsTables);

			this.dispatchExternal("movableRowsSendingStart", connectionTables);

			this.commsSend(this.connectionSelectorsTables, "moveRow", "connect", {
				row:row,
			});
		}

		if(this.connectionSelectorsElements){

			this.connectionElements = [];

			if(!Array.isArray(this.connectionSelectorsElements)){
				this.connectionSelectorsElements = [this.connectionSelectorsElements];
			}

			this.connectionSelectorsElements.forEach((query) => {
				if(typeof query === "string"){
					this.connectionElements = this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(query)));
				}else {
					this.connectionElements.push(query);
				}
			});

			this.connectionElements.forEach((element) => {
				var dropEvent = (e) => {
					this.elementRowDrop(e, element, this.moving);
				};

				element.addEventListener("mouseup", dropEvent);
				element.tabulatorElementDropEvent = dropEvent;

				element.classList.add("tabulator-movingrow-receiving");
			});
		}
	}

	//disconnect from other tables
	disconnectFromTables(){
		var connectionTables;

		if(this.connectionSelectorsTables){
			connectionTables = this.commsConnections(this.connectionSelectorsTables);

			this.dispatchExternal("movableRowsSendingStop", connectionTables);

			this.commsSend(this.connectionSelectorsTables, "moveRow", "disconnect");
		}

		this.connectionElements.forEach((element) => {
			element.classList.remove("tabulator-movingrow-receiving");
			element.removeEventListener("mouseup", element.tabulatorElementDropEvent);
			delete element.tabulatorElementDropEvent;
		});
	}

	//accept incomming connection
	connect(table, row){
		if(!this.connectedTable){
			this.connectedTable = table;
			this.connectedRow = row;

			this.table.element.classList.add("tabulator-movingrow-receiving");

			this.table.rowManager.getDisplayRows().forEach((row) => {
				if(row.type === "row" && row.modules.moveRow && row.modules.moveRow.mouseup){
					row.getElement().addEventListener("mouseup", row.modules.moveRow.mouseup);
				}
			});

			this.tableRowDropEvent = this.tableRowDrop.bind(this);

			this.table.element.addEventListener("mouseup", this.tableRowDropEvent);

			this.dispatchExternal("movableRowsReceivingStart", row, table);

			return true;
		}else {
			console.warn("Move Row Error - Table cannot accept connection, already connected to table:", this.connectedTable);
			return false;
		}
	}

	//close incoming connection
	disconnect(table){
		if(table === this.connectedTable){
			this.connectedTable = false;
			this.connectedRow = false;

			this.table.element.classList.remove("tabulator-movingrow-receiving");

			this.table.rowManager.getDisplayRows().forEach((row) =>{
				if(row.type === "row" && row.modules.moveRow && row.modules.moveRow.mouseup){
					row.getElement().removeEventListener("mouseup", row.modules.moveRow.mouseup);
				}
			});

			this.table.element.removeEventListener("mouseup", this.tableRowDropEvent);

			this.dispatchExternal("movableRowsReceivingStop", table);
		}else {
			console.warn("Move Row Error - trying to disconnect from non connected table");
		}
	}

	dropComplete(table, row, success){
		var sender = false;

		if(success){

			switch(typeof this.table.options.movableRowsSender){
				case "string":
					sender = MoveRows.senders[this.table.options.movableRowsSender];
					break;

				case "function":
					sender = this.table.options.movableRowsSender;
					break;
			}

			if(sender){
				sender.call(this, this.moving ? this.moving.getComponent() : undefined, row ? row.getComponent() : undefined, table);
			}else {
				if(this.table.options.movableRowsSender){
					console.warn("Mover Row Error - no matching sender found:", this.table.options.movableRowsSender);
				}
			}

			this.dispatchExternal("movableRowsSent", this.moving.getComponent(), row ? row.getComponent() : undefined, table);
		}else {
			this.dispatchExternal("movableRowsSentFailed", this.moving.getComponent(), row ? row.getComponent() : undefined, table);
		}

		this.endMove();
	}

	tableRowDrop(e, row){
		var receiver = false,
		success = false;

		e.stopImmediatePropagation();

		switch(typeof this.table.options.movableRowsReceiver){
			case "string":
				receiver = MoveRows.receivers[this.table.options.movableRowsReceiver];
				break;

			case "function":
				receiver = this.table.options.movableRowsReceiver;
				break;
		}

		if(receiver){
			success = receiver.call(this, this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		}else {
			console.warn("Mover Row Error - no matching receiver found:", this.table.options.movableRowsReceiver);
		}

		if(success){
			this.dispatchExternal("movableRowsReceived", this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		}else {
			this.dispatchExternal("movableRowsReceivedFailed", this.connectedRow.getComponent(), row ? row.getComponent() : undefined, this.connectedTable);
		}

		this.commsSend(this.connectedTable, "moveRow", "dropcomplete", {
			row:row,
			success:success,
		});
	}

	commsReceived(table, action, data){
		switch(action){
			case "connect":
				return this.connect(table, data.row);

			case "disconnect":
				return this.disconnect(table);

			case "dropcomplete":
				return this.dropComplete(table, data.row, data.success);
		}
	}
}

var defaultMutators = {};

class Mutator extends Module{

	static moduleName = "mutator";

	//load defaults
	static mutators = defaultMutators;

	constructor(table){
		super(table);

		this.allowedTypes = ["", "data", "edit", "clipboard", "import"]; //list of mutation types
		this.enabled = true;

		this.registerColumnOption("mutator");
		this.registerColumnOption("mutatorParams");
		this.registerColumnOption("mutatorData");
		this.registerColumnOption("mutatorDataParams");
		this.registerColumnOption("mutatorEdit");
		this.registerColumnOption("mutatorEditParams");
		this.registerColumnOption("mutatorClipboard");
		this.registerColumnOption("mutatorClipboardParams");
		this.registerColumnOption("mutatorImport");
		this.registerColumnOption("mutatorImportParams");
		this.registerColumnOption("mutateLink");
	}

	initialize(){
		this.subscribe("cell-value-changing", this.transformCell.bind(this));
		this.subscribe("cell-value-changed", this.mutateLink.bind(this));
		this.subscribe("column-layout", this.initializeColumn.bind(this));
		this.subscribe("row-data-init-before", this.rowDataChanged.bind(this));
		this.subscribe("row-data-changing", this.rowDataChanged.bind(this));
	}

	rowDataChanged(row, tempData, updatedData){
		return this.transformRow(tempData, "data", updatedData);
	}

	//initialize column mutator
	initializeColumn(column){
		var match = false,
		config = {};

		this.allowedTypes.forEach((type) => {
			var key = "mutator" + (type.charAt(0).toUpperCase() + type.slice(1)),
			mutator;

			if(column.definition[key]){
				mutator = this.lookupMutator(column.definition[key]);

				if(mutator){
					match = true;

					config[key] = {
						mutator:mutator,
						params: column.definition[key + "Params"] || {},
					};
				}
			}
		});

		if(match){
			column.modules.mutate = config;
		}
	}

	lookupMutator(value){
		var mutator = false;

		//set column mutator
		switch(typeof value){
			case "string":
				if(Mutator.mutators[value]){
					mutator = Mutator.mutators[value];
				}else {
					console.warn("Mutator Error - No such mutator found, ignoring: ", value);
				}
				break;

			case "function":
				mutator = value;
				break;
		}

		return mutator;
	}

	//apply mutator to row
	transformRow(data, type, updatedData){
		var key = "mutator" + (type.charAt(0).toUpperCase() + type.slice(1)),
		value;

		// console.log("key", key)

		if(this.enabled){

			this.table.columnManager.traverse((column) => {
				var mutator, params, component;

				if(column.modules.mutate){
					mutator = column.modules.mutate[key] || column.modules.mutate.mutator || false;

					if(mutator){
						value = column.getFieldValue(typeof updatedData !== "undefined" ? updatedData : data);

						if((type == "data" && !updatedData)|| typeof value !== "undefined"){
							component = column.getComponent();
							params = typeof mutator.params === "function" ? mutator.params(value, data, type, component) : mutator.params;
							column.setFieldValue(data, mutator.mutator(value, data, type, params, component));
						}
					}
				}
			});
		}

		return data;
	}

	//apply mutator to new cell value
	transformCell(cell, value){
		if(cell.column.modules.mutate){
			var mutator = cell.column.modules.mutate.mutatorEdit || cell.column.modules.mutate.mutator || false,
			tempData = {};

			if(mutator){
				tempData = Object.assign(tempData, cell.row.getData());
				cell.column.setFieldValue(tempData, value);
				return mutator.mutator(value, tempData, "edit", mutator.params, cell.getComponent());
			}
		}

		return value;
	}

	mutateLink(cell){
		var links = cell.column.definition.mutateLink;

		if(links){
			if(!Array.isArray(links)){
				links = [links];
			}

			links.forEach((link) => {
				var linkCell = cell.row.getCell(link);

				if(linkCell){
					linkCell.setValue(linkCell.getValue(), true, true);
				}
			});
		}
	}

	enable(){
		this.enabled = true;
	}

	disable(){
		this.enabled = false;
	}
}

function rows(pageSize, currentRow, currentPage, totalRows, totalPages){
	var el = document.createElement("span"),
	showingEl = document.createElement("span"),
	valueEl = document.createElement("span"),
	ofEl = document.createElement("span"),
	totalEl = document.createElement("span"),
	rowsEl = document.createElement("span");

	this.table.modules.localize.langBind("pagination|counter|showing", (value) => {
		showingEl.innerHTML = value;
	});

	this.table.modules.localize.langBind("pagination|counter|of", (value) => {
		ofEl.innerHTML = value;
	});

	this.table.modules.localize.langBind("pagination|counter|rows", (value) => {
		rowsEl.innerHTML = value;
	});

	if(totalRows){
		valueEl.innerHTML = " " + currentRow + "-" + Math.min((currentRow + pageSize - 1), totalRows) + " ";
		
		totalEl.innerHTML = " " + totalRows + " ";
		
		el.appendChild(showingEl);
		el.appendChild(valueEl);
		el.appendChild(ofEl);
		el.appendChild(totalEl);
		el.appendChild(rowsEl);
	}else {
		valueEl.innerHTML = " 0 ";

		el.appendChild(showingEl);
		el.appendChild(valueEl);
		el.appendChild(rowsEl);
	}
	
	return el;
}

function pages(pageSize, currentRow, currentPage, totalRows, totalPages){

	var el = document.createElement("span"),
	showingEl = document.createElement("span"),
	valueEl = document.createElement("span"),
	ofEl = document.createElement("span"),
	totalEl = document.createElement("span"),
	rowsEl = document.createElement("span");
	
	this.table.modules.localize.langBind("pagination|counter|showing", (value) => {
		showingEl.innerHTML = value;
	});
	
	valueEl.innerHTML = " " + currentPage + " ";
	
	this.table.modules.localize.langBind("pagination|counter|of", (value) => {
		ofEl.innerHTML = value;
	});
	
	totalEl.innerHTML = " " + totalPages + " ";
	
	this.table.modules.localize.langBind("pagination|counter|pages", (value) => {
		rowsEl.innerHTML = value;
	});
	
	el.appendChild(showingEl);
	el.appendChild(valueEl);
	el.appendChild(ofEl);
	el.appendChild(totalEl);
	el.appendChild(rowsEl);
	
	return el;
}

var defaultPageCounters = {
	rows:rows,
	pages:pages,
};

class Page extends Module{

	static moduleName = "page";

	//load defaults
	static pageCounters = defaultPageCounters;
	
	constructor(table){
		super(table);
		
		this.mode = "local";
		this.progressiveLoad = false;
		
		this.element = null;
		this.pageCounterElement = null;
		this.pageCounter = null;
		
		this.size = 0;
		this.page = 1;
		this.count = 5;
		this.max = 1;

		this.remoteRowCountEstimate = null;
		
		this.initialLoad = true;
		this.dataChanging = false; //flag to check if data is being changed by this module
		
		this.pageSizes = [];
		
		this.registerTableOption("pagination", false); //set pagination type
		this.registerTableOption("paginationMode", "local"); //local or remote pagination
		this.registerTableOption("paginationSize", false); //set number of rows to a page
		this.registerTableOption("paginationInitialPage", 1); //initial page to show on load
		this.registerTableOption("paginationCounter", false);  // set pagination counter
		this.registerTableOption("paginationCounterElement", false);  // set pagination counter
		this.registerTableOption("paginationButtonCount", 5);  // set count of page button
		this.registerTableOption("paginationSizeSelector", false); //add pagination size selector element
		this.registerTableOption("paginationElement", false); //element to hold pagination numbers
		// this.registerTableOption("paginationDataSent", {}); //pagination data sent to the server
		// this.registerTableOption("paginationDataReceived", {}); //pagination data received from the server
		this.registerTableOption("paginationAddRow", "page"); //add rows on table or page
		this.registerTableOption("paginationOutOfRange", false); //reset the current page when the last page < this.page, values: false|function|any value accepted by setPage()
		
		this.registerTableOption("progressiveLoad", false); //progressive loading
		this.registerTableOption("progressiveLoadDelay", 0); //delay between requests
		this.registerTableOption("progressiveLoadScrollMargin", 0); //margin before scroll begins
		
		this.registerTableFunction("setMaxPage", this.setMaxPage.bind(this));
		this.registerTableFunction("setPage", this.setPage.bind(this));
		this.registerTableFunction("setPageToRow", this.userSetPageToRow.bind(this));
		this.registerTableFunction("setPageSize", this.userSetPageSize.bind(this));
		this.registerTableFunction("getPageSize", this.getPageSize.bind(this));
		this.registerTableFunction("previousPage", this.previousPage.bind(this));
		this.registerTableFunction("nextPage", this.nextPage.bind(this));
		this.registerTableFunction("getPage", this.getPage.bind(this));
		this.registerTableFunction("getPageMax", this.getPageMax.bind(this));
		
		//register component functions
		this.registerComponentFunction("row", "pageTo", this.setPageToRow.bind(this));
	}
	
	initialize(){
		if(this.table.options.pagination){
			this.subscribe("row-deleted", this.rowsUpdated.bind(this));
			this.subscribe("row-added", this.rowsUpdated.bind(this));
			this.subscribe("data-processed", this.initialLoadComplete.bind(this));
			this.subscribe("table-built", this.calculatePageSizes.bind(this));
			this.subscribe("footer-redraw", this.footerRedraw.bind(this));

			if(this.table.options.paginationAddRow == "page"){
				this.subscribe("row-adding-position", this.rowAddingPosition.bind(this));
			}
			
			if(this.table.options.paginationMode === "remote"){
				this.subscribe("data-params", this.remotePageParams.bind(this));
				this.subscribe("data-loaded", this._parseRemoteData.bind(this));
			}
			
			if(this.table.options.progressiveLoad){
				console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time");
			}
			
			this.registerDisplayHandler(this.restOnRenderBefore.bind(this), 40);
			this.registerDisplayHandler(this.getRows.bind(this), 50);
			
			this.createElements();
			this.initializePageCounter();
			this.initializePaginator();
		}else if(this.table.options.progressiveLoad){
			this.subscribe("data-params", this.remotePageParams.bind(this));
			this.subscribe("data-loaded", this._parseRemoteData.bind(this));
			this.subscribe("table-built", this.calculatePageSizes.bind(this));
			this.subscribe("data-processed", this.initialLoadComplete.bind(this));
			
			this.initializeProgressive(this.table.options.progressiveLoad);
			
			if(this.table.options.progressiveLoad === "scroll"){
				this.subscribe("scroll-vertical", this.scrollVertical.bind(this));
			}
		}
	}
	
	rowAddingPosition(row, top){
		var rowManager = this.table.rowManager,
		displayRows = rowManager.getDisplayRows(),
		index;
		
		if(top){
			if(displayRows.length){
				index = displayRows[0];
			}else {
				if(rowManager.activeRows.length){
					index = rowManager.activeRows[rowManager.activeRows.length-1];
					top = false;
				}
			}
		}else {
			if(displayRows.length){
				index = displayRows[displayRows.length - 1];
				top = displayRows.length < this.size ? false : true;
			}
		}
		
		return {index, top};
	}
	
	calculatePageSizes(){
		var testElRow, testElCell;
		
		if(this.table.options.paginationSize){
			this.size = this.table.options.paginationSize;
		}else {
			testElRow = document.createElement("div");
			testElRow.classList.add("tabulator-row");
			testElRow.style.visibility = "hidden";
			
			testElCell = document.createElement("div");
			testElCell.classList.add("tabulator-cell");
			testElCell.innerHTML = "Page Row Test";
			
			testElRow.appendChild(testElCell);
			
			this.table.rowManager.getTableElement().appendChild(testElRow);
			
			this.size = Math.floor(this.table.rowManager.getElement().clientHeight / testElRow.offsetHeight);
			
			this.table.rowManager.getTableElement().removeChild(testElRow);
		}

		this.dispatchExternal("pageSizeChanged", this.size);
		
		this.generatePageSizeSelectList();
	}
	
	initialLoadComplete(){
		this.initialLoad = false;
	}
	
	remotePageParams(data, config, silent, params){
		if(!this.initialLoad){
			if((this.progressiveLoad && !silent) || (!this.progressiveLoad && !this.dataChanging)){
				this.reset(true);
			}
		}
		
		//configure request params
		params.page = this.page;
		
		//set page size if defined
		if(this.size){
			params.size = this.size;
		}
		
		return params;
	}
	
	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////
	
	userSetPageToRow(row){
		if(this.table.options.pagination){
			row = this.table.rowManager.findRow(row);
			
			if(row){
				return this.setPageToRow(row);
			}
		}
		
		return Promise.reject();
	}
	
	userSetPageSize(size){
		if(this.table.options.pagination){
			this.setPageSize(size);
			return this.setPage(1);
		}else {
			return false;
		}
	}
	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////
	
	scrollVertical(top, dir){
		var element, diff, margin;
		if(!dir && !this.table.dataLoader.loading){
			element = this.table.rowManager.getElement();
			diff = element.scrollHeight - element.clientHeight - top;
			margin = this.table.options.progressiveLoadScrollMargin || (element.clientHeight * 2);
			
			if(diff < margin){
				this.nextPage()
					.catch(() => {}); //consume the exception thrown when on the last page
			}
		}
	}
	
	restOnRenderBefore(rows, renderInPosition){
		if(!renderInPosition){
			if(this.mode === "local"){
				this.reset();
			}
		}
		
		return rows;
	}
	
	rowsUpdated(){
		this.refreshData(true, "all");
	}
	
	createElements(){
		var button;
		
		this.element = document.createElement("span");
		this.element.classList.add("tabulator-paginator");
		
		this.pagesElement = document.createElement("span");
		this.pagesElement.classList.add("tabulator-pages");
		
		button = document.createElement("button");
		button.classList.add("tabulator-page");
		button.setAttribute("type", "button");
		button.setAttribute("role", "button");
		button.setAttribute("aria-label", "");
		button.setAttribute("title", "");
		
		this.firstBut = button.cloneNode(true);
		this.firstBut.setAttribute("data-page", "first");
		
		this.prevBut = button.cloneNode(true);
		this.prevBut.setAttribute("data-page", "prev");
		
		this.nextBut = button.cloneNode(true);
		this.nextBut.setAttribute("data-page", "next");
		
		this.lastBut = button.cloneNode(true);
		this.lastBut.setAttribute("data-page", "last");
		
		if(this.table.options.paginationSizeSelector){
			this.pageSizeSelect = document.createElement("select");
			this.pageSizeSelect.classList.add("tabulator-page-size");
		}
	}
	
	generatePageSizeSelectList(){
		var pageSizes = [];
		
		if(this.pageSizeSelect){
			
			if(Array.isArray(this.table.options.paginationSizeSelector)){
				pageSizes = this.table.options.paginationSizeSelector;
				this.pageSizes = pageSizes;
				
				if(this.pageSizes.indexOf(this.size) == -1){
					pageSizes.unshift(this.size);
				}
			}else {
				
				if(this.pageSizes.indexOf(this.size) == -1){
					pageSizes = [];
					
					for (let i = 1; i < 5; i++){
						pageSizes.push(this.size * i);
					}
					
					this.pageSizes = pageSizes;
				}else {
					pageSizes = this.pageSizes;
				}
			}
			
			while(this.pageSizeSelect.firstChild) this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);
			
			pageSizes.forEach((item) => {
				var itemEl = document.createElement("option");
				itemEl.value = item;
				
				if(item === true){
					this.langBind("pagination|all", function(value){
						itemEl.innerHTML = value;
					});
				}else {
					itemEl.innerHTML = item;
				}
				
				
				
				this.pageSizeSelect.appendChild(itemEl);
			});
			
			this.pageSizeSelect.value = this.size;
		}
	}
	
	initializePageCounter(){
		var counter = this.table.options.paginationCounter,
		pageCounter = null;
		
		if(counter){
			if(typeof counter === "function"){
				pageCounter = counter;
			}else {
				pageCounter = Page.pageCounters[counter];
			}
			
			if(pageCounter){
				this.pageCounter = pageCounter;
				
				this.pageCounterElement = document.createElement("span");
				this.pageCounterElement.classList.add("tabulator-page-counter");
			}else {
				console.warn("Pagination Error - No such page counter found: ", counter);
			}
		}
	}
	
	//setup pagination
	initializePaginator(hidden){
		var pageSelectLabel, paginationCounterHolder;
		
		if(!hidden){
			//build pagination element
			
			//bind localizations
			this.langBind("pagination|first", (value) => {
				this.firstBut.innerHTML = value;
			});
			
			this.langBind("pagination|first_title", (value) => {
				this.firstBut.setAttribute("aria-label", value);
				this.firstBut.setAttribute("title", value);
			});
			
			this.langBind("pagination|prev", (value) => {
				this.prevBut.innerHTML = value;
			});
			
			this.langBind("pagination|prev_title", (value) => {
				this.prevBut.setAttribute("aria-label", value);
				this.prevBut.setAttribute("title", value);
			});
			
			this.langBind("pagination|next", (value) => {
				this.nextBut.innerHTML = value;
			});
			
			this.langBind("pagination|next_title", (value) => {
				this.nextBut.setAttribute("aria-label", value);
				this.nextBut.setAttribute("title", value);
			});
			
			this.langBind("pagination|last", (value) => {
				this.lastBut.innerHTML = value;
			});
			
			this.langBind("pagination|last_title", (value) => {
				this.lastBut.setAttribute("aria-label", value);
				this.lastBut.setAttribute("title", value);
			});
			
			//click bindings
			this.firstBut.addEventListener("click", () => {
				this.setPage(1);
			});
			
			this.prevBut.addEventListener("click", () => {
				this.previousPage();
			});
			
			this.nextBut.addEventListener("click", () => {
				this.nextPage();
			});
			
			this.lastBut.addEventListener("click", () => {
				this.setPage(this.max);
			});
			
			if(this.table.options.paginationElement){
				this.element = this.table.options.paginationElement;
			}
			
			if(this.pageSizeSelect){
				pageSelectLabel = document.createElement("label");
				
				this.langBind("pagination|page_size", (value) => {
					this.pageSizeSelect.setAttribute("aria-label", value);
					this.pageSizeSelect.setAttribute("title", value);
					pageSelectLabel.innerHTML = value;
				});
				
				this.element.appendChild(pageSelectLabel);
				this.element.appendChild(this.pageSizeSelect);
				
				this.pageSizeSelect.addEventListener("change", (e) => {
					this.setPageSize(this.pageSizeSelect.value == "true" ? true : this.pageSizeSelect.value);
					this.setPage(1);
				});
			}
			
			//append to DOM
			this.element.appendChild(this.firstBut);
			this.element.appendChild(this.prevBut);
			this.element.appendChild(this.pagesElement);
			this.element.appendChild(this.nextBut);
			this.element.appendChild(this.lastBut);
			
			if(!this.table.options.paginationElement){
				if(this.table.options.paginationCounter){

					if(this.table.options.paginationCounterElement){
						if(this.table.options.paginationCounterElement instanceof HTMLElement){
							this.table.options.paginationCounterElement.appendChild(this.pageCounterElement);
						}else if(typeof this.table.options.paginationCounterElement === "string"){
							paginationCounterHolder = document.querySelector(this.table.options.paginationCounterElement);
							
							if(paginationCounterHolder){
								paginationCounterHolder.appendChild(this.pageCounterElement);
							}else {
								console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:", this.table.options.paginationCounterElement);
							}
						}
					}else {
						this.footerAppend(this.pageCounterElement);
					}
					
				}
				
				this.footerAppend(this.element);
			}
			
			this.page = this.table.options.paginationInitialPage;
			this.count = this.table.options.paginationButtonCount;
		}
		
		//set default values
		this.mode = this.table.options.paginationMode;
	}
	
	initializeProgressive(mode){
		this.initializePaginator(true);
		this.mode = "progressive_" + mode;
		this.progressiveLoad = true;
	}
	
	trackChanges(){
		this.dispatch("page-changed");
	}
	
	//calculate maximum page from number of rows
	setMaxRows(rowCount){
		if(!rowCount){
			this.max = 1;
		}else {
			this.max = this.size === true ?  1 : Math.ceil(rowCount/this.size);
		}
		
		if(this.page > this.max){
			this.page = this.max;
		}
	}
	
	//reset to first page without triggering action
	reset(force){
		if(!this.initialLoad){
			if(this.mode == "local" || force){
				this.page = 1;
				this.trackChanges();
			}
		}
	}
	
	//set the maximum page
	setMaxPage(max){
		
		max = parseInt(max);
		
		this.max = max || 1;
		
		if(this.page > this.max){
			this.page = this.max;
			this.trigger();
		}
	}
	
	//set current page number
	setPage(page){
		switch(page){
			case "first":
				return this.setPage(1);
	
			case "prev":
				return this.previousPage();
			
			case "next":
				return this.nextPage();
			
			case "last":
				return this.setPage(this.max);
		}
		
		page = parseInt(page);
		
		if((page > 0 && page <= this.max) || this.mode !== "local"){
			this.page = page;
			
			this.trackChanges();
			
			return this.trigger();
		}else {
			console.warn("Pagination Error - Requested page is out of range of 1 - " + this.max + ":", page);
			return Promise.reject();
		}
	}
	
	setPageToRow(row){
		var rows = this.displayRows(-1);
		var index = rows.indexOf(row);
	
		if(index > -1){
			var page = this.size === true ? 1 : Math.ceil((index + 1) / this.size);
			
			return this.setPage(page);
		}else {
			console.warn("Pagination Error - Requested row is not visible");
			return Promise.reject();
		}
	}
	
	setPageSize(size){
		if(size !== true){
			size = parseInt(size);
		}

		if(size > 0){
			this.size = size;
			this.dispatchExternal("pageSizeChanged", size);
		}
		
		if(this.pageSizeSelect){
			// this.pageSizeSelect.value = size;
			this.generatePageSizeSelectList();
		}
		
		this.trackChanges();
	}
	
	_setPageCounter(totalRows, size, currentRow){
		var content;
		
		if(this.pageCounter){

			if(this.mode === "remote"){
				size = this.size;
				currentRow = ((this.page - 1) * this.size) + 1;
				totalRows = this.remoteRowCountEstimate;
			}

			content = this.pageCounter.call(this, size, currentRow, this.page, totalRows, this.max);
			
			switch(typeof content){
				case "object":
					if(content instanceof Node){
					
						//clear previous cell contents
						while(this.pageCounterElement.firstChild) this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);
					
						this.pageCounterElement.appendChild(content);
					}else {
						this.pageCounterElement.innerHTML = "";
					
						if(content != null){
							console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:", content);
						}
					}
					break;
				case "undefined":
					this.pageCounterElement.innerHTML = "";
					break;
				default:
					this.pageCounterElement.innerHTML = content;
			}
		}
	}
	
	//setup the pagination buttons
	_setPageButtons(){
		let leftSize = Math.floor((this.count-1) / 2);
		let rightSize = Math.ceil((this.count-1) / 2);
		let min = this.max - this.page + leftSize + 1 < this.count ? this.max-this.count+1: Math.max(this.page-leftSize,1);
		let max = this.page <= rightSize? Math.min(this.count, this.max) :Math.min(this.page+rightSize, this.max);
		
		while(this.pagesElement.firstChild) this.pagesElement.removeChild(this.pagesElement.firstChild);
		
		if(this.page == 1){
			this.firstBut.disabled = true;
			this.prevBut.disabled = true;
		}else {
			this.firstBut.disabled = false;
			this.prevBut.disabled = false;
		}
		
		if(this.page == this.max){
			this.lastBut.disabled = true;
			this.nextBut.disabled = true;
		}else {
			this.lastBut.disabled = false;
			this.nextBut.disabled = false;
		}
		
		for(let i = min; i <= max; i++){
			if(i>0 && i <= this.max){
				this.pagesElement.appendChild(this._generatePageButton(i));
			}
		}
		
		this.footerRedraw();
	}
	
	_generatePageButton(page){
		var button = document.createElement("button");
		
		button.classList.add("tabulator-page");
		if(page == this.page){
			button.classList.add("active");
		}
		
		button.setAttribute("type", "button");
		button.setAttribute("role", "button");
		
		this.langBind("pagination|page_title", (value) => {
			button.setAttribute("aria-label", value + " " + page);
			button.setAttribute("title", value + " " + page);
		});
		
		button.setAttribute("data-page", page);
		button.textContent = page;
		
		button.addEventListener("click", (e) => {
			this.setPage(page);
		});
		
		return button;
	}
	
	//previous page
	previousPage(){
		if(this.page > 1){
			this.page--;
			
			this.trackChanges();
			
			return this.trigger();
			
		}else {
			console.warn("Pagination Error - Previous page would be less than page 1:", 0);
			return Promise.reject();
		}
	}
	
	//next page
	nextPage(){
		if(this.page < this.max){
			this.page++;
			
			this.trackChanges();
			
			return this.trigger();
			
		}else {
			if(!this.progressiveLoad){
				console.warn("Pagination Error - Next page would be greater than maximum page of " + this.max + ":", this.max + 1);
			}
			return Promise.reject();
		}
	}
	
	//return current page number
	getPage(){
		return this.page;
	}
	
	//return max page number
	getPageMax(){
		return this.max;
	}
	
	getPageSize(size){
		return this.size;
	}
	
	getMode(){
		return this.mode;
	}
	
	//return appropriate rows for current page
	getRows(data){
		var actualRowPageSize = 0,
		output, start, end, actualStartRow;

		var actualRows = data.filter((row) => {
			return row.type === "row";
		});
		
		if(this.mode == "local"){
			output = [];
			
			this.setMaxRows(data.length);
			
			if(this.size === true){
				start = 0;
				end = data.length;
			}else {
				start = this.size * (this.page - 1);
				end = start + parseInt(this.size);
			}
			
			this._setPageButtons();
			
			for(let i = start; i < end; i++){
				let row = data[i];

				if(row){
					output.push(row);

					if(row.type === "row"){
						if(!actualStartRow){
							actualStartRow = row;
						}	

						actualRowPageSize++;
					}
				}
			}
			
			this._setPageCounter(actualRows.length, actualRowPageSize, actualStartRow ? (actualRows.indexOf(actualStartRow) + 1) : 0);
			
			return output;
		}else {
			this._setPageButtons();
			this._setPageCounter(actualRows.length);
			
			return data.slice(0);
		}
	}
	
	trigger(){
		var left;
		
		switch(this.mode){
			case "local":
				left = this.table.rowManager.scrollLeft;
			
				this.refreshData();
				this.table.rowManager.scrollHorizontal(left);
			
				this.dispatchExternal("pageLoaded", this.getPage());
			
				return Promise.resolve();
			
			case "remote":
				this.dataChanging = true;
				return this.reloadData(null)
					.finally(() => {
						this.dataChanging = false;
					});
			
			case "progressive_load":
			case "progressive_scroll":
				return this.reloadData(null, true);
			
			default:
				console.warn("Pagination Error - no such pagination mode:", this.mode);
				return Promise.reject();
		}
	}
	
	_parseRemoteData(data){
		var margin, paginationOutOfRange;
		
		if(typeof data.last_page === "undefined"){
			console.warn("Remote Pagination Error - Server response missing '" + (this.options("dataReceiveParams").last_page || "last_page") + "' property");
		}
		
		if(data.data){
			this.max = parseInt(data.last_page) || 1;

			this.remoteRowCountEstimate = typeof data.last_row !== "undefined" ? data.last_row : (data.last_page * this.size - (this.page == data.last_page ? (this.size - data.data.length) : 0));
			
			if(this.progressiveLoad){
				switch(this.mode){
					case "progressive_load":
					
						if(this.page == 1){
							this.table.rowManager.setData(data.data, false, this.page == 1);
						}else {
							this.table.rowManager.addRows(data.data);
						}
					
						if(this.page < this.max){
							setTimeout(() => {
								this.nextPage();
							}, this.table.options.progressiveLoadDelay);
						}
						break;
					
					case "progressive_scroll":
						data = this.page === 1 ? data.data : this.table.rowManager.getData().concat(data.data);
					
						this.table.rowManager.setData(data, this.page !== 1, this.page == 1);
					
						margin = this.table.options.progressiveLoadScrollMargin || (this.table.rowManager.element.clientHeight * 2);
					
						if(this.table.rowManager.element.scrollHeight <= (this.table.rowManager.element.clientHeight + margin)){
							if(this.page < this.max){
								setTimeout(() => {
									this.nextPage();
								});
							}
						}
						break;
				}
				
				return false;
			}else {

				if(this.page > this.max){
					console.warn( "Remote Pagination Error - Server returned last page value lower than the current page" );

					paginationOutOfRange = this.options('paginationOutOfRange');

					if(paginationOutOfRange){
						return this.setPage(typeof paginationOutOfRange === 'function' ? paginationOutOfRange.call(this, this.page, this.max) :	paginationOutOfRange);
					}
				}

				// left = this.table.rowManager.scrollLeft;
				this.dispatchExternal("pageLoaded",  this.getPage());
				// this.table.rowManager.scrollHorizontal(left);
				// this.table.columnManager.scrollHorizontal(left);
			}
			
		}else {
			console.warn("Remote Pagination Error - Server response missing '" + (this.options("dataReceiveParams").data || "data") + "' property");
		}
		
		return data.data;
	}
	
	//handle the footer element being redrawn
	footerRedraw(){
		var footer = this.table.footerManager.containerElement;

		if((Math.ceil(footer.clientWidth) - footer.scrollWidth) < 0){
			this.pagesElement.style.display = 'none';
		}else {
			this.pagesElement.style.display = '';
			
			if((Math.ceil(footer.clientWidth) - footer.scrollWidth) < 0){
				this.pagesElement.style.display = 'none';
			}
		}
	}
}

// read persistance information from storage
var defaultReaders = {
	local:function(id, type){
		var data = localStorage.getItem(id + "-" + type);

		return data ? JSON.parse(data) : false;
	},
	cookie:function(id, type){
		var cookie = document.cookie,
		key = id + "-" + type,
		cookiePos = cookie.indexOf(key + "="),
		end, data;

		//if cookie exists, decode and load column data into tabulator
		if(cookiePos > -1){
			cookie = cookie.slice(cookiePos);

			end = cookie.indexOf(";");

			if(end > -1){
				cookie = cookie.slice(0, end);
			}

			data = cookie.replace(key + "=", "");
		}

		return data ? JSON.parse(data) : false;
	}
};

//write persistence information to storage
var defaultWriters = {
	local:function(id, type, data){
		localStorage.setItem(id + "-" + type, JSON.stringify(data));
	},
	cookie:function(id, type, data){
		var expireDate = new Date();

		expireDate.setDate(expireDate.getDate() + 10000);

		document.cookie = id + "-" + type + "=" + JSON.stringify(data) + "; expires=" + expireDate.toUTCString();
	}
};

class Persistence extends Module{

	static moduleName = "persistence";

	static moduleInitOrder = -10;

	//load defaults
	static readers = defaultReaders;
	static writers = defaultWriters;

	constructor(table){
		super(table);

		this.mode = "";
		this.id = "";
		// this.persistProps = ["field", "width", "visible"];
		this.defWatcherBlock = false;
		this.config = {};
		this.readFunc = false;
		this.writeFunc = false;

		this.registerTableOption("persistence", false);
		this.registerTableOption("persistenceID", ""); //key for persistent storage
		this.registerTableOption("persistenceMode", true); //mode for storing persistence information
		this.registerTableOption("persistenceReaderFunc", false); //function for handling persistence data reading
		this.registerTableOption("persistenceWriterFunc", false); //function for handling persistence data writing
	}

	// Test for whether localStorage is available for use.
	localStorageTest() {
		var  testKey =  "_tabulator_test";

		try {
			window.localStorage.setItem( testKey, testKey);
			window.localStorage.removeItem( testKey );
			return true;
		} catch(e) {
			return false;
		}
	}

	//setup parameters
	initialize(){
		if(this.table.options.persistence){
			//determine persistent layout storage type
			var mode = this.table.options.persistenceMode,
			id = this.table.options.persistenceID,
			retrievedData;

			this.mode = mode !== true ?  mode : (this.localStorageTest() ? "local" : "cookie");

			if(this.table.options.persistenceReaderFunc){
				if(typeof this.table.options.persistenceReaderFunc === "function"){
					this.readFunc = this.table.options.persistenceReaderFunc;
				}else {
					if(Persistence.readers[this.table.options.persistenceReaderFunc]){
						this.readFunc = Persistence.readers[this.table.options.persistenceReaderFunc];
					}else {
						console.warn("Persistence Read Error - invalid reader set", this.table.options.persistenceReaderFunc);
					}
				}
			}else {
				if(Persistence.readers[this.mode]){
					this.readFunc = Persistence.readers[this.mode];
				}else {
					console.warn("Persistence Read Error - invalid reader set", this.mode);
				}
			}

			if(this.table.options.persistenceWriterFunc){
				if(typeof this.table.options.persistenceWriterFunc === "function"){
					this.writeFunc = this.table.options.persistenceWriterFunc;
				}else {
					if(Persistence.writers[this.table.options.persistenceWriterFunc]){
						this.writeFunc = Persistence.writers[this.table.options.persistenceWriterFunc];
					}else {
						console.warn("Persistence Write Error - invalid reader set", this.table.options.persistenceWriterFunc);
					}
				}
			}else {
				if(Persistence.writers[this.mode]){
					this.writeFunc = Persistence.writers[this.mode];
				}else {
					console.warn("Persistence Write Error - invalid writer set", this.mode);
				}
			}

			//set storage tag
			this.id = "tabulator-" + (id || (this.table.element.getAttribute("id") || ""));

			this.config = {
				sort:this.table.options.persistence === true || this.table.options.persistence.sort,
				filter:this.table.options.persistence === true || this.table.options.persistence.filter,
				headerFilter:this.table.options.persistence === true || this.table.options.persistence.headerFilter,
				group:this.table.options.persistence === true || this.table.options.persistence.group,
				page:this.table.options.persistence === true || this.table.options.persistence.page,
				columns:this.table.options.persistence === true ? ["title", "width", "visible"] : this.table.options.persistence.columns,
			};

			//load pagination data if needed
			if(this.config.page){
				retrievedData = this.retrieveData("page");

				if(retrievedData){
					if(typeof retrievedData.paginationSize !== "undefined" && (this.config.page === true || this.config.page.size)){
						this.table.options.paginationSize = retrievedData.paginationSize;
					}

					if(typeof retrievedData.paginationInitialPage !== "undefined" && (this.config.page === true || this.config.page.page)){
						this.table.options.paginationInitialPage = retrievedData.paginationInitialPage;
					}
				}
			}

			//load group data if needed
			if(this.config.group){
				retrievedData = this.retrieveData("group");

				if(retrievedData){
					if(typeof retrievedData.groupBy !== "undefined" && (this.config.group === true || this.config.group.groupBy)){
						this.table.options.groupBy = retrievedData.groupBy;
					}
					if(typeof retrievedData.groupStartOpen !== "undefined" && (this.config.group === true || this.config.group.groupStartOpen)){
						this.table.options.groupStartOpen = retrievedData.groupStartOpen;
					}
					if(typeof retrievedData.groupHeader !== "undefined" && (this.config.group === true || this.config.group.groupHeader)){
						this.table.options.groupHeader = retrievedData.groupHeader;
					}
				}
			}

			if(this.config.columns){
				this.table.options.columns = this.load("columns", this.table.options.columns);
				this.subscribe("column-init", this.initializeColumn.bind(this));
				this.subscribe("column-show", this.save.bind(this, "columns"));
				this.subscribe("column-hide", this.save.bind(this, "columns"));
				this.subscribe("column-moved", this.save.bind(this, "columns"));
			}

			this.subscribe("table-built", this.tableBuilt.bind(this), 0);

			this.subscribe("table-redraw", this.tableRedraw.bind(this));

			this.subscribe("filter-changed", this.eventSave.bind(this, "filter"));
			this.subscribe("filter-changed", this.eventSave.bind(this, "headerFilter"));
			this.subscribe("sort-changed", this.eventSave.bind(this, "sort"));
			this.subscribe("group-changed", this.eventSave.bind(this, "group"));
			this.subscribe("page-changed", this.eventSave.bind(this, "page"));
			this.subscribe("column-resized", this.eventSave.bind(this, "columns"));
			this.subscribe("column-width", this.eventSave.bind(this, "columns"));
			this.subscribe("layout-refreshed", this.eventSave.bind(this, "columns"));
		}

		this.registerTableFunction("getColumnLayout", this.getColumnLayout.bind(this));
		this.registerTableFunction("setColumnLayout", this.setColumnLayout.bind(this));
	}

	eventSave(type){
		if(this.config[type]){
			this.save(type);
		}
	}

	tableBuilt(){
		var sorters, filters, headerFilters;

		if(this.config.sort){
			sorters = this.load("sort");

			if(!sorters === false){
				this.table.options.initialSort = sorters;
			}
		}

		if(this.config.filter){
			filters = this.load("filter");

			if(!filters === false){
				this.table.options.initialFilter = filters;
			}
		}
		if(this.config.headerFilter){
			headerFilters = this.load("headerFilter");

			if(!headerFilters === false){
				this.table.options.initialHeaderFilter = headerFilters;
			}
		}
		
	}

	tableRedraw(force){
		if(force && this.config.columns){
			this.save("columns");
		}
	}

	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////

	getColumnLayout(){
		return this.parseColumns(this.table.columnManager.getColumns());
	}

	setColumnLayout(layout){
		this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns, layout, true));
		return true;
	}

	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////

	initializeColumn(column){
		var def, keys;

		if(this.config.columns){
			this.defWatcherBlock = true;

			def = column.getDefinition();

			keys = this.config.columns === true ? Object.keys(def) : this.config.columns;

			keys.forEach((key)=>{
				var props = Object.getOwnPropertyDescriptor(def, key);
				var value = def[key];

				if(props){
					Object.defineProperty(def, key, {
						set: (newValue) => {
							value = newValue;

							if(!this.defWatcherBlock){
								this.save("columns");
							}

							if(props.set){
								props.set(newValue);
							}
						},
						get:() => {
							if(props.get){
								props.get();
							}
							return value;
						}
					});
				}
			});

			this.defWatcherBlock = false;
		}
	}

	//load saved definitions
	load(type, current){
		var data = this.retrieveData(type);

		if(current){
			data = data ? this.mergeDefinition(current, data) : current;
		}

		return data;
	}

	//retrieve data from memory
	retrieveData(type){
		return this.readFunc ? this.readFunc(this.id, type) : false;
	}

	//merge old and new column definitions
	mergeDefinition(oldCols, newCols, mergeAllNew){
		var output = [];

		newCols = newCols || [];

		newCols.forEach((column, to) => {
			var from = this._findColumn(oldCols, column),
			keys;

			if(from){
				if(mergeAllNew){
					keys = Object.keys(column);
				}else if(this.config.columns === true || this.config.columns == undefined){
					keys =  Object.keys(from);
					keys.push("width");
				}else {
					keys = this.config.columns;
				}

				keys.forEach((key)=>{
					if(key !== "columns" && typeof column[key] !== "undefined"){
						from[key] = column[key];
					}
				});

				if(from.columns){
					from.columns = this.mergeDefinition(from.columns, column.columns);
				}

				output.push(from);
			}
		});

		oldCols.forEach((column, i) => {
			var from = this._findColumn(newCols, column);

			if (!from) {
				if(output.length>i){
					output.splice(i, 0, column);
				}else {
					output.push(column);
				}
			}
		});

		return output;
	}

	//find matching columns
	_findColumn(columns, subject){
		var type = subject.columns ? "group" : (subject.field ? "field" : "object");

		return columns.find(function(col){
			switch(type){
				case "group":
					return col.title === subject.title && col.columns.length === subject.columns.length;

				case "field":
					return col.field === subject.field;

				case "object":
					return col === subject;
			}
		});
	}

	//save data
	save(type){
		var data = {};

		switch(type){
			case "columns":
				data = this.parseColumns(this.table.columnManager.getColumns());
				break;

			case "filter":
				data = this.table.modules.filter.getFilters();
				break;

			case "headerFilter":
				data = this.table.modules.filter.getHeaderFilters();
				break;

			case "sort":
				data = this.validateSorters(this.table.modules.sort.getSort());
				break;

			case "group":
				data = this.getGroupConfig();
				break;

			case "page":
				data = this.getPageConfig();
				break;
		}

		if(this.writeFunc){
			this.writeFunc(this.id, type, data);
		}

	}

	//ensure sorters contain no function data
	validateSorters(data){
		data.forEach(function(item){
			item.column = item.field;
			delete item.field;
		});

		return data;
	}

	getGroupConfig(){
		var data = {};

		if(this.config.group){
			if(this.config.group === true || this.config.group.groupBy){
				data.groupBy = this.table.options.groupBy;
			}

			if(this.config.group === true || this.config.group.groupStartOpen){
				data.groupStartOpen = this.table.options.groupStartOpen;
			}

			if(this.config.group === true || this.config.group.groupHeader){
				data.groupHeader = this.table.options.groupHeader;
			}
		}

		return data;
	}

	getPageConfig(){
		var data = {};

		if(this.config.page){
			if(this.config.page === true || this.config.page.size){
				data.paginationSize = this.table.modules.page.getPageSize();
			}

			if(this.config.page === true || this.config.page.page){
				data.paginationInitialPage = this.table.modules.page.getPage();
			}
		}

		return data;
	}


	//parse columns for data to store
	parseColumns(columns){
		var definitions = [],
		excludedKeys = ["headerContextMenu", "headerMenu", "contextMenu", "clickMenu"];

		columns.forEach((column) => {
			var defStore = {},
			colDef = column.getDefinition(),
			keys;

			if(column.isGroup){
				defStore.title = colDef.title;
				defStore.columns = this.parseColumns(column.getColumns());
			}else {
				defStore.field = column.getField();

				if(this.config.columns === true || this.config.columns == undefined){
					keys =  Object.keys(colDef);
					keys.push("width");
					keys.push("visible");
				}else {
					keys = this.config.columns;
				}

				keys.forEach((key)=>{
					switch(key){
						case "width":
							defStore.width = column.getWidth();
							break;
						case "visible":
							defStore.visible = column.visible;
							break;

						default:
							if(typeof colDef[key] !== "function" && excludedKeys.indexOf(key) === -1){
								defStore[key] = colDef[key];
							}
					}
				});
			}

			definitions.push(defStore);
		});

		return definitions;
	}
}

class Popup extends Module{
	
	static moduleName = "popup";
	
	constructor(table){
		super(table);
		
		this.columnSubscribers = {};
		
		this.registerTableOption("rowContextPopup", false);
		this.registerTableOption("rowClickPopup", false);
		this.registerTableOption("rowDblClickPopup", false);
		this.registerTableOption("groupContextPopup", false);
		this.registerTableOption("groupClickPopup", false);
		this.registerTableOption("groupDblClickPopup", false);
		
		this.registerColumnOption("headerContextPopup");
		this.registerColumnOption("headerClickPopup");
		this.registerColumnOption("headerDblClickPopup");
		this.registerColumnOption("headerPopup");
		this.registerColumnOption("headerPopupIcon");
		this.registerColumnOption("contextPopup");
		this.registerColumnOption("clickPopup");
		this.registerColumnOption("dblClickPopup");

		this.registerComponentFunction("cell", "popup", this._componentPopupCall.bind(this));
		this.registerComponentFunction("column", "popup", this._componentPopupCall.bind(this));
		this.registerComponentFunction("row", "popup", this._componentPopupCall.bind(this));
		this.registerComponentFunction("group", "popup", this._componentPopupCall.bind(this));
		
	}
	
	initialize(){
		this.initializeRowWatchers();
		this.initializeGroupWatchers();
		
		this.subscribe("column-init", this.initializeColumn.bind(this));
	}

	_componentPopupCall(component, contents, position){
		this.loadPopupEvent(contents, null, component, position);
	}
	
	initializeRowWatchers(){
		if(this.table.options.rowContextPopup){
			this.subscribe("row-contextmenu", this.loadPopupEvent.bind(this, this.table.options.rowContextPopup));
			this.table.on("rowTapHold", this.loadPopupEvent.bind(this, this.table.options.rowContextPopup));
		}
		
		if(this.table.options.rowClickPopup){
			this.subscribe("row-click", this.loadPopupEvent.bind(this, this.table.options.rowClickPopup));
		}

		if(this.table.options.rowDblClickPopup){
			this.subscribe("row-dblclick", this.loadPopupEvent.bind(this, this.table.options.rowDblClickPopup));
		}
	}
	
	initializeGroupWatchers(){
		if(this.table.options.groupContextPopup){
			this.subscribe("group-contextmenu", this.loadPopupEvent.bind(this, this.table.options.groupContextPopup));
			this.table.on("groupTapHold", this.loadPopupEvent.bind(this, this.table.options.groupContextPopup));
		}
		
		if(this.table.options.groupClickPopup){
			this.subscribe("group-click", this.loadPopupEvent.bind(this, this.table.options.groupClickPopup));
		}

		if(this.table.options.groupDblClickPopup){
			this.subscribe("group-dblclick", this.loadPopupEvent.bind(this, this.table.options.groupDblClickPopup));
		}
	}

	initializeColumn(column){
		var def = column.definition;
		
		//handle column events
		if(def.headerContextPopup && !this.columnSubscribers.headerContextPopup){
			this.columnSubscribers.headerContextPopup = this.loadPopupTableColumnEvent.bind(this, "headerContextPopup");
			this.subscribe("column-contextmenu", this.columnSubscribers.headerContextPopup);
			this.table.on("headerTapHold", this.loadPopupTableColumnEvent.bind(this, "headerContextPopup"));
		}
		
		if(def.headerClickPopup && !this.columnSubscribers.headerClickPopup){
			this.columnSubscribers.headerClickPopup = this.loadPopupTableColumnEvent.bind(this, "headerClickPopup");
			this.subscribe("column-click", this.columnSubscribers.headerClickPopup);
		
		
		}if(def.headerDblClickPopup && !this.columnSubscribers.headerDblClickPopup){
			this.columnSubscribers.headerDblClickPopup = this.loadPopupTableColumnEvent.bind(this, "headerDblClickPopup");
			this.subscribe("column-dblclick", this.columnSubscribers.headerDblClickPopup);
		}
		
		if(def.headerPopup){
			this.initializeColumnHeaderPopup(column);
		}
		
		//handle cell events
		if(def.contextPopup && !this.columnSubscribers.contextPopup){
			this.columnSubscribers.contextPopup = this.loadPopupTableCellEvent.bind(this, "contextPopup");
			this.subscribe("cell-contextmenu", this.columnSubscribers.contextPopup);
			this.table.on("cellTapHold", this.loadPopupTableCellEvent.bind(this, "contextPopup"));
		}
		
		if(def.clickPopup && !this.columnSubscribers.clickPopup){
			this.columnSubscribers.clickPopup = this.loadPopupTableCellEvent.bind(this, "clickPopup");
			this.subscribe("cell-click", this.columnSubscribers.clickPopup);
		}

		if(def.dblClickPopup && !this.columnSubscribers.dblClickPopup){
			this.columnSubscribers.dblClickPopup = this.loadPopupTableCellEvent.bind(this, "dblClickPopup");
			this.subscribe("cell-click", this.columnSubscribers.dblClickPopup);
		}
	}
	
	initializeColumnHeaderPopup(column){
		var icon = column.definition.headerPopupIcon,
		headerPopupEl;
		
		headerPopupEl = document.createElement("span");
		headerPopupEl.classList.add("tabulator-header-popup-button");

		if(icon){
			if(typeof icon === "function"){
				icon = icon(column.getComponent());
			}

			if(icon instanceof HTMLElement){
				headerPopupEl.appendChild(icon);
			}else {
				headerPopupEl.innerHTML = icon;
			}
		}else {
			headerPopupEl.innerHTML = "&vellip;";
		}
		
		headerPopupEl.addEventListener("click", (e) => {
			e.stopPropagation();
			e.preventDefault();
			
			this.loadPopupEvent(column.definition.headerPopup, e, column);
		});
		
		column.titleElement.insertBefore(headerPopupEl, column.titleElement.firstChild);
	}
	
	loadPopupTableCellEvent(option, e, cell){
		if(cell._cell){
			cell = cell._cell;
		}
		
		if(cell.column.definition[option]){
			this.loadPopupEvent(cell.column.definition[option], e, cell);
		}
	}
	
	loadPopupTableColumnEvent(option, e, column){
		if(column._column){
			column = column._column;
		}
		
		if(column.definition[option]){
			this.loadPopupEvent(column.definition[option], e, column);
		}
	}
	
	loadPopupEvent(contents, e, component, position){
		var renderedCallback;

		function onRendered(callback){
			renderedCallback = callback;
		}
		
		if(component._group){
			component = component._group;
		}else if(component._row){
			component = component._row;
		}
		
		contents = typeof contents == "function" ? contents.call(this.table, e, component.getComponent(),  onRendered) : contents;
		
		this.loadPopup(e, component, contents, renderedCallback, position);
	}
	
	loadPopup(e, component, contents, renderedCallback, position){
		var touch = !(e instanceof MouseEvent),
		contentsEl, popup;
		
		if(contents instanceof HTMLElement){
			contentsEl = contents;
		}else {
			contentsEl = document.createElement("div");
			contentsEl.innerHTML = contents;
		}
		
		contentsEl.classList.add("tabulator-popup");

		contentsEl.addEventListener("click", (e) =>{
			e.stopPropagation();
		});

		if(!touch){
			e.preventDefault();
		}
		
		popup = this.popup(contentsEl);

		if(typeof renderedCallback === "function"){
			popup.renderCallback(renderedCallback);
		}

		if(e){
			popup.show(e);
		}else {
			popup.show(component.getElement(), position || "center");
		}

		
		popup.hideOnBlur(() => {
			this.dispatchExternal("popupClosed", component.getComponent());
		});

		this.dispatchExternal("popupOpened", component.getComponent());
	}
}

class Print extends Module{

	static moduleName = "print";

	constructor(table){
		super(table);

		this.element = false;
		this.manualBlock = false;
		this.beforeprintEventHandler = null;
		this.afterprintEventHandler = null;

		this.registerTableOption("printAsHtml", false); //enable print as html
		this.registerTableOption("printFormatter", false); //printing page formatter
		this.registerTableOption("printHeader", false); //page header contents
		this.registerTableOption("printFooter", false); //page footer contents
		this.registerTableOption("printStyled", true); //enable print as html styling
		this.registerTableOption("printRowRange", "visible"); //restrict print to visible rows only
		this.registerTableOption("printConfig", {}); //print config options

		this.registerColumnOption("print");
		this.registerColumnOption("titlePrint");
	}

	initialize(){
		if(this.table.options.printAsHtml){
			this.beforeprintEventHandler = this.replaceTable.bind(this);
			this.afterprintEventHandler = this.cleanup.bind(this);

			window.addEventListener("beforeprint", this.beforeprintEventHandler );
			window.addEventListener("afterprint", this.afterprintEventHandler);
			this.subscribe("table-destroy", this.destroy.bind(this));
		}

		this.registerTableFunction("print", this.printFullscreen.bind(this));
	}

	destroy(){
		if(this.table.options.printAsHtml){
			window.removeEventListener( "beforeprint", this.beforeprintEventHandler );
			window.removeEventListener( "afterprint", this.afterprintEventHandler );
		}
	}

	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////

	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////

	replaceTable(){
		if(!this.manualBlock){
			this.element = document.createElement("div");
			this.element.classList.add("tabulator-print-table");

			this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig, this.table.options.printStyled, this.table.options.printRowRange, "print"));

			this.table.element.style.display = "none";

			this.table.element.parentNode.insertBefore(this.element, this.table.element);
		}
	}

	cleanup(){
		document.body.classList.remove("tabulator-print-fullscreen-hide");

		if(this.element && this.element.parentNode){
			this.element.parentNode.removeChild(this.element);
			this.table.element.style.display = "";
		}
	}

	printFullscreen(visible, style, config){
		var scrollX = window.scrollX,
		scrollY = window.scrollY,
		headerEl = document.createElement("div"),
		footerEl = document.createElement("div"),
		tableEl = this.table.modules.export.generateTable(typeof config != "undefined" ? config : this.table.options.printConfig, typeof style != "undefined" ? style : this.table.options.printStyled, visible || this.table.options.printRowRange, "print"),
		headerContent, footerContent;

		this.manualBlock = true;

		this.element = document.createElement("div");
		this.element.classList.add("tabulator-print-fullscreen");

		if(this.table.options.printHeader){
			headerEl.classList.add("tabulator-print-header");

			headerContent = typeof this.table.options.printHeader == "function" ? this.table.options.printHeader.call(this.table) : this.table.options.printHeader;

			if(typeof headerContent == "string"){
				headerEl.innerHTML = headerContent;
			}else {
				headerEl.appendChild(headerContent);
			}

			this.element.appendChild(headerEl);
		}

		this.element.appendChild(tableEl);

		if(this.table.options.printFooter){
			footerEl.classList.add("tabulator-print-footer");

			footerContent = typeof this.table.options.printFooter == "function" ? this.table.options.printFooter.call(this.table) : this.table.options.printFooter;


			if(typeof footerContent == "string"){
				footerEl.innerHTML = footerContent;
			}else {
				footerEl.appendChild(footerContent);
			}

			this.element.appendChild(footerEl);
		}

		document.body.classList.add("tabulator-print-fullscreen-hide");
		document.body.appendChild(this.element);

		if(this.table.options.printFormatter){
			this.table.options.printFormatter(this.element, tableEl);
		}

		window.print();

		this.cleanup();

		window.scrollTo(scrollX, scrollY);

		this.manualBlock = false;
	}
}

class ReactiveData extends Module{

	static moduleName = "reactiveData";
	
	constructor(table){
		super(table);
		
		this.data = false;
		this.blocked = false; //block reactivity while performing update
		this.origFuncs = {}; // hold original data array functions to allow replacement after data is done with
		this.currentVersion = 0;
		
		this.registerTableOption("reactiveData", false); //enable data reactivity
	}
	
	initialize(){
		if(this.table.options.reactiveData){
			this.subscribe("cell-value-save-before", this.block.bind(this, "cellsave"));
			this.subscribe("cell-value-save-after", this.unblock.bind(this, "cellsave"));
			this.subscribe("row-data-save-before", this.block.bind(this, "rowsave"));
			this.subscribe("row-data-save-after", this.unblock.bind(this, "rowsave"));
			this.subscribe("row-data-init-after", this.watchRow.bind(this));
			this.subscribe("data-processing", this.watchData.bind(this));
			this.subscribe("table-destroy", this.unwatchData.bind(this));
		}
	}
	
	watchData(data){
		var self = this,
		version;
		
		this.currentVersion ++;
		
		version = this.currentVersion;
		
		this.unwatchData();
		
		this.data = data;
		
		//override array push function
		this.origFuncs.push = data.push;
		
		Object.defineProperty(this.data, "push", {
			enumerable: false,
			configurable: true,
			value: function(){
				var args = Array.from(arguments),
				result;

				if(!self.blocked && version === self.currentVersion){	
					self.block("data-push");

					args.forEach((arg) => {
						self.table.rowManager.addRowActual(arg, false);
					});
					
					result = self.origFuncs.push.apply(data, arguments);
					
					self.unblock("data-push");
				}
				
				return result;
			}
		});
		
		//override array unshift function
		this.origFuncs.unshift = data.unshift;
		
		Object.defineProperty(this.data, "unshift", {
			enumerable: false,
			configurable: true,
			value: function(){
				var args = Array.from(arguments),
				result;
				
				if(!self.blocked && version === self.currentVersion){
					self.block("data-unshift");
					
					args.forEach((arg) => {
						self.table.rowManager.addRowActual(arg, true);
					});
					
					result = self.origFuncs.unshift.apply(data, arguments);
					
					self.unblock("data-unshift");
				}
				
				return result;
			}
		});
		
		
		//override array shift function
		this.origFuncs.shift = data.shift;
		
		Object.defineProperty(this.data, "shift", {
			enumerable: false,
			configurable: true,
			value: function(){
				var row, result;
				
				if(!self.blocked && version === self.currentVersion){
					self.block("data-shift");
					
					if(self.data.length){
						row = self.table.rowManager.getRowFromDataObject(self.data[0]);
						
						if(row){
							row.deleteActual();
						}
					}

					result = self.origFuncs.shift.call(data);

					self.unblock("data-shift");
				}
				
				return result;
			}
		});
		
		//override array pop function
		this.origFuncs.pop = data.pop;
		
		Object.defineProperty(this.data, "pop", {
			enumerable: false,
			configurable: true,
			value: function(){
				var row, result;
			
				if(!self.blocked && version === self.currentVersion){
					self.block("data-pop");
					
					if(self.data.length){
						row = self.table.rowManager.getRowFromDataObject(self.data[self.data.length - 1]);
						
						if(row){
							row.deleteActual();
						}
					}

					result = self.origFuncs.pop.call(data);
					
					self.unblock("data-pop");
				}

				return result;
			}
		});
		
		
		//override array splice function
		this.origFuncs.splice = data.splice;
		
		Object.defineProperty(this.data, "splice", {
			enumerable: false,
			configurable: true,
			value: function(){
				var args = Array.from(arguments),
				start = args[0] < 0 ? data.length + args[0] : args[0],
				end = args[1],
				newRows = args[2] ? args.slice(2) : false,
				startRow, result;
				
				if(!self.blocked && version === self.currentVersion){
					self.block("data-splice");
					//add new rows
					if(newRows){
						startRow = data[start] ? self.table.rowManager.getRowFromDataObject(data[start]) : false;
						
						if(startRow){
							newRows.forEach((rowData) => {
								self.table.rowManager.addRowActual(rowData, true, startRow, true);
							});
						}else {
							newRows = newRows.slice().reverse();
							
							newRows.forEach((rowData) => {
								self.table.rowManager.addRowActual(rowData, true, false, true);
							});
						}
					}
					
					//delete removed rows
					if(end !== 0){
						var oldRows = data.slice(start, typeof args[1] === "undefined" ? args[1] : start + end);
						
						oldRows.forEach((rowData, i) => {
							var row = self.table.rowManager.getRowFromDataObject(rowData);
							
							if(row){
								row.deleteActual(i !== oldRows.length - 1);
							}
						});
					}
					
					if(newRows || end !== 0){
						self.table.rowManager.reRenderInPosition();
					}

					result = self.origFuncs.splice.apply(data, arguments);
					
					self.unblock("data-splice");
				}
				
				return result ;
			}
		});
	}
	
	unwatchData(){
		if(this.data !== false){
			for(var key in this.origFuncs){
				Object.defineProperty(this.data, key, {
					enumerable: true,
					configurable:true,
					writable:true,
					value: this.origFuncs.key,
				});
			}
		}
	}
	
	watchRow(row){
		var data = row.getData();
		
		for(var key in data){
			this.watchKey(row, data, key);
		}
		
		if(this.table.options.dataTree){
			this.watchTreeChildren(row);
		}
	}
	
	watchTreeChildren (row){
		var self = this,
		childField = row.getData()[this.table.options.dataTreeChildField],
		origFuncs = {};
		
		if(childField){
			
			origFuncs.push = childField.push;
			
			Object.defineProperty(childField, "push", {
				enumerable: false,
				configurable: true,
				value: () => {
					if(!self.blocked){
						self.block("tree-push");
						
						var result = origFuncs.push.apply(childField, arguments);
						this.rebuildTree(row);
						
						self.unblock("tree-push");
					}
					
					return result;
				}
			});
			
			origFuncs.unshift = childField.unshift;
			
			Object.defineProperty(childField, "unshift", {
				enumerable: false,
				configurable: true,
				value: () => {
					if(!self.blocked){
						self.block("tree-unshift");
						
						var result =  origFuncs.unshift.apply(childField, arguments);
						this.rebuildTree(row);
						
						self.unblock("tree-unshift");
					}
					
					return result;
				}
			});
			
			origFuncs.shift = childField.shift;
			
			Object.defineProperty(childField, "shift", {
				enumerable: false,
				configurable: true,
				value: () => {
					if(!self.blocked){
						self.block("tree-shift");
						
						var result =  origFuncs.shift.call(childField);
						this.rebuildTree(row);
						
						self.unblock("tree-shift");
					}
					
					return result;
				}
			});
			
			origFuncs.pop = childField.pop;
			
			Object.defineProperty(childField, "pop", {
				enumerable: false,
				configurable: true,
				value: () => {
					if(!self.blocked){
						self.block("tree-pop");
						
						var result =  origFuncs.pop.call(childField);
						this.rebuildTree(row);
						
						self.unblock("tree-pop");
					}
					
					return result;
				}
			});
			
			origFuncs.splice = childField.splice;
			
			Object.defineProperty(childField, "splice", {
				enumerable: false,
				configurable: true,
				value: () => {
					if(!self.blocked){
						self.block("tree-splice");
						
						var result =  origFuncs.splice.apply(childField, arguments);
						this.rebuildTree(row);
						
						self.unblock("tree-splice");
					}
					
					return result;
				}
			});
		}
	}
	
	rebuildTree(row){
		this.table.modules.dataTree.initializeRow(row);
		this.table.modules.dataTree.layoutRow(row);
		this.table.rowManager.refreshActiveData("tree", false, true);
	}
	
	watchKey(row, data, key){
		var self = this,
		props = Object.getOwnPropertyDescriptor(data, key),
		value = data[key],
		version = this.currentVersion;
		
		Object.defineProperty(data, key, {
			set: (newValue) => {
				value = newValue;
				if(!self.blocked && version === self.currentVersion){
					self.block("key");
					
					var update = {};
					update[key] = newValue;
					row.updateData(update);
					
					self.unblock("key");
				}
				
				if(props.set){
					props.set(newValue);
				}
			},
			get:() => {
				
				if(props.get){
					props.get();
				}
				
				return value;
			}
		});
	}
	
	unwatchRow(row){
		var data = row.getData();
		
		for(var key in data){
			Object.defineProperty(data, key, {
				value:data[key],
			});
		}
	}
	
	block(key){
		if(!this.blocked){
			this.blocked = key;
		}
	}
	
	unblock(key){
		if(this.blocked === key){
			this.blocked = false;
		}
	}
}

class ResizeColumns extends Module{

	static moduleName = "resizeColumns";

	constructor(table){
		super(table);
		
		this.startColumn = false;
		this.startX = false;
		this.startWidth = false;
		this.latestX = false;
		this.handle = null;
		this.initialNextColumn = null;
		this.nextColumn = null;
		
		this.initialized = false;
		this.registerColumnOption("resizable", true);
		this.registerTableOption("resizableColumnFit", false);
		this.registerTableOption("resizableColumnGuide", false);
	}
	
	initialize(){
		this.subscribe("column-rendered", this.layoutColumnHeader.bind(this));
	}
	
	initializeEventWatchers(){
		if(!this.initialized){
			
			this.subscribe("cell-rendered", this.layoutCellHandles.bind(this));
			this.subscribe("cell-delete", this.deInitializeComponent.bind(this));
			
			this.subscribe("cell-height", this.resizeHandle.bind(this));
			this.subscribe("column-moved", this.columnLayoutUpdated.bind(this));
			
			this.subscribe("column-hide", this.deInitializeColumn.bind(this));
			this.subscribe("column-show", this.columnLayoutUpdated.bind(this));
			this.subscribe("column-width", this.columnWidthUpdated.bind(this));
			
			this.subscribe("column-delete", this.deInitializeComponent.bind(this));
			this.subscribe("column-height", this.resizeHandle.bind(this));
			
			this.initialized = true;
		}
	}
	
	
	layoutCellHandles(cell){
		if(cell.row.type === "row"){
			this.deInitializeComponent(cell);
			this.initializeColumn("cell", cell, cell.column, cell.element);
		}
	}
	
	layoutColumnHeader(column){
		if(column.definition.resizable){
			this.initializeEventWatchers();
			this.deInitializeComponent(column);
			this.initializeColumn("header", column, column, column.element);
		}
	}
	
	columnLayoutUpdated(column){
		var prev = column.prevColumn();
		
		this.reinitializeColumn(column);
		
		if(prev){
			this.reinitializeColumn(prev);
		}
	}
	
	columnWidthUpdated(column){
		if(column.modules.frozen){
			if(this.table.modules.frozenColumns.leftColumns.includes(column)){
				this.table.modules.frozenColumns.leftColumns.forEach((col) => {
					this.reinitializeColumn(col);
				});
			}else if(this.table.modules.frozenColumns.rightColumns.includes(column)){
				this.table.modules.frozenColumns.rightColumns.forEach((col) => {
					this.reinitializeColumn(col);
				});
			}
		}
	}

	frozenColumnOffset(column){
		var offset = false;

		if(column.modules.frozen){
			offset = column.modules.frozen.marginValue; 

			if(column.modules.frozen.position === "left"){
				offset += column.getWidth() - 3;
			}else {
				if(offset){
					offset -= 3;
				}
			}
		}

		return offset !== false ? offset + "px" : false;
	}
	
	reinitializeColumn(column){
		var frozenOffset = this.frozenColumnOffset(column);
		
		column.cells.forEach((cell) => {
			if(cell.modules.resize && cell.modules.resize.handleEl){
				if(frozenOffset){
					cell.modules.resize.handleEl.style[column.modules.frozen.position] = frozenOffset;
					cell.modules.resize.handleEl.style["z-index"] = 11;
				}
				
				cell.element.after(cell.modules.resize.handleEl);
			}
		});
		
		if(column.modules.resize && column.modules.resize.handleEl){
			if(frozenOffset){
				column.modules.resize.handleEl.style[column.modules.frozen.position] = frozenOffset;
			}
			
			column.element.after(column.modules.resize.handleEl);
		}
	}
	
	initializeColumn(type, component, column, element){
		var self = this,
		variableHeight = false,
		mode = column.definition.resizable,
		config = {},
		nearestColumn = column.getLastColumn();
		
		//set column resize mode
		if(type === "header"){
			variableHeight = column.definition.formatter == "textarea" || column.definition.variableHeight;
			config = {variableHeight:variableHeight};
		}
		
		if((mode === true || mode == type) && this._checkResizability(nearestColumn)){
			
			var handle = document.createElement('span');
			handle.className = "tabulator-col-resize-handle";
			
			handle.addEventListener("click", function(e){
				e.stopPropagation();
			});
			
			var handleDown = function(e){
				self.startColumn = column;
				self.initialNextColumn = self.nextColumn = nearestColumn.nextColumn();
				self._mouseDown(e, nearestColumn, handle);
			};
			
			handle.addEventListener("mousedown", handleDown);
			handle.addEventListener("touchstart", handleDown, {passive: true});
			
			//resize column on  double click
			handle.addEventListener("dblclick", (e) => {
				var oldWidth = nearestColumn.getWidth();
				
				e.stopPropagation();
				nearestColumn.reinitializeWidth(true);
				
				if(oldWidth !== nearestColumn.getWidth()){
					self.dispatch("column-resized", nearestColumn);
					self.dispatchExternal("columnResized", nearestColumn.getComponent());
				}
			});
			
			if(column.modules.frozen){
				handle.style.position = "sticky";
				handle.style[column.modules.frozen.position] = this.frozenColumnOffset(column);
			}
			
			config.handleEl = handle;
			
			if(element.parentNode && column.visible){
				element.after(handle);			
			}
		}
		
		component.modules.resize = config;
	}
	
	deInitializeColumn(column){
		this.deInitializeComponent(column);
		
		column.cells.forEach((cell) => {
			this.deInitializeComponent(cell);
		});
	}
	
	deInitializeComponent(component){
		var handleEl;
		
		if(component.modules.resize){
			handleEl = component.modules.resize.handleEl;
			
			if(handleEl && handleEl.parentElement){
				handleEl.parentElement.removeChild(handleEl);
			}
		}
	}
	
	resizeHandle(component, height){
		if(component.modules.resize && component.modules.resize.handleEl){
			component.modules.resize.handleEl.style.height = height;
		}
	}
	
	resize(e, column){
		var x = typeof e.clientX === "undefined" ? e.touches[0].clientX : e.clientX,
		startDiff = x - this.startX,
		moveDiff = x - this.latestX,
		blockedBefore, blockedAfter;

		this.latestX = x;

		if(this.table.rtl){
			startDiff = -startDiff;
			moveDiff = -moveDiff;
		}

		blockedBefore = column.width == column.minWidth || column.width == column.maxWidth;

		column.setWidth(this.startWidth + startDiff);

		blockedAfter = column.width == column.minWidth || column.width == column.maxWidth;

		if(moveDiff < 0){
			this.nextColumn = this.initialNextColumn;
		}

		if(this.table.options.resizableColumnFit && this.nextColumn && !(blockedBefore && blockedAfter)){
			let colWidth = this.nextColumn.getWidth();

			if(moveDiff > 0){
				if(colWidth <= this.nextColumn.minWidth){
					this.nextColumn = this.nextColumn.nextColumn();
				}
			}

			if(this.nextColumn){
				this.nextColumn.setWidth(this.nextColumn.getWidth() - moveDiff);
			}
		}

		this.table.columnManager.rerenderColumns(true);

		if(!this.table.browserSlow && column.modules.resize && column.modules.resize.variableHeight){
			column.checkCellHeights();
		}
	}

	calcGuidePosition(e, column, handle) {
		var mouseX = typeof e.clientX === "undefined" ? e.touches[0].clientX : e.clientX,
		handleX = handle.getBoundingClientRect().x - this.table.element.getBoundingClientRect().x,
		tableX = this.table.element.getBoundingClientRect().x,
		columnX = column.element.getBoundingClientRect().left - tableX,
		mouseDiff = mouseX - this.startX,
		pos = Math.max(handleX + mouseDiff, columnX + column.minWidth);

		if(column.maxWidth){
			pos = Math.min(pos, columnX + column.maxWidth);
		}

		return pos;
	}

	_checkResizability(column){
		return column.definition.resizable;
	}
	
	_mouseDown(e, column, handle){
		var self = this,
		guideEl;

		this.dispatchExternal("columnResizing", column.getComponent());

		if(self.table.options.resizableColumnGuide){
			guideEl = document.createElement("span");
			guideEl.classList.add('tabulator-col-resize-guide');
			self.table.element.appendChild(guideEl);
			setTimeout(() => {
				guideEl.style.left = self.calcGuidePosition(e, column, handle) + "px";
			});
		}

		self.table.element.classList.add("tabulator-block-select");

		function mouseMove(e){
			if(self.table.options.resizableColumnGuide){
				guideEl.style.left = self.calcGuidePosition(e, column, handle) + "px";
			}else {
				self.resize(e, column);
			}
		}
		
		function mouseUp(e){
			if(self.table.options.resizableColumnGuide){
				self.resize(e, column);
				guideEl.remove();
			}
			
			//block editor from taking action while resizing is taking place
			if(self.startColumn.modules.edit){
				self.startColumn.modules.edit.blocked = false;
			}
			
			if(self.table.browserSlow && column.modules.resize && column.modules.resize.variableHeight){
				column.checkCellHeights();
			}
			
			document.body.removeEventListener("mouseup", mouseUp);
			document.body.removeEventListener("mousemove", mouseMove);
			
			handle.removeEventListener("touchmove", mouseMove);
			handle.removeEventListener("touchend", mouseUp);
			
			self.table.element.classList.remove("tabulator-block-select");
			
			if(self.startWidth !== column.getWidth()){
				self.table.columnManager.verticalAlignHeaders();

				self.dispatch("column-resized", column);
				self.dispatchExternal("columnResized", column.getComponent());
			}
		}
		
		e.stopPropagation(); //prevent resize from interfering with movable columns
		
		//block editor from taking action while resizing is taking place
		if(self.startColumn.modules.edit){
			self.startColumn.modules.edit.blocked = true;
		}
		
		self.startX = typeof e.clientX === "undefined" ? e.touches[0].clientX : e.clientX;
		self.latestX = self.startX;
		self.startWidth = column.getWidth();
		
		document.body.addEventListener("mousemove", mouseMove);
		document.body.addEventListener("mouseup", mouseUp);
		handle.addEventListener("touchmove", mouseMove, {passive: true});
		handle.addEventListener("touchend", mouseUp);
	}
}

class ResizeRows extends Module{

	static moduleName = "resizeRows";

	constructor(table){
		super(table);

		this.startColumn = false;
		this.startY = false;
		this.startHeight = false;
		this.handle = null;
		this.prevHandle = null;

		this.registerTableOption("resizableRows", false); //resizable rows
		this.registerTableOption("resizableRowGuide", false);
	}

	initialize(){
		if(this.table.options.resizableRows){
			this.subscribe("row-layout-after", this.initializeRow.bind(this));
		}
	}

	initializeRow(row){
		var self = this,
		rowEl = row.getElement();

		var handle = document.createElement('div');
		handle.className = "tabulator-row-resize-handle";

		var prevHandle = document.createElement('div');
		prevHandle.className = "tabulator-row-resize-handle prev";

		handle.addEventListener("click", function(e){
			e.stopPropagation();
		});

		var handleDown = function(e){
			self.startRow = row;
			self._mouseDown(e, row, handle);
		};

		handle.addEventListener("mousedown", handleDown);
		handle.addEventListener("touchstart", handleDown, {passive: true});

		prevHandle.addEventListener("click", function(e){
			e.stopPropagation();
		});

		var prevHandleDown =  function(e){
			var prevRow = self.table.rowManager.prevDisplayRow(row);

			if(prevRow){
				self.startRow = prevRow;
				self._mouseDown(e, prevRow, prevHandle);
			}
		};

		prevHandle.addEventListener("mousedown",prevHandleDown);
		prevHandle.addEventListener("touchstart",prevHandleDown, {passive: true});

		rowEl.appendChild(handle);
		rowEl.appendChild(prevHandle);
	}

	resize(e, row) {
		row.setHeight(this.startHeight + ((typeof e.screenY === "undefined" ? e.touches[0].screenY : e.screenY) - this.startY));
	}

	calcGuidePosition(e, row, handle) {
		var mouseY = typeof e.screenY === "undefined" ? e.touches[0].screenY : e.screenY,
		handleY = handle.getBoundingClientRect().y - this.table.element.getBoundingClientRect().y,
		tableY = this.table.element.getBoundingClientRect().y,
		rowY = row.element.getBoundingClientRect().top - tableY,
		mouseDiff = mouseY - this.startY;

		return Math.max(handleY + mouseDiff, rowY);
	}

	_mouseDown(e, row, handle){
		var self = this,
		guideEl;

		self.dispatchExternal("rowResizing", row.getComponent());

		if(self.table.options.resizableRowGuide){
			guideEl = document.createElement("span");
			guideEl.classList.add('tabulator-row-resize-guide');
			self.table.element.appendChild(guideEl);
			setTimeout(() => {
				guideEl.style.top = self.calcGuidePosition(e, row, handle) + "px";
			});
		}

		self.table.element.classList.add("tabulator-block-select");

		function mouseMove(e){
			if(self.table.options.resizableRowGuide){
				guideEl.style.top = self.calcGuidePosition(e, row, handle) + "px";
			}else {
				self.resize(e, row);
			}
		}

		function mouseUp(e){
			if(self.table.options.resizableRowGuide){
				self.resize(e, row);
				guideEl.remove();
			}

			// //block editor from taking action while resizing is taking place
			// if(self.startColumn.modules.edit){
			// 	self.startColumn.modules.edit.blocked = false;
			// }

			document.body.removeEventListener("mouseup", mouseMove);
			document.body.removeEventListener("mousemove", mouseMove);

			handle.removeEventListener("touchmove", mouseMove);
			handle.removeEventListener("touchend", mouseUp);

			self.table.element.classList.remove("tabulator-block-select");

			self.dispatchExternal("rowResized", row.getComponent());
		}

		e.stopPropagation(); //prevent resize from interfering with movable columns

		//block editor from taking action while resizing is taking place
		// if(self.startColumn.modules.edit){
		// 	self.startColumn.modules.edit.blocked = true;
		// }

		self.startY = typeof e.screenY === "undefined" ? e.touches[0].screenY : e.screenY;
		self.startHeight = row.getHeight();

		document.body.addEventListener("mousemove", mouseMove);
		document.body.addEventListener("mouseup", mouseUp);

		handle.addEventListener("touchmove", mouseMove, {passive: true});
		handle.addEventListener("touchend", mouseUp);
	}
}

class ResizeTable extends Module{

	static moduleName = "resizeTable";
	
	constructor(table){
		super(table);
		
		this.binding = false;
		this.visibilityObserver = false;
		this.resizeObserver = false;
		this.containerObserver = false;
		
		this.tableHeight = 0;
		this.tableWidth = 0;
		this.containerHeight = 0;
		this.containerWidth = 0;
		
		this.autoResize = false;
		
		this.visible = false;
		
		this.initialized = false;
		this.initialRedraw = false;
		
		this.registerTableOption("autoResize", true); //auto resize table
	}
	
	initialize(){
		if(this.table.options.autoResize){
			var table = this.table,
			tableStyle;
			
			this.tableHeight = table.element.clientHeight;
			this.tableWidth = table.element.clientWidth;
			
			if(table.element.parentNode){
				this.containerHeight = table.element.parentNode.clientHeight;
				this.containerWidth = table.element.parentNode.clientWidth;
			}
			
			if(typeof IntersectionObserver !== "undefined" && typeof ResizeObserver !== "undefined" && table.rowManager.getRenderMode() === "virtual"){
				
				this.initializeVisibilityObserver();
				
				this.autoResize = true;
				
				this.resizeObserver = new ResizeObserver((entry) => {
					if(!table.browserMobile || (table.browserMobile && (!table.modules.edit || (table.modules.edit && !table.modules.edit.currentCell)))){
						
						var nodeHeight = Math.floor(entry[0].contentRect.height);
						var nodeWidth = Math.floor(entry[0].contentRect.width);
						
						if(this.tableHeight != nodeHeight || this.tableWidth != nodeWidth){
							this.tableHeight = nodeHeight;
							this.tableWidth = nodeWidth;
							
							if(table.element.parentNode){
								this.containerHeight = table.element.parentNode.clientHeight;
								this.containerWidth = table.element.parentNode.clientWidth;
							}
							
							this.redrawTable();
						}
					}
				});
				
				this.resizeObserver.observe(table.element);
				
				tableStyle = window.getComputedStyle(table.element);
				
				if(this.table.element.parentNode && !this.table.rowManager.fixedHeight && (tableStyle.getPropertyValue("max-height") || tableStyle.getPropertyValue("min-height"))){
					
					this.containerObserver = new ResizeObserver((entry) => {
						if(!table.browserMobile || (table.browserMobile && (!table.modules.edit || (table.modules.edit && !table.modules.edit.currentCell)))){
							
							var nodeHeight = Math.floor(entry[0].contentRect.height);
							var nodeWidth = Math.floor(entry[0].contentRect.width);
							
							if(this.containerHeight != nodeHeight || this.containerWidth != nodeWidth){
								this.containerHeight = nodeHeight;
								this.containerWidth = nodeWidth;
								this.tableHeight = table.element.clientHeight;
								this.tableWidth = table.element.clientWidth;
							}
							
							this.redrawTable();
						}
					});
					
					this.containerObserver.observe(this.table.element.parentNode);
				}
				
				this.subscribe("table-resize", this.tableResized.bind(this));
				
			}else {
				this.binding = function(){
					if(!table.browserMobile || (table.browserMobile && (!table.modules.edit || (table.modules.edit && !table.modules.edit.currentCell)))){
						table.columnManager.rerenderColumns(true);
						table.redraw();
					}
				};
				
				window.addEventListener("resize", this.binding);
			}
			
			this.subscribe("table-destroy", this.clearBindings.bind(this));
		}
	}
	
	initializeVisibilityObserver(){
		this.visibilityObserver = new IntersectionObserver((entries) => {
			this.visible = entries[0].isIntersecting;
			
			if(!this.initialized){
				this.initialized = true;
				this.initialRedraw = !this.visible;
			}else {
				if(this.visible){
					this.redrawTable(this.initialRedraw);
					this.initialRedraw = false;
				}
			}
		});
		
		this.visibilityObserver.observe(this.table.element);
	}
	
	redrawTable(force){
		if(this.initialized && this.visible){
			this.table.columnManager.rerenderColumns(true);
			this.table.redraw(force);
		}
	}
	
	tableResized(){
		this.table.rowManager.redraw();
	}
	
	clearBindings(){
		if(this.binding){
			window.removeEventListener("resize", this.binding);
		}
		
		if(this.resizeObserver){
			this.resizeObserver.unobserve(this.table.element);
		}
		
		if(this.visibilityObserver){
			this.visibilityObserver.unobserve(this.table.element);
		}
		
		if(this.containerObserver){
			this.containerObserver.unobserve(this.table.element.parentNode);
		}
	}
}

function responsiveCollapse(cell, formatterParams, onRendered){
	var el = document.createElement("div"),
	config = cell.getRow()._row.modules.responsiveLayout;

	el.classList.add("tabulator-responsive-collapse-toggle");
	
	el.innerHTML = `<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`;

	cell.getElement().classList.add("tabulator-row-handle");

	function toggleList(isOpen){
		var collapseEl = config.element;

		config.open = isOpen;

		if(collapseEl){

			if(config.open){
				el.classList.add("open");
				collapseEl.style.display = '';
			}else {
				el.classList.remove("open");
				collapseEl.style.display = 'none';
			}
		}
	}

	el.addEventListener("click", function(e){
		e.stopImmediatePropagation();
		toggleList(!config.open);
		cell.getTable().rowManager.adjustTableSize();
	});

	toggleList(config.open);

	return el;
}

var extensions$2 = {
	format:{
		formatters:{
			responsiveCollapse:responsiveCollapse,
		}
	}
};

class ResponsiveLayout extends Module{

	static moduleName = "responsiveLayout";
	static moduleExtensions = extensions$2;

	constructor(table){
		super(table);

		this.columns = [];
		this.hiddenColumns = [];
		this.mode = "";
		this.index = 0;
		this.collapseFormatter = [];
		this.collapseStartOpen = true;
		this.collapseHandleColumn = false;

		this.registerTableOption("responsiveLayout", false); //responsive layout flags
		this.registerTableOption("responsiveLayoutCollapseStartOpen", true); //start showing collapsed data
		this.registerTableOption("responsiveLayoutCollapseUseFormatters", true); //responsive layout collapse formatter
		this.registerTableOption("responsiveLayoutCollapseFormatter", false); //responsive layout collapse formatter

		this.registerColumnOption("responsive");
	}

	//generate responsive columns list
	initialize(){
		if(this.table.options.responsiveLayout){
			this.subscribe("column-layout", this.initializeColumn.bind(this));
			this.subscribe("column-show", this.updateColumnVisibility.bind(this));
			this.subscribe("column-hide", this.updateColumnVisibility.bind(this));
			this.subscribe("columns-loaded", this.initializeResponsivity.bind(this));
			this.subscribe("column-moved", this.initializeResponsivity.bind(this));
			this.subscribe("column-add", this.initializeResponsivity.bind(this));
			this.subscribe("column-delete", this.initializeResponsivity.bind(this));

			this.subscribe("table-redrawing", this.tableRedraw.bind(this));
			
			if(this.table.options.responsiveLayout === "collapse"){
				this.subscribe("row-data-changed", this.generateCollapsedRowContent.bind(this));
				this.subscribe("row-init", this.initializeRow.bind(this));
				this.subscribe("row-layout", this.layoutRow.bind(this));
			}
		}
	}

	tableRedraw(force){
		if(["fitColumns", "fitDataStretch"].indexOf(this.layoutMode()) === -1){
			if(!force){
				this.update();
			}
		}
	}

	initializeResponsivity(){
		var columns = [];

		this.mode = this.table.options.responsiveLayout;
		this.collapseFormatter = this.table.options.responsiveLayoutCollapseFormatter || this.formatCollapsedData;
		this.collapseStartOpen = this.table.options.responsiveLayoutCollapseStartOpen;
		this.hiddenColumns = [];

		if(this.collapseFormatter){
			this.collapseFormatter = this.collapseFormatter.bind(this.table);
		}

		//determine level of responsivity for each column
		this.table.columnManager.columnsByIndex.forEach((column, i) => {
			if(column.modules.responsive){
				if(column.modules.responsive.order && column.modules.responsive.visible){
					column.modules.responsive.index = i;
					columns.push(column);

					if(!column.visible && this.mode === "collapse"){
						this.hiddenColumns.push(column);
					}
				}
			}
		});

		//sort list by responsivity
		columns = columns.reverse();
		columns = columns.sort((a, b) => {
			var diff = b.modules.responsive.order - a.modules.responsive.order;
			return diff || (b.modules.responsive.index - a.modules.responsive.index);
		});

		this.columns = columns;

		if(this.mode === "collapse"){
			this.generateCollapsedContent();
		}

		//assign collapse column
		for (let col of this.table.columnManager.columnsByIndex){
			if(col.definition.formatter == "responsiveCollapse"){
				this.collapseHandleColumn = col;
				break;
			}
		}

		if(this.collapseHandleColumn){
			if(this.hiddenColumns.length){
				this.collapseHandleColumn.show();
			}else {
				this.collapseHandleColumn.hide();
			}
		}
	}

	//define layout information
	initializeColumn(column){
		var def = column.getDefinition();

		column.modules.responsive = {order: typeof def.responsive === "undefined" ? 1 : def.responsive, visible:def.visible === false ? false : true};
	}

	initializeRow(row){
		var el;

		if(row.type !== "calc"){
			el = document.createElement("div");
			el.classList.add("tabulator-responsive-collapse");

			row.modules.responsiveLayout = {
				element:el,
				open:this.collapseStartOpen,
			};

			if(!this.collapseStartOpen){
				el.style.display = 'none';
			}
		}
	}

	layoutRow(row){
		var rowEl = row.getElement();

		if(row.modules.responsiveLayout){
			rowEl.appendChild(row.modules.responsiveLayout.element);
			this.generateCollapsedRowContent(row);
		}
	}

	//update column visibility
	updateColumnVisibility(column, responsiveToggle){
		if(!responsiveToggle && column.modules.responsive){
			column.modules.responsive.visible = column.visible;
			this.initializeResponsivity();
		}
	}

	hideColumn(column){
		var colCount = this.hiddenColumns.length;

		column.hide(false, true);

		if(this.mode === "collapse"){
			this.hiddenColumns.unshift(column);
			this.generateCollapsedContent();

			if(this.collapseHandleColumn && !colCount){
				this.collapseHandleColumn.show();
			}
		}
	}

	showColumn(column){
		var index;

		column.show(false, true);
		//set column width to prevent calculation loops on uninitialized columns
		column.setWidth(column.getWidth());

		if(this.mode === "collapse"){
			index = this.hiddenColumns.indexOf(column);

			if(index > -1){
				this.hiddenColumns.splice(index, 1);
			}

			this.generateCollapsedContent();

			if(this.collapseHandleColumn && !this.hiddenColumns.length){
				this.collapseHandleColumn.hide();
			}
		}
	}

	//redraw columns to fit space
	update(){
		var working = true;

		while(working){

			let width = this.table.modules.layout.getMode() == "fitColumns" ? this.table.columnManager.getFlexBaseWidth() : this.table.columnManager.getWidth();

			let diff = (this.table.options.headerVisible ? this.table.columnManager.element.clientWidth : this.table.element.clientWidth) - width;

			if(diff < 0){
				//table is too wide
				let column = this.columns[this.index];

				if(column){
					this.hideColumn(column);
					this.index ++;
				}else {
					working = false;
				}

			}else {

				//table has spare space
				let column = this.columns[this.index -1];

				if(column){
					if(diff > 0){
						if(diff >= column.getWidth()){
							this.showColumn(column);
							this.index --;
						}else {
							working = false;
						}
					}else {
						working = false;
					}
				}else {
					working = false;
				}
			}

			if(!this.table.rowManager.activeRowsCount){
				this.table.rowManager.renderEmptyScroll();
			}
		}
	}

	generateCollapsedContent(){
		var rows = this.table.rowManager.getDisplayRows();

		rows.forEach((row) => {
			this.generateCollapsedRowContent(row);
		});
	}

	generateCollapsedRowContent(row){
		var el, contents;

		if(row.modules.responsiveLayout){
			el = row.modules.responsiveLayout.element;

			while(el.firstChild) el.removeChild(el.firstChild);

			contents = this.collapseFormatter(this.generateCollapsedRowData(row));
			if(contents){
				el.appendChild(contents);
			}
			row.calcHeight(true);
		}
	}

	generateCollapsedRowData(row){
		var data = row.getData(),
		output = [],
		mockCellComponent;

		this.hiddenColumns.forEach((column) => {
			var value = column.getFieldValue(data);

			if(column.definition.title && column.field){
				if(column.modules.format && this.table.options.responsiveLayoutCollapseUseFormatters){

					mockCellComponent = {
						value:false,
						data:{},
						getValue:function(){
							return value;
						},
						getData:function(){
							return data;
						},
						getType:function(){
							return "cell";
						},
						getElement:function(){
							return document.createElement("div");
						},
						getRow:function(){
							return row.getComponent();
						},
						getColumn:function(){
							return column.getComponent();
						},
						getTable:() => {
							return this.table;
						},
					};

					function onRendered(callback){
						callback();
					}

					output.push({
						field: column.field,
						title: column.definition.title,
						value: column.modules.format.formatter.call(this.table.modules.format, mockCellComponent, column.modules.format.params, onRendered)
					});
				}else {
					output.push({
						field: column.field,
						title: column.definition.title,
						value: value
					});
				}
			}
		});

		return output;
	}

	formatCollapsedData(data){
		var list = document.createElement("table");

		data.forEach((item) => {
			var row = document.createElement("tr");
			var titleData = document.createElement("td");
			var valueData = document.createElement("td");
			var node_content;

			var titleHighlight = document.createElement("strong");
			titleData.appendChild(titleHighlight);
			
			this.modules.localize.bind("columns|" + item.field, function(text){
				titleHighlight.innerHTML = text || item.title;
			});

			if(item.value instanceof Node){
				node_content = document.createElement("div");
				node_content.appendChild(item.value);
				valueData.appendChild(node_content);
			}else {
				valueData.innerHTML = item.value;
			}

			row.appendChild(titleData);
			row.appendChild(valueData);
			list.appendChild(row);
		});

		return Object.keys(data).length ? list : "";
	}
}

function rowSelection(cell, formatterParams, onRendered){
	var checkbox = document.createElement("input");
	var blocked = false;

	checkbox.type = 'checkbox';

	checkbox.setAttribute("aria-label", "Select Row");
	
	if(this.table.modExists("selectRow", true)){

		checkbox.addEventListener("click", (e) => {
			e.stopPropagation();
		});

		if(typeof cell.getRow == 'function'){
			var row = cell.getRow();

			if(row instanceof RowComponent){

				checkbox.addEventListener("change", (e) => {
					if(this.table.options.selectableRowsRangeMode === "click"){
						if(!blocked){
							row.toggleSelect();
						}else {
							blocked = false;
						}
					}else {
						row.toggleSelect();
					}
				});

				if(this.table.options.selectableRowsRangeMode === "click"){
					checkbox.addEventListener("click", (e) => {
						blocked = true;
						this.table.modules.selectRow.handleComplexRowClick(row._row, e);
					});
				}

				checkbox.checked = row.isSelected && row.isSelected();
				this.table.modules.selectRow.registerRowSelectCheckbox(row, checkbox);
			}else {
				checkbox = "";
			}
		}else {
			checkbox.addEventListener("change", (e) => {
				if(this.table.modules.selectRow.selectedRows.length){
					this.table.deselectRow();
				}else {
					this.table.selectRow(formatterParams.rowRange);
				}
			});

			this.table.modules.selectRow.registerHeaderSelectCheckbox(checkbox);
		}
	}

	return checkbox;
}

var extensions$1 = {
	format:{
		formatters:{
			rowSelection:rowSelection,
		}
	}
};

class SelectRow extends Module{

	static moduleName = "selectRow";
	static moduleExtensions = extensions$1;
	
	constructor(table){
		super(table);
		
		this.selecting = false; //flag selecting in progress
		this.lastClickedRow = false; //last clicked row
		this.selectPrev = []; //hold previously selected element for drag drop selection
		this.selectedRows = []; //hold selected rows
		this.headerCheckboxElement = null; // hold header select element
		
		this.registerTableOption("selectableRows", "highlight"); //highlight rows on hover
		this.registerTableOption("selectableRowsRangeMode", "drag");  //highlight rows on hover
		this.registerTableOption("selectableRowsRollingSelection", true); //roll selection once maximum number of selectable rows is reached
		this.registerTableOption("selectableRowsPersistence", true); // maintain selection when table view is updated
		this.registerTableOption("selectableRowsCheck", function(data, row){return true;}); //check whether row is selectable
		
		this.registerTableFunction("selectRow", this.selectRows.bind(this));
		this.registerTableFunction("deselectRow", this.deselectRows.bind(this));
		this.registerTableFunction("toggleSelectRow", this.toggleRow.bind(this));
		this.registerTableFunction("getSelectedRows", this.getSelectedRows.bind(this));
		this.registerTableFunction("getSelectedData", this.getSelectedData.bind(this));
		
		//register component functions
		this.registerComponentFunction("row", "select", this.selectRows.bind(this));
		this.registerComponentFunction("row", "deselect", this.deselectRows.bind(this));
		this.registerComponentFunction("row", "toggleSelect", this.toggleRow.bind(this));
		this.registerComponentFunction("row", "isSelected", this.isRowSelected.bind(this));
	}
	
	initialize(){

		this.deprecatedOptionsCheck();

		if(this.table.options.selectableRows === "highlight" && this.table.options.selectableRange){
			this.table.options.selectableRows = false;
		}

		if(this.table.options.selectableRows !== false){
			this.subscribe("row-init", this.initializeRow.bind(this));
			this.subscribe("row-deleting", this.rowDeleted.bind(this));
			this.subscribe("rows-wipe", this.clearSelectionData.bind(this));
			this.subscribe("rows-retrieve", this.rowRetrieve.bind(this));
			
			if(this.table.options.selectableRows && !this.table.options.selectableRowsPersistence){
				this.subscribe("data-refreshing", this.deselectRows.bind(this));
			}
		}
	}

	deprecatedOptionsCheck(){
		// this.deprecationCheck("selectable", "selectableRows", true);
		// this.deprecationCheck("selectableRollingSelection", "selectableRowsRollingSelection", true);
		// this.deprecationCheck("selectableRangeMode", "selectableRowsRangeMode", true);
		// this.deprecationCheck("selectablePersistence", "selectableRowsPersistence", true);
		// this.deprecationCheck("selectableCheck", "selectableRowsCheck", true);
	}
	
	rowRetrieve(type, prevValue){
		return type === "selected" ? this.selectedRows : prevValue;
	}
	
	rowDeleted(row){
		this._deselectRow(row, true);
	}
	
	clearSelectionData(silent){
		var prevSelected = this.selectedRows.length;

		this.selecting = false;
		this.lastClickedRow = false;
		this.selectPrev = [];
		this.selectedRows = [];
		
		if(prevSelected && silent !== true){
			this._rowSelectionChanged();
		}
	}
	
	initializeRow(row){
		var self = this,
		selectable = self.checkRowSelectability(row),
		element = row.getElement();
		
		// trigger end of row selection
		var endSelect = function(){
			
			setTimeout(function(){
				self.selecting = false;
			}, 50);
			
			document.body.removeEventListener("mouseup", endSelect);
		};
		
		row.modules.select = {selected:false};

		element.classList.toggle("tabulator-selectable", selectable);
		element.classList.toggle("tabulator-unselectable", !selectable);
		
		//set row selection class
		if(self.checkRowSelectability(row)){			
			if(self.table.options.selectableRows && self.table.options.selectableRows != "highlight"){
				if(self.table.options.selectableRowsRangeMode === "click"){
					element.addEventListener("click", this.handleComplexRowClick.bind(this, row));
				}else {
					element.addEventListener("click", function(e){
						if(!self.table.modExists("edit") || !self.table.modules.edit.getCurrentCell()){
							self.table._clearSelection();
						}
						
						if(!self.selecting){
							self.toggleRow(row);
						}
					});
					
					element.addEventListener("mousedown", function(e){
						if(e.shiftKey){
							self.table._clearSelection();
							
							self.selecting = true;
							
							self.selectPrev = [];
							
							document.body.addEventListener("mouseup", endSelect);
							document.body.addEventListener("keyup", endSelect);
							
							self.toggleRow(row);
							
							return false;
						}
					});
					
					element.addEventListener("mouseenter", function(e){
						if(self.selecting){
							self.table._clearSelection();
							self.toggleRow(row);
							
							if(self.selectPrev[1] == row){
								self.toggleRow(self.selectPrev[0]);
							}
						}
					});
					
					element.addEventListener("mouseout", function(e){
						if(self.selecting){
							self.table._clearSelection();
							self.selectPrev.unshift(row);
						}
					});
				}
			}
		}
	}
	
	handleComplexRowClick(row, e){
		if(e.shiftKey){
			this.table._clearSelection();
			this.lastClickedRow = this.lastClickedRow || row;
			
			var lastClickedRowIdx = this.table.rowManager.getDisplayRowIndex(this.lastClickedRow);
			var rowIdx = this.table.rowManager.getDisplayRowIndex(row);
			
			var fromRowIdx = lastClickedRowIdx <= rowIdx ? lastClickedRowIdx : rowIdx;
			var toRowIdx = lastClickedRowIdx >= rowIdx ? lastClickedRowIdx : rowIdx;
			
			var rows = this.table.rowManager.getDisplayRows().slice(0);
			var toggledRows = rows.splice(fromRowIdx, toRowIdx - fromRowIdx + 1);
			
			if(e.ctrlKey || e.metaKey){
				toggledRows.forEach((toggledRow)=>{
					if(toggledRow !== this.lastClickedRow){
						
						if(this.table.options.selectableRows !== true && !this.isRowSelected(row)){
							if(this.selectedRows.length < this.table.options.selectableRows){
								this.toggleRow(toggledRow);
							}
						}else {
							this.toggleRow(toggledRow);
						}
					}
				});
				this.lastClickedRow = row;
			}else {
				this.deselectRows(undefined, true);
				
				if(this.table.options.selectableRows !== true){
					if(toggledRows.length > this.table.options.selectableRows){
						toggledRows = toggledRows.slice(0, this.table.options.selectableRows);
					}
				}
				
				this.selectRows(toggledRows);
			}
			this.table._clearSelection();
		}
		else if(e.ctrlKey || e.metaKey){
			this.toggleRow(row);
			this.lastClickedRow = row;
		}else {
			this.deselectRows(undefined, true);
			this.selectRows(row);
			this.lastClickedRow = row;
		}
	}

	checkRowSelectability(row){
		if(row && row.type === "row"){
			return this.table.options.selectableRowsCheck.call(this.table, row.getComponent());
		}

		return false;
	}
	
	//toggle row selection
	toggleRow(row){
		if(this.checkRowSelectability(row)){
			if(row.modules.select && row.modules.select.selected){
				this._deselectRow(row);
			}else {
				this._selectRow(row);
			}
		}
	}
	
	//select a number of rows
	selectRows(rows){
		var changes = [], 
		rowMatch, change;
		
		switch(typeof rows){
			case "undefined":
				rowMatch = this.table.rowManager.rows;
				break;
			
			case "number":
				rowMatch = this.table.rowManager.findRow(rows);
				break;
				
			case "string":
				rowMatch = this.table.rowManager.findRow(rows);
			
				if(!rowMatch){
					rowMatch = this.table.rowManager.getRows(rows);
				}
				break;
			
			default:
				rowMatch = rows;
				break;
		}

		if(Array.isArray(rowMatch)){
			if(rowMatch.length){
				rowMatch.forEach((row) => {
					change = this._selectRow(row, true, true);

					if(change){
						changes.push(change);
					}
				});

				this._rowSelectionChanged(false, changes);
			}
		}else {
			if(rowMatch){
				this._selectRow(rowMatch, false, true);
			}
		}	
	}
	
	//select an individual row
	_selectRow(rowInfo, silent, force){
		//handle max row count
		if(!isNaN(this.table.options.selectableRows) && this.table.options.selectableRows !== true && !force){
			if(this.selectedRows.length >= this.table.options.selectableRows){
				if(this.table.options.selectableRowsRollingSelection){
					this._deselectRow(this.selectedRows[0]);
				}else {
					return false;
				}
			}
		}
		
		var row = this.table.rowManager.findRow(rowInfo);
		
		if(row){
			if(this.selectedRows.indexOf(row) == -1){
				row.getElement().classList.add("tabulator-selected");
				if(!row.modules.select){
					row.modules.select = {};
				}
				
				row.modules.select.selected = true;
				if(row.modules.select.checkboxEl){
					row.modules.select.checkboxEl.checked = true;
				}
				
				this.selectedRows.push(row);
				
				if(this.table.options.dataTreeSelectPropagate){
					this.childRowSelection(row, true);
				}
				
				this.dispatchExternal("rowSelected", row.getComponent());
				
				this._rowSelectionChanged(silent, row);

				return row;
			}
		}else {
			if(!silent){
				console.warn("Selection Error - No such row found, ignoring selection:" + rowInfo);
			}
		}
	}
	
	isRowSelected(row){
		return this.selectedRows.indexOf(row) !== -1;
	}
	
	//deselect a number of rows
	deselectRows(rows, silent){
		var changes = [], 
		rowMatch, change;
		
		switch(typeof rows){
			case "undefined":
				rowMatch = Object.assign([], this.selectedRows);
				break;

			case "number":
				rowMatch = this.table.rowManager.findRow(rows);
				break;
			
			case "string":
				rowMatch = this.table.rowManager.findRow(rows);
			
				if(!rowMatch){
					rowMatch = this.table.rowManager.getRows(rows);
				}
				break;
			
			default:
				rowMatch = rows;
				break;
		}

		if(Array.isArray(rowMatch)){
			if(rowMatch.length){
				rowMatch.forEach((row) => {
					change = this._deselectRow(row, true, true);

					if(change){
						changes.push(change);
					}
				});

				this._rowSelectionChanged(silent, [], changes);
			}
		}else {
			if(rowMatch){
				this._deselectRow(rowMatch, silent, true);
			}
		}	
	}
	
	//deselect an individual row
	_deselectRow(rowInfo, silent){
		var self = this,
		row = self.table.rowManager.findRow(rowInfo),
		index, element;
		
		if(row){
			index = self.selectedRows.findIndex(function(selectedRow){
				return selectedRow == row;
			});
			
			if(index > -1){

				element = row.getElement();
				
				if(element){
					element.classList.remove("tabulator-selected");
				}
				
				if(!row.modules.select){
					row.modules.select = {};
				}
				
				row.modules.select.selected = false;
				if(row.modules.select.checkboxEl){
					row.modules.select.checkboxEl.checked = false;
				}
				self.selectedRows.splice(index, 1);
				
				if(this.table.options.dataTreeSelectPropagate){
					this.childRowSelection(row, false);
				}
				
				this.dispatchExternal("rowDeselected", row.getComponent());
				
				self._rowSelectionChanged(silent, undefined, row);

				return row;
			}
		}else {
			if(!silent){
				console.warn("Deselection Error - No such row found, ignoring selection:" + rowInfo);
			}
		}
	}
	
	getSelectedData(){
		var data = [];
		
		this.selectedRows.forEach(function(row){
			data.push(row.getData());
		});
		
		return data;
	}
	
	getSelectedRows(){
		var rows = [];
		
		this.selectedRows.forEach(function(row){
			rows.push(row.getComponent());
		});
		
		return rows;
	}
	
	_rowSelectionChanged(silent, selected = [], deselected = []){
		if(this.headerCheckboxElement){
			if(this.selectedRows.length === 0){
				this.headerCheckboxElement.checked = false;
				this.headerCheckboxElement.indeterminate = false;
			} else if(this.table.rowManager.rows.length === this.selectedRows.length){
				this.headerCheckboxElement.checked = true;
				this.headerCheckboxElement.indeterminate = false;
			} else {
				this.headerCheckboxElement.indeterminate = true;
				this.headerCheckboxElement.checked = false;
			}
		}
		
		if(!silent){
			if(!Array.isArray(selected)){
				selected = [selected];
			}

			selected = selected.map(row => row.getComponent());

			if(!Array.isArray(deselected)){
				deselected = [deselected];
			}

			deselected = deselected.map(row => row.getComponent());

			this.dispatchExternal("rowSelectionChanged", this.getSelectedData(), this.getSelectedRows(), selected, deselected);
		}
	}
	
	registerRowSelectCheckbox (row, element) {
		if(!row._row.modules.select){
			row._row.modules.select = {};
		}
		
		row._row.modules.select.checkboxEl = element;
	}
	
	registerHeaderSelectCheckbox (element) {
		this.headerCheckboxElement = element;
	}
	
	childRowSelection(row, select){
		var children = this.table.modules.dataTree.getChildren(row, true, true);
		
		if(select){
			for(let child of children){
				this._selectRow(child, true);
			}
		}else {
			for(let child of children){
				this._deselectRow(child, true);
			}
		}
	}
}

class RangeComponent {
	constructor(range) {
		this._range = range;

		return new Proxy(this, {
			get: function (target, name, receiver) {
				if (typeof target[name] !== "undefined") {
					return target[name];
				} else {
					return target._range.table.componentFunctionBinder.handle("range", target._range, name);
				}
			},
		});
	}

	getElement() {
		return this._range.element;
	}

	getData() {
		return this._range.getData();
	}

	getCells() {
		return this._range.getCells(true, true);
	}

	getStructuredCells() {
		return this._range.getStructuredCells();
	}

	getRows() {
		return this._range.getRows().map((row) => row.getComponent());
	}

	getColumns() {
		return this._range.getColumns().map((column) => column.getComponent());
	}
	
	getBounds() {
		return this._range.getBounds();
	}

	getTopEdge() {
		return this._range.top;
	}

	getBottomEdge() {
		return this._range.bottom;
	}

	getLeftEdge() {
		return this._range.left;
	}

	getRightEdge() {
		return this._range.right;
	}

	setBounds(start, end){
		if(this._range.destroyedGuard("setBounds")){
			this._range.setBounds(start ? start._cell : start, end ? end._cell : end);
		}
	}

	setStartBound(start){
		if(this._range.destroyedGuard("setStartBound")){
			this._range.setEndBound(start ? start._cell : start);
			this._range.rangeManager.layoutElement();
		}
	}

	setEndBound(end){
		if(this._range.destroyedGuard("setEndBound")){
			this._range.setEndBound(end ? end._cell : end);
			this._range.rangeManager.layoutElement();
		}
	}

	clearValues(){
		if(this._range.destroyedGuard("clearValues")){
			this._range.clearValues();
		}
	}

	remove(){
		if(this._range.destroyedGuard("remove")){
			this._range.destroy(true);
		}
	}
}

class Range extends CoreFeature{
	constructor(table, rangeManager, start, end) {
		super(table);
		
		this.rangeManager = rangeManager;
		this.element = null;
		this.initialized = false;
		this.initializing = {
			start:false,
			end:false,
		};
		this.destroyed = false;
		
		this.top = 0;
		this.bottom = 0;
		this.left = 0;
		this.right = 0;
		
		this.table = table;
		this.start = {row:0, col:0};
		this.end = {row:0, col:0};

		if(this.rangeManager.rowHeader){
			this.left = 1;
			this.right = 1;
			this.start.col = 1;
			this.end.col = 1;
		}
		
		this.initElement();
		
		setTimeout(() => {
			this.initBounds(start, end);
		});
	}
	
	initElement(){
		this.element = document.createElement("div");
		this.element.classList.add("tabulator-range");
	}
	
	initBounds(start, end){
		this._updateMinMax();
		
		if(start){
			this.setBounds(start, end || start);
		}
	}
	
	///////////////////////////////////
	///////   Boundary Setup    ///////
	///////////////////////////////////
	
	setStart(row, col) {
		if(this.start.row !== row || this.start.col !== col){
			this.start.row = row;
			this.start.col = col;
			
			this.initializing.start = true;
			this._updateMinMax();
		}
	}
	
	setEnd(row, col) {
		if(this.end.row !== row || this.end.col !== col){
			this.end.row = row;
			this.end.col = col;
			
			this.initializing.end = true;
			this._updateMinMax();
		}
	}
	
	setBounds(start, end, visibleRows){
		if(start){
			this.setStartBound(start);
		}
		
		this.setEndBound(end || start);
		this.rangeManager.layoutElement(visibleRows);
	}
	
	setStartBound(element){
		var row, col;
		
		if (element.type === "column") {
			if(this.rangeManager.columnSelection){
				this.setStart(0, element.getPosition() - 1);
			}
		}else {
			row = element.row.position - 1;
			col = element.column.getPosition() - 1;
			
			if (element.column === this.rangeManager.rowHeader) {
				this.setStart(row, 1);
			} else {
				this.setStart(row, col);
			}
		}
	}
	
	setEndBound(element){
		var rowsCount = this._getTableRows().length,
		row, col, isRowHeader;
		
		if (element.type === "column") {
			if(this.rangeManager.columnSelection){
				if (this.rangeManager.selecting === "column") {
					this.setEnd(rowsCount - 1, element.getPosition() - 1);
				} else if (this.rangeManager.selecting === "cell") {
					this.setEnd(0, element.getPosition() - 1);
				}
			}
		}else {
			row = element.row.position - 1;
			col = element.column.getPosition() - 1;
			isRowHeader = element.column === this.rangeManager.rowHeader;
			
			if (this.rangeManager.selecting === "row") {
				this.setEnd(row, this._getTableColumns().length - 1);
			} else if (this.rangeManager.selecting !== "row" && isRowHeader) {
				this.setEnd(row, 0);
			} else if (this.rangeManager.selecting === "column") {
				this.setEnd(rowsCount - 1, col);
			} else {
				this.setEnd(row, col);
			}
		}
	}
	
	_updateMinMax() {
		this.top = Math.min(this.start.row, this.end.row);
		this.bottom = Math.max(this.start.row, this.end.row);
		this.left = Math.min(this.start.col, this.end.col);
		this.right = Math.max(this.start.col, this.end.col);
		
		if(this.initialized){
			this.dispatchExternal("rangeChanged", this.getComponent());
		}else {
			if(this.initializing.start && this.initializing.end){
				this.initialized = true;
				this.dispatchExternal("rangeAdded", this.getComponent());
			}
		}
	}
	
	_getTableColumns() {
		return this.table.columnManager.getVisibleColumnsByIndex();
	}
	
	_getTableRows() {
		return this.table.rowManager.getDisplayRows().filter(row=> row.type === "row");
	}
	
	///////////////////////////////////
	///////      Rendering      ///////
	///////////////////////////////////
	
	layout() {
		var _vDomTop = this.table.rowManager.renderer.vDomTop,
		_vDomBottom = this.table.rowManager.renderer.vDomBottom,
		_vDomLeft = this.table.columnManager.renderer.leftCol,
		_vDomRight = this.table.columnManager.renderer.rightCol,		
		top, bottom, left, right, topLeftCell, bottomRightCell, topLeftCellEl, bottomRightCellEl, topLeftRowEl, bottomRightRowEl;

		if(this.table.options.renderHorizontal === "virtual" && this.rangeManager.rowHeader) {
			_vDomRight += 1;
		}
		
		if (_vDomTop == null) {
			_vDomTop = 0;
		}
		
		if (_vDomBottom == null) {
			_vDomBottom = Infinity;
		}
		
		if (_vDomLeft == null) {
			_vDomLeft = 0;
		}
		
		if (_vDomRight == null) {
			_vDomRight = Infinity;
		}
		
		if (this.overlaps(_vDomLeft, _vDomTop, _vDomRight, _vDomBottom)) {
			top = Math.max(this.top, _vDomTop);
			bottom = Math.min(this.bottom, _vDomBottom);
			left = Math.max(this.left, _vDomLeft);
			right = Math.min(this.right, _vDomRight);
			
			topLeftCell = this.rangeManager.getCell(top, left);
			bottomRightCell = this.rangeManager.getCell(bottom, right);
			topLeftCellEl = topLeftCell.getElement();
			bottomRightCellEl = bottomRightCell.getElement();
			topLeftRowEl = topLeftCell.row.getElement();
			bottomRightRowEl = bottomRightCell.row.getElement();
			
			this.element.classList.add("tabulator-range-active");
			// this.element.classList.toggle("tabulator-range-active", this === this.rangeManager.activeRange);

			if(this.table.rtl){
				this.element.style.right = topLeftRowEl.offsetWidth - topLeftCellEl.offsetLeft - topLeftCellEl.offsetWidth + "px";
				this.element.style.width = topLeftCellEl.offsetLeft + topLeftCellEl.offsetWidth - bottomRightCellEl.offsetLeft + "px";
			}else {
				this.element.style.left = topLeftRowEl.offsetLeft + topLeftCellEl.offsetLeft + "px";
				this.element.style.width = bottomRightCellEl.offsetLeft + bottomRightCellEl.offsetWidth - topLeftCellEl.offsetLeft + "px";
			}
			
			this.element.style.top = topLeftRowEl.offsetTop + "px";
			this.element.style.height = bottomRightRowEl.offsetTop + bottomRightRowEl.offsetHeight - topLeftRowEl.offsetTop + "px";
		}
	}
	
	atTopLeft(cell) {
		return cell.row.position - 1 === this.top && cell.column.getPosition() - 1 === this.left;
	}
	
	atBottomRight(cell) {
		return cell.row.position - 1 === this.bottom && cell.column.getPosition() - 1 === this.right;
	}
	
	occupies(cell) {
		return this.occupiesRow(cell.row) && this.occupiesColumn(cell.column);
	}
	
	occupiesRow(row) {
		return this.top <= row.position - 1 && row.position - 1 <= this.bottom;
	}
	
	occupiesColumn(col) {
		return this.left <= col.getPosition() - 1 && col.getPosition() - 1 <= this.right;
	}
	
	overlaps(left, top, right, bottom) {
		if ((this.left > right || left > this.right) || (this.top > bottom || top > this.bottom)){
			return false;
		}
		
		return true;
	}
	
	getData() {
		var data = [],
		rows = this.getRows(),
		columns = this.getColumns();
		
		rows.forEach((row) => {
			var rowData = row.getData(),
			result = {};
			
			columns.forEach((column) => {
				result[column.field] = rowData[column.field];
			});
			
			data.push(result);
		});
		
		return data;
	}
	
	getCells(structured, component) {
		var cells = [],
		rows = this.getRows(),
		columns = this.getColumns();
		
		if (structured) {
			cells = rows.map((row) => {
				var arr = [];
				
				row.getCells().forEach((cell) => {
					if (columns.includes(cell.column)) {
						arr.push(component ? cell.getComponent() : cell);
					}
				});
				
				return arr;
			});
		} else {
			rows.forEach((row) => {
				row.getCells().forEach((cell) => {
					if (columns.includes(cell.column)) {
						cells.push(component ? cell.getComponent() : cell);
					}
				});
			});
		}
		
		return cells;
	}
	
	getStructuredCells() {
		return this.getCells(true, true);
	}
	
	getRows() {
		return this._getTableRows().slice(this.top, this.bottom + 1);
	}
	
	getColumns() {
		return this._getTableColumns().slice(this.left, this.right + 1);
	}
	
	clearValues(){
		var cells = this.getCells();
		var clearValue = this.table.options.selectableRangeClearCellsValue;
		
		this.table.blockRedraw();
		
		cells.forEach((cell) => {
			cell.setValue(clearValue);
		});
		
		this.table.restoreRedraw();
		
	}
	
	getBounds(component){
		var cells = this.getCells(false, component),
		output = {
			start:null,
			end:null,
		};
		
		if(cells.length){
			output.start = cells[0];
			output.end = cells[cells.length - 1];
		}else {
			console.warn("No bounds defined on range");
		}
		
		return output;
	}
	
	getComponent() {
		if (!this.component) {
			this.component = new RangeComponent(this);
		}
		return this.component;
	}
	
	destroy(notify) {
		this.destroyed = true;
		
		this.element.remove();
		
		if(notify){
			this.rangeManager.rangeRemoved(this);
		}
		
		if(this.initialized){
			this.dispatchExternal("rangeRemoved", this.getComponent());
		}
	}
	
	destroyedGuard(func){
		if(this.destroyed){
			console.warn("You cannot call the "  + func + " function on a destroyed range");
		}
		
		return !this.destroyed;
	}
}

var bindings = {
	rangeJumpUp:["ctrl + 38", "meta + 38"],
	rangeJumpDown:["ctrl + 40", "meta + 40"],
	rangeJumpLeft:["ctrl + 37", "meta + 37"],
	rangeJumpRight:["ctrl + 39", "meta + 39"],
	rangeExpandUp:"shift + 38",
	rangeExpandDown:"shift + 40",
	rangeExpandLeft:"shift + 37",
	rangeExpandRight:"shift + 39",
	rangeExpandJumpUp:["ctrl + shift + 38", "meta + shift + 38"],
	rangeExpandJumpDown:["ctrl + shift + 40", "meta + shift + 40"],
	rangeExpandJumpLeft:["ctrl + shift + 37", "meta + shift + 37"],
	rangeExpandJumpRight:["ctrl + shift + 39", "meta + shift + 39"],
};

var actions = {
	rangeJumpLeft: function(e){
		this.dispatch("keybinding-nav-range", e, "left", true, false);
	},
	rangeJumpRight: function(e){
		this.dispatch("keybinding-nav-range", e, "right", true, false);
	},
	rangeJumpUp: function(e){
		this.dispatch("keybinding-nav-range", e, "up", true, false);
	},
	rangeJumpDown: function(e){
		this.dispatch("keybinding-nav-range", e, "down", true, false);
	},
	rangeExpandLeft: function(e){
		this.dispatch("keybinding-nav-range", e, "left", false, true);
	},
	rangeExpandRight: function(e){
		this.dispatch("keybinding-nav-range", e, "right", false, true);
	},
	rangeExpandUp: function(e){
		this.dispatch("keybinding-nav-range", e, "up", false, true);
	},
	rangeExpandDown: function(e){
		this.dispatch("keybinding-nav-range", e, "down", false, true);
	},
	rangeExpandJumpLeft: function(e){
		this.dispatch("keybinding-nav-range", e, "left", true, true);
	},
	rangeExpandJumpRight: function(e){
		this.dispatch("keybinding-nav-range", e, "right", true, true);
	},
	rangeExpandJumpUp: function(e){
		this.dispatch("keybinding-nav-range", e, "up", true, true);
	},
	rangeExpandJumpDown: function(e){
		this.dispatch("keybinding-nav-range", e, "down", true, true);
	},
};

var pasteActions = {
	range:function(data){
		var rows = [],
		range = this.table.modules.selectRange.activeRange,
		singleCell = false,
		bounds, startCell, startRow, rowWidth, dataLength;

		dataLength = data.length;
		
		if(range){
			bounds = range.getBounds();
			startCell = bounds.start;
			
			if(bounds.start === bounds.end){
				singleCell = true;
			}
			
			if(startCell){
				rows = this.table.rowManager.activeRows.slice();
				startRow = rows.indexOf(startCell.row);

				if(singleCell){
					rowWidth = data.length;
				}else {
					rowWidth = (rows.indexOf(bounds.end.row) - startRow) + 1;
				}
				
				
				if(startRow >-1){
					this.table.blockRedraw();
					
					rows = rows.slice(startRow, startRow + rowWidth);
					
					rows.forEach((row, i) => {
						row.updateData(data[i % dataLength]);
					});
					
					this.table.restoreRedraw();
				}
			}
		}
		
		return rows;
	}
};

var pasteParsers = {
	range:function(clipboard){
		var data = [],
		rows = [],
		range = this.table.modules.selectRange.activeRange,
		singleCell = false,
		bounds, startCell, colWidth, columnMap, startCol;
		
		if(range){
			bounds = range.getBounds();
			startCell = bounds.start;

			if(bounds.start === bounds.end){
				singleCell = true;
			}
			
			if(startCell){
				//get data from clipboard into array of columns and rows.
				clipboard = clipboard.split("\n");
				
				clipboard.forEach(function(row){
					data.push(row.split("\t"));
				});
				
				if(data.length){
					columnMap = this.table.columnManager.getVisibleColumnsByIndex();
					startCol = columnMap.indexOf(startCell.column);

					if(startCol > -1){
						if(singleCell){
							colWidth = data[0].length;
						}else {
							colWidth = (columnMap.indexOf(bounds.end.column) - startCol) + 1;
						}

						columnMap = columnMap.slice(startCol, startCol + colWidth);

						data.forEach((item) => {
							var row = {};
							var itemLength = item.length;

							columnMap.forEach(function(col, i){
								row[col.field] = item[i % itemLength];
							});
							
							rows.push(row);	
						});

						return rows;
					}				
				}
			}
		}
		
		return false;
	}
};

var columnLookups = {
	range:function(){
		var columns = this.modules.selectRange.selectedColumns();

		if(this.columnManager.rowHeader){
			columns.unshift(this.columnManager.rowHeader);
		}

		return columns;
	},
};

var rowLookups = {
	range:function(){
		return this.modules.selectRange.selectedRows();
	},
};

var extensions = {
	keybindings:{
		bindings:bindings,
		actions:actions
	},
	clipboard:{
		pasteActions:pasteActions,
		pasteParsers:pasteParsers
	},
	export:{
		columnLookups:columnLookups,
		rowLookups:rowLookups,
	}
};

class SelectRange extends Module {
	
	static moduleName = "selectRange";
	static moduleInitOrder = 1;
	static moduleExtensions = extensions;
	
	constructor(table) {
		super(table);
		
		this.selecting = "cell";
		this.mousedown = false;
		this.ranges = [];
		this.overlay = null;
		this.rowHeader = null;
		this.layoutChangeTimeout = null;
		this.columnSelection = false;
		this.rowSelection = false;
		this.maxRanges = 0;
		this.activeRange = false;
		this.blockKeydown = false;
		
		this.keyDownEvent = this._handleKeyDown.bind(this);
		this.mouseUpEvent = this._handleMouseUp.bind(this);
		
		this.registerTableOption("selectableRange", false); //enable selectable range
		this.registerTableOption("selectableRangeColumns", false); //enable selectable range
		this.registerTableOption("selectableRangeRows", false); //enable selectable range
		this.registerTableOption("selectableRangeClearCells", false); //allow clearing of active range
		this.registerTableOption("selectableRangeClearCellsValue", undefined); //value for cleared active range
		this.registerTableOption("selectableRangeAutoFocus", true); //focus on a cell after resetRanges
		
		this.registerTableFunction("getRangesData", this.getRangesData.bind(this));
		this.registerTableFunction("getRanges", this.getRanges.bind(this));
		this.registerTableFunction("addRange", this.addRangeFromComponent.bind(this));
		
		this.registerComponentFunction("cell", "getRanges", this.cellGetRanges.bind(this));
		this.registerComponentFunction("row", "getRanges", this.rowGetRanges.bind(this));
		this.registerComponentFunction("column", "getRanges", this.colGetRanges.bind(this));
	}
	
	///////////////////////////////////
	///////    Initialization   ///////
	///////////////////////////////////
	
	initialize() {
		if (this.options("selectableRange")) {	
			if(!this.options("selectableRows")){
				this.maxRanges = this.options("selectableRange");
				
				this.initializeTable();
				this.initializeWatchers();
			}else {
				console.warn("SelectRange functionality cannot be used in conjunction with row selection");
			}

			if(this.options('columns').findIndex((column) => column.frozen) > 0) {
				console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior.");
			}

			if(this.options('columns').filter((column) => column.frozen) > 1) {
				console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior.");
			}
		}
	}
	
	
	initializeTable() {		
		this.overlay = document.createElement("div");
		this.overlay.classList.add("tabulator-range-overlay");
		
		this.rangeContainer = document.createElement("div");
		this.rangeContainer.classList.add("tabulator-range-container");
		
		this.activeRangeCellElement = document.createElement("div");
		this.activeRangeCellElement.classList.add("tabulator-range-cell-active");
		
		this.overlay.appendChild(this.rangeContainer);
		this.overlay.appendChild(this.activeRangeCellElement);
		
		this.table.rowManager.element.addEventListener("keydown", this.keyDownEvent);
		
		this.resetRanges();
		
		this.table.rowManager.element.appendChild(this.overlay);
		this.table.columnManager.element.setAttribute("tabindex", 0);
		this.table.element.classList.add("tabulator-ranges");
	}
	
	initializeWatchers() {
		this.columnSelection = this.options("selectableRangeColumns");
		this.rowSelection = this.options("selectableRangeRows");
		
		this.subscribe("column-init", this.initializeColumn.bind(this));
		this.subscribe("column-mousedown", this.handleColumnMouseDown.bind(this));
		this.subscribe("column-mousemove", this.handleColumnMouseMove.bind(this));
		this.subscribe("column-resized", this.handleColumnResized.bind(this));
		this.subscribe("column-moving", this.handleColumnMoving.bind(this));
		this.subscribe("column-moved", this.handleColumnMoved.bind(this));
		this.subscribe("column-width", this.layoutChange.bind(this));
		this.subscribe("column-height", this.layoutChange.bind(this));
		this.subscribe("column-resized", this.layoutChange.bind(this));
		this.subscribe("columns-loaded", this.updateHeaderColumn.bind(this));
		
		this.subscribe("cell-height", this.layoutChange.bind(this));
		this.subscribe("cell-rendered", this.renderCell.bind(this));
		this.subscribe("cell-mousedown", this.handleCellMouseDown.bind(this));
		this.subscribe("cell-mousemove", this.handleCellMouseMove.bind(this));
		this.subscribe("cell-click", this.handleCellClick.bind(this));
		this.subscribe("cell-editing", this.handleEditingCell.bind(this));
		
		this.subscribe("page-changed", this.redraw.bind(this));
		
		this.subscribe("scroll-vertical", this.layoutChange.bind(this));
		this.subscribe("scroll-horizontal", this.layoutChange.bind(this));
		
		this.subscribe("data-destroy", this.tableDestroyed.bind(this));
		this.subscribe("data-processed", this.resetRanges.bind(this));
		
		this.subscribe("table-layout", this.layoutElement.bind(this));
		this.subscribe("table-redraw", this.redraw.bind(this));
		this.subscribe("table-destroy", this.tableDestroyed.bind(this));
		
		this.subscribe("edit-editor-clear", this.finishEditingCell.bind(this));
		this.subscribe("edit-blur", this.restoreFocus.bind(this));
		
		this.subscribe("keybinding-nav-prev", this.keyNavigate.bind(this, "left"));
		this.subscribe("keybinding-nav-next", this.keyNavigate.bind(this, "right"));
		this.subscribe("keybinding-nav-left", this.keyNavigate.bind(this, "left"));
		this.subscribe("keybinding-nav-right", this.keyNavigate.bind(this, "right"));
		this.subscribe("keybinding-nav-up", this.keyNavigate.bind(this, "up"));
		this.subscribe("keybinding-nav-down", this.keyNavigate.bind(this, "down"));
		this.subscribe("keybinding-nav-range", this.keyNavigateRange.bind(this));
	}
	
	
	initializeColumn(column) {
		if(this.columnSelection && column.definition.headerSort && this.options("headerSortClickElement") !== "icon"){
			console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'.");
		}
		
		if (column.modules.edit) ;
	}
	
	updateHeaderColumn(){
		var frozenCols;

		if(this.rowSelection){
			this.rowHeader = this.table.columnManager.getVisibleColumnsByIndex()[0];
			
			if(this.rowHeader){
				this.rowHeader.definition.cssClass = this.rowHeader.definition.cssClass + " tabulator-range-row-header";
				
				if(this.rowHeader.definition.headerSort){
					console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior");
				}
				
				if(this.rowHeader.definition.editor){
					console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior");
				}
			}
		}

		//warn if invalid frozen column configuration detected
		if(this.table.modules.frozenColumns && this.table.modules.frozenColumns.active){
			frozenCols = this.table.modules.frozenColumns.getFrozenColumns();

			if(frozenCols.length > 1 || (frozenCols.length === 1 && frozenCols[0] !== this.rowHeader)){
				console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior");
			}
		}
	}
	
	///////////////////////////////////
	///////   Table Functions   ///////
	///////////////////////////////////
	
	getRanges(){
		return this.ranges.map((range) => range.getComponent());
	}
	
	getRangesData() {
		return this.ranges.map((range) => range.getData());
	}
	
	addRangeFromComponent(start, end){
		start = start ? start._cell : null;
		end = end ? end._cell : null;
		
		return this.addRange(start, end);
	}
	
	///////////////////////////////////
	/////// Component Functions ///////
	///////////////////////////////////
	
	cellGetRanges(cell){
		var ranges = [];
		
		if (cell.column === this.rowHeader) {
			ranges = this.ranges.filter((range) => range.occupiesRow(cell.row));
		} else {
			ranges = this.ranges.filter((range) => range.occupies(cell));
		}
		
		return ranges.map((range) => range.getComponent());
	}
	
	rowGetRanges(row){
		var ranges = this.ranges.filter((range) => range.occupiesRow(row));
		
		return ranges.map((range) => range.getComponent());
	}
	
	colGetRanges(col){
		var ranges = this.ranges.filter((range) => range.occupiesColumn(col));
		
		return ranges.map((range) => range.getComponent());
	}
	
	///////////////////////////////////
	////////// Event Handlers /////////
	///////////////////////////////////
	
	_handleMouseUp(e){
		this.mousedown = false;
		document.removeEventListener("mouseup", this.mouseUpEvent);
	}
	
	_handleKeyDown(e) {
		if (!this.blockKeydown && (!this.table.modules.edit || (this.table.modules.edit && !this.table.modules.edit.currentCell))) {
			if (e.key === "Enter") {
				// is editing a cell?
				if (this.table.modules.edit && this.table.modules.edit.currentCell) {
					return;
				}
				
				this.table.modules.edit.editCell(this.getActiveCell());
				
				e.preventDefault();
			}
			
			if ((e.key === "Backspace" || e.key === "Delete") && this.options("selectableRangeClearCells")) {
				if(this.activeRange){
					this.activeRange.clearValues();
				}
			}
		}
	}
	
	initializeFocus(cell){
		var range;

		this.restoreFocus();
		
		try{
			if (document.selection) { // IE
				range = document.body.createTextRange();
				range.moveToElementText(cell.getElement());
				range.select();
			} else if (window.getSelection) {
				range = document.createRange();
				range.selectNode(cell.getElement());
				window.getSelection().removeAllRanges();
				window.getSelection().addRange(range);
			}
		}catch(e){}
	}
	
	restoreFocus(element){
		this.table.rowManager.element.focus();
		
		return true;
	}
	
	///////////////////////////////////
	////// Column Functionality ///////
	///////////////////////////////////
	
	handleColumnResized(column) {
		var selected;
		
		if (this.selecting !== "column" && this.selecting !== "all") {
			return;
		}
		
		selected = this.ranges.some((range) => range.occupiesColumn(column));
		
		if (!selected) {
			return;
		}
		
		this.ranges.forEach((range) => {
			var selectedColumns = range.getColumns(true);
			
			selectedColumns.forEach((selectedColumn) => {
				if (selectedColumn !== column) {
					selectedColumn.setWidth(column.width);
				}
			});
		});
	}
	
	handleColumnMoving(_event, column) {
		this.resetRanges().setBounds(column);
		this.overlay.style.visibility = "hidden";
	}

	handleColumnMoved(from, _to, _after) {
		this.activeRange.setBounds(from);
		this.layoutElement();
	}

	handleColumnMouseDown(event, column) {
		if (event.button === 2 && (this.selecting === "column" || this.selecting === "all") && this.activeRange.occupiesColumn(column)) {
			return;
		}

		//If columns are movable, allow dragging columns only if they are not
		//selected. Dragging selected columns should move the columns instead.
		if(this.table.options.movableColumns && this.selecting === "column" && this.activeRange.occupiesColumn(column)){
			return;
		}
		
		this.mousedown = true;
		
		document.addEventListener("mouseup", this.mouseUpEvent);
		
		this.newSelection(event, column);
	}
	
	handleColumnMouseMove(e, column) {
		if (column === this.rowHeader || !this.mousedown || this.selecting === 'all') {
			return;
		}
		
		this.activeRange.setBounds(false, column, true);
	}
	
	///////////////////////////////////
	//////// Cell Functionality ///////
	///////////////////////////////////
	
	renderCell(cell) {
		var el = cell.getElement(),
		rangeIdx = this.ranges.findIndex((range) => range.occupies(cell));
		
		el.classList.toggle("tabulator-range-selected", rangeIdx !== -1);
		el.classList.toggle("tabulator-range-only-cell-selected", this.ranges.length === 1 && this.ranges[0].atTopLeft(cell) &&	this.ranges[0].atBottomRight(cell));
		
		el.dataset.range = rangeIdx;
	}
	
	handleCellMouseDown(event, cell) {
		if (event.button === 2 && (this.activeRange.occupies(cell) || ((this.selecting === "row" || this.selecting === "all") && this.activeRange.occupiesRow(cell.row)))) {
			return;
		}
		
		this.mousedown = true;
		
		document.addEventListener("mouseup", this.mouseUpEvent);
		
		this.newSelection(event, cell);
	}
	
	handleCellMouseMove(e, cell) {
		if (!this.mousedown || this.selecting === "all") {
			return;
		}
		
		this.activeRange.setBounds(false, cell, true);
	}
	
	handleCellClick(e, cell){
		this.initializeFocus(cell);
	}
	
	handleEditingCell(cell) {
		if(this.activeRange){
			this.activeRange.setBounds(cell);
		}
	}
	
	finishEditingCell() {
		this.blockKeydown = true;
		this.table.rowManager.element.focus();
		
		setTimeout(() => {
			this.blockKeydown = false;
		}, 10);
	}
	
	///////////////////////////////////
	///////     Navigation      ///////
	///////////////////////////////////
	
	keyNavigate(dir, e){
		if(this.navigate(false, false, dir));
		e.preventDefault();
	}
	
	keyNavigateRange(e, dir, jump, expand){
		if(this.navigate(jump, expand, dir));
		e.preventDefault();
	}
	
	navigate(jump, expand, dir) {
		var moved = false,
		range, rangeEdge, prevRect, nextRow, nextCol, row, column,
		rowRect, rowManagerRect, columnRect, columnManagerRect;
		
		// Don't navigate while editing
		if (this.table.modules.edit && this.table.modules.edit.currentCell) {
			return false;
		}
		
		// If there are more than 1 range, use the active range and destroy the others
		if (this.ranges.length > 1) {
			this.ranges = this.ranges.filter((range) => {
				if (range === this.activeRange) {
					range.setEnd(range.start.row, range.start.col);
					return true;
				}
				range.destroy();
				return false;
			});
		}
		
		range = this.activeRange;
		prevRect = {
			top: range.top,
			bottom: range.bottom,
			left: range.left,
			right: range.right
		};
		
		rangeEdge = expand ? range.end : range.start;
		nextRow = rangeEdge.row;
		nextCol = rangeEdge.col;
		
		if(jump){
			switch(dir){
				case "left":
					nextCol = this.findJumpCellLeft(range.start.row, rangeEdge.col);
					break;
				case "right":
					nextCol = this.findJumpCellRight(range.start.row, rangeEdge.col);
					break;
				case "up":
					nextRow = this.findJumpCellUp(rangeEdge.row, range.start.col);
					break;
				case "down":
					nextRow = this.findJumpCellDown(rangeEdge.row, range.start.col);
					break;
			}
		}else {
			if(expand){
				if ((this.selecting === 'row' && (dir === 'left' || dir === 'right')) || (this.selecting === 'column' && (dir === 'up' || dir === 'down'))) {
					return;
				}
			}
			
			switch(dir){
				case "left":
					nextCol = Math.max(nextCol - 1, 0);
					break;
				case "right":
					nextCol = Math.min(nextCol + 1, this.getTableColumns().length - 1);
					break;
				case "up":
					nextRow = Math.max(nextRow - 1, 0);
					break;
				case "down":
					nextRow = Math.min(nextRow + 1, this.getTableRows().length - 1);
					break;
			}
		}

		if(this.rowHeader && nextCol === 0) {
			nextCol = 1;
		}
		
		if(!expand){
			range.setStart(nextRow, nextCol);
		}
		
		range.setEnd(nextRow, nextCol);
		
		if(!expand){
			this.selecting = "cell";
		}

		moved = prevRect.top !== range.top || prevRect.bottom !== range.bottom || prevRect.left !== range.left || prevRect.right !== range.right;

		if (moved) {
			row = this.getRowByRangePos(range.end.row);
			column = this.getColumnByRangePos(range.end.col);
			rowRect = row.getElement().getBoundingClientRect();
			columnRect = column.getElement().getBoundingClientRect();
			rowManagerRect = this.table.rowManager.getElement().getBoundingClientRect();
			columnManagerRect = this.table.columnManager.getElement().getBoundingClientRect();
			
			if(!(rowRect.top >= rowManagerRect.top && rowRect.bottom <= rowManagerRect.bottom)){
				if(row.getElement().parentNode && column.getElement().parentNode){
					// Use faster autoScroll when the elements are on the DOM
					this.autoScroll(range, row.getElement(), column.getElement());
				}else {
					row.getComponent().scrollTo(undefined, false);
				}
			}

			if(!(columnRect.left >= columnManagerRect.left + this.getRowHeaderWidth() && columnRect.right <= columnManagerRect.right)){
				if(row.getElement().parentNode && column.getElement().parentNode){
					// Use faster autoScroll when the elements are on the DOM
					this.autoScroll(range, row.getElement(), column.getElement());
				}else {
					column.getComponent().scrollTo(undefined, false);
				}
			}

			this.layoutElement();
			
			return true;
		}
	}
	
	rangeRemoved(removed){
		this.ranges = this.ranges.filter((range) => range !== removed);
		
		if(this.activeRange === removed){
			if(this.ranges.length){
				this.activeRange = this.ranges[this.ranges.length - 1];
			}else {
				this.addRange();
			}
		}
		
		this.layoutElement();
	}
	
	findJumpRow(column, rows, reverse, emptyStart, emptySide){
		if(reverse){
			rows = rows.reverse();
		}

		return this.findJumpItem(emptyStart, emptySide, rows, function(row){return row.getData()[column.getField()];});
	}
	
	findJumpCol(row, columns, reverse, emptyStart, emptySide){
		if(reverse){
			columns = columns.reverse();
		}

		return this.findJumpItem(emptyStart, emptySide, columns, function(column){return row.getData()[column.getField()];});
	}

	findJumpItem(emptyStart, emptySide, items, valueResolver){
		var nextItem;

		for(let currentItem of items){
			let currentValue = valueResolver(currentItem);
			
			if(emptyStart){
				nextItem = currentItem;
				if(currentValue){
					break;
				}
			}else {
				if(emptySide){
					nextItem = currentItem;
					
					if(currentValue){
						break;
					}
				}else {
					if(currentValue){
						nextItem = currentItem;
					}else {
						break;
					}
				}
			}
		}

		return nextItem;
	}

	findJumpCellLeft(rowPos, colPos){
		var row = this.getRowByRangePos(rowPos),
		columns = this.getTableColumns(),
		isStartingCellEmpty = this.isEmpty(row.getData()[columns[colPos].getField()]),
		isLeftOfStartingCellEmpty = columns[colPos - 1] ? this.isEmpty(row.getData()[columns[colPos - 1].getField()]) : false,
		targetCols = this.rowHeader ? columns.slice(1, colPos) : columns.slice(0, colPos),
		jumpCol = this.findJumpCol(row, targetCols, true, isStartingCellEmpty, isLeftOfStartingCellEmpty);
		
		if(jumpCol){
			return jumpCol.getPosition() - 1;
		}
		
		return colPos;
	}
	
	findJumpCellRight(rowPos, colPos){
		var row = this.getRowByRangePos(rowPos),
		columns = this.getTableColumns(),
		isStartingCellEmpty = this.isEmpty(row.getData()[columns[colPos].getField()]),
		isRightOfStartingCellEmpty = columns[colPos + 1] ? this.isEmpty(row.getData()[columns[colPos + 1].getField()]) : false,
		jumpCol = this.findJumpCol(row, columns.slice(colPos + 1, columns.length), false, isStartingCellEmpty, isRightOfStartingCellEmpty);
		
		if(jumpCol){
			return jumpCol.getPosition() - 1;
		}
		
		return colPos;
	}
	
	findJumpCellUp(rowPos, colPos) {
		var column = this.getColumnByRangePos(colPos),
		rows = this.getTableRows(),
		isStartingCellEmpty = this.isEmpty(rows[rowPos].getData()[column.getField()]),
		isTopOfStartingCellEmpty = rows[rowPos - 1] ? this.isEmpty(rows[rowPos - 1].getData()[column.getField()]) : false,
		jumpRow = this.findJumpRow(column, rows.slice(0, rowPos), true, isStartingCellEmpty, isTopOfStartingCellEmpty);
		
		if(jumpRow){
			return jumpRow.position - 1;
		}
		
		return rowPos;
	}
	
	findJumpCellDown(rowPos, colPos) {
		var column = this.getColumnByRangePos(colPos),
		rows = this.getTableRows(),
		isStartingCellEmpty = this.isEmpty(rows[rowPos].getData()[column.getField()]),
		isBottomOfStartingCellEmpty = rows[rowPos + 1] ? this.isEmpty(rows[rowPos + 1].getData()[column.getField()]) : false,
		jumpRow = this.findJumpRow(column, rows.slice(rowPos + 1, rows.length), false, isStartingCellEmpty, isBottomOfStartingCellEmpty);
		
		if(jumpRow){
			return jumpRow.position - 1;
		}
		
		return rowPos;
	}
	
	///////////////////////////////////
	///////      Selection      ///////
	///////////////////////////////////
	newSelection(event, element) {
		var range;
		
		if (element.type === "column") {
			if(!this.columnSelection){
				return;
			}
			
			if (element === this.rowHeader) {
				range = this.resetRanges();
				this.selecting = "all";
				
				var topLeftCell, bottomRightCell = this.getCell(-1, -1);
				
				if(this.rowHeader){
					topLeftCell = this.getCell(0, 1);
				}else {
					topLeftCell = this.getCell(0, 0);
				}
				
				range.setBounds(topLeftCell, bottomRightCell);		
				return;
			} else {
				this.selecting = "column";
			}
		} else if (element.column === this.rowHeader) {
			this.selecting = "row";
		} else {
			this.selecting = "cell";
		}
		
		if (event.shiftKey) {
			this.activeRange.setBounds(false, element);
		} else if (event.ctrlKey) {
			this.addRange().setBounds(element);
		} else {
			this.resetRanges().setBounds(element);
		}
	}
	
	autoScroll(range, row, column) {
		var tableHolder = this.table.rowManager.element,
		rect, view, withinHorizontalView, withinVerticalView;
		
		if (typeof row === 'undefined') {
			row = this.getRowByRangePos(range.end.row).getElement();
		}
		
		if (typeof column === 'undefined') {
			column = this.getColumnByRangePos(range.end.col).getElement();
		}
		
		rect = {
			left: column.offsetLeft,
			right: column.offsetLeft + column.offsetWidth,
			top: row.offsetTop,
			bottom: row.offsetTop + row.offsetHeight,
		};
		
		view = {
			left: tableHolder.scrollLeft + this.getRowHeaderWidth(),
			right: Math.ceil(tableHolder.scrollLeft + tableHolder.clientWidth),
			top: tableHolder.scrollTop,
			bottom:	tableHolder.scrollTop +	tableHolder.offsetHeight - this.table.rowManager.scrollbarWidth,
		};
		
		withinHorizontalView = view.left < rect.left &&	rect.left < view.right && view.left < rect.right &&	rect.right < view.right;
		
		withinVerticalView = view.top < rect.top &&	rect.top < view.bottom && view.top < rect.bottom &&	rect.bottom < view.bottom;
		
		if (!withinHorizontalView) {
			if (rect.left < view.left) {
				tableHolder.scrollLeft = rect.left - this.getRowHeaderWidth();
			} else if (rect.right > view.right) {
				tableHolder.scrollLeft = Math.min(rect.right - tableHolder.clientWidth, rect.left - this.getRowHeaderWidth());
			}
		}
		
		if (!withinVerticalView) {
			if (rect.top < view.top) {
				tableHolder.scrollTop = rect.top;
			} else if (rect.bottom > view.bottom) {
				tableHolder.scrollTop = rect.bottom - tableHolder.clientHeight;
			}
		}
	}
	
	
	///////////////////////////////////
	///////       Layout        ///////
	///////////////////////////////////
	
	layoutChange(){
		this.overlay.style.visibility = "hidden";
		clearTimeout(this.layoutChangeTimeout);
		this.layoutChangeTimeout = setTimeout(this.layoutRanges.bind(this), 200);
	}
	
	redraw(force) {
		if (force) {
			this.selecting = 'cell';
			this.resetRanges();
			this.layoutElement();
		}
	}
	
	layoutElement(visibleRows) {
		var rows;
		
		if (visibleRows) {
			rows = this.table.rowManager.getVisibleRows(true);
		} else {
			rows = this.table.rowManager.getRows();
		}
		
		rows.forEach((row) => {
			if (row.type === "row") {
				this.layoutRow(row);
				row.cells.forEach((cell) => this.renderCell(cell));
			}
		});
		
		this.getTableColumns().forEach((column) => {
			this.layoutColumn(column);
		});
		
		this.layoutRanges();
	}
	
	layoutRow(row) {
		var el = row.getElement(),
		selected = false,
		occupied = this.ranges.some((range) => range.occupiesRow(row));
		
		if (this.selecting === "row") {
			selected = occupied;
		} else if (this.selecting === "all") {
			selected = true;
		}
		
		el.classList.toggle("tabulator-range-selected", selected);
		el.classList.toggle("tabulator-range-highlight", occupied);
	}
	
	layoutColumn(column) {
		var el = column.getElement(),		
		selected = false,
		occupied = this.ranges.some((range) => range.occupiesColumn(column));
		
		if (this.selecting === "column") {
			selected = occupied;
		} else if (this.selecting === "all") {
			selected = true;
		}
		
		el.classList.toggle("tabulator-range-selected", selected);
		el.classList.toggle("tabulator-range-highlight", occupied);
	}
	
	layoutRanges() {
		var activeCell, activeCellEl, activeRowEl;
		
		if (!this.table.initialized) {
			return;
		}
		
		activeCell = this.getActiveCell();
		
		if (!activeCell) {
			return;
		}

		activeCellEl = activeCell.getElement();
		activeRowEl = activeCell.row.getElement();

		if(this.table.rtl){
			this.activeRangeCellElement.style.right = activeRowEl.offsetWidth - activeCellEl.offsetLeft - activeCellEl.offsetWidth + "px";
		}else {
			this.activeRangeCellElement.style.left = activeRowEl.offsetLeft + activeCellEl.offsetLeft + "px";
		}

		this.activeRangeCellElement.style.top =	activeRowEl.offsetTop + "px";
		this.activeRangeCellElement.style.width = activeCellEl.offsetWidth + "px";
		this.activeRangeCellElement.style.height =  activeRowEl.offsetHeight  + "px";
		
		this.ranges.forEach((range) => range.layout());
		
		this.overlay.style.visibility = "visible";
	}
	
	
	///////////////////////////////////
	///////  Helper Functions   ///////
	///////////////////////////////////	
	
	getCell(rowIdx, colIdx) {
		var row;
		
		if (colIdx < 0) {
			colIdx = this.getTableColumns().length + colIdx;
			if (colIdx < 0) {
				return null;
			}
		}
		
		if (rowIdx < 0) {
			rowIdx = this.getTableRows().length + rowIdx;
		}
		
		row = this.table.rowManager.getRowFromPosition(rowIdx + 1);
		
		return row ? row.getCells(false, true).filter((cell) => cell.column.visible)[colIdx] : null;
	}
	
	
	getActiveCell() {
		return this.getCell(this.activeRange.start.row, this.activeRange.start.col);
	}
	
	getRowByRangePos(pos) {
		return this.getTableRows()[pos];
	}
	
	getColumnByRangePos(pos) {
		return this.getTableColumns()[pos];
	}
	
	getTableRows() {
		return this.table.rowManager.getDisplayRows().filter(row=> row.type === "row");
	}
	
	getTableColumns() {
		return this.table.columnManager.getVisibleColumnsByIndex();
	}
	
	addRange(start, end) {
		var  range;
		
		if(this.maxRanges !== true && this.ranges.length >= this.maxRanges){
			this.ranges.shift().destroy();
		}
		
		range = new Range(this.table, this, start, end);
		
		this.activeRange = range;
		this.ranges.push(range);
		this.rangeContainer.appendChild(range.element);
		
		return range;
	}
	
	resetRanges() {
		var range, cell, visibleCells;
		
		this.ranges.forEach((range) => range.destroy());
		this.ranges = [];
		
		range = this.addRange();
		
		if(this.table.rowManager.activeRows.length){
			visibleCells = this.table.rowManager.activeRows[0].cells.filter((cell) => cell.column.visible);
			cell = visibleCells[this.rowHeader ? 1 : 0];

			if(cell){
				range.setBounds(cell);
				if(this.options("selectableRangeAutoFocus")){
					this.initializeFocus(cell);
				}
			}
		}
		
		return range;
	}
	
	tableDestroyed(){
		document.removeEventListener("mouseup", this.mouseUpEvent);
		this.table.rowManager.element.removeEventListener("keydown", this.keyDownEvent);
	}
	
	selectedRows(component) {
		return component ? this.activeRange.getRows().map((row) => row.getComponent()) : this.activeRange.getRows();
	}
	
	selectedColumns(component) {
		return component ? this.activeRange.getColumns().map((col) => col.getComponent()) : this.activeRange.getColumns();
	}

	getRowHeaderWidth(){
		if(!this.rowHeader){
			return 0;
		}
		return this.rowHeader.getElement().offsetWidth;
	}

	isEmpty(value) {
		return value === null || value === undefined || value === "";
	}
}

//sort numbers
function number(a, b, aRow, bRow, column, dir, params){
	var alignEmptyValues = params.alignEmptyValues;
	var decimal = params.decimalSeparator;
	var thousand = params.thousandSeparator;
	var emptyAlign = 0;

	a = String(a);
	b = String(b);

	if(thousand){
		a = a.split(thousand).join("");
		b = b.split(thousand).join("");
	}

	if(decimal){
		a = a.split(decimal).join(".");
		b = b.split(decimal).join(".");
	}

	a = parseFloat(a);
	b = parseFloat(b);

	//handle non numeric values
	if(isNaN(a)){
		emptyAlign =  isNaN(b) ? 0 : -1;
	}else if(isNaN(b)){
		emptyAlign =  1;
	}else {
		//compare valid values
		return a - b;
	}

	//fix empty values in position
	if((alignEmptyValues === "top" && dir === "desc") || (alignEmptyValues === "bottom" && dir === "asc")){
		emptyAlign *= -1;
	}

	return emptyAlign;
}

//sort strings
function string(a, b, aRow, bRow, column, dir, params){
	var alignEmptyValues = params.alignEmptyValues;
	var emptyAlign = 0;
	var locale;

	//handle empty values
	if(!a){
		emptyAlign =  !b ? 0 : -1;
	}else if(!b){
		emptyAlign =  1;
	}else {
		//compare valid values
		switch(typeof params.locale){
			case "boolean":
				if(params.locale){
					locale = this.langLocale();
				}
				break;
			case "string":
				locale = params.locale;
				break;
		}

		return String(a).toLowerCase().localeCompare(String(b).toLowerCase(), locale);
	}

	//fix empty values in position
	if((alignEmptyValues === "top" && dir === "desc") || (alignEmptyValues === "bottom" && dir === "asc")){
		emptyAlign *= -1;
	}

	return emptyAlign;
}

//sort datetime
function datetime(a, b, aRow, bRow, column, dir, params){
	var DT = this.table.dependencyRegistry.lookup(["luxon", "DateTime"], "DateTime");
	var format = params.format || "dd/MM/yyyy HH:mm:ss",
	alignEmptyValues = params.alignEmptyValues,
	emptyAlign = 0;

	if(typeof DT != "undefined"){
		if(!DT.isDateTime(a)){
			if(format === "iso"){
				a = DT.fromISO(String(a));
			}else {
				a = DT.fromFormat(String(a), format);
			}
		}

		if(!DT.isDateTime(b)){
			if(format === "iso"){
				b = DT.fromISO(String(b));
			}else {
				b = DT.fromFormat(String(b), format);
			}
		}

		if(!a.isValid){
			emptyAlign = !b.isValid ? 0 : -1;
		}else if(!b.isValid){
			emptyAlign =  1;
		}else {
			//compare valid values
			return a - b;
		}

		//fix empty values in position
		if((alignEmptyValues === "top" && dir === "desc") || (alignEmptyValues === "bottom" && dir === "asc")){
			emptyAlign *= -1;
		}

		return emptyAlign;

	}else {
		console.error("Sort Error - 'datetime' sorter is dependant on luxon.js");
	}
}

//sort date
function date(a, b, aRow, bRow, column, dir, params){
	if(!params.format){
		params.format = "dd/MM/yyyy";
	}

	return datetime.call(this, a, b, aRow, bRow, column, dir, params);
}

//sort times
function time(a, b, aRow, bRow, column, dir, params){
	if(!params.format){
		params.format = "HH:mm";
	}

	return datetime.call(this, a, b, aRow, bRow, column, dir, params);
}

//sort booleans
function boolean(a, b, aRow, bRow, column, dir, params){
	var el1 = a === true || a === "true" || a === "True" || a === 1 ? 1 : 0;
	var el2 = b === true || b === "true" || b === "True" || b === 1 ? 1 : 0;

	return el1 - el2;
}

//sort if element contains any data
function array(a, b, aRow, bRow, column, dir, params){
	var type = params.type || "length",
	alignEmptyValues = params.alignEmptyValues,
	emptyAlign = 0,
	table = this.table,
	valueMap;

	if(params.valueMap){
		if(typeof params.valueMap === "string"){
			valueMap = function(value){
				return value.map((item) => {
					return Helpers.retrieveNestedData(table.options.nestedFieldSeparator, params.valueMap, item);
				});
			};
		}else {
			valueMap = params.valueMap;
		}
	}

	function calc(value){
		var result;
		
		if(valueMap){
			value = valueMap(value);
		}

		switch(type){
			case "length":
				result = value.length;
				break;

			case "sum":
				result = value.reduce(function(c, d){
					return c + d;
				});
				break;

			case "max":
				result = Math.max.apply(null, value) ;
				break;

			case "min":
				result = Math.min.apply(null, value) ;
				break;

			case "avg":
				result = value.reduce(function(c, d){
					return c + d;
				}) / value.length;
				break;

			case "string":
				result = value.join("");
				break;
		}

		return result;
	}

	//handle non array values
	if(!Array.isArray(a)){
		emptyAlign = !Array.isArray(b) ? 0 : -1;
	}else if(!Array.isArray(b)){
		emptyAlign = 1;
	}else {
		if(type === "string"){
			return String(calc(a)).toLowerCase().localeCompare(String(calc(b)).toLowerCase());
		}else {
			return calc(b) - calc(a);
		}
	}

	//fix empty values in position
	if((alignEmptyValues === "top" && dir === "desc") || (alignEmptyValues === "bottom" && dir === "asc")){
		emptyAlign *= -1;
	}

	return emptyAlign;
}

//sort if element contains any data
function exists(a, b, aRow, bRow, column, dir, params){
	var el1 = typeof a == "undefined" ? 0 : 1;
	var el2 = typeof b == "undefined" ? 0 : 1;

	return el1 - el2;
}

//sort alpha numeric strings
function alphanum(as, bs, aRow, bRow, column, dir, params){
	var a, b, a1, b1, i= 0, L, rx = /(\d+)|(\D+)/g, rd = /\d/;
	var alignEmptyValues = params.alignEmptyValues;
	var emptyAlign = 0;

	//handle empty values
	if(!as && as!== 0){
		emptyAlign =  !bs && bs!== 0 ? 0 : -1;
	}else if(!bs && bs!== 0){
		emptyAlign =  1;
	}else {

		if(isFinite(as) && isFinite(bs)) return as - bs;
		a = String(as).toLowerCase();
		b = String(bs).toLowerCase();
		if(a === b) return 0;
		if(!(rd.test(a) && rd.test(b))) return a > b ? 1 : -1;
		a = a.match(rx);
		b = b.match(rx);
		L = a.length > b.length ? b.length : a.length;
		while(i < L){
			a1= a[i];
			b1= b[i++];
			if(a1 !== b1){
				if(isFinite(a1) && isFinite(b1)){
					if(a1.charAt(0) === "0") a1 = "." + a1;
					if(b1.charAt(0) === "0") b1 = "." + b1;
					return a1 - b1;
				}
				else return a1 > b1 ? 1 : -1;
			}
		}

		return a.length > b.length;
	}

	//fix empty values in position
	if((alignEmptyValues === "top" && dir === "desc") || (alignEmptyValues === "bottom" && dir === "asc")){
		emptyAlign *= -1;
	}

	return emptyAlign;
}

var defaultSorters = {
	number:number,
	string:string,
	date:date,
	time:time,
	datetime:datetime,
	boolean:boolean,
	array:array,
	exists:exists,
	alphanum:alphanum
};

class Sort extends Module{

	static moduleName = "sort";

	//load defaults
	static sorters = defaultSorters;
	
	constructor(table){
		super(table);
		
		this.sortList = []; //holder current sort
		this.changed = false; //has the sort changed since last render
		
		this.registerTableOption("sortMode", "local"); //local or remote sorting
		
		this.registerTableOption("initialSort", false); //initial sorting criteria
		this.registerTableOption("columnHeaderSortMulti", true); //multiple or single column sorting
		this.registerTableOption("sortOrderReverse", false); //reverse internal sort ordering
		this.registerTableOption("headerSortElement", "<div class='tabulator-arrow'></div>"); //header sort element
		this.registerTableOption("headerSortClickElement", "header"); //element which triggers sort when clicked
		
		this.registerColumnOption("sorter");
		this.registerColumnOption("sorterParams");
		
		this.registerColumnOption("headerSort", true);
		this.registerColumnOption("headerSortStartingDir");
		this.registerColumnOption("headerSortTristate");
		
	}
	
	initialize(){
		this.subscribe("column-layout", this.initializeColumn.bind(this));
		this.subscribe("table-built", this.tableBuilt.bind(this));
		this.registerDataHandler(this.sort.bind(this), 20);
		
		this.registerTableFunction("setSort", this.userSetSort.bind(this));
		this.registerTableFunction("getSorters", this.getSort.bind(this));
		this.registerTableFunction("clearSort", this.clearSort.bind(this));
		
		if(this.table.options.sortMode === "remote"){
			this.subscribe("data-params", this.remoteSortParams.bind(this));
		}
	}
	
	tableBuilt(){
		if(this.table.options.initialSort){
			this.setSort(this.table.options.initialSort);
		}
	}
	
	remoteSortParams(data, config, silent, params){
		var sorters = this.getSort();
		
		sorters.forEach((item) => {
			delete item.column;
		});
		
		params.sort = sorters;
		
		return params;
	}
	
	
	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////
	
	userSetSort(sortList, dir){
		this.setSort(sortList, dir);
		// this.table.rowManager.sorterRefresh();
		this.refreshSort();
	}
	
	clearSort(){
		this.clear();
		// this.table.rowManager.sorterRefresh();
		this.refreshSort();
	}
	
	
	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////
	
	//initialize column header for sorting
	initializeColumn(column){
		var sorter = false,
		colEl,
		arrowEl;
		
		switch(typeof column.definition.sorter){
			case "string":
				if(Sort.sorters[column.definition.sorter]){
					sorter = Sort.sorters[column.definition.sorter];
				}else {
					console.warn("Sort Error - No such sorter found: ", column.definition.sorter);
				}
				break;
			
			case "function":
				sorter = column.definition.sorter;
				break;
		}
		
		column.modules.sort = {
			sorter:sorter, dir:"none",
			params:column.definition.sorterParams || {},
			startingDir:column.definition.headerSortStartingDir || "asc",
			tristate: column.definition.headerSortTristate,
		};
		
		if(column.definition.headerSort !== false){
			
			colEl = column.getElement();
			
			colEl.classList.add("tabulator-sortable");
			
			arrowEl = document.createElement("div");
			arrowEl.classList.add("tabulator-col-sorter");
			
			switch(this.table.options.headerSortClickElement){
				case "icon":
					arrowEl.classList.add("tabulator-col-sorter-element");
					break;
				case "header":
					colEl.classList.add("tabulator-col-sorter-element");
					break;
				default:
					colEl.classList.add("tabulator-col-sorter-element");
					break;
			}
			
			switch(this.table.options.headerSortElement){
				case "function":
				//do nothing
					break;
				
				case "object":
					arrowEl.appendChild(this.table.options.headerSortElement);
					break;
				
				default:
					arrowEl.innerHTML = this.table.options.headerSortElement;
			}
			
			//create sorter arrow
			column.titleHolderElement.appendChild(arrowEl);
			
			column.modules.sort.element = arrowEl;
			
			this.setColumnHeaderSortIcon(column, "none");
			
			if(this.table.options.headerSortClickElement === "icon"){
				arrowEl.addEventListener("mousedown", (e) => {
					e.stopPropagation();
				});
			}
			
			//sort on click
			(this.table.options.headerSortClickElement === "icon" ? arrowEl : colEl).addEventListener("click", (e) => {
				var dir = "",
				sorters=[],
				match = false;
				
				if(column.modules.sort){
					if(column.modules.sort.tristate){
						if(column.modules.sort.dir == "none"){
							dir = column.modules.sort.startingDir;
						}else {
							if(column.modules.sort.dir == column.modules.sort.startingDir){
								dir = column.modules.sort.dir == "asc" ? "desc" : "asc";
							}else {
								dir = "none";
							}
						}
					}else {
						switch(column.modules.sort.dir){
							case "asc":
								dir = "desc";
								break;
							
							case "desc":
								dir = "asc";
								break;
							
							default:
								dir = column.modules.sort.startingDir;
						}
					}
					
					if (this.table.options.columnHeaderSortMulti && (e.shiftKey || e.ctrlKey)) {
						sorters = this.getSort();
						
						match = sorters.findIndex((sorter) => {
							return sorter.field === column.getField();
						});
						
						if(match > -1){
							sorters[match].dir = dir;
							
							match = sorters.splice(match, 1)[0];
							if(dir != "none"){
								sorters.push(match);
							}
						}else {
							if(dir != "none"){
								sorters.push({column:column, dir:dir});
							}
						}
						
						//add to existing sort
						this.setSort(sorters);
					}else {
						if(dir == "none"){
							this.clear();
						}else {
							//sort by column only
							this.setSort(column, dir);
						}
						
					}
					
					// this.table.rowManager.sorterRefresh(!this.sortList.length);
					this.refreshSort();
				}
			});
		}
	}
	
	refreshSort(){
		if(this.table.options.sortMode === "remote"){
			this.reloadData(null, false, false);
		}else {
			this.refreshData(true);
		}
		
		//TODO - Persist left position of row manager
		// left = this.scrollLeft;
		// this.scrollHorizontal(left);
	}
	
	//check if the sorters have changed since last use
	hasChanged(){
		var changed = this.changed;
		this.changed = false;
		return changed;
	}
	
	//return current sorters
	getSort(){
		var self = this,
		sorters = [];
		
		self.sortList.forEach(function(item){
			if(item.column){
				sorters.push({column:item.column.getComponent(), field:item.column.getField(), dir:item.dir});
			}
		});
		
		return sorters;
	}
	
	//change sort list and trigger sort
	setSort(sortList, dir){
		var self = this,
		newSortList = [];
		
		if(!Array.isArray(sortList)){
			sortList = [{column: sortList, dir:dir}];
		}
		
		sortList.forEach(function(item){
			var column;
			
			column = self.table.columnManager.findColumn(item.column);
			
			if(column){
				item.column = column;
				newSortList.push(item);
				self.changed = true;
			}else {
				console.warn("Sort Warning - Sort field does not exist and is being ignored: ", item.column);
			}
			
		});
		
		self.sortList = newSortList;
		
		this.dispatch("sort-changed");
	}
	
	//clear sorters
	clear(){
		this.setSort([]);
	}
	
	//find appropriate sorter for column
	findSorter(column){
		var row = this.table.rowManager.activeRows[0],
		sorter = "string",
		field, value;
		
		if(row){
			row = row.getData();
			field = column.getField();
			
			if(field){
				
				value = column.getFieldValue(row);
				
				switch(typeof value){
					case "undefined":
						sorter = "string";
						break;
					
					case "boolean":
						sorter = "boolean";
						break;
					
					default:
						if(!isNaN(value) && value !== ""){
							sorter = "number";
						}else {
							if(value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)){
								sorter = "alphanum";
							}
						}
						break;
				}
			}
		}
		
		return Sort.sorters[sorter];
	}
	
	//work through sort list sorting data
	sort(data, sortOnly){
		var self = this,
		sortList = this.table.options.sortOrderReverse ? self.sortList.slice().reverse() : self.sortList,
		sortListActual = [],
		rowComponents = [];
		
		if(this.subscribedExternal("dataSorting")){
			this.dispatchExternal("dataSorting", self.getSort());
		}
		
		if(!sortOnly) {
			self.clearColumnHeaders();
		}
		
		if(this.table.options.sortMode !== "remote"){
			
			//build list of valid sorters and trigger column specific callbacks before sort begins
			sortList.forEach(function(item, i){
				var sortObj;
				
				if(item.column){
					sortObj = item.column.modules.sort;
					
					if(sortObj){
						
						//if no sorter has been defined, take a guess
						if(!sortObj.sorter){
							sortObj.sorter = self.findSorter(item.column);
						}
						
						item.params = typeof sortObj.params === "function" ? sortObj.params(item.column.getComponent(), item.dir) : sortObj.params;
						
						sortListActual.push(item);
					}
					
					if(!sortOnly) {
						self.setColumnHeader(item.column, item.dir);
					}
				}
			});
			
			//sort data
			if (sortListActual.length) {
				self._sortItems(data, sortListActual);
			}
			
		}else if(!sortOnly) {
			sortList.forEach(function(item, i){
				self.setColumnHeader(item.column, item.dir);
			});
		}

		
		if(this.subscribedExternal("dataSorted")){
			data.forEach((row) => {
				rowComponents.push(row.getComponent());
			});
			
			this.dispatchExternal("dataSorted", self.getSort(), rowComponents);
		}
		
		return data;
	}
	
	//clear sort arrows on columns
	clearColumnHeaders(){
		this.table.columnManager.getRealColumns().forEach((column) => {
			if(column.modules.sort){
				column.modules.sort.dir = "none";
				column.getElement().setAttribute("aria-sort", "none");
				this.setColumnHeaderSortIcon(column, "none");
			}
		});
	}
	
	//set the column header sort direction
	setColumnHeader(column, dir){
		column.modules.sort.dir = dir;
		column.getElement().setAttribute("aria-sort", dir === "asc" ? "ascending" : "descending");
		this.setColumnHeaderSortIcon(column, dir);
	}
	
	setColumnHeaderSortIcon(column, dir){
		var sortEl = column.modules.sort.element,
		arrowEl;
		
		if(column.definition.headerSort && typeof this.table.options.headerSortElement === "function"){
			while(sortEl.firstChild) sortEl.removeChild(sortEl.firstChild);
			
			arrowEl = this.table.options.headerSortElement.call(this.table, column.getComponent(), dir);
			
			if(typeof arrowEl === "object"){
				sortEl.appendChild(arrowEl);
			}else {
				sortEl.innerHTML = arrowEl;
			}
		}
	}
	
	//sort each item in sort list
	_sortItems(data, sortList){
		var sorterCount = sortList.length - 1;
		
		data.sort((a, b) => {
			var result;
			
			for(var i = sorterCount; i>= 0; i--){
				let sortItem = sortList[i];
				
				result = this._sortRow(a, b, sortItem.column, sortItem.dir, sortItem.params);
				
				if(result !== 0){
					break;
				}
			}
			
			return result;
		});
	}
	
	//process individual rows for a sort function on active data
	_sortRow(a, b, column, dir, params){
		var el1Comp, el2Comp;
		
		//switch elements depending on search direction
		var el1 = dir == "asc" ? a : b;
		var el2 = dir == "asc" ? b : a;
		
		a = column.getFieldValue(el1.getData());
		b = column.getFieldValue(el2.getData());
		
		a = typeof a !== "undefined" ? a : "";
		b = typeof b !== "undefined" ? b : "";
		
		el1Comp = el1.getComponent();
		el2Comp = el2.getComponent();
		
		return column.modules.sort.sorter.call(this, a, b, el1Comp, el2Comp, column.getComponent(), dir, params);
	}
}

class GridCalculator{
	constructor(columns, rows){
		this.columnCount = columns;
		this.rowCount = rows;

		this.columnString = [];
		this.columns = [];
		this.rows = [];
	}

	genColumns(data){
		var colCount = Math.max(this.columnCount, Math.max(...data.map(item => item.length)));

		this.columnString = [];
		this.columns = [];

		for(let i = 1; i <= colCount; i++){
			this.incrementChar(this.columnString.length - 1);
			this.columns.push(this.columnString.join(""));
		}

		return this.columns;
	}

	genRows(data){
		var rowCount = Math.max(this.rowCount, data.length);

		this.rows = [];

		for(let i = 1; i <= rowCount; i++){
			this.rows.push(i);
		}
		
		return this.rows;
	}

	incrementChar(i){
		let char = this.columnString[i];

		if(char){
			if(char !== "Z"){
				this.columnString[i] = String.fromCharCode(this.columnString[i].charCodeAt(0) + 1);
			}else {
				this.columnString[i] = "A";
				
				if(i){
					this.incrementChar(i-1);
				}else {
					this.columnString.push("A");
				}
			}
		}else {
			this.columnString.push("A");
		}
	}

	setRowCount(count){
		this.rowCount = count;
	}

	setColumnCount(count){
		this.columnCount = count;
	}
}

class SheetComponent {
	constructor(sheet) {
		this._sheet = sheet;

		return new Proxy(this, {
			get: function (target, name, receiver) {
				if (typeof target[name] !== "undefined") {
					return target[name];
				} else {
					return target._sheet.table.componentFunctionBinder.handle("sheet", target._sheet, name);
				}
			},
		});
	}

	getTitle(){
		return this._sheet.title;
	}

	getKey(){
		return this._sheet.key;
	}

	getDefinition(){
		return this._sheet.getDefinition();
	}

	getData() {
		return this._sheet.getData();
	}

	setData(data) {
		return this._sheet.setData(data);
	}

	clear(){
		return this._sheet.clear();
	}

	remove(){
		return this._sheet.remove();
	}
	
	active(){
		return this._sheet.active();
	}

	setTitle(title){
		return this._sheet.setTitle(title);
	}

	setRows(rows){
		return this._sheet.setRows(rows);
	}

	setColumns(columns){
		return this._sheet.setColumns(columns);
	}
}

class Sheet extends CoreFeature{
	constructor(spreadsheetManager, definition) {
		super(spreadsheetManager.table);
		
		this.spreadsheetManager = spreadsheetManager;
		this.definition = definition;
		
		this.title = this.definition.title || "";
		this.key = this.definition.key || this.definition.title;
		this.rowCount = this.definition.rows;
		this.columnCount = this.definition.columns;
		this.data = this.definition.data || [];
		this.element = null;
		this.isActive = false;
		
		this.grid = new GridCalculator(this.columnCount, this.rowCount);
		
		this.defaultColumnDefinition = {width:100, headerHozAlign:"center", headerSort:false};
		this.columnDefinition = Object.assign(this.defaultColumnDefinition, this.options("spreadsheetColumnDefinition"));
		
		this.columnDefs = [];
		this.rowDefs = [];
		this.columnFields = [];
		this.columns = [];
		this.rows = [];
		
		this.scrollTop = null;
		this.scrollLeft = null;
		
		this.initialize();
		
		this.dispatchExternal("sheetAdded", this.getComponent());
	}
	
	///////////////////////////////////
	///////// Initialization //////////
	///////////////////////////////////
	
	initialize(){
		this.initializeElement();
		this.initializeColumns();
		this.initializeRows();
	}
	
	reinitialize(){
		this.initializeColumns();
		this.initializeRows();
	}
	
	initializeElement(){
		this.element = document.createElement("div");
		this.element.classList.add("tabulator-spreadsheet-tab");
		this.element.innerText = this.title;
		
		this.element.addEventListener("click", () => {
			this.spreadsheetManager.loadSheet(this);
		});
	}
	
	initializeColumns(){
		this.grid.setColumnCount(this.columnCount);
		this.columnFields = this.grid.genColumns(this.data);
		
		this.columnDefs = [];
		
		this.columnFields.forEach((ref) => {
			var def = Object.assign({}, this.columnDefinition);
			def.field = ref;
			def.title = ref;
			
			this.columnDefs.push(def);
		});
	}
	
	initializeRows(){
		var refs;
		
		this.grid.setRowCount(this.rowCount);
		
		refs = this.grid.genRows(this.data);
		
		this.rowDefs = [];
		
		refs.forEach((ref, i) => {
			var def = {"_id":ref};
			var data = this.data[i];
			
			if(data){
				data.forEach((val, j) => {
					var field = this.columnFields[j];
					
					if(field){
						def[field] = val;
					}
				});
			}
			
			this.rowDefs.push(def);
		});
	}
	
	unload(){
		this.isActive = false;
		this.scrollTop = this.table.rowManager.scrollTop;
		this.scrollLeft = this.table.rowManager.scrollLeft;
		this.data = this.getData(true);
		this.element.classList.remove("tabulator-spreadsheet-tab-active");
	}
	
	load(){
		
		var wasInactive = !this.isActive;
		
		this.isActive = true;
		this.table.blockRedraw();
		this.table.setData([]);
		this.table.setColumns(this.columnDefs);
		this.table.setData(this.rowDefs);
		this.table.restoreRedraw();
		
		if(wasInactive && this.scrollTop !== null){
			this.table.rowManager.element.scrollLeft = this.scrollLeft;
			this.table.rowManager.element.scrollTop = this.scrollTop;
		}
		
		this.element.classList.add("tabulator-spreadsheet-tab-active");
		
		this.dispatchExternal("sheetLoaded", this.getComponent());
	}
	
	///////////////////////////////////
	//////// Helper Functions /////////
	///////////////////////////////////
	
	getComponent(){
		return new SheetComponent(this);
	}
	
	getDefinition(){
		return {
			title:this.title,
			key:this.key,
			rows:this.rowCount,
			columns:this.columnCount,
			data:this.getData(),
		};
	}
	
	getData(full){
		var output = [], 
		rowWidths,
		outputWidth, outputHeight;
		
		//map data to array format
		this.rowDefs.forEach((rowData) => {
			var row = [];
			
			this.columnFields.forEach((field) => {
				row.push(rowData[field]);
			});
			
			output.push(row);
		});
		
		//trim output
		if(!full && !this.options("spreadsheetOutputFull")){
			
			//calculate used area of data
			rowWidths = output.map(row => row.findLastIndex(val => typeof val !== 'undefined') + 1);
			outputWidth = Math.max(...rowWidths);
			outputHeight = rowWidths.findLastIndex(width => width > 0) + 1;
			
			output = output.slice(0, outputHeight);
			output = output.map(row => row.slice(0, outputWidth));
		}
		
		return output;
	}
	
	setData(data){
		this.data = data;
		this.reinitialize();
		
		this.dispatchExternal("sheetUpdated", this.getComponent());
		
		if(this.isActive){
			this.load();
		}
	}
	
	clear(){
		this.setData([]);
	}
	
	setTitle(title){
		this.title = title;
		this.element.innerText = title;
		
		this.dispatchExternal("sheetUpdated", this.getComponent());
	}
	
	setRows(rows){
		this.rowCount = rows;
		this.initializeRows();
		
		this.dispatchExternal("sheetUpdated", this.getComponent());
		
		if(this.isActive){
			this.load();
		}
	}
	
	setColumns(columns){
		this.columnCount = columns;
		this.reinitialize();
		
		this.dispatchExternal("sheetUpdated", this.getComponent());
		
		if(this.isActive){
			this.load();
		}
	}
	
	remove(){
		this.spreadsheetManager.removeSheet(this);
	}
	
	destroy(){
		if(this.element.parentNode){
			this.element.parentNode.removeChild(this.element);
		}
		
		this.dispatchExternal("sheetRemoved", this.getComponent());
	}
	
	active(){
		this.spreadsheetManager.loadSheet(this);
	}
}

class Spreadsheet extends Module{
	
	static moduleName = "spreadsheet";
	
	constructor(table){
		super(table);
		
		this.sheets = [];
		this.element = null;
		
		this.registerTableOption("spreadsheet", false); 
		this.registerTableOption("spreadsheetRows", 50); 
		this.registerTableOption("spreadsheetColumns", 50); 
		this.registerTableOption("spreadsheetColumnDefinition", {}); 
		this.registerTableOption("spreadsheetOutputFull", false); 
		this.registerTableOption("spreadsheetData", false); 
		this.registerTableOption("spreadsheetSheets", false); 
		this.registerTableOption("spreadsheetSheetTabs", false); 
		this.registerTableOption("spreadsheetSheetTabsElement", false); 
		
		this.registerTableFunction("setSheets", this.setSheets.bind(this));
		this.registerTableFunction("addSheet", this.addSheet.bind(this));
		this.registerTableFunction("getSheets", this.getSheets.bind(this));
		this.registerTableFunction("getSheetDefinitions", this.getSheetDefinitions.bind(this));
		this.registerTableFunction("setSheetData", this.setSheetData.bind(this));
		this.registerTableFunction("getSheet", this.getSheet.bind(this));
		this.registerTableFunction("getSheetData", this.getSheetData.bind(this));
		this.registerTableFunction("clearSheet", this.clearSheet.bind(this));
		this.registerTableFunction("removeSheet", this.removeSheetFunc.bind(this));
		this.registerTableFunction("activeSheet", this.activeSheetFunc.bind(this));
	}
	
	///////////////////////////////////
	////// Module Initialization //////
	///////////////////////////////////
	
	
	initialize(){
		if(this.options("spreadsheet")){	
			this.subscribe("table-initialized", this.tableInitialized.bind(this));
			this.subscribe("data-loaded", this.loadRemoteData.bind(this));
			
			this.table.options.index = "_id";
			
			if(this.options("spreadsheetData") && this.options("spreadsheetSheets")){
				console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData");
				
				this.table.options.spreadsheetData = false;
			}
			
			this.compatibilityCheck();
			
			if(this.options("spreadsheetSheetTabs")){
				this.initializeTabset();
			}
		}
	}
	
	compatibilityCheck(){
		if(this.options("data")){
			console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table");
		}
		
		if(this.options("pagination")){
			console.warn("The spreadsheet module is not compatible with the pagination module");
		}
		
		if(this.options("groupBy")){
			console.warn("The spreadsheet module is not compatible with the row grouping module");
		}
		
		if(this.options("responsiveCollapse")){
			console.warn("The spreadsheet module is not compatible with the responsive collapse module");
		}
	}
	initializeTabset(){
		this.element = document.createElement("div");
		this.element.classList.add("tabulator-spreadsheet-tabs");
		var altContainer = this.options("spreadsheetSheetTabsElement");
		
		if(altContainer && !(altContainer instanceof HTMLElement)){
			altContainer = document.querySelector(altContainer);
			
			if(!altContainer){
				console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:", this.options("spreadsheetSheetTabsElement"));
			}
		}
		
		if(altContainer){
			altContainer.appendChild(this.element);
		}else {
			this.footerAppend(this.element);
		}
	}
	
	tableInitialized(){
		if(this.sheets.length){
			this.loadSheet(this.sheets[0]);
		}else {
			
			if(this.options("spreadsheetSheets")){
				this.loadSheets(this.options("spreadsheetSheets"));
			}else if(this.options("spreadsheetData")){
				this.loadData(this.options("spreadsheetData"));
			}
		}
	}

	///////////////////////////////////
	/////////// Ajax Parsing //////////
	///////////////////////////////////

	loadRemoteData(data, data1, data2){
		console.log("data", data, data1, data2);

		if(Array.isArray(data)){

			this.table.dataLoader.clearAlert();
			this.dispatchExternal("dataLoaded", data);

			if(!data.length || Array.isArray(data[0])){
				this.loadData(data);
			}else {
				this.loadSheets(data);
			}
		}else {
			console.error("Spreadsheet Loading Error - Unable to process remote data due to invalid data type \nExpecting: array \nReceived: ", typeof data, "\nData:     ", data);
		}

		return false;
	}

	///////////////////////////////////
	///////// Sheet Management ////////
	///////////////////////////////////
	
	
	loadData(data){
		var def = {
			data:data,
		};
		
		this.loadSheet(this.newSheet(def));
	}
	
	destroySheets(){
		this.sheets.forEach((sheet) => {
			sheet.destroy();
		});
		
		this.sheets = [];
		this.activeSheet = null;
	}
	
	loadSheets(sheets){	
		if(!Array.isArray(sheets)){
			sheets = [];
		}
		
		this.destroySheets();
		
		sheets.forEach((def) => {
			this.newSheet(def);
		});
		
		this.loadSheet(this.sheets[0]);
	}
	
	loadSheet(sheet){
		if(this.activeSheet !== sheet){
			if(this.activeSheet){
				this.activeSheet.unload();
			}
			
			this.activeSheet = sheet;
			
			sheet.load();
		}
	}
	
	newSheet(definition = {}){
		var sheet;
		
		if(!definition.rows){
			definition.rows = this.options("spreadsheetRows");
		}
		
		if(!definition.columns){
			definition.columns = this.options("spreadsheetColumns");
		}
		
		sheet = new Sheet(this, definition);
		
		this.sheets.push(sheet);
		
		if(this.element){
			this.element.appendChild(sheet.element);
		}
		
		return sheet;
	}
	
	removeSheet(sheet){
		var index = this.sheets.indexOf(sheet),
		prevSheet;
		
		if(this.sheets.length > 1){
			if(index > -1){
				this.sheets.splice(index, 1);
				sheet.destroy();
				
				if(this.activeSheet === sheet){
					
					prevSheet = this.sheets[index - 1] || this.sheets[0];
					
					if(prevSheet){
						this.loadSheet(prevSheet);
					}else {
						this.activeSheet = null;
					}
				}
			}
		}else {
			console.warn("Unable to remove sheet, at least one sheet must be active");
		}
	}
	
	lookupSheet(key){
		if(!key){
			return this.activeSheet;
		}else if(key instanceof Sheet){
			return key;
		}else if(key instanceof SheetComponent){
			return key._sheet;
		}else {
			return this.sheets.find(sheet => sheet.key === key) || false;
		}
	}
	
	
	///////////////////////////////////
	//////// Public Functions /////////
	///////////////////////////////////
	
	setSheets(sheets){
		this.loadSheets(sheets);

		return this.getSheets();
	}

	addSheet(sheet){
		return this.newSheet(sheet).getComponent();
	}
	
	getSheetDefinitions(){
		return this.sheets.map(sheet => sheet.getDefinition());
	}
	
	getSheets(){
		return this.sheets.map(sheet => sheet.getComponent());
	}
	
	getSheet(key){
		var sheet = this.lookupSheet(key);
		
		return sheet ? sheet.getComponent() : false;
	}
	
	setSheetData(key, data){
		if (key && !data){
			data = key;
			key = false;
		}
		
		var sheet = this.lookupSheet(key);
		
		return sheet ? sheet.setData(data) : false;	
	}
	
	getSheetData(key){
		var sheet = this.lookupSheet(key);
		
		return sheet ? sheet.getData() : false;	
	}
	
	clearSheet(key){
		var sheet = this.lookupSheet(key);
		
		return sheet ? sheet.clear() : false;
	}
	
	removeSheetFunc(key){
		var sheet = this.lookupSheet(key);
		
		if(sheet){
			this.removeSheet(sheet);
		}
	}
	
	activeSheetFunc(key){
		var sheet = this.lookupSheet(key);
		
		return sheet ? this.loadSheet(sheet) : false;
	}
}

class Tooltip extends Module{

	static moduleName = "tooltip";
	
	constructor(table){
		super(table);
		
		this.tooltipSubscriber = null,
		this.headerSubscriber = null,
		
		this.timeout = null;
		this.popupInstance = null;
		
		// this.registerTableOption("tooltipGenerationMode", undefined);  //deprecated
		this.registerTableOption("tooltipDelay", 300); 
		
		this.registerColumnOption("tooltip");
		this.registerColumnOption("headerTooltip");
	}
	
	initialize(){
		this.deprecatedOptionsCheck();
		
		this.subscribe("column-init", this.initializeColumn.bind(this));
	}
	
	deprecatedOptionsCheck(){
		// this.deprecationCheckMsg("tooltipGenerationMode", "This option is no longer needed as tooltips are always generated on hover now");
	}	
	
	initializeColumn(column){
		if(column.definition.headerTooltip && !this.headerSubscriber){
			this.headerSubscriber = true;
			
			this.subscribe("column-mousemove", this.mousemoveCheck.bind(this, "headerTooltip"));
			this.subscribe("column-mouseout", this.mouseoutCheck.bind(this, "headerTooltip"));
		}
		
		if(column.definition.tooltip && !this.tooltipSubscriber){
			this.tooltipSubscriber = true;
			
			this.subscribe("cell-mousemove", this.mousemoveCheck.bind(this, "tooltip"));
			this.subscribe("cell-mouseout", this.mouseoutCheck.bind(this, "tooltip"));
		}
	}
	
	mousemoveCheck(action, e, component){
		var tooltip = action === "tooltip" ? component.column.definition.tooltip : component.definition.headerTooltip;
		
		if(tooltip){
			this.clearPopup();
			this.timeout = setTimeout(this.loadTooltip.bind(this, e, component, tooltip), this.table.options.tooltipDelay);
		}
	}

	mouseoutCheck(action, e, component){
		if(!this.popupInstance){
			this.clearPopup();
		}
	}
	
	clearPopup(action, e, component){
		clearTimeout(this.timeout);
		this.timeout = null;
		
		if(this.popupInstance){
			this.popupInstance.hide();
		}
	}
	
	loadTooltip(e, component, tooltip){
		var contentsEl, renderedCallback, coords;

		function onRendered(callback){
			renderedCallback = callback;
		}
		
		if(typeof tooltip === "function"){
			tooltip = tooltip(e, component.getComponent(), onRendered);
		}
		
		if(tooltip instanceof HTMLElement){
			contentsEl = tooltip;
		}else {
			contentsEl = document.createElement("div");
			
			if(tooltip === true){
				if(component instanceof Cell){
					tooltip = component.value;
				}else {
					if(component.definition.field){
						this.langBind("columns|" + component.definition.field, (value) => {
							contentsEl.innerHTML = tooltip = value || component.definition.title;
						});
					}else {
						tooltip = component.definition.title;
					}
				}
			}
			
			contentsEl.innerHTML = tooltip;
		}
		
		if(tooltip || tooltip === 0 || tooltip === false){
			contentsEl.classList.add("tabulator-tooltip");

			contentsEl.addEventListener("mousemove", e => e.preventDefault());
			
			this.popupInstance = this.popup(contentsEl);
			
			if(typeof renderedCallback === "function"){
				this.popupInstance.renderCallback(renderedCallback);
			}

			coords = this.popupInstance.containerEventCoords(e);
			
			this.popupInstance.show(coords.x + 15, coords.y + 15).hideOnBlur(() => {
				this.dispatchExternal("TooltipClosed", component.getComponent());
				this.popupInstance = null;
			});
			
			this.dispatchExternal("TooltipOpened", component.getComponent());
		}
	}
}

var defaultValidators = {
	//is integer
	integer: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}

		value = Number(value);

		return !isNaN(value) && isFinite(value) && Math.floor(value) === value;
	},

	//is float
	float: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		
		value = Number(value);

		return !isNaN(value) && isFinite(value) && value % 1 !== 0;
	},

	//must be a number
	numeric: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		return !isNaN(value);
	},

	//must be a string
	string: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		return isNaN(value);
	},

	//must be alphanumeric
	alphanumeric: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}

		var reg = new RegExp(/^[a-z0-9]+$/i);

		return reg.test(value);
	},

	//maximum value
	max: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		return parseFloat(value) <= parameters;
	},

	//minimum value
	min: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		return parseFloat(value) >= parameters;
	},

	//starts with  value
	starts: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		return String(value).toLowerCase().startsWith(String(parameters).toLowerCase());
	},

	//ends with  value
	ends: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		return String(value).toLowerCase().endsWith(String(parameters).toLowerCase());
	},


	//minimum string length
	minLength: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		return String(value).length >= parameters;
	},

	//maximum string length
	maxLength: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		return String(value).length <= parameters;
	},

	//in provided value list
	in: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}

		if(typeof parameters == "string"){
			parameters = parameters.split("|");
		}

		return parameters.indexOf(value) > -1;
	},

	//must match provided regex
	regex: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		var reg = new RegExp(parameters);

		return reg.test(value);
	},

	//value must be unique in this column
	unique: function(cell, value, parameters){
		if(value === "" || value === null || typeof value === "undefined"){
			return true;
		}
		var unique = true;

		var cellData = cell.getData();
		var column = cell.getColumn()._getSelf();

		this.table.rowManager.rows.forEach(function(row){
			var data = row.getData();

			if(data !== cellData){
				if(value == column.getFieldValue(data)){
					unique = false;
				}
			}
		});

		return unique;
	},

	//must have a value
	required:function(cell, value, parameters){
		return value !== "" && value !== null && typeof value !== "undefined";
	},
};

class Validate extends Module{

	static moduleName = "validate";

	//load defaults
	static validators = defaultValidators;
	
	constructor(table){
		super(table);
		
		this.invalidCells = [];
		
		this.registerTableOption("validationMode", "blocking");
		
		this.registerColumnOption("validator");
		
		this.registerTableFunction("getInvalidCells", this.getInvalidCells.bind(this));
		this.registerTableFunction("clearCellValidation", this.userClearCellValidation.bind(this));
		this.registerTableFunction("validate", this.userValidate.bind(this));
		
		this.registerComponentFunction("cell", "isValid", this.cellIsValid.bind(this));
		this.registerComponentFunction("cell", "clearValidation", this.clearValidation.bind(this));
		this.registerComponentFunction("cell", "validate", this.cellValidate.bind(this));
		
		this.registerComponentFunction("column", "validate", this.columnValidate.bind(this));
		this.registerComponentFunction("row", "validate", this.rowValidate.bind(this));
	}
	
	
	initialize(){
		this.subscribe("cell-delete", this.clearValidation.bind(this));
		this.subscribe("column-layout", this.initializeColumnCheck.bind(this));
		
		this.subscribe("edit-success", this.editValidate.bind(this));
		this.subscribe("edit-editor-clear", this.editorClear.bind(this));
		this.subscribe("edit-edited-clear", this.editedClear.bind(this));
	}
	
	///////////////////////////////////
	///////// Event Handling //////////
	///////////////////////////////////
	
	editValidate(cell, value, previousValue){
		var valid = this.table.options.validationMode !== "manual" ? this.validate(cell.column.modules.validate, cell, value) : true;
		
		// allow time for editor to make render changes then style cell
		if(valid !== true){
			setTimeout(() => {
				cell.getElement().classList.add("tabulator-validation-fail");
				this.dispatchExternal("validationFailed", cell.getComponent(), value, valid);
			});
		}
		
		return valid;
	}
	
	editorClear(cell, cancelled){
		if(cancelled){
			if(cell.column.modules.validate){
				this.cellValidate(cell);
			}
		}

		cell.getElement().classList.remove("tabulator-validation-fail");
	}
	
	editedClear(cell){
		if(cell.modules.validate){
			cell.modules.validate.invalid = false;
		}
	}
	
	///////////////////////////////////
	////////// Cell Functions /////////
	///////////////////////////////////
	
	cellIsValid(cell){
		return cell.modules.validate ? (cell.modules.validate.invalid || true) : true;
	}
	
	cellValidate(cell){
		return this.validate(cell.column.modules.validate, cell, cell.getValue());
	}
	
	///////////////////////////////////
	///////// Column Functions ////////
	///////////////////////////////////
	
	columnValidate(column){
		var invalid = [];
		
		column.cells.forEach((cell) => {
			if(this.cellValidate(cell) !== true){
				invalid.push(cell.getComponent());
			}
		});
		
		return invalid.length ? invalid : true;
	}
	
	///////////////////////////////////
	////////// Row Functions //////////
	///////////////////////////////////
	
	rowValidate(row){
		var invalid = [];
		
		row.cells.forEach((cell) => {
			if(this.cellValidate(cell) !== true){
				invalid.push(cell.getComponent());
			}
		});
		
		return invalid.length ? invalid : true;
	}
	
	///////////////////////////////////
	///////// Table Functions /////////
	///////////////////////////////////
	
	
	userClearCellValidation(cells){
		if(!cells){
			cells = this.getInvalidCells();
		}
		
		if(!Array.isArray(cells)){
			cells = [cells];
		}
		
		cells.forEach((cell) => {
			this.clearValidation(cell._getSelf());
		});
	}
	
	userValidate(cells){
		var output = [];
		
		//clear row data
		this.table.rowManager.rows.forEach((row) => {
			row = row.getComponent();
			
			var valid = row.validate();
			
			if(valid !== true){
				output = output.concat(valid);
			}
		});
		
		return output.length ? output : true;
	}
	
	///////////////////////////////////
	///////// Internal Logic //////////
	///////////////////////////////////
	
	initializeColumnCheck(column){
		if(typeof column.definition.validator !== "undefined"){
			this.initializeColumn(column);
		}
	}
	
	//validate
	initializeColumn(column){
		var self = this,
		config = [],
		validator;
		
		if(column.definition.validator){
			
			if(Array.isArray(column.definition.validator)){
				column.definition.validator.forEach((item) => {
					validator = self._extractValidator(item);
					
					if(validator){
						config.push(validator);
					}
				});
				
			}else {
				validator = this._extractValidator(column.definition.validator);
				
				if(validator){
					config.push(validator);
				}
			}
			
			column.modules.validate = config.length ? config : false;
		}
	}
	
	_extractValidator(value){
		var type, params, pos;
		
		switch(typeof value){
			case "string":
				pos = value.indexOf(':');
			
				if(pos > -1){
					type = value.substring(0,pos);
					params = value.substring(pos+1);
				}else {
					type = value;
				}
			
				return this._buildValidator(type, params);
			
			case "function":
				return this._buildValidator(value);
			
			case "object":
				return this._buildValidator(value.type, value.parameters);
		}
	}
	
	_buildValidator(type, params){
		
		var func = typeof type == "function" ? type : Validate.validators[type];
		
		if(!func){
			console.warn("Validator Setup Error - No matching validator found:", type);
			return false;
		}else {
			return {
				type:typeof type == "function" ? "function" : type,
				func:func,
				params:params,
			};
		}
	}
	
	validate(validators, cell, value){
		var self = this,
		failedValidators = [],
		invalidIndex = this.invalidCells.indexOf(cell);
		
		if(validators){
			validators.forEach((item) => {
				if(!item.func.call(self, cell.getComponent(), value, item.params)){
					failedValidators.push({
						type:item.type,
						parameters:item.params
					});
				}
			});
		}
		
		if(!cell.modules.validate){
			cell.modules.validate = {};
		}
		
		if(!failedValidators.length){
			cell.modules.validate.invalid = false;
			cell.getElement().classList.remove("tabulator-validation-fail");
			
			if(invalidIndex > -1){
				this.invalidCells.splice(invalidIndex, 1);
			}
		}else {
			cell.modules.validate.invalid = failedValidators;
			
			if(this.table.options.validationMode !== "manual"){
				cell.getElement().classList.add("tabulator-validation-fail");
			}
			
			if(invalidIndex == -1){
				this.invalidCells.push(cell);
			}
		}
		
		return failedValidators.length ? failedValidators : true;
	}
	
	getInvalidCells(){
		var output = [];
		
		this.invalidCells.forEach((cell) => {
			output.push(cell.getComponent());
		});
		
		return output;
	}
	
	clearValidation(cell){
		var invalidIndex;
		
		if(cell.modules.validate && cell.modules.validate.invalid){
			
			cell.getElement().classList.remove("tabulator-validation-fail");
			cell.modules.validate.invalid = false;
			
			invalidIndex = this.invalidCells.indexOf(cell);
			
			if(invalidIndex > -1){
				this.invalidCells.splice(invalidIndex, 1);
			}
		}
	}
}

var allModules = /*#__PURE__*/Object.freeze({
	__proto__: null,
	AccessorModule: Accessor,
	AjaxModule: Ajax,
	ClipboardModule: Clipboard,
	ColumnCalcsModule: ColumnCalcs,
	DataTreeModule: DataTree,
	DownloadModule: Download,
	EditModule: Edit,
	ExportModule: Export,
	FilterModule: Filter,
	FormatModule: Format,
	FrozenColumnsModule: FrozenColumns,
	FrozenRowsModule: FrozenRows,
	GroupRowsModule: GroupRows,
	HistoryModule: History,
	HtmlTableImportModule: HtmlTableImport,
	ImportModule: Import,
	InteractionModule: Interaction,
	KeybindingsModule: Keybindings,
	MenuModule: Menu,
	MoveColumnsModule: MoveColumns,
	MoveRowsModule: MoveRows,
	MutatorModule: Mutator,
	PageModule: Page,
	PersistenceModule: Persistence,
	PopupModule: Popup,
	PrintModule: Print,
	ReactiveDataModule: ReactiveData,
	ResizeColumnsModule: ResizeColumns,
	ResizeRowsModule: ResizeRows,
	ResizeTableModule: ResizeTable,
	ResponsiveLayoutModule: ResponsiveLayout,
	SelectRangeModule: SelectRange,
	SelectRowModule: SelectRow,
	SortModule: Sort,
	SpreadsheetModule: Spreadsheet,
	TooltipModule: Tooltip,
	ValidateModule: Validate
});

var defaultOptions = {

	debugEventsExternal:false, //flag to console log events
	debugEventsInternal:false, //flag to console log events
	debugInvalidOptions:true, //allow toggling of invalid option warnings
	debugInvalidComponentFuncs:true, //allow toggling of invalid component warnings
	debugInitialization:true, //allow toggling of pre initialization function call warnings
	debugDeprecation:true, //allow toggling of deprecation warnings

	height:false, //height of tabulator
	minHeight:false, //minimum height of tabulator
	maxHeight:false, //maximum height of tabulator

	columnHeaderVertAlign:"top", //vertical alignment of column headers

	popupContainer:false,

	columns:[],//store for colum header info
	columnDefaults:{}, //store column default props
	rowHeader:false,

	data:false, //default starting data

	autoColumns:false, //build columns from data row structure
	autoColumnsDefinitions:false,

	nestedFieldSeparator:".", //separator for nested data

	footerElement:false, //hold footer element

	index:"id", //filed for row index

	textDirection:"auto",

	addRowPos:"bottom", //position to insert blank rows, top|bottom

	headerVisible:true, //hide header

	renderVertical:"virtual",
	renderHorizontal:"basic",
	renderVerticalBuffer:0, // set virtual DOM buffer size

	scrollToRowPosition:"top",
	scrollToRowIfVisible:true,

	scrollToColumnPosition:"left",
	scrollToColumnIfVisible:true,

	rowFormatter:false,
	rowFormatterPrint:null,
	rowFormatterClipboard:null,
	rowFormatterHtmlOutput:null,

	rowHeight:null,

	placeholder:false,

	dataLoader:true,
	dataLoaderLoading:false,
	dataLoaderError:false,
	dataLoaderErrorTimeout:3000,
	dataSendParams:{},
	dataReceiveParams:{},

	dependencies:{},
};

class OptionsList {
	constructor(table, msgType, defaults = {}){
		this.table = table;
		this.msgType = msgType;
		this.registeredDefaults = Object.assign({}, defaults);
	}
	
	register(option, value){
		this.registeredDefaults[option] = value;
	}
	
	generate(defaultOptions, userOptions = {}){
		var output = Object.assign({}, this.registeredDefaults),
		warn = this.table.options.debugInvalidOptions || userOptions.debugInvalidOptions === true;
		
		Object.assign(output, defaultOptions);
		
		for (let key in userOptions){
			if(!output.hasOwnProperty(key)){
				if(warn){
					console.warn("Invalid " + this.msgType + " option:", key);
				}

				output[key] = userOptions.key;
			}
		}
	
		
		for (let key in output){
			if(key in userOptions){
				output[key] = userOptions[key];
			}else {
				if(Array.isArray(output[key])){
					output[key] = Object.assign([], output[key]);
				}else if(typeof output[key] === "object" && output[key] !== null){
					output[key] = Object.assign({}, output[key]);
				}else if (typeof output[key] === "undefined"){
					delete output[key];
				}
			}
		}
		
		return output;
	}
}

class Renderer extends CoreFeature{
	constructor(table){
		super(table);

		this.elementVertical = table.rowManager.element;
		this.elementHorizontal = table.columnManager.element;
		this.tableElement =  table.rowManager.tableElement;

		this.verticalFillMode = "fit"; // used by row manager to determine how to size the render area ("fit" - fits container to the contents, "fill" - fills the container without resizing it)
	}


	///////////////////////////////////
	/////// Internal Bindings /////////
	///////////////////////////////////

	initialize(){
		//initialize core functionality
	}

	clearRows(){
		//clear down existing rows layout
	}

	clearColumns(){
		//clear down existing columns layout
	}


	reinitializeColumnWidths(columns){
		//resize columns to fit data
	}


	renderRows(){
		//render rows from a clean slate
	}

	renderColumns(){
		//render columns from a clean slate
	}

	rerenderRows(callback){
		// rerender rows and keep position
		if(callback){
			callback();
		}
	}

	rerenderColumns(update, blockRedraw){
		//rerender columns
	}

	renderRowCells(row){
		//render the cells in a row
	}

	rerenderRowCells(row, force){
		//rerender the cells in a row
	}

	scrollColumns(left, dir){
		//handle horizontal scrolling
	}

	scrollRows(top, dir){
		//handle vertical scrolling
	}

	resize(){
		//container has resized, carry out any needed recalculations (DO NOT RERENDER IN THIS FUNCTION)
	}

	scrollToRow(row){
		//scroll to a specific row
	}

	scrollToRowNearestTop(row){
		//determine weather the row is nearest the top or bottom of the table, return true for top or false for bottom
	}

	visibleRows(includingBuffer){
		//return the visible rows
		return [];
	}

	///////////////////////////////////
	//////// Helper Functions /////////
	///////////////////////////////////

	rows(){
		return this.table.rowManager.getDisplayRows();
	}

	styleRow(row, index){
		var rowEl = row.getElement();

		if(index % 2){
			rowEl.classList.add("tabulator-row-even");
			rowEl.classList.remove("tabulator-row-odd");
		}else {
			rowEl.classList.add("tabulator-row-odd");
			rowEl.classList.remove("tabulator-row-even");
		}
	}

	///////////////////////////////////
	/////// External Triggers /////////
	/////// (DO NOT OVERRIDE) /////////
	///////////////////////////////////

	clear(){
		//clear down existing layout
		this.clearRows();
		this.clearColumns();
	}

	render(){
		//render from a clean slate
		this.renderRows();
		this.renderColumns();
	}

	rerender(callback){
		// rerender and keep position
		this.rerenderRows();
		this.rerenderColumns();
	}

	scrollToRowPosition(row, position, ifVisible){
		var rowIndex = this.rows().indexOf(row),
		rowEl = row.getElement(),
		offset = 0;

		return new Promise((resolve, reject) => {
			if(rowIndex > -1){

				if(typeof ifVisible === "undefined"){
					ifVisible = this.table.options.scrollToRowIfVisible;
				}

				//check row visibility
				if(!ifVisible){
					if(Helpers.elVisible(rowEl)){
						offset = Helpers.elOffset(rowEl).top - Helpers.elOffset(this.elementVertical).top;
						
						if(offset > 0 && offset < this.elementVertical.clientHeight - rowEl.offsetHeight){
							resolve();
							return false;
						}
					}
				}

				if(typeof position === "undefined"){
					position = this.table.options.scrollToRowPosition;
				}

				if(position === "nearest"){
					position = this.scrollToRowNearestTop(row) ? "top" : "bottom";
				}

				//scroll to row
				this.scrollToRow(row);

				//align to correct position
				switch(position){
					case "middle":
					case "center":

						if(this.elementVertical.scrollHeight - this.elementVertical.scrollTop == this.elementVertical.clientHeight){
							this.elementVertical.scrollTop = this.elementVertical.scrollTop + (rowEl.offsetTop - this.elementVertical.scrollTop) - ((this.elementVertical.scrollHeight - rowEl.offsetTop) / 2);
						}else {
							this.elementVertical.scrollTop = this.elementVertical.scrollTop - (this.elementVertical.clientHeight / 2);
						}

						break;

					case "bottom":

						if(this.elementVertical.scrollHeight - this.elementVertical.scrollTop == this.elementVertical.clientHeight){
							this.elementVertical.scrollTop = this.elementVertical.scrollTop - (this.elementVertical.scrollHeight - rowEl.offsetTop) + rowEl.offsetHeight;
						}else {
							this.elementVertical.scrollTop = this.elementVertical.scrollTop - this.elementVertical.clientHeight + rowEl.offsetHeight;
						}

						break;

					case "top":
						this.elementVertical.scrollTop = rowEl.offsetTop;					
						break;
				}

				resolve();

			}else {
				console.warn("Scroll Error - Row not visible");
				reject("Scroll Error - Row not visible");
			}
		});
	}
}

class BasicHorizontal extends Renderer{
	constructor(table){
		super(table);
	}
	
	renderRowCells(row, inFragment) {
		const rowFrag = document.createDocumentFragment();
		row.cells.forEach((cell) => {
			rowFrag.appendChild(cell.getElement());
		});
		row.element.appendChild(rowFrag);
		
		if(!inFragment){
			row.cells.forEach((cell) => {
				cell.cellRendered();
			});
		}
	}
	
	reinitializeColumnWidths(columns){
		columns.forEach(function(column){
			column.reinitializeWidth();
		});
	}
}

class VirtualDomHorizontal extends Renderer{
	constructor(table){
		super(table);
		
		this.leftCol = 0;
		this.rightCol = 0;
		this.scrollLeft = 0;
		
		this.vDomScrollPosLeft = 0;
		this.vDomScrollPosRight = 0;
		
		this.vDomPadLeft = 0;
		this.vDomPadRight = 0;
		
		this.fitDataColAvg = 0;
		
		this.windowBuffer = 200; //pixel margin to make column visible before it is shown on screen
		
		this.visibleRows = null;
		
		this.initialized = false;
		this.isFitData = false;
		
		this.columns = [];
	}
	
	initialize(){
		this.compatibilityCheck();
		this.layoutCheck();
		this.vertScrollListen();
	}
	
	compatibilityCheck(){		
		if(this.options("layout") == "fitDataTable"){
			console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode");
		}
		
		if(this.options("responsiveLayout")){
			console.warn("Horizontal Virtual DOM is not compatible with responsive columns");
		}
		
		if(this.options("rtl")){
			console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction");
		}
	}
	
	layoutCheck(){
		this.isFitData = this.options("layout").startsWith('fitData');
	}
	
	vertScrollListen(){
		this.subscribe("scroll-vertical", this.clearVisRowCache.bind(this));
		this.subscribe("data-refreshed", this.clearVisRowCache.bind(this));
	}
	
	clearVisRowCache(){
		this.visibleRows = null;
	}
	
	//////////////////////////////////////
	///////// Public Functions ///////////
	//////////////////////////////////////
	
	renderColumns(row, force){
		this.dataChange();
	}
	
	
	scrollColumns(left, dir){
		if(this.scrollLeft != left){
			this.scrollLeft = left;
			
			this.scroll(left - (this.vDomScrollPosLeft + this.windowBuffer));
		}
	}
	
	calcWindowBuffer(){
		var buffer = this.elementVertical.clientWidth;
		
		this.table.columnManager.columnsByIndex.forEach((column) => {
			if(column.visible){
				var width = column.getWidth();
				
				if(width > buffer){
					buffer = width;
				}
			}
		});
		
		this.windowBuffer = buffer * 2;
	}
	
	rerenderColumns(update, blockRedraw){		
		var old = {
			cols:this.columns,
			leftCol:this.leftCol,
			rightCol:this.rightCol,
		},
		colPos = 0;
		
		if(update && !this.initialized){
			return;
		}
		
		this.clear();
		
		this.calcWindowBuffer();
		
		this.scrollLeft = this.elementVertical.scrollLeft;
		
		this.vDomScrollPosLeft = this.scrollLeft - this.windowBuffer;
		this.vDomScrollPosRight = this.scrollLeft + this.elementVertical.clientWidth + this.windowBuffer;
		
		this.table.columnManager.columnsByIndex.forEach((column) => {
			var config = {},
			width;
			
			if(column.visible){
				if(!column.modules.frozen){			
					width = column.getWidth();
					
					config.leftPos = colPos;
					config.rightPos = colPos + width;
					
					config.width = width;
					
					if (this.isFitData) {
						config.fitDataCheck = column.modules.vdomHoz ? column.modules.vdomHoz.fitDataCheck : true;
					}
					
					if((colPos + width > this.vDomScrollPosLeft) && (colPos < this.vDomScrollPosRight)){
						//column is visible
						
						if(this.leftCol == -1){
							this.leftCol = this.columns.length;
							this.vDomPadLeft = colPos;
						}
						
						this.rightCol = this.columns.length;
					}else {
						// column is hidden
						if(this.leftCol !== -1){
							this.vDomPadRight += width;
						}
					}
					
					this.columns.push(column);
					
					column.modules.vdomHoz = config;
					
					colPos += width;
				}
			}
		});
		
		this.tableElement.style.paddingLeft = this.vDomPadLeft + "px";
		this.tableElement.style.paddingRight = this.vDomPadRight + "px";
		
		this.initialized = true;
		
		if(!blockRedraw){
			if(!update || this.reinitChanged(old)){
				this.reinitializeRows();
			}
		}
		
		this.elementVertical.scrollLeft = this.scrollLeft;
	}
	
	renderRowCells(row){
		if(this.initialized){
			this.initializeRow(row);
		}else {
			const rowFrag = document.createDocumentFragment();
			row.cells.forEach((cell) => {
				rowFrag.appendChild(cell.getElement());
			});
			row.element.appendChild(rowFrag);
			
			row.cells.forEach((cell) => {
				cell.cellRendered();
			});
		}
	}
	
	rerenderRowCells(row, force){
		this.reinitializeRow(row, force);
	}
	
	reinitializeColumnWidths(columns){
		for(let i = this.leftCol; i <= this.rightCol; i++){
			let col = this.columns[i];
			
			if(col){
				col.reinitializeWidth();
			}
		}
	}
	
	//////////////////////////////////////
	//////// Internal Rendering //////////
	//////////////////////////////////////
	
	deinitialize(){
		this.initialized = false;
	}
	
	clear(){
		this.columns = [];
		
		this.leftCol = -1;
		this.rightCol = 0;
		
		this.vDomScrollPosLeft = 0;
		this.vDomScrollPosRight = 0;
		this.vDomPadLeft = 0;
		this.vDomPadRight = 0;
	}
	
	dataChange(){
		var change = false,
		row, rowEl;
		
		if(this.isFitData){
			this.table.columnManager.columnsByIndex.forEach((column) => {
				if(!column.definition.width && column.visible){
					change = true;
				}
			});
			
			if(change && this.table.rowManager.getDisplayRows().length){
				this.vDomScrollPosRight = this.scrollLeft + this.elementVertical.clientWidth + this.windowBuffer;
				
				row = this.chain("rows-sample", [1], [], () => {
					return this.table.rowManager.getDisplayRows();
				})[0];
				
				if(row){
					rowEl = row.getElement();
					
					row.generateCells();
					
					this.tableElement.appendChild(rowEl);
					
					for(let colEnd = 0; colEnd < row.cells.length; colEnd++){
						let cell = row.cells[colEnd];
						rowEl.appendChild(cell.getElement());
						
						cell.column.reinitializeWidth();
					}
					
					rowEl.parentNode.removeChild(rowEl);
					
					this.rerenderColumns(false, true);
				}
			}
		}else {
			if(this.options("layout") === "fitColumns"){
				this.layoutRefresh();
				this.rerenderColumns(false, true);
			}
		}
	}
	
	reinitChanged(old){
		var match = true;
		
		if(old.cols.length !== this.columns.length || old.leftCol !== this.leftCol || old.rightCol !== this.rightCol){
			return true;
		}
		
		old.cols.forEach((col, i) => {
			if(col !== this.columns[i]){
				match = false;
			}
		});
		
		return !match;
	}
	
	reinitializeRows(){
		var visibleRows = this.getVisibleRows(),
		otherRows = this.table.rowManager.getRows().filter(row => !visibleRows.includes(row));
		
		visibleRows.forEach((row) => {
			this.reinitializeRow(row, true);
		});
		
		otherRows.forEach((row) =>{
			row.deinitialize();
		});
	}
	
	getVisibleRows(){
		if (!this.visibleRows){
			this.visibleRows = this.table.rowManager.getVisibleRows();
		}
		
		return this.visibleRows;	
	}
	
	scroll(diff){
		this.vDomScrollPosLeft += diff;
		this.vDomScrollPosRight += diff;
		
		if(Math.abs(diff) > (this.windowBuffer / 2)){
			this.rerenderColumns();
		}else {
			if(diff > 0){
				//scroll right
				this.addColRight();
				this.removeColLeft();
			}else {
				//scroll left
				this.addColLeft();
				this.removeColRight();
			}
		}
	}
	
	colPositionAdjust (start, end, diff){
		for(let i = start; i < end; i++){
			let column = this.columns[i];
			
			column.modules.vdomHoz.leftPos += diff;
			column.modules.vdomHoz.rightPos += diff;
		}
	}
	
	addColRight(){
		var changes = false,
		working = true;
		
		while(working){
			
			let column = this.columns[this.rightCol + 1];
			
			if(column){
				if(column.modules.vdomHoz.leftPos <= this.vDomScrollPosRight){
					changes = true;
					
					this.getVisibleRows().forEach((row) => {
						if(row.type !== "group"){
							var cell = row.getCell(column);
							row.getElement().insertBefore(cell.getElement(), row.getCell(this.columns[this.rightCol]).getElement().nextSibling);
							cell.cellRendered();
						}
					});
					
					this.fitDataColActualWidthCheck(column);
					
					this.rightCol++; // Don't move this below the >= check below
					
					this.getVisibleRows().forEach((row) => {
						if(row.type !== "group"){
							row.modules.vdomHoz.rightCol = this.rightCol;
						}
					});
					
					if(this.rightCol >= (this.columns.length - 1)){
						this.vDomPadRight = 0;
					}else {
						this.vDomPadRight -= column.getWidth();
					}	
				}else {
					working = false;
				}
			}else {
				working = false;
			}
		}
		
		if(changes){
			this.tableElement.style.paddingRight = this.vDomPadRight + "px";
		}
	}
	
	addColLeft(){
		var changes = false,
		working = true;
		
		while(working){
			let column = this.columns[this.leftCol - 1];
			
			if(column){
				if(column.modules.vdomHoz.rightPos >= this.vDomScrollPosLeft){
					changes = true;
					
					this.getVisibleRows().forEach((row) => {
						if(row.type !== "group"){
							var cell = row.getCell(column);
							row.getElement().insertBefore(cell.getElement(), row.getCell(this.columns[this.leftCol]).getElement());
							cell.cellRendered();
						}
					});
					
					this.leftCol--; // don't move this below the <= check below
					
					this.getVisibleRows().forEach((row) => {
						if(row.type !== "group"){
							row.modules.vdomHoz.leftCol = this.leftCol;
						}
					});
					
					if(this.leftCol <= 0){ // replicating logic in addColRight
						this.vDomPadLeft = 0;
					}else {
						this.vDomPadLeft -= column.getWidth();
					}
					
					let diff = this.fitDataColActualWidthCheck(column);
					
					if(diff){
						this.scrollLeft = this.elementVertical.scrollLeft = this.elementVertical.scrollLeft + diff;
						this.vDomPadRight -= diff;
					}
					
				}else {
					working = false;
				}
			}else {
				working = false;
			}
		}
		
		if(changes){
			this.tableElement.style.paddingLeft = this.vDomPadLeft + "px";
		}
	}
	
	removeColRight(){
		var changes = false,
		working = true;
		
		while(working){
			let column = this.columns[this.rightCol];
			
			if(column){
				if(column.modules.vdomHoz.leftPos > this.vDomScrollPosRight){
					changes = true;
					
					this.getVisibleRows().forEach((row) => {
						if(row.type !== "group"){
							var cell = row.getCell(column);
							
							try {
								row.getElement().removeChild(cell.getElement());
							} catch (ex) {
								console.warn("Could not removeColRight", ex.message);
							}
						}
					});
					
					this.vDomPadRight += column.getWidth();
					this.rightCol --;
					
					this.getVisibleRows().forEach((row) => {
						if(row.type !== "group"){
							row.modules.vdomHoz.rightCol = this.rightCol;
						}
					});
				}else {
					working = false;
				}
			}else {
				working = false;
			}
		}
		
		if(changes){
			this.tableElement.style.paddingRight = this.vDomPadRight + "px";
		}
	}
	
	removeColLeft(){
		var changes = false,
		working = true;
		
		while(working){
			let column = this.columns[this.leftCol];
			
			if(column){
				if(column.modules.vdomHoz.rightPos < this.vDomScrollPosLeft){
					changes = true;
					
					this.getVisibleRows().forEach((row) => {					
						if(row.type !== "group"){
							var cell = row.getCell(column);
							
							try {
								row.getElement().removeChild(cell.getElement());
							} catch (ex) {
								console.warn("Could not removeColLeft", ex.message);
							}
						}
					});
					
					this.vDomPadLeft += column.getWidth();
					this.leftCol ++;
					
					this.getVisibleRows().forEach((row) => {
						if(row.type !== "group"){
							row.modules.vdomHoz.leftCol = this.leftCol;
						}
					});
				}else {
					working = false;
				}
			}else {
				working = false;
			}
		}
		
		if(changes){
			this.tableElement.style.paddingLeft = this.vDomPadLeft + "px";
		}
	}
	
	fitDataColActualWidthCheck(column){
		var newWidth, widthDiff;
		
		if(column.modules.vdomHoz.fitDataCheck){
			column.reinitializeWidth();
			
			newWidth = column.getWidth();
			widthDiff = newWidth - column.modules.vdomHoz.width;
			
			if(widthDiff){
				column.modules.vdomHoz.rightPos += widthDiff;
				column.modules.vdomHoz.width = newWidth;
				this.colPositionAdjust(this.columns.indexOf(column) + 1, this.columns.length, widthDiff);
			}
			
			column.modules.vdomHoz.fitDataCheck = false;
		}
		
		return widthDiff;
	}
	
	initializeRow(row){
		if(row.type !== "group"){
			row.modules.vdomHoz = {
				leftCol:this.leftCol,
				rightCol:this.rightCol,
			};
			
			if(this.table.modules.frozenColumns){
				this.table.modules.frozenColumns.leftColumns.forEach((column) => {
					this.appendCell(row, column);
				});
			}
			
			for(let i = this.leftCol; i <= this.rightCol; i++){
				this.appendCell(row, this.columns[i]);
			}
			
			if(this.table.modules.frozenColumns){
				this.table.modules.frozenColumns.rightColumns.forEach((column) => {
					this.appendCell(row, column);
				});
			}
		}
	}
	
	appendCell(row, column){
		if(column && column.visible){
			let cell = row.getCell(column);
			
			row.getElement().appendChild(cell.getElement());
			cell.cellRendered();
		}
	}
	
	reinitializeRow(row, force){
		if(row.type !== "group"){
			if(force || !row.modules.vdomHoz || row.modules.vdomHoz.leftCol !== this.leftCol || row.modules.vdomHoz.rightCol !== this.rightCol){
				
				var rowEl = row.getElement();
				while(rowEl.firstChild) rowEl.removeChild(rowEl.firstChild);
				
				this.initializeRow(row);
			}
		}
	}
}

class ColumnManager extends CoreFeature {
	
	constructor (table){
		super(table);
		
		this.blockHozScrollEvent = false;
		this.headersElement = null;
		this.contentsElement = null;
		this.rowHeader = null;
		this.element = null ; //containing element
		this.columns = []; // column definition object
		this.columnsByIndex = []; //columns by index
		this.columnsByField = {}; //columns by field
		this.scrollLeft = 0;
		this.optionsList = new OptionsList(this.table, "column definition", defaultColumnOptions);
		
		this.redrawBlock = false; //prevent redraws to allow multiple data manipulations before continuing
		this.redrawBlockUpdate = null; //store latest redraw update only status
		
		this.renderer = null;
	}
	
	////////////// Setup Functions /////////////////
	
	initialize(){
		this.initializeRenderer();
		
		this.headersElement = this.createHeadersElement();
		this.contentsElement = this.createHeaderContentsElement();
		this.element = this.createHeaderElement();
		
		this.contentsElement.insertBefore(this.headersElement, this.contentsElement.firstChild);
		this.element.insertBefore(this.contentsElement, this.element.firstChild);
		
		this.initializeScrollWheelWatcher();
		
		this.subscribe("scroll-horizontal", this.scrollHorizontal.bind(this));
		this.subscribe("scrollbar-vertical", this.padVerticalScrollbar.bind(this));
	}
	
	padVerticalScrollbar(width){
		if(this.table.rtl){
			this.headersElement.style.marginLeft = width + "px";
		}else {
			this.headersElement.style.marginRight = width + "px";
		}
	}
	
	initializeRenderer(){
		var renderClass;
		
		var renderers = {
			"virtual": VirtualDomHorizontal,
			"basic": BasicHorizontal,
		};
		
		if(typeof this.table.options.renderHorizontal === "string"){
			renderClass = renderers[this.table.options.renderHorizontal];
		}else {
			renderClass = this.table.options.renderHorizontal;
		}
		
		if(renderClass){
			this.renderer = new renderClass(this.table, this.element, this.tableElement);
			this.renderer.initialize();
		}else {
			console.error("Unable to find matching renderer:", this.table.options.renderHorizontal);
		}
	}
	
	
	createHeadersElement (){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-headers");
		el.setAttribute("role", "row");
		
		return el;
	}
	
	createHeaderContentsElement (){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-header-contents");
		el.setAttribute("role", "rowgroup");
		
		return el;
	}
	
	createHeaderElement (){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-header");
		el.setAttribute("role", "rowgroup");
		
		if(!this.table.options.headerVisible){
			el.classList.add("tabulator-header-hidden");
		}
		
		return el;
	}
	
	//return containing element
	getElement(){
		return this.element;
	}
	
	//return containing contents element
	getContentsElement(){
		return this.contentsElement;
	}
	
	
	//return header containing element
	getHeadersElement(){
		return this.headersElement;
	}
	
	//scroll horizontally to match table body
	scrollHorizontal(left){
		this.contentsElement.scrollLeft = left;
		
		this.scrollLeft = left;
		
		this.renderer.scrollColumns(left);
	}
	
	initializeScrollWheelWatcher(){
		this.contentsElement.addEventListener("wheel", (e) => {
			var left;
			
			if(e.deltaX){
				left = this.contentsElement.scrollLeft + e.deltaX;
				
				this.table.rowManager.scrollHorizontal(left);
				this.table.columnManager.scrollHorizontal(left);
			}
		});
	}
	
	///////////// Column Setup Functions /////////////
	generateColumnsFromRowData(data){
		var cols = [],
		collProgress = {},
		rowSample = this.table.options.autoColumns === "full" ? data : [data[0]],
		definitions = this.table.options.autoColumnsDefinitions;
		
		if(data && data.length){
			
			rowSample.forEach((row) => {
				
				Object.keys(row).forEach((key, index) => {
					let value = row[key],
					col;
					
					if(!collProgress[key]){
						col = {
							field:key,
							title:key,
							sorter:this.calculateSorterFromValue(value),
						};

						cols.splice(index, 0, col);
						collProgress[key] = typeof value === "undefined" ? col : true;
					}else if(collProgress[key] !== true){
						if(typeof value !== "undefined"){
							collProgress[key].sorter = this.calculateSorterFromValue(value);
							collProgress[key] = true;
						}
					}
				});
			});
			
			if(definitions){
				
				switch(typeof definitions){
					case "function":
						this.table.options.columns = definitions.call(this.table, cols);
						break;
					
					case "object":
						if(Array.isArray(definitions)){
							cols.forEach((col) => {
								var match = definitions.find((def) => {
									return def.field === col.field;
								});
								
								if(match){
									Object.assign(col, match);
								}
							});
							
						}else {
							cols.forEach((col) => {
								if(definitions[col.field]){
									Object.assign(col, definitions[col.field]);
								}
							});
						}
						
						this.table.options.columns = cols;
						break;
				}
			}else {
				this.table.options.columns = cols;
			}
			
			this.setColumns(this.table.options.columns);
		}
	}
	
	calculateSorterFromValue(value){
		var sorter;
		
		switch(typeof value){
			case "undefined":
				sorter = "string";
				break;
			
			case "boolean":
				sorter = "boolean";
				break;
			
			case "number":
				sorter = "number";
				break;
			
			case "object":
				if(Array.isArray(value)){
					sorter = "array";
				}else {
					sorter = "string";
				}
				break;
			
			default:
				if(!isNaN(value) && value !== ""){
					sorter = "number";
				}else {
					if(value.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)){
						sorter = "alphanum";
					}else {
						sorter = "string";
					}
				}
				break;
		}
		
		return sorter;
	}
	
	setColumns(cols, row){
		while(this.headersElement.firstChild) this.headersElement.removeChild(this.headersElement.firstChild);
		
		this.columns = [];
		this.columnsByIndex = [];
		this.columnsByField = {};
		
		this.dispatch("columns-loading");
		this.dispatchExternal("columnsLoading");
		
		if(this.table.options.rowHeader){
			this.rowHeader = new Column(this.table.options.rowHeader === true ? {} : this.table.options.rowHeader, this, true);
			this.columns.push(this.rowHeader);
			this.headersElement.appendChild(this.rowHeader.getElement());
			this.rowHeader.columnRendered();
		}
		
		cols.forEach((def, i) => {
			this._addColumn(def);
		});
		
		this._reIndexColumns();
		
		this.dispatch("columns-loaded");

		if(this.subscribedExternal("columnsLoaded")){
			this.dispatchExternal("columnsLoaded", this.getComponents());
		}
		
		this.rerenderColumns(false, true);
		
		this.redraw(true);
	}
	
	_addColumn(definition, before, nextToColumn){
		var column = new Column(definition, this),
		colEl = column.getElement(),
		index = nextToColumn ? this.findColumnIndex(nextToColumn) : nextToColumn;
		
		//prevent adding of rows in front of row header
		if(before && this.rowHeader && (!nextToColumn || nextToColumn === this.rowHeader)){
			before = false;
			nextToColumn = this.rowHeader;
			index = 0;
		}
		
		if(nextToColumn && index > -1){
			var topColumn = nextToColumn.getTopColumn();
			var parentIndex = this.columns.indexOf(topColumn);
			var nextEl = topColumn.getElement();
			
			if(before){
				this.columns.splice(parentIndex, 0, column);
				nextEl.parentNode.insertBefore(colEl, nextEl);
			}else {
				this.columns.splice(parentIndex + 1, 0, column);
				nextEl.parentNode.insertBefore(colEl, nextEl.nextSibling);
			}
		}else {
			if(before){
				this.columns.unshift(column);
				this.headersElement.insertBefore(column.getElement(), this.headersElement.firstChild);
			}else {
				this.columns.push(column);
				this.headersElement.appendChild(column.getElement());
			}
		}
		
		column.columnRendered();
		
		return column;
	}
	
	registerColumnField(col){
		if(col.definition.field){
			this.columnsByField[col.definition.field] = col;
		}
	}
	
	registerColumnPosition(col){
		this.columnsByIndex.push(col);
	}
	
	_reIndexColumns(){
		this.columnsByIndex = [];
		
		this.columns.forEach(function(column){
			column.reRegisterPosition();
		});
	}
	
	//ensure column headers take up the correct amount of space in column groups
	verticalAlignHeaders(){
		var minHeight = 0;
		
		if(!this.redrawBlock){
			
			this.headersElement.style.height="";
			
			this.columns.forEach((column) => {
				column.clearVerticalAlign();
			});
			
			this.columns.forEach((column) => {
				var height = column.getHeight();
				
				if(height > minHeight){
					minHeight = height;
				}
			});
			
			this.headersElement.style.height = minHeight + "px";
			
			this.columns.forEach((column) => {
				column.verticalAlign(this.table.options.columnHeaderVertAlign, minHeight);
			});
			
			this.table.rowManager.adjustTableSize();
		}
	}
	
	//////////////// Column Details /////////////////
	findColumn(subject){
		var columns;
		
		if(typeof subject == "object"){
			
			if(subject instanceof Column){
				//subject is column element
				return subject;
			}else if(subject instanceof ColumnComponent){
				//subject is public column component
				return subject._getSelf() || false;
			}else if(typeof HTMLElement !== "undefined" && subject instanceof HTMLElement){
				
				columns = [];
				
				this.columns.forEach((column) => {
					columns.push(column);
					columns = columns.concat(column.getColumns(true));
				});
				
				//subject is a HTML element of the column header
				let match = columns.find((column) => {
					return column.element === subject;
				});
				
				return match || false;
			}
			
		}else {
			//subject should be treated as the field name of the column
			return this.columnsByField[subject] || false;
		}
		
		//catch all for any other type of input
		return false;
	}
	
	getColumnByField(field){
		return this.columnsByField[field];
	}
	
	getColumnsByFieldRoot(root){
		var matches = [];
		
		Object.keys(this.columnsByField).forEach((field) => {
			var fieldRoot = this.table.options.nestedFieldSeparator ? field.split(this.table.options.nestedFieldSeparator)[0] : field;
			if(fieldRoot === root){
				matches.push(this.columnsByField[field]);
			}
		});
		
		return matches;
	}
	
	getColumnByIndex(index){
		return this.columnsByIndex[index];
	}
	
	getFirstVisibleColumn(){
		var index = this.columnsByIndex.findIndex((col) => {
			return col.visible;
		});
		
		return index > -1 ? this.columnsByIndex[index] : false;
	}
	
	getVisibleColumnsByIndex() {
		return this.columnsByIndex.filter((col) => col.visible);
	}
	
	getColumns(){
		return this.columns;
	}
	
	findColumnIndex(column){
		return this.columnsByIndex.findIndex((col) => {
			return column === col;
		});
	}
	
	//return all columns that are not groups
	getRealColumns(){
		return this.columnsByIndex;
	}
	
	//traverse across columns and call action
	traverse(callback){
		this.columnsByIndex.forEach((column,i) =>{
			callback(column, i);
		});
	}
	
	//get definitions of actual columns
	getDefinitions(active){
		var output = [];
		
		this.columnsByIndex.forEach((column) => {
			if(!active || (active && column.visible)){
				output.push(column.getDefinition());
			}
		});
		
		return output;
	}
	
	//get full nested definition tree
	getDefinitionTree(){
		var output = [];
		
		this.columns.forEach((column) => {
			output.push(column.getDefinition(true));
		});
		
		return output;
	}
	
	getComponents(structured){
		var output = [],
		columns = structured ? this.columns : this.columnsByIndex;
		
		columns.forEach((column) => {
			output.push(column.getComponent());
		});
		
		return output;
	}
	
	getWidth(){
		var width = 0;
		
		this.columnsByIndex.forEach((column) => {
			if(column.visible){
				width += column.getWidth();
			}
		});
		
		return width;
	}
	
	moveColumn(from, to, after){
		to.element.parentNode.insertBefore(from.element, to.element);
		
		if(after){
			to.element.parentNode.insertBefore(to.element, from.element);
		}
		
		this.moveColumnActual(from, to, after);
		
		this.verticalAlignHeaders();
		
		this.table.rowManager.reinitialize();
	}
	
	moveColumnActual(from, to, after){
		if(from.parent.isGroup){
			this._moveColumnInArray(from.parent.columns, from, to, after);
		}else {
			this._moveColumnInArray(this.columns, from, to, after);
		}
		
		this._moveColumnInArray(this.columnsByIndex, from, to, after, true);
		
		this.rerenderColumns(true);
		
		this.dispatch("column-moved", from, to, after);
		
		if(this.subscribedExternal("columnMoved")){
			this.dispatchExternal("columnMoved", from.getComponent(), this.table.columnManager.getComponents());
		}
	}
	
	_moveColumnInArray(columns, from, to, after, updateRows){
		var	fromIndex = columns.indexOf(from),
		toIndex, rows = [];
		
		if (fromIndex > -1) {
			
			columns.splice(fromIndex, 1);
			
			toIndex = columns.indexOf(to);
			
			if (toIndex > -1) {
				
				if(after){
					toIndex = toIndex+1;
				}
				
			}else {
				toIndex = fromIndex;
			}
			
			columns.splice(toIndex, 0, from);
			
			if(updateRows){
				
				rows = this.chain("column-moving-rows", [from, to, after], null, []) || [];
				
				rows = rows.concat(this.table.rowManager.rows);
				
				rows.forEach(function(row){
					if(row.cells.length){
						var cell = row.cells.splice(fromIndex, 1)[0];
						row.cells.splice(toIndex, 0, cell);
					}
				});
				
			}
		}
	}
	
	scrollToColumn(column, position, ifVisible){
		var left = 0,
		offset = column.getLeftOffset(),
		adjust = 0,
		colEl = column.getElement();
		
		
		return new Promise((resolve, reject) => {
			
			if(typeof position === "undefined"){
				position = this.table.options.scrollToColumnPosition;
			}
			
			if(typeof ifVisible === "undefined"){
				ifVisible = this.table.options.scrollToColumnIfVisible;
			}
			
			if(column.visible){
				
				//align to correct position
				switch(position){
					case "middle":
					case "center":
						adjust = -this.element.clientWidth / 2;
						break;
					
					case "right":
						adjust = colEl.clientWidth - this.headersElement.clientWidth;
						break;
				}
				
				//check column visibility
				if(!ifVisible){
					if(offset > 0 && offset + colEl.offsetWidth < this.element.clientWidth){
						return false;
					}
				}
				
				//calculate scroll position
				left = offset + adjust;
				
				left = Math.max(Math.min(left, this.table.rowManager.element.scrollWidth - this.table.rowManager.element.clientWidth),0);
				
				this.table.rowManager.scrollHorizontal(left);
				this.scrollHorizontal(left);
				
				resolve();
			}else {
				console.warn("Scroll Error - Column not visible");
				reject("Scroll Error - Column not visible");
			}
			
		});
	}
	
	//////////////// Cell Management /////////////////
	generateCells(row){
		var cells = [];
		
		this.columnsByIndex.forEach((column) => {
			cells.push(column.generateCell(row));
		});
		
		return cells;
	}
	
	//////////////// Column Management /////////////////
	getFlexBaseWidth(){
		var totalWidth = this.table.element.clientWidth, //table element width
		fixedWidth = 0;
		
		//adjust for vertical scrollbar if present
		if(this.table.rowManager.element.scrollHeight > this.table.rowManager.element.clientHeight){
			totalWidth -= this.table.rowManager.element.offsetWidth - this.table.rowManager.element.clientWidth;
		}
		
		this.columnsByIndex.forEach(function(column){
			var width, minWidth, colWidth;
			
			if(column.visible){
				
				width = column.definition.width || 0;
				
				minWidth = parseInt(column.minWidth);
				
				if(typeof(width) == "string"){
					if(width.indexOf("%") > -1){
						colWidth = (totalWidth / 100) * parseInt(width) ;
					}else {
						colWidth = parseInt(width);
					}
				}else {
					colWidth = width;
				}
				
				fixedWidth += colWidth > minWidth ? colWidth : minWidth;
				
			}
		});
		
		return fixedWidth;
	}
	
	addColumn(definition, before, nextToColumn){
		return new Promise((resolve, reject) => {
			var column = this._addColumn(definition, before, nextToColumn);
			
			this._reIndexColumns();
			
			this.dispatch("column-add", definition, before, nextToColumn);
			
			if(this.layoutMode() != "fitColumns"){
				column.reinitializeWidth();
			}
			
			this.redraw(true);
			
			this.table.rowManager.reinitialize();
			
			this.rerenderColumns();
			
			resolve(column);
		});
	}
	
	//remove column from system
	deregisterColumn(column){
		var field = column.getField(),
		index;
		
		//remove from field list
		if(field){
			delete this.columnsByField[field];
		}
		
		//remove from index list
		index = this.columnsByIndex.indexOf(column);
		
		if(index > -1){
			this.columnsByIndex.splice(index, 1);
		}
		
		//remove from column list
		index = this.columns.indexOf(column);
		
		if(index > -1){
			this.columns.splice(index, 1);
		}
		
		this.verticalAlignHeaders();
		
		this.redraw();
	}
	
	rerenderColumns(update, silent){
		if(!this.redrawBlock){
			this.renderer.rerenderColumns(update, silent);
		}else {
			if(update === false || (update === true && this.redrawBlockUpdate === null)){
				this.redrawBlockUpdate = update;
			}
		}
	}
	
	blockRedraw(){
		this.redrawBlock = true;
		this.redrawBlockUpdate = null;
	}
	
	restoreRedraw(){
		this.redrawBlock = false;
		this.verticalAlignHeaders();
		this.renderer.rerenderColumns(this.redrawBlockUpdate);
		
	}
	
	//redraw columns
	redraw(force){
		if(Helpers.elVisible(this.element)){
			this.verticalAlignHeaders();
		}
		
		if(force){
			this.table.rowManager.resetScroll();
			this.table.rowManager.reinitialize();
		}
		
		if(!this.confirm("table-redrawing", force)){
			this.layoutRefresh(force);
		}
		
		this.dispatch("table-redraw", force);
		
		this.table.footerManager.redraw();
	}
}

class BasicVertical extends Renderer{
	constructor(table){
		super(table);
		
		this.verticalFillMode = "fill";
		
		this.scrollTop = 0;
		this.scrollLeft = 0;
		
		this.scrollTop = 0;
		this.scrollLeft = 0;
	}
	
	clearRows(){
		var element = this.tableElement;
		
		// element.children.detach();
		while(element.firstChild) element.removeChild(element.firstChild);
		
		element.scrollTop = 0;
		element.scrollLeft = 0;
		
		element.style.minWidth = "";
		element.style.minHeight = "";
		element.style.display = "";
		element.style.visibility = "";
	}
	
	renderRows() {
		var element = this.tableElement,
		onlyGroupHeaders = true,
		tableFrag = document.createDocumentFragment(),
		rows = this.rows();
		
		rows.forEach((row, index) => {
			this.styleRow(row, index);
			row.initialize(false, true);
			
			if (row.type !== "group") {
				onlyGroupHeaders = false;
			}
			
			tableFrag.appendChild(row.getElement());
		});
		
		element.appendChild(tableFrag);
		
		rows.forEach((row) => {
			row.rendered();
			
			if(!row.heightInitialized) {
				row.calcHeight(true);
			}
		});
		
		rows.forEach((row) => {
			if(!row.heightInitialized) {
				row.setCellHeight();
			}
		});
		
		if(onlyGroupHeaders){
			element.style.minWidth = this.table.columnManager.getWidth() + "px";
		}else {
			element.style.minWidth = "";
		}
	}
	
	
	rerenderRows(callback){	
		this.clearRows();
		
		if(callback){
			callback();
		}
		
		this.renderRows();

		if(!this.rows().length){
			this.table.rowManager.tableEmpty();
		}
	}
	
	scrollToRowNearestTop(row){
		var rowTop = Helpers.elOffset(row.getElement()).top;
		
		return !(Math.abs(this.elementVertical.scrollTop - rowTop) > Math.abs(this.elementVertical.scrollTop + this.elementVertical.clientHeight - rowTop));
	}
	
	scrollToRow(row){
		var rowEl = row.getElement();
		
		this.elementVertical.scrollTop = Helpers.elOffset(rowEl).top - Helpers.elOffset(this.elementVertical).top + this.elementVertical.scrollTop;
	}
	
	visibleRows(includingBuffer){
		return this.rows();
	}
	
}

class VirtualDomVertical extends Renderer{
	constructor(table){
		super(table);

		this.verticalFillMode = "fill";

		this.scrollTop = 0;
		this.scrollLeft = 0;

		this.vDomRowHeight = 20; //approximation of row heights for padding

		this.vDomTop = 0; //hold position for first rendered row in the virtual DOM
		this.vDomBottom = 0; //hold position for last rendered row in the virtual DOM

		this.vDomScrollPosTop = 0; //last scroll position of the vDom top;
		this.vDomScrollPosBottom = 0; //last scroll position of the vDom bottom;

		this.vDomTopPad = 0; //hold value of padding for top of virtual DOM
		this.vDomBottomPad = 0; //hold value of padding for bottom of virtual DOM

		this.vDomMaxRenderChain = 90; //the maximum number of dom elements that can be rendered in 1 go

		this.vDomWindowBuffer = 0; //window row buffer before removing elements, to smooth scrolling

		this.vDomWindowMinTotalRows = 20; //minimum number of rows to be generated in virtual dom (prevent buffering issues on tables with tall rows)
		this.vDomWindowMinMarginRows = 5; //minimum number of rows to be generated in virtual dom margin

		this.vDomTopNewRows = []; //rows to normalize after appending to optimize render speed
		this.vDomBottomNewRows = []; //rows to normalize after appending to optimize render speed
	}

	//////////////////////////////////////
	///////// Public Functions ///////////
	//////////////////////////////////////

	clearRows(){
		var element = this.tableElement;

		// element.children.detach();
		while(element.firstChild) element.removeChild(element.firstChild);

		element.style.paddingTop = "";
		element.style.paddingBottom = "";
		element.style.minHeight = "";
		element.style.display = "";
		element.style.visibility = "";

		this.elementVertical.scrollTop = 0;
		this.elementVertical.scrollLeft = 0;

		this.scrollTop = 0;
		this.scrollLeft = 0;

		this.vDomTop = 0;
		this.vDomBottom = 0;
		this.vDomTopPad = 0;
		this.vDomBottomPad = 0;
		this.vDomScrollPosTop = 0;
		this.vDomScrollPosBottom = 0;
	}

	renderRows(){
		this._virtualRenderFill();
	}

	rerenderRows(callback){
		var scrollTop = this.elementVertical.scrollTop;
		var topRow = false;
		var topOffset = false;

		var left = this.table.rowManager.scrollLeft;

		var rows = this.rows();

		for(var i = this.vDomTop; i <= this.vDomBottom; i++){

			if(rows[i]){
				var diff = scrollTop - rows[i].getElement().offsetTop;

				if(topOffset === false || Math.abs(diff) < topOffset){
					topOffset = diff;
					topRow = i;
				}else {
					break;
				}
			}
		}

		rows.forEach((row) => {
			row.deinitializeHeight();
		});

		if(callback){
			callback();
		}

		if(this.rows().length){
			this._virtualRenderFill((topRow === false ? this.rows.length - 1 : topRow), true, topOffset || 0);
		}else {
			this.clear();
			this.table.rowManager.tableEmpty();
		}

		this.scrollColumns(left);
	}

	scrollColumns(left){
		this.table.rowManager.scrollHorizontal(left);
	}

	scrollRows(top, dir){
		var topDiff = top - this.vDomScrollPosTop;
		var bottomDiff = top - this.vDomScrollPosBottom;
		var margin = this.vDomWindowBuffer * 2;
		var rows = this.rows();

		this.scrollTop = top;

		if(-topDiff > margin || bottomDiff > margin){
			//if big scroll redraw table;
			var left = this.table.rowManager.scrollLeft;
			this._virtualRenderFill(Math.floor((this.elementVertical.scrollTop / this.elementVertical.scrollHeight) * rows.length));
			this.scrollColumns(left);
		}else {

			if(dir){
				//scrolling up
				if(topDiff < 0){
					this._addTopRow(rows, -topDiff);
				}

				if(bottomDiff < 0){
					//hide bottom row if needed
					if(this.vDomScrollHeight - this.scrollTop > this.vDomWindowBuffer){
						this._removeBottomRow(rows, -bottomDiff);
					}else {
						this.vDomScrollPosBottom = this.scrollTop;
					}
				}
			}else {

				if(bottomDiff >= 0){
					this._addBottomRow(rows, bottomDiff);
				}

				//scrolling down
				if(topDiff >= 0){
					//hide top row if needed
					if(this.scrollTop > this.vDomWindowBuffer){
						this._removeTopRow(rows, topDiff);
					}else {
						this.vDomScrollPosTop = this.scrollTop;
					}
				}
			}
		}
	}

	resize(){
		this.vDomWindowBuffer = this.table.options.renderVerticalBuffer || this.elementVertical.clientHeight;
	}

	scrollToRowNearestTop(row){
		var rowIndex = this.rows().indexOf(row);

		return !(Math.abs(this.vDomTop - rowIndex) > Math.abs(this.vDomBottom - rowIndex));
	}

	scrollToRow(row){
		var index = this.rows().indexOf(row);

		if(index > -1){
			this._virtualRenderFill(index, true);
		}
	}

	visibleRows(includingBuffer){
		var topEdge = this.elementVertical.scrollTop,
		bottomEdge = this.elementVertical.clientHeight + topEdge,
		topFound = false,
		topRow = 0,
		bottomRow = 0,
		rows = this.rows();

		if(includingBuffer){
			topRow = this.vDomTop;
			bottomRow = this.vDomBottom;
		}else {
			for(var i = this.vDomTop; i <= this.vDomBottom; i++){
				if(rows[i]){
					if(!topFound){
						if((topEdge - rows[i].getElement().offsetTop) >= 0){
							topRow = i;
						}else {
							topFound = true;

							if(bottomEdge - rows[i].getElement().offsetTop >= 0){
								bottomRow = i;
							}else {
								break;
							}
						}
					}else {
						if(bottomEdge - rows[i].getElement().offsetTop >= 0){
							bottomRow = i;
						}else {
							break;
						}
					}
				}
			}
		}

		return rows.slice(topRow, bottomRow + 1);
	}

	//////////////////////////////////////
	//////// Internal Rendering //////////
	//////////////////////////////////////

	//full virtual render
	_virtualRenderFill(position, forceMove, offset) {
		var	element = this.tableElement,
		holder = this.elementVertical,
		topPad = 0,
		rowsHeight = 0,
		rowHeight = 0,
		heightOccupied = 0,
		topPadHeight = 0,
		i = 0,
		rows = this.rows(),
		rowsCount = rows.length,
		index = 0,
		row,
		rowFragment,
		renderedRows = [],
		totalRowsRendered = 0,
		rowsToRender = 0,
		fixedHeight = this.table.rowManager.fixedHeight,
		containerHeight = this.elementVertical.clientHeight, 
		avgRowHeight = this.table.options.rowHeight, 
		resized = true;

		position = position || 0;

		offset = offset || 0;

		if(!position){
			this.clear();
		}else {
			while(element.firstChild) element.removeChild(element.firstChild);

			//check if position is too close to bottom of table
			heightOccupied = (rowsCount - position + 1) * this.vDomRowHeight;

			if(heightOccupied < containerHeight){
				position -= Math.ceil((containerHeight - heightOccupied) / this.vDomRowHeight);
				if(position < 0){
					position = 0;
				}
			}

			//calculate initial pad
			topPad = Math.min(Math.max(Math.floor(this.vDomWindowBuffer / this.vDomRowHeight),  this.vDomWindowMinMarginRows), position);
			position -= topPad;
		}

		if(rowsCount && Helpers.elVisible(this.elementVertical)){
			this.vDomTop = position;
			this.vDomBottom = position -1;

			if(fixedHeight || this.table.options.maxHeight) {
				if(avgRowHeight) {
					rowsToRender = (containerHeight / avgRowHeight) + (this.vDomWindowBuffer / avgRowHeight);
				}
				rowsToRender = Math.max(this.vDomWindowMinTotalRows, Math.ceil(rowsToRender));
			}
			else {
				rowsToRender = rowsCount;
			}

			while(((rowsToRender == rowsCount || rowsHeight <= containerHeight + this.vDomWindowBuffer) || totalRowsRendered < this.vDomWindowMinTotalRows) && this.vDomBottom < rowsCount -1) {
				renderedRows = [];
				rowFragment = document.createDocumentFragment();

				i = 0;

				while ((i < rowsToRender) && this.vDomBottom < rowsCount -1) {	
					index = this.vDomBottom + 1,
					row = rows[index];

					this.styleRow(row, index);

					row.initialize(false, true);
					if(!row.heightInitialized && !this.table.options.rowHeight){
						row.clearCellHeight();
					}

					rowFragment.appendChild(row.getElement());
					renderedRows.push(row);
					this.vDomBottom ++;
					i++;
				}

				if(!renderedRows.length){
					break;
				}

				element.appendChild(rowFragment);
				
				// NOTE: The next 3 loops are separate on purpose
				// This is to batch up the dom writes and reads which drastically improves performance 

				renderedRows.forEach((row) => {
					row.rendered();

					if(!row.heightInitialized) {
						row.calcHeight(true);
					}
				});

				renderedRows.forEach((row) => {
					if(!row.heightInitialized) {
						row.setCellHeight();
					}
				});

				renderedRows.forEach((row) => {
					rowHeight = row.getHeight();
					
					if(totalRowsRendered < topPad){
						topPadHeight += rowHeight;
					}else {
						rowsHeight += rowHeight;
					}

					if(rowHeight > this.vDomWindowBuffer){
						this.vDomWindowBuffer = rowHeight * 2;
					}
					totalRowsRendered++;
				});

				resized = this.table.rowManager.adjustTableSize();
				containerHeight = this.elementVertical.clientHeight;
				if(resized && (fixedHeight || this.table.options.maxHeight))
				{
					avgRowHeight = rowsHeight / totalRowsRendered;
					rowsToRender = Math.max(this.vDomWindowMinTotalRows, Math.ceil((containerHeight / avgRowHeight) + (this.vDomWindowBuffer / avgRowHeight)));
				}
			}

			if(!position){
				this.vDomTopPad = 0;
				//adjust row height to match average of rendered elements
				this.vDomRowHeight = Math.floor((rowsHeight + topPadHeight) / totalRowsRendered);
				this.vDomBottomPad = this.vDomRowHeight * (rowsCount - this.vDomBottom -1);

				this.vDomScrollHeight = topPadHeight + rowsHeight + this.vDomBottomPad - containerHeight;
			}else {
				this.vDomTopPad = !forceMove ? this.scrollTop - topPadHeight : (this.vDomRowHeight * this.vDomTop) + offset;
				this.vDomBottomPad = this.vDomBottom == rowsCount-1 ? 0 : Math.max(this.vDomScrollHeight - this.vDomTopPad - rowsHeight - topPadHeight, 0);
			}
			
			element.style.paddingTop = this.vDomTopPad+"px";
			element.style.paddingBottom = this.vDomBottomPad+"px";

			if(forceMove){
				this.scrollTop = this.vDomTopPad + (topPadHeight) + offset - (this.elementVertical.scrollWidth > this.elementVertical.clientWidth ? this.elementVertical.offsetHeight - containerHeight : 0);
			}

			this.scrollTop = Math.min(this.scrollTop, this.elementVertical.scrollHeight - containerHeight);

			//adjust for horizontal scrollbar if present (and not at top of table)
			if(this.elementVertical.scrollWidth > this.elementVertical.clientWidth && forceMove){
				this.scrollTop += this.elementVertical.offsetHeight - containerHeight;
			}

			this.vDomScrollPosTop = this.scrollTop;
			this.vDomScrollPosBottom = this.scrollTop;

			holder.scrollTop = this.scrollTop;

			this.dispatch("render-virtual-fill");
		}
	}

	_addTopRow(rows, fillableSpace){
		var table = this.tableElement,
		addedRows = [],
		paddingAdjust = 0,
		index = this.vDomTop -1,
		i = 0,
		working = true;

		while(working){
			if(this.vDomTop){
				let row = rows[index],
				rowHeight, initialized;

				if(row && i < this.vDomMaxRenderChain){
					rowHeight = row.getHeight() || this.vDomRowHeight;
					initialized = row.initialized;

					if(fillableSpace >= rowHeight){

						this.styleRow(row, index);
						table.insertBefore(row.getElement(), table.firstChild);

						if(!row.initialized || !row.heightInitialized){
							addedRows.push(row);
						}

						row.initialize();

						if(!initialized){
							rowHeight = row.getElement().offsetHeight;

							if(rowHeight > this.vDomWindowBuffer){
								this.vDomWindowBuffer = rowHeight * 2;
							}
						}

						fillableSpace -= rowHeight;
						paddingAdjust += rowHeight;

						this.vDomTop--;
						index--;
						i++;

					}else {
						working = false;
					}

				}else {
					working = false;
				}

			}else {
				working = false;
			}
		}

		for (let row of addedRows){
			row.clearCellHeight();
		}

		this._quickNormalizeRowHeight(addedRows);

		if(paddingAdjust){
			this.vDomTopPad -= paddingAdjust;

			if(this.vDomTopPad < 0){
				this.vDomTopPad = index * this.vDomRowHeight;
			}

			if(index < 1){
				this.vDomTopPad = 0;
			}

			table.style.paddingTop = this.vDomTopPad + "px";
			this.vDomScrollPosTop -= paddingAdjust;
		}
	}

	_removeTopRow(rows, fillableSpace){
		var removableRows = [],
		paddingAdjust = 0,
		i = 0,
		working = true;

		while(working){
			let row = rows[this.vDomTop],
			rowHeight;

			if(row && i < this.vDomMaxRenderChain){
				rowHeight = row.getHeight() || this.vDomRowHeight;

				if(fillableSpace >= rowHeight){
					this.vDomTop++;

					fillableSpace -= rowHeight;
					paddingAdjust += rowHeight;

					removableRows.push(row);
					i++;
				}else {
					working = false;
				}
			}else {
				working = false;
			}
		}

		for (let row of removableRows){
			let rowEl = row.getElement();

			if(rowEl.parentNode){
				rowEl.parentNode.removeChild(rowEl);
			}
		}

		if(paddingAdjust){
			this.vDomTopPad += paddingAdjust;
			this.tableElement.style.paddingTop = this.vDomTopPad + "px";
			this.vDomScrollPosTop += this.vDomTop ? paddingAdjust : paddingAdjust + this.vDomWindowBuffer;
		}
	}

	_addBottomRow(rows, fillableSpace){
		var table = this.tableElement,
		addedRows = [],
		paddingAdjust = 0,
		index = this.vDomBottom + 1,
		i = 0,
		working = true;

		while(working){
			let row = rows[index],
			rowHeight, initialized;

			if(row && i < this.vDomMaxRenderChain){
				rowHeight = row.getHeight() || this.vDomRowHeight;
				initialized = row.initialized;

				if(fillableSpace >= rowHeight){

					this.styleRow(row, index);
					table.appendChild(row.getElement());

					if(!row.initialized || !row.heightInitialized){
						addedRows.push(row);
					}

					row.initialize();

					if(!initialized){
						rowHeight = row.getElement().offsetHeight;

						if(rowHeight > this.vDomWindowBuffer){
							this.vDomWindowBuffer = rowHeight * 2;
						}
					}

					fillableSpace -= rowHeight;
					paddingAdjust += rowHeight;

					this.vDomBottom++;
					index++;
					i++;
				}else {
					working = false;
				}
			}else {
				working = false;
			}
		}

		for (let row of addedRows){
			row.clearCellHeight();
		}

		this._quickNormalizeRowHeight(addedRows);

		if(paddingAdjust){
			this.vDomBottomPad -= paddingAdjust;

			if(this.vDomBottomPad < 0 || index == rows.length -1){
				this.vDomBottomPad = 0;
			}

			table.style.paddingBottom = this.vDomBottomPad + "px";
			this.vDomScrollPosBottom += paddingAdjust;
		}
	}

	_removeBottomRow(rows, fillableSpace){
		var removableRows = [],
		paddingAdjust = 0,
		i = 0,
		working = true;

		while(working){
			let row = rows[this.vDomBottom],
			rowHeight;

			if(row && i < this.vDomMaxRenderChain){
				rowHeight = row.getHeight() || this.vDomRowHeight;

				if(fillableSpace >= rowHeight){
					this.vDomBottom --;

					fillableSpace -= rowHeight;
					paddingAdjust += rowHeight;

					removableRows.push(row);
					i++;
				}else {
					working = false;
				}
			}else {
				working = false;
			}
		}

		for (let row of removableRows){
			let rowEl = row.getElement();

			if(rowEl.parentNode){
				rowEl.parentNode.removeChild(rowEl);
			}
		}

		if(paddingAdjust){
			this.vDomBottomPad += paddingAdjust;

			if(this.vDomBottomPad < 0){
				this.vDomBottomPad = 0;
			}

			this.tableElement.style.paddingBottom = this.vDomBottomPad + "px";
			this.vDomScrollPosBottom -= paddingAdjust;
		}
	}

	_quickNormalizeRowHeight(rows){
		for(let row of rows){
			row.calcHeight();
		}

		for(let row of rows){
			row.setCellHeight();
		}
	}
}

class RowManager extends CoreFeature{
	
	constructor(table){
		super(table);
		
		this.element = this.createHolderElement(); //containing element
		this.tableElement = this.createTableElement(); //table element
		this.heightFixer = this.createTableElement(); //table element
		this.placeholder = null; //placeholder element
		this.placeholderContents = null; //placeholder element
		
		this.firstRender = false; //handle first render
		this.renderMode = "virtual"; //current rendering mode
		this.fixedHeight = false; //current rendering mode
		
		this.rows = []; //hold row data objects
		this.activeRowsPipeline = []; //hold calculation of active rows
		this.activeRows = []; //rows currently available to on display in the table
		this.activeRowsCount = 0; //count of active rows
		
		this.displayRows = []; //rows currently on display in the table
		this.displayRowsCount = 0; //count of display rows
		
		this.scrollTop = 0;
		this.scrollLeft = 0;
		
		this.redrawBlock = false; //prevent redraws to allow multiple data manipulations before continuing
		this.redrawBlockRestoreConfig = false; //store latest redraw function calls for when redraw is needed
		this.redrawBlockRenderInPosition = false; //store latest redraw function calls for when redraw is needed
		
		this.dataPipeline = []; //hold data pipeline tasks
		this.displayPipeline = []; //hold data display pipeline tasks
		
		this.scrollbarWidth = 0;
		
		this.renderer = null;
	}
	
	//////////////// Setup Functions /////////////////
	
	createHolderElement (){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-tableholder");
		el.setAttribute("tabindex", 0);
		// el.setAttribute("role", "rowgroup");
		
		return el;
	}
	
	createTableElement (){
		var el = document.createElement("div");
		
		el.classList.add("tabulator-table");
		el.setAttribute("role", "rowgroup");
		
		return el;
	}
	
	initializePlaceholder(){
		var placeholder = this.table.options.placeholder;
		
		if(typeof placeholder === "function"){
			placeholder = placeholder.call(this.table);
		}
		
		placeholder = this.chain("placeholder", [placeholder], placeholder, placeholder) || placeholder;
		
		//configure placeholder element
		if(placeholder){	
			let el = document.createElement("div");
			el.classList.add("tabulator-placeholder");
			
			if(typeof placeholder == "string"){
				let contents = document.createElement("div");
				contents.classList.add("tabulator-placeholder-contents");
				contents.innerHTML = placeholder;
				
				el.appendChild(contents);
				
				this.placeholderContents = contents;
				
			}else if(typeof HTMLElement !== "undefined" && placeholder instanceof HTMLElement){
				
				el.appendChild(placeholder);
				this.placeholderContents = placeholder;
			}else {
				console.warn("Invalid placeholder provided, must be string or HTML Element", placeholder);
				
				this.el = null;
			}
			
			this.placeholder = el;
		}
	}
	
	//return containing element
	getElement(){
		return this.element;
	}
	
	//return table element
	getTableElement(){
		return this.tableElement;
	}
	
	initialize(){
		this.initializePlaceholder();
		this.initializeRenderer();
		
		//initialize manager
		this.element.appendChild(this.tableElement);
		
		this.firstRender = true;
		
		//scroll header along with table body
		this.element.addEventListener("scroll", () => {
			var left = this.element.scrollLeft,
			leftDir = this.scrollLeft > left,
			top = this.element.scrollTop,
			topDir = this.scrollTop > top;
			
			//handle horizontal scrolling
			if(this.scrollLeft != left){
				this.scrollLeft = left;
				
				this.dispatch("scroll-horizontal", left, leftDir);
				this.dispatchExternal("scrollHorizontal", left, leftDir);
				
				this._positionPlaceholder();
			}
			
			//handle vertical scrolling
			if(this.scrollTop != top){
				this.scrollTop = top;
				
				this.renderer.scrollRows(top, topDir);
				
				this.dispatch("scroll-vertical", top, topDir);
				this.dispatchExternal("scrollVertical", top, topDir);
			}
		});
	}
	
	////////////////// Row Manipulation //////////////////
	findRow(subject){
		if(typeof subject == "object"){
			if(subject instanceof Row){
				//subject is row element
				return subject;
			}else if(subject instanceof RowComponent){
				//subject is public row component
				return subject._getSelf() || false;
			}else if(typeof HTMLElement !== "undefined" && subject instanceof HTMLElement){
				//subject is a HTML element of the row
				let match = this.rows.find((row) => {
					return row.getElement() === subject;
				});
				
				return match || false;
			}else if(subject === null){
				return false;
			}
		}else if(typeof subject == "undefined"){
			return false;
		}else {
			//subject should be treated as the index of the row
			let match = this.rows.find((row) => {
				return row.data[this.table.options.index] == subject;
			});
			
			return match || false;
		}
		
		//catch all for any other type of input
		return false;
	}
	
	getRowFromDataObject(data){
		var match = this.rows.find((row) => {
			return row.data === data;
		});
		
		return match || false;
	}
	
	getRowFromPosition(position){
		return this.getDisplayRows().find((row) => {
			return row.type === "row" && row.getPosition() === position && row.isDisplayed();
		});
	}
	
	scrollToRow(row, position, ifVisible){
		return this.renderer.scrollToRowPosition(row, position, ifVisible);
	}
	
	////////////////// Data Handling //////////////////
	setData(data, renderInPosition, columnsChanged){
		return new Promise((resolve, reject)=>{
			if(renderInPosition && this.getDisplayRows().length){
				if(this.table.options.pagination){
					this._setDataActual(data, true);
				}else {
					this.reRenderInPosition(() => {
						this._setDataActual(data);
					});
				}
			}else {
				if(this.table.options.autoColumns && columnsChanged && this.table.initialized){
					this.table.columnManager.generateColumnsFromRowData(data);
				}
				this.resetScroll();
				
				this._setDataActual(data);
			}
			
			resolve();
		});
	}
	
	_setDataActual(data, renderInPosition){
		this.dispatchExternal("dataProcessing", data);
		
		this._wipeElements();
		
		if(Array.isArray(data)){
			this.dispatch("data-processing", data);
			
			data.forEach((def, i) => {
				if(def && typeof def === "object"){
					var row = new Row(def, this);
					this.rows.push(row);
				}else {
					console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:", def);
				}
			});
			
			this.refreshActiveData(false, false, renderInPosition);
			
			this.dispatch("data-processed", data);
			this.dispatchExternal("dataProcessed", data);
		}else {
			console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ", typeof data, "\nData:     ", data);
		}
	}
	
	_wipeElements(){
		this.dispatch("rows-wipe");
		
		this.destroy();
		
		this.adjustTableSize();
		
		this.dispatch("rows-wiped");
	}
	
	destroy(){
		this.rows.forEach((row) => {
			row.wipe();
		});
		
		this.rows = [];
		this.activeRows = [];
		this.activeRowsPipeline = [];
		this.activeRowsCount = 0;
		this.displayRows = [];
		this.displayRowsCount = 0;
	}
	
	deleteRow(row, blockRedraw){
		var allIndex = this.rows.indexOf(row),
		activeIndex = this.activeRows.indexOf(row);
		
		if(activeIndex > -1){
			this.activeRows.splice(activeIndex, 1);
		}
		
		if(allIndex > -1){
			this.rows.splice(allIndex, 1);
		}
		
		this.setActiveRows(this.activeRows);
		
		this.displayRowIterator((rows) => {
			var displayIndex = rows.indexOf(row);
			
			if(displayIndex > -1){
				rows.splice(displayIndex, 1);
			}
		});
		
		if(!blockRedraw){
			this.reRenderInPosition();
		}
		
		this.regenerateRowPositions();
		
		this.dispatchExternal("rowDeleted", row.getComponent());
		
		if(!this.displayRowsCount){
			this.tableEmpty();
		}
		
		if(this.subscribedExternal("dataChanged")){
			this.dispatchExternal("dataChanged", this.getData());
		}
	}
	
	addRow(data, pos, index, blockRedraw){
		var row = this.addRowActual(data, pos, index, blockRedraw);
		return row;
	}
	
	//add multiple rows
	addRows(data, pos, index, refreshDisplayOnly){
		var rows = [];
		
		return new Promise((resolve, reject) => {
			pos = this.findAddRowPos(pos);
			
			if(!Array.isArray(data)){
				data = [data];
			}
			
			if((typeof index == "undefined" && pos) || (typeof index !== "undefined" && !pos)){
				data.reverse();
			}
			
			data.forEach((item, i) => {
				var row = this.addRow(item, pos, index, true);
				rows.push(row);
				this.dispatch("row-added", row, item, pos, index);
			});
			
			this.refreshActiveData(refreshDisplayOnly ? "displayPipeline" : false, false, true);
			
			this.regenerateRowPositions();
			
			if(this.displayRowsCount){
				this._clearPlaceholder();
			}
			
			resolve(rows);
		});
	}
	
	findAddRowPos(pos){
		if(typeof pos === "undefined"){
			pos = this.table.options.addRowPos;
		}
		
		if(pos === "pos"){
			pos = true;
		}
		
		if(pos === "bottom"){
			pos = false;
		}
		
		return pos;
	}
	
	addRowActual(data, pos, index, blockRedraw){
		var row = data instanceof Row ? data : new Row(data || {}, this),
		top = this.findAddRowPos(pos),
		allIndex = -1,
		activeIndex, chainResult;
		
		if(!index){
			chainResult = this.chain("row-adding-position", [row, top], null, {index, top});
			
			index = chainResult.index;
			top = chainResult.top;
		}
		
		if(typeof index !== "undefined"){
			index = this.findRow(index);
		}
		
		index = this.chain("row-adding-index", [row, index, top], null, index);
		
		if(index){
			allIndex = this.rows.indexOf(index);
		}
		
		if(index && allIndex > -1){
			activeIndex = this.activeRows.indexOf(index);
			
			this.displayRowIterator(function(rows){
				var displayIndex = rows.indexOf(index);
				
				if(displayIndex > -1){
					rows.splice((top ? displayIndex : displayIndex + 1), 0, row);
				}
			});
			
			if(activeIndex > -1){
				this.activeRows.splice((top ? activeIndex : activeIndex + 1), 0, row);
			}
			
			this.rows.splice((top ? allIndex : allIndex + 1), 0, row);
			
		}else {
			
			if(top){
				
				this.displayRowIterator(function(rows){
					rows.unshift(row);
				});
				
				this.activeRows.unshift(row);
				this.rows.unshift(row);
			}else {
				this.displayRowIterator(function(rows){
					rows.push(row);
				});
				
				this.activeRows.push(row);
				this.rows.push(row);
			}
		}
		
		this.setActiveRows(this.activeRows);
		
		this.dispatchExternal("rowAdded", row.getComponent());
		
		if(this.subscribedExternal("dataChanged")){
			this.dispatchExternal("dataChanged", this.table.rowManager.getData());
		}
		
		if(!blockRedraw){
			this.reRenderInPosition();
		}
		
		return row;
	}
	
	moveRow(from, to, after){
		this.dispatch("row-move", from, to, after);
		
		this.moveRowActual(from, to, after);
		
		this.regenerateRowPositions();
		
		this.dispatch("row-moved", from, to, after);
		this.dispatchExternal("rowMoved", from.getComponent());
	}
	
	moveRowActual(from, to, after){
		this.moveRowInArray(this.rows, from, to, after);
		this.moveRowInArray(this.activeRows, from, to, after);
		
		this.displayRowIterator((rows) => {
			this.moveRowInArray(rows, from, to, after);
		});
		
		this.dispatch("row-moving", from, to, after);
	}
	
	moveRowInArray(rows, from, to, after){
		var	fromIndex, toIndex, start, end;
		
		if(from !== to){
			
			fromIndex = rows.indexOf(from);
			
			if (fromIndex > -1) {
				
				rows.splice(fromIndex, 1);
				
				toIndex = rows.indexOf(to);
				
				if (toIndex > -1) {
					
					if(after){
						rows.splice(toIndex+1, 0, from);
					}else {
						rows.splice(toIndex, 0, from);
					}
					
				}else {
					rows.splice(fromIndex, 0, from);
				}
			}
			
			//restyle rows
			if(rows === this.getDisplayRows()){
				
				start = fromIndex < toIndex ? fromIndex : toIndex;
				end = toIndex > fromIndex ? toIndex : fromIndex +1;
				
				for(let i = start; i <= end; i++){
					if(rows[i]){
						this.styleRow(rows[i], i);
					}
				}
			}
		}
	}
	
	clearData(){
		this.setData([]);
	}
	
	getRowIndex(row){
		return this.findRowIndex(row, this.rows);
	}
	
	getDisplayRowIndex(row){
		var index = this.getDisplayRows().indexOf(row);
		return index > -1 ? index : false;
	}
	
	nextDisplayRow(row, rowOnly){
		var index = this.getDisplayRowIndex(row),
		nextRow = false;
		
		
		if(index !== false && index < this.displayRowsCount -1){
			nextRow = this.getDisplayRows()[index+1];
		}
		
		if(nextRow && (!(nextRow instanceof Row) || nextRow.type != "row")){
			return this.nextDisplayRow(nextRow, rowOnly);
		}
		
		return nextRow;
	}
	
	prevDisplayRow(row, rowOnly){
		var index = this.getDisplayRowIndex(row),
		prevRow = false;
		
		if(index){
			prevRow = this.getDisplayRows()[index-1];
		}
		
		if(rowOnly && prevRow && (!(prevRow instanceof Row) || prevRow.type != "row")){
			return this.prevDisplayRow(prevRow, rowOnly);
		}
		
		return prevRow;
	}
	
	findRowIndex(row, list){
		var rowIndex;
		
		row = this.findRow(row);
		
		if(row){
			rowIndex = list.indexOf(row);
			
			if(rowIndex > -1){
				return rowIndex;
			}
		}
		
		return false;
	}
	
	getData(active, transform){
		var output = [],
		rows = this.getRows(active);
		
		rows.forEach(function(row){
			if(row.type == "row"){
				output.push(row.getData(transform || "data"));
			}
		});
		
		return output;
	}
	
	getComponents(active){
		var	output = [],
		rows = this.getRows(active);
		
		rows.forEach(function(row){
			output.push(row.getComponent());
		});
		
		return output;
	}
	
	getDataCount(active){
		var rows = this.getRows(active);
		
		return rows.length;
	}
	
	scrollHorizontal(left){
		this.scrollLeft = left;
		this.element.scrollLeft = left;
		
		this.dispatch("scroll-horizontal", left);
	}
	
	registerDataPipelineHandler(handler, priority){
		if(typeof priority !== "undefined"){
			this.dataPipeline.push({handler, priority});
			this.dataPipeline.sort((a, b) => {
				return a.priority - b.priority;
			});
		}else {
			console.error("Data pipeline handlers must have a priority in order to be registered");
		}
	}
	
	registerDisplayPipelineHandler(handler, priority){
		if(typeof priority !== "undefined"){
			this.displayPipeline.push({handler, priority});
			this.displayPipeline.sort((a, b) => {
				return a.priority - b.priority;
			});
		}else {
			console.error("Display pipeline handlers must have a priority in order to be registered");
		}
	}
	
	//set active data set
	refreshActiveData(handler, skipStage, renderInPosition){
		var table = this.table,
		stage = "",
		index = 0,
		cascadeOrder = ["all", "dataPipeline", "display", "displayPipeline", "end"];
		
		if(!this.table.destroyed){
			if(typeof handler === "function"){
				index = this.dataPipeline.findIndex((item) => {
					return item.handler === handler;
				});
				
				if(index > -1){
					stage = "dataPipeline";
					
					if(skipStage){
						if(index == this.dataPipeline.length - 1){
							stage = "display";
						}else {
							index++;
						}
					}
				}else {
					index = this.displayPipeline.findIndex((item) => {
						return item.handler === handler;
					});
					
					if(index > -1){
						stage = "displayPipeline";
						
						if(skipStage){
							if(index == this.displayPipeline.length - 1){
								stage = "end";
							}else {
								index++;
							}
						}
					}else {
						console.error("Unable to refresh data, invalid handler provided", handler);
						return;
					}
				}
			}else {
				stage = handler || "all";
				index = 0;
			}
			
			if(this.redrawBlock){
				if(!this.redrawBlockRestoreConfig || (this.redrawBlockRestoreConfig && ((this.redrawBlockRestoreConfig.stage === stage && index < this.redrawBlockRestoreConfig.index) || (cascadeOrder.indexOf(stage) < cascadeOrder.indexOf(this.redrawBlockRestoreConfig.stage))))){
					this.redrawBlockRestoreConfig = {
						handler: handler,
						skipStage: skipStage,
						renderInPosition: renderInPosition,
						stage:stage,
						index:index,
					};
				}
				
				return;
			}else {
				if(Helpers.elVisible(this.element)){
					if(renderInPosition){
						this.reRenderInPosition(this.refreshPipelines.bind(this, handler, stage, index, renderInPosition));
					}else {
						this.refreshPipelines(handler, stage, index, renderInPosition);
						
						if(!handler){
							this.table.columnManager.renderer.renderColumns();
						}
						
						this.renderTable();
						
						if(table.options.layoutColumnsOnNewData){
							this.table.columnManager.redraw(true);
						}
					}
				}else {
					this.refreshPipelines(handler, stage, index, renderInPosition);
				}
				
				this.dispatch("data-refreshed");
			}
		}
	}
	
	refreshPipelines(handler, stage, index, renderInPosition){
		this.dispatch("data-refreshing");
		
		if(!handler || !this.activeRowsPipeline[0]){
			this.activeRowsPipeline[0] = this.rows.slice(0);
		}
		
		//cascade through data refresh stages
		switch(stage){
			case "all":
			//handle case where all data needs refreshing
			
			case "dataPipeline":
				for(let i = index; i < this.dataPipeline.length; i++){
					let result = this.dataPipeline[i].handler(this.activeRowsPipeline[i].slice(0));
				
					this.activeRowsPipeline[i + 1] = result || this.activeRowsPipeline[i].slice(0);
				}
			
				this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);
			
			case "display":
				index = 0;
				this.resetDisplayRows();
			
			case "displayPipeline":
				for(let i = index; i < this.displayPipeline.length; i++){
					let result = this.displayPipeline[i].handler((i ? this.getDisplayRows(i - 1) : this.activeRows).slice(0), renderInPosition);
				
					this.setDisplayRows(result || this.getDisplayRows(i - 1).slice(0), i);
				}
			
			case "end":
			//case to handle scenario when trying to skip past end stage
				this.regenerateRowPositions();
		}
		
		if(this.getDisplayRows().length){
			this._clearPlaceholder();
		}
	}
	
	//regenerate row positions
	regenerateRowPositions(){
		var rows = this.getDisplayRows();
		var index = 1;
		
		rows.forEach((row) => {
			if (row.type === "row"){
				row.setPosition(index);
				index++;
			}
		});
	}
	
	setActiveRows(activeRows){
		this.activeRows = this.activeRows = Object.assign([], activeRows);
		this.activeRowsCount = this.activeRows.length;
	}
	
	//reset display rows array
	resetDisplayRows(){
		this.displayRows = [];
		
		this.displayRows.push(this.activeRows.slice(0));
		
		this.displayRowsCount = this.displayRows[0].length;
	}
	
	//set display row pipeline data
	setDisplayRows(displayRows, index){
		this.displayRows[index] = displayRows;
		
		if(index == this.displayRows.length -1){
			this.displayRowsCount = this.displayRows[this.displayRows.length -1].length;
		}
	}
	
	getDisplayRows(index){
		if(typeof index == "undefined"){
			return this.displayRows.length ? this.displayRows[this.displayRows.length -1] : [];
		}else {
			return this.displayRows[index] || [];
		}
	}
	
	getVisibleRows(chain, viewable){
		var rows =  Object.assign([], this.renderer.visibleRows(!viewable));
		
		if(chain){
			rows = this.chain("rows-visible", [viewable], rows, rows);
		}
		
		return rows;
	}
	
	//repeat action across display rows
	displayRowIterator(callback){
		this.activeRowsPipeline.forEach(callback);
		this.displayRows.forEach(callback);
		
		this.displayRowsCount = this.displayRows[this.displayRows.length -1].length;
	}
	
	//return only actual rows (not group headers etc)
	getRows(type){
		var rows = [];
		
		switch(type){
			case "active":
				rows = this.activeRows;
				break;
			
			case "display":
				rows = this.table.rowManager.getDisplayRows();
				break;
			
			case "visible":
				rows = this.getVisibleRows(false, true);
				break;
			
			default:
				rows = this.chain("rows-retrieve", type, null, this.rows) || this.rows;
		}
		
		return rows;
	}
	
	///////////////// Table Rendering /////////////////
	//trigger rerender of table in current position
	reRenderInPosition(callback){
		if(this.redrawBlock){
			if(callback){
				callback();
			}else {
				this.redrawBlockRenderInPosition = true;
			}
		}else {
			this.dispatchExternal("renderStarted");
			
			this.renderer.rerenderRows(callback);
			
			if(!this.fixedHeight){
				this.adjustTableSize();
			}
			
			this.scrollBarCheck();
			
			this.dispatchExternal("renderComplete");
		}
	}
	
	scrollBarCheck(){
		var scrollbarWidth = 0;
		
		//adjust for vertical scrollbar moving table when present
		if(this.element.scrollHeight > this.element.clientHeight){
			scrollbarWidth = this.element.offsetWidth - this.element.clientWidth;
		}
		
		if(scrollbarWidth !== this.scrollbarWidth){
			this.scrollbarWidth = scrollbarWidth;
			this.dispatch("scrollbar-vertical", scrollbarWidth);
		}
	}
	
	initializeRenderer(){
		var renderClass;
		
		var renderers = {
			"virtual": VirtualDomVertical,
			"basic": BasicVertical,
		};
		
		if(typeof this.table.options.renderVertical === "string"){
			renderClass = renderers[this.table.options.renderVertical];
		}else {
			renderClass = this.table.options.renderVertical;
		}
		
		if(renderClass){
			this.renderMode = this.table.options.renderVertical;
			
			this.renderer = new renderClass(this.table, this.element, this.tableElement);
			this.renderer.initialize();
			
			if((this.table.element.clientHeight || this.table.options.height) && !(this.table.options.minHeight && this.table.options.maxHeight)){
				this.fixedHeight = true;
			}else {
				this.fixedHeight = false;
			}
		}else {
			console.error("Unable to find matching renderer:", this.table.options.renderVertical);
		}
	}
	
	getRenderMode(){
		return this.renderMode;
	}
	
	renderTable(){
		this.dispatchExternal("renderStarted");
		
		this.element.scrollTop = 0;
		
		this._clearTable();
		
		if(this.displayRowsCount){
			this.renderer.renderRows();
			
			if(this.firstRender){
				this.firstRender = false;
				
				if(!this.fixedHeight){
					this.adjustTableSize();
				}
				
				this.layoutRefresh(true);
			}
		}else {
			this.renderEmptyScroll();
		}
		
		if(!this.fixedHeight){
			this.adjustTableSize();
		}
		
		this.dispatch("table-layout");
		
		if(!this.displayRowsCount){
			this._showPlaceholder();
		}
		
		this.scrollBarCheck();
		
		this.dispatchExternal("renderComplete");
	}
	
	//show scrollbars on empty table div
	renderEmptyScroll(){
		if(this.placeholder){
			this.tableElement.style.display = "none";
		}else {
			this.tableElement.style.minWidth = this.table.columnManager.getWidth() + "px";
			// this.tableElement.style.minHeight = "1px";
			// this.tableElement.style.visibility = "hidden";
		}
	}
	
	_clearTable(){	
		this._clearPlaceholder();
		
		this.scrollTop = 0;
		this.scrollLeft = 0;
		
		this.renderer.clearRows();
	}
	
	tableEmpty(){
		this.renderEmptyScroll();
		this._showPlaceholder();
	}

	checkPlaceholder(){
		if(this.displayRowsCount){
			this._clearPlaceholder();
		}else {
			this.tableEmpty();
		}
	}
	
	_showPlaceholder(){
		if(this.placeholder){
			if(this.placeholder && this.placeholder.parentNode){
				this.placeholder.parentNode.removeChild(this.placeholder);
			}
			
			this.initializePlaceholder();
			
			this.placeholder.setAttribute("tabulator-render-mode", this.renderMode);
			
			this.getElement().appendChild(this.placeholder);
			this._positionPlaceholder();

			this.adjustTableSize();
		}
	}
	
	_clearPlaceholder(){
		if(this.placeholder && this.placeholder.parentNode){
			this.placeholder.parentNode.removeChild(this.placeholder);
		}
		
		// clear empty table placeholder min
		this.tableElement.style.minWidth = "";
		this.tableElement.style.display = "";
	}
	
	_positionPlaceholder(){
		if(this.placeholder && this.placeholder.parentNode){
			this.placeholder.style.width = this.table.columnManager.getWidth() + "px";
			this.placeholderContents.style.width = this.table.rowManager.element.clientWidth + "px";
			this.placeholderContents.style.marginLeft = this.scrollLeft + "px";
		}
	}
	
	styleRow(row, index){
		var rowEl = row.getElement();
		
		if(index % 2){
			rowEl.classList.add("tabulator-row-even");
			rowEl.classList.remove("tabulator-row-odd");
		}else {
			rowEl.classList.add("tabulator-row-odd");
			rowEl.classList.remove("tabulator-row-even");
		}
	}
	
	//normalize height of active rows
	normalizeHeight(force){
		this.activeRows.forEach(function(row){
			row.normalizeHeight(force);
		});
	}
	
	//adjust the height of the table holder to fit in the Tabulator element
	adjustTableSize(){
		let initialHeight = this.element.clientHeight, minHeight;
		let resized = false;
		
		if(this.renderer.verticalFillMode === "fill"){
			let otherHeight =  Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height + (this.table.footerManager && this.table.footerManager.active && !this.table.footerManager.external ? this.table.footerManager.getElement().getBoundingClientRect().height : 0));
			
			if(this.fixedHeight){
				minHeight = isNaN(this.table.options.minHeight) ? this.table.options.minHeight : this.table.options.minHeight + "px";
				
				const height = "calc(100% - " + otherHeight + "px)";
				this.element.style.minHeight = minHeight || "calc(100% - " + otherHeight + "px)";
				this.element.style.height = height;
				this.element.style.maxHeight = height;
			} else {
				this.element.style.height = "";
				this.element.style.height =
				this.table.element.clientHeight - otherHeight + "px";
				this.element.scrollTop = this.scrollTop;
			}
			
			this.renderer.resize();
			
			//check if the table has changed size when dealing with variable height tables
			if(!this.fixedHeight && initialHeight != this.element.clientHeight){
				resized = true;
				if(this.subscribed("table-resize")){
					this.dispatch("table-resize");
				}else {
					this.redraw();
				}
			}
			
			this.scrollBarCheck();
		}
		
		this._positionPlaceholder();
		return resized;
	}
	
	//reinitialize all rows
	reinitialize(){
		this.rows.forEach(function(row){
			row.reinitialize(true);
		});
	}
	
	//prevent table from being redrawn
	blockRedraw (){
		this.redrawBlock = true;
		this.redrawBlockRestoreConfig = false;
	}
	
	//restore table redrawing
	restoreRedraw (){
		this.redrawBlock = false;
		
		if(this.redrawBlockRestoreConfig){
			this.refreshActiveData(this.redrawBlockRestoreConfig.handler, this.redrawBlockRestoreConfig.skipStage, this.redrawBlockRestoreConfig.renderInPosition);
			
			this.redrawBlockRestoreConfig = false;
		}else {
			if(this.redrawBlockRenderInPosition){
				this.reRenderInPosition();
			}
		}
		
		this.redrawBlockRenderInPosition = false;
	}
	
	//redraw table
	redraw (force){
		this.adjustTableSize();
		this.table.tableWidth = this.table.element.clientWidth;
		
		if(!force){	
			this.reRenderInPosition();
			this.scrollHorizontal(this.scrollLeft);
		}else {
			this.renderTable();
		}
	}
	
	resetScroll(){
		this.element.scrollLeft = 0;
		this.element.scrollTop = 0;
		
		if(this.table.browser === "ie"){
			var event = document.createEvent("Event");
			event.initEvent("scroll", false, true);
			this.element.dispatchEvent(event);
		}else {
			this.element.dispatchEvent(new Event('scroll'));
		}
	}
}

class FooterManager extends CoreFeature{

	constructor(table){
		super(table);

		this.active = false;
		this.element = this.createElement(); //containing element
		this.containerElement = this.createContainerElement(); //containing element
		this.external = false;
	}

	initialize(){
		this.initializeElement();
	}

	createElement(){
		var el = document.createElement("div");

		el.classList.add("tabulator-footer");

		return el;
	}

	
	createContainerElement(){
		var el = document.createElement("div");

		el.classList.add("tabulator-footer-contents");

		this.element.appendChild(el);

		return el;
	}

	initializeElement(){
		if(this.table.options.footerElement){

			switch(typeof this.table.options.footerElement){
				case "string":
					if(this.table.options.footerElement[0] === "<"){
						this.containerElement.innerHTML = this.table.options.footerElement;
					}else {
						this.external = true;
						this.containerElement = document.querySelector(this.table.options.footerElement);
					}
					break;

				default:
					this.element = this.table.options.footerElement;
					break;
			}
		}
	}

	getElement(){
		return this.element;
	}

	append(element){
		this.activate();

		this.containerElement.appendChild(element);
		this.table.rowManager.adjustTableSize();
	}

	prepend(element){
		this.activate();

		this.element.insertBefore(element, this.element.firstChild);
		this.table.rowManager.adjustTableSize();
	}

	remove(element){
		element.parentNode.removeChild(element);
		this.deactivate();
	}

	deactivate(force){
		if(!this.element.firstChild || force){
			if(!this.external){
				this.element.parentNode.removeChild(this.element);
			}
			this.active = false;
		}
	}

	activate(){
		if(!this.active){
			this.active = true;
			if(!this.external){
				this.table.element.appendChild(this.getElement());
				this.table.element.style.display = '';
			}
		}
	}

	redraw(){
		this.dispatch("footer-redraw");
	}
}

class InteractionManager extends CoreFeature {
	
	constructor (table){
		super(table);
		
		this.el = null;
		
		this.abortClasses = ["tabulator-headers", "tabulator-table"];
		
		this.previousTargets = {};
		
		this.listeners = [
			"click",
			"dblclick",
			"contextmenu",
			"mouseenter",
			"mouseleave",
			"mouseover",
			"mouseout",
			"mousemove",
			"mouseup",
			"mousedown",
			"touchstart",
			"touchend",
		];
		
		this.componentMap = {
			"tabulator-cell":"cell",
			"tabulator-row":"row",
			"tabulator-group":"group",
			"tabulator-col":"column",
		};
		
		this.pseudoTrackers = {
			"row":{
				subscriber:null,
				target:null,
			},
			"cell":{
				subscriber:null,
				target:null,
			},
			"group":{
				subscriber:null,
				target:null,
			},
			"column":{
				subscriber:null,
				target:null,
			},
		};
		
		this.pseudoTracking = false;
	}
	
	initialize(){
		this.el = this.table.element;
		
		this.buildListenerMap();
		this.bindSubscriptionWatchers();
	}
	
	buildListenerMap(){
		var listenerMap = {};
		
		this.listeners.forEach((listener) => {
			listenerMap[listener] = {
				handler:null,
				components:[],
			};
		});
		
		this.listeners = listenerMap;
	}
	
	bindPseudoEvents(){
		Object.keys(this.pseudoTrackers).forEach((key) => {
			this.pseudoTrackers[key].subscriber = this.pseudoMouseEnter.bind(this, key);
			this.subscribe(key + "-mouseover", this.pseudoTrackers[key].subscriber);
		});
		
		this.pseudoTracking = true;
	}
	
	pseudoMouseEnter(key, e, target){
		if(this.pseudoTrackers[key].target !== target){
			
			if(this.pseudoTrackers[key].target){
				this.dispatch(key + "-mouseleave", e, this.pseudoTrackers[key].target);
			}
			
			this.pseudoMouseLeave(key, e);
			
			this.pseudoTrackers[key].target = target;
			
			this.dispatch(key + "-mouseenter", e, target);
		}
	}
	
	pseudoMouseLeave(key, e){
		var leaveList = Object.keys(this.pseudoTrackers),
		linkedKeys = {
			"row":["cell"],
			"cell":["row"],
		};
		
		leaveList = leaveList.filter((item) => {
			var links = linkedKeys[key];
			return item !== key && (!links || (links && !links.includes(item)));
		});
		
		
		leaveList.forEach((key) => {
			var target = this.pseudoTrackers[key].target;
			
			if(this.pseudoTrackers[key].target){
				this.dispatch(key + "-mouseleave", e, target);
				
				this.pseudoTrackers[key].target = null;
			}
		});
	}
	
	
	bindSubscriptionWatchers(){
		var listeners = Object.keys(this.listeners),
		components = Object.values(this.componentMap);
		
		for(let comp of components){
			for(let listener of listeners){
				let key = comp + "-" + listener;
				
				this.subscriptionChange(key, this.subscriptionChanged.bind(this, comp, listener));
			}
		}
		
		this.subscribe("table-destroy", this.clearWatchers.bind(this));
	}
	
	subscriptionChanged(component, key, added){
		var listener = this.listeners[key].components,
		index = listener.indexOf(component),
		changed = false;
		
		if(added){
			if(index === -1){
				listener.push(component);
				changed = true;
			}
		}else {
			if(!this.subscribed(component + "-" + key)){
				if(index > -1){
					listener.splice(index, 1);
					changed = true;
				}
			}
		}
		
		if((key === "mouseenter" || key === "mouseleave") && !this.pseudoTracking){
			this.bindPseudoEvents();
		}
		
		if(changed){
			this.updateEventListeners();
		}
	}
	
	updateEventListeners(){
		for(let key in this.listeners){
			let listener = this.listeners[key];
			
			if(listener.components.length){
				if(!listener.handler){
					listener.handler = this.track.bind(this, key);
					this.el.addEventListener(key, listener.handler);
					// this.el.addEventListener(key, listener.handler, {passive: true})
				}
			}else {
				if(listener.handler){
					this.el.removeEventListener(key, listener.handler);
					listener.handler = null;
				}
			}
		}
	}
	
	track(type, e){
		var path = (e.composedPath && e.composedPath()) || e.path;
		
		var targets = this.findTargets(path);
		targets = this.bindComponents(type, targets);
		
		this.triggerEvents(type, e, targets);
		
		if(this.pseudoTracking && (type == "mouseover" || type == "mouseleave") && !Object.keys(targets).length){
			this.pseudoMouseLeave("none", e);
		}
	}
	
	findTargets(path){
		var targets = {};
		
		let componentMap = Object.keys(this.componentMap);
		
		for (let el of path) {
			let classList = el.classList ? [...el.classList] : [];
			
			let abort = classList.filter((item) => {
				return this.abortClasses.includes(item);
			});
			
			if(abort.length){
				break;
			}
			
			let elTargets = classList.filter((item) => {
				return componentMap.includes(item);
			});
			
			for (let target of elTargets) {
				if(!targets[this.componentMap[target]]){
					targets[this.componentMap[target]] = el;
				}
			}
		}

		if(targets.group && targets.group === targets.row){
			delete targets.row;
		}

		return targets;
	}
	
	bindComponents(type, targets){
		//ensure row component is looked up before cell
		var keys = Object.keys(targets).reverse(),
		listener = this.listeners[type],
		matches = {},
		output = {},
		targetMatches = {};
	
		for(let key of keys){
			let component,
			target = targets[key],
			previousTarget = this.previousTargets[key];
			
			if(previousTarget && previousTarget.target === target){
				component = previousTarget.component;
			}else {
				switch(key){
					case "row":
					case "group":
						if(listener.components.includes("row") || listener.components.includes("cell") || listener.components.includes("group")){
							let rows = this.table.rowManager.getVisibleRows(true);
						
							component = rows.find((row) => {
								return row.getElement() === target;
							});
						
							if(targets["row"] && targets["row"].parentNode && targets["row"].parentNode.closest(".tabulator-row")){
								targets[key] = false;
							}
						}
						break;
					
					case "column":
						if(listener.components.includes("column")){
							component = this.table.columnManager.findColumn(target);
						}
						break;
					
					case "cell":
						if(listener.components.includes("cell")){
							if(matches["row"] instanceof Row){
								component = matches["row"].findCell(target);
							}else {	
								if(targets["row"]){
									console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?");
								}
							}
						}
						break;
				}
			}
			
			if(component){
				matches[key] = component;
				targetMatches[key] = {
					target:target,
					component:component,
				};
			}
		}
		
		this.previousTargets = targetMatches;

		//reverse order keys are set in so events trigger in correct sequence
		Object.keys(targets).forEach((key) => {
			let value = matches[key];
			output[key] = value;
		});
		
		return output;
	}
	
	triggerEvents(type, e, targets){
		var listener = this.listeners[type];

		for(let key in targets){
			if(targets[key] && listener.components.includes(key)){
				this.dispatch(key + "-" + type, e, targets[key]);
			}
		}
	}
	
	clearWatchers(){
		for(let key in this.listeners){
			let listener = this.listeners[key];
			
			if(listener.handler){
				this.el.removeEventListener(key, listener.handler);
				listener.handler = null;
			}
		}
	}
}

class ComponentFunctionBinder{

	constructor(table){
		this.table = table;

		this.bindings = {};
	}

	bind(type, funcName, handler){
		if(!this.bindings[type]){
			this.bindings[type] = {};
		}

		if(this.bindings[type][funcName]){
			console.warn("Unable to bind component handler, a matching function name is already bound", type, funcName, handler);
		}else {
			this.bindings[type][funcName] = handler;
		}
	}

	handle(type, component, name){
		if(this.bindings[type] && this.bindings[type][name] && typeof this.bindings[type][name].bind === 'function'){
			return this.bindings[type][name].bind(null, component);
		}else {
			if(name !== "then" && typeof name === "string" && !name.startsWith("_")){
				if(this.table.options.debugInvalidComponentFuncs){
					console.error("The " + type + " component does not have a " + name + " function, have you checked that you have the correct Tabulator module installed?");
				}
			}
		}
	}
}

class DataLoader extends CoreFeature{
	constructor(table){
		super(table);
		
		this.requestOrder = 0; //prevent requests coming out of sequence if overridden by another load request
		this.loading = false;
	}
	
	initialize(){}
	
	load(data, params, config, replace, silent, columnsChanged){
		var requestNo = ++this.requestOrder;

		if(this.table.destroyed){
			return Promise.resolve();
		}
		
		this.dispatchExternal("dataLoading", data);
		
		//parse json data to array
		if (data && (data.indexOf("{") == 0 || data.indexOf("[") == 0)){
			data = JSON.parse(data);
		}
		
		if(this.confirm("data-loading", [data, params, config, silent])){
			this.loading = true;
			
			if(!silent){
				this.alertLoader();
			}
			
			//get params for request
			params = this.chain("data-params", [data, config, silent], params || {}, params || {});
			
			params = this.mapParams(params, this.table.options.dataSendParams);
			
			var result = this.chain("data-load", [data, params, config, silent], false, Promise.resolve([]));
			
			return result.then((response) => {
				if(!this.table.destroyed){
					if(!Array.isArray(response) && typeof response == "object"){
						response = this.mapParams(response, this.objectInvert(this.table.options.dataReceiveParams));
					}
					
					var rowData = this.chain("data-loaded", [response], null, response);
					
					if(requestNo == this.requestOrder){
						this.clearAlert();
						
						if(rowData !== false){
							this.dispatchExternal("dataLoaded", rowData);
							this.table.rowManager.setData(rowData,  replace, typeof columnsChanged === "undefined" ? !replace : columnsChanged);
						}
					}else {
						console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made");
					}
				}else {
					console.warn("Data Load Response Blocked - Table has been destroyed");
				}
			}).catch((error) => {
				console.error("Data Load Error: ", error);
				this.dispatchExternal("dataLoadError", error);
				
				if(!silent){
					this.alertError();
				}
				
				setTimeout(() => {
					this.clearAlert();
				}, this.table.options.dataLoaderErrorTimeout);
			})
				.finally(() => {
					this.loading = false;
				});
		}else {
			this.dispatchExternal("dataLoaded", data);
			
			if(!data){
				data = [];
			}
			
			this.table.rowManager.setData(data, replace, typeof columnsChanged === "undefined" ? !replace : columnsChanged);
			return Promise.resolve();
		}
	}
	
	mapParams(params, map){
		var output = {};
		
		for(let key in params){
			output[map.hasOwnProperty(key) ? map[key] : key] = params[key];
		}
		
		return output;
	}
	
	objectInvert(obj){
		var output = {};
		
		for(let key in obj){
			output[obj[key]] = key;
		}
		
		return output;
	}
	
	blockActiveLoad(){
		this.requestOrder++;
	}
	
	alertLoader(){
		var shouldLoad = typeof this.table.options.dataLoader === "function" ? this.table.options.dataLoader() : this.table.options.dataLoader;
		
		if(shouldLoad){
			this.table.alertManager.alert(this.table.options.dataLoaderLoading || this.langText("data|loading"));
		}
	}
	
	alertError(){
		this.table.alertManager.alert(this.table.options.dataLoaderError || this.langText("data|error"), "error");
	}
	
	clearAlert(){
		this.table.alertManager.clear();
	}
}

class ExternalEventBus {

	constructor(table, optionsList, debug){
		this.table = table;
		this.events = {};
		this.optionsList = optionsList || {};
		this.subscriptionNotifiers = {};

		this.dispatch = debug ? this._debugDispatch.bind(this) : this._dispatch.bind(this);
		this.debug = debug;
	}

	subscriptionChange(key, callback){
		if(!this.subscriptionNotifiers[key]){
			this.subscriptionNotifiers[key] = [];
		}

		this.subscriptionNotifiers[key].push(callback);

		if(this.subscribed(key)){
			this._notifySubscriptionChange(key, true);
		}
	}

	subscribe(key, callback){
		if(!this.events[key]){
			this.events[key] = [];
		}

		this.events[key].push(callback);

		this._notifySubscriptionChange(key, true);
	}

	unsubscribe(key, callback){
		var index;

		if(this.events[key]){
			if(callback){
				index = this.events[key].findIndex((item) => {
					return item === callback;
				});

				if(index > -1){
					this.events[key].splice(index, 1);
				}else {
					console.warn("Cannot remove event, no matching event found:", key, callback);
					return;
				}
			}else {
				delete this.events[key];
			}
		}else {
			console.warn("Cannot remove event, no events set on:", key);
			return;
		}

		this._notifySubscriptionChange(key, false);
	}

	subscribed(key){
		return this.events[key] && this.events[key].length;
	}

	_notifySubscriptionChange(key, subscribed){
		var notifiers = this.subscriptionNotifiers[key];

		if(notifiers){
			notifiers.forEach((callback)=>{
				callback(subscribed);
			});
		}
	}

	_dispatch(){
		var args = Array.from(arguments),
		key = args.shift(),
		result;

		if(this.events[key]){
			this.events[key].forEach((callback, i) => {
				let callResult = callback.apply(this.table, args);

				if(!i){
					result = callResult;
				}
			});
		}

		return result;
	}

	_debugDispatch(){
		var args = Array.from(arguments),
		key = args[0];

		args[0] = "ExternalEvent:" + args[0];

		if(this.debug === true || this.debug.includes(key)){
			console.log(...args);
		}

		return this._dispatch(...arguments);
	}
}

class InternalEventBus {

	constructor(debug){
		this.events = {};
		this.subscriptionNotifiers = {};

		this.dispatch = debug ? this._debugDispatch.bind(this) : this._dispatch.bind(this);
		this.chain = debug ? this._debugChain.bind(this) : this._chain.bind(this);
		this.confirm = debug ? this._debugConfirm.bind(this) : this._confirm.bind(this);
		this.debug = debug;
	}

	subscriptionChange(key, callback){
		if(!this.subscriptionNotifiers[key]){
			this.subscriptionNotifiers[key] = [];
		}

		this.subscriptionNotifiers[key].push(callback);

		if(this.subscribed(key)){
			this._notifySubscriptionChange(key, true);
		}
	}

	subscribe(key, callback, priority = 10000){
		if(!this.events[key]){
			this.events[key] = [];
		}

		this.events[key].push({callback, priority});

		this.events[key].sort((a, b) => {
			return a.priority - b.priority;
		});

		this._notifySubscriptionChange(key, true);
	}

	unsubscribe(key, callback){
		var index;

		if(this.events[key]){
			if(callback){
				index = this.events[key].findIndex((item) => {
					return item.callback === callback;
				});

				if(index > -1){
					this.events[key].splice(index, 1);
				}else {
					console.warn("Cannot remove event, no matching event found:", key, callback);
					return;
				}
			}
		}else {
			console.warn("Cannot remove event, no events set on:", key);
			return;
		}

		this._notifySubscriptionChange(key, false);
	}

	subscribed(key){
		return this.events[key] && this.events[key].length;
	}

	_chain(key, args, initialValue, fallback){
		var value = initialValue;

		if(!Array.isArray(args)){
			args = [args];
		}

		if(this.subscribed(key)){
			this.events[key].forEach((subscriber, i) => {
				value = subscriber.callback.apply(this, args.concat([value]));
			});

			return value;
		}else {
			return typeof fallback === "function" ? fallback() : fallback;
		}
	}

	_confirm(key, args){
		var confirmed = false;

		if(!Array.isArray(args)){
			args = [args];
		}

		if(this.subscribed(key)){
			this.events[key].forEach((subscriber, i) => {
				if(subscriber.callback.apply(this, args)){
					confirmed = true;
				}
			});
		}

		return confirmed;
	}

	_notifySubscriptionChange(key, subscribed){
		var notifiers = this.subscriptionNotifiers[key];

		if(notifiers){
			notifiers.forEach((callback)=>{
				callback(subscribed);
			});
		}
	}

	_dispatch(){
		var args = Array.from(arguments),
		key = args.shift();

		if(this.events[key]){
			this.events[key].forEach((subscriber) => {
				subscriber.callback.apply(this, args);
			});
		}
	}

	_debugDispatch(){
		var args = Array.from(arguments),
		key = args[0];

		args[0] = "InternalEvent:" + key;

		if(this.debug === true || this.debug.includes(key)){
			console.log(...args);
		}

		return this._dispatch(...arguments);
	}

	_debugChain(){
		var args = Array.from(arguments),
		key = args[0];

		args[0] = "InternalEvent:" + key;

		if(this.debug === true || this.debug.includes(key)){
			console.log(...args);
		}

		return this._chain(...arguments);
	}

	_debugConfirm(){
		var args = Array.from(arguments),
		key = args[0];

		args[0] = "InternalEvent:" + key;

		if(this.debug === true || this.debug.includes(key)){
			console.log(...args);
		}

		return this._confirm(...arguments);
	}
}

class DeprecationAdvisor extends CoreFeature{
	
	constructor(table){
		super(table);
	}
	
	_warnUser(){
		if(this.options("debugDeprecation")){
			console.warn(...arguments);
		}
	}
	
	check(oldOption, newOption, convert){
		var msg = "";
		
		if(typeof this.options(oldOption) !== "undefined"){
			msg = "Deprecated Setup Option - Use of the %c" + oldOption + "%c option is now deprecated";
			
			if(newOption){
				msg = msg + ", Please use the %c" + newOption + "%c option instead";
				this._warnUser(msg, 'font-weight: bold;', 'font-weight: normal;', 'font-weight: bold;', 'font-weight: normal;');

				if(convert){
					this.table.options[newOption] = this.table.options[oldOption];
				}
			}else {
				this._warnUser(msg, 'font-weight: bold;', 'font-weight: normal;');
			}
			
			return false;
		}else {
			return true;
		}
	}
	
	checkMsg(oldOption, msg){
		if(typeof this.options(oldOption) !== "undefined"){
			this._warnUser("%cDeprecated Setup Option - Use of the %c" + oldOption + " %c option is now deprecated, " + msg, 'font-weight: normal;', 'font-weight: bold;', 'font-weight: normal;');
			
			return false;
		}else {
			return true;
		}
	}
	
	msg(msg){
		this._warnUser(msg);
	}
}

class DependencyRegistry extends CoreFeature{
	
	constructor(table){
		super(table);
		
		this.deps = {};
		
		this.props = {
			
		};
	}
	
	initialize(){
		this.deps = Object.assign({}, this.options("dependencies"));
	}
	
	lookup(key, prop, silent){
		if(Array.isArray(key)){
			for (const item of key) {
				var match = this.lookup(item, prop, true);

				if(match){
					break;
				}
			}

			if(match){
				return match;
			}else {
				this.error(key);
			}
		}else {
			if(prop){
				return this.lookupProp(key, prop, silent);
			}else {
				return this.lookupKey(key, silent);
			}
		}
	}
	
	lookupProp(key, prop, silent){
		var dependency;
		
		if(this.props[key] && this.props[key][prop]){
			return this.props[key][prop];
		}else {
			dependency = this.lookupKey(key, silent);
			
			if(dependency){
				if(!this.props[key]){
					this.props[key] = {};
				}
				
				this.props[key][prop] = dependency[prop] || dependency;
				return this.props[key][prop];
			}
		}
	}
	
	lookupKey(key, silent){
		var dependency;
		
		if(this.deps[key]){
			dependency = this.deps[key];
		}else if(window[key]){
			this.deps[key] = window[key];
			dependency = this.deps[key];
		}else {
			if(!silent){
				this.error(key);
			}
		}
		
		return dependency;
	}

	error(key){
		console.error("Unable to find dependency", key, "Please check documentation and ensure you have imported the required library into your project");
	}
}

//resize columns to fit data they contain
function fitData(columns, forced){
	if(forced){
		this.table.columnManager.renderer.reinitializeColumnWidths(columns);
	}
	
	if(this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)){
		this.table.modules.responsiveLayout.update();
	}
}

//resize columns to fit data they contain and stretch row to fill table, also used for fitDataTable
function fitDataGeneral(columns, forced){
	columns.forEach(function(column){
		column.reinitializeWidth();
	});

	if(this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)){
		this.table.modules.responsiveLayout.update();
	}
}

//resize columns to fit data the contain and stretch last column to fill table
function fitDataStretch(columns, forced){
	var colsWidth = 0,
	tableWidth = this.table.rowManager.element.clientWidth,
	gap = 0,
	lastCol = false;

	columns.forEach((column, i) => {
		if(!column.widthFixed){
			column.reinitializeWidth();
		}

		if(this.table.options.responsiveLayout ? column.modules.responsive.visible : column.visible){
			lastCol = column;
		}

		if(column.visible){
			colsWidth += column.getWidth();
		}
	});

	if(lastCol){
		gap = tableWidth - colsWidth + lastCol.getWidth();

		if(this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)){
			lastCol.setWidth(0);
			this.table.modules.responsiveLayout.update();
		}

		if(gap > 0){
			lastCol.setWidth(gap);
		}else {
			lastCol.reinitializeWidth();
		}
	}else {
		if(this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)){
			this.table.modules.responsiveLayout.update();
		}
	}
}

//resize columns to fit
function fitColumns(columns, forced){
	var totalWidth = this.table.rowManager.element.getBoundingClientRect().width; //table element width
	var fixedWidth = 0; //total width of columns with a defined width
	var flexWidth = 0; //total width available to flexible columns
	var flexGrowUnits = 0; //total number of widthGrow blocks across all columns
	var flexColWidth = 0; //desired width of flexible columns
	var flexColumns = []; //array of flexible width columns
	var fixedShrinkColumns = []; //array of fixed width columns that can shrink
	var flexShrinkUnits = 0; //total number of widthShrink blocks across all columns
	var overflowWidth = 0; //horizontal overflow width
	var gapFill = 0; //number of pixels to be added to final column to close and half pixel gaps

	function calcWidth(width){
		var colWidth;

		if(typeof(width) == "string"){
			if(width.indexOf("%") > -1){
				colWidth = (totalWidth / 100) * parseInt(width);
			}else {
				colWidth = parseInt(width);
			}
		}else {
			colWidth = width;
		}

		return colWidth;
	}

	//ensure columns resize to take up the correct amount of space
	function scaleColumns(columns, freeSpace, colWidth, shrinkCols){
		var oversizeCols = [],
		oversizeSpace = 0,
		remainingSpace = 0,
		nextColWidth = 0,
		remainingFlexGrowUnits = flexGrowUnits,
		gap = 0,
		changeUnits = 0,
		undersizeCols = [];

		function calcGrow(col){
			return (colWidth * (col.column.definition.widthGrow || 1));
		}

		function calcShrink(col){
			return  (calcWidth(col.width) - (colWidth * (col.column.definition.widthShrink || 0)));
		}

		columns.forEach(function(col, i){
			var width = shrinkCols ? calcShrink(col) : calcGrow(col);
			if(col.column.minWidth >= width){
				oversizeCols.push(col);
			}else {
				if(col.column.maxWidth && col.column.maxWidth < width){
					col.width = col.column.maxWidth;
					freeSpace -= col.column.maxWidth;

					remainingFlexGrowUnits -= shrinkCols ? (col.column.definition.widthShrink || 1) : (col.column.definition.widthGrow || 1);

					if(remainingFlexGrowUnits){
						colWidth = Math.floor(freeSpace/remainingFlexGrowUnits);
					}
				}else {
					undersizeCols.push(col);
					changeUnits += shrinkCols ? (col.column.definition.widthShrink || 1) : (col.column.definition.widthGrow || 1);
				}
			}
		});

		if(oversizeCols.length){
			oversizeCols.forEach(function(col){
				oversizeSpace += shrinkCols ?  col.width - col.column.minWidth : col.column.minWidth;
				col.width = col.column.minWidth;
			});

			remainingSpace = freeSpace - oversizeSpace;

			nextColWidth = changeUnits ? Math.floor(remainingSpace/changeUnits) : remainingSpace;

			gap = scaleColumns(undersizeCols, remainingSpace, nextColWidth, shrinkCols);
		}else {
			gap = changeUnits ? freeSpace - (Math.floor(freeSpace/changeUnits) * changeUnits) : freeSpace;

			undersizeCols.forEach(function(column){
				column.width = shrinkCols ? calcShrink(column) : calcGrow(column);
			});
		}

		return gap;
	}

	if(this.table.options.responsiveLayout && this.table.modExists("responsiveLayout", true)){
		this.table.modules.responsiveLayout.update();
	}

	//adjust for vertical scrollbar if present
	if(this.table.rowManager.element.scrollHeight > this.table.rowManager.element.clientHeight){
		totalWidth -= this.table.rowManager.element.offsetWidth - this.table.rowManager.element.clientWidth;
	}

	columns.forEach(function(column){
		var width, minWidth, colWidth;

		if(column.visible){

			width = column.definition.width;
			minWidth =  parseInt(column.minWidth);

			if(width){

				colWidth = calcWidth(width);

				fixedWidth += colWidth > minWidth ? colWidth : minWidth;

				if(column.definition.widthShrink){
					fixedShrinkColumns.push({
						column:column,
						width:colWidth > minWidth ? colWidth : minWidth
					});
					flexShrinkUnits += column.definition.widthShrink;
				}

			}else {
				flexColumns.push({
					column:column,
					width:0,
				});
				flexGrowUnits += column.definition.widthGrow || 1;
			}
		}
	});

	//calculate available space
	flexWidth = totalWidth - fixedWidth;

	//calculate correct column size
	flexColWidth = Math.floor(flexWidth / flexGrowUnits);

	//generate column widths
	gapFill = scaleColumns(flexColumns, flexWidth, flexColWidth, false);

	//increase width of last column to account for rounding errors
	if(flexColumns.length && gapFill > 0){
		flexColumns[flexColumns.length-1].width += gapFill;
	}

	//calculate space for columns to be shrunk into
	flexColumns.forEach(function(col){
		flexWidth -= col.width;
	});

	overflowWidth = Math.abs(gapFill) + flexWidth;

	//shrink oversize columns if there is no available space
	if(overflowWidth > 0 && flexShrinkUnits){
		gapFill = scaleColumns(fixedShrinkColumns, overflowWidth, Math.floor(overflowWidth / flexShrinkUnits), true);
	}

	//decrease width of last column to account for rounding errors
	if(gapFill && fixedShrinkColumns.length){
		fixedShrinkColumns[fixedShrinkColumns.length-1].width -= gapFill;
	}

	flexColumns.forEach(function(col){
		col.column.setWidth(col.width);
	});

	fixedShrinkColumns.forEach(function(col){
		col.column.setWidth(col.width);
	});
}

var defaultModes = {
	fitData:fitData,
	fitDataFill:fitDataGeneral,
	fitDataTable:fitDataGeneral,
	fitDataStretch:fitDataStretch,
	fitColumns:fitColumns ,
};

class Layout extends Module{

	static moduleName = "layout";

	//load defaults
	static modes = defaultModes;

	constructor(table){
		super(table, "layout");

		this.mode = null;

		this.registerTableOption("layout", "fitData"); //layout type
		this.registerTableOption("layoutColumnsOnNewData", false); //update column widths on setData

		this.registerColumnOption("widthGrow");
		this.registerColumnOption("widthShrink");
	}

	//initialize layout system
	initialize(){
		var layout = this.table.options.layout;

		if(Layout.modes[layout]){
			this.mode = layout;
		}else {
			console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : " + layout);
			this.mode = 'fitData';
		}

		this.table.element.setAttribute("tabulator-layout", this.mode);
		this.subscribe("column-init", this.initializeColumn.bind(this));
	}

	initializeColumn(column){
		if(column.definition.widthGrow){
			column.definition.widthGrow = Number(column.definition.widthGrow);
		}
		if(column.definition.widthShrink){
			column.definition.widthShrink = Number(column.definition.widthShrink);
		}
	}

	getMode(){
		return this.mode;
	}

	//trigger table layout
	layout(dataChanged){

		var variableHeight = this.table.columnManager.columnsByIndex.find((column) => column.definition.variableHeight || column.definition.formatter === "textarea");
		
		this.dispatch("layout-refreshing");
		Layout.modes[this.mode].call(this, this.table.columnManager.columnsByIndex, dataChanged);

		if(variableHeight){
			this.table.rowManager.normalizeHeight(true);
		}

		this.dispatch("layout-refreshed");
	}
}

var defaultLangs = {
	"default":{ //hold default locale text
		"groups":{
			"item":"item",
			"items":"items",
		},
		"columns":{
		},
		"data":{
			"loading":"Loading",
			"error":"Error",
		},
		"pagination":{
			"page_size":"Page Size",
			"page_title":"Show Page",
			"first":"First",
			"first_title":"First Page",
			"last":"Last",
			"last_title":"Last Page",
			"prev":"Prev",
			"prev_title":"Prev Page",
			"next":"Next",
			"next_title":"Next Page",
			"all":"All",
			"counter":{
				"showing": "Showing",
				"of": "of",
				"rows": "rows",
				"pages": "pages",
			}
		},
		"headerFilters":{
			"default":"filter column...",
			"columns":{}
		}
	},
};

class Localize extends Module{

	static moduleName = "localize";

	//load defaults
	static langs = defaultLangs;

	constructor(table){
		super(table);

		this.locale = "default"; //current locale
		this.lang = false; //current language
		this.bindings = {}; //update events to call when locale is changed
		this.langList = {};

		this.registerTableOption("locale", false); //current system language
		this.registerTableOption("langs", {});
	}

	initialize(){
		this.langList = Helpers.deepClone(Localize.langs);

		if(this.table.options.columnDefaults.headerFilterPlaceholder !== false){
			this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);
		}

		for(let locale in this.table.options.langs){
			this.installLang(locale, this.table.options.langs[locale]);
		}

		this.setLocale(this.table.options.locale);

		this.registerTableFunction("setLocale", this.setLocale.bind(this));
		this.registerTableFunction("getLocale", this.getLocale.bind(this));
		this.registerTableFunction("getLang", this.getLang.bind(this));
	}

	//set header placeholder
	setHeaderFilterPlaceholder(placeholder){
		this.langList.default.headerFilters.default = placeholder;
	}

	//setup a lang description object
	installLang(locale, lang){
		if(this.langList[locale]){
			this._setLangProp(this.langList[locale], lang);
		}else {
			this.langList[locale] = lang;
		}
	}

	_setLangProp(lang, values){
		for(let key in values){
			if(lang[key] && typeof lang[key] == "object"){
				this._setLangProp(lang[key], values[key]);
			}else {
				lang[key] = values[key];
			}
		}
	}

	//set current locale
	setLocale(desiredLocale){
		desiredLocale = desiredLocale || "default";

		//fill in any matching language values
		function traverseLang(trans, path){
			for(var prop in trans){
				if(typeof trans[prop] == "object"){
					if(!path[prop]){
						path[prop] = {};
					}
					traverseLang(trans[prop], path[prop]);
				}else {
					path[prop] = trans[prop];
				}
			}
		}

		//determining correct locale to load
		if(desiredLocale === true && navigator.language){
			//get local from system
			desiredLocale = navigator.language.toLowerCase();
		}

		if(desiredLocale){
			//if locale is not set, check for matching top level locale else use default
			if(!this.langList[desiredLocale]){
				let prefix = desiredLocale.split("-")[0];

				if(this.langList[prefix]){
					console.warn("Localization Error - Exact matching locale not found, using closest match: ", desiredLocale, prefix);
					desiredLocale = prefix;
				}else {
					console.warn("Localization Error - Matching locale not found, using default: ", desiredLocale);
					desiredLocale = "default";
				}
			}
		}

		this.locale = desiredLocale;

		//load default lang template
		this.lang = Helpers.deepClone(this.langList.default || {});

		if(desiredLocale != "default"){
			traverseLang(this.langList[desiredLocale], this.lang);
		}

		this.dispatchExternal("localized", this.locale, this.lang);

		this._executeBindings();
	}

	//get current locale
	getLocale(locale){
		return this.locale;
	}

	//get lang object for given local or current if none provided
	getLang(locale){
		return locale ? this.langList[locale] : this.lang;
	}

	//get text for current locale
	getText(path, value){
		var fillPath = value ? path + "|" + value : path,
		pathArray = fillPath.split("|"),
		text = this._getLangElement(pathArray, this.locale);

		// if(text === false){
		// 	console.warn("Localization Error - Matching localized text not found for given path: ", path);
		// }

		return text || "";
	}

	//traverse langs object and find localized copy
	_getLangElement(path, locale){
		var root = this.lang;

		path.forEach(function(level){
			var rootPath;

			if(root){
				rootPath = root[level];

				if(typeof rootPath != "undefined"){
					root = rootPath;
				}else {
					root = false;
				}
			}
		});

		return root;
	}

	//set update binding
	bind(path, callback){
		if(!this.bindings[path]){
			this.bindings[path] = [];
		}

		this.bindings[path].push(callback);

		callback(this.getText(path), this.lang);
	}

	//iterate through bindings and trigger updates
	_executeBindings(){
		for(let path in this.bindings){
			this.bindings[path].forEach((binding) => {
				binding(this.getText(path), this.lang);
			});
		}
	}
}

class Comms extends Module{

	static moduleName = "comms";

	constructor(table){
		super(table);
	}

	initialize(){
		this.registerTableFunction("tableComms", this.receive.bind(this));
	}

	getConnections(selectors){
		var connections = [],
		connection;

		connection = this.table.constructor.registry.lookupTable(selectors);

		connection.forEach((con) =>{
			if(this.table !== con){
				connections.push(con);
			}
		});

		return connections;
	}

	send(selectors, module, action, data){
		var connections = this.getConnections(selectors);

		connections.forEach((connection) => {
			connection.tableComms(this.table.element, module, action, data);
		});

		if(!connections.length && selectors){
			console.warn("Table Connection Error - No tables matching selector found", selectors);
		}
	}

	receive(table, module, action, data){
		if(this.table.modExists(module)){
			return this.table.modules[module].commsReceived(table, action, data);
		}else {
			console.warn("Inter-table Comms Error - no such module:", module);
		}
	}
}

var coreModules = /*#__PURE__*/Object.freeze({
	__proto__: null,
	CommsModule: Comms,
	LayoutModule: Layout,
	LocalizeModule: Localize
});

class TableRegistry {
	static registry = {
		tables:[],
		
		register(table){
			TableRegistry.registry.tables.push(table);
		},
		
		deregister(table){
			var index = TableRegistry.registry.tables.indexOf(table);
			
			if(index > -1){
				TableRegistry.registry.tables.splice(index, 1);
			}
		},
		
		lookupTable(query, silent){
			var results = [],
			matches, match;
			
			if(typeof query === "string"){
				matches = document.querySelectorAll(query);
				
				if(matches.length){
					for(var i = 0; i < matches.length; i++){
						match = TableRegistry.registry.matchElement(matches[i]);
						
						if(match){
							results.push(match);
						}
					}
				}
				
			}else if((typeof HTMLElement !== "undefined" && query instanceof HTMLElement) || query instanceof TableRegistry){
				match = TableRegistry.registry.matchElement(query);
				
				if(match){
					results.push(match);
				}
			}else if(Array.isArray(query)){
				query.forEach(function(item){
					results = results.concat(TableRegistry.registry.lookupTable(item));
				});
			}else {
				if(!silent){
					console.warn("Table Connection Error - Invalid Selector", query);
				}
			}
			
			return results;
		},
		
		matchElement(element){
			return TableRegistry.registry.tables.find(function(table){
				return element instanceof TableRegistry ? table === element : table.element === element;
			});
		}
	};

		
	static findTable(query){
		var results = TableRegistry.registry.lookupTable(query, true);
		return Array.isArray(results) && !results.length ? false : results;
	}
}

class ModuleBinder extends TableRegistry {
	
	static moduleBindings = {};
	static moduleExtensions = {};
	static modulesRegistered = false;
	
	static defaultModules = false;
	
	constructor(){
		super();
	}
	
	static initializeModuleBinder(defaultModules){
		if(!ModuleBinder.modulesRegistered){
			ModuleBinder.modulesRegistered = true;
			ModuleBinder._registerModules(coreModules, true);
			
			if(defaultModules){
				ModuleBinder._registerModules(defaultModules);
			}
		}
	}
	
	static _extendModule(name, property, values){
		if(ModuleBinder.moduleBindings[name]){
			var source = ModuleBinder.moduleBindings[name][property];
			
			if(source){
				if(typeof values == "object"){
					for(let key in values){
						source[key] = values[key];
					}
				}else {
					console.warn("Module Error - Invalid value type, it must be an object");
				}
			}else {
				console.warn("Module Error - property does not exist:", property);
			}
		}else {
			console.warn("Module Error - module does not exist:", name);
		}
	}
	
	static _registerModules(modules, core){
		var mods = Object.values(modules);
		
		if(core){
			mods.forEach((mod) => {
				mod.prototype.moduleCore = true;
			});
		}
		
		ModuleBinder._registerModule(mods);
	}
	
	static _registerModule(modules){
		if(!Array.isArray(modules)){
			modules = [modules];
		}
		
		modules.forEach((mod) => {
			ModuleBinder._registerModuleBinding(mod);
			ModuleBinder._registerModuleExtensions(mod);
		});
	}
	
	static _registerModuleBinding(mod){
		if(mod.moduleName){
			ModuleBinder.moduleBindings[mod.moduleName] = mod;
		}else {
			console.error("Unable to bind module, no moduleName defined", mod.moduleName);
		}
	}
	
	static _registerModuleExtensions(mod){
		var extensions = mod.moduleExtensions;
		
		if(mod.moduleExtensions){
			for (let modKey in extensions) {
				let ext = extensions[modKey];
				
				if(ModuleBinder.moduleBindings[modKey]){
					for (let propKey in ext) {
						ModuleBinder._extendModule(modKey, propKey, ext[propKey]);
					}
				}else {
					if(!ModuleBinder.moduleExtensions[modKey]){
						ModuleBinder.moduleExtensions[modKey] = {};
					}
					
					for (let propKey in ext) {
						if(!ModuleBinder.moduleExtensions[modKey][propKey]){
							ModuleBinder.moduleExtensions[modKey][propKey] = {};
						}

						Object.assign(ModuleBinder.moduleExtensions[modKey][propKey], ext[propKey]);
					}
				}
			}
		}

		ModuleBinder._extendModuleFromQueue(mod);
	}
	
	static _extendModuleFromQueue(mod){
		var extensions = ModuleBinder.moduleExtensions[mod.moduleName];
		
		if(extensions){
			for (let propKey in extensions) {
				ModuleBinder._extendModule(mod.moduleName, propKey, extensions[propKey]);
			}
		}
	}
	
	//ensure that module are bound to instantiated function
	_bindModules(){
		var orderedStartMods = [],
		orderedEndMods = [],
		unOrderedMods = [];
		
		this.modules = {};
		
		for(var name in ModuleBinder.moduleBindings){
			let mod = ModuleBinder.moduleBindings[name];
			let module = new mod(this);
			
			this.modules[name] = module;
			
			if(mod.prototype.moduleCore){
				this.modulesCore.push(module);
			}else {
				if(mod.moduleInitOrder){
					if(mod.moduleInitOrder < 0){
						orderedStartMods.push(module);
					}else {
						orderedEndMods.push(module);
					}
					
				}else {
					unOrderedMods.push(module);
				}
			}
		}
		
		orderedStartMods.sort((a, b) => a.moduleInitOrder > b.moduleInitOrder ? 1 : -1);
		orderedEndMods.sort((a, b) => a.moduleInitOrder > b.moduleInitOrder ? 1 : -1);
		
		this.modulesRegular = orderedStartMods.concat(unOrderedMods.concat(orderedEndMods));
	}
}

class Alert extends CoreFeature{
	constructor(table){
		super(table);
        
		this.element = this._createAlertElement();
		this.msgElement = this._createMsgElement();
		this.type = null;
        
		this.element.appendChild(this.msgElement);
	}
    
	_createAlertElement(){
		var el = document.createElement("div");
		el.classList.add("tabulator-alert");
		return el;
	}
    
	_createMsgElement(){
		var el = document.createElement("div");
		el.classList.add("tabulator-alert-msg");
		el.setAttribute("role", "alert");
		return el;
	}
    
	_typeClass(){
		return "tabulator-alert-state-" + this.type;
	}
    
	alert(content, type = "msg"){
		if(content){
			this.clear();

			this.dispatch("alert-show", type);
            
			this.type = type;
            
			while(this.msgElement.firstChild) this.msgElement.removeChild(this.msgElement.firstChild);
            
			this.msgElement.classList.add(this._typeClass());
            
			if(typeof content === "function"){
				content = content();
			}
            
			if(content instanceof HTMLElement){
				this.msgElement.appendChild(content);
			}else {
				this.msgElement.innerHTML = content;
			}
            
			this.table.element.appendChild(this.element);
		}
	}
    
	clear(){
		this.dispatch("alert-hide", this.type);

		if(this.element.parentNode){
			this.element.parentNode.removeChild(this.element);
		}
        
		this.msgElement.classList.remove(this._typeClass());
	}
}

class Tabulator extends ModuleBinder{

	//default setup options
	static defaultOptions = defaultOptions;

	static extendModule(){
		Tabulator.initializeModuleBinder();
		Tabulator._extendModule(...arguments);
	}

	static registerModule(){
		Tabulator.initializeModuleBinder();
		Tabulator._registerModule(...arguments);
	}

	constructor(element, options, modules){
		super();

		Tabulator.initializeModuleBinder(modules);

		this.options = {};
		
		this.columnManager = null; // hold Column Manager
		this.rowManager = null; //hold Row Manager
		this.footerManager = null; //holder Footer Manager
		this.alertManager = null; //hold Alert Manager
		this.vdomHoz  = null; //holder horizontal virtual dom
		this.externalEvents = null; //handle external event messaging
		this.eventBus = null; //handle internal event messaging
		this.interactionMonitor = false; //track user interaction
		this.browser = ""; //hold current browser type
		this.browserSlow = false; //handle reduced functionality for slower browsers
		this.browserMobile = false; //check if running on mobile, prevent resize cancelling edit on keyboard appearance
		this.rtl = false; //check if the table is in RTL mode
		this.originalElement = null; //hold original table element if it has been replaced
		
		this.componentFunctionBinder = new ComponentFunctionBinder(this); //bind component functions
		this.dataLoader = false; //bind component functions
		
		this.modules = {}; //hold all modules bound to this table
		this.modulesCore = []; //hold core modules bound to this table (for initialization purposes)
		this.modulesRegular = []; //hold regular modules bound to this table (for initialization purposes)
		
		this.deprecationAdvisor = new DeprecationAdvisor(this);
		this.optionsList = new OptionsList(this, "table constructor");

		this.dependencyRegistry = new DependencyRegistry(this);
		
		this.initialized = false;
		this.destroyed = false;
		
		if(this.initializeElement(element)){
			
			this.initializeCoreSystems(options);
			
			//delay table creation to allow event bindings immediately after the constructor
			setTimeout(() => {
				this._create();
			});
		}
		
		this.constructor.registry.register(this); //register table for inter-device communication
	}
	
	initializeElement(element){
		if(typeof HTMLElement !== "undefined" && element instanceof HTMLElement){
			this.element = element;
			return true;
		}else if(typeof element === "string"){
			this.element = document.querySelector(element);
			
			if(this.element){
				return true;
			}else {
				console.error("Tabulator Creation Error - no element found matching selector: ", element);
				return false;
			}
		}else {
			console.error("Tabulator Creation Error - Invalid element provided:", element);
			return false;
		}
	}
	
	initializeCoreSystems(options){
		this.columnManager = new ColumnManager(this);
		this.rowManager = new RowManager(this);
		this.footerManager = new FooterManager(this);
		this.dataLoader = new DataLoader(this);
		this.alertManager = new Alert(this);
		
		this._bindModules();
		
		this.options = this.optionsList.generate(Tabulator.defaultOptions, options);
		
		this._clearObjectPointers();
		
		this._mapDeprecatedFunctionality();
		
		this.externalEvents = new ExternalEventBus(this, this.options, this.options.debugEventsExternal);
		this.eventBus = new InternalEventBus(this.options.debugEventsInternal);
		
		this.interactionMonitor = new InteractionManager(this);
		
		this.dataLoader.initialize();
		this.footerManager.initialize();

		this.dependencyRegistry.initialize();
	}
	
	//convert deprecated functionality to new functions
	_mapDeprecatedFunctionality(){
		//all previously deprecated functionality removed in the 6.0 release
	}
	
	_clearSelection(){
		
		this.element.classList.add("tabulator-block-select");
		
		if (window.getSelection) {
			if (window.getSelection().empty) {  // Chrome
				window.getSelection().empty();
			} else if (window.getSelection().removeAllRanges) {  // Firefox
				window.getSelection().removeAllRanges();
			}
		} else if (document.selection) {  // IE?
			document.selection.empty();
		}
		
		this.element.classList.remove("tabulator-block-select");
	}
	
	//create table
	_create(){
		this.externalEvents.dispatch("tableBuilding");
		this.eventBus.dispatch("table-building");
		
		this._rtlCheck();
		
		this._buildElement();
		
		this._initializeTable();

		this.initialized = true;
		
		this._loadInitialData()
			.finally(() => {
				this.eventBus.dispatch("table-initialized");
				this.externalEvents.dispatch("tableBuilt");
			});	
	}
	
	_rtlCheck(){
		var style = window.getComputedStyle(this.element);
		
		switch(this.options.textDirection){
			case"auto":
				if(style.direction !== "rtl"){
					break;
				}
			
			case "rtl":
				this.element.classList.add("tabulator-rtl");
				this.rtl = true;
				break;
			
			case "ltr":
				this.element.classList.add("tabulator-ltr");
			
			default:
				this.rtl = false;
		}
	}
	
	//clear pointers to objects in default config object
	_clearObjectPointers(){
		this.options.columns = this.options.columns.slice(0);
		
		if(Array.isArray(this.options.data) && !this.options.reactiveData){
			this.options.data = this.options.data.slice(0);
		}
	}
	
	//build tabulator element
	_buildElement(){
		var element = this.element,
		options = this.options,
		newElement;
		
		if(element.tagName === "TABLE"){
			this.originalElement = this.element;
			newElement = document.createElement("div");
			
			//transfer attributes to new element
			var attributes = element.attributes;
			
			// loop through attributes and apply them on div
			for(var i in attributes){
				if(typeof attributes[i] == "object"){
					newElement.setAttribute(attributes[i].name, attributes[i].value);
				}
			}
			
			// replace table with div element
			element.parentNode.replaceChild(newElement, element);
			
			this.element = element = newElement;
		}
		
		element.classList.add("tabulator");
		element.setAttribute("role", "grid");
		
		//empty element
		while(element.firstChild) element.removeChild(element.firstChild);
		
		//set table height
		if(options.height){
			options.height = isNaN(options.height) ? options.height : options.height + "px";
			element.style.height = options.height;
		}
		
		//set table min height
		if(options.minHeight !== false){
			options.minHeight = isNaN(options.minHeight) ? options.minHeight : options.minHeight + "px";
			element.style.minHeight = options.minHeight;
		}
		
		//set table maxHeight
		if(options.maxHeight !== false){
			options.maxHeight = isNaN(options.maxHeight) ? options.maxHeight : options.maxHeight + "px";
			element.style.maxHeight = options.maxHeight;
		}
	}
	
	//initialize core systems and modules
	_initializeTable(){
		var element = this.element,
		options = this.options;
		
		this.interactionMonitor.initialize();
		
		this.columnManager.initialize();
		this.rowManager.initialize();
		
		this._detectBrowser();
		
		//initialize core modules
		this.modulesCore.forEach((mod) => {
			mod.initialize();
		});
		
		//build table elements
		element.appendChild(this.columnManager.getElement());
		element.appendChild(this.rowManager.getElement());
		
		if(options.footerElement){
			this.footerManager.activate();
		}
		
		if(options.autoColumns && options.data){
			
			this.columnManager.generateColumnsFromRowData(this.options.data);
		}
		
		//initialize regular modules
		this.modulesRegular.forEach((mod) => {
			mod.initialize();
		});
		
		this.columnManager.setColumns(options.columns);
		
		this.eventBus.dispatch("table-built");
	}
	
	_loadInitialData(){
		return this.dataLoader.load(this.options.data)
			.finally(() => {
				this.columnManager.verticalAlignHeaders();
			});		
	}
	
	//deconstructor
	destroy(){
		var element = this.element;
		
		this.destroyed = true;
		
		this.constructor.registry.deregister(this); //deregister table from inter-device communication
		
		this.eventBus.dispatch("table-destroy");
		
		//clear row data
		this.rowManager.destroy();
		
		//clear DOM
		while(element.firstChild) element.removeChild(element.firstChild);
		element.classList.remove("tabulator");

		this.externalEvents.dispatch("tableDestroyed");
	}
	
	_detectBrowser(){
		var ua = navigator.userAgent||navigator.vendor||window.opera;
		
		if(ua.indexOf("Trident") > -1){
			this.browser = "ie";
			this.browserSlow = true;
		}else if(ua.indexOf("Edge") > -1){
			this.browser = "edge";
			this.browserSlow = true;
		}else if(ua.indexOf("Firefox") > -1){
			this.browser = "firefox";
			this.browserSlow = false;
		}else if(ua.indexOf("Mac OS") > -1){
			this.browser = "safari";
			this.browserSlow = false;
		}else {
			this.browser = "other";
			this.browserSlow = false;
		}
		
		this.browserMobile = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(ua)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(ua.slice(0,4));
	}
	
	initGuard(func, msg){
		var stack, line;
		
		if(this.options.debugInitialization && !this.initialized){
			if(!func){
				stack = new Error().stack.split("\n");
				
				line = stack[0] == "Error" ? stack[2] : stack[1];
				
				if(line[0] == " "){
					func = line.trim().split(" ")[1].split(".")[1];
				}else {
					func = line.trim().split("@")[0];
				}
			}
			
			console.warn("Table Not Initialized - Calling the " + func + " function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function." + (msg ? " " + msg : ""));
		}
		
		return this.initialized;
	}
	
	////////////////// Data Handling //////////////////
	//block table redrawing
	blockRedraw(){
		this.initGuard();

		this.eventBus.dispatch("redraw-blocking");
		
		this.rowManager.blockRedraw();
		this.columnManager.blockRedraw();

		this.eventBus.dispatch("redraw-blocked");
	}
	
	//restore table redrawing
	restoreRedraw(){
		this.initGuard();

		this.eventBus.dispatch("redraw-restoring");

		this.rowManager.restoreRedraw();
		this.columnManager.restoreRedraw();

		this.eventBus.dispatch("redraw-restored");
	}
	
	//load data
	setData(data, params, config){
		this.initGuard(false, "To set initial data please use the 'data' property in the table constructor.");
		
		return this.dataLoader.load(data, params, config, false);
	}
	
	//clear data
	clearData(){
		this.initGuard();
		
		this.dataLoader.blockActiveLoad();
		this.rowManager.clearData();
	}
	
	//get table data array
	getData(active){
		return this.rowManager.getData(active);
	}
	
	//get table data array count
	getDataCount(active){
		return this.rowManager.getDataCount(active);
	}
	
	//replace data, keeping table in position with same sort
	replaceData(data, params, config){
		this.initGuard();
		
		return this.dataLoader.load(data, params, config, true, true);
	}
	
	//update table data
	updateData(data){
		var responses = 0;
		
		this.initGuard();
		
		return new Promise((resolve, reject) => {
			this.dataLoader.blockActiveLoad();
			
			if(typeof data === "string"){
				data = JSON.parse(data);
			}
			
			if(data && data.length > 0){
				data.forEach((item) => {
					var row = this.rowManager.findRow(item[this.options.index]);
					
					if(row){
						responses++;
						
						row.updateData(item)
							.then(()=>{
								responses--;
							
								if(!responses){
									resolve();
								}
							})
							.catch((e) => {
								reject("Update Error - Unable to update row", item, e);
							});
					}else {
						reject("Update Error - Unable to find row", item);
					}
				});
			}else {
				console.warn("Update Error - No data provided");
				reject("Update Error - No data provided");
			}
		});
	}
	
	addData(data, pos, index){
		this.initGuard();
		
		return new Promise((resolve, reject) => {
			this.dataLoader.blockActiveLoad();
			
			if(typeof data === "string"){
				data = JSON.parse(data);
			}
			
			if(data){
				this.rowManager.addRows(data, pos, index)
					.then((rows) => {
						var output = [];
					
						rows.forEach(function(row){
							output.push(row.getComponent());
						});
					
						resolve(output);
					});
			}else {
				console.warn("Update Error - No data provided");
				reject("Update Error - No data provided");
			}
		});
	}
	
	//update table data
	updateOrAddData(data){
		var rows = [],
		responses = 0;
		
		this.initGuard();
		
		return new Promise((resolve, reject) => {
			this.dataLoader.blockActiveLoad();
			
			if(typeof data === "string"){
				data = JSON.parse(data);
			}
			
			if(data && data.length > 0){
				data.forEach((item) => {
					var row = this.rowManager.findRow(item[this.options.index]);
					
					responses++;
					
					if(row){
						row.updateData(item)
							.then(()=>{
								responses--;
								rows.push(row.getComponent());
							
								if(!responses){
									resolve(rows);
								}
							});
					}else {
						this.rowManager.addRows(item)
							.then((newRows)=>{
								responses--;
								rows.push(newRows[0].getComponent());
							
								if(!responses){
									resolve(rows);
								}
							});
					}
				});
			}else {
				console.warn("Update Error - No data provided");
				reject("Update Error - No data provided");
			}
		});
	}
	
	//get row object
	getRow(index){
		var row = this.rowManager.findRow(index);
		
		if(row){
			return row.getComponent();
		}else {
			console.warn("Find Error - No matching row found:", index);
			return false;
		}
	}
	
	//get row object
	getRowFromPosition(position){
		var row = this.rowManager.getRowFromPosition(position);
		
		if(row){
			return row.getComponent();
		}else {
			console.warn("Find Error - No matching row found:", position);
			return false;
		}
	}
	
	//delete row from table
	deleteRow(index){
		var foundRows = [];
		
		this.initGuard();
		
		if(!Array.isArray(index)){
			index = [index];
		}
		
		//find matching rows
		for(let item of index){
			let row = this.rowManager.findRow(item, true);
			
			if(row){
				foundRows.push(row);
			}else {
				console.error("Delete Error - No matching row found:", item);
				return Promise.reject("Delete Error - No matching row found");
			}
		}
		
		//sort rows into correct order to ensure smooth delete from table
		foundRows.sort((a, b) => {
			return this.rowManager.rows.indexOf(a) > this.rowManager.rows.indexOf(b) ? 1 : -1;
		});
		
		//delete rows
		foundRows.forEach((row) =>{
			row.delete();
		});
		
		this.rowManager.reRenderInPosition();
		
		return Promise.resolve();
	}
	
	//add row to table
	addRow(data, pos, index){
		this.initGuard();
		
		if(typeof data === "string"){
			data = JSON.parse(data);
		}
		
		return this.rowManager.addRows(data, pos, index, true)
			.then((rows)=>{
				return rows[0].getComponent();
			});
	}
	
	//update a row if it exists otherwise create it
	updateOrAddRow(index, data){
		var row = this.rowManager.findRow(index);
		
		this.initGuard();
		
		if(typeof data === "string"){
			data = JSON.parse(data);
		}
		
		if(row){
			return row.updateData(data)
				.then(()=>{
					return row.getComponent();
				});
		}else {
			return this.rowManager.addRows(data)
				.then((rows)=>{
					return rows[0].getComponent();
				});
		}
	}
	
	//update row data
	updateRow(index, data){
		var row = this.rowManager.findRow(index);
		
		this.initGuard();
		
		if(typeof data === "string"){
			data = JSON.parse(data);
		}
		
		if(row){
			return row.updateData(data)
				.then(()=>{
					return Promise.resolve(row.getComponent());
				});
		}else {
			console.warn("Update Error - No matching row found:", index);
			return Promise.reject("Update Error - No matching row found");
		}
	}
	
	//scroll to row in DOM
	scrollToRow(index, position, ifVisible){
		var row = this.rowManager.findRow(index);
		
		if(row){
			return this.rowManager.scrollToRow(row, position, ifVisible);
		}else {
			console.warn("Scroll Error - No matching row found:", index);
			return Promise.reject("Scroll Error - No matching row found");
		}
	}
	
	moveRow(from, to, after){
		var fromRow = this.rowManager.findRow(from);
		
		this.initGuard();
		
		if(fromRow){
			fromRow.moveToRow(to, after);
		}else {
			console.warn("Move Error - No matching row found:", from);
		}
	}
	
	getRows(active){
		return this.rowManager.getComponents(active);	
	}
	
	//get position of row in table
	getRowPosition(index){
		var row = this.rowManager.findRow(index);
		
		if(row){
			return row.getPosition();
		}else {
			console.warn("Position Error - No matching row found:", index);
			return false;
		}
	}
	
	/////////////// Column Functions  ///////////////
	setColumns(definition){
		this.initGuard(false, "To set initial columns please use the 'columns' property in the table constructor");
		
		this.columnManager.setColumns(definition);
	}
	
	getColumns(structured){
		return this.columnManager.getComponents(structured);
	}
	
	getColumn(field){
		var column = this.columnManager.findColumn(field);
		
		if(column){
			return column.getComponent();
		}else {
			console.warn("Find Error - No matching column found:", field);
			return false;
		}
	}
	
	getColumnDefinitions(){
		return this.columnManager.getDefinitionTree();
	}
	
	showColumn(field){
		var column = this.columnManager.findColumn(field);
		
		this.initGuard();
		
		if(column){
			column.show();
		}else {
			console.warn("Column Show Error - No matching column found:", field);
			return false;
		}
	}
	
	hideColumn(field){
		var column = this.columnManager.findColumn(field); 
		
		this.initGuard();
		
		if(column){
			column.hide();
		}else {
			console.warn("Column Hide Error - No matching column found:", field);
			return false;
		}
	}
	
	toggleColumn(field){
		var column = this.columnManager.findColumn(field);
		
		this.initGuard();
		
		if(column){
			if(column.visible){
				column.hide();
			}else {
				column.show();
			}
		}else {
			console.warn("Column Visibility Toggle Error - No matching column found:", field);
			return false;
		}
	}
	
	addColumn(definition, before, field){
		var column = this.columnManager.findColumn(field);
		
		this.initGuard();
		
		return this.columnManager.addColumn(definition, before, column)
			.then((column) => {
				return column.getComponent();
			});
	}
	
	deleteColumn(field){
		var column = this.columnManager.findColumn(field);
		
		this.initGuard();
		
		if(column){
			return column.delete();
		}else {
			console.warn("Column Delete Error - No matching column found:", field);
			return Promise.reject();
		}
	}
	
	updateColumnDefinition(field, definition){
		var column = this.columnManager.findColumn(field);
		
		this.initGuard();
		
		if(column){
			return column.updateDefinition(definition);
		}else {
			console.warn("Column Update Error - No matching column found:", field);
			return Promise.reject();
		}
	}
	
	moveColumn(from, to, after){
		var fromColumn = this.columnManager.findColumn(from),
		toColumn = this.columnManager.findColumn(to);
		
		this.initGuard();
		
		if(fromColumn){
			if(toColumn){
				this.columnManager.moveColumn(fromColumn, toColumn, after);
			}else {
				console.warn("Move Error - No matching column found:", toColumn);
			}
		}else {
			console.warn("Move Error - No matching column found:", from);
		}
	}
	
	//scroll to column in DOM
	scrollToColumn(field, position, ifVisible){
		return new Promise((resolve, reject) => {
			var column = this.columnManager.findColumn(field);
			
			if(column){
				return this.columnManager.scrollToColumn(column, position, ifVisible);
			}else {
				console.warn("Scroll Error - No matching column found:", field);
				return Promise.reject("Scroll Error - No matching column found");
			}
		});
	}
	
	//////////// General Public Functions ////////////
	//redraw list without updating data
	redraw(force){
		this.initGuard();

		this.columnManager.redraw(force);
		this.rowManager.redraw(force);
	}
	
	setHeight(height){
		this.options.height = isNaN(height) ? height : height + "px";
		this.element.style.height = this.options.height;
		this.rowManager.initializeRenderer();
		this.rowManager.redraw(true);
	}
	
	//////////////////// Event Bus ///////////////////
	
	on(key, callback){
		this.externalEvents.subscribe(key, callback);
	}
	
	off(key, callback){
		this.externalEvents.unsubscribe(key, callback);
	}
	
	dispatchEvent(){
		var args = Array.from(arguments);
		args.shift();
		
		this.externalEvents.dispatch(...arguments);
	}

	//////////////////// Alerts ///////////////////

	alert(contents, type){
		this.initGuard();

		this.alertManager.alert(contents, type);
	}

	clearAlert(){
		this.initGuard();

		this.alertManager.clear();
	}
	
	////////////// Extension Management //////////////
	modExists(plugin, required){
		if(this.modules[plugin]){
			return true;
		}else {
			if(required){
				console.error("Tabulator Module Not Installed: " + plugin);
			}
			return false;
		}
	}
	
	module(key){
		var mod = this.modules[key];
		
		if(!mod){
			console.error("Tabulator module not installed: " + key);
		}
		
		return mod;
	}
}

var Tabulator$1 = Tabulator;

//tabulator with all modules installed

class TabulatorFull extends Tabulator$1 {
	static extendModule(){
		Tabulator$1.initializeModuleBinder(allModules);
		Tabulator$1._extendModule(...arguments);
	}

	static registerModule(){
		Tabulator$1.initializeModuleBinder(allModules);
		Tabulator$1._registerModule(...arguments);
	}

	constructor(element, options, modules){
		super(element, options, allModules);
	}
}

var TabulatorFull$1 = TabulatorFull;

class PseudoRow {

	constructor (type){
		this.type = type;
		this.element = this._createElement();
	}

	_createElement(){
		var el = document.createElement("div");
		el.classList.add("tabulator-row");
		return el;
	}

	getElement(){
		return this.element;
	}

	getComponent(){
		return false;
	}

	getData(){
		return {};
	}

	getHeight(){
		return this.element.outerHeight;
	}

	initialize(){}

	reinitialize(){}

	normalizeHeight(){}

	generateCells(){}

	reinitializeHeight(){}

	calcHeight(){}

	setCellHeight(){}

	clearCellHeight(){}

	rendered(){}
}


//# sourceMappingURL=tabulator_esm.mjs.map


/***/ }),

/***/ "./src/api-holder.js":
/*!***************************!*\
  !*** ./src/api-holder.js ***!
  \***************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var gw2api_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! gw2api-client */ "./node_modules/gw2api-client/src/index.js");
/* harmony import */ var gw2api_client_src_cache_memory_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! gw2api-client/src/cache/memory.js */ "./node_modules/gw2api-client/src/cache/memory.js");
/* harmony import */ var gw2api_client_src_cache_browser_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! gw2api-client/src/cache/browser.js */ "./node_modules/gw2api-client/src/cache/browser.js");




function createClient(key) {
    const c = gw2api_client__WEBPACK_IMPORTED_MODULE_0__();
    c.schema("2024-07-20T01:00:00.000Z");
    c.language("en");
    if(key) c.authenticate(key);
    c.cacheStorage([
        gw2api_client_src_cache_memory_js__WEBPACK_IMPORTED_MODULE_1__({ gcTick: 5 * 60 * 1000 }),
        gw2api_client_src_cache_browser_js__WEBPACK_IMPORTED_MODULE_2__({
            storageKey: `gw2api-cache_${key}`,
            gcTick: 3 * 60 * 1000
        })
    ]);
    return c;
}

class Player {
    api;
    constructor(name, emoji, iconUrl, key) {
        this.name = name;
        this.emoji = emoji;
        this.iconUrl = iconUrl;
        this.key = key;
        
        if(!name) throw "Please name the players";
        if(!emoji) throw `${name} needs emoji`;
        if(!key) throw `${name} needs key`;

        this.api = createClient(key);
    }
}

function getApiHolder() {
    if(!window.apiHolder) {
        const players = readPlayers();
        window.apiHolder = {
            players: players,
            api: createClient(null)
        };
    }
    return window.apiHolder;
}

function readPlayers() {
    console.log("todo readplayers");
    var players = [];
    try {
        let storedValue = localStorage.getItem("gw2-no-nuance-players");
        if(storedValue)
            for(var p of JSON.parse(storedValue)) {
                players.push(new Player(p.name, p.emoji, p.iconUrl, p.key));
            }
    } catch(e) {
        alert(e);
    }
    console.log(players);
    return players;
}

function writePlayers(players) {
    console.log("saveplayers todo");
    console.log(players);
    let storedValue = JSON.stringify(players, (key,value) => { if (key=="api") return undefined; else return value; });
    // console.log(storedValue);
    localStorage.setItem("gw2-no-nuance-players", storedValue);
}

function apiHolderSetupHtml(elementId) {
    const element = document.getElementById(elementId);
    element.innerHTML = "";

    const table = document.createElement("table");
    element.appendChild(table);

    //const theader = document.createElement("theader");
    const theaderRow =  table.appendChild(document.createElement("tr"));
    theaderRow.appendChild(document.createElement("th")).innerText = "Player name";
    theaderRow.appendChild(document.createElement("th")).innerText = "Emoji";
    theaderRow.appendChild(document.createElement("th")).innerText = "Icon URL";
    theaderRow.appendChild(document.createElement("th")).innerText = "API Key";
    theaderRow.appendChild(document.createElement("th")).innerText = "";
    //table.appendChild(theader);

    const tbody = document.createElement("tbody");
    table.appendChild(tbody);

    const buttonAdd = document.createElement("button");
    buttonAdd.innerText = "Add row";
    const buttonSave= document.createElement("button");
    buttonSave.innerText = "Save";

    element.appendChild(buttonAdd);
    element.appendChild(buttonSave);

    const addRow = function(player) {
        const row = table.appendChild(document.createElement("tr"));
        console.log("Creating row for player:");
        console.log(player);
        row.appendChild(document.createElement("td")).appendChild(document.createElement("input")).value = player?.name    ?? "";
        row.appendChild(document.createElement("td")).appendChild(document.createElement("input")).value = player?.emoji   ?? "";
        row.appendChild(document.createElement("td")).appendChild(document.createElement("input")).value = player?.iconUrl ?? "";
        row.appendChild(document.createElement("td")).appendChild(document.createElement("input")).value = player?.key     ?? "";
        const del = row.appendChild(document.createElement("td")).appendChild(document.createElement("button"));
        del.innerText = ""
        del.onclick = () => { row.remove(); };
    }

    for(var player of readPlayers()) {
        addRow(player);
    }

    buttonAdd.onclick = () => { addRow(null); };
    buttonSave.onclick = () => {
        const players = [];
        for(var i in table.rows) {
            if(i==0) continue;
            const tr = table.rows[i];
            if(tr.localName!="tr") continue;
            const i0 = tr.cells[0].children[0].value
            const i1 = tr.cells[1].children[0].value
            const i2 = tr.cells[2].children[0].value
            const i3 = tr.cells[3].children[0].value
            players.push(new Player(i0,i1,i2,i3));
        }
        writePlayers(players);
    };
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    getApiHolder: getApiHolder,
    apiHolderSetupHtml: apiHolderSetupHtml,
});

/***/ }),

/***/ "./src/print.js":
/*!**********************!*\
  !*** ./src/print.js ***!
  \**********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ printMe)
/* harmony export */ });
function printMe() {
  console.log('I get called from print.js!');
}


/***/ }),

/***/ "./src/tables.js":
/*!***********************!*\
  !*** ./src/tables.js ***!
  \***********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var tabulator_tables__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tabulator-tables */ "./node_modules/tabulator-tables/dist/js/tabulator_esm.mjs");
/* harmony import */ var _api_holder_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./api-holder.js */ "./src/api-holder.js");
// https://datatables.net/manual/installation




tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.Tabulator.registerModule([tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.HtmlTableImportModule, tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.FilterModule, tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.EditModule, tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.FormatModule, tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.ColumnCalcsModule, tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.MutatorModule, tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.GroupRowsModule]);

/**
 * 
 * @param tableElement 
 * @param columns See https://tabulator.info/docs/6.3/columns, TL;DR: array of objects, each should have "title" + "field"
 * @param tableData array of objects
 * @returns 
 */
function createTableFromData(
    tableElement,
    columns,
    tableData,
) {
    let table = new tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.Tabulator(tableElement, {
        layout: "fitDataFill",
        columns: columns,
        data: tableData
    });

    return table;
}

/**
 * 
 * Creates a table from an HTML table element, and adds a column for each player.
 * The element MUST have an id column.
 * 
 * @param {*} tableElement 
 * @returns 
 */
function createTableWithPlayerColumns(
    tableElement,

) {
    let table = new tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.Tabulator(tableElement, {
        layout: "fitDataFill",
    });

    table.on("tableBuilt", function(){
        // todo hide id column
        for(let player of _api_holder_js__WEBPACK_IMPORTED_MODULE_1__["default"].getApiHolder().players) {
            table.addColumn({
                title: player.emoji,
                field: player.name,
                headerHozAlign: "center",
                hozAlign: "center",
                headerFilter:"input",
            });
            player.api.account().achievements().get().then((accountAchievements) => {
                let aa = accountAchievements.reduce((map,obj)=>{ map[obj.id] = obj; return map; });

                for(let r of table.getData()) {
                    let a = aa[r.id];
                    let d = {};

                    let txt = "-";
                    if(a?.done) txt = ""
                    else {
                        if(a?.max) txt = `${a?.current??0}/${a?.max}`;
                    }

                    d[player.name] = txt;
                    table.updateRow(r.id, d)
                }

            });
        }
    });

    return table;
}

function createDataTable(tableElement) {
    let table = new tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.Tabulator(tableElement, {
        layout: "fitDataFill",
    });

    table.on("tableBuilt", function(){
        for(let player of _api_holder_js__WEBPACK_IMPORTED_MODULE_1__["default"].getApiHolder().players) {
            table.addColumn({
                title: player.emoji,
                field: player.name,
                headerHozAlign: "center",
                hozAlign: "center",
                headerFilter:"input",
            });
            player.api.account().achievements().get().then((accountAchievements) => {
                let aa = accountAchievements.reduce((map,obj)=>{ map[obj.id] = obj; return map; });

                for(let r of table.getData()) {
                    let a = aa[r.id];
                    let d = {};

                    let txt = "-";
                    if(a?.done) txt = ""
                    else {
                        if(a?.max) txt = `${a?.current??0}/${a?.max}`;
                    }

                    d[player.name] = txt;
                    table.updateRow(r.id, d)
                }

            });
        }
    });

    return table;
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    tabulator: tabulator_tables__WEBPACK_IMPORTED_MODULE_0__.Tabulator,
    createDataTable: createDataTable,
    createTableFromData: createTableFromData,
});


/***/ }),

/***/ "./src/util.js":
/*!*********************!*\
  !*** ./src/util.js ***!
  \*********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });

class Coins {
    g;
    s;
    c;
    // use n in calculations
    n;
    // n, but absolute
    nAbsolute;
    sign;
    constructor(n) {
        this.n         = Math.trunc(n);
        this.nAbsolute = Math.abs(this.n);
        this.sign      = Math.sign(this.n);
        this.g = Math.floor(this.nAbsolute / 10000);
        this.s = Math.floor(this.nAbsolute / 100) % 100;
        this.c = this.nAbsolute % 100;

        let pad = (i) => i.toString().padStart(2,"0");
        let sgn = ""; if(this.sign < 0) sgn = "-";

        if     (this.g > 0) this.txt = `${sgn}${this.g} ${pad(this.s)} ${pad(this.c)}`;
        else if(this.s > 0) this.txt = `${sgn}${this.s} ${pad(this.c)}`;
        else                this.txt = `${sgn}${this.c}`;
    }
}

function createSpinner() {
    let i = document.createElement("i");
    i.setAttribute("class", "fas fa-spinner fa-pulse");
    return i;
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    int2coins: (n)=>new Coins(n),
    createSpinner: createSpinner,
});


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be in strict mode.
(() => {
"use strict";
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _print_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./print.js */ "./src/print.js");
/* harmony import */ var _api_holder_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./api-holder.js */ "./src/api-holder.js");
/* harmony import */ var _tables_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./tables.js */ "./src/tables.js");
/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./util.js */ "./src/util.js");







console.log("HELLO!");

function hello() {
    console.log("Hello from function!");
}

window.gw2 = {
    apiHolder: _api_holder_js__WEBPACK_IMPORTED_MODULE_1__["default"],
    tables: _tables_js__WEBPACK_IMPORTED_MODULE_2__["default"],
    util: _util_js__WEBPACK_IMPORTED_MODULE_3__["default"],
}

})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQWE7O0FBRWIsOENBQTZDLEVBQUUsYUFBYSxFQUFDOztBQUU3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQkFBZTs7Ozs7Ozs7Ozs7O0FDeENmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsV0FBVyxnQkFBZ0I7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLGtCQUFrQixZQUFZO0FBQzlCO0FBQ0E7O0FBRUE7QUFDQTs7Ozs7Ozs7Ozs7O0FDMUNhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5Q0FBeUM7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLElBQThCO0FBQ3RDLFlBQVksS0FBNkI7QUFDekM7QUFDQTtBQUNBLFFBQVEsYUFBYTtBQUNyQixNQUFNLEtBQUs7QUFBQSxFQUVOO0FBQ0w7QUFDQSxDQUFDOzs7Ozs7Ozs7OztBQ25DRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEscUJBQU0sb0JBQW9CLHFCQUFNO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVkscUJBQU0sb0JBQW9CLHFCQUFNO0FBQzVDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxNQUFNO0FBQ047QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLGlCQUFpQjtBQUNyQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVEQUF1RDtBQUN2RCxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1YsOEVBQThFO0FBQzlFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBLFVBQVU7QUFDVjtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhCQUE4QixxQkFBcUI7QUFDbkQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0EsdUNBQXVDLDRCQUE0QjtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLCtCQUErQiwwQkFBMEIsZUFBZTtBQUN4RTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1I7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpREFBaUQsYUFBYTs7QUFFOUQ7O0FBRUEsQ0FBQyxJQUFJO0FBQ0wsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFlO0FBQ2YsYUFBYSxtQ0FBbUMsT0FBTztBQUN2RCxlQUFlO0FBQ2YsZUFBZTtBQUNmLGdCQUFnQjtBQUNoQjs7Ozs7Ozs7Ozs7QUM3cUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsVUFBVTtBQUNyQixXQUFXLFFBQVE7QUFDbkIsV0FBVyxTQUFTO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOzs7Ozs7Ozs7OztBQ3JFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7Ozs7Ozs7Ozs7O0FDL0JBLGlCQUFpQixtQkFBTyxDQUFDLGtEQUFVO0FBQ25DLGtCQUFrQixtQkFBTyxDQUFDLGlFQUFZOztBQUV0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsb0JBQW9CLG1CQUFtQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxXQUFXO0FBQ1g7Ozs7Ozs7Ozs7O0FDN0ZBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHNCQUFzQjtBQUN0Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxvQkFBb0IsbUJBQW1CO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxXQUFXO0FBQ1g7Ozs7Ozs7Ozs7O0FDaEVBO0FBQ0EsV0FBVztBQUNYOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUN2QkEsY0FBYyxtQkFBTyxDQUFDLDBEQUFZO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLG9FQUFjO0FBQ3hDLGtCQUFrQixtQkFBTyxDQUFDLHdFQUFhO0FBQ3ZDLGFBQWEsbUJBQU8sQ0FBQyx3REFBUTs7QUFFN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLE9BQU87QUFDbEQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsS0FBSztBQUNsRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxPQUFPO0FBQ25EO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLE9BQU87QUFDNUM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDalRBLFdBQVcsbUJBQU8sQ0FBQyw4REFBZ0I7QUFDbkMsZUFBZSxtQkFBTyxDQUFDLDBEQUFjO0FBQ3JDLGNBQWMsbUJBQU8sQ0FBQyxnREFBTztBQUM3QixtQkFBbUIsbUJBQU8sQ0FBQyx3REFBUTs7QUFFbkM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLE9BQU87QUFDbEQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsS0FBSztBQUNsRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxPQUFPO0FBQ25EO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsT0FBTztBQUM1QztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsNkJBQTZCLFNBQVM7O0FBRXRDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxTQUFTO0FBQzFDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDZCQUE2QixTQUFTO0FBQ3RDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDZCQUE2QixTQUFTOztBQUV0QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsU0FBUztBQUMxQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw2QkFBNkIsU0FBUzs7QUFFdEM7QUFDQTtBQUNBLDhCQUE4QixTQUFTLE1BQU0sR0FBRztBQUNoRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDhCQUE4QixTQUFTLFlBQVksWUFBWTs7QUFFL0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQ0FBa0MsU0FBUztBQUMzQztBQUNBOztBQUVBLGdDQUFnQyxTQUFTLG9DQUFvQyxlQUFlO0FBQzVGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDhCQUE4QixTQUFTLHlCQUF5QixZQUFZOztBQUU1RTtBQUNBO0FBQ0EsMENBQTBDLFNBQVMsT0FBTyxlQUFlOztBQUV6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsOEJBQThCLFNBQVM7O0FBRXZDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHdFQUF3RSxpQkFBaUIsUUFBUSxLQUFLO0FBQ3RHOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxTQUFTO0FBQzNDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw4QkFBOEIsU0FBUztBQUN2Qyw0QkFBNEIsU0FBUyxRQUFRLEtBQUssYUFBYSxLQUFLO0FBQ3BFOztBQUVBO0FBQ0E7QUFDQSw2QkFBNkIsU0FBUzs7QUFFdEM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLFNBQVM7QUFDMUM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDZCQUE2QixTQUFTOztBQUV0QztBQUNBO0FBQ0EsOEJBQThCLFNBQVM7QUFDdkM7O0FBRUE7QUFDQTtBQUNBLDRCQUE0QixTQUFTLG9CQUFvQixpQkFBaUI7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsMkJBQTJCLG1EQUFtRDtBQUM5RSwyQkFBMkIsU0FBUyxRQUFRLEtBQUssYUFBYSxpQkFBaUI7QUFDL0U7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlFQUF5RSwwQkFBMEI7QUFDbkcsT0FBTztBQUNQLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUVBQXVFLHNCQUFzQjtBQUM3RixPQUFPO0FBQ1AsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsb0NBQW9DLG1CQUFtQjtBQUN2RDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxtQ0FBbUMsbUJBQW1CO0FBQ3REOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ25oQkEsYUFBYSxtQkFBTyxDQUFDLHNEQUFVO0FBQy9CLGFBQWEsbUJBQU8sQ0FBQyw0REFBWTs7QUFFakM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsTUFBTSxHQUFHLE9BQU87QUFDckQ7QUFDQTs7QUFFQTtBQUNBLE9BQU87QUFDUCxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0EsbUJBQW1COzs7Ozs7Ozs7OztBQ3hKbkIseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7QUFDOUMsMkJBQTJCLG1CQUFPLENBQUMsOEVBQWM7QUFDakQsb0JBQW9CLG1CQUFPLENBQUMsZ0VBQU87QUFDbkMseUJBQXlCLG1CQUFPLENBQUMsMEVBQVk7QUFDN0MsNkJBQTZCLG1CQUFPLENBQUMsa0ZBQWdCO0FBQ3JELG9CQUFvQixtQkFBTyxDQUFDLHFGQUFtQjtBQUMvQyxrQkFBa0IsbUJBQU8sQ0FBQyxtRkFBc0I7O0FBRWhEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7Ozs7Ozs7Ozs7QUM3bUJBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNsRUEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNsQ0EseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNaQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1ZBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsOEJBQThCO0FBQy9EO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsOEJBQThCO0FBQy9EO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw4QkFBOEI7QUFDL0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw4QkFBOEI7QUFDL0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw4QkFBOEI7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDhCQUE4QjtBQUMvRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLDhCQUE4QjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsOEJBQThCO0FBQy9EO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsOEJBQThCO0FBQy9EO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw4QkFBOEI7QUFDL0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw4QkFBOEI7QUFDL0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw4QkFBOEI7QUFDL0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQzFNQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx1Q0FBdUMsU0FBUztBQUNoRDs7QUFFQTtBQUNBLHdDQUF3QyxTQUFTO0FBQ2pEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLEtBQUssR0FBRyxLQUFLO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDN0ZBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLFlBQVk7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQzFCQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1hBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDVkEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixNQUFNO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDcEJBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGtDQUFrQyxHQUFHO0FBQ3JDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0JBQWtCLG1CQUFtQjtBQUNyQyxxQ0FBcUMsYUFBYTtBQUNsRDs7QUFFQTtBQUNBOzs7Ozs7Ozs7OztBQzVCQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1ZBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHlCQUF5QixHQUFHO0FBQzVCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4QkFBOEIseUJBQXlCO0FBQ3ZEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsdUJBQXVCO0FBQ25EO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLCtCQUErQixNQUFNO0FBQ3JDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHVCQUF1QjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsdUJBQXVCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qix1QkFBdUI7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHVCQUF1QjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsdUJBQXVCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qix1QkFBdUI7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLHVCQUF1QjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUMxS0EseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDOUJBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDL0NBO0FBQ0EsbUJBQW1CLG1CQUFPLENBQUMsd0VBQVc7QUFDdEMsd0JBQXdCLG1CQUFPLENBQUMsa0ZBQWdCO0FBQ2hELHFCQUFxQixtQkFBTyxDQUFDLDRFQUFhO0FBQzFDLGlCQUFpQixtQkFBTyxDQUFDLG9FQUFTO0FBQ2xDLGdCQUFnQixtQkFBTyxDQUFDLGtFQUFRO0FBQ2hDLHNCQUFzQixtQkFBTyxDQUFDLDhFQUFjO0FBQzVDLGtCQUFrQixtQkFBTyxDQUFDLHNFQUFVO0FBQ3BDLG9CQUFvQixtQkFBTyxDQUFDLDBFQUFZO0FBQ3hDLHNCQUFzQixtQkFBTyxDQUFDLDhFQUFjO0FBQzVDLHNCQUFzQixtQkFBTyxDQUFDLDhFQUFjO0FBQzVDLHlCQUF5QixtQkFBTyxDQUFDLG9GQUFpQjtBQUNsRCxvQkFBb0IsbUJBQU8sQ0FBQywwRUFBWTtBQUN4QyxrQkFBa0IsbUJBQU8sQ0FBQyxzRUFBVTtBQUNwQyxrQkFBa0IsbUJBQU8sQ0FBQyxzRUFBVTtBQUNwQyxrQkFBa0IsbUJBQU8sQ0FBQyxzRUFBVTtBQUNwQyxpQkFBaUIsbUJBQU8sQ0FBQyxvRUFBUztBQUNsQyxxQkFBcUIsbUJBQU8sQ0FBQyw0RUFBYTtBQUMxQyxtQkFBbUIsbUJBQU8sQ0FBQyx3RUFBVztBQUN0QyxpQkFBaUIsbUJBQU8sQ0FBQyxvRUFBUztBQUNsQyxnQkFBZ0IsbUJBQU8sQ0FBQyxrRUFBUTtBQUNoQyxxQkFBcUIsbUJBQU8sQ0FBQyw0RUFBYTtBQUMxQyxpQkFBaUIsbUJBQU8sQ0FBQyxvRUFBUztBQUNsQyxxQkFBcUIsbUJBQU8sQ0FBQyw0RUFBYTtBQUMxQyxvQkFBb0IsbUJBQU8sQ0FBQywwRUFBWTtBQUN4QywyQkFBMkIsbUJBQU8sQ0FBQyx3RkFBbUI7QUFDdEQsbUJBQW1CLG1CQUFPLENBQUMsd0VBQVc7QUFDdEMsd0JBQXdCLG1CQUFPLENBQUMsa0ZBQWdCO0FBQ2hELHFCQUFxQixtQkFBTyxDQUFDLDRFQUFhO0FBQzFDLGdCQUFnQixtQkFBTyxDQUFDLGtFQUFRO0FBQ2hDLHFCQUFxQixtQkFBTyxDQUFDLDRFQUFhO0FBQzFDLHFCQUFxQixtQkFBTyxDQUFDLDRFQUFhO0FBQzFDLGlCQUFpQixtQkFBTyxDQUFDLG9FQUFTO0FBQ2xDLGtCQUFrQixtQkFBTyxDQUFDLHNFQUFVO0FBQ3BDLGlCQUFpQixtQkFBTyxDQUFDLG9FQUFTO0FBQ2xDLHFCQUFxQixtQkFBTyxDQUFDLDRFQUFhO0FBQzFDLG1CQUFtQixtQkFBTyxDQUFDLHdFQUFXO0FBQ3RDLGdCQUFnQixtQkFBTyxDQUFDLGtFQUFRO0FBQ2hDLHVCQUF1QixtQkFBTyxDQUFDLGdGQUFlO0FBQzlDLGVBQWUsbUJBQU8sQ0FBQyxnRUFBTztBQUM5QixvQkFBb0IsbUJBQU8sQ0FBQywwRUFBWTtBQUN4QyxrQkFBa0IsbUJBQU8sQ0FBQyxzRUFBVTtBQUNwQyxpQkFBaUIsbUJBQU8sQ0FBQyxvRUFBUztBQUNsQyxpQkFBaUIsbUJBQU8sQ0FBQyxvRUFBUztBQUNsQyxtQkFBbUIsbUJBQU8sQ0FBQyx3RUFBVztBQUN0QyxrQkFBa0IsbUJBQU8sQ0FBQyxzRUFBVTtBQUNwQyxrQkFBa0IsbUJBQU8sQ0FBQyxzRUFBVTtBQUNwQyxpQkFBaUIsbUJBQU8sQ0FBQyxvRUFBUztBQUNsQywyQkFBMkIsbUJBQU8sQ0FBQyx3RkFBbUI7QUFDdEQsbUJBQW1CLG1CQUFPLENBQUMsd0VBQVc7QUFDdEMsa0JBQWtCLG1CQUFPLENBQUMsc0VBQVU7QUFDcEMscUJBQXFCLG1CQUFPLENBQUMsNEVBQWE7QUFDMUMsa0JBQWtCLG1CQUFPLENBQUMsc0VBQVU7QUFDcEMsd0JBQXdCLG1CQUFPLENBQUMsa0ZBQWdCO0FBQ2hELHVCQUF1QixtQkFBTyxDQUFDLGdGQUFlO0FBQzlDLGtCQUFrQixtQkFBTyxDQUFDLHNFQUFVO0FBQ3BDLGVBQWUsbUJBQU8sQ0FBQyxnRUFBTztBQUM5Qjs7Ozs7Ozs7Ozs7QUN6REEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWkEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1hBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1ZBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDVkEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1hBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1hBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ2hDQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1ZBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1hBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxHQUFHO0FBQ3JDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxHQUFHLGdCQUFnQixNQUFNLEdBQUcsT0FBTztBQUNyRTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDeEpBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDVkEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1hBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1ZBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0JBQStCLEdBQUc7QUFDbEM7O0FBRUE7QUFDQSxnQ0FBZ0MsR0FBRztBQUNuQztBQUNBOzs7Ozs7Ozs7OztBQy9CQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1hBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1pBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQzFCQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDVEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ1hBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDdkNBLHlCQUF5QixtQkFBTyxDQUFDLGlFQUFhOztBQUU5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNYQSx5QkFBeUIsbUJBQU8sQ0FBQyxpRUFBYTs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDWEEseUJBQXlCLG1CQUFPLENBQUMsaUVBQWE7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwrQkFBK0IsUUFBUTtBQUN2Qzs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsR0FBRztBQUMzQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxHQUFHLFNBQVMsS0FBSyxPQUFPLE1BQU07QUFDdEU7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0JBQStCLFFBQVE7QUFDdkM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsK0JBQStCLFFBQVE7QUFDdkM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwrQkFBK0IsUUFBUTtBQUN2Qzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsSUFBSTtBQUNQOztBQUVBLG1CQUFtQjs7Ozs7Ozs7Ozs7QUNsQm5CLG9CQUFvQix1SUFBeUQ7O0FBRTdFOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7Ozs7Ozs7Ozs7O0FDWkE7O0FBRUE7QUFDQSx5REFBeUQsS0FBSztBQUM5RDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDNURBLGVBQWUsbUJBQU8sQ0FBQyw0REFBVTs7QUFFakM7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFNkM7Ozs7Ozs7Ozs7O0FDL0Q3QztBQUNBOztBQUVBLGtCQUFrQixvQkFBb0I7QUFDdEM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUNqQkEsY0FBYyxtQkFBTyxDQUFDLHdFQUFhO0FBQ25DLGFBQWEsbUJBQU8sQ0FBQyx3REFBVzs7QUFFaEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBLG1CQUFtQjs7QUFFbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esa0NBQWtDO0FBQ2xDOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx5QkFBeUIsb0VBQW9FOztBQUU3RjtBQUNBLE9BQU87QUFDUDtBQUNBLHlCQUF5QiwyR0FBMkc7O0FBRXBJO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxxQkFBcUI7QUFDdkQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0EsaUNBQWlDO0FBQ2pDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7Ozs7Ozs7Ozs7O0FDdklhOztBQUViO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsV0FBVyxRQUFRO0FBQ25CLGFBQWEsYUFBYTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsYUFBYSxhQUFhO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsV0FBVyxRQUFRO0FBQ25CLFdBQVcsUUFBUTtBQUNuQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3JIYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlCQUFpQixZQUFZOztBQUU3Qjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esc0JBQXNCO0FBQ3RCOztBQUVBO0FBQ0EscURBQXFEO0FBQ3JEOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsMERBQTBEOztBQUUxRCxtQkFBbUIsY0FBYzs7QUFFakM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxvRkFBb0Y7O0FBRXBGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFEQUFxRDtBQUNyRDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZDQUE2Qzs7QUFFN0M7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0YsZUFBZSx1QkFBdUI7QUFDdEM7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLFFBQVE7QUFDUixNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0YsZUFBZSx1QkFBdUI7QUFDdEM7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNILEVBQUU7QUFDRjtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHO0FBQ0gsRUFBRTtBQUNGOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQixpQkFBaUI7QUFDakI7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0EsMkNBQTJDLElBQUk7QUFDL0MsaURBQWlEO0FBQ2pELHVEQUF1RDtBQUN2RCxzREFBc0Q7QUFDdEQ7QUFDQSx5REFBeUQ7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QixnQ0FBZ0M7O0FBRWhDO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQixtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEVBQUU7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCOztBQUV2QixnREFBZ0Q7QUFDaEQseURBQXlEO0FBQ3pELDBEQUEwRDtBQUMxRCw2REFBNkQ7QUFDN0QsK0RBQStEO0FBQy9ELDZEQUE2RDtBQUM3RCw4REFBOEQ7O0FBRTlEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTs7QUFFTjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7O0FBRUo7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBLHVCQUF1Qjs7QUFFdkI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIsd0JBQXdCO0FBQ3hCLHdCQUF3QjtBQUN4QixxQkFBcUI7QUFDckIsbUJBQW1CO0FBQ25CO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pELHNCQUFzQjtBQUN0Qix1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLHFCQUFxQjtBQUNyQix5QkFBeUI7QUFDekIsd0JBQXdCO0FBQ3hCLDRCQUE0QjtBQUM1QjtBQUNBLHdCQUF3QjtBQUN4Qiw0QkFBNEI7QUFDNUIsMkJBQTJCO0FBQzNCO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQ7QUFDdkQsS0FBSztBQUNMLElBQUk7QUFDSiw4Q0FBOEM7QUFDOUM7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0Esb0ZBQW9GO0FBQ3BGLEtBQUs7QUFDTCxJQUFJO0FBQ0osMEVBQTBFO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsWUFBWTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFlBQVk7QUFDN0I7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsZUFBZTtBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxNQUFNO0FBQ04sSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsbUJBQW1CO0FBQ25CLDBCQUEwQjtBQUMxQiw2QkFBNkI7QUFDN0Isd0JBQXdCO0FBQ3hCLDRCQUE0QjtBQUM1QixrQ0FBa0M7QUFDbEMscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixlQUFlO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0EsRUFBRTtBQUNGOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsY0FBYztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QywyQ0FBMkM7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRTtBQUNsRTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0EsaURBQWlEO0FBQ2pELG9EQUFvRDtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsOERBQThEO0FBQzlELHVFQUF1RTtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLCtDQUErQztBQUMvQyxvREFBb0Q7QUFDcEQsa0RBQWtEO0FBQ2xEO0FBQ0EsMERBQTBEO0FBQzFELHNEQUFzRDtBQUN0RCw4REFBOEQ7QUFDOUQsNkRBQTZEO0FBQzdELDJEQUEyRDtBQUMzRDtBQUNBLDhEQUE4RDtBQUM5RCw2REFBNkQ7O0FBRTdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EseUNBQXlDOztBQUV6Qzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxNQUFNOztBQUVOO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUEsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTtBQUNBOztBQUVBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRixrQ0FBa0M7QUFDbEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOzs7QUFHQTtBQUNBO0FBQ0Esa0NBQWtDOztBQUVsQztBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QywyQ0FBMkM7QUFDcEY7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEIsV0FBVyxJQUFJLFNBQVMsTUFBTTs7QUFFOUI7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLG9CQUFvQixHQUFHLFFBQVEsSUFBSSwwQ0FBMEM7QUFDN0U7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7O0FBRUE7QUFDQTtBQUNBLGNBQWMsZUFBZTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsYUFBYTtBQUM3QjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsMkJBQTJCLGNBQWM7QUFDekMsR0FBRyxHQUFHO0FBQ04sK0NBQStDLEdBQUc7QUFDbEQsMERBQTBEOztBQUUxRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUEsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEscURBQXFEO0FBQ3JEO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7O0FBR0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQixvQkFBb0I7QUFDcEM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGdCQUFnQixvQkFBb0I7QUFDcEM7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTs7QUFFQTtBQUNBLDZCQUE2QjtBQUM3Qjs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGdCQUFnQixvQkFBb0I7QUFDcEM7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG9CQUFvQjtBQUNwQztBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLG9CQUFvQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLDBCQUEwQjtBQUN6QztBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isb0JBQW9CO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsMEJBQTBCO0FBQ3pDO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixvQkFBb0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLDBCQUEwQjtBQUN6QztBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsb0JBQW9CO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0Msc0RBQXNEO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxXQUFXO0FBQ3RELDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhLGFBQWE7QUFDMUI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0VBQXdFO0FBQ3hFO0FBQ0E7QUFDQSxpQkFBaUIsb0JBQW9CO0FBQ3JDO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0ZBQW9GO0FBQ3BGOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCLDJCQUEyQjtBQUMzQiwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEMsT0FBTztBQUNQO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsbURBQW1EO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHNCQUFzQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLFFBQVE7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLG9CQUFvQjtBQUN6QztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixvQkFBb0I7QUFDekM7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG9CQUFvQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixxQkFBcUI7QUFDM0M7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RDtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7Ozs7QUFJSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLG1CQUFtQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixrQkFBa0I7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBLDJDQUEyQzs7QUFFM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSx3QkFBd0I7QUFDeEIsMkJBQTJCO0FBQzNCLGlDQUFpQzs7QUFFakM7QUFDQSx3Q0FBd0M7O0FBRXhDLHdCQUF3QjtBQUN4Qjs7QUFFQSxtREFBbUQ7O0FBRW5ELG9EQUFvRDtBQUNwRCwwREFBMEQ7QUFDMUQsZ0VBQWdFO0FBQ2hFLDhEQUE4RDs7QUFFOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrQ0FBa0M7QUFDbEMsS0FBSztBQUNMO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDO0FBQzNDOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhLG1EQUFtRDtBQUNoRTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGFBQWEsbURBQW1EO0FBQ2hFOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSwrQ0FBK0MsRUFBRTtBQUNqRDtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLDRHQUE0RztBQUM1RztBQUNBLEtBQUs7QUFDTDtBQUNBLG9HQUFvRztBQUNwRztBQUNBOzs7QUFHQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLFlBQVk7O0FBRVo7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGdCQUFnQixrRkFBa0Y7QUFDbEc7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLG9DQUFvQztBQUNqRDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3Qzs7QUFFeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsYUFBYSxvQ0FBb0M7QUFDakQ7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSixHQUFHO0FBQ0g7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOzs7QUFHSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esa0JBQWtCLEVBQUU7O0FBRXBCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxFQUFFO0FBQ0YsZ0JBQWdCO0FBQ2hCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLGFBQWEsYUFBYTtBQUMxQjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsNENBQTRDLGVBQWU7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RDtBQUM3RDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiw4REFBOEQ7QUFDOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmLGNBQWM7QUFDZCxjQUFjO0FBQ2QsZ0JBQWdCO0FBQ2hCLGVBQWU7QUFDZixnQkFBZ0I7QUFDaEIsZ0JBQWdCO0FBQ2hCLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRjtBQUNqRjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsV0FBVztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHFEQUFxRDtBQUNyRCxpREFBaUQ7QUFDakQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsb0NBQW9DO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CLCtCQUErQixjQUFjLEdBQUc7QUFDaEQscUNBQXFDLFdBQVc7QUFDaEQsdUJBQXVCO0FBQ3ZCO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsOENBQThDO0FBQzlDLG9EQUFvRDtBQUNwRDtBQUNBO0FBQ0Esa0RBQWtEO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsV0FBVztBQUNqRCxnQ0FBZ0MsY0FBYyxHQUFHO0FBQ2pEO0FBQ0E7QUFDQSx3REFBd0Q7QUFDeEQ7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRTtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBLDhDQUE4QztBQUM5Qzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0NBQWdDLHVFQUF1RTtBQUN2Rzs7QUFFQTtBQUNBLDhCQUE4QixnQ0FBZ0M7QUFDOUQ7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpQ0FBaUMsNENBQTRDO0FBQzdFOztBQUVBO0FBQ0EsaUNBQWlDLDRDQUE0QztBQUM3RTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBLHFCQUFxQixxQkFBcUI7QUFDMUM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGtCQUFrQixrQkFBa0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUIsd0JBQXdCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osV0FBVztBQUNYOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHFCQUFxQix3QkFBd0I7QUFDN0M7QUFDQSxVQUFVOztBQUVWOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixzQkFBc0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsV0FBVztBQUN2RDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBOztBQUVBOztBQUVBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBOztBQUVBLEVBQUU7O0FBRUY7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDRDQUE0QyxHQUFHO0FBQy9DLG1EQUFtRDtBQUNuRDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxNQUFNO0FBQ047QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkRBQTJEO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNILHFDQUFxQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ04sS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IsNkJBQTZCO0FBQzdCLDBCQUEwQjtBQUMxQix1QkFBdUI7QUFDdkIsc0JBQXNCO0FBQ3RCLDJCQUEyQjtBQUMzQixtQkFBbUI7QUFDbkIsOEJBQThCO0FBQzlCLDJCQUEyQjtBQUMzQixrQ0FBa0M7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRDtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHLEdBQUcsY0FBYztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLEdBQUcsY0FBYztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLDZCQUE2QjtBQUM3Qiw2QkFBNkI7QUFDN0IsMEJBQTBCO0FBQzFCLHVCQUF1QjtBQUN2QixzQkFBc0I7QUFDdEIsMkJBQTJCO0FBQzNCLDBCQUEwQjtBQUMxQixtQkFBbUI7QUFDbkIsbUJBQW1COztBQUVuQjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLGtEQUFrRDtBQUNsRCxpRUFBaUU7QUFDakUsbUVBQW1FO0FBQ25FO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7OztBQUdIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0osR0FBRyxHQUFHLGNBQWM7QUFDcEI7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxtRUFBbUU7QUFDbkU7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxREFBcUQ7QUFDckQ7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pELHVEQUF1RDtBQUN2RCxxREFBcUQ7QUFDckQsd0RBQXdEO0FBQ3hELHlEQUF5RDtBQUN6RCxnRUFBZ0U7QUFDaEUseURBQXlEO0FBQ3pELDZEQUE2RDtBQUM3RCx3REFBd0Q7QUFDeEQsc0RBQXNELEdBQUc7QUFDekQsMERBQTBELEdBQUc7QUFDN0Qsd0RBQXdEO0FBQ3hELDJEQUEyRDtBQUMzRDtBQUNBLHNEQUFzRDtBQUN0RCx1REFBdUQ7QUFDdkQsOERBQThEO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLEdBQUc7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsT0FBTztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLFVBQVU7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsU0FBUztBQUMvQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLDBCQUEwQjs7QUFFMUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7O0FBRUE7O0FBRUEsc0VBQXNFO0FBQ3RFO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpREFBaUQ7QUFDakQscURBQXFEO0FBQ3JELDREQUE0RDtBQUM1RCw0REFBNEQ7QUFDNUQ7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxrREFBa0Q7QUFDbEQscURBQXFEO0FBQ3JELGtEQUFrRDtBQUNsRCxrREFBa0Q7QUFDbEQsaURBQWlEO0FBQ2pELHdEQUF3RDtBQUN4RCw0Q0FBNEMsR0FBRzs7QUFFL0M7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7O0FBR0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4Qix1QkFBdUI7QUFDdkI7QUFDQTtBQUNBLG1EQUFtRDtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUixPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNEQUFzRCxjQUFjO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsY0FBYztBQUNqRTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG9EQUFvRDtBQUNwRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHFEQUFxRCxjQUFjOztBQUVuRTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw0REFBNEQsY0FBYzs7QUFFMUU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQSx1QkFBdUI7O0FBRXZCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxtREFBbUQsY0FBYztBQUNqRTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdURBQXVEO0FBQ3ZELHVFQUF1RTtBQUN2RSwyRUFBMkU7QUFDM0Usd0VBQXdFOztBQUV4RTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsK0JBQStCO0FBQy9COztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBLElBQUk7O0FBRUo7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCLCtCQUErQjtBQUMvQix3QkFBd0I7QUFDeEIsMEJBQTBCO0FBQzFCLHFDQUFxQztBQUNyQztBQUNBLDJEQUEyRDtBQUMzRCxnRUFBZ0U7QUFDaEUsb0VBQW9FO0FBQ3BFLCtEQUErRDtBQUMvRCxzRUFBc0UsYUFBYSxHQUFHO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qjs7QUFFeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEIsY0FBYzs7QUFFZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0osSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBLEVBQUU7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNEO0FBQ3RELDZEQUE2RDtBQUM3RCwwREFBMEQ7QUFDMUQsZ0VBQWdFO0FBQ2hFLHlFQUF5RTtBQUN6RSw4REFBOEQ7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHNFQUFzRSx5Q0FBeUM7QUFDL0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDRFQUE0RSx5Q0FBeUM7QUFDckg7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0Qix3QkFBd0I7QUFDeEI7QUFDQSxpREFBaUQ7QUFDakQ7QUFDQSxrREFBa0Q7QUFDbEQsMkRBQTJEO0FBQzNELHVEQUF1RDtBQUN2RCx3RkFBd0Y7QUFDeEYsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLHNCQUFzQix1QkFBdUI7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsOEVBQThFO0FBQ2hHO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDBCQUEwQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsT0FBTztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixlQUFlO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixlQUFlO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0VBQW9FO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7O0FBR0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0Esa0JBQWtCO0FBQ2xCOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQixxQkFBcUI7O0FBRXJCLGdCQUFnQjtBQUNoQjs7QUFFQTtBQUNBLDBDQUEwQztBQUMxQztBQUNBO0FBQ0EsNENBQTRDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQztBQUMxQywrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEtBQUs7QUFDTCxtQ0FBbUM7QUFDbkMsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxpQ0FBaUM7QUFDakM7OztBQUdBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsb0JBQW9CO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLDJCQUEyQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixTQUFTO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTixLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSw2QkFBNkIsb0JBQW9CO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEIscUJBQXFCO0FBQ3JCLDRCQUE0QjtBQUM1Qiw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwRUFBMEU7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQSwyQkFBMkI7O0FBRTNCLG9CQUFvQjtBQUNwQix1QkFBdUI7O0FBRXZCLDZCQUE2QjtBQUM3QixnQ0FBZ0M7O0FBRWhDLHVCQUF1QjtBQUN2QiwwQkFBMEI7O0FBRTFCLGdDQUFnQzs7QUFFaEMsNkJBQTZCOztBQUU3QixvQ0FBb0M7QUFDcEMsb0NBQW9DOztBQUVwQyw0QkFBNEI7QUFDNUIsK0JBQStCO0FBQy9COztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLDRCQUE0QixzQkFBc0I7O0FBRWxEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCw2QkFBNkIsc0JBQXNCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxNQUFNO0FBQ047QUFDQTs7QUFFQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0MsaURBQWlEO0FBQ2pELGdEQUFnRDtBQUNoRCwyQkFBMkI7QUFDM0IsbUNBQW1DO0FBQ25DO0FBQ0EsNEJBQTRCO0FBQzVCLCtCQUErQjtBQUMvQiw0QkFBNEI7QUFDNUI7QUFDQSxrQkFBa0I7QUFDbEIsZ0NBQWdDO0FBQ2hDLHdCQUF3QjtBQUN4Qiw0QkFBNEI7QUFDNUI7QUFDQSx5QkFBeUI7QUFDekIsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCLHlDQUF5QztBQUN6Qyw0Q0FBNEM7QUFDNUM7QUFDQSwwQkFBMEI7QUFDMUIsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRDtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFLFdBQVc7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFVBQVU7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsa0JBQWtCO0FBQzdDO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixrQkFBa0I7QUFDaEQ7QUFDQTtBQUNBLElBQUk7QUFDSixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qiw4QkFBOEI7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGlDQUFpQztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsdUNBQXVDO0FBQ3ZDLHlEQUF5RDtBQUN6RDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlELGNBQWM7QUFDdkU7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwRUFBMEUsY0FBYztBQUN4RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHlCQUF5QixtQkFBbUI7O0FBRTVDO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyx3QkFBd0Isc0JBQXNCLHdCQUF3Qjs7QUFFakg7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLDJDQUEyQyx3QkFBd0I7QUFDbkU7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlJQUF5SSxzQkFBc0Isd0JBQXdCO0FBQ3ZMO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwrRUFBK0U7QUFDL0UscUJBQXFCO0FBQ3JCLG9CQUFvQjtBQUNwQix3QkFBd0I7QUFDeEIsdUJBQXVCO0FBQ3ZCLHVCQUF1QjtBQUN2Qiw4QkFBOEI7QUFDOUIsMEJBQTBCO0FBQzFCLHdCQUF3QjtBQUN4QixrQkFBa0I7O0FBRWxCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKOztBQUVBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUEsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7O0FBRUY7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEVBQUU7O0FBRUY7QUFDQTtBQUNBLEVBQUU7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUEsaURBQWlEO0FBQ2pELDZEQUE2RDs7QUFFN0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSwyQkFBMkI7QUFDM0IscUJBQXFCO0FBQ3JCLHNCQUFzQjtBQUN0Qjs7QUFFQSw2Q0FBNkM7QUFDN0Msc0NBQXNDO0FBQ3RDOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLDJEQUEyRDs7QUFFM0Q7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLG9CQUFvQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLEtBQUs7QUFDTCxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QiwwQkFBMEI7QUFDMUIsNkJBQTZCO0FBQzdCLDRCQUE0QjtBQUM1Qix3QkFBd0I7QUFDeEIsOEJBQThCO0FBQzlCLHdCQUF3QjtBQUN4QixtQ0FBbUM7QUFDbkMscUJBQXFCO0FBQ3JCLDRCQUE0QjtBQUM1Qiw4QkFBOEI7QUFDOUIsb0JBQW9CO0FBQ3BCLCtCQUErQjtBQUMvQjtBQUNBLG9FQUFvRTtBQUNwRSwyQkFBMkI7QUFDM0I7QUFDQSxxQkFBcUI7QUFDckIseUJBQXlCO0FBQ3pCLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSw0Q0FBNEM7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQSxLQUFLLG1EQUFtRDtBQUN4RDtBQUNBO0FBQ0EsSUFBSSxnQ0FBZ0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEM7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsTUFBTTtBQUNOO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsTUFBTTtBQUNOLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7O0FBRTB3QztBQUMxd0M7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN0KzVCbUM7QUFDeUI7QUFDUztBQUNyRTtBQUNBO0FBQ0EsY0FBYywwQ0FBTTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsOERBQVcsR0FBRyx1QkFBdUI7QUFDN0MsUUFBUSwrREFBbUI7QUFDM0Isd0NBQXdDLElBQUk7QUFDNUM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsTUFBTTtBQUNsQywwQkFBMEIsTUFBTTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0Qsa0NBQWtDLG9CQUFvQjtBQUNySDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFlO0FBQ2Y7QUFDQTtBQUNBLEM7Ozs7Ozs7Ozs7Ozs7OztBQ3RJZTtBQUNmO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ0ZBO0FBQ0E7QUFDNko7QUFDckg7QUFDeEM7QUFDQSx1REFBUyxpQkFBaUIsbUVBQXFCLEVBQUUsMERBQVksRUFBRSx3REFBVSxFQUFFLDBEQUFZLEVBQUUsK0RBQWlCLEVBQUUsMkRBQWEsRUFBRSw2REFBZTtBQUMxSTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRTtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHVEQUFTO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLEdBQUc7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsdURBQVM7QUFDN0I7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHNEQUFTO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGlFQUFpRSxtQkFBbUIsYUFBYTtBQUNqRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLGNBQWMsR0FBRyxPQUFPO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHVEQUFTO0FBQzdCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSwwQkFBMEIsc0RBQVM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsaUVBQWlFLG1CQUFtQixhQUFhO0FBQ2pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsY0FBYyxHQUFHLE9BQU87QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWU7QUFDZixlQUFlLHVEQUFTO0FBQ3hCO0FBQ0E7QUFDQSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztBQ3ZIRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHNCQUFzQjs7QUFFdEIsMENBQTBDLElBQUksRUFBRSxPQUFPLEtBQUssWUFBWSxJQUFJLFlBQVk7QUFDeEYsMENBQTBDLElBQUksRUFBRSxPQUFPLElBQUksWUFBWTtBQUN2RSwwQ0FBMEMsSUFBSSxFQUFFLE9BQU87QUFDdkQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlO0FBQ2Y7QUFDQTtBQUNBLENBQUM7Ozs7Ozs7VUNwQ0Q7VUFDQTs7VUFFQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTtVQUNBO1VBQ0E7VUFDQTs7VUFFQTtVQUNBOztVQUVBO1VBQ0E7VUFDQTs7Ozs7V0N0QkE7V0FDQTtXQUNBO1dBQ0E7V0FDQSx5Q0FBeUMsd0NBQXdDO1dBQ2pGO1dBQ0E7V0FDQSxFOzs7OztXQ1BBO1dBQ0E7V0FDQTtXQUNBO1dBQ0EsR0FBRztXQUNIO1dBQ0E7V0FDQSxDQUFDLEk7Ozs7O1dDUEQsd0Y7Ozs7O1dDQUE7V0FDQTtXQUNBO1dBQ0EsdURBQXVELGlCQUFpQjtXQUN4RTtXQUNBLGdEQUFnRCxhQUFhO1dBQzdELEU7Ozs7Ozs7Ozs7Ozs7Ozs7QUNOaUM7QUFDakM7QUFDeUI7QUFDZTtBQUNQO0FBQ0o7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsc0RBQVM7QUFDeEIsWUFBWSxrREFBTTtBQUNsQixVQUFVLGdEQUFJO0FBQ2QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL0BlbW90aW9uL2hhc2gvZGlzdC9oYXNoLmJyb3dzZXIuY2pzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvYXJyYXktdW5pcXVlL2luZGV4LmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvY2h1bmsvc3JjL2NodW5rLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvY3Jvc3MtZmV0Y2gvZGlzdC9icm93c2VyLXBvbnlmaWxsLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZGVib3VuY2UvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9mYXN0LWdldC9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9jYWNoZS9icm93c2VyLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvY2FjaGUvbWVtb3J5LmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvY2FjaGUvbnVsbC5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2NsaWVudC5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50LmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL2FjY291bnQtYmxvYi5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9hY2NvdW50LmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL2FjaGlldmVtZW50cy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9iYWNrc3RvcnkuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvYnVpbGQuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvY2F0cy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9jaGFyYWN0ZXJzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL2NvbG9ycy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9jb21tZXJjZS5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9jb250aW5lbnRzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL2N1cnJlbmNpZXMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvZGFpbHljcmFmdGluZy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9kdW5nZW9ucy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9lbWJsZW0uanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvZW1vdGVzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL2V2ZW50cy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9maWxlcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9maW5pc2hlcnMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvZ2xpZGVycy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9ndWlsZC5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9ob21lLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL2hvbWVzdGVhZC5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9pdGVtcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9pdGVtc3RhdHMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvamFkZWJvdHMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvbGVnZW5kYXJ5YXJtb3J5LmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL2xlZ2VuZHMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvbWFpbGNhcnJpZXJzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL21hcGNoZXN0cy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9tYXBzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL21hc3Rlcmllcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9tYXRlcmlhbHMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvbWluaXMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvbW91bnRzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL25vZGVzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL25vdmVsdGllcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9vdXRmaXRzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL3BldHMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvcHJvZmVzc2lvbnMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvcHZwLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL3F1YWdnYW5zLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL3F1ZXN0cy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9yYWNlcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9yYWlkcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9yZWNpcGVzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL3NraWZmcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy9za2lsbHMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvc2tpbnMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvc3BlY2lhbGl6YXRpb25zLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL3N0b3JpZXMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvdGl0bGVzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL3Rva2VuaW5mby5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy90cmFpdHMuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9lbmRwb2ludHMvd2l6YXJkc3ZhdWx0LmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL3dvcmxkYm9zc2VzLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvZW5kcG9pbnRzL3dvcmxkcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2VuZHBvaW50cy93dncuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9ndzJhcGktY2xpZW50L3NyYy9mbG93LmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvaGFzaC5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL2d3MmFwaS1jbGllbnQvc3JjL2hlbHBlcnMvcmVzZXRUaW1lLmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvZ3cyYXBpLWNsaWVudC9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9pZGIta2V5dmFsL2Rpc3QvaWRiLWtleXZhbC5tanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9sZXRzLWZldGNoL3NyYy9mbG93LmpzIiwid2VicGFjazovL3NjcmlwdHMvLi9ub2RlX21vZHVsZXMvbGV0cy1mZXRjaC9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL25vZGVfbW9kdWxlcy9xdWVyeXN0cmluZ2lmeS9pbmRleC5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vbm9kZV9tb2R1bGVzL3RhYnVsYXRvci10YWJsZXMvZGlzdC9qcy90YWJ1bGF0b3JfZXNtLm1qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vc3JjL2FwaS1ob2xkZXIuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy8uL3NyYy9wcmludC5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vc3JjL3RhYmxlcy5qcyIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vc3JjL3V0aWwuanMiLCJ3ZWJwYWNrOi8vc2NyaXB0cy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zY3JpcHRzL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9zY3JpcHRzL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vc2NyaXB0cy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3NjcmlwdHMvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9zY3JpcHRzLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcblxuLyogZXNsaW50LWRpc2FibGUgKi9cbi8vIG11cm11cmhhc2gyIHZpYSBodHRwczovL2dpdGh1Yi5jb20vZ2FyeWNvdXJ0L211cm11cmhhc2gtanMvYmxvYi9tYXN0ZXIvbXVybXVyaGFzaDJfZ2MuanNcbmZ1bmN0aW9uIG11cm11cmhhc2gyXzMyX2djKHN0cikge1xuICB2YXIgbCA9IHN0ci5sZW5ndGgsXG4gICAgICBoID0gbCBeIGwsXG4gICAgICBpID0gMCxcbiAgICAgIGs7XG5cbiAgd2hpbGUgKGwgPj0gNCkge1xuICAgIGsgPSBzdHIuY2hhckNvZGVBdChpKSAmIDB4ZmYgfCAoc3RyLmNoYXJDb2RlQXQoKytpKSAmIDB4ZmYpIDw8IDggfCAoc3RyLmNoYXJDb2RlQXQoKytpKSAmIDB4ZmYpIDw8IDE2IHwgKHN0ci5jaGFyQ29kZUF0KCsraSkgJiAweGZmKSA8PCAyNDtcbiAgICBrID0gKGsgJiAweGZmZmYpICogMHg1YmQxZTk5NSArICgoKGsgPj4+IDE2KSAqIDB4NWJkMWU5OTUgJiAweGZmZmYpIDw8IDE2KTtcbiAgICBrIF49IGsgPj4+IDI0O1xuICAgIGsgPSAoayAmIDB4ZmZmZikgKiAweDViZDFlOTk1ICsgKCgoayA+Pj4gMTYpICogMHg1YmQxZTk5NSAmIDB4ZmZmZikgPDwgMTYpO1xuICAgIGggPSAoaCAmIDB4ZmZmZikgKiAweDViZDFlOTk1ICsgKCgoaCA+Pj4gMTYpICogMHg1YmQxZTk5NSAmIDB4ZmZmZikgPDwgMTYpIF4gaztcbiAgICBsIC09IDQ7XG4gICAgKytpO1xuICB9XG5cbiAgc3dpdGNoIChsKSB7XG4gICAgY2FzZSAzOlxuICAgICAgaCBePSAoc3RyLmNoYXJDb2RlQXQoaSArIDIpICYgMHhmZikgPDwgMTY7XG5cbiAgICBjYXNlIDI6XG4gICAgICBoIF49IChzdHIuY2hhckNvZGVBdChpICsgMSkgJiAweGZmKSA8PCA4O1xuXG4gICAgY2FzZSAxOlxuICAgICAgaCBePSBzdHIuY2hhckNvZGVBdChpKSAmIDB4ZmY7XG4gICAgICBoID0gKGggJiAweGZmZmYpICogMHg1YmQxZTk5NSArICgoKGggPj4+IDE2KSAqIDB4NWJkMWU5OTUgJiAweGZmZmYpIDw8IDE2KTtcbiAgfVxuXG4gIGggXj0gaCA+Pj4gMTM7XG4gIGggPSAoaCAmIDB4ZmZmZikgKiAweDViZDFlOTk1ICsgKCgoaCA+Pj4gMTYpICogMHg1YmQxZTk5NSAmIDB4ZmZmZikgPDwgMTYpO1xuICBoIF49IGggPj4+IDE1O1xuICByZXR1cm4gKGggPj4+IDApLnRvU3RyaW5nKDM2KTtcbn1cblxuZXhwb3J0cy5kZWZhdWx0ID0gbXVybXVyaGFzaDJfMzJfZ2M7XG4iLCIvKiFcbiAqIGFycmF5LXVuaXF1ZSA8aHR0cHM6Ly9naXRodWIuY29tL2pvbnNjaGxpbmtlcnQvYXJyYXktdW5pcXVlPlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNC0yMDE1LCBKb24gU2NobGlua2VydC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdW5pcXVlKGFycikge1xuICBpZiAoIUFycmF5LmlzQXJyYXkoYXJyKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2FycmF5LXVuaXF1ZSBleHBlY3RzIGFuIGFycmF5LicpO1xuICB9XG5cbiAgdmFyIGxlbiA9IGFyci5sZW5ndGg7XG4gIHZhciBpID0gLTE7XG5cbiAgd2hpbGUgKGkrKyA8IGxlbikge1xuICAgIHZhciBqID0gaSArIDE7XG5cbiAgICBmb3IgKDsgaiA8IGFyci5sZW5ndGg7ICsraikge1xuICAgICAgaWYgKGFycltpXSA9PT0gYXJyW2pdKSB7XG4gICAgICAgIGFyci5zcGxpY2Uoai0tLCAxKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFycjtcbn07XG5cbm1vZHVsZS5leHBvcnRzLmltbXV0YWJsZSA9IGZ1bmN0aW9uIHVuaXF1ZUltbXV0YWJsZShhcnIpIHtcbiAgaWYgKCFBcnJheS5pc0FycmF5KGFycikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdhcnJheS11bmlxdWUgZXhwZWN0cyBhbiBhcnJheS4nKTtcbiAgfVxuXG4gIHZhciBhcnJMZW4gPSBhcnIubGVuZ3RoO1xuICB2YXIgbmV3QXJyID0gbmV3IEFycmF5KGFyckxlbik7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJMZW47IGkrKykge1xuICAgIG5ld0FycltpXSA9IGFycltpXTtcbiAgfVxuXG4gIHJldHVybiBtb2R1bGUuZXhwb3J0cyhuZXdBcnIpO1xufTtcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICBmdW5jdGlvbiBjaHVuayAoY29sbGVjdGlvbiwgc2l6ZSkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGRlZmF1bHQgc2l6ZSB0byB0d28gaXRlbVxyXG4gICAgICAgIHNpemUgPSBwYXJzZUludChzaXplKSB8fCAyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGFkZCBlYWNoIGNodW5rIHRvIHRoZSByZXN1bHRcclxuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IE1hdGguY2VpbChjb2xsZWN0aW9uLmxlbmd0aCAvIHNpemUpOyB4KyspIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBzdGFydCA9IHggKiBzaXplO1xyXG4gICAgICAgICAgICB2YXIgZW5kID0gc3RhcnQgKyBzaXplO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmVzdWx0LnB1c2goY29sbGVjdGlvbi5zbGljZShzdGFydCwgZW5kKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBleHBvcnQgaW4gbm9kZSBvciBicm93c2VyXHJcbiAgICBpZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XHJcbiAgICAgICAgICAgIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGNodW5rO1xyXG4gICAgICAgIH1cclxuICAgICAgICBleHBvcnRzLmNodW5rID0gY2h1bms7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuY2h1bmsgPSBjaHVuaztcclxuICAgIH1cclxuXHJcbn0uY2FsbCh0aGlzKSk7XHJcbiIsIi8vIFNhdmUgZ2xvYmFsIG9iamVjdCBpbiBhIHZhcmlhYmxlXG52YXIgX19nbG9iYWxfXyA9XG4odHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbFRoaXMpIHx8XG4odHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICYmIHNlbGYpIHx8XG4odHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2xvYmFsKTtcbi8vIENyZWF0ZSBhbiBvYmplY3QgdGhhdCBleHRlbmRzIGZyb20gX19nbG9iYWxfXyB3aXRob3V0IHRoZSBmZXRjaCBmdW5jdGlvblxudmFyIF9fZ2xvYmFsVGhpc19fID0gKGZ1bmN0aW9uICgpIHtcbmZ1bmN0aW9uIEYoKSB7XG50aGlzLmZldGNoID0gZmFsc2U7XG50aGlzLkRPTUV4Y2VwdGlvbiA9IF9fZ2xvYmFsX18uRE9NRXhjZXB0aW9uXG59XG5GLnByb3RvdHlwZSA9IF9fZ2xvYmFsX187IC8vIE5lZWRlZCBmb3IgZmVhdHVyZSBkZXRlY3Rpb24gb24gd2hhdHdnLWZldGNoJ3MgY29kZVxucmV0dXJuIG5ldyBGKCk7XG59KSgpO1xuLy8gV3JhcHMgd2hhdHdnLWZldGNoIHdpdGggYSBmdW5jdGlvbiBzY29wZSB0byBoaWphY2sgdGhlIGdsb2JhbCBvYmplY3Rcbi8vIFwiZ2xvYmFsVGhpc1wiIHRoYXQncyBnb2luZyB0byBiZSBwYXRjaGVkXG4oZnVuY3Rpb24oZ2xvYmFsVGhpcykge1xuXG52YXIgaXJyZWxldmFudCA9IChmdW5jdGlvbiAoZXhwb3J0cykge1xuXG4gIC8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvdHlwZS1idWlsdGlucyAqL1xuICB2YXIgZyA9XG4gICAgKHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyAmJiBnbG9iYWxUaGlzKSB8fFxuICAgICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgc2VsZikgfHxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWZcbiAgICAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2xvYmFsKSB8fFxuICAgIHt9O1xuXG4gIHZhciBzdXBwb3J0ID0ge1xuICAgIHNlYXJjaFBhcmFtczogJ1VSTFNlYXJjaFBhcmFtcycgaW4gZyxcbiAgICBpdGVyYWJsZTogJ1N5bWJvbCcgaW4gZyAmJiAnaXRlcmF0b3InIGluIFN5bWJvbCxcbiAgICBibG9iOlxuICAgICAgJ0ZpbGVSZWFkZXInIGluIGcgJiZcbiAgICAgICdCbG9iJyBpbiBnICYmXG4gICAgICAoZnVuY3Rpb24oKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgbmV3IEJsb2IoKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH0pKCksXG4gICAgZm9ybURhdGE6ICdGb3JtRGF0YScgaW4gZyxcbiAgICBhcnJheUJ1ZmZlcjogJ0FycmF5QnVmZmVyJyBpbiBnXG4gIH07XG5cbiAgZnVuY3Rpb24gaXNEYXRhVmlldyhvYmopIHtcbiAgICByZXR1cm4gb2JqICYmIERhdGFWaWV3LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKG9iailcbiAgfVxuXG4gIGlmIChzdXBwb3J0LmFycmF5QnVmZmVyKSB7XG4gICAgdmFyIHZpZXdDbGFzc2VzID0gW1xuICAgICAgJ1tvYmplY3QgSW50OEFycmF5XScsXG4gICAgICAnW29iamVjdCBVaW50OEFycmF5XScsXG4gICAgICAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLFxuICAgICAgJ1tvYmplY3QgSW50MTZBcnJheV0nLFxuICAgICAgJ1tvYmplY3QgVWludDE2QXJyYXldJyxcbiAgICAgICdbb2JqZWN0IEludDMyQXJyYXldJyxcbiAgICAgICdbb2JqZWN0IFVpbnQzMkFycmF5XScsXG4gICAgICAnW29iamVjdCBGbG9hdDMyQXJyYXldJyxcbiAgICAgICdbb2JqZWN0IEZsb2F0NjRBcnJheV0nXG4gICAgXTtcblxuICAgIHZhciBpc0FycmF5QnVmZmVyVmlldyA9XG4gICAgICBBcnJheUJ1ZmZlci5pc1ZpZXcgfHxcbiAgICAgIGZ1bmN0aW9uKG9iaikge1xuICAgICAgICByZXR1cm4gb2JqICYmIHZpZXdDbGFzc2VzLmluZGV4T2YoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikpID4gLTFcbiAgICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBub3JtYWxpemVOYW1lKG5hbWUpIHtcbiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICBuYW1lID0gU3RyaW5nKG5hbWUpO1xuICAgIH1cbiAgICBpZiAoL1teYS16MC05XFwtIyQlJicqKy5eX2B8fiFdL2kudGVzdChuYW1lKSB8fCBuYW1lID09PSAnJykge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBjaGFyYWN0ZXIgaW4gaGVhZGVyIGZpZWxkIG5hbWU6IFwiJyArIG5hbWUgKyAnXCInKVxuICAgIH1cbiAgICByZXR1cm4gbmFtZS50b0xvd2VyQ2FzZSgpXG4gIH1cblxuICBmdW5jdGlvbiBub3JtYWxpemVWYWx1ZSh2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICB2YWx1ZSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZVxuICB9XG5cbiAgLy8gQnVpbGQgYSBkZXN0cnVjdGl2ZSBpdGVyYXRvciBmb3IgdGhlIHZhbHVlIGxpc3RcbiAgZnVuY3Rpb24gaXRlcmF0b3JGb3IoaXRlbXMpIHtcbiAgICB2YXIgaXRlcmF0b3IgPSB7XG4gICAgICBuZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gaXRlbXMuc2hpZnQoKTtcbiAgICAgICAgcmV0dXJuIHtkb25lOiB2YWx1ZSA9PT0gdW5kZWZpbmVkLCB2YWx1ZTogdmFsdWV9XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmIChzdXBwb3J0Lml0ZXJhYmxlKSB7XG4gICAgICBpdGVyYXRvcltTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBpdGVyYXRvclxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gaXRlcmF0b3JcbiAgfVxuXG4gIGZ1bmN0aW9uIEhlYWRlcnMoaGVhZGVycykge1xuICAgIHRoaXMubWFwID0ge307XG5cbiAgICBpZiAoaGVhZGVycyBpbnN0YW5jZW9mIEhlYWRlcnMpIHtcbiAgICAgIGhlYWRlcnMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwgbmFtZSkge1xuICAgICAgICB0aGlzLmFwcGVuZChuYW1lLCB2YWx1ZSk7XG4gICAgICB9LCB0aGlzKTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaGVhZGVycykpIHtcbiAgICAgIGhlYWRlcnMuZm9yRWFjaChmdW5jdGlvbihoZWFkZXIpIHtcbiAgICAgICAgaWYgKGhlYWRlci5sZW5ndGggIT0gMikge1xuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0hlYWRlcnMgY29uc3RydWN0b3I6IGV4cGVjdGVkIG5hbWUvdmFsdWUgcGFpciB0byBiZSBsZW5ndGggMiwgZm91bmQnICsgaGVhZGVyLmxlbmd0aClcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFwcGVuZChoZWFkZXJbMF0sIGhlYWRlclsxXSk7XG4gICAgICB9LCB0aGlzKTtcbiAgICB9IGVsc2UgaWYgKGhlYWRlcnMpIHtcbiAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhlYWRlcnMpLmZvckVhY2goZnVuY3Rpb24obmFtZSkge1xuICAgICAgICB0aGlzLmFwcGVuZChuYW1lLCBoZWFkZXJzW25hbWVdKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgbmFtZSA9IG5vcm1hbGl6ZU5hbWUobmFtZSk7XG4gICAgdmFsdWUgPSBub3JtYWxpemVWYWx1ZSh2YWx1ZSk7XG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5tYXBbbmFtZV07XG4gICAgdGhpcy5tYXBbbmFtZV0gPSBvbGRWYWx1ZSA/IG9sZFZhbHVlICsgJywgJyArIHZhbHVlIDogdmFsdWU7XG4gIH07XG5cbiAgSGVhZGVycy5wcm90b3R5cGVbJ2RlbGV0ZSddID0gZnVuY3Rpb24obmFtZSkge1xuICAgIGRlbGV0ZSB0aGlzLm1hcFtub3JtYWxpemVOYW1lKG5hbWUpXTtcbiAgfTtcblxuICBIZWFkZXJzLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihuYW1lKSB7XG4gICAgbmFtZSA9IG5vcm1hbGl6ZU5hbWUobmFtZSk7XG4gICAgcmV0dXJuIHRoaXMuaGFzKG5hbWUpID8gdGhpcy5tYXBbbmFtZV0gOiBudWxsXG4gIH07XG5cbiAgSGVhZGVycy5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24obmFtZSkge1xuICAgIHJldHVybiB0aGlzLm1hcC5oYXNPd25Qcm9wZXJ0eShub3JtYWxpemVOYW1lKG5hbWUpKVxuICB9O1xuXG4gIEhlYWRlcnMucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgdGhpcy5tYXBbbm9ybWFsaXplTmFtZShuYW1lKV0gPSBub3JtYWxpemVWYWx1ZSh2YWx1ZSk7XG4gIH07XG5cbiAgSGVhZGVycy5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCB0aGlzQXJnKSB7XG4gICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzLm1hcCkge1xuICAgICAgaWYgKHRoaXMubWFwLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdGhpcy5tYXBbbmFtZV0sIG5hbWUsIHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBIZWFkZXJzLnByb3RvdHlwZS5rZXlzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGl0ZW1zID0gW107XG4gICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG4gICAgICBpdGVtcy5wdXNoKG5hbWUpO1xuICAgIH0pO1xuICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcylcbiAgfTtcblxuICBIZWFkZXJzLnByb3RvdHlwZS52YWx1ZXMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbXMgPSBbXTtcbiAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGl0ZW1zLnB1c2godmFsdWUpO1xuICAgIH0pO1xuICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcylcbiAgfTtcblxuICBIZWFkZXJzLnByb3RvdHlwZS5lbnRyaWVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGl0ZW1zID0gW107XG4gICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG4gICAgICBpdGVtcy5wdXNoKFtuYW1lLCB2YWx1ZV0pO1xuICAgIH0pO1xuICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcylcbiAgfTtcblxuICBpZiAoc3VwcG9ydC5pdGVyYWJsZSkge1xuICAgIEhlYWRlcnMucHJvdG90eXBlW1N5bWJvbC5pdGVyYXRvcl0gPSBIZWFkZXJzLnByb3RvdHlwZS5lbnRyaWVzO1xuICB9XG5cbiAgZnVuY3Rpb24gY29uc3VtZWQoYm9keSkge1xuICAgIGlmIChib2R5Ll9ub0JvZHkpIHJldHVyblxuICAgIGlmIChib2R5LmJvZHlVc2VkKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFR5cGVFcnJvcignQWxyZWFkeSByZWFkJykpXG4gICAgfVxuICAgIGJvZHkuYm9keVVzZWQgPSB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gZmlsZVJlYWRlclJlYWR5KHJlYWRlcikge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZWFkZXIucmVzdWx0KTtcbiAgICAgIH07XG4gICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVhZGVyLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSlcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRCbG9iQXNBcnJheUJ1ZmZlcihibG9iKSB7XG4gICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgdmFyIHByb21pc2UgPSBmaWxlUmVhZGVyUmVhZHkocmVhZGVyKTtcbiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7XG4gICAgcmV0dXJuIHByb21pc2VcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRCbG9iQXNUZXh0KGJsb2IpIHtcbiAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICB2YXIgcHJvbWlzZSA9IGZpbGVSZWFkZXJSZWFkeShyZWFkZXIpO1xuICAgIHZhciBtYXRjaCA9IC9jaGFyc2V0PShbQS1aYS16MC05Xy1dKykvLmV4ZWMoYmxvYi50eXBlKTtcbiAgICB2YXIgZW5jb2RpbmcgPSBtYXRjaCA/IG1hdGNoWzFdIDogJ3V0Zi04JztcbiAgICByZWFkZXIucmVhZEFzVGV4dChibG9iLCBlbmNvZGluZyk7XG4gICAgcmV0dXJuIHByb21pc2VcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlYWRBcnJheUJ1ZmZlckFzVGV4dChidWYpIHtcbiAgICB2YXIgdmlldyA9IG5ldyBVaW50OEFycmF5KGJ1Zik7XG4gICAgdmFyIGNoYXJzID0gbmV3IEFycmF5KHZpZXcubGVuZ3RoKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykge1xuICAgICAgY2hhcnNbaV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHZpZXdbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gY2hhcnMuam9pbignJylcbiAgfVxuXG4gIGZ1bmN0aW9uIGJ1ZmZlckNsb25lKGJ1Zikge1xuICAgIGlmIChidWYuc2xpY2UpIHtcbiAgICAgIHJldHVybiBidWYuc2xpY2UoMClcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHZpZXcgPSBuZXcgVWludDhBcnJheShidWYuYnl0ZUxlbmd0aCk7XG4gICAgICB2aWV3LnNldChuZXcgVWludDhBcnJheShidWYpKTtcbiAgICAgIHJldHVybiB2aWV3LmJ1ZmZlclxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIEJvZHkoKSB7XG4gICAgdGhpcy5ib2R5VXNlZCA9IGZhbHNlO1xuXG4gICAgdGhpcy5faW5pdEJvZHkgPSBmdW5jdGlvbihib2R5KSB7XG4gICAgICAvKlxuICAgICAgICBmZXRjaC1tb2NrIHdyYXBzIHRoZSBSZXNwb25zZSBvYmplY3QgaW4gYW4gRVM2IFByb3h5IHRvXG4gICAgICAgIHByb3ZpZGUgdXNlZnVsIHRlc3QgaGFybmVzcyBmZWF0dXJlcyBzdWNoIGFzIGZsdXNoLiBIb3dldmVyLCBvblxuICAgICAgICBFUzUgYnJvd3NlcnMgd2l0aG91dCBmZXRjaCBvciBQcm94eSBzdXBwb3J0IHBvbGx5ZmlsbHMgbXVzdCBiZSB1c2VkO1xuICAgICAgICB0aGUgcHJveHktcG9sbHlmaWxsIGlzIHVuYWJsZSB0byBwcm94eSBhbiBhdHRyaWJ1dGUgdW5sZXNzIGl0IGV4aXN0c1xuICAgICAgICBvbiB0aGUgb2JqZWN0IGJlZm9yZSB0aGUgUHJveHkgaXMgY3JlYXRlZC4gVGhpcyBjaGFuZ2UgZW5zdXJlc1xuICAgICAgICBSZXNwb25zZS5ib2R5VXNlZCBleGlzdHMgb24gdGhlIGluc3RhbmNlLCB3aGlsZSBtYWludGFpbmluZyB0aGVcbiAgICAgICAgc2VtYW50aWMgb2Ygc2V0dGluZyBSZXF1ZXN0LmJvZHlVc2VkIGluIHRoZSBjb25zdHJ1Y3RvciBiZWZvcmVcbiAgICAgICAgX2luaXRCb2R5IGlzIGNhbGxlZC5cbiAgICAgICovXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1hc3NpZ25cbiAgICAgIHRoaXMuYm9keVVzZWQgPSB0aGlzLmJvZHlVc2VkO1xuICAgICAgdGhpcy5fYm9keUluaXQgPSBib2R5O1xuICAgICAgaWYgKCFib2R5KSB7XG4gICAgICAgIHRoaXMuX25vQm9keSA9IHRydWU7XG4gICAgICAgIHRoaXMuX2JvZHlUZXh0ID0gJyc7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykge1xuICAgICAgICB0aGlzLl9ib2R5VGV4dCA9IGJvZHk7XG4gICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuYmxvYiAmJiBCbG9iLnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGJvZHkpKSB7XG4gICAgICAgIHRoaXMuX2JvZHlCbG9iID0gYm9keTtcbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydC5mb3JtRGF0YSAmJiBGb3JtRGF0YS5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkge1xuICAgICAgICB0aGlzLl9ib2R5Rm9ybURhdGEgPSBib2R5O1xuICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LnNlYXJjaFBhcmFtcyAmJiBVUkxTZWFyY2hQYXJhbXMucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkpIHtcbiAgICAgICAgdGhpcy5fYm9keVRleHQgPSBib2R5LnRvU3RyaW5nKCk7XG4gICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuYXJyYXlCdWZmZXIgJiYgc3VwcG9ydC5ibG9iICYmIGlzRGF0YVZpZXcoYm9keSkpIHtcbiAgICAgICAgdGhpcy5fYm9keUFycmF5QnVmZmVyID0gYnVmZmVyQ2xvbmUoYm9keS5idWZmZXIpO1xuICAgICAgICAvLyBJRSAxMC0xMSBjYW4ndCBoYW5kbGUgYSBEYXRhVmlldyBib2R5LlxuICAgICAgICB0aGlzLl9ib2R5SW5pdCA9IG5ldyBCbG9iKFt0aGlzLl9ib2R5QXJyYXlCdWZmZXJdKTtcbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydC5hcnJheUJ1ZmZlciAmJiAoQXJyYXlCdWZmZXIucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkgfHwgaXNBcnJheUJ1ZmZlclZpZXcoYm9keSkpKSB7XG4gICAgICAgIHRoaXMuX2JvZHlBcnJheUJ1ZmZlciA9IGJ1ZmZlckNsb25lKGJvZHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fYm9keVRleHQgPSBib2R5ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGJvZHkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYm9keSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCdjb250ZW50LXR5cGUnLCAndGV4dC9wbGFpbjtjaGFyc2V0PVVURi04Jyk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm9keUJsb2IgJiYgdGhpcy5fYm9keUJsb2IudHlwZSkge1xuICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoJ2NvbnRlbnQtdHlwZScsIHRoaXMuX2JvZHlCbG9iLnR5cGUpO1xuICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuc2VhcmNoUGFyYW1zICYmIFVSTFNlYXJjaFBhcmFtcy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkge1xuICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoJ2NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD1VVEYtOCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmIChzdXBwb3J0LmJsb2IpIHtcbiAgICAgIHRoaXMuYmxvYiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcmVqZWN0ZWQgPSBjb25zdW1lZCh0aGlzKTtcbiAgICAgICAgaWYgKHJlamVjdGVkKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdGVkXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5fYm9keUJsb2IpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlCbG9iKVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IEJsb2IoW3RoaXMuX2JvZHlBcnJheUJ1ZmZlcl0pKVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlGb3JtRGF0YSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignY291bGQgbm90IHJlYWQgRm9ybURhdGEgYm9keSBhcyBibG9iJylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBCbG9iKFt0aGlzLl9ib2R5VGV4dF0pKVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cblxuICAgIHRoaXMuYXJyYXlCdWZmZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLl9ib2R5QXJyYXlCdWZmZXIpIHtcbiAgICAgICAgdmFyIGlzQ29uc3VtZWQgPSBjb25zdW1lZCh0aGlzKTtcbiAgICAgICAgaWYgKGlzQ29uc3VtZWQpIHtcbiAgICAgICAgICByZXR1cm4gaXNDb25zdW1lZFxuICAgICAgICB9IGVsc2UgaWYgKEFycmF5QnVmZmVyLmlzVmlldyh0aGlzLl9ib2R5QXJyYXlCdWZmZXIpKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShcbiAgICAgICAgICAgIHRoaXMuX2JvZHlBcnJheUJ1ZmZlci5idWZmZXIuc2xpY2UoXG4gICAgICAgICAgICAgIHRoaXMuX2JvZHlBcnJheUJ1ZmZlci5ieXRlT2Zmc2V0LFxuICAgICAgICAgICAgICB0aGlzLl9ib2R5QXJyYXlCdWZmZXIuYnl0ZU9mZnNldCArIHRoaXMuX2JvZHlBcnJheUJ1ZmZlci5ieXRlTGVuZ3RoXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5fYm9keUFycmF5QnVmZmVyKVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuYmxvYikge1xuICAgICAgICByZXR1cm4gdGhpcy5ibG9iKCkudGhlbihyZWFkQmxvYkFzQXJyYXlCdWZmZXIpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvdWxkIG5vdCByZWFkIGFzIEFycmF5QnVmZmVyJylcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy50ZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmVqZWN0ZWQgPSBjb25zdW1lZCh0aGlzKTtcbiAgICAgIGlmIChyZWplY3RlZCkge1xuICAgICAgICByZXR1cm4gcmVqZWN0ZWRcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuX2JvZHlCbG9iKSB7XG4gICAgICAgIHJldHVybiByZWFkQmxvYkFzVGV4dCh0aGlzLl9ib2R5QmxvYilcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm9keUFycmF5QnVmZmVyKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVhZEFycmF5QnVmZmVyQXNUZXh0KHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikpXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlGb3JtRGF0YSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvdWxkIG5vdCByZWFkIEZvcm1EYXRhIGJvZHkgYXMgdGV4dCcpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlUZXh0KVxuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoc3VwcG9ydC5mb3JtRGF0YSkge1xuICAgICAgdGhpcy5mb3JtRGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0KCkudGhlbihkZWNvZGUpXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRoaXMuanNvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMudGV4dCgpLnRoZW4oSlNPTi5wYXJzZSlcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIC8vIEhUVFAgbWV0aG9kcyB3aG9zZSBjYXBpdGFsaXphdGlvbiBzaG91bGQgYmUgbm9ybWFsaXplZFxuICB2YXIgbWV0aG9kcyA9IFsnQ09OTkVDVCcsICdERUxFVEUnLCAnR0VUJywgJ0hFQUQnLCAnT1BUSU9OUycsICdQQVRDSCcsICdQT1NUJywgJ1BVVCcsICdUUkFDRSddO1xuXG4gIGZ1bmN0aW9uIG5vcm1hbGl6ZU1ldGhvZChtZXRob2QpIHtcbiAgICB2YXIgdXBjYXNlZCA9IG1ldGhvZC50b1VwcGVyQ2FzZSgpO1xuICAgIHJldHVybiBtZXRob2RzLmluZGV4T2YodXBjYXNlZCkgPiAtMSA/IHVwY2FzZWQgOiBtZXRob2RcbiAgfVxuXG4gIGZ1bmN0aW9uIFJlcXVlc3QoaW5wdXQsIG9wdGlvbnMpIHtcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUmVxdWVzdCkpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1BsZWFzZSB1c2UgdGhlIFwibmV3XCIgb3BlcmF0b3IsIHRoaXMgRE9NIG9iamVjdCBjb25zdHJ1Y3RvciBjYW5ub3QgYmUgY2FsbGVkIGFzIGEgZnVuY3Rpb24uJylcbiAgICB9XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB2YXIgYm9keSA9IG9wdGlvbnMuYm9keTtcblxuICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIFJlcXVlc3QpIHtcbiAgICAgIGlmIChpbnB1dC5ib2R5VXNlZCkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBbHJlYWR5IHJlYWQnKVxuICAgICAgfVxuICAgICAgdGhpcy51cmwgPSBpbnB1dC51cmw7XG4gICAgICB0aGlzLmNyZWRlbnRpYWxzID0gaW5wdXQuY3JlZGVudGlhbHM7XG4gICAgICBpZiAoIW9wdGlvbnMuaGVhZGVycykge1xuICAgICAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSGVhZGVycyhpbnB1dC5oZWFkZXJzKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubWV0aG9kID0gaW5wdXQubWV0aG9kO1xuICAgICAgdGhpcy5tb2RlID0gaW5wdXQubW9kZTtcbiAgICAgIHRoaXMuc2lnbmFsID0gaW5wdXQuc2lnbmFsO1xuICAgICAgaWYgKCFib2R5ICYmIGlucHV0Ll9ib2R5SW5pdCAhPSBudWxsKSB7XG4gICAgICAgIGJvZHkgPSBpbnB1dC5fYm9keUluaXQ7XG4gICAgICAgIGlucHV0LmJvZHlVc2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51cmwgPSBTdHJpbmcoaW5wdXQpO1xuICAgIH1cblxuICAgIHRoaXMuY3JlZGVudGlhbHMgPSBvcHRpb25zLmNyZWRlbnRpYWxzIHx8IHRoaXMuY3JlZGVudGlhbHMgfHwgJ3NhbWUtb3JpZ2luJztcbiAgICBpZiAob3B0aW9ucy5oZWFkZXJzIHx8ICF0aGlzLmhlYWRlcnMpIHtcbiAgICAgIHRoaXMuaGVhZGVycyA9IG5ldyBIZWFkZXJzKG9wdGlvbnMuaGVhZGVycyk7XG4gICAgfVxuICAgIHRoaXMubWV0aG9kID0gbm9ybWFsaXplTWV0aG9kKG9wdGlvbnMubWV0aG9kIHx8IHRoaXMubWV0aG9kIHx8ICdHRVQnKTtcbiAgICB0aGlzLm1vZGUgPSBvcHRpb25zLm1vZGUgfHwgdGhpcy5tb2RlIHx8IG51bGw7XG4gICAgdGhpcy5zaWduYWwgPSBvcHRpb25zLnNpZ25hbCB8fCB0aGlzLnNpZ25hbCB8fCAoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCdBYm9ydENvbnRyb2xsZXInIGluIGcpIHtcbiAgICAgICAgdmFyIGN0cmwgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICAgIHJldHVybiBjdHJsLnNpZ25hbDtcbiAgICAgIH1cbiAgICB9KCkpO1xuICAgIHRoaXMucmVmZXJyZXIgPSBudWxsO1xuXG4gICAgaWYgKCh0aGlzLm1ldGhvZCA9PT0gJ0dFVCcgfHwgdGhpcy5tZXRob2QgPT09ICdIRUFEJykgJiYgYm9keSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQm9keSBub3QgYWxsb3dlZCBmb3IgR0VUIG9yIEhFQUQgcmVxdWVzdHMnKVxuICAgIH1cbiAgICB0aGlzLl9pbml0Qm9keShib2R5KTtcblxuICAgIGlmICh0aGlzLm1ldGhvZCA9PT0gJ0dFVCcgfHwgdGhpcy5tZXRob2QgPT09ICdIRUFEJykge1xuICAgICAgaWYgKG9wdGlvbnMuY2FjaGUgPT09ICduby1zdG9yZScgfHwgb3B0aW9ucy5jYWNoZSA9PT0gJ25vLWNhY2hlJykge1xuICAgICAgICAvLyBTZWFyY2ggZm9yIGEgJ18nIHBhcmFtZXRlciBpbiB0aGUgcXVlcnkgc3RyaW5nXG4gICAgICAgIHZhciByZVBhcmFtU2VhcmNoID0gLyhbPyZdKV89W14mXSovO1xuICAgICAgICBpZiAocmVQYXJhbVNlYXJjaC50ZXN0KHRoaXMudXJsKSkge1xuICAgICAgICAgIC8vIElmIGl0IGFscmVhZHkgZXhpc3RzIHRoZW4gc2V0IHRoZSB2YWx1ZSB3aXRoIHRoZSBjdXJyZW50IHRpbWVcbiAgICAgICAgICB0aGlzLnVybCA9IHRoaXMudXJsLnJlcGxhY2UocmVQYXJhbVNlYXJjaCwgJyQxXz0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE90aGVyd2lzZSBhZGQgYSBuZXcgJ18nIHBhcmFtZXRlciB0byB0aGUgZW5kIHdpdGggdGhlIGN1cnJlbnQgdGltZVxuICAgICAgICAgIHZhciByZVF1ZXJ5U3RyaW5nID0gL1xcPy87XG4gICAgICAgICAgdGhpcy51cmwgKz0gKHJlUXVlcnlTdHJpbmcudGVzdCh0aGlzLnVybCkgPyAnJicgOiAnPycpICsgJ189JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgUmVxdWVzdC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFJlcXVlc3QodGhpcywge2JvZHk6IHRoaXMuX2JvZHlJbml0fSlcbiAgfTtcblxuICBmdW5jdGlvbiBkZWNvZGUoYm9keSkge1xuICAgIHZhciBmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgYm9keVxuICAgICAgLnRyaW0oKVxuICAgICAgLnNwbGl0KCcmJylcbiAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uKGJ5dGVzKSB7XG4gICAgICAgIGlmIChieXRlcykge1xuICAgICAgICAgIHZhciBzcGxpdCA9IGJ5dGVzLnNwbGl0KCc9Jyk7XG4gICAgICAgICAgdmFyIG5hbWUgPSBzcGxpdC5zaGlmdCgpLnJlcGxhY2UoL1xcKy9nLCAnICcpO1xuICAgICAgICAgIHZhciB2YWx1ZSA9IHNwbGl0LmpvaW4oJz0nKS5yZXBsYWNlKC9cXCsvZywgJyAnKTtcbiAgICAgICAgICBmb3JtLmFwcGVuZChkZWNvZGVVUklDb21wb25lbnQobmFtZSksIGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICByZXR1cm4gZm9ybVxuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VIZWFkZXJzKHJhd0hlYWRlcnMpIHtcbiAgICB2YXIgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCk7XG4gICAgLy8gUmVwbGFjZSBpbnN0YW5jZXMgb2YgXFxyXFxuIGFuZCBcXG4gZm9sbG93ZWQgYnkgYXQgbGVhc3Qgb25lIHNwYWNlIG9yIGhvcml6b250YWwgdGFiIHdpdGggYSBzcGFjZVxuICAgIC8vIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM3MjMwI3NlY3Rpb24tMy4yXG4gICAgdmFyIHByZVByb2Nlc3NlZEhlYWRlcnMgPSByYXdIZWFkZXJzLnJlcGxhY2UoL1xccj9cXG5bXFx0IF0rL2csICcgJyk7XG4gICAgLy8gQXZvaWRpbmcgc3BsaXQgdmlhIHJlZ2V4IHRvIHdvcmsgYXJvdW5kIGEgY29tbW9uIElFMTEgYnVnIHdpdGggdGhlIGNvcmUtanMgMy42LjAgcmVnZXggcG9seWZpbGxcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ2l0aHViL2ZldGNoL2lzc3Vlcy83NDhcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvNzUxXG4gICAgcHJlUHJvY2Vzc2VkSGVhZGVyc1xuICAgICAgLnNwbGl0KCdcXHInKVxuICAgICAgLm1hcChmdW5jdGlvbihoZWFkZXIpIHtcbiAgICAgICAgcmV0dXJuIGhlYWRlci5pbmRleE9mKCdcXG4nKSA9PT0gMCA/IGhlYWRlci5zdWJzdHIoMSwgaGVhZGVyLmxlbmd0aCkgOiBoZWFkZXJcbiAgICAgIH0pXG4gICAgICAuZm9yRWFjaChmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIHZhciBwYXJ0cyA9IGxpbmUuc3BsaXQoJzonKTtcbiAgICAgICAgdmFyIGtleSA9IHBhcnRzLnNoaWZ0KCkudHJpbSgpO1xuICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgdmFyIHZhbHVlID0gcGFydHMuam9pbignOicpLnRyaW0oKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignUmVzcG9uc2UgJyArIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgcmV0dXJuIGhlYWRlcnNcbiAgfVxuXG4gIEJvZHkuY2FsbChSZXF1ZXN0LnByb3RvdHlwZSk7XG5cbiAgZnVuY3Rpb24gUmVzcG9uc2UoYm9keUluaXQsIG9wdGlvbnMpIHtcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUmVzcG9uc2UpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdQbGVhc2UgdXNlIHRoZSBcIm5ld1wiIG9wZXJhdG9yLCB0aGlzIERPTSBvYmplY3QgY29uc3RydWN0b3IgY2Fubm90IGJlIGNhbGxlZCBhcyBhIGZ1bmN0aW9uLicpXG4gICAgfVxuICAgIGlmICghb3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cblxuICAgIHRoaXMudHlwZSA9ICdkZWZhdWx0JztcbiAgICB0aGlzLnN0YXR1cyA9IG9wdGlvbnMuc3RhdHVzID09PSB1bmRlZmluZWQgPyAyMDAgOiBvcHRpb25zLnN0YXR1cztcbiAgICBpZiAodGhpcy5zdGF0dXMgPCAyMDAgfHwgdGhpcy5zdGF0dXMgPiA1OTkpIHtcbiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKFwiRmFpbGVkIHRvIGNvbnN0cnVjdCAnUmVzcG9uc2UnOiBUaGUgc3RhdHVzIHByb3ZpZGVkICgwKSBpcyBvdXRzaWRlIHRoZSByYW5nZSBbMjAwLCA1OTldLlwiKVxuICAgIH1cbiAgICB0aGlzLm9rID0gdGhpcy5zdGF0dXMgPj0gMjAwICYmIHRoaXMuc3RhdHVzIDwgMzAwO1xuICAgIHRoaXMuc3RhdHVzVGV4dCA9IG9wdGlvbnMuc3RhdHVzVGV4dCA9PT0gdW5kZWZpbmVkID8gJycgOiAnJyArIG9wdGlvbnMuc3RhdHVzVGV4dDtcbiAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSGVhZGVycyhvcHRpb25zLmhlYWRlcnMpO1xuICAgIHRoaXMudXJsID0gb3B0aW9ucy51cmwgfHwgJyc7XG4gICAgdGhpcy5faW5pdEJvZHkoYm9keUluaXQpO1xuICB9XG5cbiAgQm9keS5jYWxsKFJlc3BvbnNlLnByb3RvdHlwZSk7XG5cbiAgUmVzcG9uc2UucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZSh0aGlzLl9ib2R5SW5pdCwge1xuICAgICAgc3RhdHVzOiB0aGlzLnN0YXR1cyxcbiAgICAgIHN0YXR1c1RleHQ6IHRoaXMuc3RhdHVzVGV4dCxcbiAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHRoaXMuaGVhZGVycyksXG4gICAgICB1cmw6IHRoaXMudXJsXG4gICAgfSlcbiAgfTtcblxuICBSZXNwb25zZS5lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciByZXNwb25zZSA9IG5ldyBSZXNwb25zZShudWxsLCB7c3RhdHVzOiAyMDAsIHN0YXR1c1RleHQ6ICcnfSk7XG4gICAgcmVzcG9uc2Uub2sgPSBmYWxzZTtcbiAgICByZXNwb25zZS5zdGF0dXMgPSAwO1xuICAgIHJlc3BvbnNlLnR5cGUgPSAnZXJyb3InO1xuICAgIHJldHVybiByZXNwb25zZVxuICB9O1xuXG4gIHZhciByZWRpcmVjdFN0YXR1c2VzID0gWzMwMSwgMzAyLCAzMDMsIDMwNywgMzA4XTtcblxuICBSZXNwb25zZS5yZWRpcmVjdCA9IGZ1bmN0aW9uKHVybCwgc3RhdHVzKSB7XG4gICAgaWYgKHJlZGlyZWN0U3RhdHVzZXMuaW5kZXhPZihzdGF0dXMpID09PSAtMSkge1xuICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0ludmFsaWQgc3RhdHVzIGNvZGUnKVxuICAgIH1cblxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UobnVsbCwge3N0YXR1czogc3RhdHVzLCBoZWFkZXJzOiB7bG9jYXRpb246IHVybH19KVxuICB9O1xuXG4gIGV4cG9ydHMuRE9NRXhjZXB0aW9uID0gZy5ET01FeGNlcHRpb247XG4gIHRyeSB7XG4gICAgbmV3IGV4cG9ydHMuRE9NRXhjZXB0aW9uKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGV4cG9ydHMuRE9NRXhjZXB0aW9uID0gZnVuY3Rpb24obWVzc2FnZSwgbmFtZSkge1xuICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICB2YXIgZXJyb3IgPSBFcnJvcihtZXNzYWdlKTtcbiAgICAgIHRoaXMuc3RhY2sgPSBlcnJvci5zdGFjaztcbiAgICB9O1xuICAgIGV4cG9ydHMuRE9NRXhjZXB0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlKTtcbiAgICBleHBvcnRzLkRPTUV4Y2VwdGlvbi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBleHBvcnRzLkRPTUV4Y2VwdGlvbjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZldGNoKGlucHV0LCBpbml0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgUmVxdWVzdChpbnB1dCwgaW5pdCk7XG5cbiAgICAgIGlmIChyZXF1ZXN0LnNpZ25hbCAmJiByZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgIHJldHVybiByZWplY3QobmV3IGV4cG9ydHMuRE9NRXhjZXB0aW9uKCdBYm9ydGVkJywgJ0Fib3J0RXJyb3InKSlcbiAgICAgIH1cblxuICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgICBmdW5jdGlvbiBhYm9ydFhocigpIHtcbiAgICAgICAgeGhyLmFib3J0KCk7XG4gICAgICB9XG5cbiAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHQsXG4gICAgICAgICAgaGVhZGVyczogcGFyc2VIZWFkZXJzKHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSB8fCAnJylcbiAgICAgICAgfTtcbiAgICAgICAgLy8gVGhpcyBjaGVjayBpZiBzcGVjaWZpY2FsbHkgZm9yIHdoZW4gYSB1c2VyIGZldGNoZXMgYSBmaWxlIGxvY2FsbHkgZnJvbSB0aGUgZmlsZSBzeXN0ZW1cbiAgICAgICAgLy8gT25seSBpZiB0aGUgc3RhdHVzIGlzIG91dCBvZiBhIG5vcm1hbCByYW5nZVxuICAgICAgICBpZiAocmVxdWVzdC51cmwuaW5kZXhPZignZmlsZTovLycpID09PSAwICYmICh4aHIuc3RhdHVzIDwgMjAwIHx8IHhoci5zdGF0dXMgPiA1OTkpKSB7XG4gICAgICAgICAgb3B0aW9ucy5zdGF0dXMgPSAyMDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb3B0aW9ucy5zdGF0dXMgPSB4aHIuc3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIG9wdGlvbnMudXJsID0gJ3Jlc3BvbnNlVVJMJyBpbiB4aHIgPyB4aHIucmVzcG9uc2VVUkwgOiBvcHRpb25zLmhlYWRlcnMuZ2V0KCdYLVJlcXVlc3QtVVJMJyk7XG4gICAgICAgIHZhciBib2R5ID0gJ3Jlc3BvbnNlJyBpbiB4aHIgPyB4aHIucmVzcG9uc2UgOiB4aHIucmVzcG9uc2VUZXh0O1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJlc29sdmUobmV3IFJlc3BvbnNlKGJvZHksIG9wdGlvbnMpKTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9O1xuXG4gICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJlamVjdChuZXcgVHlwZUVycm9yKCdOZXR3b3JrIHJlcXVlc3QgZmFpbGVkJykpO1xuICAgICAgICB9LCAwKTtcbiAgICAgIH07XG5cbiAgICAgIHhoci5vbnRpbWVvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICByZWplY3QobmV3IFR5cGVFcnJvcignTmV0d29yayByZXF1ZXN0IHRpbWVkIG91dCcpKTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9O1xuXG4gICAgICB4aHIub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJlamVjdChuZXcgZXhwb3J0cy5ET01FeGNlcHRpb24oJ0Fib3J0ZWQnLCAnQWJvcnRFcnJvcicpKTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9O1xuXG4gICAgICBmdW5jdGlvbiBmaXhVcmwodXJsKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0dXJuIHVybCA9PT0gJycgJiYgZy5sb2NhdGlvbi5ocmVmID8gZy5sb2NhdGlvbi5ocmVmIDogdXJsXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICByZXR1cm4gdXJsXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgeGhyLm9wZW4ocmVxdWVzdC5tZXRob2QsIGZpeFVybChyZXF1ZXN0LnVybCksIHRydWUpO1xuXG4gICAgICBpZiAocmVxdWVzdC5jcmVkZW50aWFscyA9PT0gJ2luY2x1ZGUnKSB7XG4gICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0LmNyZWRlbnRpYWxzID09PSAnb21pdCcpIHtcbiAgICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAoJ3Jlc3BvbnNlVHlwZScgaW4geGhyKSB7XG4gICAgICAgIGlmIChzdXBwb3J0LmJsb2IpIHtcbiAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2Jsb2InO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIHN1cHBvcnQuYXJyYXlCdWZmZXJcbiAgICAgICAgKSB7XG4gICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGluaXQgJiYgdHlwZW9mIGluaXQuaGVhZGVycyA9PT0gJ29iamVjdCcgJiYgIShpbml0LmhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzIHx8IChnLkhlYWRlcnMgJiYgaW5pdC5oZWFkZXJzIGluc3RhbmNlb2YgZy5IZWFkZXJzKSkpIHtcbiAgICAgICAgdmFyIG5hbWVzID0gW107XG4gICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGluaXQuaGVhZGVycykuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgbmFtZXMucHVzaChub3JtYWxpemVOYW1lKG5hbWUpKTtcbiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihuYW1lLCBub3JtYWxpemVWYWx1ZShpbml0LmhlYWRlcnNbbmFtZV0pKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJlcXVlc3QuaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG4gICAgICAgICAgaWYgKG5hbWVzLmluZGV4T2YobmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcXVlc3QuaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG4gICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIobmFtZSwgdmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlcXVlc3Quc2lnbmFsKSB7XG4gICAgICAgIHJlcXVlc3Quc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgYWJvcnRYaHIpO1xuXG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAvLyBET05FIChzdWNjZXNzIG9yIGZhaWx1cmUpXG4gICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIGFib3J0WGhyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHhoci5zZW5kKHR5cGVvZiByZXF1ZXN0Ll9ib2R5SW5pdCA9PT0gJ3VuZGVmaW5lZCcgPyBudWxsIDogcmVxdWVzdC5fYm9keUluaXQpO1xuICAgIH0pXG4gIH1cblxuICBmZXRjaC5wb2x5ZmlsbCA9IHRydWU7XG5cbiAgaWYgKCFnLmZldGNoKSB7XG4gICAgZy5mZXRjaCA9IGZldGNoO1xuICAgIGcuSGVhZGVycyA9IEhlYWRlcnM7XG4gICAgZy5SZXF1ZXN0ID0gUmVxdWVzdDtcbiAgICBnLlJlc3BvbnNlID0gUmVzcG9uc2U7XG4gIH1cblxuICBleHBvcnRzLkhlYWRlcnMgPSBIZWFkZXJzO1xuICBleHBvcnRzLlJlcXVlc3QgPSBSZXF1ZXN0O1xuICBleHBvcnRzLlJlc3BvbnNlID0gUmVzcG9uc2U7XG4gIGV4cG9ydHMuZmV0Y2ggPSBmZXRjaDtcblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuXG4gIHJldHVybiBleHBvcnRzO1xuXG59KSh7fSk7XG59KShfX2dsb2JhbFRoaXNfXyk7XG4vLyBUaGlzIGlzIGEgcG9ueWZpbGwsIHNvLi4uXG5fX2dsb2JhbFRoaXNfXy5mZXRjaC5wb255ZmlsbCA9IHRydWU7XG5kZWxldGUgX19nbG9iYWxUaGlzX18uZmV0Y2gucG9seWZpbGw7XG4vLyBDaG9vc2UgYmV0d2VlbiBuYXRpdmUgaW1wbGVtZW50YXRpb24gKF9fZ2xvYmFsX18pIG9yIGN1c3RvbSBpbXBsZW1lbnRhdGlvbiAoX19nbG9iYWxUaGlzX18pXG52YXIgY3R4ID0gX19nbG9iYWxfXy5mZXRjaCA/IF9fZ2xvYmFsX18gOiBfX2dsb2JhbFRoaXNfXztcbmV4cG9ydHMgPSBjdHguZmV0Y2ggLy8gVG8gZW5hYmxlOiBpbXBvcnQgZmV0Y2ggZnJvbSAnY3Jvc3MtZmV0Y2gnXG5leHBvcnRzLmRlZmF1bHQgPSBjdHguZmV0Y2ggLy8gRm9yIFR5cGVTY3JpcHQgY29uc3VtZXJzIHdpdGhvdXQgZXNNb2R1bGVJbnRlcm9wLlxuZXhwb3J0cy5mZXRjaCA9IGN0eC5mZXRjaCAvLyBUbyBlbmFibGU6IGltcG9ydCB7ZmV0Y2h9IGZyb20gJ2Nyb3NzLWZldGNoJ1xuZXhwb3J0cy5IZWFkZXJzID0gY3R4LkhlYWRlcnNcbmV4cG9ydHMuUmVxdWVzdCA9IGN0eC5SZXF1ZXN0XG5leHBvcnRzLlJlc3BvbnNlID0gY3R4LlJlc3BvbnNlXG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNcbiIsIi8qKlxuICogUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCBhcyBsb25nIGFzIGl0IGNvbnRpbnVlcyB0byBiZSBpbnZva2VkLCB3aWxsIG5vdFxuICogYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvclxuICogTiBtaWxsaXNlY29uZHMuIElmIGBpbW1lZGlhdGVgIGlzIHBhc3NlZCwgdHJpZ2dlciB0aGUgZnVuY3Rpb24gb24gdGhlXG4gKiBsZWFkaW5nIGVkZ2UsIGluc3RlYWQgb2YgdGhlIHRyYWlsaW5nLiBUaGUgZnVuY3Rpb24gYWxzbyBoYXMgYSBwcm9wZXJ0eSAnY2xlYXInIFxuICogdGhhdCBpcyBhIGZ1bmN0aW9uIHdoaWNoIHdpbGwgY2xlYXIgdGhlIHRpbWVyIHRvIHByZXZlbnQgcHJldmlvdXNseSBzY2hlZHVsZWQgZXhlY3V0aW9ucy4gXG4gKlxuICogQHNvdXJjZSB1bmRlcnNjb3JlLmpzXG4gKiBAc2VlIGh0dHA6Ly91bnNjcmlwdGFibGUuY29tLzIwMDkvMDMvMjAvZGVib3VuY2luZy1qYXZhc2NyaXB0LW1ldGhvZHMvXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jdGlvbiB0byB3cmFwXG4gKiBAcGFyYW0ge051bWJlcn0gdGltZW91dCBpbiBtcyAoYDEwMGApXG4gKiBAcGFyYW0ge0Jvb2xlYW59IHdoZXRoZXIgdG8gZXhlY3V0ZSBhdCB0aGUgYmVnaW5uaW5nIChgZmFsc2VgKVxuICogQGFwaSBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gZGVib3VuY2UoZnVuYywgd2FpdCwgaW1tZWRpYXRlKXtcbiAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0O1xuICBpZiAobnVsbCA9PSB3YWl0KSB3YWl0ID0gMTAwO1xuXG4gIGZ1bmN0aW9uIGxhdGVyKCkge1xuICAgIHZhciBsYXN0ID0gRGF0ZS5ub3coKSAtIHRpbWVzdGFtcDtcblxuICAgIGlmIChsYXN0IDwgd2FpdCAmJiBsYXN0ID49IDApIHtcbiAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0IC0gbGFzdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgaWYgKCFpbW1lZGlhdGUpIHtcbiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgY29udGV4dCA9IGFyZ3MgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB2YXIgZGVib3VuY2VkID0gZnVuY3Rpb24oKXtcbiAgICBjb250ZXh0ID0gdGhpcztcbiAgICBhcmdzID0gYXJndW1lbnRzO1xuICAgIHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG4gICAgdmFyIGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7XG4gICAgaWYgKCF0aW1lb3V0KSB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XG4gICAgaWYgKGNhbGxOb3cpIHtcbiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBkZWJvdW5jZWQuY2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgfVxuICB9O1xuICBcbiAgZGVib3VuY2VkLmZsdXNoID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7XG4gICAgICBcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gZGVib3VuY2VkO1xufTtcblxuLy8gQWRkcyBjb21wYXRpYmlsaXR5IGZvciBFUyBtb2R1bGVzXG5kZWJvdW5jZS5kZWJvdW5jZSA9IGRlYm91bmNlO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGRlYm91bmNlO1xuIiwiY29uc3QgcmVnZXhDbG9zZVNxdWFyZUJyYWNrZXQgPSAvXXxeXFxbL2dcbmNvbnN0IHJlZ2V4T3BlblNxdWFyZUJyYWNrZXQgPSAvXFwuP1xcWy9nXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iamVjdCwgcGF0aCwgZGVmYXVsdFZhbHVlKSB7XG4gIC8vIEhhbmRsZSB0aGUgY2FzZSB0aGF0IHRoZSBvYmplY3QgaXMgdW5kZWZpbmVkIG9yIG5vdCBhbiBvYmplY3RcbiAgaWYgKCFvYmplY3QgfHwgT2JqZWN0KG9iamVjdCkgIT09IG9iamVjdCkge1xuICAgIHJldHVybiBkZWZhdWx0VmFsdWVcbiAgfVxuXG4gIC8vIEEpIElmIHRoZSBwYXRoIGlzIGFuIGFycmF5LCB3ZSBjYW4ganVzdCB1c2UgdGhhdFxuICAvLyBCKSBJZiB0aGUgcGF0aCBpcyBhIHN0cmluZywgY29udmVydCBpdCBpbnRvIGFuIGFycmF5IGJ5IG1pZ3JhdGluZ1xuICAvLyAgICBhcnJheS1zdHlsZSBgW2Zvb11gIGFjY2Vzc29ycyBpbnRvIG9iamVjdC1zdHlsZSBgLmZvb2AgYWNjZXNzb3JzXG4gIGNvbnN0IGNsZWFuUGF0aCA9IEFycmF5LmlzQXJyYXkocGF0aClcbiAgICA/IHBhdGhcbiAgICA6IHBhdGgucmVwbGFjZShyZWdleENsb3NlU3F1YXJlQnJhY2tldCwgJycpLnJlcGxhY2UocmVnZXhPcGVuU3F1YXJlQnJhY2tldCwgJy4nKS5zcGxpdCgnLicpXG5cbiAgcmV0dXJuIGdldChvYmplY3QsIGNsZWFuUGF0aCwgZGVmYXVsdFZhbHVlKVxufVxuXG5mdW5jdGlvbiBnZXQgKG9iamVjdCwgcGF0aCwgZGVmYXVsdFZhbHVlKSB7XG4gIGxldCBjdXJyZW50ID0gb2JqZWN0XG5cbiAgZm9yIChjb25zdCBzZWdtZW50IG9mIHBhdGgpIHtcbiAgICBjdXJyZW50ID0gY3VycmVudFtzZWdtZW50XVxuXG4gICAgaWYgKGN1cnJlbnQgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdXJyZW50XG59XG4iLCJjb25zdCBkZWJvdW5jZSA9IHJlcXVpcmUoJ2RlYm91bmNlJylcbmNvbnN0IGlkYktleXZhbCA9IHJlcXVpcmUoJ2lkYi1rZXl2YWwnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChjb25maWd1cmF0aW9uKSB7XG4gIGNvbmZpZ3VyYXRpb24gPSBPYmplY3QuYXNzaWduKHtcbiAgICBzdG9yYWdlS2V5OiAnZ3cyYXBpLWNhY2hlJyxcbiAgICBnY1RpY2s6IDUgKiA2MCAqIDEwMDAsXG4gICAgcGVyc2lzdERlYm91bmNlOiAzICogMTAwMCxcbiAgICBzdG9yYWdlRW5naW5lOiBpZGJLZXl2YWxcbiAgfSwgY29uZmlndXJhdGlvbilcblxuICBsZXQgX3N0b3JhZ2UgPSB7fVxuICBjb25zdCBzdG9yYWdlRW5naW5lID0gY29uZmlndXJhdGlvbi5zdG9yYWdlRW5naW5lXG4gIGNvbnN0IHN0b3JhZ2VLZXkgPSBjb25maWd1cmF0aW9uLnN0b3JhZ2VLZXlcbiAgY29uc3QgcGVyc2lzdCA9IGRlYm91bmNlKF9wZXJzaXN0LCBjb25maWd1cmF0aW9uLnBlcnNpc3REZWJvdW5jZSlcblxuICBmdW5jdGlvbiBnZXQgKGtleSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoX2dldChrZXkpKVxuICB9XG5cbiAgZnVuY3Rpb24gc2V0IChrZXksIHZhbHVlLCBleHBpcnkpIHtcbiAgICBfc2V0KGtleSwgdmFsdWUsIGV4cGlyeSlcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpXG4gIH1cblxuICBmdW5jdGlvbiBtZ2V0IChrZXlzKSB7XG4gICAgbGV0IHZhbHVlcyA9IGtleXMubWFwKGtleSA9PiBfZ2V0KGtleSkpXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZXMpXG4gIH1cblxuICBmdW5jdGlvbiBtc2V0ICh2YWx1ZXMpIHtcbiAgICB2YWx1ZXMubWFwKHZhbHVlID0+IHtcbiAgICAgIF9zZXQodmFsdWVbMF0sIHZhbHVlWzFdLCB2YWx1ZVsyXSlcbiAgICB9KVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxuICB9XG5cbiAgZnVuY3Rpb24gX2dldCAoa2V5KSB7XG4gICAgbGV0IHZhbHVlID0gX3N0b3JhZ2Vba2V5XVxuICAgIGxldCBub3cgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpXG4gICAgcmV0dXJuIHZhbHVlICYmIHZhbHVlLmV4cGlyeSA+IG5vdyA/IHZhbHVlLnZhbHVlIDogbnVsbFxuICB9XG5cbiAgZnVuY3Rpb24gX3NldCAoa2V5LCB2YWx1ZSwgZXhwaXJ5KSB7XG4gICAgX3N0b3JhZ2Vba2V5XSA9IHsgdmFsdWUsIGV4cGlyeTogKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArIGV4cGlyeSAqIDEwMDAgfVxuICAgIHBlcnNpc3QoKVxuICB9XG5cbiAgZnVuY3Rpb24gX3BlcnNpc3QgKCkge1xuICAgIHN0b3JhZ2VFbmdpbmUuc2V0KHN0b3JhZ2VLZXksIF9zdG9yYWdlKVxuICAgICAgLmNhdGNoKC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovIGVyciA9PiB7XG4gICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHBlcnNpc3RpbmcgY2FjaGUnLCBlcnIpXG4gICAgICB9KVxuICB9XG5cbiAgZnVuY3Rpb24gaHlkcmF0ZSAoKSB7XG4gICAgc3RvcmFnZUVuZ2luZS5nZXQoc3RvcmFnZUtleSlcbiAgICAgIC50aGVuKHZhbHVlID0+IHtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgX3N0b3JhZ2UgPSB2YWx1ZVxuICAgICAgICB9XG4gICAgICB9KVxuICB9XG5cbiAgZnVuY3Rpb24gZmx1c2ggKCkge1xuICAgIF9zdG9yYWdlID0ge31cbiAgICBzdG9yYWdlRW5naW5lLmRlbGV0ZShzdG9yYWdlS2V5KVxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSlcbiAgfVxuXG4gIGZ1bmN0aW9uIF9nZXRTdG9yYWdlICgpIHtcbiAgICByZXR1cm4gX3N0b3JhZ2VcbiAgfVxuXG4gIGZ1bmN0aW9uIGdhcmJhZ2VDb2xsZWN0aW9uICgpIHtcbiAgICBjb25zdCBub3cgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpXG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKF9zdG9yYWdlKVxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChfc3RvcmFnZVtrZXlzW2ldXS5leHBpcnkgPCBub3cpIHtcbiAgICAgICAgZGVsZXRlIF9zdG9yYWdlW2tleXNbaV1dXG4gICAgICB9XG4gICAgfVxuXG4gICAgcGVyc2lzdCgpXG4gIH1cblxuICBzZXRJbnRlcnZhbChnYXJiYWdlQ29sbGVjdGlvbiwgY29uZmlndXJhdGlvbi5nY1RpY2spXG4gIGh5ZHJhdGUoKVxuICBnYXJiYWdlQ29sbGVjdGlvbigpXG5cbiAgcmV0dXJuIHsgZ2V0LCBzZXQsIG1nZXQsIG1zZXQsIGZsdXNoLCBfZ2V0U3RvcmFnZSB9XG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChjb25maWd1cmF0aW9uKSB7XG4gIGNvbmZpZ3VyYXRpb24gPSBPYmplY3QuYXNzaWduKHtcbiAgICBnY1RpY2s6IDUgKiA2MCAqIDEwMDBcbiAgfSwgY29uZmlndXJhdGlvbilcblxuICAvLyBTY29wZSB0aGUgc3RvcmFnZSB0byB0aGUgZnVuY3Rpb24sIHNvIG11bHRpcGxlIGluc3RhbmNlcyBkb24ndCBpbnRlcmZlcmVcbiAgbGV0IF9zdG9yYWdlID0ge31cblxuICBmdW5jdGlvbiBnZXQgKGtleSkge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoX2dldChrZXkpKVxuICB9XG5cbiAgZnVuY3Rpb24gX2dldCAoa2V5KSB7XG4gICAgbGV0IHZhbHVlID0gX3N0b3JhZ2Vba2V5XVxuICAgIGxldCBub3cgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpXG4gICAgcmV0dXJuIHZhbHVlICYmIHZhbHVlLmV4cGlyeSA+IG5vdyA/IHZhbHVlLnZhbHVlIDogbnVsbFxuICB9XG5cbiAgZnVuY3Rpb24gc2V0IChrZXksIHZhbHVlLCBleHBpcnkpIHtcbiAgICBfc2V0KGtleSwgdmFsdWUsIGV4cGlyeSlcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpXG4gIH1cblxuICBmdW5jdGlvbiBfc2V0IChrZXksIHZhbHVlLCBleHBpcnkpIHtcbiAgICBfc3RvcmFnZVtrZXldID0geyB2YWx1ZSwgZXhwaXJ5OiAobmV3IERhdGUoKSkuZ2V0VGltZSgpICsgZXhwaXJ5ICogMTAwMCB9XG4gIH1cblxuICBmdW5jdGlvbiBtZ2V0IChrZXlzKSB7XG4gICAgbGV0IHZhbHVlcyA9IGtleXMubWFwKGtleSA9PiBfZ2V0KGtleSkpXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZXMpXG4gIH1cblxuICBmdW5jdGlvbiBtc2V0ICh2YWx1ZXMpIHtcbiAgICB2YWx1ZXMubWFwKHZhbHVlID0+IHtcbiAgICAgIF9zZXQodmFsdWVbMF0sIHZhbHVlWzFdLCB2YWx1ZVsyXSlcbiAgICB9KVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxuICB9XG5cbiAgZnVuY3Rpb24gZmx1c2ggKCkge1xuICAgIF9zdG9yYWdlID0ge31cbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpXG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0U3RvcmFnZSAoKSB7XG4gICAgcmV0dXJuIF9zdG9yYWdlXG4gIH1cblxuICBmdW5jdGlvbiBnYXJiYWdlQ29sbGVjdGlvbiAoKSB7XG4gICAgY29uc3Qgbm93ID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKVxuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhfc3RvcmFnZSlcblxuICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoX3N0b3JhZ2Vba2V5c1tpXV0uZXhwaXJ5IDwgbm93KSB7XG4gICAgICAgIGRlbGV0ZSBfc3RvcmFnZVtrZXlzW2ldXVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNldEludGVydmFsKGdhcmJhZ2VDb2xsZWN0aW9uLCBjb25maWd1cmF0aW9uLmdjVGljaylcbiAgZ2FyYmFnZUNvbGxlY3Rpb24oKVxuXG4gIHJldHVybiB7IGdldCwgc2V0LCBtZ2V0LCBtc2V0LCBmbHVzaCwgX2dldFN0b3JhZ2UgfVxufVxuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB7IGdldCwgc2V0LCBtZ2V0LCBtc2V0LCBmbHVzaCB9XG59XG5cbmZ1bmN0aW9uIGdldCAoKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbClcbn1cblxuZnVuY3Rpb24gc2V0ICgpIHtcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxufVxuXG5mdW5jdGlvbiBtZ2V0IChrZXlzKSB7XG4gIGNvbnN0IHZhbHVlcyA9IGtleXMubWFwKHggPT4gbnVsbClcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZXMpXG59XG5cbmZ1bmN0aW9uIG1zZXQgKCkge1xuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpXG59XG5cbmZ1bmN0aW9uIGZsdXNoICgpIHtcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxufVxuIiwiY29uc3QgZmV0Y2ggPSByZXF1aXJlKCdsZXRzLWZldGNoJylcbmNvbnN0IG51bGxDYWNoZSA9IHJlcXVpcmUoJy4vY2FjaGUvbnVsbCcpXG5jb25zdCBlbmRwb2ludHMgPSByZXF1aXJlKCcuL2VuZHBvaW50cycpXG5jb25zdCBmbG93ID0gcmVxdWlyZSgnLi9mbG93JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBDbGllbnQge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5zY2hlbWFWZXJzaW9uID0gJzIwMTktMDMtMjBUMDA6MDA6MDAuMDAwWidcbiAgICB0aGlzLmxhbmcgPSAnZW4nXG4gICAgdGhpcy5hcGlLZXkgPSBmYWxzZVxuICAgIHRoaXMuZmV0Y2ggPSBmZXRjaFxuICAgIHRoaXMuY2FjaGVzID0gW251bGxDYWNoZSgpXVxuICAgIHRoaXMuZGVidWcgPSBmYWxzZVxuICAgIHRoaXMuY2xpZW50ID0gdGhpc1xuICB9XG5cbiAgLy8gU2V0IHRoZSBzY2hlbWEgdmVyc2lvblxuICBzY2hlbWEgKHNjaGVtYSkge1xuICAgIHRoaXMuc2NoZW1hVmVyc2lvbiA9IHNjaGVtYVxuICAgIHRoaXMuZGVidWdNZXNzYWdlKGBzZXQgdGhlIHNjaGVtYSB0byAke3NjaGVtYX1gKVxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICAvLyBTZXQgdGhlIGxhbmd1YWdlIGZvciBsb2NhbGUtYXdhcmUgZW5kcG9pbnRzXG4gIGxhbmd1YWdlIChsYW5nKSB7XG4gICAgdGhpcy5sYW5nID0gbGFuZ1xuICAgIHRoaXMuZGVidWdNZXNzYWdlKGBzZXQgdGhlIGxhbmd1YWdlIHRvICR7bGFuZ31gKVxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICAvLyBTZXQgdGhlIGFwaSBrZXkgZm9yIGF1dGhlbnRpY2F0ZWQgZW5kcG9pbnRzXG4gIGF1dGhlbnRpY2F0ZSAoYXBpS2V5KSB7XG4gICAgdGhpcy5hcGlLZXkgPSBhcGlLZXlcbiAgICB0aGlzLmRlYnVnTWVzc2FnZShgc2V0IHRoZSBhcGkga2V5IHRvICR7YXBpS2V5fWApXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIC8vIFNldCB0aGUgY2FjaGluZyBzdG9yYWdlIG1ldGhvZChzKVxuICBjYWNoZVN0b3JhZ2UgKGNhY2hlcykge1xuICAgIHRoaXMuY2FjaGVzID0gW10uY29uY2F0KGNhY2hlcylcbiAgICB0aGlzLmRlYnVnTWVzc2FnZShgdXBkYXRlZCB0aGUgY2FjaGUgc3RvcmFnZWApXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIC8vIFNldCB0aGUgZGVidWdnaW5nIGZsYWdcbiAgZGVidWdnaW5nIChmbGFnKSB7XG4gICAgdGhpcy5kZWJ1ZyA9IGZsYWdcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgLy8gUHJpbnQgb3V0IGEgZGVidWcgbWVzc2FnZSBpZiBkZWJ1Z2dpbmcgaXMgZW5hYmxlZFxuICBkZWJ1Z01lc3NhZ2UgKHN0cmluZykge1xuICAgIGlmICh0aGlzLmRlYnVnKSB7XG4gICAgICBjb25zb2xlLmxvZyhgW2d3MmFwaS1jbGllbnRdICR7c3RyaW5nfWApXG4gICAgfVxuICB9XG5cbiAgLy8gTWFrZSBzdXJlIHdlIGdldCB0aGUgbmV3IGNvbnRlbnQgaWYgdGhlIGdhbWUgdXBkYXRlc1xuICBmbHVzaENhY2hlSWZHYW1lVXBkYXRlZCAoKSB7XG4gICAgY29uc3QgYnVpbGRFbmRwb2ludCA9IHRoaXMuYnVpbGQoKVxuICAgIGNvbnN0IHByb21pc2VzID0ge1xuICAgICAgY2FjaGVCdWlsZElkOiAoKSA9PiBidWlsZEVuZHBvaW50Ll9jYWNoZUdldFNpbmdsZSgnY2FjaGVCdWlsZElkJyksXG4gICAgICBidWlsZElkOiAoKSA9PiBidWlsZEVuZHBvaW50LmxpdmUoKS5nZXQoKVxuICAgIH1cblxuICAgIHJldHVybiBmbG93LnBhcmFsbGVsKHByb21pc2VzKS50aGVuKHJlc3AgPT4ge1xuICAgICAgbGV0IGZsdXNoUHJvbWlzZXMgPSBbXVxuXG4gICAgICAvLyBGbHVzaCB0aGUgY2FjaGVzIGlmIHRoZSBjYWNoZWQgYnVpbGQgaWQgaXMgc2V0IChhcyBhIHNhZmV0eSBtZWFzdXJlKVxuICAgICAgLy8gYW5kIHRoZSBjYWNoZWQgYnVpbGQgaWQgaXMgb2xkZXIgdGhhbiB0aGUgY3VycmVudCBvbmVcbiAgICAgIGlmIChyZXNwLmNhY2hlQnVpbGRJZCAmJiByZXNwLmNhY2hlQnVpbGRJZCA8IHJlc3AuYnVpbGRJZCkge1xuICAgICAgICB0aGlzLmRlYnVnTWVzc2FnZShgZmx1c2hpbmcgdGhlIGNhY2hlIGJlY2F1c2Ugb2YgYSBuZXcgYnVpbGRgKVxuICAgICAgICBmbHVzaFByb21pc2VzID0gdGhpcy5jYWNoZXMubWFwKGNhY2hlID0+ICgpID0+IGNhY2hlLmZsdXNoKCkpXG4gICAgICB9XG5cbiAgICAgIC8vIEZsdXNoIHRoZSBjYWNoZXMgKGlmIG5lZWRlZCkgYW5kIHNhdmUgdGhlIGN1cnJlbnQgYnVpbGQgaWRcbiAgICAgIHJldHVybiBmbG93LnBhcmFsbGVsKGZsdXNoUHJvbWlzZXMpXG4gICAgICAgIC50aGVuKCgpID0+IGJ1aWxkRW5kcG9pbnQuX2NhY2hlU2V0U2luZ2xlKCdjYWNoZUJ1aWxkSWQnLCByZXNwLmJ1aWxkSWQpKVxuICAgIH0pXG4gIH1cblxuICAvLyBBbGwgdGhlIGRpZmZlcmVudCBBUEkgZW5kcG9pbnRzXG4gIGFjY291bnQgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkFjY291bnRFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgYWNoaWV2ZW1lbnRzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5BY2hpZXZlbWVudHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgYmFja3N0b3J5ICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5CYWNrc3RvcnlFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgYnVpbGQgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkJ1aWxkRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGNhdHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkNhdHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgY2hhcmFjdGVycyAobmFtZSkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkNoYXJhY3RlcnNFbmRwb2ludCh0aGlzLCBuYW1lKVxuICB9XG5cbiAgY29sb3JzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5Db2xvcnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgY29tbWVyY2UgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkNvbW1lcmNlRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGNvbnRpbmVudHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkNvbnRpbmVudHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgY3VycmVuY2llcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuQ3VycmVuY2llc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBkYWlseWNyYWZ0aW5nICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5EYWlseWNyYWZ0aW5nRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGR1bmdlb25zICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5EdW5nZW9uc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBlbWJsZW0gKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkVtYmxlbUVuZHBvaW50KHRoaXMpXG4gIH1cblxuICBlbW90ZXMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkVtb3Rlc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBldmVudHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkV2ZW50c0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBmaWxlcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuRmlsZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgZmluaXNoZXJzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5GaW5pc2hlcnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgZ2xpZGVycyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuR2xpZGVyc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBndWlsZCAoaWQpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5HdWlsZEVuZHBvaW50KHRoaXMsIGlkKVxuICB9XG5cbiAgaG9tZSAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuSG9tZUVuZHBvaW50KHRoaXMpXG4gIH1cblxuICBob21lc3RlYWQgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkhvbWVzdGVhZEVuZHBvaW50KHRoaXMpXG4gIH1cblxuICBpdGVtcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuSXRlbXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgaXRlbXN0YXRzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5JdGVtc3RhdHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgamFkZWJvdHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkphZGVib3RzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGxlZ2VuZGFyeWFybW9yeSAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuTGVnZW5kYXJ5YXJtb3J5RW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGxlZ2VuZHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLkxlZ2VuZHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgbWFpbGNhcnJpZXJzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5NYWlsY2FycmllcnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgbWFwY2hlc3RzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5NYXBjaGVzdHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgbWFwcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuTWFwc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBtYXN0ZXJpZXMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLk1hc3Rlcmllc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBtYXRlcmlhbHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLk1hdGVyaWFsc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBtaW5pcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuTWluaXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgbW91bnRzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5Nb3VudHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgbm9kZXMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLk5vZGVzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIG5vdmVsdGllcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuTm92ZWx0aWVzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIG91dGZpdHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLk91dGZpdHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgcGV0cyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuUGV0c0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBwcm9mZXNzaW9ucyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuUHJvZmVzc2lvbnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgcHZwICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5QdnBFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgcXVhZ2dhbnMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLlF1YWdnYW5zRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIHF1ZXN0cyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuUXVlc3RzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIHJhY2VzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5SYWNlc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICByYWlkcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuUmFpZHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgcmVjaXBlcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuUmVjaXBlc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBza2lmZnMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLlNraWZmc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBza2lsbHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLlNraWxsc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBza2lucyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuU2tpbnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgc3BlY2lhbGl6YXRpb25zICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5TcGVjaWFsaXphdGlvbnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgc3RvcmllcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuU3Rvcmllc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICB0aXRsZXMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLlRpdGxlc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICB0b2tlbmluZm8gKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLlRva2VuaW5mb0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICB0cmFpdHMgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLlRyYWl0c0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICB3aXphcmRzdmF1bHQgKCkge1xuICAgIHJldHVybiBuZXcgZW5kcG9pbnRzLldpemFyZHN2YXVsdEVuZHBvaW50KHRoaXMpXG4gIH1cblxuICB3b3JsZGJvc3NlcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBlbmRwb2ludHMuV29ybGRib3NzZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgd29ybGRzICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5Xb3JsZHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgd3Z3ICgpIHtcbiAgICByZXR1cm4gbmV3IGVuZHBvaW50cy5XdndFbmRwb2ludCh0aGlzKVxuICB9XG59XG4iLCJjb25zdCBxcyA9IHJlcXVpcmUoJ3F1ZXJ5c3RyaW5naWZ5JylcbmNvbnN0IHVuaXF1ZSA9IHJlcXVpcmUoJ2FycmF5LXVuaXF1ZScpXG5jb25zdCBjaHVuayA9IHJlcXVpcmUoJ2NodW5rJylcbmNvbnN0IGhhc2hTdHJpbmcgPSByZXF1aXJlKCcuL2hhc2gnKVxuXG5jb25zdCBjbG9uZSA9ICh4KSA9PiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHgpKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAocGFyZW50KSB7XG4gICAgdGhpcy5jbGllbnQgPSBwYXJlbnQuY2xpZW50XG4gICAgdGhpcy5zY2hlbWFWZXJzaW9uID0gcGFyZW50LnNjaGVtYVZlcnNpb24gfHwgJzIwMTktMDMtMjBUMDA6MDA6MDAuMDAwWidcbiAgICB0aGlzLmxhbmcgPSBwYXJlbnQubGFuZ1xuICAgIHRoaXMuYXBpS2V5ID0gcGFyZW50LmFwaUtleVxuICAgIHRoaXMuZmV0Y2ggPSBwYXJlbnQuZmV0Y2hcbiAgICB0aGlzLmNhY2hlcyA9IHBhcmVudC5jYWNoZXNcbiAgICB0aGlzLmRlYnVnID0gcGFyZW50LmRlYnVnXG5cbiAgICB0aGlzLmJhc2VVcmwgPSAnaHR0cHM6Ly9hcGkuZ3VpbGR3YXJzMi5jb20nXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IGZhbHNlXG4gICAgdGhpcy5tYXhQYWdlU2l6ZSA9IDIwMFxuICAgIHRoaXMuaXNCdWxrID0gZmFsc2VcbiAgICB0aGlzLmJ1bGtJZCA9ICdpZCdcbiAgICB0aGlzLnN1cHBvcnRzQnVsa0FsbCA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gZmFsc2VcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IGZhbHNlXG4gICAgdGhpcy5pc09wdGlvbmFsbHlBdXRoZW50aWNhdGVkID0gZmFsc2VcbiAgICB0aGlzLmNyZWRlbnRpYWxzID0gZmFsc2VcblxuICAgIHRoaXMuX3NraXBDYWNoZSA9IGZhbHNlXG4gIH1cblxuICAvLyBTZXQgdGhlIHNjaGVtYSB2ZXJzaW9uXG4gIHNjaGVtYSAoc2NoZW1hKSB7XG4gICAgdGhpcy5zY2hlbWFWZXJzaW9uID0gc2NoZW1hXG4gICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYHNldCB0aGUgc2NoZW1hIHRvICR7c2NoZW1hfWApXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIC8vIENoZWNrIGlmIHRoZSBzY2hlbWEgdmVyc2lvbiBpbmNsdWRlcyBhIHNwZWNpZmljIHZlcnNpb25cbiAgX3NjaGVtYUluY2x1ZGVzIChkYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMuc2NoZW1hVmVyc2lvbiA+PSBkYXRlXG4gIH1cblxuICAvLyBTZXQgdGhlIGxhbmd1YWdlIGZvciBsb2NhbGUtYXdhcmUgZW5kcG9pbnRzXG4gIGxhbmd1YWdlIChsYW5nKSB7XG4gICAgdGhpcy5sYW5nID0gbGFuZ1xuICAgIHRoaXMuZGVidWdNZXNzYWdlKGBzZXQgdGhlIGxhbmd1YWdlIHRvICR7bGFuZ31gKVxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICAvLyBTZXQgdGhlIGFwaSBrZXkgZm9yIGF1dGhlbnRpY2F0ZWQgZW5kcG9pbnRzXG4gIGF1dGhlbnRpY2F0ZSAoYXBpS2V5KSB7XG4gICAgdGhpcy5hcGlLZXkgPSBhcGlLZXlcbiAgICB0aGlzLmRlYnVnTWVzc2FnZShgc2V0IHRoZSBhcGkga2V5IHRvICR7YXBpS2V5fWApXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIC8vIFNldCB0aGUgZGVidWdnaW5nIGZsYWdcbiAgZGVidWdnaW5nIChmbGFnKSB7XG4gICAgdGhpcy5kZWJ1ZyA9IGZsYWdcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgLy8gUHJpbnQgb3V0IGEgZGVidWcgbWVzc2FnZSBpZiBkZWJ1Z2dpbmcgaXMgZW5hYmxlZFxuICBkZWJ1Z01lc3NhZ2UgKHN0cmluZykge1xuICAgIGlmICh0aGlzLmRlYnVnKSB7XG4gICAgICBjb25zb2xlLmxvZyhgW2d3MmFwaS1jbGllbnRdICR7c3RyaW5nfWApXG4gICAgfVxuICB9XG5cbiAgLy8gU2tpcCBjYWNoaW5nIGFuZCBnZXQgdGhlIGxpdmUgZGF0YVxuICBsaXZlICgpIHtcbiAgICB0aGlzLl9za2lwQ2FjaGUgPSB0cnVlXG4gICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYHNraXBwaW5nIGNhY2hlYClcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgLy8gR2V0IGFsbCBpZHNcbiAgaWRzICgpIHtcbiAgICB0aGlzLmRlYnVnTWVzc2FnZShgaWRzKCR7dGhpcy51cmx9KSBjYWxsZWRgKVxuXG4gICAgaWYgKCF0aGlzLmlzQnVsaykge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignXCJpZHNcIiBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgYnVsayBleHBhbmRpbmcgZW5kcG9pbnRzJykpXG4gICAgfVxuXG4gICAgLy8gVGhlcmUgaXMgbm8gY2FjaGUgdGltZSBzZXQsIHNvIGFsd2F5cyB1c2UgdGhlIGxpdmUgZGF0YVxuICAgIGlmICghdGhpcy5jYWNoZVRpbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLl9pZHMoKVxuICAgIH1cblxuICAgIC8vIEdldCBhcyBtdWNoIGFzIHBvc3NpYmxlIG91dCBvZiB0aGUgY2FjaGVcbiAgICBjb25zdCBoYXNoID0gdGhpcy5fY2FjaGVIYXNoKCdpZHMnKVxuICAgIGNvbnN0IGhhbmRsZUNhY2hlQ29udGVudCA9IChjYWNoZWQpID0+IHtcbiAgICAgIGlmIChjYWNoZWQpIHtcbiAgICAgICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYGlkcygke3RoaXMudXJsfSkgcmVzb2x2aW5nIGZyb20gY2FjaGVgKVxuICAgICAgICByZXR1cm4gY2FjaGVkXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLl9pZHMoKS50aGVuKGNvbnRlbnQgPT4ge1xuICAgICAgICB0aGlzLl9jYWNoZVNldFNpbmdsZShoYXNoLCBjb250ZW50KVxuICAgICAgICByZXR1cm4gY29udGVudFxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBHZXQgdGhlIGNvbnRlbnQgZWl0aGVyIGZyb20gdGhlIGNhY2hlIG9yIEFQSSwgd3JpdGUgaXQgaW50byB0aGUgY2FjaGUgYW5kIHJldHVybiBhIGNsb25lXG4gICAgY29uc3QgY29udGVudFByb21pc2UgPSB0aGlzLl9za2lwQ2FjaGVcbiAgICAgID8gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKS50aGVuKGhhbmRsZUNhY2hlQ29udGVudClcbiAgICAgIDogdGhpcy5fY2FjaGVHZXRTaW5nbGUoaGFzaCkudGhlbihoYW5kbGVDYWNoZUNvbnRlbnQpXG5cbiAgICByZXR1cm4gY29udGVudFByb21pc2UudGhlbihjbG9uZSlcbiAgfVxuXG4gIC8vIEdldCBhbGwgaWRzIGZyb20gdGhlIGxpdmUgQVBJXG4gIF9pZHMgKCkge1xuICAgIHRoaXMuZGVidWdNZXNzYWdlKGBpZHMoJHt0aGlzLnVybH0pIHJlcXVlc3RpbmcgZnJvbSBhcGlgKVxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KHRoaXMudXJsKVxuICB9XG5cbiAgLy8gR2V0IGEgc2luZ2xlIGVudHJ5IGJ5IGlkXG4gIGdldCAoaWQsIHVybCA9IGZhbHNlKSB7XG4gICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYGdldCgke3RoaXMudXJsfSkgY2FsbGVkYClcblxuICAgIGlmICghaWQgJiYgdGhpcy5pc0J1bGsgJiYgIXVybCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignXCJnZXRcIiByZXF1aXJlcyBhbiBpZCcpKVxuICAgIH1cblxuICAgIC8vIFRoZXJlIGlzIG5vIGNhY2hlIHRpbWUgc2V0LCBzbyBhbHdheXMgdXNlIHRoZSBsaXZlIGRhdGFcbiAgICBpZiAoIXRoaXMuY2FjaGVUaW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZ2V0KGlkLCB1cmwpXG4gICAgfVxuXG4gICAgLy8gR2V0IGFzIG11Y2ggYXMgcG9zc2libGUgb3V0IG9mIHRoZSBjYWNoZVxuICAgIGNvbnN0IGhhc2ggPSB0aGlzLl9jYWNoZUhhc2goaWQpXG4gICAgY29uc3QgaGFuZGxlQ2FjaGVDb250ZW50ID0gKGNhY2hlZCkgPT4ge1xuICAgICAgaWYgKGNhY2hlZCkge1xuICAgICAgICB0aGlzLmRlYnVnTWVzc2FnZShgZ2V0KCR7dGhpcy51cmx9KSByZXNvbHZpbmcgZnJvbSBjYWNoZWApXG4gICAgICAgIHJldHVybiBjYWNoZWRcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuX2dldChpZCwgdXJsKS50aGVuKGNvbnRlbnQgPT4ge1xuICAgICAgICB0aGlzLl9jYWNoZVNldFNpbmdsZShoYXNoLCBjb250ZW50KVxuICAgICAgICByZXR1cm4gY29udGVudFxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBHZXQgdGhlIGNvbnRlbnQgZWl0aGVyIGZyb20gdGhlIGNhY2hlIG9yIEFQSSwgd3JpdGUgaXQgaW50byB0aGUgY2FjaGUgYW5kIHJldHVybiBhIGNsb25lXG4gICAgY29uc3QgY29udGVudFByb21pc2UgPSB0aGlzLl9za2lwQ2FjaGVcbiAgICAgID8gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKS50aGVuKGhhbmRsZUNhY2hlQ29udGVudClcbiAgICAgIDogdGhpcy5fY2FjaGVHZXRTaW5nbGUoaGFzaCkudGhlbihoYW5kbGVDYWNoZUNvbnRlbnQpXG5cbiAgICByZXR1cm4gY29udGVudFByb21pc2UudGhlbihjbG9uZSlcbiAgfVxuXG4gIC8vIEdldCBhIHNpbmdsZSBlbnRyeSBieSBpZCBmcm9tIHRoZSBsaXZlIEFQSVxuICBfZ2V0IChpZCwgdXJsKSB7XG4gICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYGdldCgke3RoaXMudXJsfSkgcmVxdWVzdGluZyBmcm9tIGFwaWApXG5cbiAgICAvLyBSZXF1ZXN0IHRoZSBzaW5nbGUgaWQgaWYgdGhlIGVuZHBvaW50IGEgYnVsayBlbmRwb2ludFxuICAgIGlmICh0aGlzLmlzQnVsayAmJiAhdXJsKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLnVybH0/aWQ9JHtpZH1gKVxuICAgIH1cblxuICAgIC8vIFdlIGFyZSBkZWFsaW5nIHdpdGggYSBjdXN0b20gdXJsIGluc3RlYWRcbiAgICBpZiAodXJsKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcmVxdWVzdCh0aGlzLnVybCArIGlkKVxuICAgIH1cblxuICAgIC8vIEp1c3QgcmVxdWVzdCB0aGUgYmFzZSB1cmxcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdCh0aGlzLnVybClcbiAgfVxuXG4gIC8vIEdldCBtdWx0aXBsZSBlbnRyaWVzIGJ5IGlkc1xuICBtYW55IChpZHMpIHtcbiAgICB0aGlzLmRlYnVnTWVzc2FnZShgbWFueSgke3RoaXMudXJsfSkgY2FsbGVkICgke2lkcy5sZW5ndGh9IGlkcylgKVxuXG4gICAgaWYgKCF0aGlzLmlzQnVsaykge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignXCJtYW55XCIgaXMgb25seSBhdmFpbGFibGUgZm9yIGJ1bGsgZXhwYW5kaW5nIGVuZHBvaW50cycpKVxuICAgIH1cblxuICAgIC8vIEV4aXQgb3V0IGVhcmx5IGlmIHdlIGRvbid0IHJlcXVlc3QgYW55IGlkc1xuICAgIGlmIChpZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtdKVxuICAgIH1cblxuICAgIC8vIEFsd2F5cyBvbmx5IHdvcmsgb24gdW5pcXVlIGlkcywgc2luY2UgdGhhdCdzIGhvdyB0aGUgQVBJIHdvcmtzXG4gICAgaWRzID0gdW5pcXVlLmltbXV0YWJsZShpZHMpXG5cbiAgICAvLyBUaGVyZSBpcyBubyBjYWNoZSB0aW1lIHNldCwgc28gYWx3YXlzIHVzZSB0aGUgbGl2ZSBkYXRhXG4gICAgaWYgKCF0aGlzLmNhY2hlVGltZSkge1xuICAgICAgcmV0dXJuIHRoaXMuX21hbnkoaWRzKVxuICAgIH1cblxuICAgIC8vIEdldCBhcyBtdWNoIGFzIHBvc3NpYmxlIG91dCBvZiB0aGUgY2FjaGVcbiAgICBjb25zdCBoYXNoZXMgPSBpZHMubWFwKGlkID0+IHRoaXMuX2NhY2hlSGFzaChpZCkpXG4gICAgY29uc3QgaGFuZGxlQ2FjaGVDb250ZW50ID0gKGNhY2hlZCkgPT4ge1xuICAgICAgY2FjaGVkID0gY2FjaGVkLmZpbHRlcih4ID0+IHgpXG5cbiAgICAgIGlmIChjYWNoZWQubGVuZ3RoID09PSBpZHMubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuZGVidWdNZXNzYWdlKGBtYW55KCR7dGhpcy51cmx9KSByZXNvbHZpbmcgZnVsbHkgZnJvbSBjYWNoZWApXG4gICAgICAgIHJldHVybiBjYWNoZWRcbiAgICAgIH1cblxuICAgICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYG1hbnkoJHt0aGlzLnVybH0pIHJlc29sdmluZyBwYXJ0aWFsbHkgZnJvbSBjYWNoZSAoJHtjYWNoZWQubGVuZ3RofSBpZHMpYClcbiAgICAgIGNvbnN0IG1pc3NpbmdJZHMgPSBnZXRNaXNzaW5nSWRzKGlkcywgY2FjaGVkKVxuICAgICAgcmV0dXJuIHRoaXMuX21hbnkobWlzc2luZ0lkcywgY2FjaGVkLmxlbmd0aCA+IDApLnRoZW4oY29udGVudCA9PiB7XG4gICAgICAgIGNvbnN0IGNhY2hlQ29udGVudCA9IGNvbnRlbnQubWFwKHZhbHVlID0+IFt0aGlzLl9jYWNoZUhhc2godmFsdWVbdGhpcy5idWxrSWRdKSwgdmFsdWVdKVxuICAgICAgICB0aGlzLl9jYWNoZVNldE1hbnkoY2FjaGVDb250ZW50KVxuXG4gICAgICAgIC8vIE1lcmdlIHRoZSBuZXcgY29udGVudCB3aXRoIHRoZSBjYWNoZWQgY29udGVudCBhbmQgZ3VhcmFudGVlIGVsZW1lbnQgb3JkZXJcbiAgICAgICAgY29udGVudCA9IGNvbnRlbnQuY29uY2F0KGNhY2hlZClcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NvcnRCeUlkTGlzdChjb250ZW50LCBpZHMpXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIEZpbmQgdGhlIGlkcyB0aGF0IGFyZSBtaXNzaW5nIGluIHRoZSBjYWNoZWQgZGF0YVxuICAgIGNvbnN0IGdldE1pc3NpbmdJZHMgPSAoaWRzLCBjYWNoZWQpID0+IHtcbiAgICAgIGNvbnN0IGNhY2hlZElkcyA9IHt9XG4gICAgICBjYWNoZWQubWFwKHggPT4ge1xuICAgICAgICBjYWNoZWRJZHNbeFt0aGlzLmJ1bGtJZF1dID0gMVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIGlkcy5maWx0ZXIoeCA9PiBjYWNoZWRJZHNbeF0gIT09IDEpXG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBjb250ZW50IGVpdGhlciBmcm9tIHRoZSBjYWNoZSBvciBBUEksIHdyaXRlIGl0IGludG8gdGhlIGNhY2hlIGFuZCByZXR1cm4gYSBjbG9uZVxuICAgIGNvbnN0IGNvbnRlbnRQcm9taXNlID0gdGhpcy5fc2tpcENhY2hlXG4gICAgICA/IFByb21pc2UucmVzb2x2ZShbXSkudGhlbihoYW5kbGVDYWNoZUNvbnRlbnQpXG4gICAgICA6IHRoaXMuX2NhY2hlR2V0TWFueShoYXNoZXMpLnRoZW4oaGFuZGxlQ2FjaGVDb250ZW50KVxuXG4gICAgcmV0dXJuIGNvbnRlbnRQcm9taXNlLnRoZW4oY2xvbmUpXG4gIH1cblxuICAvLyBHZXQgbXVsdGlwbGUgZW50cmllcyBieSBpZHMgZnJvbSB0aGUgbGl2ZSBBUElcbiAgX21hbnkgKGlkcywgcGFydGlhbFJlcXVlc3QgPSBmYWxzZSkge1xuICAgIHRoaXMuZGVidWdNZXNzYWdlKGBtYW55KCR7dGhpcy51cmx9KSByZXF1ZXN0aW5nIGZyb20gYXBpICgke2lkcy5sZW5ndGh9IGlkcylgKVxuXG4gICAgLy8gQ2h1bmsgdGhlIHJlcXVlc3RzIHRvIHRoZSBtYXggcGFnZSBzaXplXG4gICAgY29uc3QgcGFnZXMgPSBjaHVuayhpZHMsIHRoaXMubWF4UGFnZVNpemUpXG4gICAgY29uc3QgcmVxdWVzdHMgPSBwYWdlcy5tYXAocGFnZSA9PiBgJHt0aGlzLnVybH0/aWRzPSR7cGFnZS5qb2luKCcsJyl9YClcblxuICAgIC8vIElmIHdlIGFyZSBwYXJ0aWFsbHkgY2FjaGluZyBhbmQgYWxsIG5vdC1jYWNoZWQgaWRzIGFyZSBhbGwgaW52YWxpZCxcbiAgICAvLyBzaW11bGF0ZSB0aGUgQVBJIGJlaGF2aW91ciBieSBzaWxlbnRseSBzd2FsbG93aW5nIGVycm9ycy5cbiAgICBsZXQgaGFuZGxlTWlzc2luZ0lkcyA9IChlcnIpID0+IHtcbiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICBpZiAocGFydGlhbFJlcXVlc3QgJiYgZXJyLnJlc3BvbnNlICYmIGVyci5yZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtdKVxuICAgICAgfVxuXG4gICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycilcbiAgICB9XG5cbiAgICAvLyBXb3JrIG9uIGFsbCByZXF1ZXN0cyBpbiBwYXJhbGxlbCBhbmQgdGhlbiBmbGF0dGVuIHRoZSByZXNwb25zZXMgaW50byBvbmVcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdE1hbnkocmVxdWVzdHMpXG4gICAgICAudGhlbihyZXNwb25zZXMgPT4gcmVzcG9uc2VzLnJlZHVjZSgoeCwgeSkgPT4geC5jb25jYXQoeSksIFtdKSlcbiAgICAgIC5jYXRjaChoYW5kbGVNaXNzaW5nSWRzKVxuICB9XG5cbiAgLy8gR2V0IGEgc2luZ2xlIHBhZ2VcbiAgcGFnZSAocGFnZSwgc2l6ZSA9IHRoaXMubWF4UGFnZVNpemUpIHtcbiAgICB0aGlzLmRlYnVnTWVzc2FnZShgcGFnZSgke3RoaXMudXJsfSkgY2FsbGVkYClcblxuICAgIGlmICghdGhpcy5pc0J1bGsgJiYgIXRoaXMuaXNQYWdpbmF0ZWQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ1wicGFnZVwiIGlzIG9ubHkgYXZhaWxhYmxlIGZvciBidWxrIGV4cGFuZGluZyBvciBwYWdpbmF0ZWQgZW5kcG9pbnRzJykpXG4gICAgfVxuXG4gICAgaWYgKHNpemUgPiB0aGlzLm1heFBhZ2VTaXplIHx8IHNpemUgPD0gMCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihgXCJzaXplXCIgaGFzIHRvIGJlIGJldHdlZW4gMCBhbmQgJHt0aGlzLm1heFBhZ2VTaXplfSwgd2FzICR7c2l6ZX1gKSlcbiAgICB9XG5cbiAgICBpZiAocGFnZSA8IDApIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ3BhZ2UgaGFzIHRvIGJlIDAgb3IgZ3JlYXRlcicpKVxuICAgIH1cblxuICAgIC8vIFRoZXJlIGlzIG5vIGNhY2hlIHRpbWUgc2V0LCBzbyBhbHdheXMgdXNlIHRoZSBsaXZlIGRhdGFcbiAgICBpZiAoIXRoaXMuY2FjaGVUaW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcGFnZShwYWdlLCBzaXplKVxuICAgIH1cblxuICAgIC8vIEdldCBhcyBtdWNoIGFzIHBvc3NpYmxlIG91dCBvZiB0aGUgY2FjaGVcbiAgICBjb25zdCBoYXNoID0gdGhpcy5fY2FjaGVIYXNoKCdwYWdlLScgKyBwYWdlICsgJy8nICsgc2l6ZSlcbiAgICBjb25zdCBoYW5kbGVDYWNoZUNvbnRlbnQgPSAoY2FjaGVkKSA9PiB7XG4gICAgICBpZiAoY2FjaGVkKSB7XG4gICAgICAgIHRoaXMuZGVidWdNZXNzYWdlKGBwYWdlKCR7dGhpcy51cmx9KSByZXNvbHZpbmcgZnJvbSBjYWNoZWApXG4gICAgICAgIHJldHVybiBjYWNoZWRcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuX3BhZ2UocGFnZSwgc2l6ZSkudGhlbihjb250ZW50ID0+IHtcbiAgICAgICAgbGV0IGNhY2hlQ29udGVudCA9IFtbaGFzaCwgY29udGVudF1dXG5cbiAgICAgICAgaWYgKHRoaXMuaXNCdWxrKSB7XG4gICAgICAgICAgY2FjaGVDb250ZW50ID0gY2FjaGVDb250ZW50LmNvbmNhdChjb250ZW50Lm1hcCh2YWx1ZSA9PiBbdGhpcy5fY2FjaGVIYXNoKHZhbHVlW3RoaXMuYnVsa0lkXSksIHZhbHVlXSkpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9jYWNoZVNldE1hbnkoY2FjaGVDb250ZW50KVxuICAgICAgICByZXR1cm4gY29udGVudFxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBHZXQgdGhlIGNvbnRlbnQgZWl0aGVyIGZyb20gdGhlIGNhY2hlIG9yIEFQSSwgd3JpdGUgaXQgaW50byB0aGUgY2FjaGUgYW5kIHJldHVybiBhIGNsb25lXG4gICAgY29uc3QgY29udGVudFByb21pc2UgPSB0aGlzLl9za2lwQ2FjaGVcbiAgICAgID8gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKS50aGVuKGhhbmRsZUNhY2hlQ29udGVudClcbiAgICAgIDogdGhpcy5fY2FjaGVHZXRTaW5nbGUoaGFzaCkudGhlbihoYW5kbGVDYWNoZUNvbnRlbnQpXG5cbiAgICByZXR1cm4gY29udGVudFByb21pc2UudGhlbihjbG9uZSlcbiAgfVxuXG4gIC8vIEdldCBhIHNpbmdsZSBwYWdlIGZyb20gdGhlIGxpdmUgQVBJXG4gIF9wYWdlIChwYWdlLCBzaXplKSB7XG4gICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYHBhZ2UoJHt0aGlzLnVybH0pIHJlcXVlc3RpbmcgZnJvbSBhcGlgKVxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMudXJsfT9wYWdlPSR7cGFnZX0mcGFnZV9zaXplPSR7c2l6ZX1gKVxuICB9XG5cbiAgLy8gR2V0IGFsbCBlbnRyaWVzXG4gIGFsbCAoKSB7XG4gICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYGFsbCgke3RoaXMudXJsfSkgY2FsbGVkYClcblxuICAgIGlmICghdGhpcy5pc0J1bGsgJiYgIXRoaXMuaXNQYWdpbmF0ZWQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ1wiYWxsXCIgaXMgb25seSBhdmFpbGFibGUgZm9yIGJ1bGsgZXhwYW5kaW5nIG9yIHBhZ2luYXRlZCBlbmRwb2ludHMnKSlcbiAgICB9XG5cbiAgICAvLyBUaGVyZSBpcyBubyBjYWNoZSB0aW1lIHNldCwgc28gYWx3YXlzIHVzZSB0aGUgbGl2ZSBkYXRhXG4gICAgaWYgKCF0aGlzLmNhY2hlVGltZSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2FsbCgpXG4gICAgfVxuXG4gICAgLy8gR2V0IGFzIG11Y2ggYXMgcG9zc2libGUgb3V0IG9mIHRoZSBjYWNoZVxuICAgIGNvbnN0IGhhc2ggPSB0aGlzLl9jYWNoZUhhc2goJ2FsbCcpXG4gICAgY29uc3QgaGFuZGxlQ2FjaGVDb250ZW50ID0gKGNhY2hlZCkgPT4ge1xuICAgICAgaWYgKGNhY2hlZCkge1xuICAgICAgICB0aGlzLmRlYnVnTWVzc2FnZShgYWxsKCR7dGhpcy51cmx9KSByZXNvbHZpbmcgZnJvbSBjYWNoZWApXG4gICAgICAgIHJldHVybiBjYWNoZWRcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuX2FsbCgpLnRoZW4oY29udGVudCA9PiB7XG4gICAgICAgIGxldCBjYWNoZUNvbnRlbnQgPSBbW2hhc2gsIGNvbnRlbnRdXVxuXG4gICAgICAgIGlmICh0aGlzLmlzQnVsaykge1xuICAgICAgICAgIGNhY2hlQ29udGVudCA9IGNhY2hlQ29udGVudC5jb25jYXQoY29udGVudC5tYXAodmFsdWUgPT4gW3RoaXMuX2NhY2hlSGFzaCh2YWx1ZVt0aGlzLmJ1bGtJZF0pLCB2YWx1ZV0pKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fY2FjaGVTZXRNYW55KGNhY2hlQ29udGVudClcbiAgICAgICAgcmV0dXJuIGNvbnRlbnRcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBjb250ZW50IGVpdGhlciBmcm9tIHRoZSBjYWNoZSBvciBBUEksIHdyaXRlIGl0IGludG8gdGhlIGNhY2hlIGFuZCByZXR1cm4gYSBjbG9uZVxuICAgIGNvbnN0IGNvbnRlbnRQcm9taXNlID0gdGhpcy5fc2tpcENhY2hlXG4gICAgICA/IFByb21pc2UucmVzb2x2ZShmYWxzZSkudGhlbihoYW5kbGVDYWNoZUNvbnRlbnQpXG4gICAgICA6IHRoaXMuX2NhY2hlR2V0U2luZ2xlKGhhc2gpLnRoZW4oaGFuZGxlQ2FjaGVDb250ZW50KVxuXG4gICAgcmV0dXJuIGNvbnRlbnRQcm9taXNlLnRoZW4oY2xvbmUpXG4gIH1cblxuICAvLyBHZXQgYWxsIGVudHJpZXMgZnJvbSB0aGUgbGl2ZSBBUElcbiAgX2FsbCAoKSB7XG4gICAgdGhpcy5kZWJ1Z01lc3NhZ2UoYGFsbCgke3RoaXMudXJsfSkgcmVxdWVzdGluZyBmcm9tIGFwaWApXG5cbiAgICAvLyBVc2UgYnVsayBleHBhbnNpb24gaWYgdGhlIGVuZHBvaW50IHN1cHBvcnRzIHRoZSBcImFsbFwiIGtleXdvcmRcbiAgICBpZiAodGhpcy5pc0J1bGsgJiYgdGhpcy5zdXBwb3J0c0J1bGtBbGwpIHtcbiAgICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMudXJsfT9pZHM9YWxsYClcbiAgICB9XG5cbiAgICAvLyBHZXQgZXZlcnl0aGluZyB2aWEgYWxsIHBhZ2VzIGluc3RlYWRcbiAgICBsZXQgdG90YWxFbnRyaWVzXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy51cmx9P3BhZ2U9MCZwYWdlX3NpemU9JHt0aGlzLm1heFBhZ2VTaXplfWAsICdyZXNwb25zZScpXG4gICAgICAudGhlbihmaXJzdFBhZ2UgPT4ge1xuICAgICAgICAvLyBHZXQgdGhlIHRvdGFsIG51bWJlciBvZiBlbnRyaWVzIG9mZiB0aGUgZmlyc3QgcGFnZSdzIGhlYWRlcnNcbiAgICAgICAgdG90YWxFbnRyaWVzID0gZmlyc3RQYWdlLmhlYWRlcnMuZ2V0KCdYLVJlc3VsdC1Ub3RhbCcpXG4gICAgICAgIHJldHVybiBmaXJzdFBhZ2UuanNvbigpXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgLy8gUmV0dXJuIGVhcmx5IGlmIHRoZSBmaXJzdCBwYWdlIGFscmVhZHkgaW5jbHVkZXMgYWxsIGVudHJpZXNcbiAgICAgICAgaWYgKHRvdGFsRW50cmllcyA8PSB0aGlzLm1heFBhZ2VTaXplKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVxdWVzdCBhbGwgbWlzc2luZyBwYWdlcyBpbiBwYXJhbGxlbFxuICAgICAgICBsZXQgcmVxdWVzdHMgPSBbXVxuICAgICAgICBmb3IgKGxldCBwYWdlID0gMTsgcGFnZSA8IE1hdGguY2VpbCh0b3RhbEVudHJpZXMgLyB0aGlzLm1heFBhZ2VTaXplKTsgcGFnZSsrKSB7XG4gICAgICAgICAgcmVxdWVzdHMucHVzaChgJHt0aGlzLnVybH0/cGFnZT0ke3BhZ2V9JnBhZ2Vfc2l6ZT0ke3RoaXMubWF4UGFnZVNpemV9YClcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0TWFueShyZXF1ZXN0cykudGhlbihyZXNwb25zZXMgPT4ge1xuICAgICAgICAgIHJlc3BvbnNlcyA9IHJlc3BvbnNlcy5yZWR1Y2UoKHgsIHkpID0+IHguY29uY2F0KHkpLCBbXSlcbiAgICAgICAgICByZXR1cm4gcmVzdWx0LmNvbmNhdChyZXNwb25zZXMpXG4gICAgICAgIH0pXG4gICAgICB9KVxuICB9XG5cbiAgLy8gU2V0IGEgc2luZ2xlIGNhY2hlIGtleSBpbiBhbGwgY29ubmVjdGVkIGNhY2hlIHN0b3JhZ2VzXG4gIF9jYWNoZVNldFNpbmdsZSAoa2V5LCB2YWx1ZSkge1xuICAgIHRoaXMuY2FjaGVzLm1hcChjYWNoZSA9PiB7XG4gICAgICBjYWNoZS5zZXQoa2V5LCB2YWx1ZSwgdGhpcy5jYWNoZVRpbWUpLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbZ3cyYXBpLWNsaWVudF0gRXJyb3JlZCBkdXJpbmcgX2NhY2hlU2V0U2luZ2xlJywgeyBlcnJvciwgY2FjaGUsIGtleSwgdmFsdWUgfSlcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuXG4gIC8vIFNldCBtdWx0aXBsZXMgY2FjaGUga2V5IGluIGFsbCBjb25uZWN0ZWQgY2FjaGUgc3RvcmFnZXNcbiAgX2NhY2hlU2V0TWFueSAodmFsdWVzKSB7XG4gICAgdmFsdWVzID0gdmFsdWVzLm1hcCh2YWx1ZSA9PiBbdmFsdWVbMF0sIHZhbHVlWzFdLCB0aGlzLmNhY2hlVGltZV0pXG4gICAgdGhpcy5jYWNoZXMubWFwKGNhY2hlID0+IHtcbiAgICAgIGNhY2hlLm1zZXQodmFsdWVzKS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNvbnNvbGUud2FybignW2d3MmFwaS1jbGllbnRdIEVycm9yZWQgZHVyaW5nIF9jYWNoZVNldE1hbnknLCB7IGVycm9yLCBjYWNoZSwgdmFsdWVzIH0pXG4gICAgICB9KVxuICAgIH0pXG4gIH1cblxuICAvLyBHZXQgYSBjYWNoZWQgdmFsdWUgb3V0IG9mIHRoZSBmaXJzdCBwb3NzaWJsZSBjb25uZWN0ZWQgY2FjaGUgc3RvcmFnZXNcbiAgX2NhY2hlR2V0U2luZ2xlIChrZXksIGluZGV4ID0gMCkge1xuICAgIHJldHVybiB0aGlzLmNhY2hlc1tpbmRleF0uZ2V0KGtleSkudGhlbih2YWx1ZSA9PiB7XG4gICAgICBpZiAodmFsdWUgfHwgaW5kZXggPT09IHRoaXMuY2FjaGVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLl9jYWNoZUdldFNpbmdsZShrZXksICsraW5kZXgpXG4gICAgfSlcbiAgfVxuXG4gIC8vIEdldCBtdWx0aXBsZSBjYWNoZWQgdmFsdWVzIG91dCBvZiB0aGUgZmlyc3QgcG9zc2libGUgY29ubmVjdGVkIGNhY2hlIHN0b3JhZ2VzXG4gIF9jYWNoZUdldE1hbnkgKGtleXMsIGluZGV4ID0gMCkge1xuICAgIHJldHVybiB0aGlzLmNhY2hlc1tpbmRleF0ubWdldChrZXlzKS50aGVuKHZhbHVlcyA9PiB7XG4gICAgICBjb25zdCBjbGVhblZhbHVlcyA9IHZhbHVlcy5maWx0ZXIoeCA9PiB4KVxuXG4gICAgICAvLyBXZSBnb3QgYWxsIHRoZSByZXF1ZXN0ZWQga2V5cyBvciBhcmUgdGhyb3VnaCBhbGwgc3RvcmFnZXNcbiAgICAgIGlmIChjbGVhblZhbHVlcy5sZW5ndGggPT09IGtleXMubGVuZ3RoIHx8IGluZGV4ID09PSB0aGlzLmNhY2hlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZXNcbiAgICAgIH1cblxuICAgICAgLy8gVHJ5IHRvIGFzayB0aGUgbmV4dCBzdG9yYWdlIGZvciB0aGUga2V5cyB0aGF0IHdlIGRpZG4ndCBnZXRcbiAgICAgIGxldCBtaXNzaW5nS2V5cyA9IHZhbHVlc1xuICAgICAgICAubWFwKCh2YWx1ZSwgaSkgPT4gdmFsdWUgPyBmYWxzZSA6IGtleXNbaV0pXG4gICAgICAgIC5maWx0ZXIodmFsdWUgPT4gdmFsdWUpXG5cbiAgICAgIC8vIFRoZW4gbWVyZ2UgdGhlIHZhbHVlcyBvZiB0aGUgbmV4dCBzdG9yYWdlIGludG8gdGhlIG1pc3Npbmcgc2xvdHNcbiAgICAgIHJldHVybiB0aGlzLl9jYWNoZUdldE1hbnkobWlzc2luZ0tleXMsICsraW5kZXgpLnRoZW4obWlzc2luZ1ZhbHVlcyA9PiB7XG4gICAgICAgIGxldCBpID0gMFxuICAgICAgICByZXR1cm4gdmFsdWVzLm1hcCh2YWx1ZSA9PiB2YWx1ZSB8fCBtaXNzaW5nVmFsdWVzW2krK10pXG4gICAgICB9KVxuICAgIH0pXG4gIH1cblxuICAvLyBHZXQgYSBjYWNoZSBoYXNoIGZvciBhbiBpZGVudGlmaWVyXG4gIF9jYWNoZUhhc2ggKGlkKSB7XG4gICAgbGV0IGhhc2ggPSBoYXNoU3RyaW5nKHRoaXMuYmFzZVVybCArIHRoaXMudXJsICsgJzonICsgdGhpcy5zY2hlbWFWZXJzaW9uKVxuXG4gICAgaWYgKGlkKSB7XG4gICAgICBoYXNoICs9ICc6JyArIGlkXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNMb2NhbGl6ZWQpIHtcbiAgICAgIGhhc2ggKz0gJzonICsgdGhpcy5sYW5nXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX3VzZXNBcGlLZXkoKSkge1xuICAgICAgaGFzaCArPSAnOicgKyBoYXNoU3RyaW5nKHRoaXMuYXBpS2V5ICsgJycpXG4gICAgfVxuXG4gICAgcmV0dXJuIGhhc2hcbiAgfVxuXG4gIC8vIEV4ZWN1dGUgYSBzaW5nbGUgcmVxdWVzdFxuICBfcmVxdWVzdCAodXJsLCB0eXBlID0gJ2pzb24nKSB7XG4gICAgdXJsID0gdGhpcy5fYnVpbGRVcmwodXJsKVxuXG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBjb25zdCBjcmVkZW50aWFscyA9IHRoaXMuY3JlZGVudGlhbHMgPyAnaW5jbHVkZScgOiB1bmRlZmluZWRcblxuICAgIHJldHVybiB0aGlzLmZldGNoLnNpbmdsZSh1cmwsIHsgdHlwZSwgY3JlZGVudGlhbHMgfSlcbiAgfVxuXG4gIC8vIEV4ZWN1dGUgbXVsdGlwbGUgcmVxdWVzdHMgaW4gcGFyYWxsZWxcbiAgX3JlcXVlc3RNYW55ICh1cmxzLCB0eXBlID0gJ2pzb24nKSB7XG4gICAgdXJscyA9IHVybHMubWFwKHVybCA9PiB0aGlzLl9idWlsZFVybCh1cmwpKVxuXG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBjb25zdCBjcmVkZW50aWFscyA9IHRoaXMuY3JlZGVudGlhbHMgPyAnaW5jbHVkZScgOiB1bmRlZmluZWRcblxuICAgIHJldHVybiB0aGlzLmZldGNoLm1hbnkodXJscywgeyB0eXBlLCBjcmVkZW50aWFscyB9KVxuICB9XG5cbiAgLy8gQnVpbGQgdGhlIGhlYWRlcnMgZm9yIGxvY2FsaXphdGlvbiBhbmQgYXV0aGVudGljYXRpb25cbiAgX2J1aWxkVXJsICh1cmwpIHtcbiAgICAvLyBBZGQgdGhlIGJhc2UgdXJsXG4gICAgdXJsID0gdGhpcy5iYXNlVXJsICsgdXJsXG5cbiAgICAvLyBQYXJzZSBhIHBvc3NpYmx5IGV4aXN0aW5nIHF1ZXJ5XG4gICAgY29uc3QgcGFyc2VkVXJsID0gdXJsLnNwbGl0KCc/JylcbiAgICBsZXQgcGFyc2VkUXVlcnkgPSBxcy5wYXJzZShwYXJzZWRVcmxbMV0gfHwgJycpXG5cbiAgICBsZXQgcXVlcnkgPSB7fVxuXG4gICAgLy8gU2V0IHRoZSBzY2hlbWEgdmVyc2lvblxuICAgIHF1ZXJ5Wyd2J10gPSB0aGlzLnNjaGVtYVZlcnNpb25cblxuICAgIC8vIE9ubHkgc2V0IHRoZSBBUEkga2V5IGZvciBhdXRoZW50aWNhdGVkIGVuZHBvaW50cyxcbiAgICAvLyB3aGVuIGl0IGlzIHJlcXVpcmVkIG9yIG9wdGlvbmFsIGFuZCBzZXQgb24gdGhlIGNsaWVudFxuICAgIGlmICh0aGlzLl91c2VzQXBpS2V5KCkpIHtcbiAgICAgIHF1ZXJ5WydhY2Nlc3NfdG9rZW4nXSA9IHRoaXMuYXBpS2V5XG4gICAgfVxuXG4gICAgLy8gU2V0IHRoZSBsYW5ndWFnZSBmb3IgbG9jYWxpemVkIGVuZHBvaW50c1xuICAgIGlmICh0aGlzLmlzTG9jYWxpemVkKSB7XG4gICAgICBxdWVyeVsnbGFuZyddID0gdGhpcy5sYW5nXG4gICAgfVxuXG4gICAgLy8gTWVyZ2UgdGhlIHBhcnNlZCBxdWVyeSBwYXJ0cyBvdXQgb2YgdGhlIHVybFxuICAgIHF1ZXJ5ID0gT2JqZWN0LmFzc2lnbihxdWVyeSwgcGFyc2VkUXVlcnkpXG5cbiAgICAvLyBCdWlsZCB0aGUgdXJsIHdpdGggdGhlIGZpbmlzaGVkIHF1ZXJ5XG4gICAgcXVlcnkgPSBxcy5zdHJpbmdpZnkocXVlcnksIHRydWUpLnJlcGxhY2UoLyUyQy9nLCAnLCcpXG4gICAgcmV0dXJuIHBhcnNlZFVybFswXSArIHF1ZXJ5XG4gIH1cblxuICAvLyBHdWFyYW50ZWUgdGhlIGVsZW1lbnQgb3JkZXIgb2YgYnVsayByZXN1bHRzXG4gIF9zb3J0QnlJZExpc3QgKGVudHJpZXMsIGlkcykge1xuICAgIC8vIEhhc2ggbWFwIG9mIHRoZSBpbmRleGVzIGZvciBiZXR0ZXIgdGltZSBjb21wbGV4aXR5IG9uIGJpZyBhcnJheXNcbiAgICBsZXQgaW5kZXhNYXAgPSB7fVxuICAgIGlkcy5tYXAoKHgsIGkpID0+IHtcbiAgICAgIGluZGV4TWFwW3hdID0gaVxuICAgIH0pXG5cbiAgICAvLyBTb3J0IGJ5IHRoZSBpbmRleGVzXG4gICAgZW50cmllcy5zb3J0KChhLCBiKSA9PiBpbmRleE1hcFthW3RoaXMuYnVsa0lkXV0gLSBpbmRleE1hcFtiW3RoaXMuYnVsa0lkXV0pXG4gICAgcmV0dXJuIGVudHJpZXNcbiAgfVxuXG4gIF91c2VzQXBpS2V5ICgpIHtcbiAgICByZXR1cm4gdGhpcy5pc0F1dGhlbnRpY2F0ZWQgJiYgKCF0aGlzLmlzT3B0aW9uYWxseUF1dGhlbnRpY2F0ZWQgfHwgdGhpcy5hcGlLZXkpXG4gIH1cbn1cbiIsImNvbnN0IF9nZXQgPSByZXF1aXJlKCdmYXN0LWdldCcpXG5jb25zdCBmbG93ID0gcmVxdWlyZSgnLi4vZmxvdy5qcycpXG5cbmZ1bmN0aW9uIGJsb2IgKHBhcmVudCkge1xuICBjb25zdCBjbGllbnQgPSBwYXJlbnQuY2xpZW50XG5cbiAgY29uc3QgcmVxdWVzdHMgPSB7XG4gICAgYWNjb3VudDogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLmdldCgpKSxcbiAgICBhY2hpZXZlbWVudHM6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5hY2hpZXZlbWVudHMoKS5nZXQoKSksXG4gICAgYmFuazogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLmJhbmsoKS5nZXQoKSksXG4gICAgY2hhcmFjdGVyczogd3JhcCgoKSA9PiBjbGllbnQuY2hhcmFjdGVycygpLmFsbCgpKSxcbiAgICAnY29tbWVyY2UuYnV5cyc6IHdyYXAoKCkgPT4gY2xpZW50LmNvbW1lcmNlKCkudHJhbnNhY3Rpb25zKCkuY3VycmVudCgpLmJ1eXMoKS5hbGwoKSksXG4gICAgJ2NvbW1lcmNlLmRlbGl2ZXJ5Jzogd3JhcCgoKSA9PiBjbGllbnQuY29tbWVyY2UoKS5kZWxpdmVyeSgpLmdldCgpKSxcbiAgICAnY29tbWVyY2Uuc2VsbHMnOiB3cmFwKCgpID0+IGNsaWVudC5jb21tZXJjZSgpLnRyYW5zYWN0aW9ucygpLmN1cnJlbnQoKS5zZWxscygpLmFsbCgpKSxcbiAgICBkdW5nZW9uczogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLmR1bmdlb25zKCkuZ2V0KCkpLFxuICAgIGR5ZXM6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5keWVzKCkuZ2V0KCkpLFxuICAgIGVtb3Rlczogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLmVtb3RlcygpLmdldCgpKSxcbiAgICBmaW5pc2hlcnM6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5maW5pc2hlcnMoKS5nZXQoKSksXG4gICAgZ2xpZGVyczogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLmdsaWRlcnMoKS5nZXQoKSksXG4gICAgZ3VpbGRzOiB3cmFwKCgpID0+IGFjY291bnRHdWlsZHMoY2xpZW50KSksXG4gICAgJ2hvbWUuY2F0cyc6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5ob21lKCkuY2F0cygpLmdldCgpKSxcbiAgICAnaG9tZS5ub2Rlcyc6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5ob21lKCkubm9kZXMoKS5nZXQoKSksXG4gICAgJ2hvbWVzdGVhZC5kZWNvcmF0aW9ucyc6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5ob21lc3RlYWQoKS5kZWNvcmF0aW9ucygpLmdldCgpKSxcbiAgICAnaG9tZXN0ZWFkLmdseXBocyc6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5ob21lc3RlYWQoKS5nbHlwaHMoKS5nZXQoKSksXG4gICAgamFkZWJvdHM6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5qYWRlYm90cygpLmdldCgpKSxcbiAgICBsZWdlbmRhcnlhcm1vcnk6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5sZWdlbmRhcnlhcm1vcnkoKS5nZXQoKSksXG4gICAgbHVjazogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLmx1Y2soKS5nZXQoKSksXG4gICAgbWFpbGNhcnJpZXJzOiB3cmFwKCgpID0+IGNsaWVudC5hY2NvdW50KCkubWFpbGNhcnJpZXJzKCkuZ2V0KCkpLFxuICAgIG1hc3Rlcmllczogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLm1hc3RlcmllcygpLmdldCgpKSxcbiAgICAnbWFzdGVyeS5wb2ludHMnOiB3cmFwKCgpID0+IGNsaWVudC5hY2NvdW50KCkubWFzdGVyeSgpLnBvaW50cygpLmdldCgpKSxcbiAgICBtYXRlcmlhbHM6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5tYXRlcmlhbHMoKS5nZXQoKSksXG4gICAgbWluaXM6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5taW5pcygpLmdldCgpKSxcbiAgICAnbW91bnRzLnNraW5zJzogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLm1vdW50cygpLnNraW5zKCkuZ2V0KCkpLFxuICAgICdtb3VudHMudHlwZXMnOiB3cmFwKCgpID0+IGNsaWVudC5hY2NvdW50KCkubW91bnRzKCkudHlwZXMoKS5nZXQoKSksXG4gICAgbm92ZWx0aWVzOiB3cmFwKCgpID0+IGNsaWVudC5hY2NvdW50KCkubm92ZWx0aWVzKCkuZ2V0KCkpLFxuICAgIG91dGZpdHM6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS5vdXRmaXRzKCkuZ2V0KCkpLFxuICAgICdwdnAuZ2FtZXMnOiB3cmFwKCgpID0+IGNsaWVudC5hY2NvdW50KCkucHZwKCkuZ2FtZXMoKS5hbGwoKSksXG4gICAgJ3B2cC5oZXJvZXMnOiB3cmFwKCgpID0+IGNsaWVudC5hY2NvdW50KCkucHZwKCkuaGVyb2VzKCkuZ2V0KCkpLFxuICAgICdwdnAuc3RhbmRpbmdzJzogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLnB2cCgpLnN0YW5kaW5ncygpLmdldCgpKSxcbiAgICAncHZwLnN0YXRzJzogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLnB2cCgpLnN0YXRzKCkuZ2V0KCkpLFxuICAgIHJhaWRzOiB3cmFwKCgpID0+IGNsaWVudC5hY2NvdW50KCkucmFpZHMoKS5nZXQoKSksXG4gICAgcmVjaXBlczogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLnJlY2lwZXMoKS5nZXQoKSksXG4gICAgc2hhcmVkOiB3cmFwKCgpID0+IGNsaWVudC5hY2NvdW50KCkuaW52ZW50b3J5KCkuZ2V0KCkpLFxuICAgIHNraWZmczogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLnNraWZmcygpLmdldCgpKSxcbiAgICBza2luczogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLnNraW5zKCkuZ2V0KCkpLFxuICAgIHRpdGxlczogd3JhcCgoKSA9PiBjbGllbnQuYWNjb3VudCgpLnRpdGxlcygpLmdldCgpKSxcbiAgICB3YWxsZXQ6IHdyYXAoKCkgPT4gY2xpZW50LmFjY291bnQoKS53YWxsZXQoKS5nZXQoKSlcbiAgfVxuXG4gIHJldHVybiBmbG93LnBhcmFsbGVsKHJlcXVlc3RzKS50aGVuKGRhdGEgPT4ge1xuICAgIGRhdGEgPSB1bmZsYXR0ZW4oZGF0YSlcbiAgICBkYXRhLmNoYXJhY3RlcnMgPSBmaWx0ZXJCZXRhQ2hhcmFjdGVycyhkYXRhLmNoYXJhY3RlcnMpXG4gICAgcmV0dXJuIGRhdGFcbiAgfSlcbn1cblxuLy8gR2V0IHRoZSBndWlsZCBkYXRhIGFjY2Vzc2libGUgZm9yIHRoZSBhY2NvdW50XG5mdW5jdGlvbiBhY2NvdW50R3VpbGRzIChjbGllbnQpIHtcbiAgcmV0dXJuIGNsaWVudC5hY2NvdW50KCkuZ2V0KCkudGhlbihhY2NvdW50ID0+IHtcbiAgICBpZiAoIWFjY291bnQuZ3VpbGRfbGVhZGVyKSB7XG4gICAgICByZXR1cm4gW11cbiAgICB9XG5cbiAgICBsZXQgcmVxdWVzdHMgPSBhY2NvdW50Lmd1aWxkX2xlYWRlci5tYXAoaWQgPT4gd3JhcCgoKSA9PiBndWlsZERhdGEoaWQpKSlcbiAgICByZXR1cm4gZmxvdy5wYXJhbGxlbChyZXF1ZXN0cylcbiAgfSlcblxuICBmdW5jdGlvbiBndWlsZERhdGEgKGlkKSB7XG4gICAgbGV0IHJlcXVlc3RzID0ge1xuICAgICAgZGF0YTogd3JhcCgoKSA9PiBjbGllbnQuZ3VpbGQoKS5nZXQoaWQpKSxcbiAgICAgIG1lbWJlcnM6IHdyYXAoKCkgPT4gY2xpZW50Lmd1aWxkKGlkKS5tZW1iZXJzKCkuZ2V0KCkpLFxuICAgICAgcmFua3M6IHdyYXAoKCkgPT4gY2xpZW50Lmd1aWxkKGlkKS5yYW5rcygpLmdldCgpKSxcbiAgICAgIHN0YXNoOiB3cmFwKCgpID0+IGNsaWVudC5ndWlsZChpZCkuc3Rhc2goKS5nZXQoKSksXG4gICAgICB0ZWFtczogd3JhcCgoKSA9PiBQcm9taXNlLnJlc29sdmUobnVsbCkpLFxuICAgICAgdHJlYXN1cnk6IHdyYXAoKCkgPT4gY2xpZW50Lmd1aWxkKGlkKS50cmVhc3VyeSgpLmdldCgpKSxcbiAgICAgIHVwZ3JhZGVzOiB3cmFwKCgpID0+IGNsaWVudC5ndWlsZChpZCkudXBncmFkZXMoKS5nZXQoKSlcbiAgICB9XG5cbiAgICByZXR1cm4gZmxvdy5wYXJhbGxlbChyZXF1ZXN0cylcbiAgfVxufVxuXG4vLyBGaWx0ZXIgb3V0IGJldGEgY2hhcmFjdGVycyBmcm9tIHRoZSB0b3RhbCBhY2NvdW50IGJsb2IsIHNpbmNlIHRoZXkgYXJlXG4vLyB0ZWNobmljYWxseSBub3QgcGFydCBvZiB0aGUgYWN0dWFsIGxpdmUgYWNjb3VudCBhbmQgbGl2ZSBvbiBhIGRpZmZlcmVudCBzZXJ2ZXJcbmZ1bmN0aW9uIGZpbHRlckJldGFDaGFyYWN0ZXJzIChjaGFyYWN0ZXJzKSB7XG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gIGlmICghY2hhcmFjdGVycykge1xuICAgIHJldHVybiBudWxsXG4gIH1cblxuICByZXR1cm4gY2hhcmFjdGVycy5maWx0ZXIoeCA9PiAheC5mbGFncyB8fCAheC5mbGFncy5pbmNsdWRlcygnQmV0YScpKVxufVxuXG4vLyBXcmFwIGEgcHJvbWlzZSBmdW5jdGlvbiBzbyBhbGwgZXJyb3JzIHRoYXQgaGF2ZSB0byBkbyB3aXRoIHRoZSBBUElcbi8vIGp1c3QgcmVzdWx0IGluIGFuIGVtcHR5IHJlc3BvbnNlIGluc3RlYWQgb2YgdGhyb3dpbmcgYW4gZXJyb3Jcbi8vIFRoaXMgcHJldmVudHMgQVBJIGVycm9ycyAvIGNoYW5nZXMgYnJlYWtpbmcgdGhlIGVudGlyZSBpbmZyYXN0cnVjdHVyZVxuZnVuY3Rpb24gd3JhcCAoZnVuYykge1xuICByZXR1cm4gKCkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGZ1bmMoKVxuICAgICAgLnRoZW4oeCA9PiByZXNvbHZlKHgpKVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGxldCBzdGF0dXMgPSBfZ2V0KGVyciwgJ3Jlc3BvbnNlLnN0YXR1cycpXG4gICAgICAgIGxldCB0ZXh0ID0gX2dldChlcnIsICdjb250ZW50LnRleHQnKVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBzdGF0dXMgfHxcbiAgICAgICAgICB0ZXh0IHx8XG4gICAgICAgICAgWyduZXR3b3JrJywgJ2ZldGNoJ10uc29tZSh4ID0+IGVyci5tZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoeCkpXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnNvbGUud2FybihgQVBJIGVycm9yOiAke3RleHR9ICgke3N0YXR1c30pYClcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShudWxsKVxuICAgICAgICB9XG5cbiAgICAgICAgcmVqZWN0KGVycilcbiAgICAgIH0pXG4gIH0pXG59XG5cbi8vIFVuZmxhdHRlbiBhbiBvYmplY3Qgd2l0aCBrZXlzIGRlc2NyaWJpbmcgYSBuZXN0ZWQgc3RydWN0dXJlXG5mdW5jdGlvbiB1bmZsYXR0ZW4gKG9iamVjdCkge1xuICBsZXQgcmVzdWx0ID0ge31cblxuICBmb3IgKGxldCBrZXkgaW4gb2JqZWN0KSB7XG4gICAgX3NldChyZXN1bHQsIGtleSwgb2JqZWN0W2tleV0pXG4gIH1cblxuICByZXR1cm4gcmVzdWx0XG59XG5cbi8vIFNldCB0aGUgdmFsdWUgb2YgYW4gb2JqZWN0IGJhc2VkIG9uIGEgZmxhdCBrZXkgKFwiYS5iLmNcIilcbmZ1bmN0aW9uIF9zZXQgKG9iamVjdCwga2V5LCB2YWx1ZSkge1xuICBjb25zdCBrZXlQYXJ0cyA9IGtleS5zcGxpdCgnLicpXG5cbiAgbGV0IHdhbGtpbmcgPSBvYmplY3RcbiAga2V5UGFydHMuZm9yRWFjaCgoa2V5LCBpbmRleCkgPT4ge1xuICAgIC8vIENyZWF0ZSB0aGUgbmVzdGVkIG9iamVjdCBpZiBpdCBkb2VzIG5vdCBleGlzdFxuICAgIGlmICghd2Fsa2luZ1trZXldKSB7XG4gICAgICB3YWxraW5nW2tleV0gPSB7fVxuICAgIH1cblxuICAgIC8vIElmIHdlIHJlYWNoZWQgdGhlIGxhc3QgcGFydCwgc2V0IHRoZSB2YWx1ZSBhbmQgZXhpdCBvdXRcbiAgICBpZiAoaW5kZXggPT09IGtleVBhcnRzLmxlbmd0aCAtIDEpIHtcbiAgICAgIHdhbGtpbmdba2V5XSA9IHZhbHVlXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICAvLyBTZXQgdGhlIG5leHQgcGFydCBvZiB0aGUga2V5XG4gICAgd2Fsa2luZyA9IHdhbGtpbmdba2V5XVxuICB9KVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGJsb2Jcbm1vZHVsZS5leHBvcnRzLndyYXAgPSB3cmFwXG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuY29uc3QgQ2hhcmFjdGVyc0VuZHBvaW50ID0gcmVxdWlyZSgnLi9jaGFyYWN0ZXJzJylcbmNvbnN0IFB2cEVuZHBvaW50ID0gcmVxdWlyZSgnLi9wdnAnKVxuY29uc3QgQ29tbWVyY2VFbmRwb2ludCA9IHJlcXVpcmUoJy4vY29tbWVyY2UnKVxuY29uc3QgV2l6YXJkc3ZhdWx0RW5kcG9pbnQgPSByZXF1aXJlKCcuL3dpemFyZHN2YXVsdCcpXG5jb25zdCBhY2NvdW50QmxvYiA9IHJlcXVpcmUoJy4vYWNjb3VudC1ibG9iLmpzJylcbmNvbnN0IHJlc2V0VGltZSA9IHJlcXVpcmUoJy4uL2hlbHBlcnMvcmVzZXRUaW1lJylcblxuY2xhc3MgQWNjb3VudEVuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxuXG4gIGFjaGlldmVtZW50cyAoKSB7XG4gICAgcmV0dXJuIG5ldyBBY2hpZXZlbWVudHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgYmFuayAoKSB7XG4gICAgcmV0dXJuIG5ldyBCYW5rRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGNoYXJhY3RlcnMgKG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IENoYXJhY3RlcnNFbmRwb2ludCh0aGlzLCBuYW1lKVxuICB9XG5cbiAgZGFpbHljcmFmdGluZyAoKSB7XG4gICAgcmV0dXJuIG5ldyBEYWlseWNyYWZ0aW5nRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGRlbGl2ZXJ5ICgpIHtcbiAgICByZXR1cm4gbmV3IENvbW1lcmNlRW5kcG9pbnQodGhpcykuZGVsaXZlcnkoKVxuICB9XG5cbiAgZHVuZ2VvbnMgKCkge1xuICAgIHJldHVybiBuZXcgRHVuZ2VvbnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgZHllcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBEeWVzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGVtb3RlcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBFbW90ZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgZmluaXNoZXJzICgpIHtcbiAgICByZXR1cm4gbmV3IEZpbmlzaGVyc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBnbGlkZXJzICgpIHtcbiAgICByZXR1cm4gbmV3IEdsaWRlcnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgaG9tZSAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNhdHM6ICgpID0+IG5ldyBIb21lQ2F0c0VuZHBvaW50KHRoaXMpLFxuICAgICAgbm9kZXM6ICgpID0+IG5ldyBIb21lTm9kZXNFbmRwb2ludCh0aGlzKVxuICAgIH1cbiAgfVxuXG4gIGhvbWVzdGVhZCAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRlY29yYXRpb25zOiAoKSA9PiBuZXcgSG9tZXN0ZWFkRGVjb3JhdGlvbnNFbmRwb2ludCh0aGlzKSxcbiAgICAgIGdseXBoczogKCkgPT4gbmV3IEhvbWVzdGVhZEdseXBoc0VuZHBvaW50KHRoaXMpXG4gICAgfVxuICB9XG5cbiAgaW52ZW50b3J5ICgpIHtcbiAgICByZXR1cm4gbmV3IEludmVudG9yeUVuZHBvaW50KHRoaXMpXG4gIH1cblxuICBqYWRlYm90cyAoKSB7XG4gICAgcmV0dXJuIG5ldyBKYWRlYm90c0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBsZWdlbmRhcnlhcm1vcnkgKCkge1xuICAgIHJldHVybiBuZXcgTGVnZW5kYXJ5YXJtb3J5RW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGx1Y2sgKCkge1xuICAgIHJldHVybiBuZXcgTHVja0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBtYWlsY2FycmllcnMgKCkge1xuICAgIHJldHVybiBuZXcgTWFpbGNhcnJpZXJzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIG1hc3RlcmllcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBNYXN0ZXJpZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgbWFwY2hlc3RzICgpIHtcbiAgICByZXR1cm4gbmV3IE1hcGNoZXN0c0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBtYXN0ZXJ5ICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcG9pbnRzOiAoKSA9PiBuZXcgTWFzdGVyeVBvaW50c0VuZHBvaW50KHRoaXMpXG4gICAgfVxuICB9XG5cbiAgbWF0ZXJpYWxzICgpIHtcbiAgICByZXR1cm4gbmV3IE1hdGVyaWFsc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBtaW5pcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBNaW5pc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBtb3VudHMgKCkge1xuICAgIHJldHVybiB7XG4gICAgICBza2luczogKCkgPT4gbmV3IE1vdW50U2tpbnNFbmRwb2ludCh0aGlzKSxcbiAgICAgIHR5cGVzOiAoKSA9PiBuZXcgTW91bnRUeXBlc0VuZHBvaW50KHRoaXMpXG4gICAgfVxuICB9XG5cbiAgbm92ZWx0aWVzICgpIHtcbiAgICByZXR1cm4gbmV3IE5vdmVsdGllc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBvdXRmaXRzICgpIHtcbiAgICByZXR1cm4gbmV3IE91dGZpdHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgcHZwICgpIHtcbiAgICByZXR1cm4gbmV3IFB2cEVuZHBvaW50KHRoaXMsIHRydWUpXG4gIH1cblxuICByYWlkcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBSYWlkc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICByZWNpcGVzICgpIHtcbiAgICByZXR1cm4gbmV3IFJlY2lwZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgc2tpZmZzICgpIHtcbiAgICByZXR1cm4gbmV3IFNraWZmc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBza2lucyAoKSB7XG4gICAgcmV0dXJuIG5ldyBTa2luc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICB0aXRsZXMgKCkge1xuICAgIHJldHVybiBuZXcgVGl0bGVzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIHRyYW5zYWN0aW9ucyAoKSB7XG4gICAgcmV0dXJuIG5ldyBDb21tZXJjZUVuZHBvaW50KHRoaXMpLnRyYW5zYWN0aW9ucygpXG4gIH1cblxuICB3YWxsZXQgKCkge1xuICAgIHJldHVybiBuZXcgV2FsbGV0RW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIHdpemFyZHN2YXVsdCAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxpc3RpbmdzOiAoKSA9PiBuZXcgV2l6YXJkc3ZhdWx0TGlzdGluZ3NFbmRwb2ludCh0aGlzKSxcbiAgICAgIGRhaWx5OiAoKSA9PiBuZXcgV2l6YXJkc3ZhdWx0RGFpbHlFbmRwb2ludCh0aGlzKSxcbiAgICAgIHdlZWtseTogKCkgPT4gbmV3IFdpemFyZHN2YXVsdFdlZWtseUVuZHBvaW50KHRoaXMpLFxuICAgICAgc3BlY2lhbDogKCkgPT4gbmV3IFdpemFyZHN2YXVsdFNwZWNpYWxFbmRwb2ludCh0aGlzKVxuICAgIH1cbiAgfVxuXG4gIHdvcmxkYm9zc2VzICgpIHtcbiAgICByZXR1cm4gbmV3IFdvcmxkYm9zc2VzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIC8vIEFsbCBkYXRhIGF2YWlsYWJsZSBmb3IgdGhlIGFjY291bnQgaW4gYSBzaW5nbGUgb2JqZWN0XG4gIGJsb2IgKCkge1xuICAgIHJldHVybiBhY2NvdW50QmxvYih0aGlzKVxuICB9XG59XG5cbmNsYXNzIEFjaGlldmVtZW50c0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvYWNoaWV2ZW1lbnRzJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxuXG4gIGlkcyAoKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignbWV0aG9kIG5vdCBzdXBwb3J0ZWQgZm9yIHRoaXMgZW5kcG9pbnQnKSlcbiAgfVxuXG4gIGdldCAoaWQpIHtcbiAgICBpZiAoaWQpIHtcbiAgICAgIHJldHVybiBzdXBlci5nZXQoaWQpXG4gICAgfVxuXG4gICAgLy8gVGhpcyBlbmRwb2ludCByZXR1cm5zIGFsbCBlbnRyaWVzIGlmIHRoZSB1cmwgZ2V0cyByZXF1ZXN0ZWRcbiAgICAvLyB3aXRob3V0IGFueSBwYXJhbWV0ZXJzLCBhbmFsb2d1ZSB0byB0aGUgb3RoZXIgYWNjb3VudCBlbmRwb2ludHNcbiAgICByZXR1cm4gdGhpcy5hbGwoKVxuICB9XG5cbiAgYWxsICgpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0KCcnLCB0cnVlKVxuICB9XG59XG5cbmNsYXNzIEJhbmtFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L2JhbmsnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBEYWlseWNyYWZ0aW5nRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9kYWlseWNyYWZ0aW5nJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBhc3luYyBnZXQgKCkge1xuICAgIHJldHVybiBhd2FpdCBpc1N0YWxlRGFpbHlEYXRhKHRoaXMpID8gW10gOiBzdXBlci5nZXQoKVxuICB9XG59XG5cbmNsYXNzIER1bmdlb25zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9kdW5nZW9ucydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG5cbiAgYXN5bmMgZ2V0ICgpIHtcbiAgICByZXR1cm4gYXdhaXQgaXNTdGFsZURhaWx5RGF0YSh0aGlzKSA/IFtdIDogc3VwZXIuZ2V0KClcbiAgfVxufVxuXG5jbGFzcyBEeWVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9keWVzJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgRW1vdGVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9lbW90ZXMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBGaW5pc2hlcnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L2ZpbmlzaGVycydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIEdsaWRlcnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L2dsaWRlcnMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBIb21lQ2F0c0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvaG9tZS9jYXRzJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgSG9tZU5vZGVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9ob21lL25vZGVzJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgSG9tZXN0ZWFkRGVjb3JhdGlvbnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L2hvbWVzdGVhZC9kZWNvcmF0aW9ucydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIEhvbWVzdGVhZEdseXBoc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvaG9tZXN0ZWFkL2dseXBocydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIEludmVudG9yeUVuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvaW52ZW50b3J5J1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgSmFkZWJvdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L2phZGVib3RzJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgTGVnZW5kYXJ5YXJtb3J5RW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9sZWdlbmRhcnlhcm1vcnknXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBMdWNrRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9sdWNrJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBhc3luYyBnZXQgKCkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc3VwZXIuZ2V0KClcbiAgICAvLyBbQVBJIFBBVENIICMwXSBJZiB0aGUgYWNjb3VudCBkb2VzIG5vdCBoYXZlIGFueSBsdWNrLCB0aGUgQVBJIGVycm9uZW91c2x5IHJldHVybnMgYFtdYFxuICAgIGlmIChyZXNwb25zZS5sZW5ndGggPT09IDApIHJldHVybiAwXG4gICAgcmV0dXJuIHJlc3BvbnNlWzBdLnZhbHVlXG4gIH1cbn1cblxuY2xhc3MgTWFpbGNhcnJpZXJzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9tYWlsY2FycmllcnMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBNYXBjaGVzdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L21hcGNoZXN0cydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG5cbiAgYXN5bmMgZ2V0ICgpIHtcbiAgICByZXR1cm4gYXdhaXQgaXNTdGFsZURhaWx5RGF0YSh0aGlzKSA/IFtdIDogc3VwZXIuZ2V0KClcbiAgfVxufVxuXG5jbGFzcyBNYXN0ZXJpZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L21hc3RlcmllcydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIE1hc3RlcnlQb2ludHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L21hc3RlcnkvcG9pbnRzJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgTWF0ZXJpYWxzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9tYXRlcmlhbHMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBNaW5pc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvbWluaXMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBNb3VudFNraW5zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9tb3VudHMvc2tpbnMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBNb3VudFR5cGVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9tb3VudHMvdHlwZXMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBOb3ZlbHRpZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L25vdmVsdGllcydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIE91dGZpdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L291dGZpdHMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBSYWlkc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvcmFpZHMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxuXG4gIGFzeW5jIGdldCAoKSB7XG4gICAgcmV0dXJuIGF3YWl0IGlzU3RhbGVXZWVrbHlEYXRhKHRoaXMpID8gW10gOiBzdXBlci5nZXQoKVxuICB9XG59XG5cbmNsYXNzIFJlY2lwZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L3JlY2lwZXMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBTa2lmZnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L3NraWZmcydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIFNraW5zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC9za2lucydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIFRpdGxlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvdGl0bGVzJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgV2FsbGV0RW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC93YWxsZXQnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBXb3JsZGJvc3Nlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvd29ybGRib3NzZXMnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxuXG4gIGFzeW5jIGdldCAoKSB7XG4gICAgcmV0dXJuIGF3YWl0IGlzU3RhbGVEYWlseURhdGEodGhpcykgPyBbXSA6IHN1cGVyLmdldCgpXG4gIH1cbn1cblxuY2xhc3MgV2l6YXJkc3ZhdWx0TGlzdGluZ3NFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L3dpemFyZHN2YXVsdC9saXN0aW5ncydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIFdpemFyZHN2YXVsdERhaWx5RW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNjb3VudC93aXphcmRzdmF1bHQvZGFpbHknXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG5cbiAgYXN5bmMgZ2V0ICgpIHtcbiAgICBjb25zdCBbcmVzcG9uc2UsIGlzU3RhbGVdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgc3VwZXIuZ2V0KCksXG4gICAgICBpc1N0YWxlRGFpbHlEYXRhKHRoaXMpXG4gICAgXSlcblxuICAgIGlmIChpc1N0YWxlKSB7XG4gICAgICByZXNwb25zZS5tZXRhX3Byb2dyZXNzX2N1cnJlbnQgPSAwXG4gICAgICByZXNwb25zZS5tZXRhX3Jld2FyZF9jbGFpbWVkID0gZmFsc2VcbiAgICAgIHJlc3BvbnNlLm9iamVjdGl2ZXMgPSBbXVxuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZVxuICB9XG59XG5cbmNsYXNzIFdpemFyZHN2YXVsdFdlZWtseUVuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvd2l6YXJkc3ZhdWx0L3dlZWtseSdcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBhc3luYyBnZXQgKCkge1xuICAgIGNvbnN0IFtyZXNwb25zZSwgaXNTdGFsZV0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBzdXBlci5nZXQoKSxcbiAgICAgIGlzU3RhbGVXZWVrbHlEYXRhKHRoaXMpXG4gICAgXSlcblxuICAgIGlmIChpc1N0YWxlKSB7XG4gICAgICByZXNwb25zZS5tZXRhX3Byb2dyZXNzX2N1cnJlbnQgPSAwXG4gICAgICByZXNwb25zZS5tZXRhX3Jld2FyZF9jbGFpbWVkID0gZmFsc2VcbiAgICAgIHJlc3BvbnNlLm9iamVjdGl2ZXMgPSBbXVxuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZVxuICB9XG59XG5cbmNsYXNzIFdpemFyZHN2YXVsdFNwZWNpYWxFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2NvdW50L3dpemFyZHN2YXVsdC9zcGVjaWFsJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxuXG4gIGFzeW5jIGdldCAoKSB7XG4gICAgY29uc3Qgc2Vhc29uID0gYXdhaXQgbmV3IFdpemFyZHN2YXVsdEVuZHBvaW50KHRoaXMpLmdldCgpXG5cbiAgICBjb25zdCBbcmVzcG9uc2UsIGlzU3RhbGVdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgc3VwZXIuZ2V0KCksXG4gICAgICBpc1N0YWxlRGF0YSh0aGlzLCBuZXcgRGF0ZShzZWFzb24uc3RhcnQpKVxuICAgIF0pXG5cbiAgICBpZiAoaXNTdGFsZSkge1xuICAgICAgcmVzcG9uc2Uub2JqZWN0aXZlcyA9IFtdXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3BvbnNlXG4gIH1cbn1cblxuLy8gU3RhbGUgZGF0YSBjYW4gaGFwcGVuIGlmIHRoZSBsYXN0IGFjY291bnQgdXBkYXRlIHdhcyBiZWZvcmUgdGhlIGxhc3QgZGFpbHkgcmVzZXRcbmFzeW5jIGZ1bmN0aW9uIGlzU3RhbGVEYWlseURhdGEgKGVuZHBvaW50SW5zdGFuY2UpIHtcbiAgcmV0dXJuIGlzU3RhbGVEYXRhKGVuZHBvaW50SW5zdGFuY2UsIHJlc2V0VGltZS5nZXRMYXN0RGFpbHlSZXNldCgpKVxufVxuXG4vLyBTdGFsZSBkYXRhIGNhbiBoYXBwZW4gaWYgdGhlIGxhc3QgYWNjb3VudCB1cGRhdGUgd2FzIGJlZm9yZSB0aGUgbGFzdCB3ZWVrbHkgcmVzZXRcbmFzeW5jIGZ1bmN0aW9uIGlzU3RhbGVXZWVrbHlEYXRhIChlbmRwb2ludEluc3RhbmNlKSB7XG4gIHJldHVybiBpc1N0YWxlRGF0YShlbmRwb2ludEluc3RhbmNlLCByZXNldFRpbWUuZ2V0TGFzdFdlZWtseVJlc2V0KCkpXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGlzU3RhbGVEYXRhIChlbmRwb2ludEluc3RhbmNlLCByZXNldERhdGUpIHtcbiAgY29uc3QgYWNjb3VudCA9IGF3YWl0IG5ldyBBY2NvdW50RW5kcG9pbnQoZW5kcG9pbnRJbnN0YW5jZSkuc2NoZW1hKCcyMDE5LTAzLTI2JykuZ2V0KClcbiAgcmV0dXJuIG5ldyBEYXRlKGFjY291bnQubGFzdF9tb2RpZmllZCkgPCByZXNldERhdGVcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBY2NvdW50RW5kcG9pbnRcbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgQWNoaWV2ZW1lbnRzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvYWNoaWV2ZW1lbnRzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5zdXBwb3J0c0J1bGtBbGwgPSBmYWxzZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxuXG4gIGNhdGVnb3JpZXMgKCkge1xuICAgIHJldHVybiBuZXcgQ2F0ZWdvcmllc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBncm91cHMgKCkge1xuICAgIHJldHVybiBuZXcgR3JvdXBzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGRhaWx5ICgpIHtcbiAgICByZXR1cm4gbmV3IERhaWx5RW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIGRhaWx5VG9tb3Jyb3cgKCkge1xuICAgIHJldHVybiBuZXcgRGFpbHlUb21vcnJvd0VuZHBvaW50KHRoaXMpXG4gIH1cbn1cblxuY2xhc3MgQ2F0ZWdvcmllc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjaGlldmVtZW50cy9jYXRlZ29yaWVzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG5cbmNsYXNzIEdyb3Vwc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjaGlldmVtZW50cy9ncm91cHMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgRGFpbHlFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9hY2hpZXZlbWVudHMvZGFpbHknXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgRGFpbHlUb21vcnJvd0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjaGlldmVtZW50cy9kYWlseS90b21vcnJvdydcbiAgICB0aGlzLmNhY2hlVGltZSA9IDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBCYWNrc3RvcnlFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBhbnN3ZXJzICgpIHtcbiAgICByZXR1cm4gbmV3IEFuc3dlcnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgcXVlc3Rpb25zICgpIHtcbiAgICByZXR1cm4gbmV3IFF1ZXN0aW9uc0VuZHBvaW50KHRoaXMpXG4gIH1cbn1cblxuY2xhc3MgQW5zd2Vyc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2JhY2tzdG9yeS9hbnN3ZXJzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5zdXBwb3J0c0J1bGtBbGwgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG5cbmNsYXNzIFF1ZXN0aW9uc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2JhY2tzdG9yeS9xdWVzdGlvbnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLnN1cHBvcnRzQnVsa0FsbCA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgQnVpbGRFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9idWlsZCdcbiAgICB0aGlzLmNhY2hlVGltZSA9IDYwXG4gIH1cblxuICBnZXQgKCkge1xuICAgIHJldHVybiBzdXBlci5nZXQoKS50aGVuKHJlc3VsdCA9PiByZXN1bHQuaWQpXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgQ2F0c0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2NhdHMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIENoYXJhY3RlcnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBuYW1lKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMubmFtZSA9IG5hbWVcbiAgICB0aGlzLnVybCA9ICcvdjIvY2hhcmFjdGVycydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuYnVsa0lkID0gJ25hbWUnXG4gICAgdGhpcy5zdXBwb3J0c0J1bGtBbGwgPSBmYWxzZVxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBiYWNrc3RvcnkgKCkge1xuICAgIHJldHVybiBuZXcgQmFja3N0b3J5RW5kcG9pbnQodGhpcywgdGhpcy5uYW1lKVxuICB9XG5cbiAgY29yZSAoKSB7XG4gICAgcmV0dXJuIG5ldyBDb3JlRW5kcG9pbnQodGhpcywgdGhpcy5uYW1lKVxuICB9XG5cbiAgY3JhZnRpbmcgKCkge1xuICAgIHJldHVybiBuZXcgQ3JhZnRpbmdFbmRwb2ludCh0aGlzLCB0aGlzLm5hbWUpXG4gIH1cblxuICBlcXVpcG1lbnQgKCkge1xuICAgIHJldHVybiBuZXcgRXF1aXBtZW50RW5kcG9pbnQodGhpcywgdGhpcy5uYW1lKVxuICB9XG5cbiAgaGVyb3BvaW50cyAoKSB7XG4gICAgcmV0dXJuIG5ldyBIZXJvcG9pbnRzRW5kcG9pbnQodGhpcywgdGhpcy5uYW1lKVxuICB9XG5cbiAgaW52ZW50b3J5ICgpIHtcbiAgICByZXR1cm4gbmV3IEludmVudG9yeUVuZHBvaW50KHRoaXMsIHRoaXMubmFtZSlcbiAgfVxuXG4gIHF1ZXN0cyAoKSB7XG4gICAgcmV0dXJuIG5ldyBRdWVzdHNFbmRwb2ludCh0aGlzLCB0aGlzLm5hbWUpXG4gIH1cblxuICByZWNpcGVzICgpIHtcbiAgICByZXR1cm4gbmV3IFJlY2lwZXNFbmRwb2ludCh0aGlzLCB0aGlzLm5hbWUpXG4gIH1cblxuICBzYWIgKCkge1xuICAgIHJldHVybiBuZXcgU2FiRW5kcG9pbnQodGhpcywgdGhpcy5uYW1lKVxuICB9XG5cbiAgc2tpbGxzICgpIHtcbiAgICByZXR1cm4gbmV3IFNraWxsc0VuZHBvaW50KHRoaXMsIHRoaXMubmFtZSlcbiAgfVxuXG4gIHNwZWNpYWxpemF0aW9ucyAoKSB7XG4gICAgcmV0dXJuIG5ldyBTcGVjaWFsaXphdGlvbnNFbmRwb2ludCh0aGlzLCB0aGlzLm5hbWUpXG4gIH1cblxuICB0cmFpbmluZyAoKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFpbmluZ0VuZHBvaW50KHRoaXMsIHRoaXMubmFtZSlcbiAgfVxufVxuXG5jbGFzcyBCYWNrc3RvcnlFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBjaGFyYWN0ZXIpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2NoYXJhY3RlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoY2hhcmFjdGVyKX0vYmFja3N0b3J5YFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBnZXQgKCkge1xuICAgIHJldHVybiBzdXBlci5nZXQoKS50aGVuKHJlc3VsdCA9PiByZXN1bHQuYmFja3N0b3J5KVxuICB9XG59XG5cbmNsYXNzIENvcmVFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBjaGFyYWN0ZXIpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2NoYXJhY3RlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoY2hhcmFjdGVyKX0vY29yZWBcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIENyYWZ0aW5nRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgY2hhcmFjdGVyKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gYC92Mi9jaGFyYWN0ZXJzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGNoYXJhY3Rlcil9L2NyYWZ0aW5nYFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBnZXQgKCkge1xuICAgIHJldHVybiBzdXBlci5nZXQoKS50aGVuKHJlc3VsdCA9PiByZXN1bHQuY3JhZnRpbmcpXG4gIH1cbn1cblxuY2xhc3MgRXF1aXBtZW50RW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgY2hhcmFjdGVyKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gYC92Mi9jaGFyYWN0ZXJzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGNoYXJhY3Rlcil9L2VxdWlwbWVudGBcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG5cbiAgZ2V0ICgpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0KCkudGhlbihyZXN1bHQgPT4gcmVzdWx0LmVxdWlwbWVudClcbiAgfVxufVxuXG5jbGFzcyBIZXJvcG9pbnRzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgY2hhcmFjdGVyKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gYC92Mi9jaGFyYWN0ZXJzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGNoYXJhY3Rlcil9L2hlcm9wb2ludHNgXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBJbnZlbnRvcnlFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBjaGFyYWN0ZXIpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2NoYXJhY3RlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoY2hhcmFjdGVyKX0vaW52ZW50b3J5YFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBnZXQgKCkge1xuICAgIHJldHVybiBzdXBlci5nZXQoKS50aGVuKHJlc3VsdCA9PiByZXN1bHQuYmFncylcbiAgfVxufVxuXG5jbGFzcyBRdWVzdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBjaGFyYWN0ZXIpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2NoYXJhY3RlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoY2hhcmFjdGVyKX0vcXVlc3RzYFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgUmVjaXBlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQsIGNoYXJhY3Rlcikge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9IGAvdjIvY2hhcmFjdGVycy8ke2VuY29kZVVSSUNvbXBvbmVudChjaGFyYWN0ZXIpfS9yZWNpcGVzYFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBnZXQgKCkge1xuICAgIHJldHVybiBzdXBlci5nZXQoKS50aGVuKHJlc3VsdCA9PiByZXN1bHQucmVjaXBlcylcbiAgfVxufVxuXG5jbGFzcyBTYWJFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBjaGFyYWN0ZXIpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2NoYXJhY3RlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoY2hhcmFjdGVyKX0vc2FiYFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgU2tpbGxzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgY2hhcmFjdGVyKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gYC92Mi9jaGFyYWN0ZXJzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGNoYXJhY3Rlcil9L3NraWxsc2BcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG5cbiAgZ2V0ICgpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0KCkudGhlbihyZXN1bHQgPT4gcmVzdWx0LnNraWxscylcbiAgfVxufVxuXG5jbGFzcyBTcGVjaWFsaXphdGlvbnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBjaGFyYWN0ZXIpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2NoYXJhY3RlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoY2hhcmFjdGVyKX0vc3BlY2lhbGl6YXRpb25zYFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBnZXQgKCkge1xuICAgIHJldHVybiBzdXBlci5nZXQoKS50aGVuKHJlc3VsdCA9PiByZXN1bHQuc3BlY2lhbGl6YXRpb25zKVxuICB9XG59XG5cbmNsYXNzIFRyYWluaW5nRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgY2hhcmFjdGVyKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gYC92Mi9jaGFyYWN0ZXJzLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGNoYXJhY3Rlcil9L3RyYWluaW5nYFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBnZXQgKCkge1xuICAgIHJldHVybiBzdXBlci5nZXQoKS50aGVuKHJlc3VsdCA9PiByZXN1bHQudHJhaW5pbmcpXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgQ29sb3JzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvY29sb3JzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIENvbW1lcmNlRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgLy8gQ3VycmVudCB0aGluZ3MgdG8gZ3JhYiBpbiB0aGUgZGVsaXZlcnkgYm94XG4gIGRlbGl2ZXJ5ICgpIHtcbiAgICByZXR1cm4gbmV3IERlbGl2ZXJ5RW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIC8vIEN1cnJlbnQgZ2VtL2NvaW4gZXhjaGFuZ2UgcmF0ZXNcbiAgZXhjaGFuZ2UgKCkge1xuICAgIHJldHVybiBuZXcgRXhjaGFuZ2VFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgLy8gQ3VycmVudCB0cmFkaW5ncG9zdCBsaXN0aW5nc1xuICBsaXN0aW5ncyAoKSB7XG4gICAgcmV0dXJuIG5ldyBMaXN0aW5nc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICAvLyBDdXJyZW50IHRyYWRpbmdwb3N0IHByaWNlc1xuICBwcmljZXMgKCkge1xuICAgIHJldHVybiBuZXcgUHJpY2VzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIC8vIEN1cnJlbnQgYW5kIGNvbXBsZXRlZCB0cmFuc2FjdGlvbnNcbiAgdHJhbnNhY3Rpb25zICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgY3VycmVudDogKCkgPT4gKHtcbiAgICAgICAgYnV5czogKCkgPT4gbmV3IFRyYW5zYWN0aW9uc0VuZHBvaW50KHRoaXMsICdjdXJyZW50JywgJ2J1eXMnKSxcbiAgICAgICAgc2VsbHM6ICgpID0+IG5ldyBUcmFuc2FjdGlvbnNFbmRwb2ludCh0aGlzLCAnY3VycmVudCcsICdzZWxscycpXG4gICAgICB9KSxcbiAgICAgIGhpc3Rvcnk6ICgpID0+ICh7XG4gICAgICAgIGJ1eXM6ICgpID0+IG5ldyBUcmFuc2FjdGlvbnNFbmRwb2ludCh0aGlzLCAnaGlzdG9yeScsICdidXlzJyksXG4gICAgICAgIHNlbGxzOiAoKSA9PiBuZXcgVHJhbnNhY3Rpb25zRW5kcG9pbnQodGhpcywgJ2hpc3RvcnknLCAnc2VsbHMnKVxuICAgICAgfSlcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgRGVsaXZlcnlFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gYC92Mi9jb21tZXJjZS9kZWxpdmVyeWBcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIEV4Y2hhbmdlRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvY29tbWVyY2UvZXhjaGFuZ2UnXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAxMCAqIDYwXG4gIH1cblxuICBnZW1zIChxdWFudGl0eSkge1xuICAgIHJldHVybiBzdXBlci5nZXQoYC9nZW1zP3F1YW50aXR5PSR7cXVhbnRpdHl9YCwgdHJ1ZSlcbiAgfVxuXG4gIGNvaW5zIChxdWFudGl0eSkge1xuICAgIHJldHVybiBzdXBlci5nZXQoYC9jb2lucz9xdWFudGl0eT0ke3F1YW50aXR5fWAsIHRydWUpXG4gIH1cbn1cblxuY2xhc3MgTGlzdGluZ3NFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9jb21tZXJjZS9saXN0aW5ncydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuc3VwcG9ydHNCdWxrQWxsID0gZmFsc2VcbiAgICB0aGlzLmNhY2hlVGltZSA9IDIgKiA2MFxuICB9XG59XG5cbmNsYXNzIFByaWNlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2NvbW1lcmNlL3ByaWNlcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuc3VwcG9ydHNCdWxrQWxsID0gZmFsc2VcbiAgICB0aGlzLmNhY2hlVGltZSA9IDYwXG4gIH1cbn1cblxuY2xhc3MgVHJhbnNhY3Rpb25zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgdHlwZSwgbGlzdCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9IGAvdjIvY29tbWVyY2UvdHJhbnNhY3Rpb25zLyR7dHlwZX0vJHtsaXN0fWBcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMTAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIENvbnRpbmVudHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9jb250aW5lbnRzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG5cbiAgZmxvb3JzIChpZCkge1xuICAgIHJldHVybiBuZXcgRmxvb3JzRW5kcG9pbnQodGhpcywgaWQpXG4gIH1cbn1cblxuY2xhc3MgRmxvb3JzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgY29udGluZW50SWQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2NvbnRpbmVudHMvJHtjb250aW5lbnRJZH0vZmxvb3JzYFxuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIEN1cnJlbmNpZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9jdXJyZW5jaWVzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIERhaWx5Y3JhZnRpbmdFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9kYWlseWNyYWZ0aW5nJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIER1bmdlb25zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvZHVuZ2VvbnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIEVtYmxlbUVuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGJhY2tncm91bmRzICgpIHtcbiAgICByZXR1cm4gbmV3IExheWVyc0VuZHBvaW50KHRoaXMsICdiYWNrZ3JvdW5kcycpXG4gIH1cblxuICBmb3JlZ3JvdW5kcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBMYXllcnNFbmRwb2ludCh0aGlzLCAnZm9yZWdyb3VuZHMnKVxuICB9XG59XG5cbmNsYXNzIExheWVyc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQsIGxheWVyKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gYC92Mi9lbWJsZW0vJHtsYXllcn1gXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIEVtb3Rlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2Vtb3RlcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBFdmVudHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92MS9ldmVudF9kZXRhaWxzLmpzb24nXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxuXG4gIGFsbCAoKSB7XG4gICAgcmV0dXJuIHN1cGVyLmdldCgpLnRoZW4odHJhbnNmb3JtVjFGb3JtYXQpXG4gIH1cblxuICBnZXQgKGlkKSB7XG4gICAgcmV0dXJuIHN1cGVyLmdldChgP2V2ZW50X2lkPSR7aWR9YCwgdHJ1ZSkudGhlbihqc29uID0+IHRyYW5zZm9ybVYxRm9ybWF0KGpzb24pWzBdKVxuICB9XG59XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybVYxRm9ybWF0IChqc29uKSB7XG4gIGxldCBldmVudHMgPSBqc29uLmV2ZW50c1xuICBsZXQgdHJhbnNmb3JtZWQgPSBbXVxuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZXZlbnRzKVxuXG4gIGZvciAobGV0IGkgPSAwOyBpICE9PSBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgdHJhbnNmb3JtZWQucHVzaChPYmplY3QuYXNzaWduKHsgaWQ6IGtleXNbaV0gfSwgZXZlbnRzW2tleXNbaV1dKSlcbiAgfVxuXG4gIHJldHVybiB0cmFuc2Zvcm1lZFxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBGaWxlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2ZpbGVzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBGaW5pc2hlcnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9maW5pc2hlcnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgR2xpZGVyc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2dsaWRlcnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgR3VpbGRFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBpZCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLmlkID0gaWRcbiAgICB0aGlzLnVybCA9ICcvdjIvZ3VpbGQnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc09wdGlvbmFsbHlBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNjAgKiA2MFxuICB9XG5cbiAgZ2V0IChpZCkge1xuICAgIHJldHVybiBzdXBlci5nZXQoYC8ke2lkfWAsIHRydWUpXG4gIH1cblxuICBwZXJtaXNzaW9ucyAoKSB7XG4gICAgcmV0dXJuIG5ldyBQZXJtaXNzaW9uc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBzZWFyY2ggKG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IFNlYXJjaEVuZHBvaW50KHRoaXMsIG5hbWUpXG4gIH1cblxuICB1cGdyYWRlcyAoKSB7XG4gICAgaWYgKHRoaXMuaWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIG5ldyBBbGxVcGdyYWRlc0VuZHBvaW50KHRoaXMpXG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBVcGdyYWRlc0VuZHBvaW50KHRoaXMsIHRoaXMuaWQpXG4gIH1cblxuICBsb2cgKCkge1xuICAgIHJldHVybiBuZXcgTG9nRW5kcG9pbnQodGhpcywgdGhpcy5pZClcbiAgfVxuXG4gIG1lbWJlcnMgKCkge1xuICAgIHJldHVybiBuZXcgTWVtYmVyc0VuZHBvaW50KHRoaXMsIHRoaXMuaWQpXG4gIH1cblxuICByYW5rcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBSYW5rc0VuZHBvaW50KHRoaXMsIHRoaXMuaWQpXG4gIH1cblxuICBzdGFzaCAoKSB7XG4gICAgcmV0dXJuIG5ldyBTdGFzaEVuZHBvaW50KHRoaXMsIHRoaXMuaWQpXG4gIH1cblxuICBzdG9yYWdlICgpIHtcbiAgICByZXR1cm4gbmV3IFN0b3JhZ2VFbmRwb2ludCh0aGlzLCB0aGlzLmlkKVxuICB9XG5cbiAgdGVhbXMgKCkge1xuICAgIHJldHVybiBuZXcgVGVhbXNFbmRwb2ludCh0aGlzLCB0aGlzLmlkKVxuICB9XG5cbiAgdHJlYXN1cnkgKCkge1xuICAgIHJldHVybiBuZXcgVHJlYXN1cnlFbmRwb2ludCh0aGlzLCB0aGlzLmlkKVxuICB9XG59XG5cbmNsYXNzIFBlcm1pc3Npb25zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvZ3VpbGQvcGVybWlzc2lvbnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgU2VhcmNoRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvZ3VpbGQvc2VhcmNoJ1xuICAgIHRoaXMuY2FjaGVUaW1lID0gNjAgKiA2MFxuICB9XG5cbiAgbmFtZSAobmFtZSkge1xuICAgIHJldHVybiBzdXBlci5nZXQoYD9uYW1lPSR7ZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpfWAsIHRydWUpXG4gICAgICAudGhlbihyZXN1bHQgPT4gcmVzdWx0WzBdKVxuICB9XG59XG5cbmNsYXNzIEFsbFVwZ3JhZGVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvZ3VpbGQvdXBncmFkZXMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgTG9nRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgaWQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2d1aWxkLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGlkKX0vbG9nYFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cblxuICBzaW5jZSAobG9nSWQpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0KGA/c2luY2U9JHtsb2dJZH1gLCB0cnVlKVxuICB9XG59XG5cbmNsYXNzIE1lbWJlcnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBpZCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9IGAvdjIvZ3VpbGQvJHtlbmNvZGVVUklDb21wb25lbnQoaWQpfS9tZW1iZXJzYFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgUmFua3NFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBpZCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9IGAvdjIvZ3VpbGQvJHtlbmNvZGVVUklDb21wb25lbnQoaWQpfS9yYW5rc2BcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIFN0YXNoRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgaWQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2d1aWxkLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGlkKX0vc3Rhc2hgXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBTdG9yYWdlRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgaWQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2d1aWxkLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGlkKX0vc3RvcmFnZWBcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIFRlYW1zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgaWQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL2d1aWxkLyR7ZW5jb2RlVVJJQ29tcG9uZW50KGlkKX0vdGVhbXNgXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBUcmVhc3VyeUVuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQsIGlkKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gYC92Mi9ndWlsZC8ke2VuY29kZVVSSUNvbXBvbmVudChpZCl9L3RyZWFzdXJ5YFxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgVXBncmFkZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBpZCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9IGAvdjIvZ3VpbGQvJHtlbmNvZGVVUklDb21wb25lbnQoaWQpfS91cGdyYWRlc2BcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIEhvbWVFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjYXRzICgpIHtcbiAgICByZXR1cm4gbmV3IENhdHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgbm9kZXMgKCkge1xuICAgIHJldHVybiBuZXcgTm9kZXNFbmRwb2ludCh0aGlzKVxuICB9XG59XG5cbmNsYXNzIENhdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9ob21lL2NhdHMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG5cbmNsYXNzIE5vZGVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvaG9tZS9ub2RlcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgSG9tZXN0ZWFkRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgZGVjb3JhdGlvbnMgKCkge1xuICAgIHJldHVybiBuZXcgRGVjb3JhdGlvbnNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgZ2x5cGhzICgpIHtcbiAgICByZXR1cm4gbmV3IEdseXBoc0VuZHBvaW50KHRoaXMpXG4gIH1cbn1cblxuY2xhc3MgRGVjb3JhdGlvbnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9ob21lc3RlYWQvZGVjb3JhdGlvbnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuc3VwcG9ydHNCdWxrQWxsID0gZmFsc2VcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG5cbiAgY2F0ZWdvcmllcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBEZWNvcmF0aW9uc0NhdGVnb3JpZXNFbmRwb2ludCh0aGlzKVxuICB9XG59XG5cbmNsYXNzIEdseXBoc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2hvbWVzdGVhZC9nbHlwaHMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG5cbmNsYXNzIERlY29yYXRpb25zQ2F0ZWdvcmllc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2hvbWVzdGVhZC9kZWNvcmF0aW9ucy9jYXRlZ29yaWVzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgQWNjb3VudEVuZHBvaW50OiByZXF1aXJlKCcuL2FjY291bnQnKSxcbiAgQWNoaWV2ZW1lbnRzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vYWNoaWV2ZW1lbnRzJyksXG4gIEJhY2tzdG9yeUVuZHBvaW50OiByZXF1aXJlKCcuL2JhY2tzdG9yeScpLFxuICBCdWlsZEVuZHBvaW50OiByZXF1aXJlKCcuL2J1aWxkJyksXG4gIENhdHNFbmRwb2ludDogcmVxdWlyZSgnLi9jYXRzJyksXG4gIENoYXJhY3RlcnNFbmRwb2ludDogcmVxdWlyZSgnLi9jaGFyYWN0ZXJzJyksXG4gIENvbG9yc0VuZHBvaW50OiByZXF1aXJlKCcuL2NvbG9ycycpLFxuICBDb21tZXJjZUVuZHBvaW50OiByZXF1aXJlKCcuL2NvbW1lcmNlJyksXG4gIENvbnRpbmVudHNFbmRwb2ludDogcmVxdWlyZSgnLi9jb250aW5lbnRzJyksXG4gIEN1cnJlbmNpZXNFbmRwb2ludDogcmVxdWlyZSgnLi9jdXJyZW5jaWVzJyksXG4gIERhaWx5Y3JhZnRpbmdFbmRwb2ludDogcmVxdWlyZSgnLi9kYWlseWNyYWZ0aW5nJyksXG4gIER1bmdlb25zRW5kcG9pbnQ6IHJlcXVpcmUoJy4vZHVuZ2VvbnMnKSxcbiAgRW1ibGVtRW5kcG9pbnQ6IHJlcXVpcmUoJy4vZW1ibGVtJyksXG4gIEVtb3Rlc0VuZHBvaW50OiByZXF1aXJlKCcuL2Vtb3RlcycpLFxuICBFdmVudHNFbmRwb2ludDogcmVxdWlyZSgnLi9ldmVudHMnKSxcbiAgRmlsZXNFbmRwb2ludDogcmVxdWlyZSgnLi9maWxlcycpLFxuICBGaW5pc2hlcnNFbmRwb2ludDogcmVxdWlyZSgnLi9maW5pc2hlcnMnKSxcbiAgR2xpZGVyc0VuZHBvaW50OiByZXF1aXJlKCcuL2dsaWRlcnMnKSxcbiAgR3VpbGRFbmRwb2ludDogcmVxdWlyZSgnLi9ndWlsZCcpLFxuICBIb21lRW5kcG9pbnQ6IHJlcXVpcmUoJy4vaG9tZScpLFxuICBIb21lc3RlYWRFbmRwb2ludDogcmVxdWlyZSgnLi9ob21lc3RlYWQnKSxcbiAgSXRlbXNFbmRwb2ludDogcmVxdWlyZSgnLi9pdGVtcycpLFxuICBJdGVtc3RhdHNFbmRwb2ludDogcmVxdWlyZSgnLi9pdGVtc3RhdHMnKSxcbiAgSmFkZWJvdHNFbmRwb2ludDogcmVxdWlyZSgnLi9qYWRlYm90cycpLFxuICBMZWdlbmRhcnlhcm1vcnlFbmRwb2ludDogcmVxdWlyZSgnLi9sZWdlbmRhcnlhcm1vcnknKSxcbiAgTGVnZW5kc0VuZHBvaW50OiByZXF1aXJlKCcuL2xlZ2VuZHMnKSxcbiAgTWFpbGNhcnJpZXJzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vbWFpbGNhcnJpZXJzJyksXG4gIE1hcGNoZXN0c0VuZHBvaW50OiByZXF1aXJlKCcuL21hcGNoZXN0cycpLFxuICBNYXBzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vbWFwcycpLFxuICBNYXN0ZXJpZXNFbmRwb2ludDogcmVxdWlyZSgnLi9tYXN0ZXJpZXMnKSxcbiAgTWF0ZXJpYWxzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vbWF0ZXJpYWxzJyksXG4gIE1pbmlzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vbWluaXMnKSxcbiAgTW91bnRzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vbW91bnRzJyksXG4gIE5vZGVzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vbm9kZXMnKSxcbiAgTm92ZWx0aWVzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vbm92ZWx0aWVzJyksXG4gIE91dGZpdHNFbmRwb2ludDogcmVxdWlyZSgnLi9vdXRmaXRzJyksXG4gIFBldHNFbmRwb2ludDogcmVxdWlyZSgnLi9wZXRzJyksXG4gIFByb2Zlc3Npb25zRW5kcG9pbnQ6IHJlcXVpcmUoJy4vcHJvZmVzc2lvbnMnKSxcbiAgUHZwRW5kcG9pbnQ6IHJlcXVpcmUoJy4vcHZwJyksXG4gIFF1YWdnYW5zRW5kcG9pbnQ6IHJlcXVpcmUoJy4vcXVhZ2dhbnMnKSxcbiAgUXVlc3RzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vcXVlc3RzJyksXG4gIFJhY2VzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vcmFjZXMnKSxcbiAgUmFpZHNFbmRwb2ludDogcmVxdWlyZSgnLi9yYWlkcycpLFxuICBSZWNpcGVzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vcmVjaXBlcycpLFxuICBTa2lmZnNFbmRwb2ludDogcmVxdWlyZSgnLi9za2lmZnMnKSxcbiAgU2tpbGxzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vc2tpbGxzJyksXG4gIFNraW5zRW5kcG9pbnQ6IHJlcXVpcmUoJy4vc2tpbnMnKSxcbiAgU3BlY2lhbGl6YXRpb25zRW5kcG9pbnQ6IHJlcXVpcmUoJy4vc3BlY2lhbGl6YXRpb25zJyksXG4gIFN0b3JpZXNFbmRwb2ludDogcmVxdWlyZSgnLi9zdG9yaWVzJyksXG4gIFRpdGxlc0VuZHBvaW50OiByZXF1aXJlKCcuL3RpdGxlcycpLFxuICBUb2tlbmluZm9FbmRwb2ludDogcmVxdWlyZSgnLi90b2tlbmluZm8nKSxcbiAgVHJhaXRzRW5kcG9pbnQ6IHJlcXVpcmUoJy4vdHJhaXRzJyksXG4gIFdpemFyZHN2YXVsdEVuZHBvaW50OiByZXF1aXJlKCcuL3dpemFyZHN2YXVsdCcpLFxuICBXb3JsZGJvc3Nlc0VuZHBvaW50OiByZXF1aXJlKCcuL3dvcmxkYm9zc2VzJyksXG4gIFdvcmxkc0VuZHBvaW50OiByZXF1aXJlKCcuL3dvcmxkcycpLFxuICBXdndFbmRwb2ludDogcmVxdWlyZSgnLi93dncnKVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBJdGVtc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2l0ZW1zJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5zdXBwb3J0c0J1bGtBbGwgPSBmYWxzZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBJdGVtc3RhdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9pdGVtc3RhdHMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgSmFkZWJvdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9qYWRlYm90cydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBMZWdlbmRhcnlhcm1vcnlFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9sZWdlbmRhcnlhcm1vcnknXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIExlZ2VuZHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9sZWdlbmRzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBNYWlsY2FycmllcnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9tYWlsY2FycmllcnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgTWFwY2hlc3RzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvbWFwY2hlc3RzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIE1hcHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9tYXBzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIE1hc3Rlcmllc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL21hc3RlcmllcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBNYXRlcmlhbHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9tYXRlcmlhbHMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgTWluaXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9taW5pcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBNb3VudHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBza2lucyAoKSB7XG4gICAgcmV0dXJuIG5ldyBTa2luc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICB0eXBlcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBUeXBlc0VuZHBvaW50KHRoaXMpXG4gIH1cbn1cblxuY2xhc3MgU2tpbnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9tb3VudHMvc2tpbnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgVHlwZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9tb3VudHMvdHlwZXMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgTm9kZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9ub2RlcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgTm92ZWx0aWVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvbm92ZWx0aWVzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIE91dGZpdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9vdXRmaXRzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFBldHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9wZXRzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFByb2Zlc3Npb25zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvcHJvZmVzc2lvbnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgUHZwRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgZnJvbUFjY291bnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy5mcm9tQWNjb3VudCA9IGZyb21BY2NvdW50XG4gIH1cblxuICBhbXVsZXRzICgpIHtcbiAgICByZXR1cm4gbmV3IEFtdWxldHNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgZ2FtZXMgKCkge1xuICAgIHJldHVybiBuZXcgR2FtZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgaGVyb2VzICgpIHtcbiAgICBpZiAodGhpcy5mcm9tQWNjb3VudCkge1xuICAgICAgcmV0dXJuIG5ldyBBY2NvdW50SGVyb2VzRW5kcG9pbnQodGhpcylcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IEhlcm9lc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICByYW5rcyAoKSB7XG4gICAgcmV0dXJuIG5ldyBSYW5rc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBzZWFzb25zIChpZCkge1xuICAgIHJldHVybiBuZXcgU2Vhc29uc0VuZHBvaW50KHRoaXMsIGlkKVxuICB9XG5cbiAgc3RhbmRpbmdzICgpIHtcbiAgICByZXR1cm4gbmV3IFN0YW5kaW5nc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBzdGF0cyAoKSB7XG4gICAgcmV0dXJuIG5ldyBTdGF0c0VuZHBvaW50KHRoaXMpXG4gIH1cbn1cblxuY2xhc3MgQWNjb3VudEhlcm9lc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL2FjY291bnQvcHZwL2hlcm9lcydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIEFtdWxldHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9wdnAvYW11bGV0cydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuXG5jbGFzcyBHYW1lc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3B2cC9nYW1lcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNSAqIDYwXG4gIH1cbn1cblxuY2xhc3MgSGVyb2VzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvcHZwL2hlcm9lcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuXG5jbGFzcyBSYW5rc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3B2cC9yYW5rcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuXG5jbGFzcyBTZWFzb25zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgaWQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy5pZCA9IGlkXG4gICAgdGhpcy51cmwgPSAnL3YyL3B2cC9zZWFzb25zJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG5cbiAgbGVhZGVyYm9hcmRzICgpIHtcbiAgICByZXR1cm4gbmV3IFNlYXNvbkxlYWRlcmJvYXJkRW5kcG9pbnQodGhpcywgdGhpcy5pZClcbiAgfVxufVxuXG5jbGFzcyBTZWFzb25MZWFkZXJib2FyZEVuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQsIGlkKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMuaWQgPSBpZFxuICAgIHRoaXMudXJsID0gYC92Mi9wdnAvc2Vhc29ucy8ke2lkfS9sZWFkZXJib2FyZHNgXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxuXG4gIGlkcyAoKSB7XG4gICAgcmV0dXJuIHN1cGVyLmdldCgnJywgdHJ1ZSlcbiAgfVxuXG4gIGJvYXJkIChib2FyZCwgcmVnaW9uKSB7XG4gICAgcmV0dXJuIG5ldyBTZWFzb25MZWFkZXJib2FyZEJvYXJkRW5kcG9pbnQodGhpcywgdGhpcy5pZCwgYm9hcmQsIHJlZ2lvbilcbiAgfVxufVxuXG5jbGFzcyBTZWFzb25MZWFkZXJib2FyZEJvYXJkRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCwgaWQsIGJvYXJkLCByZWdpb24pIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSBgL3YyL3B2cC9zZWFzb25zLyR7aWR9L2xlYWRlcmJvYXJkcy8ke2JvYXJkfS8ke3JlZ2lvbn1gXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG5cbmNsYXNzIFN0YW5kaW5nc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3B2cC9zdGFuZGluZ3MnXG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA1ICogNjBcbiAgfVxufVxuXG5jbGFzcyBTdGF0c0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3B2cC9zdGF0cydcbiAgICB0aGlzLmlzQXV0aGVudGljYXRlZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDUgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFF1YWdnYW5zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvcXVhZ2dhbnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFF1ZXN0c0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3F1ZXN0cydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBSYWNlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3JhY2VzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFJhaWRzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvcmFpZHMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFJlY2lwZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9yZWNpcGVzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5zdXBwb3J0c0J1bGtBbGwgPSBmYWxzZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cblxuICBzZWFyY2ggKCkge1xuICAgIHJldHVybiBuZXcgU2VhcmNoRW5kcG9pbnQodGhpcylcbiAgfVxufVxuXG5jbGFzcyBTZWFyY2hFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9yZWNpcGVzL3NlYXJjaCdcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG5cbiAgaW5wdXQgKGlkKSB7XG4gICAgcmV0dXJuIHN1cGVyLmdldChgP2lucHV0PSR7aWR9YCwgdHJ1ZSlcbiAgfVxuXG4gIG91dHB1dCAoaWQpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0KGA/b3V0cHV0PSR7aWR9YCwgdHJ1ZSlcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBTa2lmZnNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi9za2lmZnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgU2tpbGxzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvc2tpbGxzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFNraW5zRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvc2tpbnMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLnN1cHBvcnRzQnVsa0FsbCA9IGZhbHNlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFNwZWNpYWxpemF0aW9uc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3NwZWNpYWxpemF0aW9ucydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBTdG9yaWVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvc3RvcmllcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxuXG4gIHNlYXNvbnMgKCkge1xuICAgIHJldHVybiBuZXcgU2Vhc29uc0VuZHBvaW50KHRoaXMpXG4gIH1cbn1cblxuY2xhc3MgU2Vhc29uc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3N0b3JpZXMvc2Vhc29ucydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBUaXRsZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi90aXRsZXMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgVG9rZW5pbmZvRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvdG9rZW5pbmZvJ1xuICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBUcmFpdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi90cmFpdHMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImNvbnN0IEFic3RyYWN0RW5kcG9pbnQgPSByZXF1aXJlKCcuLi9lbmRwb2ludCcpXG5cbm1vZHVsZS5leHBvcnRzID0gY2xhc3MgV2l6YXJkc3ZhdWx0RW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvd2l6YXJkc3ZhdWx0J1xuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA2MCAqIDYwXG4gIH1cblxuICBsaXN0aW5ncyAoKSB7XG4gICAgcmV0dXJuIG5ldyBMaXN0aW5nc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBvYmplY3RpdmVzICgpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdGl2ZXNFbmRwb2ludCh0aGlzKVxuICB9XG59XG5cbmNsYXNzIExpc3RpbmdzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvd2l6YXJkc3ZhdWx0L2xpc3RpbmdzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IGZhbHNlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgT2JqZWN0aXZlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3dpemFyZHN2YXVsdC9vYmplY3RpdmVzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBXb3JsZGJvc3Nlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3dvcmxkYm9zc2VzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5pc0xvY2FsaXplZCA9IHRydWVcbiAgICB0aGlzLmNhY2hlVGltZSA9IDI0ICogNjAgKiA2MFxuICB9XG59XG4iLCJjb25zdCBBYnN0cmFjdEVuZHBvaW50ID0gcmVxdWlyZSgnLi4vZW5kcG9pbnQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNsYXNzIFdvcmxkc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3dvcmxkcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuaXNMb2NhbGl6ZWQgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAyNCAqIDYwICogNjBcbiAgfVxufVxuIiwiY29uc3QgQWJzdHJhY3RFbmRwb2ludCA9IHJlcXVpcmUoJy4uL2VuZHBvaW50JylcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBXdndFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBhYmlsaXRpZXMgKCkge1xuICAgIHJldHVybiBuZXcgQWJpbGl0aWVzRW5kcG9pbnQodGhpcylcbiAgfVxuXG4gIG1hdGNoZXMgKCkge1xuICAgIHJldHVybiBuZXcgTWF0Y2hlc0VuZHBvaW50KHRoaXMpXG4gIH1cblxuICBvYmplY3RpdmVzICgpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdGl2ZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgdXBncmFkZXMgKCkge1xuICAgIHJldHVybiBuZXcgVXBncmFkZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgcmFua3MgKCkge1xuICAgIHJldHVybiBuZXcgUmFua3NFbmRwb2ludCh0aGlzKVxuICB9XG59XG5cbmNsYXNzIEFiaWxpdGllc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3d2dy9hYmlsaXRpZXMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgTWF0Y2hlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3d2dy9tYXRjaGVzJ1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAzMFxuICB9XG5cbiAgd29ybGQgKHdvcmxkSWQpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0KGA/d29ybGQ9JHt3b3JsZElkfWAsIHRydWUpXG4gIH1cblxuICBvdmVydmlldyAoKSB7XG4gICAgcmV0dXJuIG5ldyBNYXRjaGVzT3ZlcnZpZXdFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgc2NvcmVzICgpIHtcbiAgICByZXR1cm4gbmV3IE1hdGNoZXNTY29yZXNFbmRwb2ludCh0aGlzKVxuICB9XG5cbiAgc3RhdHMgKGlkKSB7XG4gICAgcmV0dXJuIG5ldyBNYXRjaGVzU3RhdHNFbmRwb2ludCh0aGlzLCBpZClcbiAgfVxufVxuXG5jbGFzcyBUZWFtc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQsIGlkLCB0ZWFtKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudGVhbSA9IHRlYW1cbiAgICB0aGlzLmlkID0gaWRcbiAgICB0aGlzLnVybCA9IGAvdjIvd3Z3L21hdGNoZXMvc3RhdHMvJHtpZH0vdGVhbXNgXG4gIH1cblxuICB0b3AgKHdoaWNoKSB7XG4gICAgcmV0dXJuIG5ldyBUb3BTdGF0c0VuZHBvaW50KHRoaXMsIHRoaXMuaWQsIHRoaXMudGVhbSwgd2hpY2gpXG4gIH1cbn1cblxuY2xhc3MgVG9wU3RhdHNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50LCBpZCwgdGVhbSwgd2hpY2gpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy53aGljaCA9IHdoaWNoXG4gICAgdGhpcy51cmwgPSBgL3YyL3d2dy9tYXRjaGVzL3N0YXRzLyR7aWR9L3RlYW1zLyR7dGVhbX0vdG9wLyR7d2hpY2h9YFxuICB9XG59XG5cbmNsYXNzIE1hdGNoZXNPdmVydmlld0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3d2dy9tYXRjaGVzL292ZXJ2aWV3J1xuICAgIHRoaXMuaXNQYWdpbmF0ZWQgPSB0cnVlXG4gICAgdGhpcy5pc0J1bGsgPSB0cnVlXG4gICAgdGhpcy5jYWNoZVRpbWUgPSAzMFxuICB9XG5cbiAgd29ybGQgKHdvcmxkSWQpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0KGA/d29ybGQ9JHt3b3JsZElkfWAsIHRydWUpXG4gIH1cbn1cblxuY2xhc3MgTWF0Y2hlc1Njb3Jlc0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQpIHtcbiAgICBzdXBlcihjbGllbnQpXG4gICAgdGhpcy51cmwgPSAnL3YyL3d2dy9tYXRjaGVzL3Njb3JlcydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMzBcbiAgfVxuXG4gIHdvcmxkICh3b3JsZElkKSB7XG4gICAgcmV0dXJuIHN1cGVyLmdldChgP3dvcmxkPSR7d29ybGRJZH1gLCB0cnVlKVxuICB9XG59XG5cbmNsYXNzIE1hdGNoZXNTdGF0c0VuZHBvaW50IGV4dGVuZHMgQWJzdHJhY3RFbmRwb2ludCB7XG4gIGNvbnN0cnVjdG9yIChjbGllbnQsIGlkKSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMuaWQgPSBpZFxuICAgIHRoaXMudXJsID0gJy92Mi93dncvbWF0Y2hlcy9zdGF0cydcbiAgICB0aGlzLmlzUGFnaW5hdGVkID0gdHJ1ZVxuICAgIHRoaXMuaXNCdWxrID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMzBcbiAgfVxuXG4gIHdvcmxkICh3b3JsZElkKSB7XG4gICAgcmV0dXJuIHN1cGVyLmdldChgP3dvcmxkPSR7d29ybGRJZH1gLCB0cnVlKVxuICB9XG5cbiAgdGVhbXMgKHRlYW0pIHtcbiAgICByZXR1cm4gbmV3IFRlYW1zRW5kcG9pbnQodGhpcywgdGhpcy5pZCwgdGVhbSlcbiAgfVxufVxuXG5jbGFzcyBPYmplY3RpdmVzRW5kcG9pbnQgZXh0ZW5kcyBBYnN0cmFjdEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3IgKGNsaWVudCkge1xuICAgIHN1cGVyKGNsaWVudClcbiAgICB0aGlzLnVybCA9ICcvdjIvd3Z3L29iamVjdGl2ZXMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgVXBncmFkZXNFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi93dncvdXBncmFkZXMnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cblxuY2xhc3MgUmFua3NFbmRwb2ludCBleHRlbmRzIEFic3RyYWN0RW5kcG9pbnQge1xuICBjb25zdHJ1Y3RvciAoY2xpZW50KSB7XG4gICAgc3VwZXIoY2xpZW50KVxuICAgIHRoaXMudXJsID0gJy92Mi93dncvcmFua3MnXG4gICAgdGhpcy5pc1BhZ2luYXRlZCA9IHRydWVcbiAgICB0aGlzLmlzQnVsayA9IHRydWVcbiAgICB0aGlzLmlzTG9jYWxpemVkID0gdHJ1ZVxuICAgIHRoaXMuY2FjaGVUaW1lID0gMjQgKiA2MCAqIDYwXG4gIH1cbn1cbiIsImFzeW5jIGZ1bmN0aW9uIHBhcmFsbGVsIChwcm9taXNlcykge1xuICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgT2JqZWN0LnZhbHVlcyhwcm9taXNlcykubWFwKGZ1bmMgPT4gZnVuYygpKVxuICApXG5cbiAgLy8gSWYgdGhlIGluaXRpYWwgc3RydWN0dXJlIHdhcyBhbiBhcnJheSwganVzdCByZXR1cm4gdGhlIGFycmF5IG9mIHJlc3VsdHNcbiAgaWYgKEFycmF5LmlzQXJyYXkocHJvbWlzZXMpKSB7XG4gICAgcmV0dXJuIHJlc3VsdHNcbiAgfVxuXG4gIC8vIElmIHRoZSBpbml0aWFsIHN0cnVjdHVyZSB3YXMgYW4gb2JqZWN0LCByZWJ1aWxkIGFuIG9iamVjdCB3aXRoIHRoZSByZXN1bHRzXG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhwcm9taXNlcylcbiAgcmV0dXJuIHJlc3VsdHMucmVkdWNlKChvYmplY3QsIHJlc3VsdFBhcnQsIGluZGV4KSA9PiB7XG4gICAgb2JqZWN0W2tleXNbaW5kZXhdXSA9IHJlc3VsdFBhcnRcbiAgICByZXR1cm4gb2JqZWN0XG4gIH0sIHt9KVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHsgcGFyYWxsZWwgfVxuIiwiY29uc3QgZW1vdGlvbkhhc2ggPSByZXF1aXJlKCdAZW1vdGlvbi9oYXNoL2Rpc3QvaGFzaC5icm93c2VyLmNqcy5qcycpLmRlZmF1bHRcblxubGV0IGNhY2hlID0ge31cblxuZnVuY3Rpb24gaGFzaCAoc3RyaW5nKSB7XG4gIGlmICghY2FjaGVbc3RyaW5nXSkge1xuICAgIGNhY2hlW3N0cmluZ10gPSBlbW90aW9uSGFzaChzdHJpbmcpXG4gIH1cblxuICByZXR1cm4gY2FjaGVbc3RyaW5nXVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGhhc2hcbiIsImNvbnN0IERBWV9NUyA9IDI0ICogNjAgKiA2MCAqIDEwMDBcblxuZnVuY3Rpb24gZ2V0RGF0ZUF0VGltZSAoZGF0ZSwgdGltZSkge1xuICByZXR1cm4gbmV3IERhdGUoZGF0ZS50b0lTT1N0cmluZygpLnJlcGxhY2UoL1QuKlovLCBgVCR7dGltZX0uMDAwWmApKVxufVxuXG5mdW5jdGlvbiBnZXREYWlseVJlc2V0IChkYXRlKSB7XG4gIGRhdGUgPSBkYXRlID8gbmV3IERhdGUoZGF0ZSkgOiBuZXcgRGF0ZSgpXG5cbiAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpICsgREFZX01TKVxuICByZXR1cm4gZ2V0RGF0ZUF0VGltZShkYXRlLCAnMDA6MDA6MDAnKVxufVxuXG5mdW5jdGlvbiBnZXRMYXN0RGFpbHlSZXNldCAoZGF0ZSkge1xuICByZXR1cm4gbmV3IERhdGUoZ2V0RGFpbHlSZXNldChkYXRlKS5nZXRUaW1lKCkgLSBEQVlfTVMpXG59XG5cbmZ1bmN0aW9uIGdldFdlZWtseVJlc2V0IChkYXRlKSB7XG4gIGRhdGUgPSBkYXRlID8gbmV3IERhdGUoZGF0ZSkgOiBuZXcgRGF0ZSgpXG5cbiAgY29uc3Qgd2Vla2RheSA9IGRhdGUuZ2V0VVRDRGF5KClcbiAgY29uc3QgaG91cnMgPSBkYXRlLmdldFVUQ0hvdXJzKClcbiAgY29uc3QgbWludXRlcyA9IGRhdGUuZ2V0VVRDTWludXRlcygpXG4gIGxldCBkYXlEaWZmID0gMFxuXG4gIHN3aXRjaCAod2Vla2RheSkge1xuICAgIGNhc2UgMDpcbiAgICAgIC8vIDAgLT4gMSBzdW5kYXlcbiAgICAgIGRheURpZmYgPSAxXG4gICAgICBicmVha1xuICAgIGNhc2UgMTpcbiAgICAgIC8vIDEgLT4gMCBtb25kYXkgKGlmIGJlZm9yZSByZXNldClcbiAgICAgIC8vIDEgLT4gNyBtb25kYXkgKGlmIGFmdGVyIHJlc2V0KVxuICAgICAgY29uc3QgcGFzdFJlc2V0ID0gaG91cnMgPiA3IHx8IChob3VycyA9PT0gNyAmJiBtaW51dGVzID49IDMwKVxuICAgICAgZGF5RGlmZiA9IHBhc3RSZXNldCA/IDcgOiAwXG4gICAgICBicmVha1xuICAgIGRlZmF1bHQ6XG4gICAgICAvLyAyIC0+IDYgdHVlc2RheVxuICAgICAgLy8gMyAtPiA1IHdlZG5lc2RheVxuICAgICAgLy8gNCAtPiA0IHRodXJzZGF5XG4gICAgICAvLyA1IC0+IDMgZnJpZGF5XG4gICAgICAvLyA2IC0+IDIgc2F0dXJkYXlcbiAgICAgIGRheURpZmYgPSA4IC0gd2Vla2RheVxuICAgICAgYnJlYWtcbiAgfVxuXG4gIGRhdGUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSArIGRheURpZmYgKiBEQVlfTVMpXG4gIHJldHVybiBnZXREYXRlQXRUaW1lKGRhdGUsICcwNzozMDowMCcpXG59XG5cbmZ1bmN0aW9uIGdldExhc3RXZWVrbHlSZXNldCAoZGF0ZSkge1xuICByZXR1cm4gbmV3IERhdGUoZ2V0V2Vla2x5UmVzZXQoZGF0ZSkuZ2V0VGltZSgpIC0gNyAqIERBWV9NUylcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGdldERhdGVBdFRpbWUsXG4gIGdldERhaWx5UmVzZXQsXG4gIGdldExhc3REYWlseVJlc2V0LFxuICBnZXRXZWVrbHlSZXNldCxcbiAgZ2V0TGFzdFdlZWtseVJlc2V0XG59XG4iLCJjb25zdCBDbGllbnQgPSByZXF1aXJlKCcuL2NsaWVudCcpXG5cbi8vIEVhY2ggdGltZSB0aGUgYXBpIHdyYXBwZXIgaXMgY2FsbGVkLCB3ZSBnaXZlIGJhY2sgYSBuZXcgaW5zdGFuY2Vcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gbmV3IENsaWVudCgpXG59XG4iLCJjbGFzcyBTdG9yZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihkYk5hbWUgPSAna2V5dmFsLXN0b3JlJywgc3RvcmVOYW1lID0gJ2tleXZhbCcpIHtcclxuICAgICAgICB0aGlzLnN0b3JlTmFtZSA9IHN0b3JlTmFtZTtcclxuICAgICAgICB0aGlzLl9kYnAgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9wZW5yZXEgPSBpbmRleGVkREIub3BlbihkYk5hbWUsIDEpO1xyXG4gICAgICAgICAgICBvcGVucmVxLm9uZXJyb3IgPSAoKSA9PiByZWplY3Qob3BlbnJlcS5lcnJvcik7XHJcbiAgICAgICAgICAgIG9wZW5yZXEub25zdWNjZXNzID0gKCkgPT4gcmVzb2x2ZShvcGVucmVxLnJlc3VsdCk7XHJcbiAgICAgICAgICAgIC8vIEZpcnN0IHRpbWUgc2V0dXA6IGNyZWF0ZSBhbiBlbXB0eSBvYmplY3Qgc3RvcmVcclxuICAgICAgICAgICAgb3BlbnJlcS5vbnVwZ3JhZGVuZWVkZWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBvcGVucmVxLnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgX3dpdGhJREJTdG9yZSh0eXBlLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kYnAudGhlbihkYiA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24odGhpcy5zdG9yZU5hbWUsIHR5cGUpO1xyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gKCkgPT4gcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbi5vbmFib3J0ID0gdHJhbnNhY3Rpb24ub25lcnJvciA9ICgpID0+IHJlamVjdCh0cmFuc2FjdGlvbi5lcnJvcik7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHRoaXMuc3RvcmVOYW1lKSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG59XHJcbmxldCBzdG9yZTtcclxuZnVuY3Rpb24gZ2V0RGVmYXVsdFN0b3JlKCkge1xyXG4gICAgaWYgKCFzdG9yZSlcclxuICAgICAgICBzdG9yZSA9IG5ldyBTdG9yZSgpO1xyXG4gICAgcmV0dXJuIHN0b3JlO1xyXG59XHJcbmZ1bmN0aW9uIGdldChrZXksIHN0b3JlID0gZ2V0RGVmYXVsdFN0b3JlKCkpIHtcclxuICAgIGxldCByZXE7XHJcbiAgICByZXR1cm4gc3RvcmUuX3dpdGhJREJTdG9yZSgncmVhZG9ubHknLCBzdG9yZSA9PiB7XHJcbiAgICAgICAgcmVxID0gc3RvcmUuZ2V0KGtleSk7XHJcbiAgICB9KS50aGVuKCgpID0+IHJlcS5yZXN1bHQpO1xyXG59XHJcbmZ1bmN0aW9uIHNldChrZXksIHZhbHVlLCBzdG9yZSA9IGdldERlZmF1bHRTdG9yZSgpKSB7XHJcbiAgICByZXR1cm4gc3RvcmUuX3dpdGhJREJTdG9yZSgncmVhZHdyaXRlJywgc3RvcmUgPT4ge1xyXG4gICAgICAgIHN0b3JlLnB1dCh2YWx1ZSwga2V5KTtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGRlbChrZXksIHN0b3JlID0gZ2V0RGVmYXVsdFN0b3JlKCkpIHtcclxuICAgIHJldHVybiBzdG9yZS5fd2l0aElEQlN0b3JlKCdyZWFkd3JpdGUnLCBzdG9yZSA9PiB7XHJcbiAgICAgICAgc3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBjbGVhcihzdG9yZSA9IGdldERlZmF1bHRTdG9yZSgpKSB7XHJcbiAgICByZXR1cm4gc3RvcmUuX3dpdGhJREJTdG9yZSgncmVhZHdyaXRlJywgc3RvcmUgPT4ge1xyXG4gICAgICAgIHN0b3JlLmNsZWFyKCk7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBrZXlzKHN0b3JlID0gZ2V0RGVmYXVsdFN0b3JlKCkpIHtcclxuICAgIGNvbnN0IGtleXMgPSBbXTtcclxuICAgIHJldHVybiBzdG9yZS5fd2l0aElEQlN0b3JlKCdyZWFkb25seScsIHN0b3JlID0+IHtcclxuICAgICAgICAvLyBUaGlzIHdvdWxkIGJlIHN0b3JlLmdldEFsbEtleXMoKSwgYnV0IGl0IGlzbid0IHN1cHBvcnRlZCBieSBFZGdlIG9yIFNhZmFyaS5cclxuICAgICAgICAvLyBBbmQgb3BlbktleUN1cnNvciBpc24ndCBzdXBwb3J0ZWQgYnkgU2FmYXJpLlxyXG4gICAgICAgIChzdG9yZS5vcGVuS2V5Q3Vyc29yIHx8IHN0b3JlLm9wZW5DdXJzb3IpLmNhbGwoc3RvcmUpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnJlc3VsdClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAga2V5cy5wdXNoKHRoaXMucmVzdWx0LmtleSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVzdWx0LmNvbnRpbnVlKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pLnRoZW4oKCkgPT4ga2V5cyk7XHJcbn1cblxuZXhwb3J0IHsgU3RvcmUsIGdldCwgc2V0LCBkZWwsIGNsZWFyLCBrZXlzIH07XG4iLCJhc3luYyBmdW5jdGlvbiBzZXJpZXMgKGFycmF5KSB7XG4gIGxldCByZXN1bHRzID0gW11cblxuICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICByZXN1bHRzLnB1c2goYXdhaXQgYXJyYXlbaV0oKSlcbiAgfVxuXG4gIHJldHVybiByZXN1bHRzXG59XG5cbmZ1bmN0aW9uIHBhcmFsbGVsIChhcnJheSkge1xuICByZXR1cm4gUHJvbWlzZS5hbGwoYXJyYXkubWFwKGZ1bmMgPT4gZnVuYygpKSlcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHNlcmllcyxcbiAgcGFyYWxsZWxcbn1cbiIsImNvbnN0IGZldGNoID0gcmVxdWlyZSgnY3Jvc3MtZmV0Y2gnKVxuY29uc3QgZmxvdyA9IHJlcXVpcmUoJy4vZmxvdy5qcycpXG5cbmNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICB0eXBlOiAnanNvbicsXG4gIG1ldGhvZDogJ0dFVCcsXG4gIGhlYWRlcnM6IHt9LFxuICBib2R5OiB1bmRlZmluZWRcbn1cblxubGV0IGludGVybmFsUmV0cnkgPSAoKSA9PiBmYWxzZVxubGV0IGludGVybmFsUmV0cnlXYWl0ID0gKCkgPT4gZmFsc2VcblxuLy8gaXN0YW5idWwgaWdub3JlIG5leHRcbmxldCBpbnRlcm5hbExvZ2dlciA9ICgpID0+IGZhbHNlXG5cbm1vZHVsZS5leHBvcnRzID0geyByZXRyeSwgcmV0cnlXYWl0LCBsb2dnZXIsIHNpbmdsZSwgbWFueSB9XG5cbi8vIFNldCBhIGN1c3RvbSBkZWNpZGVyIGZ1bmN0aW9uIHRoYXQgZGVjaWRlcyB0byByZXRyeVxuLy8gYmFzZWQgb24gdGhlIG51bWJlciBvZiB0cmllcyBhbmQgdGhlIHByZXZpb3VzIGVycm9yXG5mdW5jdGlvbiByZXRyeSAoZGVjaWRlcikge1xuICBpbnRlcm5hbFJldHJ5ID0gZGVjaWRlclxufVxuXG4vLyBTZXQgYSBjdXN0b20gZnVuY3Rpb24gdGhhdCBzZXRzIGhvdyBsb25nIHdlIHNob3VsZFxuLy8gc2xlZXAgYmV0d2VlbiBlYWNoIGZhaWxlZCByZXF1ZXN0XG5mdW5jdGlvbiByZXRyeVdhaXQgKGNhbGxiYWNrKSB7XG4gIGludGVybmFsUmV0cnlXYWl0ID0gY2FsbGJhY2tcbn1cblxuLy8gU2V0IGEgY3VzdG9tIGZ1bmN0aW9uIHRoYXQgbG9ncyBvdXQgaW5mb3JtYXRpb24gYWJvdXQgZWFjaCByZXF1ZXN0XG5mdW5jdGlvbiBsb2dnZXIgKGNhbGxiYWNrKSB7XG4gIGludGVybmFsTG9nZ2VyID0gY2FsbGJhY2tcbn1cblxuLy8gUmVxdWVzdCBhIHNpbmdsZSB1cmxcbmZ1bmN0aW9uIHNpbmdsZSAodXJsLCBvcHRpb25zID0ge30pIHtcbiAgbGV0IHRyaWVzID0gMVxuXG4gIC8vIEV4ZWN1dGUgdGhlIHJlcXVlc3QgYW5kIHJldHJ5IGlmIHRoZXJlIGFyZSBlcnJvcnMgKGFuZCB0aGVcbiAgLy8gcmV0cnkgZGVjaWRlciBkZWNpZGVkIHRoYXQgd2Ugc2hvdWxkIHRyeSBvdXIgbHVjayBhZ2FpbilcbiAgY29uc3QgY2FsbFJlcXVlc3QgPSAoKSA9PiB7XG4gICAgbGV0IHN0YXJ0ID0gbmV3IERhdGUoKVxuXG4gICAgcmV0dXJuIHJlcXVlc3QodXJsLCBvcHRpb25zKVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgaW50ZXJuYWxMb2dnZXIoeyB1cmwsIGR1cmF0aW9uOiBuZXcgRGF0ZSgpIC0gc3RhcnQsIHN0YXR1czogMjAwLCByZXRyaWVzOiB0cmllcyAtIDEgfSlcblxuICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICBpbnRlcm5hbExvZ2dlcih7IHVybCwgZHVyYXRpb246IG5ldyBEYXRlKCkgLSBzdGFydCwgc3RhdHVzOiBlcnIgJiYgZXJyLnJlc3BvbnNlICYmIGVyci5yZXNwb25zZS5zdGF0dXMsIHJldHJpZXM6IHRyaWVzIC0gMSB9KVxuXG4gICAgICAgIGlmIChpbnRlcm5hbFJldHJ5KCsrdHJpZXMsIGVycikpIHtcbiAgICAgICAgICByZXR1cm4gd2FpdChjYWxsUmVxdWVzdCwgaW50ZXJuYWxSZXRyeVdhaXQodHJpZXMpKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgZXJyXG4gICAgICB9KVxuICB9XG5cbiAgcmV0dXJuIGNhbGxSZXF1ZXN0KClcbn1cblxuLy8gU2VuZCBhIHJlcXVlc3QgdXNpbmcgdGhlIHVuZGVybHlpbmcgZmV0Y2ggQVBJXG5mdW5jdGlvbiByZXF1ZXN0ICh1cmwsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKVxuICBsZXQgc2F2ZWRDb250ZW50XG4gIGxldCBzYXZlZFJlc3BvbnNlXG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBmZXRjaCh1cmwsIG9wdGlvbnMpXG4gICAgICAudGhlbihoYW5kbGVSZXNwb25zZSlcbiAgICAgIC50aGVuKGhhbmRsZUJvZHkpXG4gICAgICAuY2F0Y2goaGFuZGxlRXJyb3IpXG5cbiAgICBmdW5jdGlvbiBoYW5kbGVSZXNwb25zZSAocmVzcG9uc2UpIHtcbiAgICAgIC8vIFNhdmUgdGhlIHJlc3BvbnNlIGZvciBjaGVja2luZyB0aGUgc3RhdHVzIGxhdGVyXG4gICAgICBzYXZlZFJlc3BvbnNlID0gcmVzcG9uc2VcblxuICAgICAgLy8gRGVjb2RlIHRoZSByZXNwb25zZSBib2R5XG4gICAgICBzd2l0Y2ggKG9wdGlvbnMudHlwZSkge1xuICAgICAgICBjYXNlICdyZXNwb25zZSc6XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIGNhc2UgJ2pzb24nOlxuICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKClcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UudGV4dCgpXG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGFuZGxlQm9keSAoY29udGVudCkge1xuICAgICAgLy8gQnViYmxlIGFuIGVycm9yIGlmIHRoZSByZXNwb25zZSBzdGF0dXMgaXMgbm90IG9rYXlcbiAgICAgIGlmIChzYXZlZFJlc3BvbnNlICYmIHNhdmVkUmVzcG9uc2Uuc3RhdHVzID49IDQwMCkge1xuICAgICAgICBzYXZlZENvbnRlbnQgPSBjb250ZW50XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgUmVzcG9uc2Ugc3RhdHVzIGluZGljYXRlcyBlcnJvcmApXG4gICAgICB9XG5cbiAgICAgIC8vIEFsbCBpcyB3ZWxsIVxuICAgICAgcmVzb2x2ZShjb250ZW50KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGhhbmRsZUVycm9yIChlcnIpIHtcbiAgICAgIC8vIE92ZXJ3cml0ZSBwb3RlbnRpYWwgZGVjb2RpbmcgZXJyb3JzIHdoZW4gdGhlIGFjdHVhbCBwcm9ibGVtIHdhcyB0aGUgcmVzcG9uc2VcbiAgICAgIGlmIChzYXZlZFJlc3BvbnNlICYmIHNhdmVkUmVzcG9uc2Uuc3RhdHVzID49IDQwMCkge1xuICAgICAgICBlcnIgPSBuZXcgRXJyb3IoYFN0YXR1cyAke3NhdmVkUmVzcG9uc2Uuc3RhdHVzfWApXG4gICAgICB9XG5cbiAgICAgIC8vIEVucmljaCB0aGUgZXJyb3IgbWVzc2FnZSB3aXRoIHRoZSByZXNwb25zZSBhbmQgdGhlIGNvbnRlbnRcbiAgICAgIGxldCBlcnJvciA9IG5ldyBFcnJvcihlcnIubWVzc2FnZSlcbiAgICAgIGVycm9yLnJlc3BvbnNlID0gc2F2ZWRSZXNwb25zZVxuICAgICAgZXJyb3IuY29udGVudCA9IHNhdmVkQ29udGVudFxuICAgICAgcmVqZWN0KGVycm9yKVxuICAgIH1cbiAgfSlcbn1cblxuLy8gUmVxdWVzdCBtdWx0aXBsZSBwYWdlc1xuZnVuY3Rpb24gbWFueSAodXJscywgb3B0aW9ucyA9IHt9KSB7XG4gIGxldCBmbG93TWV0aG9kID0gKG9wdGlvbnMud2FpdFRpbWUpID8gZmxvdy5zZXJpZXMgOiBmbG93LnBhcmFsbGVsXG5cbiAgLy8gQ2FsbCB0aGUgc2luZ2xlIG1ldGhvZCB3aGlsZSByZXNwZWN0aW5nIHRoZSB3YWl0IHRpbWUgaW4gYmV0d2VlbiB0YXNrc1xuICBjb25zdCBjYWxsU2luZ2xlID0gKHVybCkgPT4gc2luZ2xlKHVybCwgb3B0aW9ucylcbiAgICAudGhlbihjb250ZW50ID0+IHdhaXQoKCkgPT4gY29udGVudCwgb3B0aW9ucy53YWl0VGltZSkpXG5cbiAgLy8gTWFwIG92ZXIgdGhlIHVybHMgYW5kIGNhbGwgdGhlbSB1c2luZyB0aGUgbWV0aG9kIHRoZSB1c2VyIGNob3NlXG4gIGxldCBwcm9taXNlcyA9IHVybHMubWFwKHVybCA9PiAoKSA9PiBjYWxsU2luZ2xlKHVybCkpXG4gIHJldHVybiBmbG93TWV0aG9kKHByb21pc2VzKVxufVxuXG4vLyBXYWl0IGEgc3BlY2lmaWMgdGltZSBiZWZvcmUgZXhlY3V0aW5nIGEgY2FsbGJhY2tcbmZ1bmN0aW9uIHdhaXQgKGNhbGxiYWNrLCBtcykge1xuICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgc2V0VGltZW91dCgoKSA9PiByZXNvbHZlKGNhbGxiYWNrKCkpLCBtcyB8fCAwKVxuICB9KVxufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgaGFzID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eVxuICAsIHVuZGVmO1xuXG4vKipcbiAqIERlY29kZSBhIFVSSSBlbmNvZGVkIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIFVSSSBlbmNvZGVkIHN0cmluZy5cbiAqIEByZXR1cm5zIHtTdHJpbmd8TnVsbH0gVGhlIGRlY29kZWQgc3RyaW5nLlxuICogQGFwaSBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGRlY29kZShpbnB1dCkge1xuICB0cnkge1xuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoaW5wdXQucmVwbGFjZSgvXFwrL2csICcgJykpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBlbmNvZGUgYSBnaXZlbiBpbnB1dC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIHN0cmluZyB0aGF0IG5lZWRzIHRvIGJlIGVuY29kZWQuXG4gKiBAcmV0dXJucyB7U3RyaW5nfE51bGx9IFRoZSBlbmNvZGVkIHN0cmluZy5cbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBlbmNvZGUoaW5wdXQpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KGlucHV0KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8qKlxuICogU2ltcGxlIHF1ZXJ5IHN0cmluZyBwYXJzZXIuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IHF1ZXJ5IFRoZSBxdWVyeSBzdHJpbmcgdGhhdCBuZWVkcyB0byBiZSBwYXJzZWQuXG4gKiBAcmV0dXJucyB7T2JqZWN0fVxuICogQGFwaSBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gcXVlcnlzdHJpbmcocXVlcnkpIHtcbiAgdmFyIHBhcnNlciA9IC8oW149PyMmXSspPT8oW14mXSopL2dcbiAgICAsIHJlc3VsdCA9IHt9XG4gICAgLCBwYXJ0O1xuXG4gIHdoaWxlIChwYXJ0ID0gcGFyc2VyLmV4ZWMocXVlcnkpKSB7XG4gICAgdmFyIGtleSA9IGRlY29kZShwYXJ0WzFdKVxuICAgICAgLCB2YWx1ZSA9IGRlY29kZShwYXJ0WzJdKTtcblxuICAgIC8vXG4gICAgLy8gUHJldmVudCBvdmVycmlkaW5nIG9mIGV4aXN0aW5nIHByb3BlcnRpZXMuIFRoaXMgZW5zdXJlcyB0aGF0IGJ1aWxkLWluXG4gICAgLy8gbWV0aG9kcyBsaWtlIGB0b1N0cmluZ2Agb3IgX19wcm90b19fIGFyZSBub3Qgb3ZlcnJpZGVuIGJ5IG1hbGljaW91c1xuICAgIC8vIHF1ZXJ5c3RyaW5ncy5cbiAgICAvL1xuICAgIC8vIEluIHRoZSBjYXNlIGlmIGZhaWxlZCBkZWNvZGluZywgd2Ugd2FudCB0byBvbWl0IHRoZSBrZXkvdmFsdWUgcGFpcnNcbiAgICAvLyBmcm9tIHRoZSByZXN1bHQuXG4gICAgLy9cbiAgICBpZiAoa2V5ID09PSBudWxsIHx8IHZhbHVlID09PSBudWxsIHx8IGtleSBpbiByZXN1bHQpIGNvbnRpbnVlO1xuICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIFRyYW5zZm9ybSBhIHF1ZXJ5IHN0cmluZyB0byBhbiBvYmplY3QuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9iaiBPYmplY3QgdGhhdCBzaG91bGQgYmUgdHJhbnNmb3JtZWQuXG4gKiBAcGFyYW0ge1N0cmluZ30gcHJlZml4IE9wdGlvbmFsIHByZWZpeC5cbiAqIEByZXR1cm5zIHtTdHJpbmd9XG4gKiBAYXBpIHB1YmxpY1xuICovXG5mdW5jdGlvbiBxdWVyeXN0cmluZ2lmeShvYmosIHByZWZpeCkge1xuICBwcmVmaXggPSBwcmVmaXggfHwgJyc7XG5cbiAgdmFyIHBhaXJzID0gW11cbiAgICAsIHZhbHVlXG4gICAgLCBrZXk7XG5cbiAgLy9cbiAgLy8gT3B0aW9uYWxseSBwcmVmaXggd2l0aCBhICc/JyBpZiBuZWVkZWRcbiAgLy9cbiAgaWYgKCdzdHJpbmcnICE9PSB0eXBlb2YgcHJlZml4KSBwcmVmaXggPSAnPyc7XG5cbiAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgaWYgKGhhcy5jYWxsKG9iaiwga2V5KSkge1xuICAgICAgdmFsdWUgPSBvYmpba2V5XTtcblxuICAgICAgLy9cbiAgICAgIC8vIEVkZ2UgY2FzZXMgd2hlcmUgd2UgYWN0dWFsbHkgd2FudCB0byBlbmNvZGUgdGhlIHZhbHVlIHRvIGFuIGVtcHR5XG4gICAgICAvLyBzdHJpbmcgaW5zdGVhZCBvZiB0aGUgc3RyaW5naWZpZWQgdmFsdWUuXG4gICAgICAvL1xuICAgICAgaWYgKCF2YWx1ZSAmJiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmIHx8IGlzTmFOKHZhbHVlKSkpIHtcbiAgICAgICAgdmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAga2V5ID0gZW5jb2RlKGtleSk7XG4gICAgICB2YWx1ZSA9IGVuY29kZSh2YWx1ZSk7XG5cbiAgICAgIC8vXG4gICAgICAvLyBJZiB3ZSBmYWlsZWQgdG8gZW5jb2RlIHRoZSBzdHJpbmdzLCB3ZSBzaG91bGQgYmFpbCBvdXQgYXMgd2UgZG9uJ3RcbiAgICAgIC8vIHdhbnQgdG8gYWRkIGludmFsaWQgc3RyaW5ncyB0byB0aGUgcXVlcnkuXG4gICAgICAvL1xuICAgICAgaWYgKGtleSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gbnVsbCkgY29udGludWU7XG4gICAgICBwYWlycy5wdXNoKGtleSArJz0nKyB2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHBhaXJzLmxlbmd0aCA/IHByZWZpeCArIHBhaXJzLmpvaW4oJyYnKSA6ICcnO1xufVxuXG4vL1xuLy8gRXhwb3NlIHRoZSBtb2R1bGUuXG4vL1xuZXhwb3J0cy5zdHJpbmdpZnkgPSBxdWVyeXN0cmluZ2lmeTtcbmV4cG9ydHMucGFyc2UgPSBxdWVyeXN0cmluZztcbiIsIi8qIFRhYnVsYXRvciB2Ni4zLjEgKGMpIE9saXZlciBGb2xrZXJkIDIwMjUgKi9cbmNsYXNzIENvcmVGZWF0dXJle1xuXG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vIERhdGFMb2FkIC8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdHJlbG9hZERhdGEoZGF0YSwgc2lsZW50LCBjb2x1bW5zQ2hhbmdlZCl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUuZGF0YUxvYWRlci5sb2FkKGRhdGEsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHNpbGVudCwgY29sdW1uc0NoYW5nZWQpO1xuXHR9XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8gTG9jYWxpemF0aW9uIC8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRsYW5nVGV4dCgpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLm1vZHVsZXMubG9jYWxpemUuZ2V0VGV4dCguLi5hcmd1bWVudHMpO1xuXHR9XG5cblx0bGFuZ0JpbmQoKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmJpbmQoLi4uYXJndW1lbnRzKTtcblx0fVxuXG5cdGxhbmdMb2NhbGUoKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmdldExvY2FsZSguLi5hcmd1bWVudHMpO1xuXHR9XG5cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLyBJbnRlciBUYWJsZSBDb21tcyAvLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdGNvbW1zQ29ubmVjdGlvbnMoKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5tb2R1bGVzLmNvbW1zLmdldENvbm5lY3Rpb25zKC4uLmFyZ3VtZW50cyk7XG5cdH1cblxuXHRjb21tc1NlbmQoKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5tb2R1bGVzLmNvbW1zLnNlbmQoLi4uYXJndW1lbnRzKTtcblx0fVxuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vIExheW91dCAgLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0bGF5b3V0TW9kZSgpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLm1vZHVsZXMubGF5b3V0LmdldE1vZGUoKTtcblx0fVxuXG5cdGxheW91dFJlZnJlc2goZm9yY2Upe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLm1vZHVsZXMubGF5b3V0LmxheW91dChmb3JjZSk7XG5cdH1cblxuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8gRXZlbnQgQnVzIC8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0c3Vic2NyaWJlKCl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUuZXZlbnRCdXMuc3Vic2NyaWJlKC4uLmFyZ3VtZW50cyk7XG5cdH1cblxuXHR1bnN1YnNjcmliZSgpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmV2ZW50QnVzLnVuc3Vic2NyaWJlKC4uLmFyZ3VtZW50cyk7XG5cdH1cblxuXHRzdWJzY3JpYmVkKGtleSl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUuZXZlbnRCdXMuc3Vic2NyaWJlZChrZXkpO1xuXHR9XG5cblx0c3Vic2NyaXB0aW9uQ2hhbmdlKCl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUuZXZlbnRCdXMuc3Vic2NyaXB0aW9uQ2hhbmdlKC4uLmFyZ3VtZW50cyk7XG5cdH1cblxuXHRkaXNwYXRjaCgpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmV2ZW50QnVzLmRpc3BhdGNoKC4uLmFyZ3VtZW50cyk7XG5cdH1cblxuXHRjaGFpbigpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmV2ZW50QnVzLmNoYWluKC4uLmFyZ3VtZW50cyk7XG5cdH1cblxuXHRjb25maXJtKCl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUuZXZlbnRCdXMuY29uZmlybSguLi5hcmd1bWVudHMpO1xuXHR9XG5cblx0ZGlzcGF0Y2hFeHRlcm5hbCgpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmV4dGVybmFsRXZlbnRzLmRpc3BhdGNoKC4uLmFyZ3VtZW50cyk7XG5cdH1cblxuXHRzdWJzY3JpYmVkRXh0ZXJuYWwoa2V5KXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5leHRlcm5hbEV2ZW50cy5zdWJzY3JpYmVkKGtleSk7XG5cdH1cblxuXHRzdWJzY3JpcHRpb25DaGFuZ2VFeHRlcm5hbCgpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmV4dGVybmFsRXZlbnRzLnN1YnNjcmlwdGlvbkNoYW5nZSguLi5hcmd1bWVudHMpO1xuXHR9XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8gT3B0aW9ucyAvLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRvcHRpb25zKGtleSl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUub3B0aW9uc1trZXldO1xuXHR9XG5cblx0c2V0T3B0aW9uKGtleSwgdmFsdWUpe1xuXHRcdGlmKHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnNba2V5XSA9IHZhbHVlO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnRhYmxlLm9wdGlvbnNba2V5XTtcblx0fVxuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLyBEZXByZWNhdGlvbiBDaGVja3MgLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0ZGVwcmVjYXRpb25DaGVjayhvbGRPcHRpb24sIG5ld09wdGlvbiwgIGNvbnZlcnQpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmRlcHJlY2F0aW9uQWR2aXNvci5jaGVjayhvbGRPcHRpb24sIG5ld09wdGlvbiwgIGNvbnZlcnQpO1xuXHR9XG5cblx0ZGVwcmVjYXRpb25DaGVja01zZyhvbGRPcHRpb24sIG1zZyl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUuZGVwcmVjYXRpb25BZHZpc29yLmNoZWNrTXNnKG9sZE9wdGlvbiwgbXNnKTtcblx0fVxuXG5cdGRlcHJlY2F0aW9uTXNnKG1zZyl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUuZGVwcmVjYXRpb25BZHZpc29yLm1zZyhtc2cpO1xuXHR9XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vIE1vZHVsZXMgLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0bW9kdWxlKGtleSl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUubW9kdWxlKGtleSk7XG5cdH1cbn1cblxuY2xhc3MgSGVscGVyc3tcblxuXHRzdGF0aWMgZWxWaXNpYmxlKGVsKXtcblx0XHRyZXR1cm4gIShlbC5vZmZzZXRXaWR0aCA8PSAwICYmIGVsLm9mZnNldEhlaWdodCA8PSAwKTtcblx0fVxuXG5cdHN0YXRpYyBlbE9mZnNldChlbCl7XG5cdFx0dmFyIGJveCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHRvcDogYm94LnRvcCArIHdpbmRvdy5wYWdlWU9mZnNldCAtIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3AsXG5cdFx0XHRsZWZ0OiBib3gubGVmdCArIHdpbmRvdy5wYWdlWE9mZnNldCAtIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRMZWZ0XG5cdFx0fTtcblx0fVxuXG5cdHN0YXRpYyByZXRyaWV2ZU5lc3RlZERhdGEoc2VwYXJhdG9yLCBmaWVsZCwgZGF0YSl7XG5cdFx0dmFyIHN0cnVjdHVyZSA9IHNlcGFyYXRvciA/IGZpZWxkLnNwbGl0KHNlcGFyYXRvcikgOiBbZmllbGRdLFxuXHRcdGxlbmd0aCA9IHN0cnVjdHVyZS5sZW5ndGgsXG5cdFx0b3V0cHV0O1xuXG5cdFx0Zm9yKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKXtcblxuXHRcdFx0ZGF0YSA9IGRhdGFbc3RydWN0dXJlW2ldXTtcblxuXHRcdFx0b3V0cHV0ID0gZGF0YTtcblxuXHRcdFx0aWYoIWRhdGEpe1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cblx0c3RhdGljIGRlZXBDbG9uZShvYmosIGNsb25lLCBsaXN0ID0gW10pe1xuXHRcdHZhciBvYmplY3RQcm90byA9IHt9Ll9fcHJvdG9fXyxcblx0XHRhcnJheVByb3RvID0gW10uX19wcm90b19fO1xuXG5cdFx0aWYgKCFjbG9uZSl7XG5cdFx0XHRjbG9uZSA9IE9iamVjdC5hc3NpZ24oQXJyYXkuaXNBcnJheShvYmopID8gW10gOiB7fSwgb2JqKTtcblx0XHR9XG5cblx0XHRmb3IodmFyIGkgaW4gb2JqKSB7XG5cdFx0XHRsZXQgc3ViamVjdCA9IG9ialtpXSxcblx0XHRcdG1hdGNoLCBjb3B5O1xuXG5cdFx0XHRpZihzdWJqZWN0ICE9IG51bGwgJiYgdHlwZW9mIHN1YmplY3QgPT09IFwib2JqZWN0XCIgJiYgKHN1YmplY3QuX19wcm90b19fID09PSBvYmplY3RQcm90byB8fCBzdWJqZWN0Ll9fcHJvdG9fXyA9PT0gYXJyYXlQcm90bykpe1xuXHRcdFx0XHRtYXRjaCA9IGxpc3QuZmluZEluZGV4KChpdGVtKSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGl0ZW0uc3ViamVjdCA9PT0gc3ViamVjdDtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYobWF0Y2ggPiAtMSl7XG5cdFx0XHRcdFx0Y2xvbmVbaV0gPSBsaXN0W21hdGNoXS5jb3B5O1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29weSA9IE9iamVjdC5hc3NpZ24oQXJyYXkuaXNBcnJheShzdWJqZWN0KSA/IFtdIDoge30sIHN1YmplY3QpO1xuXG5cdFx0XHRcdFx0bGlzdC51bnNoaWZ0KHtzdWJqZWN0LCBjb3B5fSk7XG5cblx0XHRcdFx0XHRjbG9uZVtpXSA9IHRoaXMuZGVlcENsb25lKHN1YmplY3QsIGNvcHksIGxpc3QpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNsb25lO1xuXHR9XG59XG5cbmxldCBQb3B1cCQxID0gY2xhc3MgUG9wdXAgZXh0ZW5kcyBDb3JlRmVhdHVyZXtcblx0Y29uc3RydWN0b3IodGFibGUsIGVsZW1lbnQsIHBhcmVudCl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG5cdFx0dGhpcy5jb250YWluZXIgPSB0aGlzLl9sb29rdXBDb250YWluZXIoKTtcblx0XHRcblx0XHR0aGlzLnBhcmVudCA9IHBhcmVudDtcblx0XHRcblx0XHR0aGlzLnJldmVyc2VkWCA9IGZhbHNlO1xuXHRcdHRoaXMuY2hpbGRQb3B1cCA9IG51bGw7XG5cdFx0dGhpcy5ibHVyYWJsZSA9IGZhbHNlO1xuXHRcdHRoaXMuYmx1ckNhbGxiYWNrID0gbnVsbDtcblx0XHR0aGlzLmJsdXJFdmVudHNCb3VuZCA9IGZhbHNlO1xuXHRcdHRoaXMucmVuZGVyZWRDYWxsYmFjayA9IG51bGw7XG5cdFx0XG5cdFx0dGhpcy52aXNpYmxlID0gZmFsc2U7XG5cdFx0dGhpcy5oaWRlYWJsZSA9IHRydWU7XG5cdFx0XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcG9wdXAtY29udGFpbmVyXCIpO1xuXHRcdFxuXHRcdHRoaXMuYmx1ckV2ZW50ID0gdGhpcy5oaWRlLmJpbmQodGhpcywgZmFsc2UpO1xuXHRcdHRoaXMuZXNjRXZlbnQgPSB0aGlzLl9lc2NhcGVDaGVjay5iaW5kKHRoaXMpO1xuXHRcdFxuXHRcdHRoaXMuZGVzdHJveUJpbmRpbmcgPSB0aGlzLnRhYmxlRGVzdHJveWVkLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5kZXN0cm95ZWQgPSBmYWxzZTtcblx0fVxuXHRcblx0dGFibGVEZXN0cm95ZWQoKXtcblx0XHR0aGlzLmRlc3Ryb3llZCA9IHRydWU7XG5cdFx0dGhpcy5oaWRlKHRydWUpO1xuXHR9XG5cdFxuXHRfbG9va3VwQ29udGFpbmVyKCl7XG5cdFx0dmFyIGNvbnRhaW5lciA9IHRoaXMudGFibGUub3B0aW9ucy5wb3B1cENvbnRhaW5lcjtcblx0XHRcblx0XHRpZih0eXBlb2YgY29udGFpbmVyID09PSBcInN0cmluZ1wiKXtcblx0XHRcdGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyKTtcblx0XHRcdFxuXHRcdFx0aWYoIWNvbnRhaW5lcil7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIk1lbnUgRXJyb3IgLSBubyBjb250YWluZXIgZWxlbWVudCBmb3VuZCBtYXRjaGluZyBzZWxlY3RvcjpcIiwgIHRoaXMudGFibGUub3B0aW9ucy5wb3B1cENvbnRhaW5lciAsIFwiKGRlZmF1bHRpbmcgdG8gZG9jdW1lbnQgYm9keSlcIik7XG5cdFx0XHR9XG5cdFx0fWVsc2UgaWYgKGNvbnRhaW5lciA9PT0gdHJ1ZSl7XG5cdFx0XHRjb250YWluZXIgPSB0aGlzLnRhYmxlLmVsZW1lbnQ7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGNvbnRhaW5lciAmJiAhdGhpcy5fY2hlY2tDb250YWluZXJJc1BhcmVudChjb250YWluZXIpKXtcblx0XHRcdGNvbnRhaW5lciA9IGZhbHNlO1xuXHRcdFx0Y29uc29sZS53YXJuKFwiTWVudSBFcnJvciAtIGNvbnRhaW5lciBlbGVtZW50IGRvZXMgbm90IGNvbnRhaW4gdGhpcyB0YWJsZTpcIiwgIHRoaXMudGFibGUub3B0aW9ucy5wb3B1cENvbnRhaW5lciAsIFwiKGRlZmF1bHRpbmcgdG8gZG9jdW1lbnQgYm9keSlcIik7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCFjb250YWluZXIpe1xuXHRcdFx0Y29udGFpbmVyID0gZG9jdW1lbnQuYm9keTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGNvbnRhaW5lcjtcblx0fVxuXHRcblx0X2NoZWNrQ29udGFpbmVySXNQYXJlbnQoY29udGFpbmVyLCBlbGVtZW50ID0gdGhpcy50YWJsZS5lbGVtZW50KXtcblx0XHRpZihjb250YWluZXIgPT09IGVsZW1lbnQpe1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmV0dXJuIGVsZW1lbnQucGFyZW50Tm9kZSA/IHRoaXMuX2NoZWNrQ29udGFpbmVySXNQYXJlbnQoY29udGFpbmVyLCBlbGVtZW50LnBhcmVudE5vZGUpIDogZmFsc2U7XG5cdFx0fVxuXHR9XG5cdFxuXHRyZW5kZXJDYWxsYmFjayhjYWxsYmFjayl7XG5cdFx0dGhpcy5yZW5kZXJlZENhbGxiYWNrID0gY2FsbGJhY2s7XG5cdH1cblx0XG5cdGNvbnRhaW5lckV2ZW50Q29vcmRzKGUpe1xuXHRcdHZhciB0b3VjaCA9ICEoZSBpbnN0YW5jZW9mIE1vdXNlRXZlbnQpO1xuXHRcdFxuXHRcdHZhciB4ID0gdG91Y2ggPyBlLnRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYO1xuXHRcdHZhciB5ID0gdG91Y2ggPyBlLnRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZO1xuXHRcdFxuXHRcdGlmKHRoaXMuY29udGFpbmVyICE9PSBkb2N1bWVudC5ib2R5KXtcblx0XHRcdGxldCBwYXJlbnRPZmZzZXQgPSBIZWxwZXJzLmVsT2Zmc2V0KHRoaXMuY29udGFpbmVyKTtcblx0XHRcdFxuXHRcdFx0eCAtPSBwYXJlbnRPZmZzZXQubGVmdDtcblx0XHRcdHkgLT0gcGFyZW50T2Zmc2V0LnRvcDtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHt4LCB5fTtcblx0fVxuXHRcblx0ZWxlbWVudFBvc2l0aW9uQ29vcmRzKGVsZW1lbnQsIHBvc2l0aW9uID0gXCJyaWdodFwiKXtcblx0XHR2YXIgb2Zmc2V0ID0gSGVscGVycy5lbE9mZnNldChlbGVtZW50KSxcblx0XHRjb250YWluZXJPZmZzZXQsIHgsIHk7XG5cdFx0XG5cdFx0aWYodGhpcy5jb250YWluZXIgIT09IGRvY3VtZW50LmJvZHkpe1xuXHRcdFx0Y29udGFpbmVyT2Zmc2V0ID0gSGVscGVycy5lbE9mZnNldCh0aGlzLmNvbnRhaW5lcik7XG5cdFx0XHRcblx0XHRcdG9mZnNldC5sZWZ0IC09IGNvbnRhaW5lck9mZnNldC5sZWZ0O1xuXHRcdFx0b2Zmc2V0LnRvcCAtPSBjb250YWluZXJPZmZzZXQudG9wO1xuXHRcdH1cblx0XHRcblx0XHRzd2l0Y2gocG9zaXRpb24pe1xuXHRcdFx0Y2FzZSBcInJpZ2h0XCI6XG5cdFx0XHRcdHggPSBvZmZzZXQubGVmdCArIGVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cdFx0XHRcdHkgPSBvZmZzZXQudG9wIC0gMTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJib3R0b21cIjpcblx0XHRcdFx0eCA9IG9mZnNldC5sZWZ0O1xuXHRcdFx0XHR5ID0gb2Zmc2V0LnRvcCArIGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFxuXHRcdFx0Y2FzZSBcImxlZnRcIjpcblx0XHRcdFx0eCA9IG9mZnNldC5sZWZ0O1xuXHRcdFx0XHR5ID0gb2Zmc2V0LnRvcCAtIDE7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwidG9wXCI6XG5cdFx0XHRcdHggPSBvZmZzZXQubGVmdDtcblx0XHRcdFx0eSA9IG9mZnNldC50b3A7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwiY2VudGVyXCI6XG5cdFx0XHRcdHggPSBvZmZzZXQubGVmdCArIChlbGVtZW50Lm9mZnNldFdpZHRoIC8gMik7XG5cdFx0XHRcdHkgPSBvZmZzZXQudG9wICsgKGVsZW1lbnQub2Zmc2V0SGVpZ2h0IC8gMik7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiB7eCwgeSwgb2Zmc2V0fTtcblx0fVxuXHRcblx0c2hvdyhvcmlnaW4sIHBvc2l0aW9uKXtcblx0XHR2YXIgeCwgeSwgcGFyZW50RWwsIHBhcmVudE9mZnNldCwgY29vcmRzO1xuXHRcdFxuXHRcdGlmKHRoaXMuZGVzdHJveWVkIHx8IHRoaXMudGFibGUuZGVzdHJveWVkKXtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0XHRcblx0XHRpZihvcmlnaW4gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCl7XG5cdFx0XHRwYXJlbnRFbCA9IG9yaWdpbjtcblx0XHRcdGNvb3JkcyA9IHRoaXMuZWxlbWVudFBvc2l0aW9uQ29vcmRzKG9yaWdpbiwgcG9zaXRpb24pO1xuXHRcdFx0XG5cdFx0XHRwYXJlbnRPZmZzZXQgPSBjb29yZHMub2Zmc2V0O1xuXHRcdFx0eCA9IGNvb3Jkcy54O1xuXHRcdFx0eSA9IGNvb3Jkcy55O1xuXHRcdFx0XG5cdFx0fWVsc2UgaWYodHlwZW9mIG9yaWdpbiA9PT0gXCJudW1iZXJcIil7XG5cdFx0XHRwYXJlbnRPZmZzZXQgPSB7dG9wOjAsIGxlZnQ6MH07XG5cdFx0XHR4ID0gb3JpZ2luO1xuXHRcdFx0eSA9IHBvc2l0aW9uO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvb3JkcyA9IHRoaXMuY29udGFpbmVyRXZlbnRDb29yZHMob3JpZ2luKTtcblx0XHRcdFxuXHRcdFx0eCA9IGNvb3Jkcy54O1xuXHRcdFx0eSA9IGNvb3Jkcy55O1xuXHRcdFx0XG5cdFx0XHR0aGlzLnJldmVyc2VkWCA9IGZhbHNlO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0geSArIFwicHhcIjtcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubGVmdCA9IHggKyBcInB4XCI7XG5cdFx0XG5cdFx0dGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTtcblx0XHRcblx0XHRpZih0eXBlb2YgdGhpcy5yZW5kZXJlZENhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0dGhpcy5yZW5kZXJlZENhbGxiYWNrKCk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuX2ZpdFRvU2NyZWVuKHgsIHksIHBhcmVudEVsLCBwYXJlbnRPZmZzZXQsIHBvc2l0aW9uKTtcblx0XHRcblx0XHR0aGlzLnZpc2libGUgPSB0cnVlO1xuXHRcdFxuXHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtZGVzdHJveVwiLCB0aGlzLmRlc3Ryb3lCaW5kaW5nKTtcblx0XHRcblx0XHR0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuXHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXHRcblx0X2ZpdFRvU2NyZWVuKHgsIHksIHBhcmVudEVsLCBwYXJlbnRPZmZzZXQsIHBvc2l0aW9uKXtcblx0XHR2YXIgc2Nyb2xsVG9wID0gdGhpcy5jb250YWluZXIgPT09IGRvY3VtZW50LmJvZHkgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIDogdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wO1xuXHRcdFxuXHRcdC8vbW92ZSBtZW51IHRvIHN0YXJ0IG9uIHJpZ2h0IGVkZ2UgaWYgaXQgaXMgdG9vIGNsb3NlIHRvIHRoZSBlZGdlIG9mIHRoZSBzY3JlZW5cblx0XHRpZigoeCArIHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aCkgPj0gdGhpcy5jb250YWluZXIub2Zmc2V0V2lkdGggfHwgdGhpcy5yZXZlcnNlZFgpe1xuXHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBcIlwiO1xuXHRcdFx0XG5cdFx0XHRpZihwYXJlbnRFbCl7XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5yaWdodCA9ICh0aGlzLmNvbnRhaW5lci5vZmZzZXRXaWR0aCAtIHBhcmVudE9mZnNldC5sZWZ0KSArIFwicHhcIjtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLnJpZ2h0ID0gKHRoaXMuY29udGFpbmVyLm9mZnNldFdpZHRoIC0geCkgKyBcInB4XCI7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMucmV2ZXJzZWRYID0gdHJ1ZTtcblx0XHR9XG5cdFx0XG5cdFx0Ly9tb3ZlIG1lbnUgdG8gc3RhcnQgb24gYm90dG9tIGVkZ2UgaWYgaXQgaXMgdG9vIGNsb3NlIHRvIHRoZSBlZGdlIG9mIHRoZSBzY3JlZW5cblx0XHRsZXQgb2Zmc2V0SGVpZ2h0ID0gTWF0aC5tYXgodGhpcy5jb250YWluZXIub2Zmc2V0SGVpZ2h0LCBzY3JvbGxUb3AgPyB0aGlzLmNvbnRhaW5lci5zY3JvbGxIZWlnaHQgOiAwKTtcblx0XHRpZigoeSArIHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQpID4gb2Zmc2V0SGVpZ2h0KSB7XG5cdFx0XHRpZihwYXJlbnRFbCl7XG5cdFx0XHRcdHN3aXRjaChwb3NpdGlvbil7XG5cdFx0XHRcdFx0Y2FzZSBcImJvdHRvbVwiOlxuXHRcdFx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IChwYXJzZUludCh0aGlzLmVsZW1lbnQuc3R5bGUudG9wKSAtIHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQgLSBwYXJlbnRFbC5vZmZzZXRIZWlnaHQgLSAxKSArIFwicHhcIjtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0gKHBhcnNlSW50KHRoaXMuZWxlbWVudC5zdHlsZS50b3ApIC0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodCArIHBhcmVudEVsLm9mZnNldEhlaWdodCArIDEpICsgXCJweFwiO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gb2Zmc2V0SGVpZ2h0ICsgXCJweFwiO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0aXNWaXNpYmxlKCl7XG5cdFx0cmV0dXJuIHRoaXMudmlzaWJsZTtcblx0fVxuXHRcblx0aGlkZU9uQmx1cihjYWxsYmFjayl7XG5cdFx0dGhpcy5ibHVyYWJsZSA9IHRydWU7XG5cdFx0XG5cdFx0aWYodGhpcy52aXNpYmxlKXtcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRpZih0aGlzLnZpc2libGUpe1xuXHRcdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgdGhpcy5ibHVyRXZlbnQpO1xuXHRcdFx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1lZGl0aW5nXCIsIHRoaXMuYmx1ckV2ZW50KTtcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmJsdXJFdmVudCk7XG5cdFx0XHRcdFx0ZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgdGhpcy5ibHVyRXZlbnQpO1xuXHRcdFx0XHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLmJsdXJFdmVudCk7XG5cdFx0XHRcdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgdGhpcy5ibHVyRXZlbnQpO1xuXHRcdFx0XHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5lc2NFdmVudCk7XG5cblx0XHRcdFx0XHR0aGlzLmJsdXJFdmVudHNCb3VuZCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0sIDEwMCk7XG5cdFx0XHRcblx0XHRcdHRoaXMuYmx1ckNhbGxiYWNrID0gY2FsbGJhY2s7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cdFxuXHRfZXNjYXBlQ2hlY2soZSl7XG5cdFx0aWYoZS5rZXlDb2RlID09IDI3KXtcblx0XHRcdHRoaXMuaGlkZSgpO1xuXHRcdH1cblx0fVxuXHRcblx0YmxvY2tIaWRlKCl7XG5cdFx0dGhpcy5oaWRlYWJsZSA9IGZhbHNlO1xuXHR9XG5cdFxuXHRyZXN0b3JlSGlkZSgpe1xuXHRcdHRoaXMuaGlkZWFibGUgPSB0cnVlO1xuXHR9XG5cdFxuXHRoaWRlKHNpbGVudCA9IGZhbHNlKXtcblx0XHRpZih0aGlzLnZpc2libGUgJiYgdGhpcy5oaWRlYWJsZSl7XG5cdFx0XHRpZih0aGlzLmJsdXJhYmxlICYmIHRoaXMuYmx1ckV2ZW50c0JvdW5kKXtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLmVzY0V2ZW50KTtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5ibHVyRXZlbnQpO1xuXHRcdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCB0aGlzLmJsdXJFdmVudCk7XG5cdFx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLmJsdXJFdmVudCk7XG5cdFx0XHRcdHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIHRoaXMuYmx1ckV2ZW50KTtcblx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCB0aGlzLmJsdXJFdmVudCk7XG5cdFx0XHRcdHRoaXMudW5zdWJzY3JpYmUoXCJjZWxsLWVkaXRpbmdcIiwgdGhpcy5ibHVyRXZlbnQpO1xuXG5cdFx0XHRcdHRoaXMuYmx1ckV2ZW50c0JvdW5kID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuY2hpbGRQb3B1cCl7XG5cdFx0XHRcdHRoaXMuY2hpbGRQb3B1cC5oaWRlKCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMucGFyZW50KXtcblx0XHRcdFx0dGhpcy5wYXJlbnQuY2hpbGRQb3B1cCA9IG51bGw7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuZWxlbWVudC5wYXJlbnROb2RlKXtcblx0XHRcdFx0dGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0dGhpcy52aXNpYmxlID0gZmFsc2U7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuYmx1ckNhbGxiYWNrICYmICFzaWxlbnQpe1xuXHRcdFx0XHR0aGlzLmJsdXJDYWxsYmFjaygpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnVuc3Vic2NyaWJlKFwidGFibGUtZGVzdHJveVwiLCB0aGlzLmRlc3Ryb3lCaW5kaW5nKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblx0XG5cdGNoaWxkKGVsZW1lbnQpe1xuXHRcdGlmKHRoaXMuY2hpbGRQb3B1cCl7XG5cdFx0XHR0aGlzLmNoaWxkUG9wdXAuaGlkZSgpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmNoaWxkUG9wdXAgPSBuZXcgUG9wdXAodGhpcy50YWJsZSwgZWxlbWVudCwgdGhpcyk7XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXMuY2hpbGRQb3B1cDtcblx0fVxufTtcblxuY2xhc3MgTW9kdWxlIGV4dGVuZHMgQ29yZUZlYXR1cmV7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSwgbmFtZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMuX2hhbmRsZXIgPSBudWxsO1xuXHR9XG5cdFxuXHRpbml0aWFsaXplKCl7XG5cdFx0Ly8gc2V0dXAgbW9kdWxlIHdoZW4gdGFibGUgaXMgaW5pdGlhbGl6ZWQsIHRvIGJlIG92ZXJyaWRkZW4gaW4gbW9kdWxlXG5cdH1cblx0XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8gT3B0aW9ucyBSZWdpc3RyYXRpb24gLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0cmVnaXN0ZXJUYWJsZU9wdGlvbihrZXksIHZhbHVlKXtcblx0XHR0aGlzLnRhYmxlLm9wdGlvbnNMaXN0LnJlZ2lzdGVyKGtleSwgdmFsdWUpO1xuXHR9XG5cdFxuXHRyZWdpc3RlckNvbHVtbk9wdGlvbihrZXksIHZhbHVlKXtcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIub3B0aW9uc0xpc3QucmVnaXN0ZXIoa2V5LCB2YWx1ZSk7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLyBQdWJsaWMgRnVuY3Rpb24gUmVnaXN0cmF0aW9uIC8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0cmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKG5hbWUsIGZ1bmMpe1xuXHRcdGlmKHR5cGVvZiB0aGlzLnRhYmxlW25hbWVdID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdHRoaXMudGFibGVbbmFtZV0gPSAoLi4uYXJncykgPT4ge1xuXHRcdFx0XHR0aGlzLnRhYmxlLmluaXRHdWFyZChuYW1lKTtcblx0XHRcdFx0XG5cdFx0XHRcdHJldHVybiBmdW5jKC4uLmFyZ3MpO1xuXHRcdFx0fTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJVbmFibGUgdG8gYmluZCB0YWJsZSBmdW5jdGlvbiwgbmFtZSBhbHJlYWR5IGluIHVzZVwiLCBuYW1lKTtcblx0XHR9XG5cdH1cblx0XG5cdHJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oY29tcG9uZW50LCBmdW5jLCBoYW5kbGVyKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5jb21wb25lbnRGdW5jdGlvbkJpbmRlci5iaW5kKGNvbXBvbmVudCwgZnVuYywgaGFuZGxlcik7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8gRGF0YSBQaXBlbGluZSAvLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRyZWdpc3RlckRhdGFIYW5kbGVyKGhhbmRsZXIsIHByaW9yaXR5KXtcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVnaXN0ZXJEYXRhUGlwZWxpbmVIYW5kbGVyKGhhbmRsZXIsIHByaW9yaXR5KTtcblx0XHR0aGlzLl9oYW5kbGVyID0gaGFuZGxlcjtcblx0fVxuXHRcblx0cmVnaXN0ZXJEaXNwbGF5SGFuZGxlcihoYW5kbGVyLCBwcmlvcml0eSl7XG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlZ2lzdGVyRGlzcGxheVBpcGVsaW5lSGFuZGxlcihoYW5kbGVyLCBwcmlvcml0eSk7XG5cdFx0dGhpcy5faGFuZGxlciA9IGhhbmRsZXI7XG5cdH1cblx0XG5cdGRpc3BsYXlSb3dzKGFkanVzdCl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmRpc3BsYXlSb3dzLmxlbmd0aCAtIDEsIFxuXHRcdGxvb2t1cEluZGV4O1xuXHRcdFxuXHRcdGlmKHRoaXMuX2hhbmRsZXIpe1xuXHRcdFx0bG9va3VwSW5kZXggPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZGlzcGxheVBpcGVsaW5lLmZpbmRJbmRleCgoaXRlbSkgPT4ge1xuXHRcdFx0XHRyZXR1cm4gaXRlbS5oYW5kbGVyID09PSB0aGlzLl9oYW5kbGVyO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmKGxvb2t1cEluZGV4ID4gLTEpe1xuXHRcdFx0XHRpbmRleCA9IGxvb2t1cEluZGV4O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRpZihhZGp1c3Qpe1xuXHRcdFx0aW5kZXggPSBpbmRleCArIGFkanVzdDtcblx0XHR9XG5cblx0XHRpZih0aGlzLl9oYW5kbGVyKXtcblx0XHRcdGlmKGluZGV4ID4gLTEpe1xuXHRcdFx0XHRyZXR1cm4gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKGluZGV4KTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuYWN0aXZlUm93cygpO1xuXHRcdFx0fVxuXHRcdH1cdFxuXHR9XG5cdFxuXHRhY3RpdmVSb3dzKCl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUucm93TWFuYWdlci5hY3RpdmVSb3dzO1xuXHR9XG5cdFxuXHRyZWZyZXNoRGF0YShyZW5kZXJJblBvc2l0aW9uLCBoYW5kbGVyKXtcblx0XHRpZighaGFuZGxlcil7XG5cdFx0XHRoYW5kbGVyID0gdGhpcy5faGFuZGxlcjtcblx0XHR9XG5cdFx0XG5cdFx0aWYoaGFuZGxlcil7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVmcmVzaEFjdGl2ZURhdGEoaGFuZGxlciwgZmFsc2UsIHJlbmRlckluUG9zaXRpb24pO1xuXHRcdH1cblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8gRm9vdGVyIE1hbmFnZW1lbnQgLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdGZvb3RlckFwcGVuZChlbGVtZW50KXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5mb290ZXJNYW5hZ2VyLmFwcGVuZChlbGVtZW50KTtcblx0fVxuXHRcblx0Zm9vdGVyUHJlcGVuZChlbGVtZW50KXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5mb290ZXJNYW5hZ2VyLnByZXBlbmQoZWxlbWVudCk7XG5cdH1cblx0XG5cdGZvb3RlclJlbW92ZShlbGVtZW50KXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5mb290ZXJNYW5hZ2VyLnJlbW92ZShlbGVtZW50KTtcblx0fSBcblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vIFBvcHVwcyBNYW5hZ2VtZW50IC8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRwb3B1cChtZW51RWwsIG1lbnVDb250YWluZXIpe1xuXHRcdHJldHVybiBuZXcgUG9wdXAkMSh0aGlzLnRhYmxlLCBtZW51RWwsIG1lbnVDb250YWluZXIpO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLyBBbGVydCBNYW5hZ2VtZW50IC8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRhbGVydChjb250ZW50LCB0eXBlKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5hbGVydE1hbmFnZXIuYWxlcnQoY29udGVudCwgdHlwZSk7XG5cdH1cblx0XG5cdGNsZWFyQWxlcnQoKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5hbGVydE1hbmFnZXIuY2xlYXIoKTtcblx0fVxuXHRcbn1cblxudmFyIGRlZmF1bHRBY2Nlc3NvcnMgPSB7XHJcblx0cm93bnVtOmZ1bmN0aW9uKHZhbHVlLCBkYXRhLCB0eXBlLCBwYXJhbXMsIGNvbHVtbiwgcm93KXtcclxuXHRcdHJldHVybiByb3cuZ2V0UG9zaXRpb24oKTtcclxuXHR9XHJcbn07XG5cbmNsYXNzIEFjY2Vzc29yIGV4dGVuZHMgTW9kdWxle1xuXHRcblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcImFjY2Vzc29yXCI7XG5cblx0Ly9sb2FkIGRlZmF1bHRzXG5cdHN0YXRpYyBhY2Nlc3NvcnMgPSBkZWZhdWx0QWNjZXNzb3JzO1xuXG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cblx0XHR0aGlzLmFsbG93ZWRUeXBlcyA9IFtcIlwiLCBcImRhdGFcIiwgXCJkb3dubG9hZFwiLCBcImNsaXBib2FyZFwiLCBcInByaW50XCIsIFwiaHRtbE91dHB1dFwiXTsgLy9saXN0IG9mIGFjY2Vzc29yIHR5cGVzXG5cblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiYWNjZXNzb3JcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImFjY2Vzc29yUGFyYW1zXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJhY2Nlc3NvckRhdGFcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImFjY2Vzc29yRGF0YVBhcmFtc1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiYWNjZXNzb3JEb3dubG9hZFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiYWNjZXNzb3JEb3dubG9hZFBhcmFtc1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiYWNjZXNzb3JDbGlwYm9hcmRcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImFjY2Vzc29yQ2xpcGJvYXJkUGFyYW1zXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJhY2Nlc3NvclByaW50XCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJhY2Nlc3NvclByaW50UGFyYW1zXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJhY2Nlc3Nvckh0bWxPdXRwdXRcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImFjY2Vzc29ySHRtbE91dHB1dFBhcmFtc1wiKTtcblx0fVxuXG5cdGluaXRpYWxpemUoKXtcblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1sYXlvdXRcIiwgdGhpcy5pbml0aWFsaXplQ29sdW1uLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWRhdGEtcmV0cmlldmVcIiwgdGhpcy50cmFuc2Zvcm1Sb3cuYmluZCh0aGlzKSk7XG5cdH1cblxuXHQvL2luaXRpYWxpemUgY29sdW1uIGFjY2Vzc29yXG5cdGluaXRpYWxpemVDb2x1bW4oY29sdW1uKXtcblx0XHR2YXIgbWF0Y2ggPSBmYWxzZSxcblx0XHRjb25maWcgPSB7fTtcblxuXHRcdHRoaXMuYWxsb3dlZFR5cGVzLmZvckVhY2goKHR5cGUpID0+IHtcblx0XHRcdHZhciBrZXkgPSBcImFjY2Vzc29yXCIgKyAodHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR5cGUuc2xpY2UoMSkpLFxuXHRcdFx0YWNjZXNzb3I7XG5cblx0XHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uW2tleV0pe1xuXHRcdFx0XHRhY2Nlc3NvciA9IHRoaXMubG9va3VwQWNjZXNzb3IoY29sdW1uLmRlZmluaXRpb25ba2V5XSk7XG5cblx0XHRcdFx0aWYoYWNjZXNzb3Ipe1xuXHRcdFx0XHRcdG1hdGNoID0gdHJ1ZTtcblxuXHRcdFx0XHRcdGNvbmZpZ1trZXldID0ge1xuXHRcdFx0XHRcdFx0YWNjZXNzb3I6YWNjZXNzb3IsXG5cdFx0XHRcdFx0XHRwYXJhbXM6IGNvbHVtbi5kZWZpbml0aW9uW2tleSArIFwiUGFyYW1zXCJdIHx8IHt9LFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmKG1hdGNoKXtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLmFjY2Vzc29yID0gY29uZmlnO1xuXHRcdH1cblx0fVxuXG5cdGxvb2t1cEFjY2Vzc29yKHZhbHVlKXtcblx0XHR2YXIgYWNjZXNzb3IgPSBmYWxzZTtcblxuXHRcdC8vc2V0IGNvbHVtbiBhY2Nlc3NvclxuXHRcdHN3aXRjaCh0eXBlb2YgdmFsdWUpe1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRpZihBY2Nlc3Nvci5hY2Nlc3NvcnNbdmFsdWVdKXtcblx0XHRcdFx0XHRhY2Nlc3NvciA9IEFjY2Vzc29yLmFjY2Vzc29yc1t2YWx1ZV07XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJBY2Nlc3NvciBFcnJvciAtIE5vIHN1Y2ggYWNjZXNzb3IgZm91bmQsIGlnbm9yaW5nOiBcIiwgdmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0YWNjZXNzb3IgPSB2YWx1ZTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFjY2Vzc29yO1xuXHR9XG5cblx0Ly9hcHBseSBhY2Nlc3NvciB0byByb3dcblx0dHJhbnNmb3JtUm93KHJvdywgdHlwZSl7XG5cdFx0dmFyIGtleSA9IFwiYWNjZXNzb3JcIiArICh0eXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdHlwZS5zbGljZSgxKSksXG5cdFx0cm93Q29tcG9uZW50ID0gcm93LmdldENvbXBvbmVudCgpO1xuXG5cdFx0Ly9jbG9uZSBkYXRhIG9iamVjdCB3aXRoIGRlZXAgY29weSB0byBpc29sYXRlIGludGVybmFsIGRhdGEgZnJvbSByZXR1cm5lZCByZXN1bHRcblx0XHR2YXIgZGF0YSA9IEhlbHBlcnMuZGVlcENsb25lKHJvdy5kYXRhIHx8IHt9KTtcblxuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci50cmF2ZXJzZShmdW5jdGlvbihjb2x1bW4pe1xuXHRcdFx0dmFyIHZhbHVlLCBhY2Nlc3NvciwgcGFyYW1zLCBjb2xDb21wb25lbnQ7XG5cblx0XHRcdGlmKGNvbHVtbi5tb2R1bGVzLmFjY2Vzc29yKXtcblxuXHRcdFx0XHRhY2Nlc3NvciA9IGNvbHVtbi5tb2R1bGVzLmFjY2Vzc29yW2tleV0gfHwgY29sdW1uLm1vZHVsZXMuYWNjZXNzb3IuYWNjZXNzb3IgfHwgZmFsc2U7XG5cblx0XHRcdFx0aWYoYWNjZXNzb3Ipe1xuXHRcdFx0XHRcdHZhbHVlID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cblx0XHRcdFx0XHRpZih2YWx1ZSAhPSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRcdGNvbENvbXBvbmVudCA9IGNvbHVtbi5nZXRDb21wb25lbnQoKTtcblx0XHRcdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBhY2Nlc3Nvci5wYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IGFjY2Vzc29yLnBhcmFtcyh2YWx1ZSwgZGF0YSwgdHlwZSwgY29sQ29tcG9uZW50LCByb3dDb21wb25lbnQpIDogYWNjZXNzb3IucGFyYW1zO1xuXHRcdFx0XHRcdFx0Y29sdW1uLnNldEZpZWxkVmFsdWUoZGF0YSwgYWNjZXNzb3IuYWNjZXNzb3IodmFsdWUsIGRhdGEsIHR5cGUsIHBhcmFtcywgY29sQ29tcG9uZW50LCByb3dDb21wb25lbnQpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBkYXRhO1xuXHR9XG59XG5cbnZhciBkZWZhdWx0Q29uZmlnID0ge1xuXHRtZXRob2Q6IFwiR0VUXCIsXG59O1xuXG5mdW5jdGlvbiBnZW5lcmF0ZVBhcmFtc0xpc3QkMShkYXRhLCBwcmVmaXgpe1xuXHR2YXIgb3V0cHV0ID0gW107XG5cblx0cHJlZml4ID0gcHJlZml4IHx8IFwiXCI7XG5cblx0aWYoQXJyYXkuaXNBcnJheShkYXRhKSl7XG5cdFx0ZGF0YS5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG5cdFx0XHRvdXRwdXQgPSBvdXRwdXQuY29uY2F0KGdlbmVyYXRlUGFyYW1zTGlzdCQxKGl0ZW0sIHByZWZpeCA/IHByZWZpeCArIFwiW1wiICsgaSArIFwiXVwiIDogaSkpO1xuXHRcdH0pO1xuXHR9ZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIpe1xuXHRcdGZvciAodmFyIGtleSBpbiBkYXRhKXtcblx0XHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQoZ2VuZXJhdGVQYXJhbXNMaXN0JDEoZGF0YVtrZXldLCBwcmVmaXggPyBwcmVmaXggKyBcIltcIiArIGtleSArIFwiXVwiIDoga2V5KSk7XG5cdFx0fVxuXHR9ZWxzZSB7XG5cdFx0b3V0cHV0LnB1c2goe2tleTpwcmVmaXgsIHZhbHVlOmRhdGF9KTtcblx0fVxuXG5cdHJldHVybiBvdXRwdXQ7XG59XG5cbmZ1bmN0aW9uIHNlcmlhbGl6ZVBhcmFtcyhwYXJhbXMpe1xuXHR2YXIgb3V0cHV0ID0gZ2VuZXJhdGVQYXJhbXNMaXN0JDEocGFyYW1zKSxcblx0ZW5jb2RlZCA9IFtdO1xuXG5cdG91dHB1dC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuXHRcdGVuY29kZWQucHVzaChlbmNvZGVVUklDb21wb25lbnQoaXRlbS5rZXkpICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoaXRlbS52YWx1ZSkpO1xuXHR9KTtcblxuXHRyZXR1cm4gZW5jb2RlZC5qb2luKFwiJlwiKTtcbn1cblxuZnVuY3Rpb24gdXJsQnVpbGRlcih1cmwsIGNvbmZpZywgcGFyYW1zKXtcblx0aWYodXJsKXtcblx0XHRpZihwYXJhbXMgJiYgT2JqZWN0LmtleXMocGFyYW1zKS5sZW5ndGgpe1xuXHRcdFx0aWYoIWNvbmZpZy5tZXRob2QgfHwgY29uZmlnLm1ldGhvZC50b0xvd2VyQ2FzZSgpID09IFwiZ2V0XCIpe1xuXHRcdFx0XHRjb25maWcubWV0aG9kID0gXCJnZXRcIjtcblxuXHRcdFx0XHR1cmwgKz0gKHVybC5pbmNsdWRlcyhcIj9cIikgPyBcIiZcIiA6IFwiP1wiKSArIHNlcmlhbGl6ZVBhcmFtcyhwYXJhbXMpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiB1cmw7XG59XG5cbmZ1bmN0aW9uIGRlZmF1bHRMb2FkZXJQcm9taXNlKHVybCwgY29uZmlnLCBwYXJhbXMpe1xuXHR2YXIgY29udGVudFR5cGU7XG5cblx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHQvL3NldCB1cmxcblx0XHR1cmwgPSB0aGlzLnVybEdlbmVyYXRvci5jYWxsKHRoaXMudGFibGUsIHVybCwgY29uZmlnLCBwYXJhbXMpO1xuXG5cdFx0Ly9zZXQgYm9keSBjb250ZW50IGlmIG5vdCBHRVQgcmVxdWVzdFxuXHRcdGlmKGNvbmZpZy5tZXRob2QudG9VcHBlckNhc2UoKSAhPSBcIkdFVFwiKXtcblx0XHRcdGNvbnRlbnRUeXBlID0gdHlwZW9mIHRoaXMudGFibGUub3B0aW9ucy5hamF4Q29udGVudFR5cGUgPT09IFwib2JqZWN0XCIgPyAgdGhpcy50YWJsZS5vcHRpb25zLmFqYXhDb250ZW50VHlwZSA6IHRoaXMuY29udGVudFR5cGVGb3JtYXR0ZXJzW3RoaXMudGFibGUub3B0aW9ucy5hamF4Q29udGVudFR5cGVdO1xuXHRcdFx0aWYoY29udGVudFR5cGUpe1xuXG5cdFx0XHRcdGZvcih2YXIga2V5IGluIGNvbnRlbnRUeXBlLmhlYWRlcnMpe1xuXHRcdFx0XHRcdGlmKCFjb25maWcuaGVhZGVycyl7XG5cdFx0XHRcdFx0XHRjb25maWcuaGVhZGVycyA9IHt9O1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmKHR5cGVvZiBjb25maWcuaGVhZGVyc1trZXldID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRcdGNvbmZpZy5oZWFkZXJzW2tleV0gPSBjb250ZW50VHlwZS5oZWFkZXJzW2tleV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29uZmlnLmJvZHkgPSBjb250ZW50VHlwZS5ib2R5LmNhbGwodGhpcywgdXJsLCBjb25maWcsIHBhcmFtcyk7XG5cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiQWpheCBFcnJvciAtIEludmFsaWQgYWpheENvbnRlbnRUeXBlIHZhbHVlOlwiLCB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheENvbnRlbnRUeXBlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZih1cmwpe1xuXHRcdFx0Ly9jb25maWd1cmUgaGVhZGVyc1xuXHRcdFx0aWYodHlwZW9mIGNvbmZpZy5oZWFkZXJzID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0Y29uZmlnLmhlYWRlcnMgPSB7fTtcblx0XHRcdH1cblxuXHRcdFx0aWYodHlwZW9mIGNvbmZpZy5oZWFkZXJzLkFjY2VwdCA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRcdGNvbmZpZy5oZWFkZXJzLkFjY2VwdCA9IFwiYXBwbGljYXRpb24vanNvblwiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZih0eXBlb2YgY29uZmlnLmhlYWRlcnNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0Y29uZmlnLmhlYWRlcnNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdID0gXCJYTUxIdHRwUmVxdWVzdFwiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZih0eXBlb2YgY29uZmlnLm1vZGUgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0XHRjb25maWcubW9kZSA9IFwiY29yc1wiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihjb25maWcubW9kZSA9PSBcImNvcnNcIil7XG5cdFx0XHRcdGlmKHR5cGVvZiBjb25maWcuaGVhZGVyc1tcIk9yaWdpblwiXSA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRcdFx0Y29uZmlnLmhlYWRlcnNbXCJPcmlnaW5cIl0gPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luO1xuXHRcdFx0XHR9XG4gICAgICAgIFxuXHRcdFx0XHRpZih0eXBlb2YgY29uZmlnLmNyZWRlbnRpYWxzID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRjb25maWcuY3JlZGVudGlhbHMgPSAnc2FtZS1vcmlnaW4nO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGlmKHR5cGVvZiBjb25maWcuY3JlZGVudGlhbHMgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0XHRcdGNvbmZpZy5jcmVkZW50aWFscyA9ICdpbmNsdWRlJztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL3NlbmQgcmVxdWVzdFxuXHRcdFx0ZmV0Y2godXJsLCBjb25maWcpXG5cdFx0XHRcdC50aGVuKChyZXNwb25zZSk9Pntcblx0XHRcdFx0XHRpZihyZXNwb25zZS5vaykge1xuXHRcdFx0XHRcdFx0cmVzcG9uc2UuanNvbigpXG5cdFx0XHRcdFx0XHRcdC50aGVuKChkYXRhKT0+e1xuXHRcdFx0XHRcdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHRcdFx0XHRcdH0pLmNhdGNoKChlcnJvcik9Pntcblx0XHRcdFx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkFqYXggTG9hZCBFcnJvciAtIEludmFsaWQgSlNPTiByZXR1cm5lZFwiLCBlcnJvcik7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJBamF4IExvYWQgRXJyb3IgLSBDb25uZWN0aW9uIEVycm9yOiBcIiArIHJlc3BvbnNlLnN0YXR1cywgcmVzcG9uc2Uuc3RhdHVzVGV4dCk7XG5cdFx0XHRcdFx0XHRyZWplY3QocmVzcG9uc2UpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSlcblx0XHRcdFx0LmNhdGNoKChlcnJvcik9Pntcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiQWpheCBMb2FkIEVycm9yIC0gQ29ubmVjdGlvbiBFcnJvcjogXCIsIGVycm9yKTtcblx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJBamF4IExvYWQgRXJyb3IgLSBObyBVUkwgU2V0XCIpO1xuXHRcdFx0cmVzb2x2ZShbXSk7XG5cdFx0fVxuXHR9KTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVQYXJhbXNMaXN0KGRhdGEsIHByZWZpeCl7XG5cdHZhciBvdXRwdXQgPSBbXTtcblxuXHRwcmVmaXggPSBwcmVmaXggfHwgXCJcIjtcblxuXHRpZihBcnJheS5pc0FycmF5KGRhdGEpKXtcblx0XHRkYXRhLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcblx0XHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQoZ2VuZXJhdGVQYXJhbXNMaXN0KGl0ZW0sIHByZWZpeCA/IHByZWZpeCArIFwiW1wiICsgaSArIFwiXVwiIDogaSkpO1xuXHRcdH0pO1xuXHR9ZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIpe1xuXHRcdGZvciAodmFyIGtleSBpbiBkYXRhKXtcblx0XHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQoZ2VuZXJhdGVQYXJhbXNMaXN0KGRhdGFba2V5XSwgcHJlZml4ID8gcHJlZml4ICsgXCJbXCIgKyBrZXkgKyBcIl1cIiA6IGtleSkpO1xuXHRcdH1cblx0fWVsc2Uge1xuXHRcdG91dHB1dC5wdXNoKHtrZXk6cHJlZml4LCB2YWx1ZTpkYXRhfSk7XG5cdH1cblxuXHRyZXR1cm4gb3V0cHV0O1xufVxuXG52YXIgZGVmYXVsdENvbnRlbnRUeXBlRm9ybWF0dGVycyA9IHtcblx0XCJqc29uXCI6e1xuXHRcdGhlYWRlcnM6e1xuXHRcdFx0J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcblx0XHR9LFxuXHRcdGJvZHk6ZnVuY3Rpb24odXJsLCBjb25maWcsIHBhcmFtcyl7XG5cdFx0XHRyZXR1cm4gSlNPTi5zdHJpbmdpZnkocGFyYW1zKTtcblx0XHR9LFxuXHR9LFxuXHRcImZvcm1cIjp7XG5cdFx0aGVhZGVyczp7XG5cdFx0fSxcblx0XHRib2R5OmZ1bmN0aW9uKHVybCwgY29uZmlnLCBwYXJhbXMpe1xuXG5cdFx0XHR2YXIgb3V0cHV0ID0gZ2VuZXJhdGVQYXJhbXNMaXN0KHBhcmFtcyksXG5cdFx0XHRmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG5cblx0XHRcdG91dHB1dC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuXHRcdFx0XHRmb3JtLmFwcGVuZChpdGVtLmtleSwgaXRlbS52YWx1ZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIGZvcm07XG5cdFx0fSxcblx0fSxcbn07XG5cbmNsYXNzIEFqYXggZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcImFqYXhcIjtcblxuXHQvL2xvYWQgZGVmYXVsdHNcblx0c3RhdGljIGRlZmF1bHRDb25maWcgPSBkZWZhdWx0Q29uZmlnO1xuXHRzdGF0aWMgZGVmYXVsdFVSTEdlbmVyYXRvciA9IHVybEJ1aWxkZXI7XG5cdHN0YXRpYyBkZWZhdWx0TG9hZGVyUHJvbWlzZSA9IGRlZmF1bHRMb2FkZXJQcm9taXNlO1xuXHRzdGF0aWMgY29udGVudFR5cGVGb3JtYXR0ZXJzID0gZGVmYXVsdENvbnRlbnRUeXBlRm9ybWF0dGVycztcblx0XG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5jb25maWcgPSB7fTsgLy9ob2xkIGNvbmZpZyBvYmplY3QgZm9yIGFqYXggcmVxdWVzdFxuXHRcdHRoaXMudXJsID0gXCJcIjsgLy9yZXF1ZXN0IFVSTFxuXHRcdHRoaXMudXJsR2VuZXJhdG9yID0gZmFsc2U7XG5cdFx0dGhpcy5wYXJhbXMgPSBmYWxzZTsgLy9yZXF1ZXN0IHBhcmFtZXRlcnNcblx0XHRcblx0XHR0aGlzLmxvYWRlclByb21pc2UgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJhamF4VVJMXCIsIGZhbHNlKTsgLy91cmwgZm9yIGFqYXggbG9hZGluZ1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImFqYXhVUkxHZW5lcmF0b3JcIiwgZmFsc2UpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImFqYXhQYXJhbXNcIiwge30pOyAgLy9wYXJhbXMgZm9yIGFqYXggbG9hZGluZ1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImFqYXhDb25maWdcIiwgXCJnZXRcIik7IC8vYWpheCByZXF1ZXN0IHR5cGVcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJhamF4Q29udGVudFR5cGVcIiwgXCJmb3JtXCIpOyAvL2FqYXggcmVxdWVzdCB0eXBlXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiYWpheFJlcXVlc3RGdW5jXCIsIGZhbHNlKTsgLy9wcm9taXNlIGZ1bmN0aW9uXG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiYWpheFJlcXVlc3RpbmdcIiwgZnVuY3Rpb24oKXt9KTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJhamF4UmVzcG9uc2VcIiwgZmFsc2UpO1xuXHRcdFxuXHRcdHRoaXMuY29udGVudFR5cGVGb3JtYXR0ZXJzID0gQWpheC5jb250ZW50VHlwZUZvcm1hdHRlcnM7XG5cdH1cblx0XG5cdC8vaW5pdGlhbGl6ZSBzZXR1cCBvcHRpb25zXG5cdGluaXRpYWxpemUoKXtcblx0XHR0aGlzLmxvYWRlclByb21pc2UgPSB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheFJlcXVlc3RGdW5jIHx8IEFqYXguZGVmYXVsdExvYWRlclByb21pc2U7XG5cdFx0dGhpcy51cmxHZW5lcmF0b3IgPSB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheFVSTEdlbmVyYXRvciB8fCBBamF4LmRlZmF1bHRVUkxHZW5lcmF0b3I7XG5cdFx0XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmFqYXhVUkwpe1xuXHRcdFx0dGhpcy5zZXRVcmwodGhpcy50YWJsZS5vcHRpb25zLmFqYXhVUkwpO1xuXHRcdH1cblxuXG5cdFx0dGhpcy5zZXREZWZhdWx0Q29uZmlnKHRoaXMudGFibGUub3B0aW9ucy5hamF4Q29uZmlnKTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldEFqYXhVcmxcIiwgdGhpcy5nZXRVcmwuYmluZCh0aGlzKSk7XG5cdFx0XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLWxvYWRpbmdcIiwgdGhpcy5yZXF1ZXN0RGF0YUNoZWNrLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiZGF0YS1wYXJhbXNcIiwgdGhpcy5yZXF1ZXN0UGFyYW1zLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiZGF0YS1sb2FkXCIsIHRoaXMucmVxdWVzdERhdGEuYmluZCh0aGlzKSk7XG5cdH1cblx0XG5cdHJlcXVlc3RQYXJhbXMoZGF0YSwgY29uZmlnLCBzaWxlbnQsIHBhcmFtcyl7XG5cdFx0dmFyIGFqYXhQYXJhbXMgPSB0aGlzLnRhYmxlLm9wdGlvbnMuYWpheFBhcmFtcztcblx0XHRcblx0XHRpZihhamF4UGFyYW1zKXtcblx0XHRcdGlmKHR5cGVvZiBhamF4UGFyYW1zID09PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0XHRhamF4UGFyYW1zID0gYWpheFBhcmFtcy5jYWxsKHRoaXMudGFibGUpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRwYXJhbXMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIGFqYXhQYXJhbXMpLCBwYXJhbXMpO1xuXHRcdH1cdFx0XG5cdFx0XG5cdFx0cmV0dXJuIHBhcmFtcztcblx0fVxuXHRcblx0cmVxdWVzdERhdGFDaGVjayhkYXRhLCBwYXJhbXMsIGNvbmZpZywgc2lsZW50KXtcblx0XHRyZXR1cm4gISEoKCFkYXRhICYmIHRoaXMudXJsKSB8fCB0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIik7XG5cdH1cblx0XG5cdHJlcXVlc3REYXRhKHVybCwgcGFyYW1zLCBjb25maWcsIHNpbGVudCwgcHJldmlvdXNEYXRhKXtcblx0XHR2YXIgYWpheENvbmZpZztcblx0XHRcblx0XHRpZighcHJldmlvdXNEYXRhICYmIHRoaXMucmVxdWVzdERhdGFDaGVjayh1cmwpKXtcblx0XHRcdGlmKHVybCl7XG5cdFx0XHRcdHRoaXMuc2V0VXJsKHVybCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGFqYXhDb25maWcgPSB0aGlzLmdlbmVyYXRlQ29uZmlnKGNvbmZpZyk7XG5cdFx0XHRcblx0XHRcdHJldHVybiB0aGlzLnNlbmRSZXF1ZXN0KHRoaXMudXJsLCBwYXJhbXMsIGFqYXhDb25maWcpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiBwcmV2aW91c0RhdGE7XG5cdFx0fVxuXHR9XG5cdFxuXHRzZXREZWZhdWx0Q29uZmlnKGNvbmZpZyA9IHt9KXtcblx0XHR0aGlzLmNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIEFqYXguZGVmYXVsdENvbmZpZyk7XG5cblx0XHRpZih0eXBlb2YgY29uZmlnID09IFwic3RyaW5nXCIpe1xuXHRcdFx0dGhpcy5jb25maWcubWV0aG9kID0gY29uZmlnO1xuXHRcdH1lbHNlIHtcblx0XHRcdE9iamVjdC5hc3NpZ24odGhpcy5jb25maWcsIGNvbmZpZyk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL2xvYWQgY29uZmlnIG9iamVjdFxuXHRnZW5lcmF0ZUNvbmZpZyhjb25maWcgPSB7fSl7XG5cdFx0dmFyIGFqYXhDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbmZpZyk7XG5cdFx0XG5cdFx0aWYodHlwZW9mIGNvbmZpZyA9PSBcInN0cmluZ1wiKXtcblx0XHRcdGFqYXhDb25maWcubWV0aG9kID0gY29uZmlnO1xuXHRcdH1lbHNlIHtcblx0XHRcdE9iamVjdC5hc3NpZ24oYWpheENvbmZpZywgY29uZmlnKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGFqYXhDb25maWc7XG5cdH1cblx0XG5cdC8vc2V0IHJlcXVlc3QgdXJsXG5cdHNldFVybCh1cmwpe1xuXHRcdHRoaXMudXJsID0gdXJsO1xuXHR9XG5cdFxuXHQvL2dldCByZXF1ZXN0IHVybFxuXHRnZXRVcmwoKXtcblx0XHRyZXR1cm4gdGhpcy51cmw7XG5cdH1cblx0XG5cdC8vc2VuZCBhamF4IHJlcXVlc3Rcblx0c2VuZFJlcXVlc3QodXJsLCBwYXJhbXMsIGNvbmZpZyl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmFqYXhSZXF1ZXN0aW5nLmNhbGwodGhpcy50YWJsZSwgdXJsLCBwYXJhbXMpICE9PSBmYWxzZSl7XG5cdFx0XHRyZXR1cm4gdGhpcy5sb2FkZXJQcm9taXNlKHVybCwgY29uZmlnLCBwYXJhbXMpXG5cdFx0XHRcdC50aGVuKChkYXRhKT0+e1xuXHRcdFx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5hamF4UmVzcG9uc2Upe1xuXHRcdFx0XHRcdFx0ZGF0YSA9IHRoaXMudGFibGUub3B0aW9ucy5hamF4UmVzcG9uc2UuY2FsbCh0aGlzLnRhYmxlLCB1cmwsIHBhcmFtcywgZGF0YSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0XHRyZXR1cm4gZGF0YTtcblx0XHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG5cdFx0fVxuXHR9XG59XG5cbnZhciBkZWZhdWx0UGFzdGVBY3Rpb25zID0ge1xuXHRyZXBsYWNlOmZ1bmN0aW9uKGRhdGEpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLnNldERhdGEoZGF0YSk7XG5cdH0sXG5cdHVwZGF0ZTpmdW5jdGlvbihkYXRhKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS51cGRhdGVPckFkZERhdGEoZGF0YSk7XG5cdH0sXG5cdGluc2VydDpmdW5jdGlvbihkYXRhKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5hZGREYXRhKGRhdGEpO1xuXHR9LFxufTtcblxudmFyIGRlZmF1bHRQYXN0ZVBhcnNlcnMgPSB7XG5cdHRhYmxlOmZ1bmN0aW9uKGNsaXBib2FyZCl7XG5cdFx0dmFyIGRhdGEgPSBbXSxcblx0XHRoZWFkZXJGaW5kU3VjY2VzcyA9IHRydWUsXG5cdFx0Y29sdW1ucyA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zLFxuXHRcdGNvbHVtbk1hcCA9IFtdLFxuXHRcdHJvd3MgPSBbXTtcblx0XHRcblx0XHQvL2dldCBkYXRhIGZyb20gY2xpcGJvYXJkIGludG8gYXJyYXkgb2YgY29sdW1ucyBhbmQgcm93cy5cblx0XHRjbGlwYm9hcmQgPSBjbGlwYm9hcmQuc3BsaXQoXCJcXG5cIik7XG5cdFx0XG5cdFx0Y2xpcGJvYXJkLmZvckVhY2goZnVuY3Rpb24ocm93KXtcblx0XHRcdGRhdGEucHVzaChyb3cuc3BsaXQoXCJcXHRcIikpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdGlmKGRhdGEubGVuZ3RoICYmICEoZGF0YS5sZW5ndGggPT09IDEgJiYgZGF0YVswXS5sZW5ndGggPCAyKSl7XG5cdFx0XHRcblx0XHRcdC8vY2hlY2sgaWYgaGVhZGVycyBhcmUgcHJlc2VudCBieSB0aXRsZVxuXHRcdFx0ZGF0YVswXS5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlKXtcblx0XHRcdFx0dmFyIGNvbHVtbiA9IGNvbHVtbnMuZmluZChmdW5jdGlvbihjb2x1bW4pe1xuXHRcdFx0XHRcdHJldHVybiB2YWx1ZSAmJiBjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSAmJiB2YWx1ZS50cmltKCkgJiYgY29sdW1uLmRlZmluaXRpb24udGl0bGUudHJpbSgpID09PSB2YWx1ZS50cmltKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoY29sdW1uKXtcblx0XHRcdFx0XHRjb2x1bW5NYXAucHVzaChjb2x1bW4pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0aGVhZGVyRmluZFN1Y2Nlc3MgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdC8vY2hlY2sgaWYgY29sdW1uIGhlYWRlcnMgYXJlIHByZXNlbnQgYnkgZmllbGRcblx0XHRcdGlmKCFoZWFkZXJGaW5kU3VjY2Vzcyl7XG5cdFx0XHRcdGhlYWRlckZpbmRTdWNjZXNzID0gdHJ1ZTtcblx0XHRcdFx0Y29sdW1uTWFwID0gW107XG5cdFx0XHRcdFxuXHRcdFx0XHRkYXRhWzBdLmZvckVhY2goZnVuY3Rpb24odmFsdWUpe1xuXHRcdFx0XHRcdHZhciBjb2x1bW4gPSBjb2x1bW5zLmZpbmQoZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZSAmJiBjb2x1bW4uZmllbGQgJiYgdmFsdWUudHJpbSgpICYmIGNvbHVtbi5maWVsZC50cmltKCkgPT09IHZhbHVlLnRyaW0oKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZihjb2x1bW4pe1xuXHRcdFx0XHRcdFx0Y29sdW1uTWFwLnB1c2goY29sdW1uKTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRoZWFkZXJGaW5kU3VjY2VzcyA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZighaGVhZGVyRmluZFN1Y2Nlc3Mpe1xuXHRcdFx0XHRcdGNvbHVtbk1hcCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHQvL3JlbW92ZSBoZWFkZXIgcm93IGlmIGZvdW5kXG5cdFx0XHRpZihoZWFkZXJGaW5kU3VjY2Vzcyl7XG5cdFx0XHRcdGRhdGEuc2hpZnQoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0ZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuXHRcdFx0XHR2YXIgcm93ID0ge307XG5cdFx0XHRcdFxuXHRcdFx0XHRpdGVtLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGkpe1xuXHRcdFx0XHRcdGlmKGNvbHVtbk1hcFtpXSl7XG5cdFx0XHRcdFx0XHRyb3dbY29sdW1uTWFwW2ldLmZpZWxkXSA9IHZhbHVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRyb3dzLnB1c2gocm93KTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRyZXR1cm4gcm93cztcblx0XHR9ZWxzZSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9LFxufTtcblxudmFyIGJpbmRpbmdzJDIgPSB7XHJcblx0Y29weVRvQ2xpcGJvYXJkOltcImN0cmwgKyA2N1wiLCBcIm1ldGEgKyA2N1wiXSxcclxufTtcblxudmFyIGFjdGlvbnMkMiA9IHtcclxuXHRjb3B5VG9DbGlwYm9hcmQ6ZnVuY3Rpb24oZSl7XHJcblx0XHRpZighdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpe1xyXG5cdFx0XHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNsaXBib2FyZFwiLCB0cnVlKSl7XHJcblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNsaXBib2FyZC5jb3B5KGZhbHNlLCB0cnVlKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcbn07XG5cbnZhciBleHRlbnNpb25zJDQgPSB7XHJcblx0a2V5YmluZGluZ3M6e1xyXG5cdFx0YmluZGluZ3M6YmluZGluZ3MkMixcclxuXHRcdGFjdGlvbnM6YWN0aW9ucyQyXHJcblx0fSxcclxufTtcblxuY2xhc3MgQ2xpcGJvYXJkIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJjbGlwYm9hcmRcIjtcblx0c3RhdGljIG1vZHVsZUV4dGVuc2lvbnMgPSBleHRlbnNpb25zJDQ7XG5cblx0Ly9sb2FkIGRlZmF1bHRzXG5cdHN0YXRpYyBwYXN0ZUFjdGlvbnMgPSBkZWZhdWx0UGFzdGVBY3Rpb25zO1xuXHRzdGF0aWMgcGFzdGVQYXJzZXJzID0gZGVmYXVsdFBhc3RlUGFyc2VycztcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy5tb2RlID0gdHJ1ZTtcblx0XHR0aGlzLnBhc3RlUGFyc2VyID0gZnVuY3Rpb24oKXt9O1xuXHRcdHRoaXMucGFzdGVBY3Rpb24gPSBmdW5jdGlvbigpe307XG5cdFx0dGhpcy5jdXN0b21TZWxlY3Rpb24gPSBmYWxzZTtcblx0XHR0aGlzLnJvd1JhbmdlID0gZmFsc2U7XG5cdFx0dGhpcy5ibG9ja2VkID0gdHJ1ZTsgLy9ibG9jayBjb3B5IGFjdGlvbnMgbm90IG9yaWdpbmF0aW5nIGZyb20gdGhpcyBjb21tYW5kXG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJjbGlwYm9hcmRcIiwgZmFsc2UpOyAvL2VuYWJsZSBjbGlwYm9hcmRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJjbGlwYm9hcmRDb3B5U3R5bGVkXCIsIHRydWUpOyAvL2Zvcm1hdHRlZCB0YWJsZSBkYXRhXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiY2xpcGJvYXJkQ29weUNvbmZpZ1wiLCBmYWxzZSk7IC8vY2xpcGJvYXJkIGNvbmZpZ1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImNsaXBib2FyZENvcHlGb3JtYXR0ZXJcIiwgZmFsc2UpOyAvL0RFUFJFQ0FURUQgLSBSRU1PVkUgaW4gNS4wXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiY2xpcGJvYXJkQ29weVJvd1JhbmdlXCIsIFwiYWN0aXZlXCIpOyAvL3Jlc3RyaWN0IGNsaXBib2FyZCB0byB2aXNpYmxlIHJvd3Mgb25seVxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImNsaXBib2FyZFBhc3RlUGFyc2VyXCIsIFwidGFibGVcIik7IC8vY29udmVydCBwYXN0ZWQgY2xpcGJvYXJkIGRhdGEgdG8gcm93c1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImNsaXBib2FyZFBhc3RlQWN0aW9uXCIsIFwiaW5zZXJ0XCIpOyAvL2hvdyB0byBpbnNlcnQgcGFzdGVkIGRhdGEgaW50byB0aGUgdGFibGVcblxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJjbGlwYm9hcmRcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcInRpdGxlQ2xpcGJvYXJkXCIpO1xuXHR9XG5cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMubW9kZSA9IHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmQ7XG5cblx0XHR0aGlzLnJvd1JhbmdlID0gdGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcHlSb3dSYW5nZTtcblxuXHRcdGlmKHRoaXMubW9kZSA9PT0gdHJ1ZSB8fCB0aGlzLm1vZGUgPT09IFwiY29weVwiKXtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY29weVwiLCAoZSkgPT4ge1xuXHRcdFx0XHR2YXIgcGxhaW4sIGh0bWwsIGxpc3Q7XG5cblx0XHRcdFx0aWYoIXRoaXMuYmxvY2tlZCl7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdFx0aWYodGhpcy5jdXN0b21TZWxlY3Rpb24pe1xuXHRcdFx0XHRcdFx0cGxhaW4gPSB0aGlzLmN1c3RvbVNlbGVjdGlvbjtcblxuXHRcdFx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcHlGb3JtYXR0ZXIpe1xuXHRcdFx0XHRcdFx0XHRwbGFpbiA9IHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Rm9ybWF0dGVyKFwicGxhaW5cIiwgcGxhaW4pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1lbHNlIHtcblxuXHRcdFx0XHRcdFx0bGlzdCA9IHRoaXMudGFibGUubW9kdWxlcy5leHBvcnQuZ2VuZXJhdGVFeHBvcnRMaXN0KHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Q29uZmlnLCB0aGlzLnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weVN0eWxlZCwgdGhpcy5yb3dSYW5nZSwgXCJjbGlwYm9hcmRcIik7XG5cblx0XHRcdFx0XHRcdGh0bWwgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZXhwb3J0LmdlbmVyYXRlSFRNTFRhYmxlKGxpc3QpO1xuXHRcdFx0XHRcdFx0cGxhaW4gPSBodG1sID8gdGhpcy5nZW5lcmF0ZVBsYWluQ29udGVudChsaXN0KSA6IFwiXCI7XG5cblx0XHRcdFx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Rm9ybWF0dGVyKXtcblx0XHRcdFx0XHRcdFx0cGxhaW4gPSB0aGlzLnRhYmxlLm9wdGlvbnMuY2xpcGJvYXJkQ29weUZvcm1hdHRlcihcInBsYWluXCIsIHBsYWluKTtcblx0XHRcdFx0XHRcdFx0aHRtbCA9IHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRDb3B5Rm9ybWF0dGVyKFwiaHRtbFwiLCBodG1sKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAod2luZG93LmNsaXBib2FyZERhdGEgJiYgd2luZG93LmNsaXBib2FyZERhdGEuc2V0RGF0YSkge1xuXHRcdFx0XHRcdFx0d2luZG93LmNsaXBib2FyZERhdGEuc2V0RGF0YSgnVGV4dCcsIHBsYWluKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKGUuY2xpcGJvYXJkRGF0YSAmJiBlLmNsaXBib2FyZERhdGEuc2V0RGF0YSkge1xuXHRcdFx0XHRcdFx0ZS5jbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvcGxhaW4nLCBwbGFpbik7XG5cdFx0XHRcdFx0XHRpZihodG1sKXtcblx0XHRcdFx0XHRcdFx0ZS5jbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvaHRtbCcsIGh0bWwpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhLnNldERhdGEpIHtcblx0XHRcdFx0XHRcdGUub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvcGxhaW4nLCBwbGFpbik7XG5cdFx0XHRcdFx0XHRpZihodG1sKXtcblx0XHRcdFx0XHRcdFx0ZS5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEuc2V0RGF0YSgndGV4dC9odG1sJywgaHRtbCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiY2xpcGJvYXJkQ29waWVkXCIsIHBsYWluLCBodG1sKTtcblxuXHRcdFx0XHRcdHRoaXMucmVzZXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0aWYodGhpcy5tb2RlID09PSB0cnVlIHx8IHRoaXMubW9kZSA9PT0gXCJwYXN0ZVwiKXtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicGFzdGVcIiwgKGUpID0+IHtcblx0XHRcdFx0dGhpcy5wYXN0ZShlKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHRoaXMuc2V0UGFzdGVQYXJzZXIodGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZFBhc3RlUGFyc2VyKTtcblx0XHR0aGlzLnNldFBhc3RlQWN0aW9uKHRoaXMudGFibGUub3B0aW9ucy5jbGlwYm9hcmRQYXN0ZUFjdGlvbik7XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImNvcHlUb0NsaXBib2FyZFwiLCB0aGlzLmNvcHkuYmluZCh0aGlzKSk7XG5cdH1cblxuXHRyZXNldCgpe1xuXHRcdHRoaXMuYmxvY2tlZCA9IHRydWU7XG5cdFx0dGhpcy5jdXN0b21TZWxlY3Rpb24gPSBmYWxzZTtcblx0fVxuXG5cdGdlbmVyYXRlUGxhaW5Db250ZW50IChsaXN0KSB7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0bGlzdC5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdHZhciByb3dEYXRhID0gW107XG5cblx0XHRcdHJvdy5jb2x1bW5zLmZvckVhY2goKGNvbCkgPT4ge1xuXHRcdFx0XHR2YXIgdmFsdWUgPSBcIlwiO1xuXG5cdFx0XHRcdGlmKGNvbCl7XG5cblx0XHRcdFx0XHRpZihyb3cudHlwZSA9PT0gXCJncm91cFwiKXtcblx0XHRcdFx0XHRcdGNvbC52YWx1ZSA9IGNvbC5jb21wb25lbnQuZ2V0S2V5KCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYoY29sLnZhbHVlID09PSBudWxsKXtcblx0XHRcdFx0XHRcdHZhbHVlID0gXCJcIjtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRzd2l0Y2godHlwZW9mIGNvbC52YWx1ZSl7XG5cdFx0XHRcdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRcdFx0XHR2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KGNvbC52YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gXCJcIjtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRcdHZhbHVlID0gY29sLnZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJvd0RhdGEucHVzaCh2YWx1ZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0b3V0cHV0LnB1c2gocm93RGF0YS5qb2luKFwiXFx0XCIpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQuam9pbihcIlxcblwiKTtcblx0fVxuXG5cdGNvcHkgKHJhbmdlLCBpbnRlcm5hbCkge1xuXHRcdHZhciBzZWwsIHRleHRSYW5nZTtcblx0XHR0aGlzLmJsb2NrZWQgPSBmYWxzZTtcblx0XHR0aGlzLmN1c3RvbVNlbGVjdGlvbiA9IGZhbHNlO1xuXHRcblxuXHRcdGlmICh0aGlzLm1vZGUgPT09IHRydWUgfHwgdGhpcy5tb2RlID09PSBcImNvcHlcIikge1xuXG5cdFx0XHR0aGlzLnJvd1JhbmdlID0gcmFuZ2UgfHwgdGhpcy50YWJsZS5vcHRpb25zLmNsaXBib2FyZENvcHlSb3dSYW5nZTtcblxuXHRcdFx0aWYgKHR5cGVvZiB3aW5kb3cuZ2V0U2VsZWN0aW9uICE9IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIGRvY3VtZW50LmNyZWF0ZVJhbmdlICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0cmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuXHRcdFx0XHRyYW5nZS5zZWxlY3ROb2RlQ29udGVudHModGhpcy50YWJsZS5lbGVtZW50KTtcblx0XHRcdFx0c2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuXG5cdFx0XHRcdGlmIChzZWwudG9TdHJpbmcoKSAmJiBpbnRlcm5hbCkge1xuXHRcdFx0XHRcdHRoaXMuY3VzdG9tU2VsZWN0aW9uID0gc2VsLnRvU3RyaW5nKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7XG5cdFx0XHRcdHNlbC5hZGRSYW5nZShyYW5nZSk7XG5cdFx0XHR9IGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudC5zZWxlY3Rpb24gIT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UgIT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHR0ZXh0UmFuZ2UgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuXHRcdFx0XHR0ZXh0UmFuZ2UubW92ZVRvRWxlbWVudFRleHQodGhpcy50YWJsZS5lbGVtZW50KTtcblx0XHRcdFx0dGV4dFJhbmdlLnNlbGVjdCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRkb2N1bWVudC5leGVjQ29tbWFuZCgnY29weScpO1xuXG5cdFx0XHRpZiAoc2VsKSB7XG5cdFx0XHRcdHNlbC5yZW1vdmVBbGxSYW5nZXMoKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvL1BBU1RFIEVWRU5UIEhBTkRMSU5HXG5cdHNldFBhc3RlQWN0aW9uKGFjdGlvbil7XG5cblx0XHRzd2l0Y2godHlwZW9mIGFjdGlvbil7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdHRoaXMucGFzdGVBY3Rpb24gPSBDbGlwYm9hcmQucGFzdGVBY3Rpb25zW2FjdGlvbl07XG5cblx0XHRcdFx0aWYoIXRoaXMucGFzdGVBY3Rpb24pe1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNsaXBib2FyZCBFcnJvciAtIE5vIHN1Y2ggcGFzdGUgYWN0aW9uIGZvdW5kOlwiLCBhY3Rpb24pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0dGhpcy5wYXN0ZUFjdGlvbiA9IGFjdGlvbjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cblx0c2V0UGFzdGVQYXJzZXIocGFyc2VyKXtcblx0XHRzd2l0Y2godHlwZW9mIHBhcnNlcil7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdHRoaXMucGFzdGVQYXJzZXIgPSBDbGlwYm9hcmQucGFzdGVQYXJzZXJzW3BhcnNlcl07XG5cblx0XHRcdFx0aWYoIXRoaXMucGFzdGVQYXJzZXIpe1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNsaXBib2FyZCBFcnJvciAtIE5vIHN1Y2ggcGFzdGUgcGFyc2VyIGZvdW5kOlwiLCBwYXJzZXIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0dGhpcy5wYXN0ZVBhcnNlciA9IHBhcnNlcjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cblx0cGFzdGUoZSl7XG5cdFx0dmFyIGRhdGEsIHJvd0RhdGEsIHJvd3M7XG5cblx0XHRpZih0aGlzLmNoZWNrUGFzdGVPcmlnaW4oZSkpe1xuXG5cdFx0XHRkYXRhID0gdGhpcy5nZXRQYXN0ZURhdGEoZSk7XG5cblx0XHRcdHJvd0RhdGEgPSB0aGlzLnBhc3RlUGFyc2VyLmNhbGwodGhpcywgZGF0YSk7XG5cblx0XHRcdGlmKHJvd0RhdGEpe1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0aWYodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJtdXRhdG9yXCIpKXtcblx0XHRcdFx0XHRyb3dEYXRhID0gdGhpcy5tdXRhdGVEYXRhKHJvd0RhdGEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm93cyA9IHRoaXMucGFzdGVBY3Rpb24uY2FsbCh0aGlzLCByb3dEYXRhKTtcblxuXHRcdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJjbGlwYm9hcmRQYXN0ZWRcIiwgZGF0YSwgcm93RGF0YSwgcm93cyk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImNsaXBib2FyZFBhc3RlRXJyb3JcIiwgZGF0YSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0bXV0YXRlRGF0YShkYXRhKXtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHRpZihBcnJheS5pc0FycmF5KGRhdGEpKXtcblx0XHRcdGRhdGEuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdG91dHB1dC5wdXNoKHRoaXMudGFibGUubW9kdWxlcy5tdXRhdG9yLnRyYW5zZm9ybVJvdyhyb3csIFwiY2xpcGJvYXJkXCIpKTtcblx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdG91dHB1dCA9IGRhdGE7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXG5cblx0Y2hlY2tQYXN0ZU9yaWdpbihlKXtcblx0XHR2YXIgdmFsaWQgPSB0cnVlO1xuXHRcdHZhciBibG9ja2VkID0gdGhpcy5jb25maXJtKFwiY2xpcGJvYXJkLXBhc3RlXCIsIFtlXSk7XG5cblx0XHRpZihibG9ja2VkIHx8ICFbXCJESVZcIiwgXCJTUEFOXCJdLmluY2x1ZGVzKGUudGFyZ2V0LnRhZ05hbWUpKXtcblx0XHRcdHZhbGlkID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHZhbGlkO1xuXHR9XG5cblx0Z2V0UGFzdGVEYXRhKGUpe1xuXHRcdHZhciBkYXRhO1xuXG5cdFx0aWYgKHdpbmRvdy5jbGlwYm9hcmREYXRhICYmIHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEpIHtcblx0XHRcdGRhdGEgPSB3aW5kb3cuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0Jyk7XG5cdFx0fSBlbHNlIGlmIChlLmNsaXBib2FyZERhdGEgJiYgZS5jbGlwYm9hcmREYXRhLmdldERhdGEpIHtcblx0XHRcdGRhdGEgPSBlLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpO1xuXHRcdH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50ICYmIGUub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhLmdldERhdGEpIHtcblx0XHRcdGRhdGEgPSBlLm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH1cbn1cblxuY2xhc3MgQ2FsY0NvbXBvbmVudHtcblx0Y29uc3RydWN0b3IgKHJvdyl7XG5cdFx0dGhpcy5fcm93ID0gcm93O1xuXG5cdFx0cmV0dXJuIG5ldyBQcm94eSh0aGlzLCB7XG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKHRhcmdldCwgbmFtZSwgcmVjZWl2ZXIpIHtcblx0XHRcdFx0aWYgKHR5cGVvZiB0YXJnZXRbbmFtZV0gIT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGFyZ2V0W25hbWVdO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRhcmdldC5fcm93LnRhYmxlLmNvbXBvbmVudEZ1bmN0aW9uQmluZGVyLmhhbmRsZShcInJvd1wiLCB0YXJnZXQuX3JvdywgbmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdGdldERhdGEodHJhbnNmb3JtKXtcblx0XHRyZXR1cm4gdGhpcy5fcm93LmdldERhdGEodHJhbnNmb3JtKTtcblx0fVxuXG5cdGdldEVsZW1lbnQoKXtcblx0XHRyZXR1cm4gdGhpcy5fcm93LmdldEVsZW1lbnQoKTtcblx0fVxuXG5cdGdldFRhYmxlKCl7XG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy50YWJsZTtcblx0fVxuXG5cdGdldENlbGxzKCl7XG5cdFx0dmFyIGNlbGxzID0gW107XG5cblx0XHR0aGlzLl9yb3cuZ2V0Q2VsbHMoKS5mb3JFYWNoKGZ1bmN0aW9uKGNlbGwpe1xuXHRcdFx0Y2VsbHMucHVzaChjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBjZWxscztcblx0fVxuXG5cdGdldENlbGwoY29sdW1uKXtcblx0XHR2YXIgY2VsbCA9IHRoaXMuX3Jvdy5nZXRDZWxsKGNvbHVtbik7XG5cdFx0cmV0dXJuIGNlbGwgPyBjZWxsLmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH1cblxuXHRfZ2V0U2VsZigpe1xuXHRcdHJldHVybiB0aGlzLl9yb3c7XG5cdH1cbn1cblxuLy9wdWJsaWMgY2VsbCBvYmplY3RcbmNsYXNzIENlbGxDb21wb25lbnQge1xuXG5cdGNvbnN0cnVjdG9yIChjZWxsKXtcblx0XHR0aGlzLl9jZWxsID0gY2VsbDtcblxuXHRcdHJldHVybiBuZXcgUHJveHkodGhpcywge1xuXHRcdFx0Z2V0OiBmdW5jdGlvbih0YXJnZXQsIG5hbWUsIHJlY2VpdmVyKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgdGFyZ2V0W25hbWVdICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRhcmdldFtuYW1lXTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiB0YXJnZXQuX2NlbGwudGFibGUuY29tcG9uZW50RnVuY3Rpb25CaW5kZXIuaGFuZGxlKFwiY2VsbFwiLCB0YXJnZXQuX2NlbGwsIG5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHRnZXRWYWx1ZSgpe1xuXHRcdHJldHVybiB0aGlzLl9jZWxsLmdldFZhbHVlKCk7XG5cdH1cblxuXHRnZXRPbGRWYWx1ZSgpe1xuXHRcdHJldHVybiB0aGlzLl9jZWxsLmdldE9sZFZhbHVlKCk7XG5cdH1cblxuXHRnZXRJbml0aWFsVmFsdWUoKXtcblx0XHRyZXR1cm4gdGhpcy5fY2VsbC5pbml0aWFsVmFsdWU7XG5cdH1cblxuXHRnZXRFbGVtZW50KCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwuZ2V0RWxlbWVudCgpO1xuXHR9XG5cblx0Z2V0Um93KCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwucm93LmdldENvbXBvbmVudCgpO1xuXHR9XG5cblx0Z2V0RGF0YSh0cmFuc2Zvcm0pe1xuXHRcdHJldHVybiB0aGlzLl9jZWxsLnJvdy5nZXREYXRhKHRyYW5zZm9ybSk7XG5cdH1cblx0Z2V0VHlwZSgpe1xuXHRcdHJldHVybiBcImNlbGxcIjtcblx0fVxuXHRnZXRGaWVsZCgpe1xuXHRcdHJldHVybiB0aGlzLl9jZWxsLmNvbHVtbi5nZXRGaWVsZCgpO1xuXHR9XG5cblx0Z2V0Q29sdW1uKCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NlbGwuY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHR9XG5cblx0c2V0VmFsdWUodmFsdWUsIG11dGF0ZSl7XG5cdFx0aWYodHlwZW9mIG11dGF0ZSA9PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdG11dGF0ZSA9IHRydWU7XG5cdFx0fVxuXG5cdFx0dGhpcy5fY2VsbC5zZXRWYWx1ZSh2YWx1ZSwgbXV0YXRlKTtcblx0fVxuXG5cdHJlc3RvcmVPbGRWYWx1ZSgpe1xuXHRcdHRoaXMuX2NlbGwuc2V0VmFsdWVBY3R1YWwodGhpcy5fY2VsbC5nZXRPbGRWYWx1ZSgpKTtcblx0fVxuXG5cdHJlc3RvcmVJbml0aWFsVmFsdWUoKXtcblx0XHR0aGlzLl9jZWxsLnNldFZhbHVlQWN0dWFsKHRoaXMuX2NlbGwuaW5pdGlhbFZhbHVlKTtcblx0fVxuXG5cdGNoZWNrSGVpZ2h0KCl7XG5cdFx0dGhpcy5fY2VsbC5jaGVja0hlaWdodCgpO1xuXHR9XG5cblx0Z2V0VGFibGUoKXtcblx0XHRyZXR1cm4gdGhpcy5fY2VsbC50YWJsZTtcblx0fVxuXG5cdF9nZXRTZWxmKCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NlbGw7XG5cdH1cbn1cblxuY2xhc3MgQ2VsbCBleHRlbmRzIENvcmVGZWF0dXJle1xuXHRjb25zdHJ1Y3Rvcihjb2x1bW4sIHJvdyl7XG5cdFx0c3VwZXIoY29sdW1uLnRhYmxlKTtcblxuXHRcdHRoaXMudGFibGUgPSBjb2x1bW4udGFibGU7XG5cdFx0dGhpcy5jb2x1bW4gPSBjb2x1bW47XG5cdFx0dGhpcy5yb3cgPSByb3c7XG5cdFx0dGhpcy5lbGVtZW50ID0gbnVsbDtcblx0XHR0aGlzLnZhbHVlID0gbnVsbDtcblx0XHR0aGlzLmluaXRpYWxWYWx1ZTtcblx0XHR0aGlzLm9sZFZhbHVlID0gbnVsbDtcblx0XHR0aGlzLm1vZHVsZXMgPSB7fTtcblxuXHRcdHRoaXMuaGVpZ2h0ID0gbnVsbDtcblx0XHR0aGlzLndpZHRoID0gbnVsbDtcblx0XHR0aGlzLm1pbldpZHRoID0gbnVsbDtcblxuXHRcdHRoaXMuY29tcG9uZW50ID0gbnVsbDtcblxuXHRcdHRoaXMubG9hZGVkID0gZmFsc2U7IC8vdHJhY2sgaWYgdGhlIGNlbGwgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIERPTSB5ZXRcblxuXHRcdHRoaXMuYnVpbGQoKTtcblx0fVxuXG5cdC8vLy8vLy8vLy8vLy8vLy8gU2V0dXAgRnVuY3Rpb25zIC8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vZ2VuZXJhdGUgZWxlbWVudFxuXHRidWlsZCgpe1xuXHRcdHRoaXMuZ2VuZXJhdGVFbGVtZW50KCk7XG5cblx0XHR0aGlzLnNldFdpZHRoKCk7XG5cblx0XHR0aGlzLl9jb25maWd1cmVDZWxsKCk7XG5cblx0XHR0aGlzLnNldFZhbHVlQWN0dWFsKHRoaXMuY29sdW1uLmdldEZpZWxkVmFsdWUodGhpcy5yb3cuZGF0YSkpO1xuXG5cdFx0dGhpcy5pbml0aWFsVmFsdWUgPSB0aGlzLnZhbHVlO1xuXHR9XG5cblx0Z2VuZXJhdGVFbGVtZW50KCl7XG5cdFx0dGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9IFwidGFidWxhdG9yLWNlbGxcIjtcblx0XHR0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcImdyaWRjZWxsXCIpO1xuXG5cdFx0aWYodGhpcy5jb2x1bW4uaXNSb3dIZWFkZXIpe1xuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LWhlYWRlclwiKTtcblx0XHR9XG5cdH1cblxuXHRfY29uZmlndXJlQ2VsbCgpe1xuXHRcdHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LFxuXHRcdGZpZWxkID0gdGhpcy5jb2x1bW4uZ2V0RmllbGQoKSxcblx0XHR2ZXJ0QWxpZ25zID0ge1xuXHRcdFx0dG9wOlwiZmxleC1zdGFydFwiLFxuXHRcdFx0Ym90dG9tOlwiZmxleC1lbmRcIixcblx0XHRcdG1pZGRsZTpcImNlbnRlclwiLFxuXHRcdH0sXG5cdFx0aG96QWxpZ25zID0ge1xuXHRcdFx0bGVmdDpcImZsZXgtc3RhcnRcIixcblx0XHRcdHJpZ2h0OlwiZmxleC1lbmRcIixcblx0XHRcdGNlbnRlcjpcImNlbnRlclwiLFxuXHRcdH07XG5cblx0XHQvL3NldCB0ZXh0IGFsaWdubWVudFxuXHRcdGVsZW1lbnQuc3R5bGUudGV4dEFsaWduID0gdGhpcy5jb2x1bW4uaG96QWxpZ247XG5cblx0XHRpZih0aGlzLmNvbHVtbi52ZXJ0QWxpZ24pe1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtZmxleFwiO1xuXG5cdFx0XHRlbGVtZW50LnN0eWxlLmFsaWduSXRlbXMgPSB2ZXJ0QWxpZ25zW3RoaXMuY29sdW1uLnZlcnRBbGlnbl0gfHwgXCJcIjtcblxuXHRcdFx0aWYodGhpcy5jb2x1bW4uaG96QWxpZ24pe1xuXHRcdFx0XHRlbGVtZW50LnN0eWxlLmp1c3RpZnlDb250ZW50ID0gaG96QWxpZ25zW3RoaXMuY29sdW1uLmhvekFsaWduXSB8fCBcIlwiO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmKGZpZWxkKXtcblx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGFidWxhdG9yLWZpZWxkXCIsIGZpZWxkKTtcblx0XHR9XG5cblx0XHQvL2FkZCBjbGFzcyB0byBjZWxsIGlmIG5lZWRlZFxuXHRcdGlmKHRoaXMuY29sdW1uLmRlZmluaXRpb24uY3NzQ2xhc3Mpe1xuXHRcdFx0dmFyIGNsYXNzTmFtZXMgPSB0aGlzLmNvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzLnNwbGl0KFwiIFwiKTtcblx0XHRcdGNsYXNzTmFtZXMuZm9yRWFjaCgoY2xhc3NOYW1lKSA9PiB7XG5cdFx0XHRcdGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5kaXNwYXRjaChcImNlbGwtaW5pdFwiLCB0aGlzKTtcblxuXHRcdC8vaGlkZSBjZWxsIGlmIG5vdCB2aXNpYmxlXG5cdFx0aWYoIXRoaXMuY29sdW1uLnZpc2libGUpe1xuXHRcdFx0dGhpcy5oaWRlKCk7XG5cdFx0fVxuXHR9XG5cblx0Ly9nZW5lcmF0ZSBjZWxsIGNvbnRlbnRzXG5cdF9nZW5lcmF0ZUNvbnRlbnRzKCl7XG5cdFx0dmFyIHZhbDtcblxuXHRcdHZhbCA9IHRoaXMuY2hhaW4oXCJjZWxsLWZvcm1hdFwiLCB0aGlzLCBudWxsLCAoKSA9PiB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lbGVtZW50LmlubmVySFRNTCA9IHRoaXMudmFsdWU7XG5cdFx0fSk7XG5cblx0XHRzd2l0Y2godHlwZW9mIHZhbCl7XG5cdFx0XHRjYXNlIFwib2JqZWN0XCI6XG5cdFx0XHRcdGlmKHZhbCBpbnN0YW5jZW9mIE5vZGUpe1xuXG5cdFx0XHRcdFx0Ly9jbGVhciBwcmV2aW91cyBjZWxsIGNvbnRlbnRzXG5cdFx0XHRcdFx0d2hpbGUodGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpIHRoaXMuZWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cblx0XHRcdFx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodmFsKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuZWxlbWVudC5pbm5lckhUTUwgPSBcIlwiO1xuXG5cdFx0XHRcdFx0aWYodmFsICE9IG51bGwpe1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRm9ybWF0IEVycm9yIC0gRm9ybWF0dGVyIGhhcyByZXR1cm5lZCBhIHR5cGUgb2Ygb2JqZWN0LCB0aGUgb25seSB2YWxpZCBmb3JtYXR0ZXIgb2JqZWN0IHJldHVybiBpcyBhbiBpbnN0YW5jZSBvZiBOb2RlLCB0aGUgZm9ybWF0dGVyIHJldHVybmVkOlwiLCB2YWwpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IHZhbDtcblx0XHR9XG5cdH1cblxuXHRjZWxsUmVuZGVyZWQoKXtcblx0XHR0aGlzLmRpc3BhdGNoKFwiY2VsbC1yZW5kZXJlZFwiLCB0aGlzKTtcblx0fVxuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vIEdldHRlcnMgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Z2V0RWxlbWVudChjb250YWluZXJPbmx5KXtcblx0XHRpZighdGhpcy5sb2FkZWQpe1xuXHRcdFx0dGhpcy5sb2FkZWQgPSB0cnVlO1xuXHRcdFx0aWYoIWNvbnRhaW5lck9ubHkpe1xuXHRcdFx0XHR0aGlzLmxheW91dEVsZW1lbnQoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9XG5cblx0Z2V0VmFsdWUoKXtcblx0XHRyZXR1cm4gdGhpcy52YWx1ZTtcblx0fVxuXG5cdGdldE9sZFZhbHVlKCl7XG5cdFx0cmV0dXJuIHRoaXMub2xkVmFsdWU7XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLyBBY3Rpb25zIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdHNldFZhbHVlKHZhbHVlLCBtdXRhdGUsIGZvcmNlKXtcblx0XHR2YXIgY2hhbmdlZCA9IHRoaXMuc2V0VmFsdWVQcm9jZXNzRGF0YSh2YWx1ZSwgbXV0YXRlLCBmb3JjZSk7XG5cblx0XHRpZihjaGFuZ2VkKXtcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJjZWxsLXZhbHVlLXVwZGF0ZWRcIiwgdGhpcyk7XG5cblx0XHRcdHRoaXMuY2VsbFJlbmRlcmVkKCk7XG5cblx0XHRcdGlmKHRoaXMuY29sdW1uLmRlZmluaXRpb24uY2VsbEVkaXRlZCl7XG5cdFx0XHRcdHRoaXMuY29sdW1uLmRlZmluaXRpb24uY2VsbEVkaXRlZC5jYWxsKHRoaXMudGFibGUsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJjZWxsRWRpdGVkXCIsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xuXG5cdFx0XHRpZih0aGlzLnN1YnNjcmliZWRFeHRlcm5hbChcImRhdGFDaGFuZ2VkXCIpKXtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiZGF0YUNoYW5nZWRcIiwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERhdGEoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0c2V0VmFsdWVQcm9jZXNzRGF0YSh2YWx1ZSwgbXV0YXRlLCBmb3JjZSl7XG5cdFx0dmFyIGNoYW5nZWQgPSBmYWxzZTtcblxuXHRcdGlmKHRoaXMudmFsdWUgIT09IHZhbHVlIHx8IGZvcmNlKXtcblxuXHRcdFx0Y2hhbmdlZCA9IHRydWU7XG5cblx0XHRcdGlmKG11dGF0ZSl7XG5cdFx0XHRcdHZhbHVlID0gdGhpcy5jaGFpbihcImNlbGwtdmFsdWUtY2hhbmdpbmdcIiwgW3RoaXMsIHZhbHVlXSwgbnVsbCwgdmFsdWUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuc2V0VmFsdWVBY3R1YWwodmFsdWUpO1xuXG5cdFx0aWYoY2hhbmdlZCl7XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwiY2VsbC12YWx1ZS1jaGFuZ2VkXCIsIHRoaXMpO1xuXHRcdH1cblxuXHRcdHJldHVybiBjaGFuZ2VkO1xuXHR9XG5cblx0c2V0VmFsdWVBY3R1YWwodmFsdWUpe1xuXHRcdHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xuXG5cdFx0dGhpcy52YWx1ZSA9IHZhbHVlO1xuXG5cdFx0dGhpcy5kaXNwYXRjaChcImNlbGwtdmFsdWUtc2F2ZS1iZWZvcmVcIiwgdGhpcyk7XG5cblx0XHR0aGlzLmNvbHVtbi5zZXRGaWVsZFZhbHVlKHRoaXMucm93LmRhdGEsIHZhbHVlKTtcblxuXHRcdHRoaXMuZGlzcGF0Y2goXCJjZWxsLXZhbHVlLXNhdmUtYWZ0ZXJcIiwgdGhpcyk7XG5cblx0XHRpZih0aGlzLmxvYWRlZCl7XG5cdFx0XHR0aGlzLmxheW91dEVsZW1lbnQoKTtcblx0XHR9XG5cdH1cblxuXHRsYXlvdXRFbGVtZW50KCl7XG5cdFx0dGhpcy5fZ2VuZXJhdGVDb250ZW50cygpO1xuXG5cdFx0dGhpcy5kaXNwYXRjaChcImNlbGwtbGF5b3V0XCIsIHRoaXMpO1xuXHR9XG5cblx0c2V0V2lkdGgoKXtcblx0XHR0aGlzLndpZHRoID0gdGhpcy5jb2x1bW4ud2lkdGg7XG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gdGhpcy5jb2x1bW4ud2lkdGhTdHlsZWQ7XG5cdH1cblxuXHRjbGVhcldpZHRoKCl7XG5cdFx0dGhpcy53aWR0aCA9IFwiXCI7XG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gXCJcIjtcblx0fVxuXG5cdGdldFdpZHRoKCl7XG5cdFx0cmV0dXJuIHRoaXMud2lkdGggfHwgdGhpcy5lbGVtZW50Lm9mZnNldFdpZHRoO1xuXHR9XG5cblx0c2V0TWluV2lkdGgoKXtcblx0XHR0aGlzLm1pbldpZHRoID0gdGhpcy5jb2x1bW4ubWluV2lkdGg7XG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLm1pbldpZHRoID0gdGhpcy5jb2x1bW4ubWluV2lkdGhTdHlsZWQ7XG5cdH1cblxuXHRzZXRNYXhXaWR0aCgpe1xuXHRcdHRoaXMubWF4V2lkdGggPSB0aGlzLmNvbHVtbi5tYXhXaWR0aDtcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubWF4V2lkdGggPSB0aGlzLmNvbHVtbi5tYXhXaWR0aFN0eWxlZDtcblx0fVxuXG5cdGNoZWNrSGVpZ2h0KCl7XG5cdFx0Ly8gdmFyIGhlaWdodCA9IHRoaXMuZWxlbWVudC5jc3MoXCJoZWlnaHRcIik7XG5cdFx0dGhpcy5yb3cucmVpbml0aWFsaXplSGVpZ2h0KCk7XG5cdH1cblxuXHRjbGVhckhlaWdodCgpe1xuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBcIlwiO1xuXHRcdHRoaXMuaGVpZ2h0ID0gbnVsbDtcblxuXHRcdHRoaXMuZGlzcGF0Y2goXCJjZWxsLWhlaWdodFwiLCB0aGlzLCBcIlwiKTtcblx0fVxuXG5cdHNldEhlaWdodCgpe1xuXHRcdHRoaXMuaGVpZ2h0ID0gdGhpcy5yb3cuaGVpZ2h0O1xuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLnJvdy5oZWlnaHRTdHlsZWQ7XG5cblx0XHR0aGlzLmRpc3BhdGNoKFwiY2VsbC1oZWlnaHRcIiwgdGhpcywgdGhpcy5yb3cuaGVpZ2h0U3R5bGVkKTtcblx0fVxuXG5cdGdldEhlaWdodCgpe1xuXHRcdHJldHVybiB0aGlzLmhlaWdodCB8fCB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuXHR9XG5cblx0c2hvdygpe1xuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gdGhpcy5jb2x1bW4udmVydEFsaWduID8gXCJpbmxpbmUtZmxleFwiIDogXCJcIjtcblx0fVxuXG5cdGhpZGUoKXtcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXHR9XG5cblx0ZGVsZXRlKCl7XG5cdFx0dGhpcy5kaXNwYXRjaChcImNlbGwtZGVsZXRlXCIsIHRoaXMpO1xuXG5cdFx0aWYoIXRoaXMudGFibGUucm93TWFuYWdlci5yZWRyYXdCbG9jayAmJiB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZSl7XG5cdFx0XHR0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xuXHRcdH1cblxuXHRcdHRoaXMuZWxlbWVudCA9IGZhbHNlO1xuXHRcdHRoaXMuY29sdW1uLmRlbGV0ZUNlbGwodGhpcyk7XG5cdFx0dGhpcy5yb3cuZGVsZXRlQ2VsbCh0aGlzKTtcblx0XHR0aGlzLmNhbGNzID0ge307XG5cdH1cblxuXHRnZXRJbmRleCgpe1xuXHRcdHJldHVybiB0aGlzLnJvdy5nZXRDZWxsSW5kZXgodGhpcyk7XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vIE9iamVjdCBHZW5lcmF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vXG5cdGdldENvbXBvbmVudCgpe1xuXHRcdGlmKCF0aGlzLmNvbXBvbmVudCl7XG5cdFx0XHR0aGlzLmNvbXBvbmVudCA9IG5ldyBDZWxsQ29tcG9uZW50KHRoaXMpO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLmNvbXBvbmVudDtcblx0fVxufVxuXG4vL3B1YmxpYyBjb2x1bW4gb2JqZWN0XG5jbGFzcyBDb2x1bW5Db21wb25lbnQge1xuXHRjb25zdHJ1Y3RvciAoY29sdW1uKXtcblx0XHR0aGlzLl9jb2x1bW4gPSBjb2x1bW47XG5cdFx0dGhpcy50eXBlID0gXCJDb2x1bW5Db21wb25lbnRcIjtcblxuXHRcdHJldHVybiBuZXcgUHJveHkodGhpcywge1xuXHRcdFx0Z2V0OiBmdW5jdGlvbih0YXJnZXQsIG5hbWUsIHJlY2VpdmVyKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgdGFyZ2V0W25hbWVdICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRhcmdldFtuYW1lXTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiB0YXJnZXQuX2NvbHVtbi50YWJsZS5jb21wb25lbnRGdW5jdGlvbkJpbmRlci5oYW5kbGUoXCJjb2x1bW5cIiwgdGFyZ2V0Ll9jb2x1bW4sIG5hbWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHRnZXRFbGVtZW50KCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5nZXRFbGVtZW50KCk7XG5cdH1cblxuXHRnZXREZWZpbml0aW9uKCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5nZXREZWZpbml0aW9uKCk7XG5cdH1cblxuXHRnZXRGaWVsZCgpe1xuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4uZ2V0RmllbGQoKTtcblx0fVxuXG5cdGdldFRpdGxlRG93bmxvYWQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5nZXRUaXRsZURvd25sb2FkKCk7XG5cdH1cblxuXHRnZXRDZWxscygpe1xuXHRcdHZhciBjZWxscyA9IFtdO1xuXG5cdFx0dGhpcy5fY29sdW1uLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oY2VsbCl7XG5cdFx0XHRjZWxscy5wdXNoKGNlbGwuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNlbGxzO1xuXHR9XG5cblx0aXNWaXNpYmxlKCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi52aXNpYmxlO1xuXHR9XG5cblx0c2hvdygpe1xuXHRcdGlmKHRoaXMuX2NvbHVtbi5pc0dyb3VwKXtcblx0XHRcdHRoaXMuX2NvbHVtbi5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdFx0Y29sdW1uLnNob3coKTtcblx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuX2NvbHVtbi5zaG93KCk7XG5cdFx0fVxuXHR9XG5cblx0aGlkZSgpe1xuXHRcdGlmKHRoaXMuX2NvbHVtbi5pc0dyb3VwKXtcblx0XHRcdHRoaXMuX2NvbHVtbi5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdFx0Y29sdW1uLmhpZGUoKTtcblx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuX2NvbHVtbi5oaWRlKCk7XG5cdFx0fVxuXHR9XG5cblx0dG9nZ2xlKCl7XG5cdFx0aWYodGhpcy5fY29sdW1uLnZpc2libGUpe1xuXHRcdFx0dGhpcy5oaWRlKCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5zaG93KCk7XG5cdFx0fVxuXHR9XG5cblx0ZGVsZXRlKCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5kZWxldGUoKTtcblx0fVxuXG5cdGdldFN1YkNvbHVtbnMoKXtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHRpZih0aGlzLl9jb2x1bW4uY29sdW1ucy5sZW5ndGgpe1xuXHRcdFx0dGhpcy5fY29sdW1uLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pe1xuXHRcdFx0XHRvdXRwdXQucHVzaChjb2x1bW4uZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXG5cdGdldFBhcmVudENvbHVtbigpe1xuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4uZ2V0UGFyZW50Q29tcG9uZW50KCk7XG5cdH1cblxuXHRfZ2V0U2VsZigpe1xuXHRcdHJldHVybiB0aGlzLl9jb2x1bW47XG5cdH1cblxuXHRzY3JvbGxUbyhwb3NpdGlvbiwgaWZWaXNpYmxlKXtcblx0XHRyZXR1cm4gdGhpcy5fY29sdW1uLnRhYmxlLmNvbHVtbk1hbmFnZXIuc2Nyb2xsVG9Db2x1bW4odGhpcy5fY29sdW1uLCBwb3NpdGlvbiwgaWZWaXNpYmxlKTtcblx0fVxuXG5cdGdldFRhYmxlKCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi50YWJsZTtcblx0fVxuXG5cdG1vdmUodG8sIGFmdGVyKXtcblx0XHR2YXIgdG9Db2x1bW4gPSB0aGlzLl9jb2x1bW4udGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKHRvKTtcblxuXHRcdGlmKHRvQ29sdW1uKXtcblx0XHRcdHRoaXMuX2NvbHVtbi50YWJsZS5jb2x1bW5NYW5hZ2VyLm1vdmVDb2x1bW4odGhpcy5fY29sdW1uLCB0b0NvbHVtbiwgYWZ0ZXIpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIk1vdmUgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIHRvQ29sdW1uKTtcblx0XHR9XG5cdH1cblxuXHRnZXROZXh0Q29sdW1uKCl7XG5cdFx0dmFyIG5leHRDb2wgPSB0aGlzLl9jb2x1bW4ubmV4dENvbHVtbigpO1xuXG5cdFx0cmV0dXJuIG5leHRDb2wgPyBuZXh0Q29sLmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH1cblxuXHRnZXRQcmV2Q29sdW1uKCl7XG5cdFx0dmFyIHByZXZDb2wgPSB0aGlzLl9jb2x1bW4ucHJldkNvbHVtbigpO1xuXG5cdFx0cmV0dXJuIHByZXZDb2wgPyBwcmV2Q29sLmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH1cblxuXHR1cGRhdGVEZWZpbml0aW9uKHVwZGF0ZXMpe1xuXHRcdHJldHVybiB0aGlzLl9jb2x1bW4udXBkYXRlRGVmaW5pdGlvbih1cGRhdGVzKTtcblx0fVxuXG5cdGdldFdpZHRoKCl7XG5cdFx0cmV0dXJuIHRoaXMuX2NvbHVtbi5nZXRXaWR0aCgpO1xuXHR9XG5cblx0c2V0V2lkdGgod2lkdGgpe1xuXHRcdHZhciByZXN1bHQ7XG5cblx0XHRpZih3aWR0aCA9PT0gdHJ1ZSl7XG5cdFx0XHRyZXN1bHQgPSAgdGhpcy5fY29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKHRydWUpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJlc3VsdCA9ICB0aGlzLl9jb2x1bW4uc2V0V2lkdGgod2lkdGgpO1xuXHRcdH1cblxuXHRcdHRoaXMuX2NvbHVtbi50YWJsZS5jb2x1bW5NYW5hZ2VyLnJlcmVuZGVyQ29sdW1ucyh0cnVlKTtcblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH1cbn1cblxudmFyIGRlZmF1bHRDb2x1bW5PcHRpb25zID0ge1xuXHRcInRpdGxlXCI6IHVuZGVmaW5lZCxcblx0XCJmaWVsZFwiOiB1bmRlZmluZWQsXG5cdFwiY29sdW1uc1wiOiB1bmRlZmluZWQsXG5cdFwidmlzaWJsZVwiOiB1bmRlZmluZWQsXG5cdFwiaG96QWxpZ25cIjogdW5kZWZpbmVkLFxuXHRcInZlcnRBbGlnblwiOiB1bmRlZmluZWQsXG5cdFwid2lkdGhcIjogdW5kZWZpbmVkLFxuXHRcIm1pbldpZHRoXCI6IDQwLFxuXHRcIm1heFdpZHRoXCI6IHVuZGVmaW5lZCxcblx0XCJtYXhJbml0aWFsV2lkdGhcIjogdW5kZWZpbmVkLFxuXHRcImNzc0NsYXNzXCI6IHVuZGVmaW5lZCxcblx0XCJ2YXJpYWJsZUhlaWdodFwiOiB1bmRlZmluZWQsXG5cdFwiaGVhZGVyVmVydGljYWxcIjogdW5kZWZpbmVkLFxuXHRcImhlYWRlckhvekFsaWduXCI6IHVuZGVmaW5lZCxcblx0XCJoZWFkZXJXb3JkV3JhcFwiOiBmYWxzZSxcblx0XCJlZGl0YWJsZVRpdGxlXCI6IHVuZGVmaW5lZCxcbn07XG5cbmNsYXNzIENvbHVtbiBleHRlbmRzIENvcmVGZWF0dXJle1xuXHRcblx0c3RhdGljIGRlZmF1bHRPcHRpb25MaXN0ID0gZGVmYXVsdENvbHVtbk9wdGlvbnM7XG5cdFxuXHRjb25zdHJ1Y3RvcihkZWYsIHBhcmVudCwgcm93SGVhZGVyKXtcblx0XHRzdXBlcihwYXJlbnQudGFibGUpO1xuXHRcdFxuXHRcdHRoaXMuZGVmaW5pdGlvbiA9IGRlZjsgLy9jb2x1bW4gZGVmaW5pdGlvblxuXHRcdHRoaXMucGFyZW50ID0gcGFyZW50OyAvL2hvbGQgcGFyZW50IG9iamVjdFxuXHRcdHRoaXMudHlwZSA9IFwiY29sdW1uXCI7IC8vdHlwZSBvZiBlbGVtZW50XG5cdFx0dGhpcy5jb2x1bW5zID0gW107IC8vY2hpbGQgY29sdW1uc1xuXHRcdHRoaXMuY2VsbHMgPSBbXTsgLy9jZWxscyBib3VuZCB0byB0aGlzIGNvbHVtblxuXHRcdHRoaXMuaXNHcm91cCA9IGZhbHNlO1xuXHRcdHRoaXMuaXNSb3dIZWFkZXIgPSByb3dIZWFkZXI7XG5cdFx0dGhpcy5lbGVtZW50ID0gdGhpcy5jcmVhdGVFbGVtZW50KCk7IC8vY29sdW1uIGhlYWRlciBlbGVtZW50XG5cdFx0dGhpcy5jb250ZW50RWxlbWVudCA9IGZhbHNlO1xuXHRcdHRoaXMudGl0bGVIb2xkZXJFbGVtZW50ID0gZmFsc2U7XG5cdFx0dGhpcy50aXRsZUVsZW1lbnQgPSBmYWxzZTtcblx0XHR0aGlzLmdyb3VwRWxlbWVudCA9IHRoaXMuY3JlYXRlR3JvdXBFbGVtZW50KCk7IC8vY29sdW1uIGdyb3VwIGhvbGRlciBlbGVtZW50XG5cdFx0dGhpcy5ob3pBbGlnbiA9IFwiXCI7IC8vaG9yaXpvbnRhbCB0ZXh0IGFsaWdubWVudFxuXHRcdHRoaXMudmVydEFsaWduID0gXCJcIjsgLy92ZXJ0IHRleHQgYWxpZ25tZW50XG5cdFx0XG5cdFx0Ly9tdWx0aSBkaW1lbnNpb25hbCBmaWxlZCBoYW5kbGluZ1xuXHRcdHRoaXMuZmllbGQgPVwiXCI7XG5cdFx0dGhpcy5maWVsZFN0cnVjdHVyZSA9IFwiXCI7XG5cdFx0dGhpcy5nZXRGaWVsZFZhbHVlID0gXCJcIjtcblx0XHR0aGlzLnNldEZpZWxkVmFsdWUgPSBcIlwiO1xuXHRcdFxuXHRcdHRoaXMudGl0bGVEb3dubG9hZCA9IG51bGw7XG5cdFx0dGhpcy50aXRsZUZvcm1hdHRlclJlbmRlcmVkID0gZmFsc2U7XG5cdFx0XG5cdFx0dGhpcy5tYXBEZWZpbml0aW9ucygpO1xuXHRcdFxuXHRcdHRoaXMuc2V0RmllbGQodGhpcy5kZWZpbml0aW9uLmZpZWxkKTtcblx0XHRcblx0XHR0aGlzLm1vZHVsZXMgPSB7fTsgLy9ob2xkIG1vZHVsZSB2YXJpYWJsZXM7XG5cdFx0XG5cdFx0dGhpcy53aWR0aCA9IG51bGw7IC8vY29sdW1uIHdpZHRoXG5cdFx0dGhpcy53aWR0aFN0eWxlZCA9IFwiXCI7IC8vY29sdW1uIHdpZHRoIHByZS1zdHlsZWQgdG8gaW1wcm92ZSByZW5kZXIgZWZmaWNpZW5jeVxuXHRcdHRoaXMubWF4V2lkdGggPSBudWxsOyAvL2NvbHVtbiBtYXhpbXVtIHdpZHRoXG5cdFx0dGhpcy5tYXhXaWR0aFN0eWxlZCA9IFwiXCI7IC8vY29sdW1uIG1heGltdW0gcHJlLXN0eWxlZCB0byBpbXByb3ZlIHJlbmRlciBlZmZpY2llbmN5XG5cdFx0dGhpcy5tYXhJbml0aWFsV2lkdGggPSBudWxsO1xuXHRcdHRoaXMubWluV2lkdGggPSBudWxsOyAvL2NvbHVtbiBtaW5pbXVtIHdpZHRoXG5cdFx0dGhpcy5taW5XaWR0aFN0eWxlZCA9IFwiXCI7IC8vY29sdW1uIG1pbmltdW0gcHJlLXN0eWxlZCB0byBpbXByb3ZlIHJlbmRlciBlZmZpY2llbmN5XG5cdFx0dGhpcy53aWR0aEZpeGVkID0gZmFsc2U7IC8vdXNlciBoYXMgc3BlY2lmaWVkIGEgd2lkdGggZm9yIHRoaXMgY29sdW1uXG5cdFx0XG5cdFx0dGhpcy52aXNpYmxlID0gdHJ1ZTsgLy9kZWZhdWx0IHZpc2libGUgc3RhdGVcblx0XHRcblx0XHR0aGlzLmNvbXBvbmVudCA9IG51bGw7XG5cdFx0XG5cdFx0Ly9pbml0aWFsaXplIGNvbHVtblxuXHRcdGlmKHRoaXMuZGVmaW5pdGlvbi5jb2x1bW5zKXtcblx0XHRcdFxuXHRcdFx0dGhpcy5pc0dyb3VwID0gdHJ1ZTtcblx0XHRcdFxuXHRcdFx0dGhpcy5kZWZpbml0aW9uLmNvbHVtbnMuZm9yRWFjaCgoZGVmLCBpKSA9PiB7XG5cdFx0XHRcdHZhciBuZXdDb2wgPSBuZXcgQ29sdW1uKGRlZiwgdGhpcyk7XG5cdFx0XHRcdHRoaXMuYXR0YWNoQ29sdW1uKG5ld0NvbCk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5jaGVja0NvbHVtblZpc2liaWxpdHkoKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRwYXJlbnQucmVnaXN0ZXJDb2x1bW5GaWVsZCh0aGlzKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5faW5pdGlhbGl6ZSgpO1xuXHR9XG5cdFxuXHRjcmVhdGVFbGVtZW50ICgpe1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1jb2xcIik7XG5cdFx0ZWwuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcImNvbHVtbmhlYWRlclwiKTtcblx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIiwgXCJub25lXCIpO1xuXG5cdFx0aWYodGhpcy5pc1Jvd0hlYWRlcil7XG5cdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJvdy1oZWFkZXJcIik7XG5cdFx0fVxuXHRcdFxuXHRcdHN3aXRjaCh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uSGVhZGVyVmVydEFsaWduKXtcblx0XHRcdGNhc2UgXCJtaWRkbGVcIjpcblx0XHRcdFx0ZWwuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImNlbnRlclwiO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgXCJib3R0b21cIjpcblx0XHRcdFx0ZWwuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImZsZXgtZW5kXCI7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gZWw7XG5cdH1cblx0XG5cdGNyZWF0ZUdyb3VwRWxlbWVudCAoKXtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY29sLWdyb3VwLWNvbHNcIik7XG5cdFx0XG5cdFx0cmV0dXJuIGVsO1xuXHR9XG5cdFxuXHRtYXBEZWZpbml0aW9ucygpe1xuXHRcdHZhciBkZWZhdWx0cyA9IHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5EZWZhdWx0cztcblx0XHRcblx0XHQvL21hcCBjb2x1bW5EZWZhdWx0cyBvbnRvIGNvbHVtbiBkZWZpbml0aW9uc1xuXHRcdGlmKGRlZmF1bHRzKXtcblx0XHRcdGZvcihsZXQga2V5IGluIGRlZmF1bHRzKXtcblx0XHRcdFx0aWYodHlwZW9mIHRoaXMuZGVmaW5pdGlvbltrZXldID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHR0aGlzLmRlZmluaXRpb25ba2V5XSA9IGRlZmF1bHRzW2tleV07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5kZWZpbml0aW9uID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLm9wdGlvbnNMaXN0LmdlbmVyYXRlKENvbHVtbi5kZWZhdWx0T3B0aW9uTGlzdCwgdGhpcy5kZWZpbml0aW9uKTtcblx0fVxuXHRcblx0Y2hlY2tEZWZpbml0aW9uKCl7XG5cdFx0T2JqZWN0LmtleXModGhpcy5kZWZpbml0aW9uKS5mb3JFYWNoKChrZXkpID0+IHtcblx0XHRcdGlmKENvbHVtbi5kZWZhdWx0T3B0aW9uTGlzdC5pbmRleE9mKGtleSkgPT09IC0xKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiSW52YWxpZCBjb2x1bW4gZGVmaW5pdGlvbiBvcHRpb24gaW4gJ1wiICsgKHRoaXMuZmllbGQgfHwgdGhpcy5kZWZpbml0aW9uLnRpdGxlKSArIFwiJyBjb2x1bW46XCIsIGtleSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHRzZXRGaWVsZChmaWVsZCl7XG5cdFx0dGhpcy5maWVsZCA9IGZpZWxkO1xuXHRcdHRoaXMuZmllbGRTdHJ1Y3R1cmUgPSBmaWVsZCA/ICh0aGlzLnRhYmxlLm9wdGlvbnMubmVzdGVkRmllbGRTZXBhcmF0b3IgPyBmaWVsZC5zcGxpdCh0aGlzLnRhYmxlLm9wdGlvbnMubmVzdGVkRmllbGRTZXBhcmF0b3IpIDogW2ZpZWxkXSkgOiBbXTtcblx0XHR0aGlzLmdldEZpZWxkVmFsdWUgPSB0aGlzLmZpZWxkU3RydWN0dXJlLmxlbmd0aCA+IDEgPyB0aGlzLl9nZXROZXN0ZWREYXRhIDogdGhpcy5fZ2V0RmxhdERhdGE7XG5cdFx0dGhpcy5zZXRGaWVsZFZhbHVlID0gdGhpcy5maWVsZFN0cnVjdHVyZS5sZW5ndGggPiAxID8gdGhpcy5fc2V0TmVzdGVkRGF0YSA6IHRoaXMuX3NldEZsYXREYXRhO1xuXHR9XG5cdFxuXHQvL3JlZ2lzdGVyIGNvbHVtbiBwb3NpdGlvbiB3aXRoIGNvbHVtbiBtYW5hZ2VyXG5cdHJlZ2lzdGVyQ29sdW1uUG9zaXRpb24oY29sdW1uKXtcblx0XHR0aGlzLnBhcmVudC5yZWdpc3RlckNvbHVtblBvc2l0aW9uKGNvbHVtbik7XG5cdH1cblx0XG5cdC8vcmVnaXN0ZXIgY29sdW1uIHBvc2l0aW9uIHdpdGggY29sdW1uIG1hbmFnZXJcblx0cmVnaXN0ZXJDb2x1bW5GaWVsZChjb2x1bW4pe1xuXHRcdHRoaXMucGFyZW50LnJlZ2lzdGVyQ29sdW1uRmllbGQoY29sdW1uKTtcblx0fVxuXHRcblx0Ly90cmlnZ2VyIHBvc2l0aW9uIHJlZ2lzdHJhdGlvblxuXHRyZVJlZ2lzdGVyUG9zaXRpb24oKXtcblx0XHRpZih0aGlzLmlzR3JvdXApe1xuXHRcdFx0dGhpcy5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdFx0Y29sdW1uLnJlUmVnaXN0ZXJQb3NpdGlvbigpO1xuXHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5yZWdpc3RlckNvbHVtblBvc2l0aW9uKHRoaXMpO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9idWlsZCBoZWFkZXIgZWxlbWVudFxuXHRfaW5pdGlhbGl6ZSgpe1xuXHRcdHZhciBkZWYgPSB0aGlzLmRlZmluaXRpb247XG5cdFx0XG5cdFx0d2hpbGUodGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpIHRoaXMuZWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XG5cdFx0aWYoZGVmLmhlYWRlclZlcnRpY2FsKXtcblx0XHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC12ZXJ0aWNhbFwiKTtcblx0XHRcdFxuXHRcdFx0aWYoZGVmLmhlYWRlclZlcnRpY2FsID09PSBcImZsaXBcIil7XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC12ZXJ0aWNhbC1mbGlwXCIpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHR0aGlzLmNvbnRlbnRFbGVtZW50ID0gdGhpcy5fYnVpbGRDb2x1bW5IZWFkZXJDb250ZW50KCk7XG5cdFx0XG5cdFx0dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY29udGVudEVsZW1lbnQpO1xuXHRcdFxuXHRcdGlmKHRoaXMuaXNHcm91cCl7XG5cdFx0XHR0aGlzLl9idWlsZEdyb3VwSGVhZGVyKCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5fYnVpbGRDb2x1bW5IZWFkZXIoKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaChcImNvbHVtbi1pbml0XCIsIHRoaXMpO1xuXHR9XG5cdFxuXHQvL2J1aWxkIGhlYWRlciBlbGVtZW50IGZvciBoZWFkZXJcblx0X2J1aWxkQ29sdW1uSGVhZGVyKCl7XG5cdFx0dmFyIGRlZiA9IHRoaXMuZGVmaW5pdGlvbjtcblx0XHRcblx0XHR0aGlzLmRpc3BhdGNoKFwiY29sdW1uLWxheW91dFwiLCB0aGlzKTtcblx0XHRcblx0XHQvL3NldCBjb2x1bW4gdmlzaWJpbGl0eVxuXHRcdGlmKHR5cGVvZiBkZWYudmlzaWJsZSAhPSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdGlmKGRlZi52aXNpYmxlKXtcblx0XHRcdFx0dGhpcy5zaG93KHRydWUpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmhpZGUodHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdC8vYXNzaWduIGFkZGl0aW9uYWwgY3NzIGNsYXNzZXMgdG8gY29sdW1uIGhlYWRlclxuXHRcdGlmKGRlZi5jc3NDbGFzcyl7XG5cdFx0XHR2YXIgY2xhc3NOYW1lcyA9IGRlZi5jc3NDbGFzcy5zcGxpdChcIiBcIik7XG5cdFx0XHRjbGFzc05hbWVzLmZvckVhY2goKGNsYXNzTmFtZSkgPT4ge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGRlZi5maWVsZCl7XG5cdFx0XHR0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGFidWxhdG9yLWZpZWxkXCIsIGRlZi5maWVsZCk7XG5cdFx0fVxuXHRcdFxuXHRcdC8vc2V0IG1pbiB3aWR0aCBpZiBwcmVzZW50XG5cdFx0dGhpcy5zZXRNaW5XaWR0aChwYXJzZUludChkZWYubWluV2lkdGgpKTtcblx0XHRcblx0XHRpZiAoZGVmLm1heEluaXRpYWxXaWR0aCkge1xuXHRcdFx0dGhpcy5tYXhJbml0aWFsV2lkdGggPSBwYXJzZUludChkZWYubWF4SW5pdGlhbFdpZHRoKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoZGVmLm1heFdpZHRoKXtcblx0XHRcdHRoaXMuc2V0TWF4V2lkdGgocGFyc2VJbnQoZGVmLm1heFdpZHRoKSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHRcblx0XHQvL3NldCBob3Jpem9udGFsIHRleHQgYWxpZ25tZW50XG5cdFx0dGhpcy5ob3pBbGlnbiA9IHRoaXMuZGVmaW5pdGlvbi5ob3pBbGlnbjtcblx0XHR0aGlzLnZlcnRBbGlnbiA9IHRoaXMuZGVmaW5pdGlvbi52ZXJ0QWxpZ247XG5cdFx0XG5cdFx0dGhpcy50aXRsZUVsZW1lbnQuc3R5bGUudGV4dEFsaWduID0gdGhpcy5kZWZpbml0aW9uLmhlYWRlckhvekFsaWduO1xuXHR9XG5cdFxuXHRfYnVpbGRDb2x1bW5IZWFkZXJDb250ZW50KCl7XG5cdFx0dmFyIGNvbnRlbnRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRjb250ZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC1jb250ZW50XCIpO1xuXHRcdFxuXHRcdHRoaXMudGl0bGVIb2xkZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLnRpdGxlSG9sZGVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC10aXRsZS1ob2xkZXJcIik7XG5cdFx0XG5cdFx0Y29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50aXRsZUhvbGRlckVsZW1lbnQpO1xuXHRcdFxuXHRcdHRoaXMudGl0bGVFbGVtZW50ID0gdGhpcy5fYnVpbGRDb2x1bW5IZWFkZXJUaXRsZSgpO1xuXHRcdFxuXHRcdHRoaXMudGl0bGVIb2xkZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMudGl0bGVFbGVtZW50KTtcblx0XHRcblx0XHRyZXR1cm4gY29udGVudEVsZW1lbnQ7XG5cdH1cblx0XG5cdC8vYnVpbGQgdGl0bGUgZWxlbWVudCBvZiBjb2x1bW5cblx0X2J1aWxkQ29sdW1uSGVhZGVyVGl0bGUoKXtcblx0XHR2YXIgZGVmID0gdGhpcy5kZWZpbml0aW9uO1xuXHRcdFxuXHRcdHZhciB0aXRsZUhvbGRlckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdHRpdGxlSG9sZGVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC10aXRsZVwiKTtcblx0XHRcblx0XHRpZihkZWYuaGVhZGVyV29yZFdyYXApe1xuXHRcdFx0dGl0bGVIb2xkZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY29sLXRpdGxlLXdyYXBcIik7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGRlZi5lZGl0YWJsZVRpdGxlKXtcblx0XHRcdHZhciB0aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG5cdFx0XHR0aXRsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci10aXRsZS1lZGl0b3JcIik7XG5cdFx0XHRcblx0XHRcdHRpdGxlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0dGl0bGVFbGVtZW50LmZvY3VzKCk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGl0bGVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aXRsZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoKSA9PiB7XG5cdFx0XHRcdGRlZi50aXRsZSA9IHRpdGxlRWxlbWVudC52YWx1ZTtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiY29sdW1uVGl0bGVDaGFuZ2VkXCIsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRpdGxlSG9sZGVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aXRsZUVsZW1lbnQpO1xuXHRcdFx0XG5cdFx0XHRpZihkZWYuZmllbGQpe1xuXHRcdFx0XHR0aGlzLmxhbmdCaW5kKFwiY29sdW1uc3xcIiArIGRlZi5maWVsZCwgKHRleHQpID0+IHtcblx0XHRcdFx0XHR0aXRsZUVsZW1lbnQudmFsdWUgPSB0ZXh0IHx8IChkZWYudGl0bGUgfHwgXCImbmJzcDtcIik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aXRsZUVsZW1lbnQudmFsdWUgID0gZGVmLnRpdGxlIHx8IFwiJm5ic3A7XCI7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHR9ZWxzZSB7XG5cdFx0XHRpZihkZWYuZmllbGQpe1xuXHRcdFx0XHR0aGlzLmxhbmdCaW5kKFwiY29sdW1uc3xcIiArIGRlZi5maWVsZCwgKHRleHQpID0+IHtcblx0XHRcdFx0XHR0aGlzLl9mb3JtYXRDb2x1bW5IZWFkZXJUaXRsZSh0aXRsZUhvbGRlckVsZW1lbnQsIHRleHQgfHwgKGRlZi50aXRsZSB8fCBcIiZuYnNwO1wiKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLl9mb3JtYXRDb2x1bW5IZWFkZXJUaXRsZSh0aXRsZUhvbGRlckVsZW1lbnQsIGRlZi50aXRsZSB8fCBcIiZuYnNwO1wiKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHRpdGxlSG9sZGVyRWxlbWVudDtcblx0fVxuXHRcblx0X2Zvcm1hdENvbHVtbkhlYWRlclRpdGxlKGVsLCB0aXRsZSl7XG5cdFx0dmFyIGNvbnRlbnRzID0gdGhpcy5jaGFpbihcImNvbHVtbi1mb3JtYXRcIiwgW3RoaXMsIHRpdGxlLCBlbF0sIG51bGwsICgpID0+IHtcblx0XHRcdHJldHVybiB0aXRsZTtcblx0XHR9KTtcblx0XHRcblx0XHRzd2l0Y2godHlwZW9mIGNvbnRlbnRzKXtcblx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0aWYoY29udGVudHMgaW5zdGFuY2VvZiBOb2RlKXtcblx0XHRcdFx0XHRlbC5hcHBlbmRDaGlsZChjb250ZW50cyk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRlbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkZvcm1hdCBFcnJvciAtIFRpdGxlIGZvcm1hdHRlciBoYXMgcmV0dXJuZWQgYSB0eXBlIG9mIG9iamVjdCwgdGhlIG9ubHkgdmFsaWQgZm9ybWF0dGVyIG9iamVjdCByZXR1cm4gaXMgYW4gaW5zdGFuY2Ugb2YgTm9kZSwgdGhlIGZvcm1hdHRlciByZXR1cm5lZDpcIiwgY29udGVudHMpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXHRcdFx0XHRlbC5pbm5lckhUTUwgPSBcIlwiO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGVsLmlubmVySFRNTCA9IGNvbnRlbnRzO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9idWlsZCBoZWFkZXIgZWxlbWVudCBmb3IgY29sdW1uIGdyb3VwXG5cdF9idWlsZEdyb3VwSGVhZGVyKCl7XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY29sLWdyb3VwXCIpO1xuXHRcdHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiY29sdW1uZ3JvdXBcIik7XG5cdFx0dGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtdGl0bGVcIiwgdGhpcy5kZWZpbml0aW9uLnRpdGxlKTtcblx0XHRcblx0XHQvL2FzaWduIGFkZGl0aW9uYWwgY3NzIGNsYXNzZXMgdG8gY29sdW1uIGhlYWRlclxuXHRcdGlmKHRoaXMuZGVmaW5pdGlvbi5jc3NDbGFzcyl7XG5cdFx0XHR2YXIgY2xhc3NOYW1lcyA9IHRoaXMuZGVmaW5pdGlvbi5jc3NDbGFzcy5zcGxpdChcIiBcIik7XG5cdFx0XHRjbGFzc05hbWVzLmZvckVhY2goKGNsYXNzTmFtZSkgPT4ge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMudGl0bGVFbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9IHRoaXMuZGVmaW5pdGlvbi5oZWFkZXJIb3pBbGlnbjtcblx0XHRcblx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5ncm91cEVsZW1lbnQpO1xuXHR9XG5cdFxuXHQvL2ZsYXQgZmllbGQgbG9va3VwXG5cdF9nZXRGbGF0RGF0YShkYXRhKXtcblx0XHRyZXR1cm4gZGF0YVt0aGlzLmZpZWxkXTtcblx0fVxuXHRcblx0Ly9uZXN0ZWQgZmllbGQgbG9va3VwXG5cdF9nZXROZXN0ZWREYXRhKGRhdGEpe1xuXHRcdHZhciBkYXRhT2JqID0gZGF0YSxcblx0XHRzdHJ1Y3R1cmUgPSB0aGlzLmZpZWxkU3RydWN0dXJlLFxuXHRcdGxlbmd0aCA9IHN0cnVjdHVyZS5sZW5ndGgsXG5cdFx0b3V0cHV0O1xuXHRcdFxuXHRcdGZvcihsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKyl7XG5cdFx0XHRcblx0XHRcdGRhdGFPYmogPSBkYXRhT2JqW3N0cnVjdHVyZVtpXV07XG5cdFx0XHRcblx0XHRcdG91dHB1dCA9IGRhdGFPYmo7XG5cdFx0XHRcblx0XHRcdGlmKCFkYXRhT2JqKXtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH1cblx0XG5cdC8vZmxhdCBmaWVsZCBzZXRcblx0X3NldEZsYXREYXRhKGRhdGEsIHZhbHVlKXtcblx0XHRpZih0aGlzLmZpZWxkKXtcblx0XHRcdGRhdGFbdGhpcy5maWVsZF0gPSB2YWx1ZTtcblx0XHR9XG5cdH1cblx0XG5cdC8vbmVzdGVkIGZpZWxkIHNldFxuXHRfc2V0TmVzdGVkRGF0YShkYXRhLCB2YWx1ZSl7XG5cdFx0dmFyIGRhdGFPYmogPSBkYXRhLFxuXHRcdHN0cnVjdHVyZSA9IHRoaXMuZmllbGRTdHJ1Y3R1cmUsXG5cdFx0bGVuZ3RoID0gc3RydWN0dXJlLmxlbmd0aDtcblx0XHRcblx0XHRmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspe1xuXHRcdFx0XG5cdFx0XHRpZihpID09IGxlbmd0aCAtMSl7XG5cdFx0XHRcdGRhdGFPYmpbc3RydWN0dXJlW2ldXSA9IHZhbHVlO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZighZGF0YU9ialtzdHJ1Y3R1cmVbaV1dKXtcblx0XHRcdFx0XHRpZih0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0XHRcdFx0ZGF0YU9ialtzdHJ1Y3R1cmVbaV1dID0ge307XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRkYXRhT2JqID0gZGF0YU9ialtzdHJ1Y3R1cmVbaV1dO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Ly9hdHRhY2ggY29sdW1uIHRvIHRoaXMgZ3JvdXBcblx0YXR0YWNoQ29sdW1uKGNvbHVtbil7XG5cdFx0aWYodGhpcy5ncm91cEVsZW1lbnQpe1xuXHRcdFx0dGhpcy5jb2x1bW5zLnB1c2goY29sdW1uKTtcblx0XHRcdHRoaXMuZ3JvdXBFbGVtZW50LmFwcGVuZENoaWxkKGNvbHVtbi5nZXRFbGVtZW50KCkpO1xuXHRcdFx0XG5cdFx0XHRjb2x1bW4uY29sdW1uUmVuZGVyZWQoKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gV2FybmluZyAtIENvbHVtbiBiZWluZyBhdHRhY2hlZCB0byBhbm90aGVyIGNvbHVtbiBpbnN0ZWFkIG9mIGNvbHVtbiBncm91cFwiKTtcblx0XHR9XG5cdH1cblx0XG5cdC8vdmVydGljYWxseSBhbGlnbiBoZWFkZXIgaW4gY29sdW1uXG5cdHZlcnRpY2FsQWxpZ24oYWxpZ25tZW50LCBoZWlnaHQpe1xuXHRcdFxuXHRcdC8vY2FsY3VsYXRlIGhlaWdodCBvZiBjb2x1bW4gaGVhZGVyIGFuZCBncm91cCBob2xkZXIgZWxlbWVudFxuXHRcdHZhciBwYXJlbnRIZWlnaHQgPSB0aGlzLnBhcmVudC5pc0dyb3VwID8gdGhpcy5wYXJlbnQuZ2V0R3JvdXBFbGVtZW50KCkuY2xpZW50SGVpZ2h0IDogKGhlaWdodCB8fCB0aGlzLnBhcmVudC5nZXRIZWFkZXJzRWxlbWVudCgpLmNsaWVudEhlaWdodCk7XG5cdFx0Ly8gdmFyIHBhcmVudEhlaWdodCA9IHRoaXMucGFyZW50LmlzR3JvdXAgPyB0aGlzLnBhcmVudC5nZXRHcm91cEVsZW1lbnQoKS5jbGllbnRIZWlnaHQgOiB0aGlzLnBhcmVudC5nZXRIZWFkZXJzRWxlbWVudCgpLmNsaWVudEhlaWdodDtcblx0XHRcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gcGFyZW50SGVpZ2h0ICsgXCJweFwiO1xuXHRcdFxuXHRcdHRoaXMuZGlzcGF0Y2goXCJjb2x1bW4taGVpZ2h0XCIsIHRoaXMsIHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQpO1xuXHRcdFxuXHRcdGlmKHRoaXMuaXNHcm91cCl7XG5cdFx0XHR0aGlzLmdyb3VwRWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSAocGFyZW50SGVpZ2h0IC0gdGhpcy5jb250ZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpICsgXCJweFwiO1xuXHRcdH1cblx0XHRcblx0XHQvL3ZlcnRpY2FsbHkgYWxpZ24gY2VsbCBjb250ZW50c1xuXHRcdC8vIGlmKCF0aGlzLmlzR3JvdXAgJiYgYWxpZ25tZW50ICE9PSBcInRvcFwiKXtcblx0XHQvLyBcdGlmKGFsaWdubWVudCA9PT0gXCJib3R0b21cIil7XG5cdFx0Ly8gXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5wYWRkaW5nVG9wID0gKHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQgLSB0aGlzLmNvbnRlbnRFbGVtZW50Lm9mZnNldEhlaWdodCkgKyBcInB4XCI7XG5cdFx0Ly8gXHR9ZWxzZXtcblx0XHQvLyBcdFx0dGhpcy5lbGVtZW50LnN0eWxlLnBhZGRpbmdUb3AgPSAoKHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQgLSB0aGlzLmNvbnRlbnRFbGVtZW50Lm9mZnNldEhlaWdodCkgLyAyKSArIFwicHhcIjtcblx0XHQvLyBcdH1cblx0XHQvLyB9XG5cdFx0XG5cdFx0dGhpcy5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdGNvbHVtbi52ZXJ0aWNhbEFsaWduKGFsaWdubWVudCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdC8vY2xlYXIgdmVydGljYWwgYWxpZ25tZW50XG5cdGNsZWFyVmVydGljYWxBbGlnbigpe1xuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5wYWRkaW5nVG9wID0gXCJcIjtcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gXCJcIjtcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gXCJcIjtcblx0XHR0aGlzLmdyb3VwRWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBcIlwiO1xuXHRcdFxuXHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0XHRjb2x1bW4uY2xlYXJWZXJ0aWNhbEFsaWduKCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaChcImNvbHVtbi1oZWlnaHRcIiwgdGhpcywgXCJcIik7XG5cdH1cblx0XG5cdC8vLy8gUmV0cmlldmUgQ29sdW1uIEluZm9ybWF0aW9uIC8vLy9cblx0Ly9yZXR1cm4gY29sdW1uIGhlYWRlciBlbGVtZW50XG5cdGdldEVsZW1lbnQoKXtcblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9XG5cdFxuXHQvL3JldHVybiBjb2x1bW4gZ3JvdXAgZWxlbWVudFxuXHRnZXRHcm91cEVsZW1lbnQoKXtcblx0XHRyZXR1cm4gdGhpcy5ncm91cEVsZW1lbnQ7XG5cdH1cblx0XG5cdC8vcmV0dXJuIGZpZWxkIG5hbWVcblx0Z2V0RmllbGQoKXtcblx0XHRyZXR1cm4gdGhpcy5maWVsZDtcblx0fVxuXHRcblx0Z2V0VGl0bGVEb3dubG9hZCgpIHtcblx0XHRyZXR1cm4gdGhpcy50aXRsZURvd25sb2FkO1xuXHR9XG5cdFxuXHQvL3JldHVybiB0aGUgZmlyc3QgY29sdW1uIGluIGEgZ3JvdXBcblx0Z2V0Rmlyc3RDb2x1bW4oKXtcblx0XHRpZighdGhpcy5pc0dyb3VwKXtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHRoaXMuY29sdW1ucy5sZW5ndGgpe1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zWzBdLmdldEZpcnN0Q29sdW1uKCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdC8vcmV0dXJuIHRoZSBsYXN0IGNvbHVtbiBpbiBhIGdyb3VwXG5cdGdldExhc3RDb2x1bW4oKXtcblx0XHRpZighdGhpcy5pc0dyb3VwKXtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHRoaXMuY29sdW1ucy5sZW5ndGgpe1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zW3RoaXMuY29sdW1ucy5sZW5ndGggLTFdLmdldExhc3RDb2x1bW4oKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Ly9yZXR1cm4gYWxsIGNvbHVtbnMgaW4gYSBncm91cFxuXHRnZXRDb2x1bW5zKHRyYXZlcnNlKXtcblx0XHR2YXIgY29sdW1ucyA9IFtdO1xuXHRcdFxuXHRcdGlmKHRyYXZlcnNlKXtcblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdFx0Y29sdW1ucy5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdFxuXHRcdFx0XHRjb2x1bW5zID0gY29sdW1ucy5jb25jYXQoY29sdW1uLmdldENvbHVtbnModHJ1ZSkpO1xuXHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29sdW1ucyA9IHRoaXMuY29sdW1ucztcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGNvbHVtbnM7XG5cdH1cblx0XG5cdC8vcmV0dXJuIGFsbCBjb2x1bW5zIGluIGEgZ3JvdXBcblx0Z2V0Q2VsbHMoKXtcblx0XHRyZXR1cm4gdGhpcy5jZWxscztcblx0fVxuXHRcblx0Ly9yZXRyaWV2ZSB0aGUgdG9wIGNvbHVtbiBpbiBhIGdyb3VwIG9mIGNvbHVtbnNcblx0Z2V0VG9wQ29sdW1uKCl7XG5cdFx0aWYodGhpcy5wYXJlbnQuaXNHcm91cCl7XG5cdFx0XHRyZXR1cm4gdGhpcy5wYXJlbnQuZ2V0VG9wQ29sdW1uKCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3JldHVybiBjb2x1bW4gZGVmaW5pdGlvbiBvYmplY3Rcblx0Z2V0RGVmaW5pdGlvbih1cGRhdGVCcmFuY2hlcyl7XG5cdFx0dmFyIGNvbERlZnMgPSBbXTtcblx0XHRcblx0XHRpZih0aGlzLmlzR3JvdXAgJiYgdXBkYXRlQnJhbmNoZXMpe1xuXHRcdFx0dGhpcy5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdFx0Y29sRGVmcy5wdXNoKGNvbHVtbi5nZXREZWZpbml0aW9uKHRydWUpKTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmRlZmluaXRpb24uY29sdW1ucyA9IGNvbERlZnM7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiB0aGlzLmRlZmluaXRpb247XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vIEFjdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Y2hlY2tDb2x1bW5WaXNpYmlsaXR5KCl7XG5cdFx0dmFyIHZpc2libGUgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pe1xuXHRcdFx0aWYoY29sdW1uLnZpc2libGUpe1xuXHRcdFx0XHR2aXNpYmxlID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRpZih2aXNpYmxlKXtcblx0XHRcdHRoaXMuc2hvdygpO1xuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiY29sdW1uVmlzaWJpbGl0eUNoYW5nZWRcIiwgdGhpcy5nZXRDb21wb25lbnQoKSwgZmFsc2UpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuaGlkZSgpO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9zaG93IGNvbHVtblxuXHRzaG93KHNpbGVudCwgcmVzcG9uc2l2ZVRvZ2dsZSl7XG5cdFx0aWYoIXRoaXMudmlzaWJsZSl7XG5cdFx0XHR0aGlzLnZpc2libGUgPSB0cnVlO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMucGFyZW50LmlzR3JvdXApe1xuXHRcdFx0XHR0aGlzLnBhcmVudC5jaGVja0NvbHVtblZpc2liaWxpdHkoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uKGNlbGwpe1xuXHRcdFx0XHRjZWxsLnNob3coKTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRpZighdGhpcy5pc0dyb3VwICYmIHRoaXMud2lkdGggPT09IG51bGwpe1xuXHRcdFx0XHR0aGlzLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci52ZXJ0aWNhbEFsaWduSGVhZGVycygpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwiY29sdW1uLXNob3dcIiwgdGhpcywgcmVzcG9uc2l2ZVRvZ2dsZSk7XG5cdFx0XHRcblx0XHRcdGlmKCFzaWxlbnQpe1xuXHRcdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJjb2x1bW5WaXNpYmlsaXR5Q2hhbmdlZFwiLCB0aGlzLmdldENvbXBvbmVudCgpLCB0cnVlKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYodGhpcy5wYXJlbnQuaXNHcm91cCl7XG5cdFx0XHRcdHRoaXMucGFyZW50Lm1hdGNoQ2hpbGRXaWR0aHMoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoIXRoaXMuc2lsZW50KXtcblx0XHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLnJlcmVuZGVyQ29sdW1ucygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Ly9oaWRlIGNvbHVtblxuXHRoaWRlKHNpbGVudCwgcmVzcG9uc2l2ZVRvZ2dsZSl7XG5cdFx0aWYodGhpcy52aXNpYmxlKXtcblx0XHRcdHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIudmVydGljYWxBbGlnbkhlYWRlcnMoKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5wYXJlbnQuaXNHcm91cCl7XG5cdFx0XHRcdHRoaXMucGFyZW50LmNoZWNrQ29sdW1uVmlzaWJpbGl0eSgpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oY2VsbCl7XG5cdFx0XHRcdGNlbGwuaGlkZSgpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJjb2x1bW4taGlkZVwiLCB0aGlzLCByZXNwb25zaXZlVG9nZ2xlKTtcblx0XHRcdFxuXHRcdFx0aWYoIXNpbGVudCl7XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImNvbHVtblZpc2liaWxpdHlDaGFuZ2VkXCIsIHRoaXMuZ2V0Q29tcG9uZW50KCksIGZhbHNlKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYodGhpcy5wYXJlbnQuaXNHcm91cCl7XG5cdFx0XHRcdHRoaXMucGFyZW50Lm1hdGNoQ2hpbGRXaWR0aHMoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoIXRoaXMuc2lsZW50KXtcblx0XHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLnJlcmVuZGVyQ29sdW1ucygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0bWF0Y2hDaGlsZFdpZHRocygpe1xuXHRcdHZhciBjaGlsZFdpZHRoID0gMDtcblx0XHRcblx0XHRpZih0aGlzLmNvbnRlbnRFbGVtZW50ICYmIHRoaXMuY29sdW1ucy5sZW5ndGgpe1xuXHRcdFx0dGhpcy5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdFx0aWYoY29sdW1uLnZpc2libGUpe1xuXHRcdFx0XHRcdGNoaWxkV2lkdGggKz0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmNvbnRlbnRFbGVtZW50LnN0eWxlLm1heFdpZHRoID0gKGNoaWxkV2lkdGggLSAxKSArIFwicHhcIjtcblx0XHRcdGlmICh0aGlzLnRhYmxlLmluaXRpYWxpemVkKSB7XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IGNoaWxkV2lkdGggKyBcInB4XCI7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMucGFyZW50LmlzR3JvdXApe1xuXHRcdFx0XHR0aGlzLnBhcmVudC5tYXRjaENoaWxkV2lkdGhzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRyZW1vdmVDaGlsZChjaGlsZCl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy5jb2x1bW5zLmluZGV4T2YoY2hpbGQpO1xuXHRcdFxuXHRcdGlmKGluZGV4ID4gLTEpe1xuXHRcdFx0dGhpcy5jb2x1bW5zLnNwbGljZShpbmRleCwgMSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCF0aGlzLmNvbHVtbnMubGVuZ3RoKXtcblx0XHRcdHRoaXMuZGVsZXRlKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRzZXRXaWR0aCh3aWR0aCl7XG5cdFx0dGhpcy53aWR0aEZpeGVkID0gdHJ1ZTtcblx0XHR0aGlzLnNldFdpZHRoQWN0dWFsKHdpZHRoKTtcblx0fVxuXHRcblx0c2V0V2lkdGhBY3R1YWwod2lkdGgpe1xuXHRcdGlmKGlzTmFOKHdpZHRoKSl7XG5cdFx0XHR3aWR0aCA9IE1hdGguZmxvb3IoKHRoaXMudGFibGUuZWxlbWVudC5jbGllbnRXaWR0aC8xMDApICogcGFyc2VJbnQod2lkdGgpKTtcblx0XHR9XG5cdFx0XG5cdFx0d2lkdGggPSBNYXRoLm1heCh0aGlzLm1pbldpZHRoLCB3aWR0aCk7XG5cdFx0XG5cdFx0aWYodGhpcy5tYXhXaWR0aCl7XG5cdFx0XHR3aWR0aCA9IE1hdGgubWluKHRoaXMubWF4V2lkdGgsIHdpZHRoKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy53aWR0aCA9IHdpZHRoO1xuXHRcdHRoaXMud2lkdGhTdHlsZWQgPSB3aWR0aCA/IHdpZHRoICsgXCJweFwiIDogXCJcIjtcblx0XHRcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLndpZHRoU3R5bGVkO1xuXHRcdFxuXHRcdGlmKCF0aGlzLmlzR3JvdXApe1xuXHRcdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uKGNlbGwpe1xuXHRcdFx0XHRjZWxsLnNldFdpZHRoKCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy5wYXJlbnQuaXNHcm91cCl7XG5cdFx0XHR0aGlzLnBhcmVudC5tYXRjaENoaWxkV2lkdGhzKCk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuZGlzcGF0Y2goXCJjb2x1bW4td2lkdGhcIiwgdGhpcyk7XG5cdFx0XG5cdFx0aWYodGhpcy5zdWJzY3JpYmVkRXh0ZXJuYWwoXCJjb2x1bW5XaWR0aFwiKSl7XG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJjb2x1bW5XaWR0aFwiLCB0aGlzLmdldENvbXBvbmVudCgpKTtcblx0XHR9XG5cdH1cblx0XG5cdGNoZWNrQ2VsbEhlaWdodHMoKXtcblx0XHR2YXIgcm93cyA9IFtdO1xuXHRcdFxuXHRcdHRoaXMuY2VsbHMuZm9yRWFjaChmdW5jdGlvbihjZWxsKXtcblx0XHRcdGlmKGNlbGwucm93LmhlaWdodEluaXRpYWxpemVkKXtcblx0XHRcdFx0aWYoY2VsbC5yb3cuZ2V0RWxlbWVudCgpLm9mZnNldFBhcmVudCAhPT0gbnVsbCl7XG5cdFx0XHRcdFx0cm93cy5wdXNoKGNlbGwucm93KTtcblx0XHRcdFx0XHRjZWxsLnJvdy5jbGVhckNlbGxIZWlnaHQoKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGNlbGwucm93LmhlaWdodEluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KXtcblx0XHRcdHJvdy5jYWxjSGVpZ2h0KCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHRyb3cuc2V0Q2VsbEhlaWdodCgpO1xuXHRcdH0pO1xuXHR9XG5cdFxuXHRnZXRXaWR0aCgpe1xuXHRcdHZhciB3aWR0aCA9IDA7XG5cdFx0XG5cdFx0aWYodGhpcy5pc0dyb3VwKXtcblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0XHRcdGlmKGNvbHVtbi52aXNpYmxlKXtcblx0XHRcdFx0XHR3aWR0aCArPSBjb2x1bW4uZ2V0V2lkdGgoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0d2lkdGggPSB0aGlzLndpZHRoO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gd2lkdGg7XG5cdH1cblx0XG5cdGdldExlZnRPZmZzZXQoKXtcblx0XHR2YXIgb2Zmc2V0ID0gdGhpcy5lbGVtZW50Lm9mZnNldExlZnQ7XG5cdFx0XG5cdFx0aWYodGhpcy5wYXJlbnQuaXNHcm91cCl7XG5cdFx0XHRvZmZzZXQgKz0gdGhpcy5wYXJlbnQuZ2V0TGVmdE9mZnNldCgpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gb2Zmc2V0O1xuXHR9XG5cdFxuXHRnZXRIZWlnaHQoKXtcblx0XHRyZXR1cm4gTWF0aC5jZWlsKHRoaXMuZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQpO1xuXHR9XG5cdFxuXHRzZXRNaW5XaWR0aChtaW5XaWR0aCl7XG5cdFx0aWYodGhpcy5tYXhXaWR0aCAmJiBtaW5XaWR0aCA+IHRoaXMubWF4V2lkdGgpe1xuXHRcdFx0bWluV2lkdGggPSB0aGlzLm1heFdpZHRoO1xuXHRcdFx0XG5cdFx0XHRjb25zb2xlLndhcm4oXCJ0aGUgbWluV2lkdGggKFwiKyBtaW5XaWR0aCArIFwicHgpIGZvciBjb2x1bW4gJ1wiICsgdGhpcy5maWVsZCArIFwiJyBjYW5ub3QgYmUgYmlnZ2VyIHRoYXQgaXRzIG1heFdpZHRoIChcIisgdGhpcy5tYXhXaWR0aFN0eWxlZCArIFwiKVwiKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5taW5XaWR0aCA9IG1pbldpZHRoO1xuXHRcdHRoaXMubWluV2lkdGhTdHlsZWQgPSBtaW5XaWR0aCA/IG1pbldpZHRoICsgXCJweFwiIDogXCJcIjtcblx0XHRcblx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubWluV2lkdGggPSB0aGlzLm1pbldpZHRoU3R5bGVkO1xuXHRcdFxuXHRcdHRoaXMuY2VsbHMuZm9yRWFjaChmdW5jdGlvbihjZWxsKXtcblx0XHRcdGNlbGwuc2V0TWluV2lkdGgoKTtcblx0XHR9KTtcblx0fVxuXHRcblx0c2V0TWF4V2lkdGgobWF4V2lkdGgpe1xuXHRcdGlmKHRoaXMubWluV2lkdGggJiYgbWF4V2lkdGggPCB0aGlzLm1pbldpZHRoKXtcblx0XHRcdG1heFdpZHRoID0gdGhpcy5taW5XaWR0aDtcblx0XHRcdFxuXHRcdFx0Y29uc29sZS53YXJuKFwidGhlIG1heFdpZHRoIChcIisgbWF4V2lkdGggKyBcInB4KSBmb3IgY29sdW1uICdcIiArIHRoaXMuZmllbGQgKyBcIicgY2Fubm90IGJlIHNtYWxsZXIgdGhhdCBpdHMgbWluV2lkdGggKFwiKyB0aGlzLm1pbldpZHRoU3R5bGVkICsgXCIpXCIpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLm1heFdpZHRoID0gbWF4V2lkdGg7XG5cdFx0dGhpcy5tYXhXaWR0aFN0eWxlZCA9IG1heFdpZHRoID8gbWF4V2lkdGggKyBcInB4XCIgOiBcIlwiO1xuXHRcdFxuXHRcdHRoaXMuZWxlbWVudC5zdHlsZS5tYXhXaWR0aCA9IHRoaXMubWF4V2lkdGhTdHlsZWQ7XG5cdFx0XG5cdFx0dGhpcy5jZWxscy5mb3JFYWNoKGZ1bmN0aW9uKGNlbGwpe1xuXHRcdFx0Y2VsbC5zZXRNYXhXaWR0aCgpO1xuXHRcdH0pO1xuXHR9XG5cdFxuXHRkZWxldGUoKXtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0aWYodGhpcy5pc0dyb3VwKXtcblx0XHRcdFx0dGhpcy5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdFx0XHRjb2x1bW4uZGVsZXRlKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwiY29sdW1uLWRlbGV0ZVwiLCB0aGlzKTtcblx0XHRcdFxuXHRcdFx0dmFyIGNlbGxDb3VudCA9IHRoaXMuY2VsbHMubGVuZ3RoO1xuXHRcdFx0XG5cdFx0XHRmb3IobGV0IGkgPSAwOyBpIDwgY2VsbENvdW50OyBpKyspe1xuXHRcdFx0XHR0aGlzLmNlbGxzWzBdLmRlbGV0ZSgpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZih0aGlzLmVsZW1lbnQucGFyZW50Tm9kZSl7XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuZWxlbWVudCA9IGZhbHNlO1xuXHRcdFx0dGhpcy5jb250ZW50RWxlbWVudCA9IGZhbHNlO1xuXHRcdFx0dGhpcy50aXRsZUVsZW1lbnQgPSBmYWxzZTtcblx0XHRcdHRoaXMuZ3JvdXBFbGVtZW50ID0gZmFsc2U7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMucGFyZW50LmlzR3JvdXApe1xuXHRcdFx0XHR0aGlzLnBhcmVudC5yZW1vdmVDaGlsZCh0aGlzKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmRlcmVnaXN0ZXJDb2x1bW4odGhpcyk7XG5cdFx0XHRcblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5yZXJlbmRlckNvbHVtbnModHJ1ZSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJjb2x1bW4tZGVsZXRlZFwiLCB0aGlzKTtcblx0XHRcdFxuXHRcdFx0cmVzb2x2ZSgpO1xuXHRcdH0pO1xuXHR9XG5cdFxuXHRjb2x1bW5SZW5kZXJlZCgpe1xuXHRcdGlmKHRoaXMudGl0bGVGb3JtYXR0ZXJSZW5kZXJlZCl7XG5cdFx0XHR0aGlzLnRpdGxlRm9ybWF0dGVyUmVuZGVyZWQoKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaChcImNvbHVtbi1yZW5kZXJlZFwiLCB0aGlzKTtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLyBDZWxsIE1hbmFnZW1lbnQgLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly9nZW5lcmF0ZSBjZWxsIGZvciB0aGlzIGNvbHVtblxuXHRnZW5lcmF0ZUNlbGwocm93KXtcblx0XHR2YXIgY2VsbCA9IG5ldyBDZWxsKHRoaXMsIHJvdyk7XG5cdFx0XG5cdFx0dGhpcy5jZWxscy5wdXNoKGNlbGwpO1xuXHRcdFxuXHRcdHJldHVybiBjZWxsO1xuXHR9XG5cdFxuXHRuZXh0Q29sdW1uKCl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW5JbmRleCh0aGlzKTtcblx0XHRyZXR1cm4gaW5kZXggPiAtMSA/IHRoaXMuX25leHRWaXNpYmxlQ29sdW1uKGluZGV4ICsgMSkgOiBmYWxzZTtcblx0fVxuXHRcblx0X25leHRWaXNpYmxlQ29sdW1uKGluZGV4KXtcblx0XHR2YXIgY29sdW1uID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbHVtbkJ5SW5kZXgoaW5kZXgpO1xuXHRcdHJldHVybiAhY29sdW1uIHx8IGNvbHVtbi52aXNpYmxlID8gY29sdW1uIDogdGhpcy5fbmV4dFZpc2libGVDb2x1bW4oaW5kZXggKyAxKTtcblx0fVxuXHRcblx0cHJldkNvbHVtbigpe1xuXHRcdHZhciBpbmRleCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uSW5kZXgodGhpcyk7XG5cdFx0cmV0dXJuIGluZGV4ID4gLTEgPyB0aGlzLl9wcmV2VmlzaWJsZUNvbHVtbihpbmRleCAtIDEpIDogZmFsc2U7XG5cdH1cblx0XG5cdF9wcmV2VmlzaWJsZUNvbHVtbihpbmRleCl7XG5cdFx0dmFyIGNvbHVtbiA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUluZGV4KGluZGV4KTtcblx0XHRyZXR1cm4gIWNvbHVtbiB8fCBjb2x1bW4udmlzaWJsZSA/IGNvbHVtbiA6IHRoaXMuX3ByZXZWaXNpYmxlQ29sdW1uKGluZGV4IC0gMSk7XG5cdH1cblx0XG5cdHJlaW5pdGlhbGl6ZVdpZHRoKGZvcmNlKXtcblx0XHR0aGlzLndpZHRoRml4ZWQgPSBmYWxzZTtcblx0XHRcblx0XHQvL3NldCB3aWR0aCBpZiBwcmVzZW50XG5cdFx0aWYodHlwZW9mIHRoaXMuZGVmaW5pdGlvbi53aWR0aCAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhZm9yY2Upe1xuXHRcdFx0Ly8gbWF4SW5pdGlhbFdpZHRoIGlnbm9yZWQgaGVyZSBhcyB3aWR0aCBzcGVjaWZpZWRcblx0XHRcdHRoaXMuc2V0V2lkdGgodGhpcy5kZWZpbml0aW9uLndpZHRoKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaChcImNvbHVtbi13aWR0aC1maXQtYmVmb3JlXCIsIHRoaXMpO1xuXHRcdFxuXHRcdHRoaXMuZml0VG9EYXRhKGZvcmNlKTtcblx0XHRcblx0XHR0aGlzLmRpc3BhdGNoKFwiY29sdW1uLXdpZHRoLWZpdC1hZnRlclwiLCB0aGlzKTtcblx0fVxuXHRcblx0Ly9zZXQgY29sdW1uIHdpZHRoIHRvIG1heGltdW0gY2VsbCB3aWR0aCBmb3Igbm9uIGdyb3VwIGNvbHVtbnNcblx0Zml0VG9EYXRhKGZvcmNlKXtcblx0XHRpZih0aGlzLmlzR3JvdXApe1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRcblx0XHRpZighdGhpcy53aWR0aEZpeGVkKXtcblx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IFwiXCI7XG5cdFx0XHRcblx0XHRcdHRoaXMuY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuXHRcdFx0XHRjZWxsLmNsZWFyV2lkdGgoKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRcblx0XHR2YXIgbWF4V2lkdGggPSB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cdFx0XG5cdFx0aWYoIXRoaXMud2lkdGggfHwgIXRoaXMud2lkdGhGaXhlZCl7XG5cdFx0XHR0aGlzLmNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcblx0XHRcdFx0dmFyIHdpZHRoID0gY2VsbC5nZXRXaWR0aCgpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYod2lkdGggPiBtYXhXaWR0aCl7XG5cdFx0XHRcdFx0bWF4V2lkdGggPSB3aWR0aDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdGlmKG1heFdpZHRoKXtcblx0XHRcdFx0dmFyIHNldFRvID0gbWF4V2lkdGggKyAxO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoZm9yY2Upe1xuXHRcdFx0XHRcdHRoaXMuc2V0V2lkdGgoc2V0VG8pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0aWYgKHRoaXMubWF4SW5pdGlhbFdpZHRoICYmICFmb3JjZSkge1xuXHRcdFx0XHRcdFx0c2V0VG8gPSBNYXRoLm1pbihzZXRUbywgdGhpcy5tYXhJbml0aWFsV2lkdGgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR0aGlzLnNldFdpZHRoQWN0dWFsKHNldFRvKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0dXBkYXRlRGVmaW5pdGlvbih1cGRhdGVzKXtcblx0XHR2YXIgZGVmaW5pdGlvbjtcblx0XHRcblx0XHRpZighdGhpcy5pc0dyb3VwKXtcblx0XHRcdGlmKCF0aGlzLnBhcmVudC5pc0dyb3VwKXtcblx0XHRcdFx0ZGVmaW5pdGlvbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZ2V0RGVmaW5pdGlvbigpKTtcblx0XHRcdFx0ZGVmaW5pdGlvbiA9IE9iamVjdC5hc3NpZ24oZGVmaW5pdGlvbiwgdXBkYXRlcyk7XG5cdFx0XHRcdFxuXHRcdFx0XHRyZXR1cm4gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmFkZENvbHVtbihkZWZpbml0aW9uLCBmYWxzZSwgdGhpcylcblx0XHRcdFx0XHQudGhlbigoY29sdW1uKSA9PiB7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZihkZWZpbml0aW9uLmZpZWxkID09IHRoaXMuZmllbGQpe1xuXHRcdFx0XHRcdFx0XHR0aGlzLmZpZWxkID0gZmFsc2U7IC8vY2xlYXIgZmllbGQgbmFtZSB0byBwcmV2ZW50IGRlbGV0aW9uIG9mIGR1cGxpY2F0ZSBjb2x1bW4gZnJvbSBhcnJheXNcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHJldHVybiB0aGlzLmRlbGV0ZSgpXG5cdFx0XHRcdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR9KTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIkNvbHVtbiBVcGRhdGUgRXJyb3IgLSBUaGUgdXBkYXRlRGVmaW5pdGlvbiBmdW5jdGlvbiBpcyBvbmx5IGF2YWlsYWJsZSBvbiB1bmdyb3VwZWQgY29sdW1uc1wiKTtcblx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KFwiQ29sdW1uIFVwZGF0ZSBFcnJvciAtIFRoZSB1cGRhdGVEZWZpbml0aW9uIGZ1bmN0aW9uIGlzIG9ubHkgYXZhaWxhYmxlIG9uIGNvbHVtbnMsIG5vdCBjb2x1bW4gZ3JvdXBzXCIpO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJDb2x1bW4gVXBkYXRlIEVycm9yIC0gVGhlIHVwZGF0ZURlZmluaXRpb24gZnVuY3Rpb24gaXMgb25seSBhdmFpbGFibGUgb24gdW5ncm91cGVkIGNvbHVtbnNcIik7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoXCJDb2x1bW4gVXBkYXRlIEVycm9yIC0gVGhlIHVwZGF0ZURlZmluaXRpb24gZnVuY3Rpb24gaXMgb25seSBhdmFpbGFibGUgb24gY29sdW1ucywgbm90IGNvbHVtbiBncm91cHNcIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRkZWxldGVDZWxsKGNlbGwpe1xuXHRcdHZhciBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihjZWxsKTtcblx0XHRcblx0XHRpZihpbmRleCA+IC0xKXtcblx0XHRcdHRoaXMuY2VsbHMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHR9XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8gT2JqZWN0IEdlbmVyYXRpb24gLy8vLy8vLy8vLy8vLy8vLy9cblx0Z2V0Q29tcG9uZW50KCl7XG5cdFx0aWYoIXRoaXMuY29tcG9uZW50KXtcblx0XHRcdHRoaXMuY29tcG9uZW50ID0gbmV3IENvbHVtbkNvbXBvbmVudCh0aGlzKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXMuY29tcG9uZW50O1xuXHR9XG5cdFxuXHRnZXRQb3NpdGlvbigpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0VmlzaWJsZUNvbHVtbnNCeUluZGV4KCkuaW5kZXhPZih0aGlzKSArIDE7XG5cdH1cblx0XG5cdGdldFBhcmVudENvbXBvbmVudCgpe1xuXHRcdHJldHVybiB0aGlzLnBhcmVudCBpbnN0YW5jZW9mIENvbHVtbiA/IHRoaXMucGFyZW50LmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH1cbn1cblxuLy9wdWJsaWMgcm93IG9iamVjdFxuY2xhc3MgUm93Q29tcG9uZW50IHtcblxuXHRjb25zdHJ1Y3RvciAocm93KXtcblx0XHR0aGlzLl9yb3cgPSByb3c7XG5cblx0XHRyZXR1cm4gbmV3IFByb3h5KHRoaXMsIHtcblx0XHRcdGdldDogZnVuY3Rpb24odGFyZ2V0LCBuYW1lLCByZWNlaXZlcikge1xuXHRcdFx0XHRpZiAodHlwZW9mIHRhcmdldFtuYW1lXSAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdHJldHVybiB0YXJnZXRbbmFtZV07XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gdGFyZ2V0Ll9yb3cudGFibGUuY29tcG9uZW50RnVuY3Rpb25CaW5kZXIuaGFuZGxlKFwicm93XCIsIHRhcmdldC5fcm93LCBuYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0Z2V0RGF0YSh0cmFuc2Zvcm0pe1xuXHRcdHJldHVybiB0aGlzLl9yb3cuZ2V0RGF0YSh0cmFuc2Zvcm0pO1xuXHR9XG5cblx0Z2V0RWxlbWVudCgpe1xuXHRcdHJldHVybiB0aGlzLl9yb3cuZ2V0RWxlbWVudCgpO1xuXHR9XG5cblx0Z2V0Q2VsbHMoKXtcblx0XHR2YXIgY2VsbHMgPSBbXTtcblxuXHRcdHRoaXMuX3Jvdy5nZXRDZWxscygpLmZvckVhY2goZnVuY3Rpb24oY2VsbCl7XG5cdFx0XHRjZWxscy5wdXNoKGNlbGwuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNlbGxzO1xuXHR9XG5cblx0Z2V0Q2VsbChjb2x1bW4pe1xuXHRcdHZhciBjZWxsID0gdGhpcy5fcm93LmdldENlbGwoY29sdW1uKTtcblx0XHRyZXR1cm4gY2VsbCA/IGNlbGwuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fVxuXG5cdGdldEluZGV4KCl7XG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy5nZXREYXRhKFwiZGF0YVwiKVt0aGlzLl9yb3cudGFibGUub3B0aW9ucy5pbmRleF07XG5cdH1cblxuXHRnZXRQb3NpdGlvbigpe1xuXHRcdHJldHVybiB0aGlzLl9yb3cuZ2V0UG9zaXRpb24oKTtcblx0fVxuXG5cdHdhdGNoUG9zaXRpb24oY2FsbGJhY2spe1xuXHRcdHJldHVybiB0aGlzLl9yb3cud2F0Y2hQb3NpdGlvbihjYWxsYmFjayk7XG5cdH1cblxuXHRkZWxldGUoKXtcblx0XHRyZXR1cm4gdGhpcy5fcm93LmRlbGV0ZSgpO1xuXHR9XG5cblx0c2Nyb2xsVG8ocG9zaXRpb24sIGlmVmlzaWJsZSl7XG5cdFx0cmV0dXJuIHRoaXMuX3Jvdy50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbFRvUm93KHRoaXMuX3JvdywgcG9zaXRpb24sIGlmVmlzaWJsZSk7XG5cdH1cblxuXHRtb3ZlKHRvLCBhZnRlcil7XG5cdFx0dGhpcy5fcm93Lm1vdmVUb1Jvdyh0bywgYWZ0ZXIpO1xuXHR9XG5cblx0dXBkYXRlKGRhdGEpe1xuXHRcdHJldHVybiB0aGlzLl9yb3cudXBkYXRlRGF0YShkYXRhKTtcblx0fVxuXG5cdG5vcm1hbGl6ZUhlaWdodCgpe1xuXHRcdHRoaXMuX3Jvdy5ub3JtYWxpemVIZWlnaHQodHJ1ZSk7XG5cdH1cblxuXHRfZ2V0U2VsZigpe1xuXHRcdHJldHVybiB0aGlzLl9yb3c7XG5cdH1cblxuXHRyZWZvcm1hdCgpe1xuXHRcdHJldHVybiB0aGlzLl9yb3cucmVpbml0aWFsaXplKCk7XG5cdH1cblxuXHRnZXRUYWJsZSgpe1xuXHRcdHJldHVybiB0aGlzLl9yb3cudGFibGU7XG5cdH1cblxuXHRnZXROZXh0Um93KCl7XG5cdFx0dmFyIHJvdyA9IHRoaXMuX3Jvdy5uZXh0Um93KCk7XG5cdFx0cmV0dXJuIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHJvdztcblx0fVxuXG5cdGdldFByZXZSb3coKXtcblx0XHR2YXIgcm93ID0gdGhpcy5fcm93LnByZXZSb3coKTtcblx0XHRyZXR1cm4gcm93ID8gcm93LmdldENvbXBvbmVudCgpIDogcm93O1xuXHR9XG59XG5cbmNsYXNzIFJvdyBleHRlbmRzIENvcmVGZWF0dXJle1xuXHRjb25zdHJ1Y3RvciAoZGF0YSwgcGFyZW50LCB0eXBlID0gXCJyb3dcIil7XG5cdFx0c3VwZXIocGFyZW50LnRhYmxlKTtcblx0XHRcblx0XHR0aGlzLnBhcmVudCA9IHBhcmVudDtcblx0XHR0aGlzLmRhdGEgPSB7fTtcblx0XHR0aGlzLnR5cGUgPSB0eXBlOyAvL3R5cGUgb2YgZWxlbWVudFxuXHRcdHRoaXMuZWxlbWVudCA9IGZhbHNlO1xuXHRcdHRoaXMubW9kdWxlcyA9IHt9OyAvL2hvbGQgbW9kdWxlIHZhcmlhYmxlcztcblx0XHR0aGlzLmNlbGxzID0gW107XG5cdFx0dGhpcy5oZWlnaHQgPSAwOyAvL2hvbGQgZWxlbWVudCBoZWlnaHRcblx0XHR0aGlzLmhlaWdodFN0eWxlZCA9IFwiXCI7IC8vaG9sZCBlbGVtZW50IGhlaWdodCBwcmUtc3R5bGVkIHRvIGltcHJvdmUgcmVuZGVyIGVmZmljaWVuY3lcblx0XHR0aGlzLm1hbnVhbEhlaWdodCA9IGZhbHNlOyAvL3VzZXIgaGFzIG1hbnVhbGx5IHNldCByb3cgaGVpZ2h0XG5cdFx0dGhpcy5vdXRlckhlaWdodCA9IDA7IC8vaG9sZCBlbGVtZW50cyBvdXRlciBoZWlnaHRcblx0XHR0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7IC8vZWxlbWVudCBoYXMgYmVlbiByZW5kZXJlZFxuXHRcdHRoaXMuaGVpZ2h0SW5pdGlhbGl6ZWQgPSBmYWxzZTsgLy9lbGVtZW50IGhhcyByZXNpemVkIGNlbGxzIHRvIGZpdFxuXHRcdHRoaXMucG9zaXRpb24gPSAwOyAvL3N0b3JlIHBvc2l0aW9uIG9mIGVsZW1lbnQgaW4gcm93IGxpc3Rcblx0XHR0aGlzLnBvc2l0aW9uV2F0Y2hlcnMgPSBbXTtcblx0XHRcblx0XHR0aGlzLmNvbXBvbmVudCA9IG51bGw7XG5cdFx0XG5cdFx0dGhpcy5jcmVhdGVkID0gZmFsc2U7XG5cdFx0XG5cdFx0dGhpcy5zZXREYXRhKGRhdGEpO1xuXHR9XG5cdFxuXHRjcmVhdGUoKXtcblx0XHRpZighdGhpcy5jcmVhdGVkKXtcblx0XHRcdHRoaXMuY3JlYXRlZCA9IHRydWU7XG5cdFx0XHR0aGlzLmdlbmVyYXRlRWxlbWVudCgpO1xuXHRcdH1cblx0fVxuXHRcblx0Y3JlYXRlRWxlbWVudCAoKXtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93XCIpO1xuXHRcdGVsLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJyb3dcIik7XG5cdFx0XG5cdFx0dGhpcy5lbGVtZW50ID0gZWw7XG5cdH1cblx0XG5cdGdldEVsZW1lbnQoKXtcblx0XHR0aGlzLmNyZWF0ZSgpO1xuXHRcdHJldHVybiB0aGlzLmVsZW1lbnQ7XG5cdH1cblx0XG5cdGRldGFjaEVsZW1lbnQoKXtcblx0XHRpZiAodGhpcy5lbGVtZW50ICYmIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlKXtcblx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRnZW5lcmF0ZUVsZW1lbnQoKXtcblx0XHR0aGlzLmNyZWF0ZUVsZW1lbnQoKTtcblx0XHR0aGlzLmRpc3BhdGNoKFwicm93LWluaXRcIiwgdGhpcyk7XG5cdH1cblx0XG5cdGdlbmVyYXRlQ2VsbHMoKXtcblx0XHR0aGlzLmNlbGxzID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdlbmVyYXRlQ2VsbHModGhpcyk7XG5cdH1cblx0XG5cdC8vZnVuY3Rpb25zIHRvIHNldHVwIG9uIGZpcnN0IHJlbmRlclxuXHRpbml0aWFsaXplKGZvcmNlLCBpbkZyYWdtZW50KXtcblx0XHR0aGlzLmNyZWF0ZSgpO1xuXHRcdFxuXHRcdGlmKCF0aGlzLmluaXRpYWxpemVkIHx8IGZvcmNlKXtcblx0XHRcdFxuXHRcdFx0dGhpcy5kZWxldGVDZWxscygpO1xuXHRcdFx0XG5cdFx0XHR3aGlsZSh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCkgdGhpcy5lbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5kaXNwYXRjaChcInJvdy1sYXlvdXQtYmVmb3JlXCIsIHRoaXMpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmdlbmVyYXRlQ2VsbHMoKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG5cdFx0XHRcblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5yZW5kZXJlci5yZW5kZXJSb3dDZWxscyh0aGlzLCBpbkZyYWdtZW50KTtcblx0XHRcdFxuXHRcdFx0aWYoZm9yY2Upe1xuXHRcdFx0XHR0aGlzLm5vcm1hbGl6ZUhlaWdodCgpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwicm93LWxheW91dFwiLCB0aGlzKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnJvd0Zvcm1hdHRlcil7XG5cdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5yb3dGb3JtYXR0ZXIodGhpcy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJyb3ctbGF5b3V0LWFmdGVyXCIsIHRoaXMpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5yZW5kZXJlci5yZXJlbmRlclJvd0NlbGxzKHRoaXMsIGluRnJhZ21lbnQpO1xuXHRcdH1cblx0fVxuXG5cdHJlbmRlcmVkKCl7XG5cdFx0dGhpcy5jZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG5cdFx0XHRjZWxsLmNlbGxSZW5kZXJlZCgpO1xuXHRcdH0pO1xuXHR9XG5cdFxuXHRyZWluaXRpYWxpemVIZWlnaHQoKXtcblx0XHR0aGlzLmhlaWdodEluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0XG5cdFx0aWYodGhpcy5lbGVtZW50ICYmIHRoaXMuZWxlbWVudC5vZmZzZXRQYXJlbnQgIT09IG51bGwpe1xuXHRcdFx0dGhpcy5ub3JtYWxpemVIZWlnaHQodHJ1ZSk7XG5cdFx0fVxuXHR9XG5cblx0ZGVpbml0aWFsaXplKCl7XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuXHR9XG5cdFxuXHRkZWluaXRpYWxpemVIZWlnaHQoKXtcblx0XHR0aGlzLmhlaWdodEluaXRpYWxpemVkID0gZmFsc2U7XG5cdH1cblx0XG5cdHJlaW5pdGlhbGl6ZShjaGlsZHJlbil7XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdHRoaXMuaGVpZ2h0SW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHRcblx0XHRpZighdGhpcy5tYW51YWxIZWlnaHQpe1xuXHRcdFx0dGhpcy5oZWlnaHQgPSAwO1xuXHRcdFx0dGhpcy5oZWlnaHRTdHlsZWQgPSBcIlwiO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50Lm9mZnNldFBhcmVudCAhPT0gbnVsbCl7XG5cdFx0XHR0aGlzLmluaXRpYWxpemUodHJ1ZSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuZGlzcGF0Y2goXCJyb3ctcmVsYXlvdXRcIiwgdGhpcyk7XG5cdH1cblx0XG5cdC8vZ2V0IGhlaWdodHMgd2hlbiBkb2luZyBidWxrIHJvdyBzdHlsZSBjYWxjcyBpbiB2aXJ0dWFsIERPTVxuXHRjYWxjSGVpZ2h0KGZvcmNlKXtcblx0XHR2YXIgbWF4SGVpZ2h0ID0gMCwgbWluSGVpZ2h0ICA9IDA7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucm93SGVpZ2h0KXtcblx0XHRcdHRoaXMuaGVpZ2h0ID0gdGhpcy50YWJsZS5vcHRpb25zLnJvd0hlaWdodDtcblx0XHR9ZWxzZSB7XG5cdFx0XHRtaW5IZWlnaHQgPSB0aGlzLmNhbGNNaW5IZWlnaHQoKTtcblx0XHRcdG1heEhlaWdodCA9IHRoaXMuY2FsY01heEhlaWdodCgpO1xuXHRcdFx0XG5cdFx0XHRpZihmb3JjZSl7XG5cdFx0XHRcdHRoaXMuaGVpZ2h0ID0gTWF0aC5tYXgobWF4SGVpZ2h0LCBtaW5IZWlnaHQpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmhlaWdodCA9IHRoaXMubWFudWFsSGVpZ2h0ID8gdGhpcy5oZWlnaHQgOiBNYXRoLm1heChtYXhIZWlnaHQsIG1pbkhlaWdodCk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuaGVpZ2h0U3R5bGVkID0gdGhpcy5oZWlnaHQgPyB0aGlzLmhlaWdodCArIFwicHhcIiA6IFwiXCI7XG5cdFx0dGhpcy5vdXRlckhlaWdodCA9IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG5cdH1cblxuXHRjYWxjTWluSGVpZ2h0KCl7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUub3B0aW9ucy5yZXNpemFibGVSb3dzID8gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCA6IDA7XG5cdH1cblxuXHRjYWxjTWF4SGVpZ2h0KCl7XG5cdFx0dmFyIG1heEhlaWdodCA9IDA7XG5cblx0XHR0aGlzLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oY2VsbCl7XG5cdFx0XHR2YXIgaGVpZ2h0ID0gY2VsbC5nZXRIZWlnaHQoKTtcblxuXHRcdFx0aWYoaGVpZ2h0ID4gbWF4SGVpZ2h0KXtcblx0XHRcdFx0bWF4SGVpZ2h0ID0gaGVpZ2h0O1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG1heEhlaWdodDtcblx0fVxuXHRcblx0Ly9zZXQgb2YgY2VsbHNcblx0c2V0Q2VsbEhlaWdodCgpe1xuXHRcdHRoaXMuY2VsbHMuZm9yRWFjaChmdW5jdGlvbihjZWxsKXtcblx0XHRcdGNlbGwuc2V0SGVpZ2h0KCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy5oZWlnaHRJbml0aWFsaXplZCA9IHRydWU7XG5cdH1cblx0XG5cdGNsZWFyQ2VsbEhlaWdodCgpe1xuXHRcdHRoaXMuY2VsbHMuZm9yRWFjaChmdW5jdGlvbihjZWxsKXtcblx0XHRcdGNlbGwuY2xlYXJIZWlnaHQoKTtcblx0XHR9KTtcblx0fVxuXHRcblx0Ly9ub3JtYWxpemUgdGhlIGhlaWdodCBvZiBlbGVtZW50cyBpbiB0aGUgcm93XG5cdG5vcm1hbGl6ZUhlaWdodChmb3JjZSl7XG5cdFx0aWYoZm9yY2UgJiYgIXRoaXMudGFibGUub3B0aW9ucy5yb3dIZWlnaHQpe1xuXHRcdFx0dGhpcy5jbGVhckNlbGxIZWlnaHQoKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5jYWxjSGVpZ2h0KGZvcmNlKTtcblx0XHRcblx0XHR0aGlzLnNldENlbGxIZWlnaHQoKTtcblx0fVxuXHRcblx0Ly9zZXQgaGVpZ2h0IG9mIHJvd3Ncblx0c2V0SGVpZ2h0KGhlaWdodCwgZm9yY2Upe1xuXHRcdGlmKHRoaXMuaGVpZ2h0ICE9IGhlaWdodCB8fCBmb3JjZSl7XG5cdFx0XHRcblx0XHRcdHRoaXMubWFudWFsSGVpZ2h0ID0gdHJ1ZTtcblx0XHRcdFxuXHRcdFx0dGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG5cdFx0XHR0aGlzLmhlaWdodFN0eWxlZCA9IGhlaWdodCA/IGhlaWdodCArIFwicHhcIiA6IFwiXCI7XG5cdFx0XHRcblx0XHRcdHRoaXMuc2V0Q2VsbEhlaWdodCgpO1xuXHRcdFx0XG5cdFx0XHQvLyB0aGlzLm91dGVySGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCk7XG5cdFx0XHR0aGlzLm91dGVySGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDtcblxuXHRcdFx0aWYodGhpcy5zdWJzY3JpYmVkRXh0ZXJuYWwoXCJyb3dIZWlnaHRcIikpe1xuXHRcdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJyb3dIZWlnaHRcIiwgdGhpcy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3JldHVybiByb3dzIG91dGVyIGhlaWdodFxuXHRnZXRIZWlnaHQoKXtcblx0XHRyZXR1cm4gdGhpcy5vdXRlckhlaWdodDtcblx0fVxuXHRcblx0Ly9yZXR1cm4gcm93cyBvdXRlciBXaWR0aFxuXHRnZXRXaWR0aCgpe1xuXHRcdHJldHVybiB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8gQ2VsbCBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vLy8vXG5cdGRlbGV0ZUNlbGwoY2VsbCl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy5jZWxscy5pbmRleE9mKGNlbGwpO1xuXHRcdFxuXHRcdGlmKGluZGV4ID4gLTEpe1xuXHRcdFx0dGhpcy5jZWxscy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdH1cblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLyBEYXRhIE1hbmFnZW1lbnQgLy8vLy8vLy8vLy8vLy8vLy9cblx0c2V0RGF0YShkYXRhKXtcblx0XHR0aGlzLmRhdGEgPSB0aGlzLmNoYWluKFwicm93LWRhdGEtaW5pdC1iZWZvcmVcIiwgW3RoaXMsIGRhdGFdLCB1bmRlZmluZWQsIGRhdGEpO1xuXHRcdFxuXHRcdHRoaXMuZGlzcGF0Y2goXCJyb3ctZGF0YS1pbml0LWFmdGVyXCIsIHRoaXMpO1xuXHR9XG5cdFxuXHQvL3VwZGF0ZSB0aGUgcm93cyBkYXRhXG5cdHVwZGF0ZURhdGEodXBkYXRlZERhdGEpe1xuXHRcdHZhciB2aXNpYmxlID0gdGhpcy5lbGVtZW50ICYmIEhlbHBlcnMuZWxWaXNpYmxlKHRoaXMuZWxlbWVudCksXG5cdFx0dGVtcERhdGEgPSB7fSxcblx0XHRuZXdSb3dEYXRhO1xuXHRcdFxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcblx0XHRcdGlmKHR5cGVvZiB1cGRhdGVkRGF0YSA9PT0gXCJzdHJpbmdcIil7XG5cdFx0XHRcdHVwZGF0ZWREYXRhID0gSlNPTi5wYXJzZSh1cGRhdGVkRGF0YSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJyb3ctZGF0YS1zYXZlLWJlZm9yZVwiLCB0aGlzKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5zdWJzY3JpYmVkKFwicm93LWRhdGEtY2hhbmdpbmdcIikpe1xuXHRcdFx0XHR0ZW1wRGF0YSA9IE9iamVjdC5hc3NpZ24odGVtcERhdGEsIHRoaXMuZGF0YSk7XG5cdFx0XHRcdHRlbXBEYXRhID0gT2JqZWN0LmFzc2lnbih0ZW1wRGF0YSwgdXBkYXRlZERhdGEpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRuZXdSb3dEYXRhID0gdGhpcy5jaGFpbihcInJvdy1kYXRhLWNoYW5naW5nXCIsIFt0aGlzLCB0ZW1wRGF0YSwgdXBkYXRlZERhdGFdLCBudWxsLCB1cGRhdGVkRGF0YSk7XG5cdFx0XHRcblx0XHRcdC8vc2V0IGRhdGFcblx0XHRcdGZvciAobGV0IGF0dHJuYW1lIGluIG5ld1Jvd0RhdGEpIHtcblx0XHRcdFx0dGhpcy5kYXRhW2F0dHJuYW1lXSA9IG5ld1Jvd0RhdGFbYXR0cm5hbWVdO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwicm93LWRhdGEtc2F2ZS1hZnRlclwiLCB0aGlzKTtcblx0XHRcdFxuXHRcdFx0Ly91cGRhdGUgYWZmZWN0ZWQgY2VsbHMgb25seVxuXHRcdFx0Zm9yIChsZXQgYXR0cm5hbWUgaW4gdXBkYXRlZERhdGEpIHtcblx0XHRcdFx0XG5cdFx0XHRcdGxldCBjb2x1bW5zID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbHVtbnNCeUZpZWxkUm9vdChhdHRybmFtZSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuXHRcdFx0XHRcdGxldCBjZWxsID0gdGhpcy5nZXRDZWxsKGNvbHVtbi5nZXRGaWVsZCgpKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZihjZWxsKXtcblx0XHRcdFx0XHRcdGxldCB2YWx1ZSA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKG5ld1Jvd0RhdGEpO1xuXHRcdFx0XHRcdFx0aWYoY2VsbC5nZXRWYWx1ZSgpICE9PSB2YWx1ZSl7XG5cdFx0XHRcdFx0XHRcdGNlbGwuc2V0VmFsdWVQcm9jZXNzRGF0YSh2YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRpZih2aXNpYmxlKXtcblx0XHRcdFx0XHRcdFx0XHRjZWxsLmNlbGxSZW5kZXJlZCgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Ly9QYXJ0aWFsIHJlaW5pdGlhbGl6YXRpb24gaWYgdmlzaWJsZVxuXHRcdFx0aWYodmlzaWJsZSl7XG5cdFx0XHRcdHRoaXMubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnJvd0Zvcm1hdHRlcil7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnJvd0Zvcm1hdHRlcih0aGlzLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0XHRcdHRoaXMuaGVpZ2h0ID0gMDtcblx0XHRcdFx0dGhpcy5oZWlnaHRTdHlsZWQgPSBcIlwiO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwicm93LWRhdGEtY2hhbmdlZFwiLCB0aGlzLCB2aXNpYmxlLCB1cGRhdGVkRGF0YSk7XG5cdFx0XHRcblx0XHRcdC8vdGhpcy5yZWluaXRpYWxpemUoKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicm93VXBkYXRlZFwiLCB0aGlzLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5zdWJzY3JpYmVkRXh0ZXJuYWwoXCJkYXRhQ2hhbmdlZFwiKSl7XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFDaGFuZ2VkXCIsIHRoaXMudGFibGUucm93TWFuYWdlci5nZXREYXRhKCkpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRyZXNvbHZlKCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdGdldERhdGEodHJhbnNmb3JtKXtcblx0XHRpZih0cmFuc2Zvcm0pe1xuXHRcdFx0cmV0dXJuIHRoaXMuY2hhaW4oXCJyb3ctZGF0YS1yZXRyaWV2ZVwiLCBbdGhpcywgdHJhbnNmb3JtXSwgbnVsbCwgdGhpcy5kYXRhKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXMuZGF0YTtcblx0fVxuXHRcblx0Z2V0Q2VsbChjb2x1bW4pe1xuXHRcdHZhciBtYXRjaCA9IGZhbHNlO1xuXHRcdFxuXHRcdGNvbHVtbiA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGNvbHVtbik7XG5cdFx0XG5cdFx0aWYoIXRoaXMuaW5pdGlhbGl6ZWQgJiYgdGhpcy5jZWxscy5sZW5ndGggPT09IDApe1xuXHRcdFx0dGhpcy5nZW5lcmF0ZUNlbGxzKCk7XG5cdFx0fVxuXHRcdFxuXHRcdG1hdGNoID0gdGhpcy5jZWxscy5maW5kKGZ1bmN0aW9uKGNlbGwpe1xuXHRcdFx0cmV0dXJuIGNlbGwuY29sdW1uID09PSBjb2x1bW47XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIG1hdGNoO1xuXHR9XG5cdFxuXHRnZXRDZWxsSW5kZXgoZmluZENlbGwpe1xuXHRcdHJldHVybiB0aGlzLmNlbGxzLmZpbmRJbmRleChmdW5jdGlvbihjZWxsKXtcblx0XHRcdHJldHVybiBjZWxsID09PSBmaW5kQ2VsbDtcblx0XHR9KTtcblx0fVxuXHRcblx0ZmluZENlbGwoc3ViamVjdCl7XG5cdFx0cmV0dXJuIHRoaXMuY2VsbHMuZmluZCgoY2VsbCkgPT4ge1xuXHRcdFx0cmV0dXJuIGNlbGwuZWxlbWVudCA9PT0gc3ViamVjdDtcblx0XHR9KTtcblx0fVxuXHRcblx0Z2V0Q2VsbHMoKXtcblx0XHRpZighdGhpcy5pbml0aWFsaXplZCAmJiB0aGlzLmNlbGxzLmxlbmd0aCA9PT0gMCl7XG5cdFx0XHR0aGlzLmdlbmVyYXRlQ2VsbHMoKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXMuY2VsbHM7XG5cdH1cblx0XG5cdG5leHRSb3coKXtcblx0XHR2YXIgcm93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLm5leHREaXNwbGF5Um93KHRoaXMsIHRydWUpO1xuXHRcdHJldHVybiByb3cgfHwgZmFsc2U7XG5cdH1cblx0XG5cdHByZXZSb3coKXtcblx0XHR2YXIgcm93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnByZXZEaXNwbGF5Um93KHRoaXMsIHRydWUpO1xuXHRcdHJldHVybiByb3cgfHwgZmFsc2U7XG5cdH1cblx0XG5cdG1vdmVUb1Jvdyh0bywgYmVmb3JlKXtcblx0XHR2YXIgdG9Sb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyh0byk7XG5cdFx0XG5cdFx0aWYodG9Sb3cpe1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3dBY3R1YWwodGhpcywgdG9Sb3csICFiZWZvcmUpO1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlZnJlc2hBY3RpdmVEYXRhKFwiZGlzcGxheVwiLCBmYWxzZSwgdHJ1ZSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiTW92ZSBFcnJvciAtIE5vIG1hdGNoaW5nIHJvdyBmb3VuZDpcIiwgdG8pO1xuXHRcdH1cblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vIEFjdGlvbnMgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRkZWxldGUoKXtcblx0XHR0aGlzLmRpc3BhdGNoKFwicm93LWRlbGV0ZVwiLCB0aGlzKTtcblx0XHRcblx0XHR0aGlzLmRlbGV0ZUFjdHVhbCgpO1xuXHRcdFxuXHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblx0fVxuXHRcblx0ZGVsZXRlQWN0dWFsKGJsb2NrUmVkcmF3KXtcblx0XHR0aGlzLmRldGFjaE1vZHVsZXMoKTtcblx0XHRcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZGVsZXRlUm93KHRoaXMsIGJsb2NrUmVkcmF3KTtcblx0XHRcblx0XHR0aGlzLmRlbGV0ZUNlbGxzKCk7XG5cdFx0XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdHRoaXMuaGVpZ2h0SW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLmVsZW1lbnQgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLmRpc3BhdGNoKFwicm93LWRlbGV0ZWRcIiwgdGhpcyk7XG5cdH1cblx0XG5cdGRldGFjaE1vZHVsZXMoKXtcblx0XHR0aGlzLmRpc3BhdGNoKFwicm93LWRlbGV0aW5nXCIsIHRoaXMpO1xuXHR9XG5cdFxuXHRkZWxldGVDZWxscygpe1xuXHRcdHZhciBjZWxsQ291bnQgPSB0aGlzLmNlbGxzLmxlbmd0aDtcblx0XHRcblx0XHRmb3IobGV0IGkgPSAwOyBpIDwgY2VsbENvdW50OyBpKyspe1xuXHRcdFx0dGhpcy5jZWxsc1swXS5kZWxldGUoKTtcblx0XHR9XG5cdH1cblx0XG5cdHdpcGUoKXtcblx0XHR0aGlzLmRldGFjaE1vZHVsZXMoKTtcblx0XHR0aGlzLmRlbGV0ZUNlbGxzKCk7XG5cdFx0XG5cdFx0aWYodGhpcy5lbGVtZW50KXtcblx0XHRcdHdoaWxlKHRoaXMuZWxlbWVudC5maXJzdENoaWxkKSB0aGlzLmVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLmVsZW1lbnQucGFyZW50Tm9kZSl7XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuZWxlbWVudCA9IGZhbHNlO1xuXHRcdHRoaXMubW9kdWxlcyA9IHt9O1xuXHR9XG5cblx0aXNEaXNwbGF5ZWQoKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCkuaW5jbHVkZXModGhpcyk7XG5cdH1cblxuXHRnZXRQb3NpdGlvbigpe1xuXHRcdHJldHVybiB0aGlzLmlzRGlzcGxheWVkKCkgPyB0aGlzLnBvc2l0aW9uIDogZmFsc2U7XG5cdH1cblxuXHRzZXRQb3NpdGlvbihwb3NpdGlvbil7XG5cdFx0aWYocG9zaXRpb24gIT0gdGhpcy5wb3NpdGlvbil7XG5cdFx0XHR0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG5cblx0XHRcdHRoaXMucG9zaXRpb25XYXRjaGVycy5mb3JFYWNoKChjYWxsYmFjaykgPT4ge1xuXHRcdFx0XHRjYWxsYmFjayh0aGlzLnBvc2l0aW9uKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdHdhdGNoUG9zaXRpb24oY2FsbGJhY2spe1xuXHRcdHRoaXMucG9zaXRpb25XYXRjaGVycy5wdXNoKGNhbGxiYWNrKTtcblxuXHRcdGNhbGxiYWNrKHRoaXMucG9zaXRpb24pO1xuXHR9XG5cdFxuXHRnZXRHcm91cCgpe1xuXHRcdHJldHVybiB0aGlzLm1vZHVsZXMuZ3JvdXAgfHwgZmFsc2U7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8gT2JqZWN0IEdlbmVyYXRpb24gLy8vLy8vLy8vLy8vLy8vLy9cblx0Z2V0Q29tcG9uZW50KCl7XG5cdFx0aWYoIXRoaXMuY29tcG9uZW50KXtcblx0XHRcdHRoaXMuY29tcG9uZW50ID0gbmV3IFJvd0NvbXBvbmVudCh0aGlzKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXMuY29tcG9uZW50O1xuXHR9XG59XG5cbnZhciBkZWZhdWx0Q2FsY3VsYXRpb25zID0ge1xuXHRcImF2Z1wiOmZ1bmN0aW9uKHZhbHVlcywgZGF0YSwgY2FsY1BhcmFtcyl7XG5cdFx0dmFyIG91dHB1dCA9IDAsXG5cdFx0cHJlY2lzaW9uID0gdHlwZW9mIGNhbGNQYXJhbXMucHJlY2lzaW9uICE9PSBcInVuZGVmaW5lZFwiID8gY2FsY1BhcmFtcy5wcmVjaXNpb24gOiAyO1xuXG5cdFx0aWYodmFsdWVzLmxlbmd0aCl7XG5cdFx0XHRvdXRwdXQgPSB2YWx1ZXMucmVkdWNlKGZ1bmN0aW9uKHN1bSwgdmFsdWUpe1xuXHRcdFx0XHRyZXR1cm4gTnVtYmVyKHN1bSkgKyBOdW1iZXIodmFsdWUpO1xuXHRcdFx0fSk7XG5cblx0XHRcdG91dHB1dCA9IG91dHB1dCAvIHZhbHVlcy5sZW5ndGg7XG5cblx0XHRcdG91dHB1dCA9IHByZWNpc2lvbiAhPT0gZmFsc2UgPyBvdXRwdXQudG9GaXhlZChwcmVjaXNpb24pIDogb3V0cHV0O1xuXHRcdH1cblxuXHRcdHJldHVybiBwYXJzZUZsb2F0KG91dHB1dCkudG9TdHJpbmcoKTtcblx0fSxcblx0XCJtYXhcIjpmdW5jdGlvbih2YWx1ZXMsIGRhdGEsIGNhbGNQYXJhbXMpe1xuXHRcdHZhciBvdXRwdXQgPSBudWxsLFxuXHRcdHByZWNpc2lvbiA9IHR5cGVvZiBjYWxjUGFyYW1zLnByZWNpc2lvbiAhPT0gXCJ1bmRlZmluZWRcIiA/IGNhbGNQYXJhbXMucHJlY2lzaW9uIDogZmFsc2U7XG5cblx0XHR2YWx1ZXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSl7XG5cblx0XHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblxuXHRcdFx0aWYodmFsdWUgPiBvdXRwdXQgfHwgb3V0cHV0ID09PSBudWxsKXtcblx0XHRcdFx0b3V0cHV0ID0gdmFsdWU7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0ICE9PSBudWxsID8gKHByZWNpc2lvbiAhPT0gZmFsc2UgPyBvdXRwdXQudG9GaXhlZChwcmVjaXNpb24pIDogb3V0cHV0KSA6IFwiXCI7XG5cdH0sXG5cdFwibWluXCI6ZnVuY3Rpb24odmFsdWVzLCBkYXRhLCBjYWxjUGFyYW1zKXtcblx0XHR2YXIgb3V0cHV0ID0gbnVsbCxcblx0XHRwcmVjaXNpb24gPSB0eXBlb2YgY2FsY1BhcmFtcy5wcmVjaXNpb24gIT09IFwidW5kZWZpbmVkXCIgPyBjYWxjUGFyYW1zLnByZWNpc2lvbiA6IGZhbHNlO1xuXG5cdFx0dmFsdWVzLmZvckVhY2goZnVuY3Rpb24odmFsdWUpe1xuXG5cdFx0XHR2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XG5cblx0XHRcdGlmKHZhbHVlIDwgb3V0cHV0IHx8IG91dHB1dCA9PT0gbnVsbCl7XG5cdFx0XHRcdG91dHB1dCA9IHZhbHVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG91dHB1dCAhPT0gbnVsbCA/IChwcmVjaXNpb24gIT09IGZhbHNlID8gb3V0cHV0LnRvRml4ZWQocHJlY2lzaW9uKSA6IG91dHB1dCkgOiBcIlwiO1xuXHR9LFxuXHRcInN1bVwiOmZ1bmN0aW9uKHZhbHVlcywgZGF0YSwgY2FsY1BhcmFtcyl7XG5cdFx0dmFyIG91dHB1dCA9IDAsXG5cdFx0cHJlY2lzaW9uID0gdHlwZW9mIGNhbGNQYXJhbXMucHJlY2lzaW9uICE9PSBcInVuZGVmaW5lZFwiID8gY2FsY1BhcmFtcy5wcmVjaXNpb24gOiBmYWxzZTtcblxuXHRcdGlmKHZhbHVlcy5sZW5ndGgpe1xuXHRcdFx0dmFsdWVzLmZvckVhY2goZnVuY3Rpb24odmFsdWUpe1xuXHRcdFx0XHR2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XG5cblx0XHRcdFx0b3V0cHV0ICs9ICFpc05hTih2YWx1ZSkgPyBOdW1iZXIodmFsdWUpIDogMDtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBwcmVjaXNpb24gIT09IGZhbHNlID8gb3V0cHV0LnRvRml4ZWQocHJlY2lzaW9uKSA6IG91dHB1dDtcblx0fSxcblx0XCJjb25jYXRcIjpmdW5jdGlvbih2YWx1ZXMsIGRhdGEsIGNhbGNQYXJhbXMpe1xuXHRcdHZhciBvdXRwdXQgPSAwO1xuXG5cdFx0aWYodmFsdWVzLmxlbmd0aCl7XG5cdFx0XHRvdXRwdXQgPSB2YWx1ZXMucmVkdWNlKGZ1bmN0aW9uKHN1bSwgdmFsdWUpe1xuXHRcdFx0XHRyZXR1cm4gU3RyaW5nKHN1bSkgKyBTdHJpbmcodmFsdWUpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fSxcblx0XCJjb3VudFwiOmZ1bmN0aW9uKHZhbHVlcywgZGF0YSwgY2FsY1BhcmFtcyl7XG5cdFx0dmFyIG91dHB1dCA9IDA7XG5cblx0XHRpZih2YWx1ZXMubGVuZ3RoKXtcblx0XHRcdHZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlKXtcblx0XHRcdFx0aWYodmFsdWUpe1xuXHRcdFx0XHRcdG91dHB1dCArKztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fSxcblx0XCJ1bmlxdWVcIjpmdW5jdGlvbih2YWx1ZXMsIGRhdGEsIGNhbGNQYXJhbXMpe1xuXHRcdHZhciB1bmlxdWUgPSB2YWx1ZXMuZmlsdGVyKCh2YWx1ZSwgaW5kZXgpID0+IHtcblx0XHRcdHJldHVybiAodmFsdWVzIHx8IHZhbHVlID09PSAwKSAmJiB2YWx1ZXMuaW5kZXhPZih2YWx1ZSkgPT09IGluZGV4O1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHVuaXF1ZS5sZW5ndGg7XG5cdH0sXG59O1xuXG5jbGFzcyBDb2x1bW5DYWxjcyBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwiY29sdW1uQ2FsY3NcIjtcblxuXHQvL2xvYWQgZGVmYXVsdHNcblx0c3RhdGljIGNhbGN1bGF0aW9ucyA9IGRlZmF1bHRDYWxjdWxhdGlvbnM7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMudG9wQ2FsY3MgPSBbXTtcblx0XHR0aGlzLmJvdENhbGNzID0gW107XG5cdFx0dGhpcy5nZW5Db2x1bW4gPSBmYWxzZTtcblx0XHR0aGlzLnRvcEVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoKTtcblx0XHR0aGlzLmJvdEVsZW1lbnQgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoKTtcblx0XHR0aGlzLnRvcFJvdyA9IGZhbHNlO1xuXHRcdHRoaXMuYm90Um93ID0gZmFsc2U7XG5cdFx0dGhpcy50b3BJbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdHRoaXMuYm90SW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLmJsb2NrZWQgPSBmYWxzZTtcblx0XHR0aGlzLnJlY2FsY0FmdGVyQmxvY2sgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJjb2x1bW5DYWxjc1wiLCB0cnVlKTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwidG9wQ2FsY1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwidG9wQ2FsY1BhcmFtc1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwidG9wQ2FsY0Zvcm1hdHRlclwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwidG9wQ2FsY0Zvcm1hdHRlclBhcmFtc1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiYm90dG9tQ2FsY1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiYm90dG9tQ2FsY1BhcmFtc1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiYm90dG9tQ2FsY0Zvcm1hdHRlclwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiYm90dG9tQ2FsY0Zvcm1hdHRlclBhcmFtc1wiKTtcblx0fVxuXHRcblx0Y3JlYXRlRWxlbWVudCAoKXtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItY2FsY3MtaG9sZGVyXCIpO1xuXHRcdHJldHVybiBlbDtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuZ2VuQ29sdW1uID0gbmV3IENvbHVtbih7ZmllbGQ6XCJ2YWx1ZVwifSwgdGhpcyk7XG5cdFx0XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLXZhbHVlLWNoYW5nZWRcIiwgdGhpcy5jZWxsVmFsdWVDaGFuZ2VkLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWluaXRcIiwgdGhpcy5pbml0aWFsaXplQ29sdW1uQ2hlY2suYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctZGVsZXRlZFwiLCB0aGlzLnJvd3NVcGRhdGVkLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwic2Nyb2xsLWhvcml6b250YWxcIiwgdGhpcy5zY3JvbGxIb3Jpem9udGFsLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWFkZGVkXCIsIHRoaXMucm93c1VwZGF0ZWQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tbW92ZWRcIiwgdGhpcy5yZWNhbGNBY3RpdmVSb3dzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWFkZFwiLCB0aGlzLnJlY2FsY0FjdGl2ZVJvd3MuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLXJlZnJlc2hlZFwiLCB0aGlzLnJlY2FsY0FjdGl2ZVJvd3NSZWZyZXNoLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtcmVkcmF3XCIsIHRoaXMudGFibGVSZWRyYXcuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3dzLXZpc2libGVcIiwgdGhpcy52aXNpYmxlUm93cy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcInNjcm9sbGJhci12ZXJ0aWNhbFwiLCB0aGlzLmFkanVzdEZvclNjcm9sbGJhci5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHR0aGlzLnN1YnNjcmliZShcInJlZHJhdy1ibG9ja2VkXCIsIHRoaXMuYmxvY2tSZWRyYXcuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJyZWRyYXctcmVzdG9yZWRcIiwgdGhpcy5yZXN0b3JlUmVkcmF3LmJpbmQodGhpcykpO1xuXG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJ0YWJsZS1yZWRyYXdpbmdcIiwgdGhpcy5yZXNpemVIb2xkZXJXaWR0aC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1yZXNpemVkXCIsIHRoaXMucmVzaXplSG9sZGVyV2lkdGguYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tc2hvd1wiLCB0aGlzLnJlc2l6ZUhvbGRlcldpZHRoLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWhpZGVcIiwgdGhpcy5yZXNpemVIb2xkZXJXaWR0aC5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldENhbGNSZXN1bHRzXCIsIHRoaXMuZ2V0UmVzdWx0cy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInJlY2FsY1wiLCB0aGlzLnVzZXJSZWNhbGMuYmluZCh0aGlzKSk7XG5cblxuXHRcdHRoaXMucmVzaXplSG9sZGVyV2lkdGgoKTtcblx0fVxuXG5cdHJlc2l6ZUhvbGRlcldpZHRoKCl7XG5cdFx0dGhpcy50b3BFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmhlYWRlcnNFbGVtZW50Lm9mZnNldFdpZHRoICsgXCJweFwiO1xuXHR9XG5cblx0XG5cdHRhYmxlUmVkcmF3KGZvcmNlKXtcblx0XHR0aGlzLnJlY2FsYyh0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cyk7XG5cdFx0XG5cdFx0aWYoZm9yY2Upe1xuXHRcdFx0dGhpcy5yZWRyYXcoKTtcblx0XHR9XG5cdH1cblx0XG5cdGJsb2NrUmVkcmF3KCl7XG5cdFx0dGhpcy5ibG9ja2VkID0gdHJ1ZTtcblx0XHR0aGlzLnJlY2FsY0FmdGVyQmxvY2sgPSBmYWxzZTtcblx0fVxuXHRcblx0XG5cdHJlc3RvcmVSZWRyYXcoKXtcblx0XHR0aGlzLmJsb2NrZWQgPSBmYWxzZTtcblx0XHRcblx0XHRpZih0aGlzLnJlY2FsY0FmdGVyQmxvY2spe1xuXHRcdFx0dGhpcy5yZWNhbGNBZnRlckJsb2NrID0gZmFsc2U7XG5cdFx0XHR0aGlzLnJlY2FsY0FjdGl2ZVJvd3NSZWZyZXNoKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gVGFibGUgRnVuY3Rpb25zIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHR1c2VyUmVjYWxjKCl7XG5cdFx0dGhpcy5yZWNhbGModGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFjdGl2ZVJvd3MpO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gSW50ZXJuYWwgTG9naWMgLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0YmxvY2tDaGVjaygpe1xuXHRcdGlmKHRoaXMuYmxvY2tlZCl7XG5cdFx0XHR0aGlzLnJlY2FsY0FmdGVyQmxvY2sgPSB0cnVlO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gdGhpcy5ibG9ja2VkO1xuXHR9XG5cdFxuXHR2aXNpYmxlUm93cyh2aWV3YWJsZSwgcm93cyl7XG5cdFx0aWYodGhpcy50b3BSb3cpe1xuXHRcdFx0cm93cy51bnNoaWZ0KHRoaXMudG9wUm93KTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy5ib3RSb3cpe1xuXHRcdFx0cm93cy5wdXNoKHRoaXMuYm90Um93KTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHJvd3M7XG5cdH1cblx0XG5cdHJvd3NVcGRhdGVkKHJvdyl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkpe1xuXHRcdFx0dGhpcy5yZWNhbGNSb3dHcm91cChyb3cpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMucmVjYWxjQWN0aXZlUm93cygpO1xuXHRcdH1cblx0fVxuXHRcblx0cmVjYWxjQWN0aXZlUm93c1JlZnJlc2goKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWVTdGFydEV4cGFuZGVkICYmIHRoaXMudGFibGUub3B0aW9ucy5kYXRhVHJlZSl7XG5cdFx0XHR0aGlzLnJlY2FsY0FsbCgpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMucmVjYWxjQWN0aXZlUm93cygpO1xuXHRcdH1cblx0fVxuXHRcblx0cmVjYWxjQWN0aXZlUm93cygpe1xuXHRcdHRoaXMucmVjYWxjKHRoaXMudGFibGUucm93TWFuYWdlci5hY3RpdmVSb3dzKTtcblx0fVxuXHRcblx0Y2VsbFZhbHVlQ2hhbmdlZChjZWxsKXtcblx0XHRpZihjZWxsLmNvbHVtbi5kZWZpbml0aW9uLnRvcENhbGMgfHwgY2VsbC5jb2x1bW4uZGVmaW5pdGlvbi5ib3R0b21DYWxjKXtcblx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5KXtcblx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzID09IFwidGFibGVcIiB8fCB0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgPT0gXCJib3RoXCIpe1xuXHRcdFx0XHRcdHRoaXMucmVjYWxjQWN0aXZlUm93cygpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJ0YWJsZVwiKXtcblx0XHRcdFx0XHR0aGlzLnJlY2FsY1Jvd0dyb3VwKGNlbGwucm93KTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLnJlY2FsY0FjdGl2ZVJvd3MoKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGluaXRpYWxpemVDb2x1bW5DaGVjayhjb2x1bW4pe1xuXHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLnRvcENhbGMgfHwgY29sdW1uLmRlZmluaXRpb24uYm90dG9tQ2FsYyl7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVDb2x1bW4oY29sdW1uKTtcblx0XHR9XG5cdH1cblx0XG5cdC8vaW5pdGlhbGl6ZSBjb2x1bW4gY2FsY3Ncblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdHZhciBkZWYgPSBjb2x1bW4uZGVmaW5pdGlvbjtcblx0XHRcblx0XHR2YXIgY29uZmlnID0ge1xuXHRcdFx0dG9wQ2FsY1BhcmFtczpkZWYudG9wQ2FsY1BhcmFtcyB8fCB7fSxcblx0XHRcdGJvdENhbGNQYXJhbXM6ZGVmLmJvdHRvbUNhbGNQYXJhbXMgfHwge30sXG5cdFx0fTtcblx0XHRcblx0XHRpZihkZWYudG9wQ2FsYyl7XG5cdFx0XHRcblx0XHRcdHN3aXRjaCh0eXBlb2YgZGVmLnRvcENhbGMpe1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0aWYoQ29sdW1uQ2FsY3MuY2FsY3VsYXRpb25zW2RlZi50b3BDYWxjXSl7XG5cdFx0XHRcdFx0XHRjb25maWcudG9wQ2FsYyA9IENvbHVtbkNhbGNzLmNhbGN1bGF0aW9uc1tkZWYudG9wQ2FsY107XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIENhbGMgRXJyb3IgLSBObyBzdWNoIGNhbGN1bGF0aW9uIGZvdW5kLCBpZ25vcmluZzogXCIsIGRlZi50b3BDYWxjKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFxuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRjb25maWcudG9wQ2FsYyA9IGRlZi50b3BDYWxjO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoY29uZmlnLnRvcENhbGMpe1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5jb2x1bW5DYWxjcyA9IGNvbmZpZztcblx0XHRcdFx0dGhpcy50b3BDYWxjcy5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJncm91cFwiKXtcblx0XHRcdFx0XHR0aGlzLmluaXRpYWxpemVUb3BSb3coKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGRlZi5ib3R0b21DYWxjKXtcblx0XHRcdHN3aXRjaCh0eXBlb2YgZGVmLmJvdHRvbUNhbGMpe1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0aWYoQ29sdW1uQ2FsY3MuY2FsY3VsYXRpb25zW2RlZi5ib3R0b21DYWxjXSl7XG5cdFx0XHRcdFx0XHRjb25maWcuYm90Q2FsYyA9IENvbHVtbkNhbGNzLmNhbGN1bGF0aW9uc1tkZWYuYm90dG9tQ2FsY107XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIENhbGMgRXJyb3IgLSBObyBzdWNoIGNhbGN1bGF0aW9uIGZvdW5kLCBpZ25vcmluZzogXCIsIGRlZi5ib3R0b21DYWxjKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFxuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRjb25maWcuYm90Q2FsYyA9IGRlZi5ib3R0b21DYWxjO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoY29uZmlnLmJvdENhbGMpe1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5jb2x1bW5DYWxjcyA9IGNvbmZpZztcblx0XHRcdFx0dGhpcy5ib3RDYWxjcy5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJncm91cFwiKXtcblx0XHRcdFx0XHR0aGlzLmluaXRpYWxpemVCb3R0b21Sb3coKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0fVxuXHRcblx0Ly9kdW1teSBmdW5jdGlvbnMgdG8gaGFuZGxlIGJlaW5nIG1vY2sgY29sdW1uIG1hbmFnZXJcblx0cmVnaXN0ZXJDb2x1bW5GaWVsZCgpe31cblx0XG5cdHJlbW92ZUNhbGNzKCl7XG5cdFx0dmFyIGNoYW5nZWQgPSBmYWxzZTtcblx0XHRcblx0XHRpZih0aGlzLnRvcEluaXRpYWxpemVkKXtcblx0XHRcdHRoaXMudG9wSW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHRcdHRoaXMudG9wRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMudG9wRWxlbWVudCk7XG5cdFx0XHRjaGFuZ2VkID0gdHJ1ZTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy5ib3RJbml0aWFsaXplZCl7XG5cdFx0XHR0aGlzLmJvdEluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0XHR0aGlzLmZvb3RlclJlbW92ZSh0aGlzLmJvdEVsZW1lbnQpO1xuXHRcdFx0Y2hhbmdlZCA9IHRydWU7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGNoYW5nZWQpe1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkanVzdFRhYmxlU2l6ZSgpO1xuXHRcdH1cblx0fVxuXHRcblx0cmVpbml0aWFsaXplQ2FsY3MoKXtcblx0XHRpZih0aGlzLnRvcENhbGNzLmxlbmd0aCl7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVUb3BSb3coKTtcblx0XHR9XG5cblx0XHRpZih0aGlzLmJvdENhbGNzLmxlbmd0aCl7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVCb3R0b21Sb3coKTtcblx0XHR9XG5cdH1cblx0XG5cdGluaXRpYWxpemVUb3BSb3coKXtcblx0XHR2YXJcdGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXHRcdFxuXHRcdGlmKCF0aGlzLnRvcEluaXRpYWxpemVkKXtcblxuXHRcdFx0ZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJyXCIpKTtcblx0XHRcdGZyYWdtZW50LmFwcGVuZENoaWxkKHRoaXMudG9wRWxlbWVudCk7XG5cblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb250ZW50c0VsZW1lbnQoKS5pbnNlcnRCZWZvcmUoZnJhZ21lbnQsIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5oZWFkZXJzRWxlbWVudC5uZXh0U2libGluZyk7XG5cdFx0XHR0aGlzLnRvcEluaXRpYWxpemVkID0gdHJ1ZTtcblx0XHR9XG5cdH1cblx0XG5cdGluaXRpYWxpemVCb3R0b21Sb3coKXtcblx0XHRpZighdGhpcy5ib3RJbml0aWFsaXplZCl7XG5cdFx0XHR0aGlzLmZvb3RlclByZXBlbmQodGhpcy5ib3RFbGVtZW50KTtcblx0XHRcdHRoaXMuYm90SW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdH1cblx0fVxuXHRcblx0c2Nyb2xsSG9yaXpvbnRhbChsZWZ0KXtcblx0XHRpZih0aGlzLmJvdEluaXRpYWxpemVkICYmIHRoaXMuYm90Um93KXtcblx0XHRcdHRoaXMuYm90RWxlbWVudC5zY3JvbGxMZWZ0ID0gbGVmdDtcblx0XHR9XG5cdH1cblx0XG5cdHJlY2FsYyhyb3dzKXtcblx0XHR2YXIgZGF0YSwgcm93O1xuXHRcdFxuXHRcdGlmKCF0aGlzLmJsb2NrQ2hlY2soKSl7XG5cdFx0XHRpZih0aGlzLnRvcEluaXRpYWxpemVkIHx8IHRoaXMuYm90SW5pdGlhbGl6ZWQpe1xuXHRcdFx0XHRkYXRhID0gdGhpcy5yb3dzVG9EYXRhKHJvd3MpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYodGhpcy50b3BJbml0aWFsaXplZCl7XG5cdFx0XHRcdFx0aWYodGhpcy50b3BSb3cpe1xuXHRcdFx0XHRcdFx0dGhpcy50b3BSb3cuZGVsZXRlQ2VsbHMoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cm93ID0gdGhpcy5nZW5lcmF0ZVJvdyhcInRvcFwiLCBkYXRhKTtcblx0XHRcdFx0XHR0aGlzLnRvcFJvdyA9IHJvdztcblx0XHRcdFx0XHR3aGlsZSh0aGlzLnRvcEVsZW1lbnQuZmlyc3RDaGlsZCkgdGhpcy50b3BFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMudG9wRWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcdFx0XHR0aGlzLnRvcEVsZW1lbnQuYXBwZW5kQ2hpbGQocm93LmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdFx0cm93LmluaXRpYWxpemUodHJ1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMuYm90SW5pdGlhbGl6ZWQpe1xuXHRcdFx0XHRcdGlmKHRoaXMuYm90Um93KXtcblx0XHRcdFx0XHRcdHRoaXMuYm90Um93LmRlbGV0ZUNlbGxzKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHJvdyA9IHRoaXMuZ2VuZXJhdGVSb3coXCJib3R0b21cIiwgZGF0YSk7XG5cdFx0XHRcdFx0dGhpcy5ib3RSb3cgPSByb3c7XG5cdFx0XHRcdFx0d2hpbGUodGhpcy5ib3RFbGVtZW50LmZpcnN0Q2hpbGQpIHRoaXMuYm90RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmJvdEVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHRcdFx0dGhpcy5ib3RFbGVtZW50LmFwcGVuZENoaWxkKHJvdy5nZXRFbGVtZW50KCkpO1xuXHRcdFx0XHRcdHJvdy5pbml0aWFsaXplKHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cdFx0XHRcdFxuXHRcdFx0XHQvL3NldCByZXNpemFibGUgaGFuZGxlc1xuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpe1xuXHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLmxheW91dCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRyZWNhbGNSb3dHcm91cChyb3cpe1xuXHRcdHRoaXMucmVjYWxjR3JvdXAodGhpcy50YWJsZS5tb2R1bGVzLmdyb3VwUm93cy5nZXRSb3dHcm91cChyb3cpKTtcblx0fVxuXHRcblx0cmVjYWxjQWxsKCl7XG5cdFx0aWYodGhpcy50b3BDYWxjcy5sZW5ndGggfHwgdGhpcy5ib3RDYWxjcy5sZW5ndGgpe1xuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9PSBcImdyb3VwXCIpe1xuXHRcdFx0XHR0aGlzLnJlY2FsY0FjdGl2ZVJvd3MoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgdGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9PSBcInRhYmxlXCIpe1xuXHRcdFx0XHRcblx0XHRcdFx0dmFyIGdyb3VwcyA9IHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MuZ2V0Q2hpbGRHcm91cHMoKTtcblx0XHRcdFx0XG5cdFx0XHRcdGdyb3Vwcy5mb3JFYWNoKChncm91cCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucmVjYWxjR3JvdXAoZ3JvdXApO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdHJlY2FsY0dyb3VwKGdyb3VwKXtcblx0XHR2YXIgZGF0YSwgcm93RGF0YTtcblx0XHRcblx0XHRpZighdGhpcy5ibG9ja0NoZWNrKCkpe1xuXHRcdFx0aWYoZ3JvdXApe1xuXHRcdFx0XHRpZihncm91cC5jYWxjcyl7XG5cdFx0XHRcdFx0aWYoZ3JvdXAuY2FsY3MuYm90dG9tKXtcblx0XHRcdFx0XHRcdGRhdGEgPSB0aGlzLnJvd3NUb0RhdGEoZ3JvdXAucm93cyk7XG5cdFx0XHRcdFx0XHRyb3dEYXRhID0gdGhpcy5nZW5lcmF0ZVJvd0RhdGEoXCJib3R0b21cIiwgZGF0YSk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGdyb3VwLmNhbGNzLmJvdHRvbS51cGRhdGVEYXRhKHJvd0RhdGEpO1xuXHRcdFx0XHRcdFx0Z3JvdXAuY2FsY3MuYm90dG9tLnJlaW5pdGlhbGl6ZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZihncm91cC5jYWxjcy50b3Ape1xuXHRcdFx0XHRcdFx0ZGF0YSA9IHRoaXMucm93c1RvRGF0YShncm91cC5yb3dzKTtcblx0XHRcdFx0XHRcdHJvd0RhdGEgPSB0aGlzLmdlbmVyYXRlUm93RGF0YShcInRvcFwiLCBkYXRhKTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0Z3JvdXAuY2FsY3MudG9wLnVwZGF0ZURhdGEocm93RGF0YSk7XG5cdFx0XHRcdFx0XHRncm91cC5jYWxjcy50b3AucmVpbml0aWFsaXplKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHQvL2dlbmVyYXRlIHRvcCBzdGF0cyByb3dcblx0Z2VuZXJhdGVUb3BSb3cocm93cyl7XG5cdFx0cmV0dXJuIHRoaXMuZ2VuZXJhdGVSb3coXCJ0b3BcIiwgdGhpcy5yb3dzVG9EYXRhKHJvd3MpKTtcblx0fVxuXHQvL2dlbmVyYXRlIGJvdHRvbSBzdGF0cyByb3dcblx0Z2VuZXJhdGVCb3R0b21Sb3cocm93cyl7XG5cdFx0cmV0dXJuIHRoaXMuZ2VuZXJhdGVSb3coXCJib3R0b21cIiwgdGhpcy5yb3dzVG9EYXRhKHJvd3MpKTtcblx0fVxuXHRcblx0cm93c1RvRGF0YShyb3dzKXtcblx0XHR2YXIgZGF0YSA9IFtdLFxuXHRcdGhhc0RhdGFUcmVlQ29sdW1uQ2FsY3MgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWUgJiYgdGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlQ2hpbGRDb2x1bW5DYWxjcyxcblx0XHRkYXRhVHJlZSA9IHRoaXMudGFibGUubW9kdWxlcy5kYXRhVHJlZTtcblxuXHRcdHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRkYXRhLnB1c2gocm93LmdldERhdGEoKSk7XG5cblx0XHRcdGlmKGhhc0RhdGFUcmVlQ29sdW1uQ2FsY3MgJiYgcm93Lm1vZHVsZXMuZGF0YVRyZWU/Lm9wZW4pe1xuXHRcdFx0XHR0aGlzLnJvd3NUb0RhdGEoZGF0YVRyZWUuZ2V0RmlsdGVyZWRUcmVlQ2hpbGRyZW4ocm93KSkuZm9yRWFjaChkYXRhUm93ID0+e1xuXHRcdFx0XHRcdGRhdGEucHVzaChyb3cpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRyZXR1cm4gZGF0YTtcblx0fVxuXHRcblx0Ly9nZW5lcmF0ZSBzdGF0cyByb3dcblx0Z2VuZXJhdGVSb3cocG9zLCBkYXRhKXtcblx0XHR2YXIgcm93RGF0YSA9IHRoaXMuZ2VuZXJhdGVSb3dEYXRhKHBvcywgZGF0YSksXG5cdFx0cm93O1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUubW9kRXhpc3RzKFwibXV0YXRvclwiKSl7XG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMubXV0YXRvci5kaXNhYmxlKCk7XG5cdFx0fVxuXHRcdFxuXHRcdHJvdyA9IG5ldyBSb3cocm93RGF0YSwgdGhpcywgXCJjYWxjXCIpO1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUubW9kRXhpc3RzKFwibXV0YXRvclwiKSl7XG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMubXV0YXRvci5lbmFibGUoKTtcblx0XHR9XG5cdFx0XG5cdFx0cm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNhbGNzXCIsIFwidGFidWxhdG9yLWNhbGNzLVwiICsgcG9zKTtcblx0XHRcblx0XHRyb3cuY29tcG9uZW50ID0gZmFsc2U7XG5cdFx0XG5cdFx0cm93LmdldENvbXBvbmVudCA9ICgpID0+IHtcblx0XHRcdGlmKCFyb3cuY29tcG9uZW50KXtcblx0XHRcdFx0cm93LmNvbXBvbmVudCA9IG5ldyBDYWxjQ29tcG9uZW50KHJvdyk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHJldHVybiByb3cuY29tcG9uZW50O1xuXHRcdH07XG5cdFx0XG5cdFx0cm93LmdlbmVyYXRlQ2VsbHMgPSAoKSA9PiB7XG5cdFx0XHRcblx0XHRcdHZhciBjZWxscyA9IFtdO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaCgoY29sdW1uKSA9PiB7XG5cdFx0XHRcdFxuXHRcdFx0XHQvL3NldCBmaWVsZCBuYW1lIG9mIG1vY2sgY29sdW1uXG5cdFx0XHRcdHRoaXMuZ2VuQ29sdW1uLnNldEZpZWxkKGNvbHVtbi5nZXRGaWVsZCgpKTtcblx0XHRcdFx0dGhpcy5nZW5Db2x1bW4uaG96QWxpZ24gPSBjb2x1bW4uaG96QWxpZ247XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihjb2x1bW4uZGVmaW5pdGlvbltwb3MgKyBcIkNhbGNGb3JtYXR0ZXJcIl0gJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmb3JtYXRcIikpe1xuXHRcdFx0XHRcdHRoaXMuZ2VuQ29sdW1uLm1vZHVsZXMuZm9ybWF0ID0ge1xuXHRcdFx0XHRcdFx0Zm9ybWF0dGVyOiB0aGlzLnRhYmxlLm1vZHVsZXMuZm9ybWF0Lmxvb2t1cEZvcm1hdHRlcihjb2x1bW4uZGVmaW5pdGlvbltwb3MgKyBcIkNhbGNGb3JtYXR0ZXJcIl0pLFxuXHRcdFx0XHRcdFx0cGFyYW1zOiBjb2x1bW4uZGVmaW5pdGlvbltwb3MgKyBcIkNhbGNGb3JtYXR0ZXJQYXJhbXNcIl0gfHwge30sXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuZ2VuQ29sdW1uLm1vZHVsZXMuZm9ybWF0ID0ge1xuXHRcdFx0XHRcdFx0Zm9ybWF0dGVyOiB0aGlzLnRhYmxlLm1vZHVsZXMuZm9ybWF0Lmxvb2t1cEZvcm1hdHRlcihcInBsYWludGV4dFwiKSxcblx0XHRcdFx0XHRcdHBhcmFtczp7fVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdC8vZW5zdXJlIGNzcyBjbGFzcyBkZWZpbml0aW9uIGlzIHJlcGxpY2F0ZWQgdG8gY2FsY3VsYXRpb24gY2VsbFxuXHRcdFx0XHR0aGlzLmdlbkNvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzID0gY29sdW1uLmRlZmluaXRpb24uY3NzQ2xhc3M7XG5cdFx0XHRcdFxuXHRcdFx0XHQvL2dlbmVyYXRlIGNlbGwgYW5kIGFzc2lnbiB0byBjb3JyZWN0IGNvbHVtblxuXHRcdFx0XHR2YXIgY2VsbCA9IG5ldyBDZWxsKHRoaXMuZ2VuQ29sdW1uLCByb3cpO1xuXHRcdFx0XHRjZWxsLmdldEVsZW1lbnQoKTtcblx0XHRcdFx0Y2VsbC5jb2x1bW4gPSBjb2x1bW47XG5cdFx0XHRcdGNlbGwuc2V0V2lkdGgoKTtcblx0XHRcdFx0XG5cdFx0XHRcdGNvbHVtbi5jZWxscy5wdXNoKGNlbGwpO1xuXHRcdFx0XHRjZWxscy5wdXNoKGNlbGwpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoIWNvbHVtbi52aXNpYmxlKXtcblx0XHRcdFx0XHRjZWxsLmhpZGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHJvdy5jZWxscyA9IGNlbGxzO1xuXHRcdH07XG5cdFx0XG5cdFx0cmV0dXJuIHJvdztcblx0fVxuXHRcblx0Ly9nZW5lcmF0ZSBzdGF0cyByb3dcblx0Z2VuZXJhdGVSb3dEYXRhKHBvcywgZGF0YSl7XG5cdFx0dmFyIHJvd0RhdGEgPSB7fSxcblx0XHRjYWxjcyA9IHBvcyA9PSBcInRvcFwiID8gdGhpcy50b3BDYWxjcyA6IHRoaXMuYm90Q2FsY3MsXG5cdFx0dHlwZSA9IHBvcyA9PSBcInRvcFwiID8gXCJ0b3BDYWxjXCIgOiBcImJvdENhbGNcIixcblx0XHRwYXJhbXMsIHBhcmFtS2V5O1xuXHRcdFxuXHRcdGNhbGNzLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdHZhciB2YWx1ZXMgPSBbXTtcblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uLm1vZHVsZXMuY29sdW1uQ2FsY3MgJiYgY29sdW1uLm1vZHVsZXMuY29sdW1uQ2FsY3NbdHlwZV0pe1xuXHRcdFx0XHRkYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG5cdFx0XHRcdFx0dmFsdWVzLnB1c2goY29sdW1uLmdldEZpZWxkVmFsdWUoaXRlbSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdHBhcmFtS2V5ID0gdHlwZSArIFwiUGFyYW1zXCI7XG5cdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBjb2x1bW4ubW9kdWxlcy5jb2x1bW5DYWxjc1twYXJhbUtleV0gPT09IFwiZnVuY3Rpb25cIiA/IGNvbHVtbi5tb2R1bGVzLmNvbHVtbkNhbGNzW3BhcmFtS2V5XSh2YWx1ZXMsIGRhdGEpIDogY29sdW1uLm1vZHVsZXMuY29sdW1uQ2FsY3NbcGFyYW1LZXldO1xuXHRcdFx0XHRcblx0XHRcdFx0Y29sdW1uLnNldEZpZWxkVmFsdWUocm93RGF0YSwgY29sdW1uLm1vZHVsZXMuY29sdW1uQ2FsY3NbdHlwZV0odmFsdWVzLCBkYXRhLCBwYXJhbXMpKTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gcm93RGF0YTtcblx0fVxuXHRcblx0aGFzVG9wQ2FsY3MoKXtcblx0XHRyZXR1cm5cdCEhKHRoaXMudG9wQ2FsY3MubGVuZ3RoKTtcblx0fVxuXHRcblx0aGFzQm90dG9tQ2FsY3MoKXtcblx0XHRyZXR1cm5cdCEhKHRoaXMuYm90Q2FsY3MubGVuZ3RoKTtcblx0fVxuXHRcblx0Ly9oYW5kbGUgdGFibGUgcmVkcmF3XG5cdHJlZHJhdygpe1xuXHRcdGlmKHRoaXMudG9wUm93KXtcblx0XHRcdHRoaXMudG9wUm93Lm5vcm1hbGl6ZUhlaWdodCh0cnVlKTtcblx0XHR9XG5cdFx0aWYodGhpcy5ib3RSb3cpe1xuXHRcdFx0dGhpcy5ib3RSb3cubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9yZXR1cm4gdGhlIGNhbGN1bGF0ZWRcblx0Z2V0UmVzdWx0cygpe1xuXHRcdHZhciByZXN1bHRzID0ge30sXG5cdFx0Z3JvdXBzO1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKXtcblx0XHRcdGdyb3VwcyA9IHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MuZ2V0R3JvdXBzKHRydWUpO1xuXHRcdFx0XG5cdFx0XHRncm91cHMuZm9yRWFjaCgoZ3JvdXApID0+IHtcblx0XHRcdFx0cmVzdWx0c1tncm91cC5nZXRLZXkoKV0gPSB0aGlzLmdldEdyb3VwUmVzdWx0cyhncm91cCk7XG5cdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRyZXN1bHRzID0ge1xuXHRcdFx0XHR0b3A6IHRoaXMudG9wUm93ID8gdGhpcy50b3BSb3cuZ2V0RGF0YSgpIDoge30sXG5cdFx0XHRcdGJvdHRvbTogdGhpcy5ib3RSb3cgPyB0aGlzLmJvdFJvdy5nZXREYXRhKCkgOiB7fSxcblx0XHRcdH07XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiByZXN1bHRzO1xuXHR9XG5cdFxuXHQvL2dldCByZXN1bHRzIGZyb20gYSBncm91cFxuXHRnZXRHcm91cFJlc3VsdHMoZ3JvdXApe1xuXHRcdHZhciBncm91cE9iaiA9IGdyb3VwLl9nZXRTZWxmKCksXG5cdFx0c3ViR3JvdXBzID0gZ3JvdXAuZ2V0U3ViR3JvdXBzKCksXG5cdFx0c3ViR3JvdXBSZXN1bHRzID0ge30sXG5cdFx0cmVzdWx0cyA9IHt9O1xuXHRcdFxuXHRcdHN1Ykdyb3Vwcy5mb3JFYWNoKChzdWJncm91cCkgPT4ge1xuXHRcdFx0c3ViR3JvdXBSZXN1bHRzW3N1Ymdyb3VwLmdldEtleSgpXSA9IHRoaXMuZ2V0R3JvdXBSZXN1bHRzKHN1Ymdyb3VwKTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXN1bHRzID0ge1xuXHRcdFx0dG9wOiBncm91cE9iai5jYWxjcy50b3AgPyBncm91cE9iai5jYWxjcy50b3AuZ2V0RGF0YSgpIDoge30sXG5cdFx0XHRib3R0b206IGdyb3VwT2JqLmNhbGNzLmJvdHRvbSA/IGdyb3VwT2JqLmNhbGNzLmJvdHRvbS5nZXREYXRhKCkgOiB7fSxcblx0XHRcdGdyb3Vwczogc3ViR3JvdXBSZXN1bHRzLFxuXHRcdH07XG5cdFx0XG5cdFx0cmV0dXJuIHJlc3VsdHM7XG5cdH1cblx0XG5cdGFkanVzdEZvclNjcm9sbGJhcih3aWR0aCl7XG5cdFx0aWYodGhpcy5ib3RSb3cpe1xuXHRcdFx0aWYodGhpcy50YWJsZS5ydGwpe1xuXHRcdFx0XHR0aGlzLmJvdEVsZW1lbnQuc3R5bGUucGFkZGluZ0xlZnQgPSB3aWR0aCArIFwicHhcIjtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5ib3RFbGVtZW50LnN0eWxlLnBhZGRpbmdSaWdodCA9IHdpZHRoICsgXCJweFwiO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG5jbGFzcyBEYXRhVHJlZSBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwiZGF0YVRyZWVcIjtcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy5pbmRlbnQgPSAxMDtcblx0XHR0aGlzLmZpZWxkID0gXCJcIjtcblx0XHR0aGlzLmNvbGxhcHNlRWwgPSBudWxsO1xuXHRcdHRoaXMuZXhwYW5kRWwgPSBudWxsO1xuXHRcdHRoaXMuYnJhbmNoRWwgPSBudWxsO1xuXHRcdHRoaXMuZWxlbWVudEZpZWxkID0gZmFsc2U7XG5cblx0XHR0aGlzLnN0YXJ0T3BlbiA9IGZ1bmN0aW9uKCl7fTtcblxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImRhdGFUcmVlXCIsIGZhbHNlKTsgLy9lbmFibGUgZGF0YSB0cmVlXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZGF0YVRyZWVGaWx0ZXJcIiwgdHJ1ZSk7IC8vZmlsdGVyIGNoaWxkIHJvd3Ncblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJkYXRhVHJlZVNvcnRcIiwgdHJ1ZSk7IC8vc29ydCBjaGlsZCByb3dzXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZGF0YVRyZWVFbGVtZW50Q29sdW1uXCIsIGZhbHNlKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJkYXRhVHJlZUJyYW5jaEVsZW1lbnRcIiwgdHJ1ZSk7Ly9zaG93IGRhdGEgdHJlZSBicmFuY2ggZWxlbWVudFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImRhdGFUcmVlQ2hpbGRJbmRlbnRcIiwgOSk7IC8vZGF0YSB0cmVlIGNoaWxkIGluZGVudCBpbiBweFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImRhdGFUcmVlQ2hpbGRGaWVsZFwiLCBcIl9jaGlsZHJlblwiKTsvL2RhdGEgdHJlIGNvbHVtbiBmaWVsZCB0byBsb29rIGZvciBjaGlsZCByb3dzXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZGF0YVRyZWVDb2xsYXBzZUVsZW1lbnRcIiwgZmFsc2UpOy8vZGF0YSB0cmVlIHJvdyBjb2xsYXBzZSBlbGVtZW50XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZGF0YVRyZWVFeHBhbmRFbGVtZW50XCIsIGZhbHNlKTsvL2RhdGEgdHJlZSByb3cgZXhwYW5kIGVsZW1lbnRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJkYXRhVHJlZVN0YXJ0RXhwYW5kZWRcIiwgZmFsc2UpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImRhdGFUcmVlQ2hpbGRDb2x1bW5DYWxjc1wiLCBmYWxzZSk7Ly9pbmNsdWRlIHZpc2libGUgZGF0YSB0cmVlIHJvd3MgaW4gY29sdW1uIGNhbGN1bGF0aW9uc1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImRhdGFUcmVlU2VsZWN0UHJvcGFnYXRlXCIsIGZhbHNlKTsvL3NlbGVjdGluZyBhIHBhcmVudCByb3cgc2VsZWN0cyBpdHMgY2hpbGRyZW5cblxuXHRcdC8vcmVnaXN0ZXIgY29tcG9uZW50IGZ1bmN0aW9uc1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcInJvd1wiLCBcInRyZWVDb2xsYXBzZVwiLCB0aGlzLmNvbGxhcHNlUm93LmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcInJvd1wiLCBcInRyZWVFeHBhbmRcIiwgdGhpcy5leHBhbmRSb3cuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwicm93XCIsIFwidHJlZVRvZ2dsZVwiLCB0aGlzLnRvZ2dsZVJvdy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJyb3dcIiwgXCJnZXRUcmVlUGFyZW50XCIsIHRoaXMuZ2V0VHJlZVBhcmVudC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJyb3dcIiwgXCJnZXRUcmVlQ2hpbGRyZW5cIiwgdGhpcy5nZXRSb3dDaGlsZHJlbi5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJyb3dcIiwgXCJhZGRUcmVlQ2hpbGRcIiwgdGhpcy5hZGRUcmVlQ2hpbGRSb3cuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwicm93XCIsIFwiaXNUcmVlRXhwYW5kZWRcIiwgdGhpcy5pc1Jvd0V4cGFuZGVkLmJpbmQodGhpcykpO1xuXHR9XG5cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5kYXRhVHJlZSl7XG5cdFx0XHR2YXIgZHVtbXlFbCA9IG51bGwsXG5cdFx0XHRvcHRpb25zID0gdGhpcy50YWJsZS5vcHRpb25zO1xuXG5cdFx0XHR0aGlzLmZpZWxkID0gb3B0aW9ucy5kYXRhVHJlZUNoaWxkRmllbGQ7XG5cdFx0XHR0aGlzLmluZGVudCA9IG9wdGlvbnMuZGF0YVRyZWVDaGlsZEluZGVudDtcblxuXHRcdFx0aWYodGhpcy5vcHRpb25zKFwibW92YWJsZVJvd3NcIikpe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJUaGUgbW92YWJsZVJvd3Mgb3B0aW9uIGlzIG5vdCBhdmFpbGFibGUgd2l0aCBkYXRhVHJlZSBlbmFibGVkLCBtb3Zpbmcgb2YgY2hpbGQgcm93cyBjb3VsZCByZXN1bHQgaW4gdW5wcmVkaWN0YWJsZSBiZWhhdmlvclwiKTtcblx0XHRcdH1cblxuXHRcdFx0aWYob3B0aW9ucy5kYXRhVHJlZUJyYW5jaEVsZW1lbnQpe1xuXG5cdFx0XHRcdGlmKG9wdGlvbnMuZGF0YVRyZWVCcmFuY2hFbGVtZW50ID09PSB0cnVlKXtcblx0XHRcdFx0XHR0aGlzLmJyYW5jaEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0XHR0aGlzLmJyYW5jaEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZGF0YS10cmVlLWJyYW5jaFwiKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGlmKHR5cGVvZiBvcHRpb25zLmRhdGFUcmVlQnJhbmNoRWxlbWVudCA9PT0gXCJzdHJpbmdcIil7XG5cdFx0XHRcdFx0XHRkdW1teUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0XHRcdGR1bW15RWwuaW5uZXJIVE1MID0gb3B0aW9ucy5kYXRhVHJlZUJyYW5jaEVsZW1lbnQ7XG5cdFx0XHRcdFx0XHR0aGlzLmJyYW5jaEVsID0gZHVtbXlFbC5maXJzdENoaWxkO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdHRoaXMuYnJhbmNoRWwgPSBvcHRpb25zLmRhdGFUcmVlQnJhbmNoRWxlbWVudDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5icmFuY2hFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRcdHRoaXMuYnJhbmNoRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1kYXRhLXRyZWUtYnJhbmNoLWVtcHR5XCIpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihvcHRpb25zLmRhdGFUcmVlQ29sbGFwc2VFbGVtZW50KXtcblx0XHRcdFx0aWYodHlwZW9mIG9wdGlvbnMuZGF0YVRyZWVDb2xsYXBzZUVsZW1lbnQgPT09IFwic3RyaW5nXCIpe1xuXHRcdFx0XHRcdGR1bW15RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdGR1bW15RWwuaW5uZXJIVE1MID0gb3B0aW9ucy5kYXRhVHJlZUNvbGxhcHNlRWxlbWVudDtcblx0XHRcdFx0XHR0aGlzLmNvbGxhcHNlRWwgPSBkdW1teUVsLmZpcnN0Q2hpbGQ7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR0aGlzLmNvbGxhcHNlRWwgPSBvcHRpb25zLmRhdGFUcmVlQ29sbGFwc2VFbGVtZW50O1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sXCIpO1xuXHRcdFx0XHR0aGlzLmNvbGxhcHNlRWwudGFiSW5kZXggPSAwO1xuXHRcdFx0XHR0aGlzLmNvbGxhcHNlRWwuaW5uZXJIVE1MID0gXCI8ZGl2IGNsYXNzPSd0YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2wtY29sbGFwc2UnPjwvZGl2PlwiO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihvcHRpb25zLmRhdGFUcmVlRXhwYW5kRWxlbWVudCl7XG5cdFx0XHRcdGlmKHR5cGVvZiBvcHRpb25zLmRhdGFUcmVlRXhwYW5kRWxlbWVudCA9PT0gXCJzdHJpbmdcIil7XG5cdFx0XHRcdFx0ZHVtbXlFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRcdFx0ZHVtbXlFbC5pbm5lckhUTUwgPSBvcHRpb25zLmRhdGFUcmVlRXhwYW5kRWxlbWVudDtcblx0XHRcdFx0XHR0aGlzLmV4cGFuZEVsID0gZHVtbXlFbC5maXJzdENoaWxkO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5leHBhbmRFbCA9IG9wdGlvbnMuZGF0YVRyZWVFeHBhbmRFbGVtZW50O1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuZXhwYW5kRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHR0aGlzLmV4cGFuZEVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZGF0YS10cmVlLWNvbnRyb2xcIik7XG5cdFx0XHRcdHRoaXMuZXhwYW5kRWwudGFiSW5kZXggPSAwO1xuXHRcdFx0XHR0aGlzLmV4cGFuZEVsLmlubmVySFRNTCA9IFwiPGRpdiBjbGFzcz0ndGFidWxhdG9yLWRhdGEtdHJlZS1jb250cm9sLWV4cGFuZCc+PC9kaXY+XCI7XG5cdFx0XHR9XG5cblxuXHRcdFx0c3dpdGNoKHR5cGVvZiBvcHRpb25zLmRhdGFUcmVlU3RhcnRFeHBhbmRlZCl7XG5cdFx0XHRcdGNhc2UgXCJib29sZWFuXCI6XG5cdFx0XHRcdFx0dGhpcy5zdGFydE9wZW4gPSBmdW5jdGlvbihyb3csIGluZGV4KXtcblx0XHRcdFx0XHRcdHJldHVybiBvcHRpb25zLmRhdGFUcmVlU3RhcnRFeHBhbmRlZDtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRcdHRoaXMuc3RhcnRPcGVuID0gb3B0aW9ucy5kYXRhVHJlZVN0YXJ0RXhwYW5kZWQ7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHR0aGlzLnN0YXJ0T3BlbiA9IGZ1bmN0aW9uKHJvdywgaW5kZXgpe1xuXHRcdFx0XHRcdFx0cmV0dXJuIG9wdGlvbnMuZGF0YVRyZWVTdGFydEV4cGFuZGVkW2luZGV4XTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1pbml0XCIsIHRoaXMuaW5pdGlhbGl6ZVJvdy5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWxheW91dC1hZnRlclwiLCB0aGlzLmxheW91dFJvdy5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWRlbGV0aW5nXCIsIHRoaXMucm93RGVsZXRpbmcuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1kZWxldGVkXCIsIHRoaXMucm93RGVsZXRlLmJpbmQodGhpcyksMCk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1kYXRhLWNoYW5nZWRcIiwgdGhpcy5yb3dEYXRhQ2hhbmdlZC5iaW5kKHRoaXMpLCAxMCk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtdmFsdWUtdXBkYXRlZFwiLCB0aGlzLmNlbGxWYWx1ZUNoYW5nZWQuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImVkaXQtY2FuY2VsbGVkXCIsIHRoaXMuY2VsbFZhbHVlQ2hhbmdlZC5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLW1vdmluZy1yb3dzXCIsIHRoaXMuY29sdW1uTW92aW5nLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJ0YWJsZS1idWlsdFwiLCB0aGlzLmluaXRpYWxpemVFbGVtZW50RmllbGQuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLXJlZHJhd2luZ1wiLCB0aGlzLnRhYmxlUmVkcmF3aW5nLmJpbmQodGhpcykpO1xuXG5cdFx0XHR0aGlzLnJlZ2lzdGVyRGlzcGxheUhhbmRsZXIodGhpcy5nZXRSb3dzLmJpbmQodGhpcyksIDMwKTtcblx0XHR9XG5cdH1cblxuXHR0YWJsZVJlZHJhd2luZyhmb3JjZSl7XG5cdFx0dmFyIHJvd3M7XG5cblx0XHRpZihmb3JjZSl7XG5cdFx0XHRyb3dzID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFJvd3MoKTtcblx0XHRcdFxuXHRcdFx0cm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0dGhpcy5yZWluaXRpYWxpemVSb3dDaGlsZHJlbihyb3cpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0aW5pdGlhbGl6ZUVsZW1lbnRGaWVsZCgpe1xuXHRcdHZhciBmaXJzdENvbCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRGaXJzdFZpc2libGVDb2x1bW4oKTtcblxuXHRcdHRoaXMuZWxlbWVudEZpZWxkID0gdGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlRWxlbWVudENvbHVtbiB8fCAoZmlyc3RDb2wgPyBmaXJzdENvbC5maWVsZCA6IGZhbHNlKTtcblx0fVxuXHRcblx0Z2V0Um93Q2hpbGRyZW4ocm93KXtcblx0XHRyZXR1cm4gdGhpcy5nZXRUcmVlQ2hpbGRyZW4ocm93LCB0cnVlKTtcblx0fVxuXG5cdGNvbHVtbk1vdmluZygpe1xuXHRcdHZhciByb3dzID0gW107XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdHJvd3MgPSByb3dzLmNvbmNhdCh0aGlzLmdldFRyZWVDaGlsZHJlbihyb3csIGZhbHNlLCB0cnVlKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcm93cztcblx0fVxuXG5cdHJvd0RhdGFDaGFuZ2VkKHJvdywgdmlzaWJsZSwgdXBkYXRlZERhdGEpe1xuXHRcdGlmKHRoaXMucmVkcmF3TmVlZGVkKHVwZGF0ZWREYXRhKSl7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVSb3cocm93KTtcblxuXHRcdFx0aWYodmlzaWJsZSl7XG5cdFx0XHRcdHRoaXMubGF5b3V0Um93KHJvdyk7XG5cdFx0XHRcdHRoaXMucmVmcmVzaERhdGEodHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Y2VsbFZhbHVlQ2hhbmdlZChjZWxsKXtcblx0XHR2YXIgZmllbGQgPSBjZWxsLmNvbHVtbi5nZXRGaWVsZCgpO1xuXG5cdFx0aWYoZmllbGQgPT09IHRoaXMuZWxlbWVudEZpZWxkKXtcblx0XHRcdHRoaXMubGF5b3V0Um93KGNlbGwucm93KTtcblx0XHR9XG5cdH1cblxuXHRpbml0aWFsaXplUm93KHJvdyl7XG5cdFx0dmFyIGNoaWxkQXJyYXkgPSByb3cuZ2V0RGF0YSgpW3RoaXMuZmllbGRdO1xuXHRcdHZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheShjaGlsZEFycmF5KTtcblxuXHRcdHZhciBjaGlsZHJlbiA9IGlzQXJyYXkgfHwgKCFpc0FycmF5ICYmIHR5cGVvZiBjaGlsZEFycmF5ID09PSBcIm9iamVjdFwiICYmIGNoaWxkQXJyYXkgIT09IG51bGwpO1xuXG5cdFx0aWYoIWNoaWxkcmVuICYmIHJvdy5tb2R1bGVzLmRhdGFUcmVlICYmIHJvdy5tb2R1bGVzLmRhdGFUcmVlLmJyYW5jaEVsKXtcblx0XHRcdHJvdy5tb2R1bGVzLmRhdGFUcmVlLmJyYW5jaEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocm93Lm1vZHVsZXMuZGF0YVRyZWUuYnJhbmNoRWwpO1xuXHRcdH1cblxuXHRcdGlmKCFjaGlsZHJlbiAmJiByb3cubW9kdWxlcy5kYXRhVHJlZSAmJiByb3cubW9kdWxlcy5kYXRhVHJlZS5jb250cm9sRWwpe1xuXHRcdFx0cm93Lm1vZHVsZXMuZGF0YVRyZWUuY29udHJvbEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocm93Lm1vZHVsZXMuZGF0YVRyZWUuY29udHJvbEVsKTtcblx0XHR9XG5cblx0XHRyb3cubW9kdWxlcy5kYXRhVHJlZSA9IHtcblx0XHRcdGluZGV4OiByb3cubW9kdWxlcy5kYXRhVHJlZSA/IHJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4IDogMCxcblx0XHRcdG9wZW46IGNoaWxkcmVuID8gKHJvdy5tb2R1bGVzLmRhdGFUcmVlID8gcm93Lm1vZHVsZXMuZGF0YVRyZWUub3BlbiA6IHRoaXMuc3RhcnRPcGVuKHJvdy5nZXRDb21wb25lbnQoKSwgMCkpIDogZmFsc2UsXG5cdFx0XHRjb250cm9sRWw6IHJvdy5tb2R1bGVzLmRhdGFUcmVlICYmIGNoaWxkcmVuID8gcm93Lm1vZHVsZXMuZGF0YVRyZWUuY29udHJvbEVsIDogZmFsc2UsXG5cdFx0XHRicmFuY2hFbDogcm93Lm1vZHVsZXMuZGF0YVRyZWUgJiYgY2hpbGRyZW4gPyByb3cubW9kdWxlcy5kYXRhVHJlZS5icmFuY2hFbCA6IGZhbHNlLFxuXHRcdFx0cGFyZW50OiByb3cubW9kdWxlcy5kYXRhVHJlZSA/IHJvdy5tb2R1bGVzLmRhdGFUcmVlLnBhcmVudCA6IGZhbHNlLFxuXHRcdFx0Y2hpbGRyZW46Y2hpbGRyZW4sXG5cdFx0fTtcblx0fVxuXG5cdHJlaW5pdGlhbGl6ZVJvd0NoaWxkcmVuKHJvdyl7XG5cdFx0dmFyIGNoaWxkcmVuID0gdGhpcy5nZXRUcmVlQ2hpbGRyZW4ocm93LCBmYWxzZSwgdHJ1ZSk7XG5cblx0XHRjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkKXtcblx0XHRcdGNoaWxkLnJlaW5pdGlhbGl6ZSh0cnVlKTtcblx0XHR9KTtcblx0fVxuXG5cdGxheW91dFJvdyhyb3cpe1xuXHRcdHZhciBjZWxsID0gdGhpcy5lbGVtZW50RmllbGQgPyByb3cuZ2V0Q2VsbCh0aGlzLmVsZW1lbnRGaWVsZCkgOiByb3cuZ2V0Q2VsbHMoKVswXSxcblx0XHRlbCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRcdGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlO1xuXG5cdFx0aWYoY29uZmlnLmJyYW5jaEVsKXtcblx0XHRcdGlmKGNvbmZpZy5icmFuY2hFbC5wYXJlbnROb2RlKXtcblx0XHRcdFx0Y29uZmlnLmJyYW5jaEVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY29uZmlnLmJyYW5jaEVsKTtcblx0XHRcdH1cblx0XHRcdGNvbmZpZy5icmFuY2hFbCA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdGlmKGNvbmZpZy5jb250cm9sRWwpe1xuXHRcdFx0aWYoY29uZmlnLmNvbnRyb2xFbC5wYXJlbnROb2RlKXtcblx0XHRcdFx0Y29uZmlnLmNvbnRyb2xFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGNvbmZpZy5jb250cm9sRWwpO1xuXHRcdFx0fVxuXHRcdFx0Y29uZmlnLmNvbnRyb2xFbCA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdHRoaXMuZ2VuZXJhdGVDb250cm9sRWxlbWVudChyb3csIGVsKTtcblxuXHRcdHJvdy5nZXRFbGVtZW50KCkuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci10cmVlLWxldmVsLVwiICsgY29uZmlnLmluZGV4KTtcblxuXHRcdGlmKGNvbmZpZy5pbmRleCl7XG5cdFx0XHRpZih0aGlzLmJyYW5jaEVsKXtcblx0XHRcdFx0Y29uZmlnLmJyYW5jaEVsID0gdGhpcy5icmFuY2hFbC5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0XHRcdGVsLmluc2VydEJlZm9yZShjb25maWcuYnJhbmNoRWwsIGVsLmZpcnN0Q2hpbGQpO1xuXG5cdFx0XHRcdGlmKHRoaXMudGFibGUucnRsKXtcblx0XHRcdFx0XHRjb25maWcuYnJhbmNoRWwuc3R5bGUubWFyZ2luUmlnaHQgPSAoKChjb25maWcuYnJhbmNoRWwub2Zmc2V0V2lkdGggKyBjb25maWcuYnJhbmNoRWwuc3R5bGUubWFyZ2luTGVmdCkgKiAoY29uZmlnLmluZGV4IC0gMSkpICsgKGNvbmZpZy5pbmRleCAqIHRoaXMuaW5kZW50KSkgKyBcInB4XCI7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRjb25maWcuYnJhbmNoRWwuc3R5bGUubWFyZ2luTGVmdCA9ICgoKGNvbmZpZy5icmFuY2hFbC5vZmZzZXRXaWR0aCArIGNvbmZpZy5icmFuY2hFbC5zdHlsZS5tYXJnaW5SaWdodCkgKiAoY29uZmlnLmluZGV4IC0gMSkpICsgKGNvbmZpZy5pbmRleCAqIHRoaXMuaW5kZW50KSkgKyBcInB4XCI7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblxuXHRcdFx0XHRpZih0aGlzLnRhYmxlLnJ0bCl7XG5cdFx0XHRcdFx0ZWwuc3R5bGUucGFkZGluZ1JpZ2h0ID0gcGFyc2VJbnQod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwsIG51bGwpLmdldFByb3BlcnR5VmFsdWUoJ3BhZGRpbmctcmlnaHQnKSkgKyAoY29uZmlnLmluZGV4ICogdGhpcy5pbmRlbnQpICsgXCJweFwiO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0ZWwuc3R5bGUucGFkZGluZ0xlZnQgPSBwYXJzZUludCh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZSgncGFkZGluZy1sZWZ0JykpICsgKGNvbmZpZy5pbmRleCAqIHRoaXMuaW5kZW50KSArIFwicHhcIjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGdlbmVyYXRlQ29udHJvbEVsZW1lbnQocm93LCBlbCl7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLFxuXHRcdG9sZENvbnRyb2wgPSBjb25maWcuY29udHJvbEVsO1xuXG5cdFx0ZWwgPSBlbCB8fCByb3cuZ2V0Q2VsbHMoKVswXS5nZXRFbGVtZW50KCk7XG5cblx0XHRpZihjb25maWcuY2hpbGRyZW4gIT09IGZhbHNlKXtcblxuXHRcdFx0aWYoY29uZmlnLm9wZW4pe1xuXHRcdFx0XHRjb25maWcuY29udHJvbEVsID0gdGhpcy5jb2xsYXBzZUVsLmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdFx0Y29uZmlnLmNvbnRyb2xFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHRoaXMuY29sbGFwc2VSb3cocm93KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbmZpZy5jb250cm9sRWwgPSB0aGlzLmV4cGFuZEVsLmNsb25lTm9kZSh0cnVlKTtcblx0XHRcdFx0Y29uZmlnLmNvbnRyb2xFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdHRoaXMuZXhwYW5kUm93KHJvdyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25maWcuY29udHJvbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpZihvbGRDb250cm9sICYmIG9sZENvbnRyb2wucGFyZW50Tm9kZSA9PT0gZWwpe1xuXHRcdFx0XHRvbGRDb250cm9sLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGNvbmZpZy5jb250cm9sRWwsb2xkQ29udHJvbCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGVsLmluc2VydEJlZm9yZShjb25maWcuY29udHJvbEVsLCBlbC5maXJzdENoaWxkKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRnZXRSb3dzKHJvd3Mpe1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdHJvd3MuZm9yRWFjaCgocm93LCBpKSA9PiB7XG5cdFx0XHR2YXIgY29uZmlnLCBjaGlsZHJlbjtcblxuXHRcdFx0b3V0cHV0LnB1c2gocm93KTtcblxuXHRcdFx0aWYocm93IGluc3RhbmNlb2YgUm93KXtcblxuXHRcdFx0XHRyb3cuY3JlYXRlKCk7XG5cblx0XHRcdFx0Y29uZmlnID0gcm93Lm1vZHVsZXMuZGF0YVRyZWU7XG5cblx0XHRcdFx0aWYoIWNvbmZpZy5pbmRleCAmJiBjb25maWcuY2hpbGRyZW4gIT09IGZhbHNlKXtcblx0XHRcdFx0XHRjaGlsZHJlbiA9IHRoaXMuZ2V0Q2hpbGRyZW4ocm93LCBmYWxzZSwgdHJ1ZSk7XG5cblx0XHRcdFx0XHRjaGlsZHJlbi5mb3JFYWNoKChjaGlsZCkgPT4ge1xuXHRcdFx0XHRcdFx0Y2hpbGQuY3JlYXRlKCk7XG5cdFx0XHRcdFx0XHRvdXRwdXQucHVzaChjaGlsZCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH1cblxuXHRnZXRDaGlsZHJlbihyb3csIGFsbENoaWxkcmVuLCBzb3J0T25seSl7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLFxuXHRcdGNoaWxkcmVuID0gW10sXG5cdFx0b3V0cHV0ID0gW107XG5cblx0XHRpZihjb25maWcuY2hpbGRyZW4gIT09IGZhbHNlICYmIChjb25maWcub3BlbiB8fCBhbGxDaGlsZHJlbikpe1xuXHRcdFx0aWYoIUFycmF5LmlzQXJyYXkoY29uZmlnLmNoaWxkcmVuKSl7XG5cdFx0XHRcdGNvbmZpZy5jaGlsZHJlbiA9IHRoaXMuZ2VuZXJhdGVDaGlsZHJlbihyb3cpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZpbHRlclwiKSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWVGaWx0ZXIpe1xuXHRcdFx0XHRjaGlsZHJlbiA9IHRoaXMudGFibGUubW9kdWxlcy5maWx0ZXIuZmlsdGVyKGNvbmZpZy5jaGlsZHJlbik7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNoaWxkcmVuID0gY29uZmlnLmNoaWxkcmVuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInNvcnRcIikgJiYgdGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlU29ydCl7XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5zb3J0LnNvcnQoY2hpbGRyZW4sIHNvcnRPbmx5KTtcblx0XHRcdH1cblxuXHRcdFx0Y2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpID0+IHtcblx0XHRcdFx0b3V0cHV0LnB1c2goY2hpbGQpO1xuXG5cdFx0XHRcdHZhciBzdWJDaGlsZHJlbiA9IHRoaXMuZ2V0Q2hpbGRyZW4oY2hpbGQsIGZhbHNlLCB0cnVlKTtcblxuXHRcdFx0XHRzdWJDaGlsZHJlbi5mb3JFYWNoKChzdWIpID0+IHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaChzdWIpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH1cblxuXHRnZW5lcmF0ZUNoaWxkcmVuKHJvdyl7XG5cdFx0dmFyIGNoaWxkcmVuID0gW107XG5cblx0XHR2YXIgY2hpbGRBcnJheSA9IHJvdy5nZXREYXRhKClbdGhpcy5maWVsZF07XG5cblx0XHRpZighQXJyYXkuaXNBcnJheShjaGlsZEFycmF5KSl7XG5cdFx0XHRjaGlsZEFycmF5ID0gW2NoaWxkQXJyYXldO1xuXHRcdH1cblxuXHRcdGNoaWxkQXJyYXkuZm9yRWFjaCgoY2hpbGREYXRhKSA9PiB7XG5cdFx0XHR2YXIgY2hpbGRSb3cgPSBuZXcgUm93KGNoaWxkRGF0YSB8fCB7fSwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyKTtcblxuXHRcdFx0Y2hpbGRSb3cuY3JlYXRlKCk7XG5cblx0XHRcdGNoaWxkUm93Lm1vZHVsZXMuZGF0YVRyZWUuaW5kZXggPSByb3cubW9kdWxlcy5kYXRhVHJlZS5pbmRleCArIDE7XG5cdFx0XHRjaGlsZFJvdy5tb2R1bGVzLmRhdGFUcmVlLnBhcmVudCA9IHJvdztcblxuXHRcdFx0aWYoY2hpbGRSb3cubW9kdWxlcy5kYXRhVHJlZS5jaGlsZHJlbil7XG5cdFx0XHRcdGNoaWxkUm93Lm1vZHVsZXMuZGF0YVRyZWUub3BlbiA9IHRoaXMuc3RhcnRPcGVuKGNoaWxkUm93LmdldENvbXBvbmVudCgpLCBjaGlsZFJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4KTtcblx0XHRcdH1cblx0XHRcdGNoaWxkcmVuLnB1c2goY2hpbGRSb3cpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNoaWxkcmVuO1xuXHR9XG5cblx0ZXhwYW5kUm93KHJvdywgc2lsZW50KXtcblx0XHR2YXIgY29uZmlnID0gcm93Lm1vZHVsZXMuZGF0YVRyZWU7XG5cblx0XHRpZihjb25maWcuY2hpbGRyZW4gIT09IGZhbHNlKXtcblx0XHRcdGNvbmZpZy5vcGVuID0gdHJ1ZTtcblxuXHRcdFx0cm93LnJlaW5pdGlhbGl6ZSgpO1xuXG5cdFx0XHR0aGlzLnJlZnJlc2hEYXRhKHRydWUpO1xuXG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJkYXRhVHJlZVJvd0V4cGFuZGVkXCIsIHJvdy5nZXRDb21wb25lbnQoKSwgcm93Lm1vZHVsZXMuZGF0YVRyZWUuaW5kZXgpO1xuXHRcdH1cblx0fVxuXG5cdGNvbGxhcHNlUm93KHJvdyl7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlO1xuXG5cdFx0aWYoY29uZmlnLmNoaWxkcmVuICE9PSBmYWxzZSl7XG5cdFx0XHRjb25maWcub3BlbiA9IGZhbHNlO1xuXG5cdFx0XHRyb3cucmVpbml0aWFsaXplKCk7XG5cblx0XHRcdHRoaXMucmVmcmVzaERhdGEodHJ1ZSk7XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFUcmVlUm93Q29sbGFwc2VkXCIsIHJvdy5nZXRDb21wb25lbnQoKSwgcm93Lm1vZHVsZXMuZGF0YVRyZWUuaW5kZXgpO1xuXHRcdH1cblx0fVxuXG5cdHRvZ2dsZVJvdyhyb3cpe1xuXHRcdHZhciBjb25maWcgPSByb3cubW9kdWxlcy5kYXRhVHJlZTtcblxuXHRcdGlmKGNvbmZpZy5jaGlsZHJlbiAhPT0gZmFsc2Upe1xuXHRcdFx0aWYoY29uZmlnLm9wZW4pe1xuXHRcdFx0XHR0aGlzLmNvbGxhcHNlUm93KHJvdyk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuZXhwYW5kUm93KHJvdyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aXNSb3dFeHBhbmRlZChyb3cpe1xuXHRcdHJldHVybiByb3cubW9kdWxlcy5kYXRhVHJlZS5vcGVuO1xuXHR9XG5cblx0Z2V0VHJlZVBhcmVudChyb3cpe1xuXHRcdHJldHVybiByb3cubW9kdWxlcy5kYXRhVHJlZS5wYXJlbnQgPyByb3cubW9kdWxlcy5kYXRhVHJlZS5wYXJlbnQuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fVxuXG5cdGdldFRyZWVQYXJlbnRSb290KHJvdyl7XG5cdFx0cmV0dXJuIHJvdy5tb2R1bGVzLmRhdGFUcmVlICYmIHJvdy5tb2R1bGVzLmRhdGFUcmVlLnBhcmVudCA/IHRoaXMuZ2V0VHJlZVBhcmVudFJvb3Qocm93Lm1vZHVsZXMuZGF0YVRyZWUucGFyZW50KSA6IHJvdztcblx0fVxuXG5cdGdldEZpbHRlcmVkVHJlZUNoaWxkcmVuKHJvdyl7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlLFxuXHRcdG91dHB1dCA9IFtdLCBjaGlsZHJlbjtcblxuXHRcdGlmKGNvbmZpZy5jaGlsZHJlbil7XG5cblx0XHRcdGlmKCFBcnJheS5pc0FycmF5KGNvbmZpZy5jaGlsZHJlbikpe1xuXHRcdFx0XHRjb25maWcuY2hpbGRyZW4gPSB0aGlzLmdlbmVyYXRlQ2hpbGRyZW4ocm93KTtcblx0XHRcdH1cblxuXHRcdFx0aWYodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmaWx0ZXJcIikgJiYgdGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlRmlsdGVyKXtcblx0XHRcdFx0Y2hpbGRyZW4gPSB0aGlzLnRhYmxlLm1vZHVsZXMuZmlsdGVyLmZpbHRlcihjb25maWcuY2hpbGRyZW4pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjaGlsZHJlbiA9IGNvbmZpZy5jaGlsZHJlbjtcblx0XHRcdH1cblxuXHRcdFx0Y2hpbGRyZW4uZm9yRWFjaCgoY2hpbGRSb3cpID0+IHtcblx0XHRcdFx0aWYoY2hpbGRSb3cgaW5zdGFuY2VvZiBSb3cpe1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKGNoaWxkUm93KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXG5cdHJvd0RlbGV0aW5nKHJvdyl7XG5cdFx0dmFyIGNvbmZpZyA9IHJvdy5tb2R1bGVzLmRhdGFUcmVlO1xuXG5cdFx0aWYgKGNvbmZpZyAmJiBjb25maWcuY2hpbGRyZW4gJiYgQXJyYXkuaXNBcnJheShjb25maWcuY2hpbGRyZW4pKXtcblx0XHRcdGNvbmZpZy5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZFJvdykgPT4ge1xuXHRcdFx0XHRpZihjaGlsZFJvdyBpbnN0YW5jZW9mIFJvdyl7XG5cdFx0XHRcdFx0Y2hpbGRSb3cud2lwZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHRyb3dEZWxldGUocm93KXtcblx0XHR2YXIgcGFyZW50ID0gcm93Lm1vZHVsZXMuZGF0YVRyZWUucGFyZW50LFxuXHRcdGNoaWxkSW5kZXg7XG5cblx0XHRpZihwYXJlbnQpe1xuXHRcdFx0Y2hpbGRJbmRleCA9IHRoaXMuZmluZENoaWxkSW5kZXgocm93LCBwYXJlbnQpO1xuXG5cdFx0XHRpZihjaGlsZEluZGV4ICE9PSBmYWxzZSl7XG5cdFx0XHRcdHBhcmVudC5kYXRhW3RoaXMuZmllbGRdLnNwbGljZShjaGlsZEluZGV4LCAxKTtcblx0XHRcdH1cblxuXHRcdFx0aWYoIXBhcmVudC5kYXRhW3RoaXMuZmllbGRdLmxlbmd0aCl7XG5cdFx0XHRcdGRlbGV0ZSBwYXJlbnQuZGF0YVt0aGlzLmZpZWxkXTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5pbml0aWFsaXplUm93KHBhcmVudCk7XG5cdFx0XHR0aGlzLmxheW91dFJvdyhwYXJlbnQpO1xuXHRcdH1cblxuXHRcdHRoaXMucmVmcmVzaERhdGEodHJ1ZSk7XG5cdH1cblxuXHRhZGRUcmVlQ2hpbGRSb3cocm93LCBkYXRhLCB0b3AsIGluZGV4KXtcblx0XHR2YXIgY2hpbGRJbmRleCA9IGZhbHNlO1xuXG5cdFx0aWYodHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIpe1xuXHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0fVxuXG5cdFx0aWYoIUFycmF5LmlzQXJyYXkocm93LmRhdGFbdGhpcy5maWVsZF0pKXtcblx0XHRcdHJvdy5kYXRhW3RoaXMuZmllbGRdID0gW107XG5cblx0XHRcdHJvdy5tb2R1bGVzLmRhdGFUcmVlLm9wZW4gPSB0aGlzLnN0YXJ0T3Blbihyb3cuZ2V0Q29tcG9uZW50KCksIHJvdy5tb2R1bGVzLmRhdGFUcmVlLmluZGV4KTtcblx0XHR9XG5cblx0XHRpZih0eXBlb2YgaW5kZXggIT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0Y2hpbGRJbmRleCA9IHRoaXMuZmluZENoaWxkSW5kZXgoaW5kZXgsIHJvdyk7XG5cblx0XHRcdGlmKGNoaWxkSW5kZXggIT09IGZhbHNlKXtcblx0XHRcdFx0cm93LmRhdGFbdGhpcy5maWVsZF0uc3BsaWNlKCh0b3AgPyBjaGlsZEluZGV4IDogY2hpbGRJbmRleCArIDEpLCAwLCBkYXRhKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZihjaGlsZEluZGV4ID09PSBmYWxzZSl7XG5cdFx0XHRpZih0b3Ape1xuXHRcdFx0XHRyb3cuZGF0YVt0aGlzLmZpZWxkXS51bnNoaWZ0KGRhdGEpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRyb3cuZGF0YVt0aGlzLmZpZWxkXS5wdXNoKGRhdGEpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuaW5pdGlhbGl6ZVJvdyhyb3cpO1xuXHRcdHRoaXMubGF5b3V0Um93KHJvdyk7XG5cblx0XHR0aGlzLnJlZnJlc2hEYXRhKHRydWUpO1xuXHR9XG5cblx0ZmluZENoaWxkSW5kZXgoc3ViamVjdCwgcGFyZW50KXtcblx0XHR2YXIgbWF0Y2ggPSBmYWxzZTtcblxuXHRcdGlmKHR5cGVvZiBzdWJqZWN0ID09IFwib2JqZWN0XCIpe1xuXG5cdFx0XHRpZihzdWJqZWN0IGluc3RhbmNlb2YgUm93KXtcblx0XHRcdFx0Ly9zdWJqZWN0IGlzIHJvdyBlbGVtZW50XG5cdFx0XHRcdG1hdGNoID0gc3ViamVjdC5kYXRhO1xuXHRcdFx0fWVsc2UgaWYoc3ViamVjdCBpbnN0YW5jZW9mIFJvd0NvbXBvbmVudCl7XG5cdFx0XHRcdC8vc3ViamVjdCBpcyBwdWJsaWMgcm93IGNvbXBvbmVudFxuXHRcdFx0XHRtYXRjaCA9IHN1YmplY3QuX2dldFNlbGYoKS5kYXRhO1xuXHRcdFx0fWVsc2UgaWYodHlwZW9mIEhUTUxFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiICYmIHN1YmplY3QgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCl7XG5cdFx0XHRcdGlmKHBhcmVudC5tb2R1bGVzLmRhdGFUcmVlKXtcblx0XHRcdFx0XHRtYXRjaCA9IHBhcmVudC5tb2R1bGVzLmRhdGFUcmVlLmNoaWxkcmVuLmZpbmQoKGNoaWxkUm93KSA9PiB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY2hpbGRSb3cgaW5zdGFuY2VvZiBSb3cgPyBjaGlsZFJvdy5lbGVtZW50ID09PSBzdWJqZWN0IDogZmFsc2U7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRpZihtYXRjaCl7XG5cdFx0XHRcdFx0XHRtYXRjaCA9IG1hdGNoLmRhdGE7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSBpZihzdWJqZWN0ID09PSBudWxsKXtcblx0XHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHRcdH1cblxuXHRcdH1lbHNlIGlmKHR5cGVvZiBzdWJqZWN0ID09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHR9ZWxzZSB7XG5cdFx0XHQvL3N1YmplY3Qgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGluZGV4IG9mIHRoZSByb3dcblx0XHRcdG1hdGNoID0gcGFyZW50LmRhdGFbdGhpcy5maWVsZF0uZmluZCgocm93KSA9PiB7XG5cdFx0XHRcdHJldHVybiByb3cuZGF0YVt0aGlzLnRhYmxlLm9wdGlvbnMuaW5kZXhdID09IHN1YmplY3Q7XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRpZihtYXRjaCl7XG5cblx0XHRcdGlmKEFycmF5LmlzQXJyYXkocGFyZW50LmRhdGFbdGhpcy5maWVsZF0pKXtcblx0XHRcdFx0bWF0Y2ggPSBwYXJlbnQuZGF0YVt0aGlzLmZpZWxkXS5pbmRleE9mKG1hdGNoKTtcblx0XHRcdH1cblxuXHRcdFx0aWYobWF0Y2ggPT0gLTEpe1xuXHRcdFx0XHRtYXRjaCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vY2F0Y2ggYWxsIGZvciBhbnkgb3RoZXIgdHlwZSBvZiBpbnB1dFxuXG5cdFx0cmV0dXJuIG1hdGNoO1xuXHR9XG5cblx0Z2V0VHJlZUNoaWxkcmVuKHJvdywgY29tcG9uZW50LCByZWN1cnNlKXtcblx0XHR2YXIgY29uZmlnID0gcm93Lm1vZHVsZXMuZGF0YVRyZWUsXG5cdFx0b3V0cHV0ID0gW107XG5cblx0XHRpZihjb25maWcgJiYgY29uZmlnLmNoaWxkcmVuKXtcblxuXHRcdFx0aWYoIUFycmF5LmlzQXJyYXkoY29uZmlnLmNoaWxkcmVuKSl7XG5cdFx0XHRcdGNvbmZpZy5jaGlsZHJlbiA9IHRoaXMuZ2VuZXJhdGVDaGlsZHJlbihyb3cpO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25maWcuY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGRSb3cpID0+IHtcblx0XHRcdFx0aWYoY2hpbGRSb3cgaW5zdGFuY2VvZiBSb3cpe1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKGNvbXBvbmVudCA/IGNoaWxkUm93LmdldENvbXBvbmVudCgpIDogY2hpbGRSb3cpO1xuXG5cdFx0XHRcdFx0aWYocmVjdXJzZSl7XG5cdFx0XHRcdFx0XHR0aGlzLmdldFRyZWVDaGlsZHJlbihjaGlsZFJvdywgY29tcG9uZW50LCByZWN1cnNlKS5mb3JFYWNoKGNoaWxkID0+IHtcblx0XHRcdFx0XHRcdFx0b3V0cHV0LnB1c2goY2hpbGQpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cblx0Z2V0Q2hpbGRGaWVsZCgpe1xuXHRcdHJldHVybiB0aGlzLmZpZWxkO1xuXHR9XG5cblx0cmVkcmF3TmVlZGVkKGRhdGEpe1xuXHRcdHJldHVybiAodGhpcy5maWVsZCA/IHR5cGVvZiBkYXRhW3RoaXMuZmllbGRdICE9PSBcInVuZGVmaW5lZFwiIDogZmFsc2UpIHx8ICh0aGlzLmVsZW1lbnRGaWVsZCA/IHR5cGVvZiBkYXRhW3RoaXMuZWxlbWVudEZpZWxkXSAhPT0gXCJ1bmRlZmluZWRcIiA6IGZhbHNlKTtcblx0fVxufVxuXG5mdW5jdGlvbiBjc3YkMShsaXN0LCBvcHRpb25zID0ge30sIHNldEZpbGVDb250ZW50cyl7XG5cdHZhciBkZWxpbWl0ZXIgPSBvcHRpb25zLmRlbGltaXRlciA/IG9wdGlvbnMuZGVsaW1pdGVyIDogXCIsXCIsXG5cdGZpbGVDb250ZW50cyA9IFtdLFxuXHRoZWFkZXJzID0gW107XG5cblx0bGlzdC5mb3JFYWNoKChyb3cpID0+IHtcblx0XHR2YXIgaXRlbSA9IFtdO1xuXG5cdFx0c3dpdGNoKHJvdy50eXBlKXtcblx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJEb3dubG9hZCBXYXJuaW5nIC0gQ1NWIGRvd25sb2FkZXIgY2Fubm90IHByb2Nlc3Mgcm93IGdyb3Vwc1wiKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJjYWxjXCI6XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkRvd25sb2FkIFdhcm5pbmcgLSBDU1YgZG93bmxvYWRlciBjYW5ub3QgcHJvY2VzcyBjb2x1bW4gY2FsY3VsYXRpb25zXCIpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImhlYWRlclwiOlxuXHRcdFx0XHRyb3cuY29sdW1ucy5mb3JFYWNoKChjb2wsIGkpID0+IHtcblx0XHRcdFx0XHRpZihjb2wgJiYgY29sLmRlcHRoID09PSAxKXtcblx0XHRcdFx0XHRcdGhlYWRlcnNbaV0gPSB0eXBlb2YgY29sLnZhbHVlID09IFwidW5kZWZpbmVkXCIgIHx8IGNvbC52YWx1ZSA9PT0gbnVsbCA/IFwiXCIgOiAoJ1wiJyArIFN0cmluZyhjb2wudmFsdWUpLnNwbGl0KCdcIicpLmpvaW4oJ1wiXCInKSArICdcIicpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwicm93XCI6XG5cdFx0XHRcdHJvdy5jb2x1bW5zLmZvckVhY2goKGNvbCkgPT4ge1xuXG5cdFx0XHRcdFx0aWYoY29sKXtcblxuXHRcdFx0XHRcdFx0c3dpdGNoKHR5cGVvZiBjb2wudmFsdWUpe1xuXHRcdFx0XHRcdFx0XHRjYXNlIFwib2JqZWN0XCI6XG5cdFx0XHRcdFx0XHRcdFx0Y29sLnZhbHVlID0gY29sLnZhbHVlICE9PSBudWxsID8gSlNPTi5zdHJpbmdpZnkoY29sLnZhbHVlKSA6IFwiXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXHRcdFx0XHRcdFx0XHRcdGNvbC52YWx1ZSA9IFwiXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGl0ZW0ucHVzaCgnXCInICsgU3RyaW5nKGNvbC52YWx1ZSkuc3BsaXQoJ1wiJykuam9pbignXCJcIicpICsgJ1wiJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRmaWxlQ29udGVudHMucHVzaChpdGVtLmpvaW4oZGVsaW1pdGVyKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fSk7XG5cblx0aWYoaGVhZGVycy5sZW5ndGgpe1xuXHRcdGZpbGVDb250ZW50cy51bnNoaWZ0KGhlYWRlcnMuam9pbihkZWxpbWl0ZXIpKTtcblx0fVxuXG5cdGZpbGVDb250ZW50cyA9IGZpbGVDb250ZW50cy5qb2luKFwiXFxuXCIpO1xuXG5cdGlmKG9wdGlvbnMuYm9tKXtcblx0XHRmaWxlQ29udGVudHMgPSBcIlxcdWZlZmZcIiArIGZpbGVDb250ZW50cztcblx0fVxuXG5cdHNldEZpbGVDb250ZW50cyhmaWxlQ29udGVudHMsIFwidGV4dC9jc3ZcIik7XG59XG5cbmZ1bmN0aW9uIGpzb24kMihsaXN0LCBvcHRpb25zLCBzZXRGaWxlQ29udGVudHMpe1xuXHR2YXIgZmlsZUNvbnRlbnRzID0gW107XG5cblx0bGlzdC5mb3JFYWNoKChyb3cpID0+IHtcblx0XHR2YXIgaXRlbSA9IHt9O1xuXG5cdFx0c3dpdGNoKHJvdy50eXBlKXtcblx0XHRcdGNhc2UgXCJoZWFkZXJcIjpcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJEb3dubG9hZCBXYXJuaW5nIC0gSlNPTiBkb3dubG9hZGVyIGNhbm5vdCBwcm9jZXNzIHJvdyBncm91cHNcIik7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiY2FsY1wiOlxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJEb3dubG9hZCBXYXJuaW5nIC0gSlNPTiBkb3dubG9hZGVyIGNhbm5vdCBwcm9jZXNzIGNvbHVtbiBjYWxjdWxhdGlvbnNcIik7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwicm93XCI6XG5cdFx0XHRcdHJvdy5jb2x1bW5zLmZvckVhY2goKGNvbCkgPT4ge1xuXHRcdFx0XHRcdGlmKGNvbCl7XG5cdFx0XHRcdFx0XHRpdGVtW2NvbC5jb21wb25lbnQuZ2V0VGl0bGVEb3dubG9hZCgpIHx8IGNvbC5jb21wb25lbnQuZ2V0RmllbGQoKV0gPSBjb2wudmFsdWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRmaWxlQ29udGVudHMucHVzaChpdGVtKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9KTtcblxuXHRmaWxlQ29udGVudHMgPSBKU09OLnN0cmluZ2lmeShmaWxlQ29udGVudHMsIG51bGwsICdcXHQnKTtcblxuXHRzZXRGaWxlQ29udGVudHMoZmlsZUNvbnRlbnRzLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG59XG5cbmZ1bmN0aW9uIHBkZihsaXN0LCBvcHRpb25zID0ge30sIHNldEZpbGVDb250ZW50cyl7XG5cdHZhciBoZWFkZXIgPSBbXSxcblx0Ym9keSA9IFtdLFxuXHRhdXRvVGFibGVQYXJhbXMgPSB7fSxcblx0cm93R3JvdXBTdHlsZXMgPSBvcHRpb25zLnJvd0dyb3VwU3R5bGVzIHx8IHtcblx0XHRmb250U3R5bGU6IFwiYm9sZFwiLFxuXHRcdGZvbnRTaXplOiAxMixcblx0XHRjZWxsUGFkZGluZzogNixcblx0XHRmaWxsQ29sb3I6IDIyMCxcblx0fSxcblx0cm93Q2FsY1N0eWxlcyA9IG9wdGlvbnMucm93Q2FsY1N0eWxlcyB8fCB7XG5cdFx0Zm9udFN0eWxlOiBcImJvbGRcIixcblx0XHRmb250U2l6ZTogMTAsXG5cdFx0Y2VsbFBhZGRpbmc6IDQsXG5cdFx0ZmlsbENvbG9yOiAyMzIsXG5cdH0sXG5cdGpzUERGUGFyYW1zID0gb3B0aW9ucy5qc1BERiB8fCB7fSxcblx0dGl0bGUgPSBvcHRpb25zLnRpdGxlID8gb3B0aW9ucy50aXRsZSA6IFwiXCIsXG5cdGpzcGRmTGliLCBkb2M7XG5cblx0aWYoIWpzUERGUGFyYW1zLm9yaWVudGF0aW9uKXtcblx0XHRqc1BERlBhcmFtcy5vcmllbnRhdGlvbiA9IG9wdGlvbnMub3JpZW50YXRpb24gfHwgXCJsYW5kc2NhcGVcIjtcblx0fVxuXG5cdGlmKCFqc1BERlBhcmFtcy51bml0KXtcblx0XHRqc1BERlBhcmFtcy51bml0ID0gXCJwdFwiO1xuXHR9XG5cblx0Ly9wYXJzZSByb3cgbGlzdFxuXHRsaXN0LmZvckVhY2goKHJvdykgPT4ge1xuXHRcdHN3aXRjaChyb3cudHlwZSl7XG5cdFx0XHRjYXNlIFwiaGVhZGVyXCI6XG5cdFx0XHRcdGhlYWRlci5wdXNoKHBhcnNlUm93KHJvdykpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImdyb3VwXCI6XG5cdFx0XHRcdGJvZHkucHVzaChwYXJzZVJvdyhyb3csIHJvd0dyb3VwU3R5bGVzKSk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiY2FsY1wiOlxuXHRcdFx0XHRib2R5LnB1c2gocGFyc2VSb3cocm93LCByb3dDYWxjU3R5bGVzKSk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwicm93XCI6XG5cdFx0XHRcdGJvZHkucHVzaChwYXJzZVJvdyhyb3cpKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9KTtcblxuXHRmdW5jdGlvbiBwYXJzZVJvdyhyb3csIHN0eWxlcyl7XG5cdFx0dmFyIHJvd0RhdGEgPSBbXTtcblxuXHRcdHJvdy5jb2x1bW5zLmZvckVhY2goKGNvbCkgPT57XG5cdFx0XHR2YXIgY2VsbDtcblxuXHRcdFx0aWYoY29sKXtcblx0XHRcdFx0c3dpdGNoKHR5cGVvZiBjb2wudmFsdWUpe1xuXHRcdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRcdGNvbC52YWx1ZSA9IGNvbC52YWx1ZSAhPT0gbnVsbCA/IEpTT04uc3RyaW5naWZ5KGNvbC52YWx1ZSkgOiBcIlwiO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cdFx0XHRcdFx0XHRjb2wudmFsdWUgPSBcIlwiO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjZWxsID0ge1xuXHRcdFx0XHRcdGNvbnRlbnQ6Y29sLnZhbHVlLFxuXHRcdFx0XHRcdGNvbFNwYW46Y29sLndpZHRoLFxuXHRcdFx0XHRcdHJvd1NwYW46Y29sLmhlaWdodCxcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRpZihzdHlsZXMpe1xuXHRcdFx0XHRcdGNlbGwuc3R5bGVzID0gc3R5bGVzO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cm93RGF0YS5wdXNoKGNlbGwpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJvd0RhdGE7XG5cdH1cblxuXG5cdC8vY29uZmlndXJlIFBERlxuXHRqc3BkZkxpYiA9IHRoaXMuZGVwZW5kZW5jeVJlZ2lzdHJ5Lmxvb2t1cChcImpzcGRmXCIsIFwianNQREZcIik7XG5cdGRvYyA9IG5ldyBqc3BkZkxpYihqc1BERlBhcmFtcyk7IC8vc2V0IGRvY3VtZW50IHRvIGxhbmRzY2FwZSwgYmV0dGVyIGZvciBtb3N0IHRhYmxlc1xuXG5cdGlmKG9wdGlvbnMuYXV0b1RhYmxlKXtcblx0XHRpZih0eXBlb2Ygb3B0aW9ucy5hdXRvVGFibGUgPT09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRhdXRvVGFibGVQYXJhbXMgPSBvcHRpb25zLmF1dG9UYWJsZShkb2MpIHx8IHt9O1xuXHRcdH1lbHNlIHtcblx0XHRcdGF1dG9UYWJsZVBhcmFtcyA9IG9wdGlvbnMuYXV0b1RhYmxlO1xuXHRcdH1cblx0fVxuXG5cdGlmKHRpdGxlKXtcblx0XHRhdXRvVGFibGVQYXJhbXMuZGlkRHJhd1BhZ2UgPSBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHRkb2MudGV4dCh0aXRsZSwgNDAsIDMwKTtcblx0XHR9O1xuXHR9XG5cblx0YXV0b1RhYmxlUGFyYW1zLmhlYWQgPSBoZWFkZXI7XG5cdGF1dG9UYWJsZVBhcmFtcy5ib2R5ID0gYm9keTtcblxuXHRkb2MuYXV0b1RhYmxlKGF1dG9UYWJsZVBhcmFtcyk7XG5cblx0aWYob3B0aW9ucy5kb2N1bWVudFByb2Nlc3Npbmcpe1xuXHRcdG9wdGlvbnMuZG9jdW1lbnRQcm9jZXNzaW5nKGRvYyk7XG5cdH1cblxuXHRzZXRGaWxlQ29udGVudHMoZG9jLm91dHB1dChcImFycmF5YnVmZmVyXCIpLCBcImFwcGxpY2F0aW9uL3BkZlwiKTtcbn1cblxuZnVuY3Rpb24geGxzeCQxKGxpc3QsIG9wdGlvbnMsIHNldEZpbGVDb250ZW50cyl7XG5cdHZhciBzZWxmID0gdGhpcyxcblx0c2hlZXROYW1lID0gb3B0aW9ucy5zaGVldE5hbWUgfHwgXCJTaGVldDFcIixcblx0WExTWExpYiA9IHRoaXMuZGVwZW5kZW5jeVJlZ2lzdHJ5Lmxvb2t1cChcIlhMU1hcIiksXG5cdHdvcmtib29rID0gWExTWExpYi51dGlscy5ib29rX25ldygpLFxuXHR0YWJsZUZlYXR1cmVzID0gbmV3IENvcmVGZWF0dXJlKHRoaXMpLFxuXHRjb21wcmVzc2lvbiA9ICAnY29tcHJlc3MnIGluIG9wdGlvbnMgPyBvcHRpb25zLmNvbXByZXNzIDogdHJ1ZSxcblx0d3JpdGVPcHRpb25zID0gb3B0aW9ucy53cml0ZU9wdGlvbnMgfHwge2Jvb2tUeXBlOid4bHN4JywgYm9va1NTVDp0cnVlLCBjb21wcmVzc2lvbn0sXG5cdG91dHB1dDtcblxuXHR3cml0ZU9wdGlvbnMudHlwZSA9ICdiaW5hcnknO1xuXG5cdHdvcmtib29rLlNoZWV0TmFtZXMgPSBbXTtcblx0d29ya2Jvb2suU2hlZXRzID0ge307XG5cblx0ZnVuY3Rpb24gZ2VuZXJhdGVTaGVldCgpe1xuXHRcdHZhciByb3dzID0gW10sXG5cdFx0bWVyZ2VzID0gW10sXG5cdFx0d29ya3NoZWV0ID0ge30sXG5cdFx0cmFuZ2UgPSB7czoge2M6MCwgcjowfSwgZToge2M6KGxpc3RbMF0gPyBsaXN0WzBdLmNvbHVtbnMucmVkdWNlKChhLCBiKSA9PiBhICsgKGIgJiYgYi53aWR0aCA/IGIud2lkdGggOiAxKSwgMCkgOiAwKSwgcjpsaXN0Lmxlbmd0aCB9fTtcblxuXHRcdC8vcGFyc2Ugcm93IGxpc3Rcblx0XHRsaXN0LmZvckVhY2goKHJvdywgaSkgPT4ge1xuXHRcdFx0dmFyIHJvd0RhdGEgPSBbXTtcblxuXHRcdFx0cm93LmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2wsIGope1xuXG5cdFx0XHRcdGlmKGNvbCl7XG5cdFx0XHRcdFx0cm93RGF0YS5wdXNoKCEoY29sLnZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgJiYgdHlwZW9mIGNvbC52YWx1ZSA9PT0gXCJvYmplY3RcIiA/IEpTT04uc3RyaW5naWZ5KGNvbC52YWx1ZSkgOiBjb2wudmFsdWUpO1xuXG5cdFx0XHRcdFx0aWYoY29sLndpZHRoID4gMSB8fCBjb2wuaGVpZ2h0ID4gLTEpe1xuXHRcdFx0XHRcdFx0aWYoY29sLmhlaWdodCA+IDEgfHwgY29sLndpZHRoID4gMSl7XG5cdFx0XHRcdFx0XHRcdG1lcmdlcy5wdXNoKHtzOntyOmksYzpqfSxlOntyOmkgKyBjb2wuaGVpZ2h0IC0gMSxjOmogKyBjb2wud2lkdGggLSAxfX0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHJvd0RhdGEucHVzaChcIlwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHJvd3MucHVzaChyb3dEYXRhKTtcblx0XHR9KTtcblxuXHRcdC8vY29udmVydCByb3dzIHRvIHdvcmtzaGVldFxuXHRcdFhMU1hMaWIudXRpbHMuc2hlZXRfYWRkX2FvYSh3b3Jrc2hlZXQsIHJvd3MpO1xuXG5cdFx0d29ya3NoZWV0WychcmVmJ10gPSBYTFNYTGliLnV0aWxzLmVuY29kZV9yYW5nZShyYW5nZSk7XG5cblx0XHRpZihtZXJnZXMubGVuZ3RoKXtcblx0XHRcdHdvcmtzaGVldFtcIiFtZXJnZXNcIl0gPSBtZXJnZXM7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHdvcmtzaGVldDtcblx0fVxuXG5cdGlmKG9wdGlvbnMuc2hlZXRPbmx5KXtcblx0XHRzZXRGaWxlQ29udGVudHMoZ2VuZXJhdGVTaGVldCgpKTtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRpZihvcHRpb25zLnNoZWV0cyl7XG5cdFx0Zm9yKHZhciBzaGVldCBpbiBvcHRpb25zLnNoZWV0cyl7XG5cblx0XHRcdGlmKG9wdGlvbnMuc2hlZXRzW3NoZWV0XSA9PT0gdHJ1ZSl7XG5cdFx0XHRcdHdvcmtib29rLlNoZWV0TmFtZXMucHVzaChzaGVldCk7XG5cdFx0XHRcdHdvcmtib29rLlNoZWV0c1tzaGVldF0gPSBnZW5lcmF0ZVNoZWV0KCk7XG5cdFx0XHR9ZWxzZSB7XG5cblx0XHRcdFx0d29ya2Jvb2suU2hlZXROYW1lcy5wdXNoKHNoZWV0KTtcblxuXHRcdFx0XHR0YWJsZUZlYXR1cmVzLmNvbW1zU2VuZChvcHRpb25zLnNoZWV0c1tzaGVldF0sIFwiZG93bmxvYWRcIiwgXCJpbnRlcmNlcHRcIix7XG5cdFx0XHRcdFx0dHlwZTpcInhsc3hcIixcblx0XHRcdFx0XHRvcHRpb25zOntzaGVldE9ubHk6dHJ1ZX0sXG5cdFx0XHRcdFx0YWN0aXZlOnNlbGYuYWN0aXZlLFxuXHRcdFx0XHRcdGludGVyY2VwdDpmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0XHRcdHdvcmtib29rLlNoZWV0c1tzaGVldF0gPSBkYXRhO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9ZWxzZSB7XG5cdFx0d29ya2Jvb2suU2hlZXROYW1lcy5wdXNoKHNoZWV0TmFtZSk7XG5cdFx0d29ya2Jvb2suU2hlZXRzW3NoZWV0TmFtZV0gPSBnZW5lcmF0ZVNoZWV0KCk7XG5cdH1cblxuXHRpZihvcHRpb25zLmRvY3VtZW50UHJvY2Vzc2luZyl7XG5cdFx0d29ya2Jvb2sgPSBvcHRpb25zLmRvY3VtZW50UHJvY2Vzc2luZyh3b3JrYm9vayk7XG5cdH1cblxuXHQvL2NvbnZlcnQgd29ya2Jvb2sgdG8gYmluYXJ5IGFycmF5XG5cdGZ1bmN0aW9uIHMyYWIocykge1xuXHRcdHZhciBidWYgPSBuZXcgQXJyYXlCdWZmZXIocy5sZW5ndGgpO1xuXHRcdHZhciB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoYnVmKTtcblx0XHRmb3IgKHZhciBpPTA7IGkhPXMubGVuZ3RoOyArK2kpIHZpZXdbaV0gPSBzLmNoYXJDb2RlQXQoaSkgJiAweEZGO1xuXHRcdHJldHVybiBidWY7XG5cdH1cblxuXHRvdXRwdXQgPSBYTFNYTGliLndyaXRlKHdvcmtib29rLCB3cml0ZU9wdGlvbnMpO1xuXG5cdHNldEZpbGVDb250ZW50cyhzMmFiKG91dHB1dCksIFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIpO1xufVxuXG5mdW5jdGlvbiBodG1sJDEobGlzdCwgb3B0aW9ucywgc2V0RmlsZUNvbnRlbnRzKXtcblx0aWYodGhpcy5tb2RFeGlzdHMoXCJleHBvcnRcIiwgdHJ1ZSkpe1xuXHRcdHNldEZpbGVDb250ZW50cyh0aGlzLm1vZHVsZXMuZXhwb3J0LmdlbmVyYXRlSFRNTFRhYmxlKGxpc3QpLCBcInRleHQvaHRtbFwiKTtcblx0fVxufVxuXG5mdW5jdGlvbiBqc29uTGluZXMgKGxpc3QsIG9wdGlvbnMsIHNldEZpbGVDb250ZW50cykge1xuXHRjb25zdCBmaWxlQ29udGVudHMgPSBbXTtcblxuXHRsaXN0LmZvckVhY2goKHJvdykgPT4ge1xuXHRcdGNvbnN0IGl0ZW0gPSB7fTtcblxuXHRcdHN3aXRjaCAocm93LnR5cGUpIHtcblx0XHRcdGNhc2UgXCJoZWFkZXJcIjpcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJEb3dubG9hZCBXYXJuaW5nIC0gSlNPTiBkb3dubG9hZGVyIGNhbm5vdCBwcm9jZXNzIHJvdyBncm91cHNcIik7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiY2FsY1wiOlxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJEb3dubG9hZCBXYXJuaW5nIC0gSlNPTiBkb3dubG9hZGVyIGNhbm5vdCBwcm9jZXNzIGNvbHVtbiBjYWxjdWxhdGlvbnNcIik7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwicm93XCI6XG5cdFx0XHRcdHJvdy5jb2x1bW5zLmZvckVhY2goKGNvbCkgPT4ge1xuXHRcdFx0XHRcdGlmIChjb2wpIHtcblx0XHRcdFx0XHRcdGl0ZW1bY29sLmNvbXBvbmVudC5nZXRUaXRsZURvd25sb2FkKCkgfHwgY29sLmNvbXBvbmVudC5nZXRGaWVsZCgpXSA9IGNvbC52YWx1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGZpbGVDb250ZW50cy5wdXNoKEpTT04uc3RyaW5naWZ5KGl0ZW0pKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9KTtcblxuXHRzZXRGaWxlQ29udGVudHMoZmlsZUNvbnRlbnRzLmpvaW4oXCJcXG5cIiksIFwiYXBwbGljYXRpb24veC1uZGpzb25cIik7XG59XG5cbnZhciBkZWZhdWx0RG93bmxvYWRlcnMgPSB7XG5cdGNzdjpjc3YkMSxcblx0anNvbjpqc29uJDIsXG5cdGpzb25MaW5lczpqc29uTGluZXMsXG5cdHBkZjpwZGYsXG5cdHhsc3g6eGxzeCQxLFxuXHRodG1sOmh0bWwkMSxcbn07XG5cbmNsYXNzIERvd25sb2FkIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJkb3dubG9hZFwiO1xuXG5cdC8vbG9hZCBkZWZhdWx0c1xuXHRzdGF0aWMgZG93bmxvYWRlcnMgPSBkZWZhdWx0RG93bmxvYWRlcnM7XG5cblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImRvd25sb2FkRW5jb2RlclwiLCBmdW5jdGlvbihkYXRhLCBtaW1lVHlwZSl7XG5cdFx0XHRyZXR1cm4gbmV3IEJsb2IoW2RhdGFdLHt0eXBlOm1pbWVUeXBlfSk7XG5cdFx0fSk7IC8vZnVuY3Rpb24gdG8gbWFuaXB1bGF0ZSBkb3dubG9hZCBkYXRhXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZG93bmxvYWRDb25maWdcIiwge30pOyAvL2Rvd25sb2FkIGNvbmZpZ1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImRvd25sb2FkUm93UmFuZ2VcIiwgXCJhY3RpdmVcIik7IC8vcmVzdHJpY3QgZG93bmxvYWQgdG8gYWN0aXZlIHJvd3Mgb25seVxuXG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImRvd25sb2FkXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJ0aXRsZURvd25sb2FkXCIpO1xuXHR9XG5cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuZGVwcmVjYXRlZE9wdGlvbnNDaGVjaygpO1xuXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJkb3dubG9hZFwiLCB0aGlzLmRvd25sb2FkLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiZG93bmxvYWRUb1RhYlwiLCB0aGlzLmRvd25sb2FkVG9UYWIuYmluZCh0aGlzKSk7XG5cdH1cblxuXHRkZXByZWNhdGVkT3B0aW9uc0NoZWNrKCl7XG5cblx0fVx0XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIFRhYmxlIEZ1bmN0aW9ucyAvLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRkb3dubG9hZFRvVGFiKHR5cGUsIGZpbGVuYW1lLCBvcHRpb25zLCBhY3RpdmUpe1xuXHRcdHRoaXMuZG93bmxvYWQodHlwZSwgZmlsZW5hbWUsIG9wdGlvbnMsIGFjdGl2ZSwgdHJ1ZSk7XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gSW50ZXJuYWwgTG9naWMgLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdC8vdHJpZ2dlciBmaWxlIGRvd25sb2FkXG5cdGRvd25sb2FkKHR5cGUsIGZpbGVuYW1lLCBvcHRpb25zLCByYW5nZSwgaW50ZXJjZXB0Q2FsbGJhY2spe1xuXHRcdHZhciBkb3dubG9hZEZ1bmMgPSBmYWxzZTtcblxuXHRcdGZ1bmN0aW9uIGJ1aWxkTGluayhkYXRhLCBtaW1lKXtcblx0XHRcdGlmKGludGVyY2VwdENhbGxiYWNrKXtcblx0XHRcdFx0aWYoaW50ZXJjZXB0Q2FsbGJhY2sgPT09IHRydWUpe1xuXHRcdFx0XHRcdHRoaXMudHJpZ2dlckRvd25sb2FkKGRhdGEsIG1pbWUsIHR5cGUsIGZpbGVuYW1lLCB0cnVlKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGludGVyY2VwdENhbGxiYWNrKGRhdGEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy50cmlnZ2VyRG93bmxvYWQoZGF0YSwgbWltZSwgdHlwZSwgZmlsZW5hbWUpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmKHR5cGVvZiB0eXBlID09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRkb3dubG9hZEZ1bmMgPSB0eXBlO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKERvd25sb2FkLmRvd25sb2FkZXJzW3R5cGVdKXtcblx0XHRcdFx0ZG93bmxvYWRGdW5jID0gRG93bmxvYWQuZG93bmxvYWRlcnNbdHlwZV07XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkRvd25sb2FkIEVycm9yIC0gTm8gc3VjaCBkb3dubG9hZCB0eXBlIGZvdW5kOiBcIiwgdHlwZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYoZG93bmxvYWRGdW5jKXtcblx0XHRcdHZhciBsaXN0ID0gdGhpcy5nZW5lcmF0ZUV4cG9ydExpc3QocmFuZ2UpO1xuXG5cdFx0XHRkb3dubG9hZEZ1bmMuY2FsbCh0aGlzLnRhYmxlLCBsaXN0ICwgb3B0aW9ucyB8fCB7fSwgYnVpbGRMaW5rLmJpbmQodGhpcykpO1xuXHRcdH1cblx0fVxuXG5cdGdlbmVyYXRlRXhwb3J0TGlzdChyYW5nZSl7XG5cdFx0dmFyIGxpc3QgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZXhwb3J0LmdlbmVyYXRlRXhwb3J0TGlzdCh0aGlzLnRhYmxlLm9wdGlvbnMuZG93bmxvYWRDb25maWcsIGZhbHNlLCByYW5nZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMuZG93bmxvYWRSb3dSYW5nZSwgXCJkb3dubG9hZFwiKTtcblxuXHRcdC8vYXNzaWduIGdyb3VwIGhlYWRlciBmb3JtYXR0ZXJcblx0XHR2YXIgZ3JvdXBIZWFkZXIgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBIZWFkZXJEb3dubG9hZDtcblxuXHRcdGlmKGdyb3VwSGVhZGVyICYmICFBcnJheS5pc0FycmF5KGdyb3VwSGVhZGVyKSl7XG5cdFx0XHRncm91cEhlYWRlciA9IFtncm91cEhlYWRlcl07XG5cdFx0fVxuXG5cdFx0bGlzdC5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdHZhciBncm91cDtcblxuXHRcdFx0aWYocm93LnR5cGUgPT09IFwiZ3JvdXBcIil7XG5cdFx0XHRcdGdyb3VwID0gcm93LmNvbHVtbnNbMF07XG5cblx0XHRcdFx0aWYoZ3JvdXBIZWFkZXIgJiYgZ3JvdXBIZWFkZXJbcm93LmluZGVudF0pe1xuXHRcdFx0XHRcdGdyb3VwLnZhbHVlID0gZ3JvdXBIZWFkZXJbcm93LmluZGVudF0oZ3JvdXAudmFsdWUsIHJvdy5jb21wb25lbnQuX2dyb3VwLmdldFJvd0NvdW50KCksIHJvdy5jb21wb25lbnQuX2dyb3VwLmdldERhdGEoKSwgcm93LmNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBsaXN0O1xuXHR9XG5cblx0dHJpZ2dlckRvd25sb2FkKGRhdGEsIG1pbWUsIHR5cGUsIGZpbGVuYW1lLCBuZXdUYWIpe1xuXHRcdHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpLFxuXHRcdGJsb2IgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZG93bmxvYWRFbmNvZGVyKGRhdGEsIG1pbWUpO1xuXG5cdFx0aWYoYmxvYil7XG5cdFx0XHRpZihuZXdUYWIpe1xuXHRcdFx0XHR3aW5kb3cub3Blbih3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGZpbGVuYW1lID0gZmlsZW5hbWUgfHwgXCJUYWJ1bGF0b3IuXCIgKyAodHlwZW9mIHR5cGUgPT09IFwiZnVuY3Rpb25cIiA/IFwidHh0XCIgOiB0eXBlKTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKXtcblx0XHRcdFx0XHRuYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihibG9iLCBmaWxlbmFtZSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsIHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKTtcblxuXHRcdFx0XHRcdC8vc2V0IGZpbGUgdGl0bGVcblx0XHRcdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBmaWxlbmFtZSk7XG5cblx0XHRcdFx0XHQvL3RyaWdnZXIgZG93bmxvYWRcblx0XHRcdFx0XHRlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0XHRcdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTtcblx0XHRcdFx0XHRlbGVtZW50LmNsaWNrKCk7XG5cblx0XHRcdFx0XHQvL3JlbW92ZSB0ZW1wb3JhcnkgbGluayBlbGVtZW50XG5cdFx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtZW50KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJkb3dubG9hZENvbXBsZXRlXCIpO1xuXHRcdH1cblx0fVxuXG5cdGNvbW1zUmVjZWl2ZWQodGFibGUsIGFjdGlvbiwgZGF0YSl7XG5cdFx0c3dpdGNoKGFjdGlvbil7XG5cdFx0XHRjYXNlIFwiaW50ZXJjZXB0XCI6XG5cdFx0XHRcdHRoaXMuZG93bmxvYWQoZGF0YS50eXBlLCBcIlwiLCBkYXRhLm9wdGlvbnMsIGRhdGEuYWN0aXZlLCBkYXRhLmludGVyY2VwdCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fVxufVxuXG5mdW5jdGlvbiBtYXNrSW5wdXQoZWwsIG9wdGlvbnMpe1xuXHR2YXIgbWFzayA9IG9wdGlvbnMubWFzayxcblx0bWFza0xldHRlciA9IHR5cGVvZiBvcHRpb25zLm1hc2tMZXR0ZXJDaGFyICE9PSBcInVuZGVmaW5lZFwiID8gb3B0aW9ucy5tYXNrTGV0dGVyQ2hhciA6IFwiQVwiLFxuXHRtYXNrTnVtYmVyID0gdHlwZW9mIG9wdGlvbnMubWFza051bWJlckNoYXIgIT09IFwidW5kZWZpbmVkXCIgPyBvcHRpb25zLm1hc2tOdW1iZXJDaGFyIDogXCI5XCIsXG5cdG1hc2tXaWxkY2FyZCA9IHR5cGVvZiBvcHRpb25zLm1hc2tXaWxkY2FyZENoYXIgIT09IFwidW5kZWZpbmVkXCIgPyBvcHRpb25zLm1hc2tXaWxkY2FyZENoYXIgOiBcIipcIjtcblxuXHRmdW5jdGlvbiBmaWxsU3ltYm9scyhpbmRleCl7XG5cdFx0dmFyIHN5bWJvbCA9IG1hc2tbaW5kZXhdO1xuXHRcdGlmKHR5cGVvZiBzeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgc3ltYm9sICE9PSBtYXNrV2lsZGNhcmQgJiYgc3ltYm9sICE9PSBtYXNrTGV0dGVyICYmIHN5bWJvbCAhPT0gbWFza051bWJlcil7XG5cdFx0XHRlbC52YWx1ZSA9IGVsLnZhbHVlICsgXCJcIiArIHN5bWJvbDtcblx0XHRcdGZpbGxTeW1ib2xzKGluZGV4KzEpO1xuXHRcdH1cblx0fVxuXG5cdGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XG5cdFx0dmFyIGluZGV4ID0gZWwudmFsdWUubGVuZ3RoLFxuXHRcdGNoYXIgPSBlLmtleTtcblxuXHRcdGlmKGUua2V5Q29kZSA+IDQ2ICYmICFlLmN0cmxLZXkgJiYgIWUubWV0YUtleSl7XG5cdFx0XHRpZihpbmRleCA+PSBtYXNrLmxlbmd0aCl7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRzd2l0Y2gobWFza1tpbmRleF0pe1xuXHRcdFx0XHRcdGNhc2UgbWFza0xldHRlcjpcblx0XHRcdFx0XHRcdGlmKGNoYXIudG9VcHBlckNhc2UoKSA9PSBjaGFyLnRvTG93ZXJDYXNlKCkpe1xuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBtYXNrTnVtYmVyOlxuXHRcdFx0XHRcdFx0aWYoaXNOYU4oY2hhcikpe1xuXHRcdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBtYXNrV2lsZGNhcmQ6XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRpZihjaGFyICE9PSBtYXNrW2luZGV4XSl7XG5cdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuO1xuXHR9KTtcblxuXHRlbC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgKGUpID0+IHtcblx0XHRpZihlLmtleUNvZGUgPiA0Nil7XG5cdFx0XHRpZihvcHRpb25zLm1hc2tBdXRvRmlsbCl7XG5cdFx0XHRcdGZpbGxTeW1ib2xzKGVsLnZhbHVlLmxlbmd0aCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXG5cdGlmKCFlbC5wbGFjZWhvbGRlcil7XG5cdFx0ZWwucGxhY2Vob2xkZXIgPSBtYXNrO1xuXHR9XG5cblx0aWYob3B0aW9ucy5tYXNrQXV0b0ZpbGwpe1xuXHRcdGZpbGxTeW1ib2xzKGVsLnZhbHVlLmxlbmd0aCk7XG5cdH1cbn1cblxuLy9pbnB1dCBlbGVtZW50XG5mdW5jdGlvbiBpbnB1dChjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcyl7XG5cdC8vY3JlYXRlIGFuZCBzdHlsZSBpbnB1dFxuXHR2YXIgY2VsbFZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIGVkaXRvclBhcmFtcy5zZWFyY2ggPyBcInNlYXJjaFwiIDogXCJ0ZXh0XCIpO1xuXG5cdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXHRpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRpbnB1dC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblxuXHRpZihlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgJiYgdHlwZW9mIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyA9PSBcIm9iamVjdFwiKXtcblx0XHRmb3IgKGxldCBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKXtcblx0XHRcdGlmKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpe1xuXHRcdFx0XHRrZXkgPSBrZXkuc2xpY2UoMSk7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGlucHV0LmdldEF0dHJpYnV0ZShrZXkpICsgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW1wiK1wiICsga2V5XSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpbnB1dC52YWx1ZSA9IHR5cGVvZiBjZWxsVmFsdWUgIT09IFwidW5kZWZpbmVkXCIgPyBjZWxsVmFsdWUgOiBcIlwiO1xuXG5cdG9uUmVuZGVyZWQoZnVuY3Rpb24oKXtcblx0XHRpZihjZWxsLmdldFR5cGUoKSA9PT0gXCJjZWxsXCIpe1xuXHRcdFx0aW5wdXQuZm9jdXMoe3ByZXZlbnRTY3JvbGw6IHRydWV9KTtcblx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXG5cdFx0XHRpZihlZGl0b3JQYXJhbXMuc2VsZWN0Q29udGVudHMpe1xuXHRcdFx0XHRpbnB1dC5zZWxlY3QoKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdGZ1bmN0aW9uIG9uQ2hhbmdlKGUpe1xuXHRcdGlmKCgoY2VsbFZhbHVlID09PSBudWxsIHx8IHR5cGVvZiBjZWxsVmFsdWUgPT09IFwidW5kZWZpbmVkXCIpICYmIGlucHV0LnZhbHVlICE9PSBcIlwiKSB8fCBpbnB1dC52YWx1ZSAhPT0gY2VsbFZhbHVlKXtcblx0XHRcdGlmKHN1Y2Nlc3MoaW5wdXQudmFsdWUpKXtcblx0XHRcdFx0Y2VsbFZhbHVlID0gaW5wdXQudmFsdWU7IC8vcGVyc2lzdCB2YWx1ZSBpZiBzdWNjZXNzZnVsbHkgdmFsaWRhdGVkIGluY2FzZSBlZGl0b3IgaXMgdXNlZCBhcyBoZWFkZXIgZmlsdGVyXG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y2FuY2VsKCk7XG5cdFx0fVxuXHR9XG5cblx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXIgb3IgY2hhbmdlXG5cdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgb25DaGFuZ2UpO1xuXHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBvbkNoYW5nZSk7XG5cblx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGVudGVyXG5cdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdHN3aXRjaChlLmtleUNvZGUpe1xuXHRcdFx0Ly8gY2FzZSA5OlxuXHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0b25DaGFuZ2UoKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgMjc6XG5cdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSAzNTpcblx0XHRcdGNhc2UgMzY6XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fSk7XG5cblx0aWYoZWRpdG9yUGFyYW1zLm1hc2spe1xuXHRcdG1hc2tJbnB1dChpbnB1dCwgZWRpdG9yUGFyYW1zKTtcblx0fVxuXG5cdHJldHVybiBpbnB1dDtcbn1cblxuLy9yZXNpemFibGUgdGV4dCBhcmVhIGVsZW1lbnRcbmZ1bmN0aW9uIHRleHRhcmVhJDEoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpe1xuXHR2YXIgY2VsbFZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHR2ZXJ0TmF2ID0gZWRpdG9yUGFyYW1zLnZlcnRpY2FsTmF2aWdhdGlvbiB8fCBcImh5YnJpZFwiLFxuXHR2YWx1ZSA9IFN0cmluZyhjZWxsVmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIGNlbGxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiAgPyBjZWxsVmFsdWUgOiBcIlwiKSxcblx0aW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGV4dGFyZWFcIiksXG5cdHNjcm9sbEhlaWdodCA9IDA7XG5cblx0Ly9jcmVhdGUgYW5kIHN0eWxlIGlucHV0XG5cdGlucHV0LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjJweFwiO1xuXHRpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0aW5wdXQuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdGlucHV0LnN0eWxlLndoaXRlU3BhY2UgPSBcInByZS13cmFwXCI7XG5cdGlucHV0LnN0eWxlLnJlc2l6ZSA9IFwibm9uZVwiO1xuXG5cdGlmKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiB0eXBlb2YgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzID09IFwib2JqZWN0XCIpe1xuXHRcdGZvciAobGV0IGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpe1xuXHRcdFx0aWYoa2V5LmNoYXJBdCgwKSA9PSBcIitcIil7XG5cdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGlucHV0LnZhbHVlID0gdmFsdWU7XG5cblx0b25SZW5kZXJlZChmdW5jdGlvbigpe1xuXHRcdGlmKGNlbGwuZ2V0VHlwZSgpID09PSBcImNlbGxcIil7XG5cdFx0XHRpbnB1dC5mb2N1cyh7cHJldmVudFNjcm9sbDogdHJ1ZX0pO1xuXHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cblx0XHRcdGlucHV0LnNjcm9sbEhlaWdodDtcblx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IGlucHV0LnNjcm9sbEhlaWdodCArIFwicHhcIjtcblx0XHRcdGNlbGwuZ2V0Um93KCkubm9ybWFsaXplSGVpZ2h0KCk7XG5cblx0XHRcdGlmKGVkaXRvclBhcmFtcy5zZWxlY3RDb250ZW50cyl7XG5cdFx0XHRcdGlucHV0LnNlbGVjdCgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG5cblx0ZnVuY3Rpb24gb25DaGFuZ2UoZSl7XG5cblx0XHRpZigoKGNlbGxWYWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgY2VsbFZhbHVlID09PSBcInVuZGVmaW5lZFwiKSAmJiBpbnB1dC52YWx1ZSAhPT0gXCJcIikgfHwgaW5wdXQudmFsdWUgIT09IGNlbGxWYWx1ZSl7XG5cblx0XHRcdGlmKHN1Y2Nlc3MoaW5wdXQudmFsdWUpKXtcblx0XHRcdFx0Y2VsbFZhbHVlID0gaW5wdXQudmFsdWU7IC8vcGVyc2lzdCB2YWx1ZSBpZiBzdWNjZXNzZnVsbHkgdmFsaWRhdGVkIGluY2FzZSBlZGl0b3IgaXMgdXNlZCBhcyBoZWFkZXIgZmlsdGVyXG5cdFx0XHR9XG5cblx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblx0XHRcdFx0Y2VsbC5nZXRSb3coKS5ub3JtYWxpemVIZWlnaHQoKTtcblx0XHRcdH0sMzAwKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjYW5jZWwoKTtcblx0XHR9XG5cdH1cblxuXHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gYmx1ciBvciBjaGFuZ2Vcblx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBvbkNoYW5nZSk7XG5cdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIG9uQ2hhbmdlKTtcblxuXHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZnVuY3Rpb24oKXtcblxuXHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiXCI7XG5cblx0XHR2YXIgaGVpZ2h0Tm93ID0gaW5wdXQuc2Nyb2xsSGVpZ2h0O1xuXG5cdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0Tm93ICsgXCJweFwiO1xuXG5cdFx0aWYoaGVpZ2h0Tm93ICE9IHNjcm9sbEhlaWdodCl7XG5cdFx0XHRzY3JvbGxIZWlnaHQgPSBoZWlnaHROb3c7XG5cdFx0XHRjZWxsLmdldFJvdygpLm5vcm1hbGl6ZUhlaWdodCgpO1xuXHRcdH1cblx0fSk7XG5cblx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24oZSl7XG5cblx0XHRzd2l0Y2goZS5rZXlDb2RlKXtcblxuXHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0aWYoZS5zaGlmdEtleSAmJiBlZGl0b3JQYXJhbXMuc2hpZnRFbnRlclN1Ym1pdCl7XG5cdFx0XHRcdFx0b25DaGFuZ2UoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIDM4OiAvL3VwIGFycm93XG5cdFx0XHRcdGlmKHZlcnROYXYgPT0gXCJlZGl0b3JcIiB8fCAodmVydE5hdiA9PSBcImh5YnJpZFwiICYmIGlucHV0LnNlbGVjdGlvblN0YXJ0KSl7XG5cdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgNDA6IC8vZG93biBhcnJvd1xuXHRcdFx0XHRpZih2ZXJ0TmF2ID09IFwiZWRpdG9yXCIgfHwgKHZlcnROYXYgPT0gXCJoeWJyaWRcIiAmJiBpbnB1dC5zZWxlY3Rpb25TdGFydCAhPT0gaW5wdXQudmFsdWUubGVuZ3RoKSl7XG5cdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIDM1OlxuXHRcdFx0Y2FzZSAzNjpcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9KTtcblxuXHRpZihlZGl0b3JQYXJhbXMubWFzayl7XG5cdFx0bWFza0lucHV0KGlucHV0LCBlZGl0b3JQYXJhbXMpO1xuXHR9XG5cblx0cmV0dXJuIGlucHV0O1xufVxuXG4vL2lucHV0IGVsZW1lbnQgd2l0aCB0eXBlIG9mIG51bWJlclxuZnVuY3Rpb24gbnVtYmVyJDEoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpe1xuXHR2YXIgY2VsbFZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHR2ZXJ0TmF2ID0gZWRpdG9yUGFyYW1zLnZlcnRpY2FsTmF2aWdhdGlvbiB8fCBcImVkaXRvclwiLFxuXHRpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblxuXHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwibnVtYmVyXCIpO1xuXG5cdGlmKHR5cGVvZiBlZGl0b3JQYXJhbXMubWF4ICE9IFwidW5kZWZpbmVkXCIpe1xuXHRcdGlucHV0LnNldEF0dHJpYnV0ZShcIm1heFwiLCBlZGl0b3JQYXJhbXMubWF4KTtcblx0fVxuXG5cdGlmKHR5cGVvZiBlZGl0b3JQYXJhbXMubWluICE9IFwidW5kZWZpbmVkXCIpe1xuXHRcdGlucHV0LnNldEF0dHJpYnV0ZShcIm1pblwiLCBlZGl0b3JQYXJhbXMubWluKTtcblx0fVxuXG5cdGlmKHR5cGVvZiBlZGl0b3JQYXJhbXMuc3RlcCAhPSBcInVuZGVmaW5lZFwiKXtcblx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJzdGVwXCIsIGVkaXRvclBhcmFtcy5zdGVwKTtcblx0fVxuXG5cdC8vY3JlYXRlIGFuZCBzdHlsZSBpbnB1dFxuXHRpbnB1dC5zdHlsZS5wYWRkaW5nID0gXCI0cHhcIjtcblx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0aW5wdXQuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cblx0aWYoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIHR5cGVvZiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgPT0gXCJvYmplY3RcIil7XG5cdFx0Zm9yIChsZXQga2V5IGluIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyl7XG5cdFx0XHRpZihrZXkuY2hhckF0KDApID09IFwiK1wiKXtcblx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBpbnB1dC5nZXRBdHRyaWJ1dGUoa2V5KSArIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1tcIitcIiArIGtleV0pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNba2V5XSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aW5wdXQudmFsdWUgPSBjZWxsVmFsdWU7XG5cblx0dmFyIGJsdXJGdW5jID0gZnVuY3Rpb24oZSl7XG5cdFx0b25DaGFuZ2UoKTtcblx0fTtcblxuXHRvblJlbmRlcmVkKGZ1bmN0aW9uICgpIHtcblx0XHRpZihjZWxsLmdldFR5cGUoKSA9PT0gXCJjZWxsXCIpe1xuXHRcdFx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXJcblx0XHRcdGlucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIGJsdXJGdW5jKTtcblxuXHRcdFx0aW5wdXQuZm9jdXMoe3ByZXZlbnRTY3JvbGw6IHRydWV9KTtcblx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXG5cdFx0XHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gYmx1clxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgYmx1ckZ1bmMpO1xuXG5cdFx0XHRpZihlZGl0b3JQYXJhbXMuc2VsZWN0Q29udGVudHMpe1xuXHRcdFx0XHRpbnB1dC5zZWxlY3QoKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdGZ1bmN0aW9uIG9uQ2hhbmdlKCl7XG5cdFx0dmFyIHZhbHVlID0gaW5wdXQudmFsdWU7XG5cblx0XHRpZighaXNOYU4odmFsdWUpICYmIHZhbHVlICE9PVwiXCIpe1xuXHRcdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXHRcdH1cblxuXHRcdGlmKHZhbHVlICE9PSBjZWxsVmFsdWUpe1xuXHRcdFx0aWYoc3VjY2Vzcyh2YWx1ZSkpe1xuXHRcdFx0XHRjZWxsVmFsdWUgPSB2YWx1ZTsgLy9wZXJzaXN0IHZhbHVlIGlmIHN1Y2Nlc3NmdWxseSB2YWxpZGF0ZWQgaW5jYXNlIGVkaXRvciBpcyB1c2VkIGFzIGhlYWRlciBmaWx0ZXJcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRjYW5jZWwoKTtcblx0XHR9XG5cdH1cblxuXHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gZW50ZXJcblx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24oZSl7XG5cdFx0c3dpdGNoKGUua2V5Q29kZSl7XG5cdFx0XHRjYXNlIDEzOlxuXHRcdFx0Ly8gY2FzZSA5OlxuXHRcdFx0XHRvbkNoYW5nZSgpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIDM4OiAvL3VwIGFycm93XG5cdFx0XHRjYXNlIDQwOiAvL2Rvd24gYXJyb3dcblx0XHRcdFx0aWYodmVydE5hdiA9PSBcImVkaXRvclwiKXtcblx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgMzU6XG5cdFx0XHRjYXNlIDM2OlxuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH0pO1xuXG5cdGlmKGVkaXRvclBhcmFtcy5tYXNrKXtcblx0XHRtYXNrSW5wdXQoaW5wdXQsIGVkaXRvclBhcmFtcyk7XG5cdH1cblxuXHRyZXR1cm4gaW5wdXQ7XG59XG5cbi8vaW5wdXQgZWxlbWVudCB3aXRoIHR5cGUgb2YgbnVtYmVyXG5mdW5jdGlvbiByYW5nZShjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcyl7XG5cdHZhciBjZWxsVmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuXHRcblx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInJhbmdlXCIpO1xuXHRcblx0aWYgKHR5cGVvZiBlZGl0b3JQYXJhbXMubWF4ICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJtYXhcIiwgZWRpdG9yUGFyYW1zLm1heCk7XG5cdH1cblx0XG5cdGlmICh0eXBlb2YgZWRpdG9yUGFyYW1zLm1pbiAhPSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwibWluXCIsIGVkaXRvclBhcmFtcy5taW4pO1xuXHR9XG5cdFxuXHRpZiAodHlwZW9mIGVkaXRvclBhcmFtcy5zdGVwICE9IFwidW5kZWZpbmVkXCIpIHtcblx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJzdGVwXCIsIGVkaXRvclBhcmFtcy5zdGVwKTtcblx0fVxuXHRcblx0Ly9jcmVhdGUgYW5kIHN0eWxlIGlucHV0XG5cdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXHRpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRpbnB1dC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblx0XG5cdGlmKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiB0eXBlb2YgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzID09IFwib2JqZWN0XCIpe1xuXHRcdGZvciAobGV0IGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpe1xuXHRcdFx0aWYoa2V5LmNoYXJBdCgwKSA9PSBcIitcIil7XG5cdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0aW5wdXQudmFsdWUgPSBjZWxsVmFsdWU7XG5cdFxuXHRvblJlbmRlcmVkKGZ1bmN0aW9uICgpIHtcblx0XHRpZihjZWxsLmdldFR5cGUoKSA9PT0gXCJjZWxsXCIpe1xuXHRcdFx0aW5wdXQuZm9jdXMoe3ByZXZlbnRTY3JvbGw6IHRydWV9KTtcblx0XHRcdGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXHRcdH1cblx0fSk7XG5cdFxuXHRmdW5jdGlvbiBvbkNoYW5nZSgpe1xuXHRcdHZhciB2YWx1ZSA9IGlucHV0LnZhbHVlO1xuXHRcdFxuXHRcdGlmKCFpc05hTih2YWx1ZSkgJiYgdmFsdWUgIT09XCJcIil7XG5cdFx0XHR2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHZhbHVlICE9IGNlbGxWYWx1ZSl7XG5cdFx0XHRpZihzdWNjZXNzKHZhbHVlKSl7XG5cdFx0XHRcdGNlbGxWYWx1ZSA9IHZhbHVlOyAvL3BlcnNpc3QgdmFsdWUgaWYgc3VjY2Vzc2Z1bGx5IHZhbGlkYXRlZCBpbmNhc2UgZWRpdG9yIGlzIHVzZWQgYXMgaGVhZGVyIGZpbHRlclxuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGNhbmNlbCgpO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXJcblx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24oZSl7XG5cdFx0b25DaGFuZ2UoKTtcblx0fSk7XG5cdFxuXHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gZW50ZXJcblx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24oZSl7XG5cdFx0c3dpdGNoKGUua2V5Q29kZSl7XG5cdFx0XHRjYXNlIDEzOlxuXHRcdFx0Ly8gY2FzZSA5OlxuXHRcdFx0XHRvbkNoYW5nZSgpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFxuXHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fSk7XG5cdFxuXHRyZXR1cm4gaW5wdXQ7XG59XG5cbi8vaW5wdXQgZWxlbWVudFxuZnVuY3Rpb24gZGF0ZSQxKGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zKXtcblx0dmFyIGlucHV0Rm9ybWF0ID0gZWRpdG9yUGFyYW1zLmZvcm1hdCxcblx0dmVydE5hdiA9IGVkaXRvclBhcmFtcy52ZXJ0aWNhbE5hdmlnYXRpb24gfHwgXCJlZGl0b3JcIixcblx0RFQgPSBpbnB1dEZvcm1hdCA/ICh3aW5kb3cuRGF0ZVRpbWUgfHwgbHV4b24uRGF0ZVRpbWUpIDogbnVsbDtcblx0XG5cdC8vY3JlYXRlIGFuZCBzdHlsZSBpbnB1dFxuXHR2YXIgY2VsbFZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblx0XG5cdGZ1bmN0aW9uIGNvbnZlcnREYXRlKHZhbHVlKXtcblx0XHR2YXIgbmV3RGF0ZXRpbWU7XG5cdFx0XG5cdFx0aWYoRFQuaXNEYXRlVGltZSh2YWx1ZSkpe1xuXHRcdFx0bmV3RGF0ZXRpbWUgPSB2YWx1ZTtcblx0XHR9ZWxzZSBpZihpbnB1dEZvcm1hdCA9PT0gXCJpc29cIil7XG5cdFx0XHRuZXdEYXRldGltZSA9IERULmZyb21JU08oU3RyaW5nKHZhbHVlKSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0bmV3RGF0ZXRpbWUgPSBEVC5mcm9tRm9ybWF0KFN0cmluZyh2YWx1ZSksIGlucHV0Rm9ybWF0KTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIG5ld0RhdGV0aW1lLnRvRm9ybWF0KFwieXl5eS1NTS1kZFwiKTtcblx0fVxuXHRcblx0aW5wdXQudHlwZSA9IFwiZGF0ZVwiO1xuXHRpbnB1dC5zdHlsZS5wYWRkaW5nID0gXCI0cHhcIjtcblx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0aW5wdXQuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cblx0aWYoZWRpdG9yUGFyYW1zLm1heCl7XG5cdFx0aW5wdXQuc2V0QXR0cmlidXRlKFwibWF4XCIsIGlucHV0Rm9ybWF0ID8gY29udmVydERhdGUoZWRpdG9yUGFyYW1zLm1heCkgOiBlZGl0b3JQYXJhbXMubWF4KTtcblx0fVxuXG5cdGlmKGVkaXRvclBhcmFtcy5taW4pe1xuXHRcdGlucHV0LnNldEF0dHJpYnV0ZShcIm1pblwiLCBpbnB1dEZvcm1hdCA/IGNvbnZlcnREYXRlKGVkaXRvclBhcmFtcy5taW4pIDogZWRpdG9yUGFyYW1zLm1pbik7XG5cdH1cblx0XG5cdGlmKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiB0eXBlb2YgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzID09IFwib2JqZWN0XCIpe1xuXHRcdGZvciAobGV0IGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpe1xuXHRcdFx0aWYoa2V5LmNoYXJBdCgwKSA9PSBcIitcIil7XG5cdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Y2VsbFZhbHVlID0gdHlwZW9mIGNlbGxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGNlbGxWYWx1ZSA6IFwiXCI7XG5cdFxuXHRpZihpbnB1dEZvcm1hdCl7XG5cdFx0aWYoRFQpe1x0XHRcblx0XHRcdGNlbGxWYWx1ZSA9IGNvbnZlcnREYXRlKGNlbGxWYWx1ZSk7XHRcdFx0XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcIkVkaXRvciBFcnJvciAtICdkYXRlJyBlZGl0b3IgJ2Zvcm1hdCcgcGFyYW0gaXMgZGVwZW5kYW50IG9uIGx1eG9uLmpzXCIpO1xuXHRcdH1cblx0fVxuXHRcblx0aW5wdXQudmFsdWUgPSBjZWxsVmFsdWU7XG5cdFxuXHRvblJlbmRlcmVkKGZ1bmN0aW9uKCl7XG5cdFx0aWYoY2VsbC5nZXRUeXBlKCkgPT09IFwiY2VsbFwiKXtcblx0XHRcdGlucHV0LmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiB0cnVlfSk7XG5cdFx0XHRpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblx0XHRcdFxuXHRcdFx0aWYoZWRpdG9yUGFyYW1zLnNlbGVjdENvbnRlbnRzKXtcblx0XHRcdFx0aW5wdXQuc2VsZWN0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblx0XG5cdGZ1bmN0aW9uIG9uQ2hhbmdlKCl7XG5cdFx0dmFyIHZhbHVlID0gaW5wdXQudmFsdWUsXG5cdFx0bHV4RGF0ZTtcblx0XHRcblx0XHRpZigoKGNlbGxWYWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgY2VsbFZhbHVlID09PSBcInVuZGVmaW5lZFwiKSAmJiB2YWx1ZSAhPT0gXCJcIikgfHwgdmFsdWUgIT09IGNlbGxWYWx1ZSl7XG5cdFx0XHRcblx0XHRcdGlmKHZhbHVlICYmIGlucHV0Rm9ybWF0KXtcblx0XHRcdFx0bHV4RGF0ZSA9IERULmZyb21Gb3JtYXQoU3RyaW5nKHZhbHVlKSwgXCJ5eXl5LU1NLWRkXCIpO1xuXG5cdFx0XHRcdHN3aXRjaChpbnB1dEZvcm1hdCl7XG5cdFx0XHRcdFx0Y2FzZSB0cnVlOlxuXHRcdFx0XHRcdFx0dmFsdWUgPSBsdXhEYXRlO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiaXNvXCI6XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGx1eERhdGUudG9JU08oKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdHZhbHVlID0gbHV4RGF0ZS50b0Zvcm1hdChpbnB1dEZvcm1hdCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoc3VjY2Vzcyh2YWx1ZSkpe1xuXHRcdFx0XHRjZWxsVmFsdWUgPSBpbnB1dC52YWx1ZTsgLy9wZXJzaXN0IHZhbHVlIGlmIHN1Y2Nlc3NmdWxseSB2YWxpZGF0ZWQgaW5jYXNlIGVkaXRvciBpcyB1c2VkIGFzIGhlYWRlciBmaWx0ZXJcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRjYW5jZWwoKTtcblx0XHR9XG5cdH1cblx0XG5cdC8vc3VibWl0IG5ldyB2YWx1ZSBvbiBibHVyXG5cdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIGZ1bmN0aW9uKGUpIHtcblx0XHRpZiAoZS5yZWxhdGVkVGFyZ2V0IHx8IGUucmFuZ2VQYXJlbnQgfHwgZS5leHBsaWNpdE9yaWdpbmFsVGFyZ2V0ICE9PSBpbnB1dCkge1xuXHRcdFx0b25DaGFuZ2UoKTsgLy8gb25seSBvbiBhIFwidHJ1ZVwiIGJsdXI7IG5vdCB3aGVuIGZvY3VzaW5nIGJyb3dzZXIncyBkYXRlL3RpbWUgcGlja2VyXG5cdFx0fVxuXHR9KTtcblx0XG5cdC8vc3VibWl0IG5ldyB2YWx1ZSBvbiBlbnRlclxuXHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbihlKXtcblx0XHRzd2l0Y2goZS5rZXlDb2RlKXtcblx0XHRcdC8vIGNhc2UgOTpcblx0XHRcdGNhc2UgMTM6XG5cdFx0XHRcdG9uQ2hhbmdlKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIDI3OlxuXHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgMzU6XG5cdFx0XHRjYXNlIDM2OlxuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFxuXHRcdFx0Y2FzZSAzODogLy91cCBhcnJvd1xuXHRcdFx0Y2FzZSA0MDogLy9kb3duIGFycm93XG5cdFx0XHRcdGlmKHZlcnROYXYgPT0gXCJlZGl0b3JcIil7XG5cdFx0XHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fSk7XG5cdFxuXHRyZXR1cm4gaW5wdXQ7XG59XG5cbi8vaW5wdXQgZWxlbWVudFxuZnVuY3Rpb24gdGltZSQxKGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zKXtcblx0dmFyIGlucHV0Rm9ybWF0ID0gZWRpdG9yUGFyYW1zLmZvcm1hdCxcblx0dmVydE5hdiA9IGVkaXRvclBhcmFtcy52ZXJ0aWNhbE5hdmlnYXRpb24gfHwgXCJlZGl0b3JcIixcblx0RFQgPSBpbnB1dEZvcm1hdCA/ICh3aW5kb3cuRGF0ZVRpbWUgfHwgbHV4b24uRGF0ZVRpbWUpIDogbnVsbCwgXG5cdG5ld0RhdGV0aW1lO1xuXHRcblx0Ly9jcmVhdGUgYW5kIHN0eWxlIGlucHV0XG5cdHZhciBjZWxsVmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuXHRcblx0aW5wdXQudHlwZSA9IFwidGltZVwiO1xuXHRpbnB1dC5zdHlsZS5wYWRkaW5nID0gXCI0cHhcIjtcblx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0aW5wdXQuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFxuXHRpZihlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgJiYgdHlwZW9mIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyA9PSBcIm9iamVjdFwiKXtcblx0XHRmb3IgKGxldCBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKXtcblx0XHRcdGlmKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpe1xuXHRcdFx0XHRrZXkgPSBrZXkuc2xpY2UoMSk7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGlucHV0LmdldEF0dHJpYnV0ZShrZXkpICsgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW1wiK1wiICsga2V5XSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGNlbGxWYWx1ZSA9IHR5cGVvZiBjZWxsVmFsdWUgIT09IFwidW5kZWZpbmVkXCIgPyBjZWxsVmFsdWUgOiBcIlwiO1xuXHRcblx0aWYoaW5wdXRGb3JtYXQpe1xuXHRcdGlmKERUKXtcblx0XHRcdGlmKERULmlzRGF0ZVRpbWUoY2VsbFZhbHVlKSl7XG5cdFx0XHRcdG5ld0RhdGV0aW1lID0gY2VsbFZhbHVlO1xuXHRcdFx0fWVsc2UgaWYoaW5wdXRGb3JtYXQgPT09IFwiaXNvXCIpe1xuXHRcdFx0XHRuZXdEYXRldGltZSA9IERULmZyb21JU08oU3RyaW5nKGNlbGxWYWx1ZSkpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRuZXdEYXRldGltZSA9IERULmZyb21Gb3JtYXQoU3RyaW5nKGNlbGxWYWx1ZSksIGlucHV0Rm9ybWF0KTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Y2VsbFZhbHVlID0gbmV3RGF0ZXRpbWUudG9Gb3JtYXQoXCJISDptbVwiKTtcblx0XHRcdFxuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJFZGl0b3IgRXJyb3IgLSAnZGF0ZScgZWRpdG9yICdmb3JtYXQnIHBhcmFtIGlzIGRlcGVuZGFudCBvbiBsdXhvbi5qc1wiKTtcblx0XHR9XG5cdH1cblx0XG5cdGlucHV0LnZhbHVlID0gY2VsbFZhbHVlO1xuXHRcblx0b25SZW5kZXJlZChmdW5jdGlvbigpe1xuXHRcdGlmKGNlbGwuZ2V0VHlwZSgpID09IFwiY2VsbFwiKXtcblx0XHRcdGlucHV0LmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiB0cnVlfSk7XG5cdFx0XHRpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblx0XHRcdFxuXHRcdFx0aWYoZWRpdG9yUGFyYW1zLnNlbGVjdENvbnRlbnRzKXtcblx0XHRcdFx0aW5wdXQuc2VsZWN0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblx0XG5cdGZ1bmN0aW9uIG9uQ2hhbmdlKCl7XG5cdFx0dmFyIHZhbHVlID0gaW5wdXQudmFsdWUsXG5cdFx0bHV4VGltZTtcblx0XHRcblx0XHRpZigoKGNlbGxWYWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgY2VsbFZhbHVlID09PSBcInVuZGVmaW5lZFwiKSAmJiB2YWx1ZSAhPT0gXCJcIikgfHwgdmFsdWUgIT09IGNlbGxWYWx1ZSl7XG5cdFx0XHRcblx0XHRcdGlmKHZhbHVlICYmIGlucHV0Rm9ybWF0KXtcblx0XHRcdFx0bHV4VGltZSA9IERULmZyb21Gb3JtYXQoU3RyaW5nKHZhbHVlKSwgXCJoaDptbVwiKTtcblxuXHRcdFx0XHRzd2l0Y2goaW5wdXRGb3JtYXQpe1xuXHRcdFx0XHRcdGNhc2UgdHJ1ZTpcblx0XHRcdFx0XHRcdHZhbHVlID0gbHV4VGltZTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSBcImlzb1wiOlxuXHRcdFx0XHRcdFx0dmFsdWUgPSBsdXhUaW1lLnRvSVNPKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGx1eFRpbWUudG9Gb3JtYXQoaW5wdXRGb3JtYXQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHN1Y2Nlc3ModmFsdWUpKXtcblx0XHRcdFx0Y2VsbFZhbHVlID0gaW5wdXQudmFsdWU7IC8vcGVyc2lzdCB2YWx1ZSBpZiBzdWNjZXNzZnVsbHkgdmFsaWRhdGVkIGluY2FzZSBlZGl0b3IgaXMgdXNlZCBhcyBoZWFkZXIgZmlsdGVyXG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y2FuY2VsKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gYmx1clxuXHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbihlKSB7XG5cdFx0aWYgKGUucmVsYXRlZFRhcmdldCB8fCBlLnJhbmdlUGFyZW50IHx8IGUuZXhwbGljaXRPcmlnaW5hbFRhcmdldCAhPT0gaW5wdXQpIHtcblx0XHRcdG9uQ2hhbmdlKCk7IC8vIG9ubHkgb24gYSBcInRydWVcIiBibHVyOyBub3Qgd2hlbiBmb2N1c2luZyBicm93c2VyJ3MgZGF0ZS90aW1lIHBpY2tlclxuXHRcdH1cblx0fSk7XG5cdFxuXHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gZW50ZXJcblx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24oZSl7XG5cdFx0c3dpdGNoKGUua2V5Q29kZSl7XG5cdFx0XHQvLyBjYXNlIDk6XG5cdFx0XHRjYXNlIDEzOlxuXHRcdFx0XHRvbkNoYW5nZSgpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFxuXHRcdFx0Y2FzZSAyNzpcblx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIDM1OlxuXHRcdFx0Y2FzZSAzNjpcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgMzg6IC8vdXAgYXJyb3dcblx0XHRcdGNhc2UgNDA6IC8vZG93biBhcnJvd1xuXHRcdFx0XHRpZih2ZXJ0TmF2ID09IFwiZWRpdG9yXCIpe1xuXHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH0pO1xuXHRcblx0cmV0dXJuIGlucHV0O1xufVxuXG4vL2lucHV0IGVsZW1lbnRcbmZ1bmN0aW9uIGRhdGV0aW1lJDIoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpe1xuXHR2YXIgaW5wdXRGb3JtYXQgPSBlZGl0b3JQYXJhbXMuZm9ybWF0LFxuXHR2ZXJ0TmF2ID0gZWRpdG9yUGFyYW1zLnZlcnRpY2FsTmF2aWdhdGlvbiB8fCBcImVkaXRvclwiLFxuXHREVCA9IGlucHV0Rm9ybWF0ID8gKHRoaXMudGFibGUuZGVwZW5kZW5jeVJlZ2lzdHJ5Lmxvb2t1cChbXCJsdXhvblwiLCBcIkRhdGVUaW1lXCJdLCBcIkRhdGVUaW1lXCIpKSA6IG51bGwsIFxuXHRuZXdEYXRldGltZTtcblx0XG5cdC8vY3JlYXRlIGFuZCBzdHlsZSBpbnB1dFxuXHR2YXIgY2VsbFZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHRpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblx0XG5cdGlucHV0LnR5cGUgPSBcImRhdGV0aW1lLWxvY2FsXCI7XG5cdGlucHV0LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xuXHRpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuXHRpbnB1dC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblx0XG5cdGlmKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiB0eXBlb2YgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzID09IFwib2JqZWN0XCIpe1xuXHRcdGZvciAobGV0IGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpe1xuXHRcdFx0aWYoa2V5LmNoYXJBdCgwKSA9PSBcIitcIil7XG5cdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Y2VsbFZhbHVlID0gdHlwZW9mIGNlbGxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGNlbGxWYWx1ZSA6IFwiXCI7XG5cdFxuXHRpZihpbnB1dEZvcm1hdCl7XG5cdFx0aWYoRFQpe1xuXHRcdFx0aWYoRFQuaXNEYXRlVGltZShjZWxsVmFsdWUpKXtcblx0XHRcdFx0bmV3RGF0ZXRpbWUgPSBjZWxsVmFsdWU7XG5cdFx0XHR9ZWxzZSBpZihpbnB1dEZvcm1hdCA9PT0gXCJpc29cIil7XG5cdFx0XHRcdG5ld0RhdGV0aW1lID0gRFQuZnJvbUlTTyhTdHJpbmcoY2VsbFZhbHVlKSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdG5ld0RhdGV0aW1lID0gRFQuZnJvbUZvcm1hdChTdHJpbmcoY2VsbFZhbHVlKSwgaW5wdXRGb3JtYXQpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRjZWxsVmFsdWUgPSBuZXdEYXRldGltZS50b0Zvcm1hdChcInl5eXktTU0tZGRcIikgICsgXCJUXCIgKyBuZXdEYXRldGltZS50b0Zvcm1hdChcIkhIOm1tXCIpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJFZGl0b3IgRXJyb3IgLSAnZGF0ZScgZWRpdG9yICdmb3JtYXQnIHBhcmFtIGlzIGRlcGVuZGFudCBvbiBsdXhvbi5qc1wiKTtcblx0XHR9XG5cdH1cblx0XG5cdGlucHV0LnZhbHVlID0gY2VsbFZhbHVlO1xuXHRcblx0b25SZW5kZXJlZChmdW5jdGlvbigpe1xuXHRcdGlmKGNlbGwuZ2V0VHlwZSgpID09PSBcImNlbGxcIil7XG5cdFx0XHRpbnB1dC5mb2N1cyh7cHJldmVudFNjcm9sbDogdHJ1ZX0pO1xuXHRcdFx0aW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdFx0XHRcblx0XHRcdGlmKGVkaXRvclBhcmFtcy5zZWxlY3RDb250ZW50cyl7XG5cdFx0XHRcdGlucHV0LnNlbGVjdCgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG5cdFxuXHRmdW5jdGlvbiBvbkNoYW5nZSgpe1xuXHRcdHZhciB2YWx1ZSA9IGlucHV0LnZhbHVlLFxuXHRcdGx1eERhdGVUaW1lO1xuXHRcdFxuXHRcdGlmKCgoY2VsbFZhbHVlID09PSBudWxsIHx8IHR5cGVvZiBjZWxsVmFsdWUgPT09IFwidW5kZWZpbmVkXCIpICYmIHZhbHVlICE9PSBcIlwiKSB8fCB2YWx1ZSAhPT0gY2VsbFZhbHVlKXtcblxuXHRcdFx0aWYodmFsdWUgJiYgaW5wdXRGb3JtYXQpe1xuXHRcdFx0XHRsdXhEYXRlVGltZSA9IERULmZyb21JU08oU3RyaW5nKHZhbHVlKSk7XG5cblx0XHRcdFx0c3dpdGNoKGlucHV0Rm9ybWF0KXtcblx0XHRcdFx0XHRjYXNlIHRydWU6XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGx1eERhdGVUaW1lO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiaXNvXCI6XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGx1eERhdGVUaW1lLnRvSVNPKCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGx1eERhdGVUaW1lLnRvRm9ybWF0KGlucHV0Rm9ybWF0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihzdWNjZXNzKHZhbHVlKSl7XG5cdFx0XHRcdGNlbGxWYWx1ZSA9IGlucHV0LnZhbHVlOyAvL3BlcnNpc3QgdmFsdWUgaWYgc3VjY2Vzc2Z1bGx5IHZhbGlkYXRlZCBpbmNhc2UgZWRpdG9yIGlzIHVzZWQgYXMgaGVhZGVyIGZpbHRlclxuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGNhbmNlbCgpO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGJsdXJcblx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24oZSkge1xuXHRcdGlmIChlLnJlbGF0ZWRUYXJnZXQgfHwgZS5yYW5nZVBhcmVudCB8fCBlLmV4cGxpY2l0T3JpZ2luYWxUYXJnZXQgIT09IGlucHV0KSB7XG5cdFx0XHRvbkNoYW5nZSgpOyAvLyBvbmx5IG9uIGEgXCJ0cnVlXCIgYmx1cjsgbm90IHdoZW4gZm9jdXNpbmcgYnJvd3NlcidzIGRhdGUvdGltZSBwaWNrZXJcblx0XHR9XG5cdH0pO1xuXHRcblx0Ly9zdWJtaXQgbmV3IHZhbHVlIG9uIGVudGVyXG5cdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdHN3aXRjaChlLmtleUNvZGUpe1xuXHRcdFx0Ly8gY2FzZSA5OlxuXHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0b25DaGFuZ2UoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgMjc6XG5cdFx0XHRcdGNhbmNlbCgpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFxuXHRcdFx0Y2FzZSAzNTpcblx0XHRcdGNhc2UgMzY6XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIDM4OiAvL3VwIGFycm93XG5cdFx0XHRjYXNlIDQwOiAvL2Rvd24gYXJyb3dcblx0XHRcdFx0aWYodmVydE5hdiA9PSBcImVkaXRvclwiKXtcblx0XHRcdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9KTtcblx0XG5cdHJldHVybiBpbnB1dDtcbn1cblxubGV0IEVkaXQkMSA9IGNsYXNzIEVkaXR7XG5cdGNvbnN0cnVjdG9yKGVkaXRvciwgY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpe1xuXHRcdHRoaXMuZWRpdCA9IGVkaXRvcjtcblx0XHR0aGlzLnRhYmxlID0gZWRpdG9yLnRhYmxlO1xuXHRcdHRoaXMuY2VsbCA9IGNlbGw7XG5cdFx0dGhpcy5wYXJhbXMgPSB0aGlzLl9pbml0aWFsaXplUGFyYW1zKGVkaXRvclBhcmFtcyk7XG5cdFx0XG5cdFx0dGhpcy5kYXRhID0gW107XG5cdFx0dGhpcy5kaXNwbGF5SXRlbXMgPSBbXTtcblx0XHR0aGlzLmN1cnJlbnRJdGVtcyA9IFtdO1xuXHRcdHRoaXMuZm9jdXNlZEl0ZW0gPSBudWxsO1xuXHRcdFxuXHRcdHRoaXMuaW5wdXQgPSB0aGlzLl9jcmVhdGVJbnB1dEVsZW1lbnQoKTtcblx0XHR0aGlzLmxpc3RFbCA9IHRoaXMuX2NyZWF0ZUxpc3RFbGVtZW50KCk7XG5cdFx0XG5cdFx0dGhpcy5pbml0aWFsVmFsdWVzID0gbnVsbDsgXG5cdFx0XG5cdFx0dGhpcy5pc0ZpbHRlciA9IGNlbGwuZ2V0VHlwZSgpID09PSBcImhlYWRlclwiO1xuXHRcdFxuXHRcdHRoaXMuZmlsdGVyVGltZW91dCA9IG51bGw7XG5cdFx0dGhpcy5maWx0ZXJlZCA9IGZhbHNlO1xuXHRcdHRoaXMudHlwaW5nID0gZmFsc2U7XG5cdFx0XG5cdFx0dGhpcy52YWx1ZXMgPSBbXTsgXG5cdFx0dGhpcy5wb3B1cCA9IG51bGw7ICBcblx0XHRcblx0XHR0aGlzLmxpc3RJdGVyYXRpb24gPSAwO1xuXHRcdFxuXHRcdHRoaXMubGFzdEFjdGlvbj1cIlwiO1xuXHRcdHRoaXMuZmlsdGVyVGVybT1cIlwiO1xuXHRcdFxuXHRcdHRoaXMuYmx1cmFibGUgPSB0cnVlO1xuXHRcdFxuXHRcdHRoaXMuYWN0aW9ucyA9IHtcblx0XHRcdHN1Y2Nlc3M6c3VjY2Vzcyxcblx0XHRcdGNhbmNlbDpjYW5jZWxcblx0XHR9O1xuXHRcdFxuXHRcdHRoaXMuX2RlcHJlY2F0ZWRPcHRpb25zQ2hlY2soKTtcblx0XHR0aGlzLl9pbml0aWFsaXplVmFsdWUoKTtcblx0XHRcblx0XHRvblJlbmRlcmVkKHRoaXMuX29uUmVuZGVyZWQuYmluZCh0aGlzKSk7XG5cdH1cblx0XG5cdF9kZXByZWNhdGVkT3B0aW9uc0NoZWNrKCl7XG5cdFx0Ly8gaWYodGhpcy5wYXJhbXMubGlzdEl0ZW1Gb3JtYXR0ZXIpe1xuXHRcdC8vIFx0dGhpcy5jZWxsLmdldFRhYmxlKCkuZGVwcmVjYXRpb25BZHZpc29yLm1zZyhcIlRoZSBsaXN0SXRlbUZvcm1hdHRlciBlZGl0b3IgcGFyYW0gaGFzIGJlZW4gZGVwcmVjYXRlZCwgcGxlYXNlIHNlZSB0aGUgbGF0ZXN0IGVkaXRvciBkb2N1bWVudGF0aW9uIGZvciB1cGRhdGVkIG9wdGlvbnNcIik7XG5cdFx0Ly8gfVxuXHRcdFxuXHRcdC8vIGlmKHRoaXMucGFyYW1zLnNvcnRWYWx1ZXNMaXN0KXtcblx0XHQvLyBcdHRoaXMuY2VsbC5nZXRUYWJsZSgpLmRlcHJlY2F0aW9uQWR2aXNvci5tc2coXCJUaGUgc29ydFZhbHVlc0xpc3QgZWRpdG9yIHBhcmFtIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIHBsZWFzZSBzZWUgdGhlIGxhdGVzdCBlZGl0b3IgZG9jdW1lbnRhdGlvbiBmb3IgdXBkYXRlZCBvcHRpb25zXCIpO1xuXHRcdC8vIH1cblx0XHRcblx0XHQvLyBpZih0aGlzLnBhcmFtcy5zZWFyY2hGdW5jKXtcblx0XHQvLyBcdHRoaXMuY2VsbC5nZXRUYWJsZSgpLmRlcHJlY2F0aW9uQWR2aXNvci5tc2coXCJUaGUgc2VhcmNoRnVuYyBlZGl0b3IgcGFyYW0gaGFzIGJlZW4gZGVwcmVjYXRlZCwgcGxlYXNlIHNlZSB0aGUgbGF0ZXN0IGVkaXRvciBkb2N1bWVudGF0aW9uIGZvciB1cGRhdGVkIG9wdGlvbnNcIik7XG5cdFx0Ly8gfVxuXHRcdFxuXHRcdC8vIGlmKHRoaXMucGFyYW1zLnNlYXJjaGluZ1BsYWNlaG9sZGVyKXtcblx0XHQvLyBcdHRoaXMuY2VsbC5nZXRUYWJsZSgpLmRlcHJlY2F0aW9uQWR2aXNvci5tc2coXCJUaGUgc2VhcmNoaW5nUGxhY2Vob2xkZXIgZWRpdG9yIHBhcmFtIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIHBsZWFzZSBzZWUgdGhlIGxhdGVzdCBlZGl0b3IgZG9jdW1lbnRhdGlvbiBmb3IgdXBkYXRlZCBvcHRpb25zXCIpO1xuXHRcdC8vIH1cblx0fVxuXHRcblx0X2luaXRpYWxpemVWYWx1ZSgpe1xuXHRcdHZhciBpbml0aWFsVmFsdWUgPSB0aGlzLmNlbGwuZ2V0VmFsdWUoKTtcblx0XHRcblx0XHRpZih0eXBlb2YgaW5pdGlhbFZhbHVlID09PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiB0aGlzLnBhcmFtcy5kZWZhdWx0VmFsdWUgIT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0aW5pdGlhbFZhbHVlID0gdGhpcy5wYXJhbXMuZGVmYXVsdFZhbHVlO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmluaXRpYWxWYWx1ZXMgPSB0aGlzLnBhcmFtcy5tdWx0aXNlbGVjdCA/IGluaXRpYWxWYWx1ZSA6IFtpbml0aWFsVmFsdWVdO1xuXHRcdFxuXHRcdGlmKHRoaXMuaXNGaWx0ZXIpe1xuXHRcdFx0dGhpcy5pbnB1dC52YWx1ZSA9IHRoaXMuaW5pdGlhbFZhbHVlcyA/IHRoaXMuaW5pdGlhbFZhbHVlcy5qb2luKFwiLFwiKSA6IFwiXCI7XG5cdFx0XHR0aGlzLmhlYWRlckZpbHRlckluaXRpYWxMaXN0R2VuKCk7ICAgICAgICAgICAgXG5cdFx0fVxuXHR9XG5cdFxuXHRfb25SZW5kZXJlZCgpe1xuXHRcdHZhciBjZWxsRWwgPSB0aGlzLmNlbGwuZ2V0RWxlbWVudCgpO1xuXHRcdFxuXHRcdGZ1bmN0aW9uIGNsaWNrU3RvcChlKXtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0fVx0XG5cdFx0XG5cdFx0aWYoIXRoaXMuaXNGaWx0ZXIpe1xuXHRcdFx0dGhpcy5pbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcblx0XHRcdHRoaXMuaW5wdXQuZm9jdXMoe3ByZXZlbnRTY3JvbGw6IHRydWV9KTtcblx0XHR9XG5cdFx0XG5cdFx0XG5cdFx0Y2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbGlja1N0b3ApO1xuXHRcdFxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0Y2VsbEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbGlja1N0b3ApO1xuXHRcdH0sIDEwMDApO1xuXHRcdFxuXHRcdHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9wcmV2ZW50UG9wdXBCbHVyLmJpbmQodGhpcykpO1xuXHR9XG5cdFxuXHRfY3JlYXRlTGlzdEVsZW1lbnQoKXtcblx0XHR2YXIgbGlzdEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRsaXN0RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0LWxpc3RcIik7XG5cdFx0XG5cdFx0bGlzdEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgdGhpcy5fcHJldmVudEJsdXIuYmluZCh0aGlzKSk7XG5cdFx0bGlzdEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2lucHV0S2V5RG93bi5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHRyZXR1cm4gbGlzdEVsO1xuXHR9XG5cdFxuXHRfc2V0TGlzdFdpZHRoKCl7XG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLmlzRmlsdGVyID8gdGhpcy5pbnB1dCA6IHRoaXMuY2VsbC5nZXRFbGVtZW50KCk7XG5cdFx0XG5cdFx0dGhpcy5saXN0RWwuc3R5bGUubWluV2lkdGggPSBlbGVtZW50Lm9mZnNldFdpZHRoICsgXCJweFwiO1xuXHRcdFxuXHRcdGlmKHRoaXMucGFyYW1zLm1heFdpZHRoKXtcblx0XHRcdGlmKHRoaXMucGFyYW1zLm1heFdpZHRoID09PSB0cnVlKXtcblx0XHRcdFx0dGhpcy5saXN0RWwuc3R5bGUubWF4V2lkdGggPSBlbGVtZW50Lm9mZnNldFdpZHRoICsgXCJweFwiO1xuXHRcdFx0fWVsc2UgaWYodHlwZW9mIHRoaXMucGFyYW1zLm1heFdpZHRoID09PSBcIm51bWJlclwiKXtcblx0XHRcdFx0dGhpcy5saXN0RWwuc3R5bGUubWF4V2lkdGggPSB0aGlzLnBhcmFtcy5tYXhXaWR0aCArIFwicHhcIjtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5saXN0RWwuc3R5bGUubWF4V2lkdGggPSB0aGlzLnBhcmFtcy5tYXhXaWR0aDtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdH1cblx0XG5cdF9jcmVhdGVJbnB1dEVsZW1lbnQoKXtcblx0XHR2YXIgYXR0cmlicyA9IHRoaXMucGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzO1xuXHRcdHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcblx0XHRcblx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIHRoaXMucGFyYW1zLmNsZWFyYWJsZSA/IFwic2VhcmNoXCIgOiBcInRleHRcIik7XG5cdFx0XG5cdFx0aW5wdXQuc3R5bGUucGFkZGluZyA9IFwiNHB4XCI7XG5cdFx0aW5wdXQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0XHRpbnB1dC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblx0XHRcblx0XHRpZighdGhpcy5wYXJhbXMuYXV0b2NvbXBsZXRlKXtcblx0XHRcdGlucHV0LnN0eWxlLmN1cnNvciA9IFwiZGVmYXVsdFwiO1xuXHRcdFx0aW5wdXQuc3R5bGUuY2FyZXRDb2xvciA9IFwidHJhbnNwYXJlbnRcIjtcblx0XHRcdC8vIGlucHV0LnJlYWRPbmx5ID0gKHRoaXMuZWRpdC5jdXJyZW50Q2VsbCAhPSBmYWxzZSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGF0dHJpYnMgJiYgdHlwZW9mIGF0dHJpYnMgPT0gXCJvYmplY3RcIil7XG5cdFx0XHRmb3IgKGxldCBrZXkgaW4gYXR0cmlicyl7XG5cdFx0XHRcdGlmKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpe1xuXHRcdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0XHRpbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBpbnB1dC5nZXRBdHRyaWJ1dGUoa2V5KSArIGF0dHJpYnNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGlucHV0LnNldEF0dHJpYnV0ZShrZXksIGF0dHJpYnNba2V5XSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy5wYXJhbXMubWFzayl7XG5cdFx0XHRtYXNrSW5wdXQoaW5wdXQsIHRoaXMucGFyYW1zKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5fYmluZElucHV0RXZlbnRzKGlucHV0KTtcblx0XHRcblx0XHRyZXR1cm4gaW5wdXQ7XG5cdH1cblx0XG5cdF9pbml0aWFsaXplUGFyYW1zKHBhcmFtcyl7XG5cdFx0dmFyIHZhbHVlS2V5cyA9IFtcInZhbHVlc1wiLCBcInZhbHVlc1VSTFwiLCBcInZhbHVlc0xvb2t1cFwiXSxcblx0XHR2YWx1ZUNoZWNrO1xuXHRcdFxuXHRcdHBhcmFtcyA9IE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcyk7XG5cdFx0XG5cdFx0cGFyYW1zLnZlcnRpY2FsTmF2aWdhdGlvbiA9IHBhcmFtcy52ZXJ0aWNhbE5hdmlnYXRpb24gfHwgXCJlZGl0b3JcIjtcblx0XHRwYXJhbXMucGxhY2Vob2xkZXJMb2FkaW5nID0gdHlwZW9mIHBhcmFtcy5wbGFjZWhvbGRlckxvYWRpbmcgPT09IFwidW5kZWZpbmVkXCIgPyBcIlNlYXJjaGluZyAuLi5cIiA6IHBhcmFtcy5wbGFjZWhvbGRlckxvYWRpbmc7XG5cdFx0cGFyYW1zLnBsYWNlaG9sZGVyRW1wdHkgPSB0eXBlb2YgcGFyYW1zLnBsYWNlaG9sZGVyRW1wdHkgPT09IFwidW5kZWZpbmVkXCIgPyBcIk5vIFJlc3VsdHMgRm91bmRcIiA6IHBhcmFtcy5wbGFjZWhvbGRlckVtcHR5O1xuXHRcdHBhcmFtcy5maWx0ZXJEZWxheSA9IHR5cGVvZiBwYXJhbXMuZmlsdGVyRGVsYXkgPT09IFwidW5kZWZpbmVkXCIgPyAzMDAgOiBwYXJhbXMuZmlsdGVyRGVsYXk7XG5cdFx0XG5cdFx0cGFyYW1zLmVtcHR5VmFsdWUgPSBPYmplY3Qua2V5cyhwYXJhbXMpLmluY2x1ZGVzKFwiZW1wdHlWYWx1ZVwiKSA/IHBhcmFtcy5lbXB0eVZhbHVlIDogXCJcIjtcblx0XHRcblx0XHR2YWx1ZUNoZWNrID0gT2JqZWN0LmtleXMocGFyYW1zKS5maWx0ZXIoa2V5ID0+IHZhbHVlS2V5cy5pbmNsdWRlcyhrZXkpKS5sZW5ndGg7XG5cdFx0XG5cdFx0aWYoIXZhbHVlQ2hlY2spe1xuXHRcdFx0Y29uc29sZS53YXJuKFwibGlzdCBlZGl0b3IgY29uZmlnIGVycm9yIC0gZWl0aGVyIHRoZSB2YWx1ZXMsIHZhbHVlc1VSTCwgb3IgdmFsdWVzTG9va3VwIG9wdGlvbiBtdXN0IGJlIHNldFwiKTtcblx0XHR9ZWxzZSBpZih2YWx1ZUNoZWNrID4gMSl7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJsaXN0IGVkaXRvciBjb25maWcgZXJyb3IgLSBvbmx5IG9uZSBvZiB0aGUgdmFsdWVzLCB2YWx1ZXNVUkwsIG9yIHZhbHVlc0xvb2t1cCBvcHRpb25zIGNhbiBiZSBzZXQgb24gdGhlIHNhbWUgZWRpdG9yXCIpO1xuXHRcdH1cblx0XHRcblx0XHRpZihwYXJhbXMuYXV0b2NvbXBsZXRlKXtcblx0XHRcdGlmKHBhcmFtcy5tdWx0aXNlbGVjdCl7XG5cdFx0XHRcdHBhcmFtcy5tdWx0aXNlbGVjdCA9IGZhbHNlO1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJsaXN0IGVkaXRvciBjb25maWcgZXJyb3IgLSBtdWx0aXNlbGVjdCBvcHRpb24gaXMgbm90IGF2YWlsYWJsZSB3aGVuIGF1dG9jb21wbGV0ZSBpcyBlbmFibGVkXCIpO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHBhcmFtcy5mcmVldGV4dCl7XG5cdFx0XHRcdHBhcmFtcy5mcmVldGV4dCA9IGZhbHNlO1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJsaXN0IGVkaXRvciBjb25maWcgZXJyb3IgLSBmcmVldGV4dCBvcHRpb24gaXMgb25seSBhdmFpbGFibGUgd2hlbiBhdXRvY29tcGxldGUgaXMgZW5hYmxlZFwiKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYocGFyYW1zLmZpbHRlckZ1bmMpe1xuXHRcdFx0XHRwYXJhbXMuZmlsdGVyRnVuYyA9IGZhbHNlO1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJsaXN0IGVkaXRvciBjb25maWcgZXJyb3IgLSBmaWx0ZXJGdW5jIG9wdGlvbiBpcyBvbmx5IGF2YWlsYWJsZSB3aGVuIGF1dG9jb21wbGV0ZSBpcyBlbmFibGVkXCIpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihwYXJhbXMuZmlsdGVyUmVtb3RlKXtcblx0XHRcdFx0cGFyYW1zLmZpbHRlclJlbW90ZSA9IGZhbHNlO1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJsaXN0IGVkaXRvciBjb25maWcgZXJyb3IgLSBmaWx0ZXJSZW1vdGUgb3B0aW9uIGlzIG9ubHkgYXZhaWxhYmxlIHdoZW4gYXV0b2NvbXBsZXRlIGlzIGVuYWJsZWRcIik7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHBhcmFtcy5tYXNrKXtcblx0XHRcdFx0cGFyYW1zLm1hc2sgPSBmYWxzZTtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwibGlzdCBlZGl0b3IgY29uZmlnIGVycm9yIC0gbWFzayBvcHRpb24gaXMgb25seSBhdmFpbGFibGUgd2hlbiBhdXRvY29tcGxldGUgaXMgZW5hYmxlZFwiKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYocGFyYW1zLmFsbG93RW1wdHkpe1xuXHRcdFx0XHRwYXJhbXMuYWxsb3dFbXB0eSA9IGZhbHNlO1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJsaXN0IGVkaXRvciBjb25maWcgZXJyb3IgLSBhbGxvd0VtcHR5IG9wdGlvbiBpcyBvbmx5IGF2YWlsYWJsZSB3aGVuIGF1dG9jb21wbGV0ZSBpcyBlbmFibGVkXCIpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihwYXJhbXMubGlzdE9uRW1wdHkpe1xuXHRcdFx0XHRwYXJhbXMubGlzdE9uRW1wdHkgPSBmYWxzZTtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwibGlzdCBlZGl0b3IgY29uZmlnIGVycm9yIC0gbGlzdE9uRW1wdHkgb3B0aW9uIGlzIG9ubHkgYXZhaWxhYmxlIHdoZW4gYXV0b2NvbXBsZXRlIGlzIGVuYWJsZWRcIik7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHBhcmFtcy5maWx0ZXJSZW1vdGUgJiYgISh0eXBlb2YgcGFyYW1zLnZhbHVlc0xvb2t1cCA9PT0gXCJmdW5jdGlvblwiIHx8IHBhcmFtcy52YWx1ZXNVUkwpKXtcblx0XHRcdHBhcmFtcy5maWx0ZXJSZW1vdGUgPSBmYWxzZTtcblx0XHRcdGNvbnNvbGUud2FybihcImxpc3QgZWRpdG9yIGNvbmZpZyBlcnJvciAtIGZpbHRlclJlbW90ZSBvcHRpb24gc2hvdWxkIG9ubHkgYmUgdXNlZCB3aGVuIHZhbHVlcyBsaXN0IGlzIHBvcHVsYXRlZCBmcm9tIGEgcmVtb3RlIHNvdXJjZVwiKTtcblx0XHR9XG5cdFx0cmV0dXJuIHBhcmFtcztcblx0fVxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vIEV2ZW50IEhhbmRsaW5nIC8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0X2JpbmRJbnB1dEV2ZW50cyhpbnB1dCl7XG5cdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsIHRoaXMuX2lucHV0Rm9jdXMuYmluZCh0aGlzKSk7XG5cdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2lucHV0Q2xpY2suYmluZCh0aGlzKSk7XG5cdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgdGhpcy5faW5wdXRCbHVyLmJpbmQodGhpcykpO1xuXHRcdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2lucHV0S2V5RG93bi5iaW5kKHRoaXMpKTtcblx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwic2VhcmNoXCIsIHRoaXMuX2lucHV0U2VhcmNoLmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdGlmKHRoaXMucGFyYW1zLmF1dG9jb21wbGV0ZSl7XG5cdFx0XHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5faW5wdXRLZXlVcC5iaW5kKHRoaXMpKTtcblx0XHR9XG5cdH1cblx0XG5cdFxuXHRfaW5wdXRGb2N1cyhlKXtcblx0XHR0aGlzLnJlYnVpbGRPcHRpb25zTGlzdCgpO1xuXHR9XG5cdFxuXHRfZmlsdGVyKCl7XG5cdFx0aWYodGhpcy5wYXJhbXMuZmlsdGVyUmVtb3RlKXtcblx0XHRcdGNsZWFyVGltZW91dCh0aGlzLmZpbHRlclRpbWVvdXQpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmZpbHRlclRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0dGhpcy5yZWJ1aWxkT3B0aW9uc0xpc3QoKTtcblx0XHRcdH0sIHRoaXMucGFyYW1zLmZpbHRlckRlbGF5KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLl9maWx0ZXJMaXN0KCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRfaW5wdXRDbGljayhlKXtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHR9XG5cdFxuXHRfaW5wdXRCbHVyKGUpe1xuXHRcdGlmKHRoaXMuYmx1cmFibGUpe1xuXHRcdFx0aWYodGhpcy5wb3B1cCl7XG5cdFx0XHRcdHRoaXMucG9wdXAuaGlkZSgpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLl9yZXNvbHZlVmFsdWUodHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRfaW5wdXRTZWFyY2goKXtcblx0XHR0aGlzLl9jbGVhckNob2ljZXMoKTtcblx0fVxuXHRcblx0X2lucHV0S2V5RG93bihlKXtcblx0XHRzd2l0Y2goZS5rZXlDb2RlKXtcblx0XHRcdFxuXHRcdFx0Y2FzZSAzODogLy91cCBhcnJvd1xuXHRcdFx0XHR0aGlzLl9rZXlVcChlKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgNDA6IC8vZG93biBhcnJvd1xuXHRcdFx0XHR0aGlzLl9rZXlEb3duKGUpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFxuXHRcdFx0Y2FzZSAzNzogLy9sZWZ0IGFycm93XG5cdFx0XHRjYXNlIDM5OiAvL3JpZ2h0IGFycm93XG5cdFx0XHRcdHRoaXMuX2tleVNpZGUoZSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIDEzOiAvL2VudGVyXG5cdFx0XHRcdHRoaXMuX2tleUVudGVyKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIDI3OiAvL2VzY2FwZVxuXHRcdFx0XHR0aGlzLl9rZXlFc2MoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgMzY6IC8vaG9tZVxuXHRcdFx0Y2FzZSAzNTogLy9lbmRcblx0XHRcdFx0dGhpcy5fa2V5SG9tZUVuZChlKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgOTogLy90YWJcblx0XHRcdFx0dGhpcy5fa2V5VGFiKGUpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0dGhpcy5fa2V5U2VsZWN0TGV0dGVyKGUpO1xuXHRcdH1cblx0fVxuXHRcblx0X2lucHV0S2V5VXAoZSl7XG5cdFx0c3dpdGNoKGUua2V5Q29kZSl7XG5cdFx0XHRjYXNlIDM4OiAvL3VwIGFycm93XG5cdFx0XHRjYXNlIDM3OiAvL2xlZnQgYXJyb3dcblx0XHRcdGNhc2UgMzk6IC8vdXAgYXJyb3dcblx0XHRcdGNhc2UgNDA6IC8vcmlnaHQgYXJyb3dcblx0XHRcdGNhc2UgMTM6IC8vZW50ZXJcblx0XHRcdGNhc2UgMjc6IC8vZXNjYXBlXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aGlzLl9rZXlBdXRvQ29tcExldHRlcihlKTtcblx0XHR9XG5cdH1cblx0XG5cdF9wcmV2ZW50UG9wdXBCbHVyKCl7XG5cdFx0aWYodGhpcy5wb3B1cCl7XG5cdFx0XHR0aGlzLnBvcHVwLmJsb2NrSGlkZSgpO1xuXHRcdH1cblx0XHRcblx0XHRzZXRUaW1lb3V0KCgpID0+e1xuXHRcdFx0aWYodGhpcy5wb3B1cCl7XG5cdFx0XHRcdHRoaXMucG9wdXAucmVzdG9yZUhpZGUoKTtcblx0XHRcdH1cblx0XHR9LCAxMCk7XG5cdH1cblx0XG5cdF9wcmV2ZW50Qmx1cigpe1xuXHRcdHRoaXMuYmx1cmFibGUgPSBmYWxzZTtcblx0XHRcblx0XHRzZXRUaW1lb3V0KCgpID0+e1xuXHRcdFx0dGhpcy5ibHVyYWJsZSA9IHRydWU7XG5cdFx0fSwgMTApO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLyBLZXlib2FyZCBOYXZpZ2F0aW9uIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0X2tleVRhYihlKXtcblx0XHRpZih0aGlzLnBhcmFtcy5hdXRvY29tcGxldGUgJiYgdGhpcy5sYXN0QWN0aW9uID09PSBcInR5cGluZ1wiKXtcblx0XHRcdHRoaXMuX3Jlc29sdmVWYWx1ZSh0cnVlKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRpZih0aGlzLmZvY3VzZWRJdGVtKXtcblx0XHRcdFx0dGhpcy5fY2hvb3NlSXRlbSh0aGlzLmZvY3VzZWRJdGVtLCB0cnVlKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdF9rZXlVcChlKXtcblx0XHR2YXIgaW5kZXggPSB0aGlzLmRpc3BsYXlJdGVtcy5pbmRleE9mKHRoaXMuZm9jdXNlZEl0ZW0pO1xuXHRcdFxuXHRcdGlmKHRoaXMucGFyYW1zLnZlcnRpY2FsTmF2aWdhdGlvbiA9PSBcImVkaXRvclwiIHx8ICh0aGlzLnBhcmFtcy52ZXJ0aWNhbE5hdmlnYXRpb24gPT0gXCJoeWJyaWRcIiAmJiBpbmRleCkpe1xuXHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcblx0XHRcdGlmKGluZGV4ID4gMCl7XG5cdFx0XHRcdHRoaXMuX2ZvY3VzSXRlbSh0aGlzLmRpc3BsYXlJdGVtc1tpbmRleCAtIDFdKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdF9rZXlEb3duKGUpe1xuXHRcdHZhciBpbmRleCA9IHRoaXMuZGlzcGxheUl0ZW1zLmluZGV4T2YodGhpcy5mb2N1c2VkSXRlbSk7XG5cdFx0XG5cdFx0aWYodGhpcy5wYXJhbXMudmVydGljYWxOYXZpZ2F0aW9uID09IFwiZWRpdG9yXCIgfHwgKHRoaXMucGFyYW1zLnZlcnRpY2FsTmF2aWdhdGlvbiA9PSBcImh5YnJpZFwiICYmIGluZGV4IDwgdGhpcy5kaXNwbGF5SXRlbXMubGVuZ3RoIC0gMSkpe1xuXHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcblx0XHRcdGlmKGluZGV4IDwgdGhpcy5kaXNwbGF5SXRlbXMubGVuZ3RoIC0gMSl7XG5cdFx0XHRcdGlmKGluZGV4ID09IC0xKXtcblx0XHRcdFx0XHR0aGlzLl9mb2N1c0l0ZW0odGhpcy5kaXNwbGF5SXRlbXNbMF0pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5fZm9jdXNJdGVtKHRoaXMuZGlzcGxheUl0ZW1zW2luZGV4ICsgMV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRfa2V5U2lkZShlKXtcblx0XHRpZighdGhpcy5wYXJhbXMuYXV0b2NvbXBsZXRlKXtcblx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH1cblx0fVxuXHRcblx0X2tleUVudGVyKGUpe1xuXHRcdGlmKHRoaXMucGFyYW1zLmF1dG9jb21wbGV0ZSAmJiB0aGlzLmxhc3RBY3Rpb24gPT09IFwidHlwaW5nXCIpe1xuXHRcdFx0dGhpcy5fcmVzb2x2ZVZhbHVlKHRydWUpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHRoaXMuZm9jdXNlZEl0ZW0pe1xuXHRcdFx0XHR0aGlzLl9jaG9vc2VJdGVtKHRoaXMuZm9jdXNlZEl0ZW0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0X2tleUVzYyhlKXtcblx0XHR0aGlzLl9jYW5jZWwoKTtcblx0fVxuXHRcblx0X2tleUhvbWVFbmQoZSl7XG5cdFx0aWYodGhpcy5wYXJhbXMuYXV0b2NvbXBsZXRlKXtcblx0XHRcdC8vcHJldmVudCB0YWJsZSBuYXZpZ2F0aW9uIHdoaWxlIHVzaW5nIGlucHV0IGVsZW1lbnRcblx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRfa2V5U2VsZWN0TGV0dGVyKGUpe1xuXHRcdGlmKCF0aGlzLnBhcmFtcy5hdXRvY29tcGxldGUpe1xuXHRcdFx0Ly8gaWYodGhpcy5lZGl0LmN1cnJlbnRDZWxsID09PSBmYWxzZSl7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHQvLyB9XG5cdFx0XHRcblx0XHRcdGlmKGUua2V5Q29kZSA+PSAzOCAmJiBlLmtleUNvZGUgPD0gOTApe1xuXHRcdFx0XHR0aGlzLl9zY3JvbGxUb1ZhbHVlKGUua2V5Q29kZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRfa2V5QXV0b0NvbXBMZXR0ZXIoZSl7XG5cdFx0dGhpcy5fZmlsdGVyKCk7XG5cdFx0dGhpcy5sYXN0QWN0aW9uID0gXCJ0eXBpbmdcIjtcblx0XHR0aGlzLnR5cGluZyA9IHRydWU7XG5cdH1cblx0XG5cdFxuXHRfc2Nyb2xsVG9WYWx1ZShjaGFyKXtcblx0XHRjbGVhclRpbWVvdXQodGhpcy5maWx0ZXJUaW1lb3V0KTtcblx0XHRcblx0XHR2YXIgY2hhcmFjdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyKS50b0xvd2VyQ2FzZSgpO1xuXHRcdHRoaXMuZmlsdGVyVGVybSArPSBjaGFyYWN0ZXIudG9Mb3dlckNhc2UoKTtcblx0XHRcblx0XHR2YXIgbWF0Y2ggPSB0aGlzLmRpc3BsYXlJdGVtcy5maW5kKChpdGVtKSA9PiB7XG5cdFx0XHRyZXR1cm4gdHlwZW9mIGl0ZW0ubGFiZWwgIT09IFwidW5kZWZpbmVkXCIgJiYgaXRlbS5sYWJlbC50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgodGhpcy5maWx0ZXJUZXJtKTtcblx0XHR9KTtcblx0XHRcblx0XHRpZihtYXRjaCl7XG5cdFx0XHR0aGlzLl9mb2N1c0l0ZW0obWF0Y2gpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmZpbHRlclRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdHRoaXMuZmlsdGVyVGVybSA9IFwiXCI7XG5cdFx0fSwgODAwKTtcblx0fVxuXHRcblx0X2ZvY3VzSXRlbShpdGVtKXtcblx0XHR0aGlzLmxhc3RBY3Rpb24gPSBcImZvY3VzXCI7XG5cdFx0XG5cdFx0aWYodGhpcy5mb2N1c2VkSXRlbSAmJiB0aGlzLmZvY3VzZWRJdGVtLmVsZW1lbnQpe1xuXHRcdFx0dGhpcy5mb2N1c2VkSXRlbS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJmb2N1c2VkXCIpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmZvY3VzZWRJdGVtID0gaXRlbTtcblx0XHRcblx0XHRpZihpdGVtICYmIGl0ZW0uZWxlbWVudCl7XG5cdFx0XHRpdGVtLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImZvY3VzZWRcIik7XG5cdFx0XHRpdGVtLmVsZW1lbnQuc2Nyb2xsSW50b1ZpZXcoe2JlaGF2aW9yOiAnc21vb3RoJywgYmxvY2s6ICduZWFyZXN0JywgaW5saW5lOiAnc3RhcnQnfSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLyBEYXRhIExpc3QgR2VuZXJhdGlvbiAvLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0aGVhZGVyRmlsdGVySW5pdGlhbExpc3RHZW4oKXtcblx0XHR0aGlzLl9nZW5lcmF0ZU9wdGlvbnModHJ1ZSk7XG5cdH1cblx0XG5cdHJlYnVpbGRPcHRpb25zTGlzdCgpe1xuXHRcdHRoaXMuX2dlbmVyYXRlT3B0aW9ucygpXG5cdFx0XHQudGhlbih0aGlzLl9zb3J0T3B0aW9ucy5iaW5kKHRoaXMpKVxuXHRcdFx0LnRoZW4odGhpcy5fYnVpbGRMaXN0LmJpbmQodGhpcykpXG5cdFx0XHQudGhlbih0aGlzLl9zaG93TGlzdC5iaW5kKHRoaXMpKVxuXHRcdFx0LmNhdGNoKChlKSA9PiB7XG5cdFx0XHRcdGlmKCFOdW1iZXIuaXNJbnRlZ2VyKGUpKXtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiTGlzdCBnZW5lcmF0aW9uIGVycm9yXCIsIGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0fVxuXHRcblx0X2ZpbHRlckxpc3QoKXtcblx0XHR0aGlzLl9idWlsZExpc3QodGhpcy5fZmlsdGVyT3B0aW9ucygpKTtcblx0XHR0aGlzLl9zaG93TGlzdCgpO1xuXHR9XG5cdFxuXHRfZ2VuZXJhdGVPcHRpb25zKHNpbGVudCl7XG5cdFx0dmFyIHZhbHVlcyA9IFtdO1xuXHRcdHZhciBpdGVyYXRpb24gPSArKyB0aGlzLmxpc3RJdGVyYXRpb247XG5cdFx0XG5cdFx0dGhpcy5maWx0ZXJlZCA9IGZhbHNlO1xuXHRcdFxuXHRcdGlmKHRoaXMucGFyYW1zLnZhbHVlcyl7XG5cdFx0XHR2YWx1ZXMgPSB0aGlzLnBhcmFtcy52YWx1ZXM7XG5cdFx0fWVsc2UgaWYgKHRoaXMucGFyYW1zLnZhbHVlc1VSTCl7XG5cdFx0XHR2YWx1ZXMgPSB0aGlzLl9hamF4UmVxdWVzdCh0aGlzLnBhcmFtcy52YWx1ZXNVUkwsIHRoaXMuaW5wdXQudmFsdWUpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHR5cGVvZiB0aGlzLnBhcmFtcy52YWx1ZXNMb29rdXAgPT09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRcdHZhbHVlcyA9IHRoaXMucGFyYW1zLnZhbHVlc0xvb2t1cCh0aGlzLmNlbGwsIHRoaXMuaW5wdXQudmFsdWUpO1xuXHRcdFx0fWVsc2UgaWYodGhpcy5wYXJhbXMudmFsdWVzTG9va3VwKXtcblx0XHRcdFx0dmFsdWVzID0gdGhpcy5fdW5pcXVlQ29sdW1uVmFsdWVzKHRoaXMucGFyYW1zLnZhbHVlc0xvb2t1cEZpZWxkKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0aWYodmFsdWVzIGluc3RhbmNlb2YgUHJvbWlzZSl7XG5cdFx0XHRpZighc2lsZW50KXtcblx0XHRcdFx0dGhpcy5fYWRkUGxhY2Vob2xkZXIodGhpcy5wYXJhbXMucGxhY2Vob2xkZXJMb2FkaW5nKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0cmV0dXJuIHZhbHVlcy50aGVuKClcblx0XHRcdFx0LnRoZW4oKHJlc3BvbnNlVmFsdWVzKSA9PiB7XG5cdFx0XHRcdFx0aWYodGhpcy5saXN0SXRlcmF0aW9uID09PSBpdGVyYXRpb24pe1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRoaXMuX3BhcnNlTGlzdChyZXNwb25zZVZhbHVlcyk7XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KGl0ZXJhdGlvbik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX3BhcnNlTGlzdCh2YWx1ZXMpKTtcblx0XHR9XG5cdH1cblx0XG5cdF9hZGRQbGFjZWhvbGRlcihjb250ZW50cyl7XG5cdFx0dmFyIHBsYWNlaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcblx0XHRpZih0eXBlb2YgY29udGVudHMgPT09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRjb250ZW50cyA9IGNvbnRlbnRzKHRoaXMuY2VsbC5nZXRDb21wb25lbnQoKSwgdGhpcy5saXN0RWwpO1xuXHRcdH1cblx0XHRcblx0XHRpZihjb250ZW50cyl7XG5cdFx0XHR0aGlzLl9jbGVhckxpc3QoKTtcblx0XHRcdFxuXHRcdFx0aWYoY29udGVudHMgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCl7XG5cdFx0XHRcdHBsYWNlaG9sZGVyID0gY29udGVudHM7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHBsYWNlaG9sZGVyLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdC1saXN0LXBsYWNlaG9sZGVyXCIpO1xuXHRcdFx0XHRwbGFjZWhvbGRlci5pbm5lckhUTUwgPSBjb250ZW50cztcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0dGhpcy5saXN0RWwuYXBwZW5kQ2hpbGQocGxhY2Vob2xkZXIpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLl9zaG93TGlzdCgpO1xuXHRcdH1cblx0fVxuXHRcblx0X2FqYXhSZXF1ZXN0KHVybCwgdGVybSl7XG5cdFx0dmFyIHBhcmFtcyA9IHRoaXMucGFyYW1zLmZpbHRlclJlbW90ZSA/IHt0ZXJtOnRlcm19IDoge307XG5cdFx0dXJsID0gdXJsQnVpbGRlcih1cmwsIHt9LCBwYXJhbXMpO1xuXHRcdFxuXHRcdHJldHVybiBmZXRjaCh1cmwpXG5cdFx0XHQudGhlbigocmVzcG9uc2UpPT57XG5cdFx0XHRcdGlmKHJlc3BvbnNlLm9rKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlLmpzb24oKVxuXHRcdFx0XHRcdFx0LmNhdGNoKChlcnJvcik9Pntcblx0XHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTGlzdCBBamF4IExvYWQgRXJyb3IgLSBJbnZhbGlkIEpTT04gcmV0dXJuZWRcIiwgZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiTGlzdCBBamF4IExvYWQgRXJyb3IgLSBDb25uZWN0aW9uIEVycm9yOiBcIiArIHJlc3BvbnNlLnN0YXR1cywgcmVzcG9uc2Uuc3RhdHVzVGV4dCk7XG5cdFx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdC5jYXRjaCgoZXJyb3IpPT57XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJMaXN0IEFqYXggTG9hZCBFcnJvciAtIENvbm5lY3Rpb24gRXJyb3I6IFwiLCBlcnJvcik7XG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG5cdFx0XHR9KTtcblx0fVxuXHRcblx0X3VuaXF1ZUNvbHVtblZhbHVlcyhmaWVsZCl7XG5cdFx0dmFyIG91dHB1dCA9IHt9LFxuXHRcdGRhdGEgPSB0aGlzLnRhYmxlLmdldERhdGEodGhpcy5wYXJhbXMudmFsdWVzTG9va3VwKSxcblx0XHRjb2x1bW47XG5cdFx0XG5cdFx0aWYoZmllbGQpe1xuXHRcdFx0Y29sdW1uID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldENvbHVtbkJ5RmllbGQoZmllbGQpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbHVtbiA9IHRoaXMuY2VsbC5nZXRDb2x1bW4oKS5fZ2V0U2VsZigpO1xuXHRcdH1cblx0XHRcblx0XHRpZihjb2x1bW4pe1xuXHRcdFx0ZGF0YS5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0dmFyIHZhbCA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKHJvdyk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZighdGhpcy5fZW1wdHlWYWx1ZUNoZWNrKHZhbCkpe1xuXHRcdFx0XHRcdGlmKHRoaXMucGFyYW1zLm11bHRpc2VsZWN0ICYmIEFycmF5LmlzQXJyYXkodmFsKSl7XG5cdFx0XHRcdFx0XHR2YWwuZm9yRWFjaCgoaXRlbSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRpZighdGhpcy5fZW1wdHlWYWx1ZUNoZWNrKGl0ZW0pKXtcblx0XHRcdFx0XHRcdFx0XHRvdXRwdXRbaXRlbV0gPSB0cnVlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRvdXRwdXRbdmFsXSA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJ1bmFibGUgdG8gZmluZCBtYXRjaGluZyBjb2x1bW4gdG8gY3JlYXRlIHNlbGVjdCBsb29rdXAgbGlzdDpcIiwgZmllbGQpO1xuXHRcdFx0b3V0cHV0ID0gW107XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBPYmplY3Qua2V5cyhvdXRwdXQpO1xuXHR9XG5cblx0X2VtcHR5VmFsdWVDaGVjayh2YWx1ZSl7XG5cdFx0cmV0dXJuIHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiB8fCB2YWx1ZSA9PT0gXCJcIjtcblx0fVxuXHRcblx0X3BhcnNlTGlzdChpbnB1dFZhbHVlcyl7XG5cdFx0dmFyIGRhdGEgPSBbXTtcblx0XHRcblx0XHRpZighQXJyYXkuaXNBcnJheShpbnB1dFZhbHVlcykpe1xuXHRcdFx0aW5wdXRWYWx1ZXMgPSBPYmplY3QuZW50cmllcyhpbnB1dFZhbHVlcykubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcblx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRsYWJlbDp2YWx1ZSxcblx0XHRcdFx0XHR2YWx1ZTprZXksXG5cdFx0XHRcdH07XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0XG5cdFx0aW5wdXRWYWx1ZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcblx0XHRcdGlmKHR5cGVvZiB2YWx1ZSAhPT0gXCJvYmplY3RcIil7XG5cdFx0XHRcdHZhbHVlID0ge1xuXHRcdFx0XHRcdGxhYmVsOnZhbHVlLFxuXHRcdFx0XHRcdHZhbHVlOnZhbHVlLFxuXHRcdFx0XHR9O1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLl9wYXJzZUxpc3RJdGVtKHZhbHVlLCBkYXRhLCAwKTtcblx0XHR9KTtcblx0XHRcblx0XHRpZighdGhpcy5jdXJyZW50SXRlbXMubGVuZ3RoICYmIHRoaXMucGFyYW1zLmZyZWV0ZXh0KXtcblx0XHRcdHRoaXMuaW5wdXQudmFsdWUgPSB0aGlzLmluaXRpYWxWYWx1ZXM7XG5cdFx0XHR0aGlzLnR5cGluZyA9IHRydWU7XG5cdFx0XHR0aGlzLmxhc3RBY3Rpb24gPSBcInR5cGluZ1wiO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmRhdGEgPSBkYXRhO1xuXHRcdFxuXHRcdHJldHVybiBkYXRhOyAgICBcblx0fVxuXHRcblx0X3BhcnNlTGlzdEl0ZW0ob3B0aW9uLCBkYXRhLCBsZXZlbCl7XG5cdFx0dmFyIGl0ZW0gPSB7fTtcblx0XHRcblx0XHRpZihvcHRpb24ub3B0aW9ucyl7XG5cdFx0XHRpdGVtID0gdGhpcy5fcGFyc2VMaXN0R3JvdXAob3B0aW9uLCBsZXZlbCArIDEpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGl0ZW0gPSB7XG5cdFx0XHRcdGxhYmVsOm9wdGlvbi5sYWJlbCxcblx0XHRcdFx0dmFsdWU6b3B0aW9uLnZhbHVlLFxuXHRcdFx0XHRpdGVtUGFyYW1zOm9wdGlvbi5pdGVtUGFyYW1zLFxuXHRcdFx0XHRlbGVtZW50QXR0cmlidXRlczogb3B0aW9uLmVsZW1lbnRBdHRyaWJ1dGVzLFxuXHRcdFx0XHRlbGVtZW50OmZhbHNlLFxuXHRcdFx0XHRzZWxlY3RlZDpmYWxzZSxcblx0XHRcdFx0dmlzaWJsZTp0cnVlLFxuXHRcdFx0XHRsZXZlbDpsZXZlbCxcblx0XHRcdFx0b3JpZ2luYWw6b3B0aW9uLFxuXHRcdFx0fTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5pbml0aWFsVmFsdWVzICYmIHRoaXMuaW5pdGlhbFZhbHVlcy5pbmRleE9mKG9wdGlvbi52YWx1ZSkgPiAtMSl7XG5cdFx0XHRcdHRoaXMuX2Nob29zZUl0ZW0oaXRlbSwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGRhdGEucHVzaChpdGVtKTtcblx0fVxuXHRcblx0X3BhcnNlTGlzdEdyb3VwKG9wdGlvbiwgbGV2ZWwpe1xuXHRcdHZhciBpdGVtID0ge1xuXHRcdFx0bGFiZWw6b3B0aW9uLmxhYmVsLFxuXHRcdFx0Z3JvdXA6dHJ1ZSxcblx0XHRcdGl0ZW1QYXJhbXM6b3B0aW9uLml0ZW1QYXJhbXMsXG5cdFx0XHRlbGVtZW50QXR0cmlidXRlczpvcHRpb24uZWxlbWVudEF0dHJpYnV0ZXMsXG5cdFx0XHRlbGVtZW50OmZhbHNlLFxuXHRcdFx0dmlzaWJsZTp0cnVlLFxuXHRcdFx0bGV2ZWw6bGV2ZWwsXG5cdFx0XHRvcHRpb25zOltdLFxuXHRcdFx0b3JpZ2luYWw6b3B0aW9uLFxuXHRcdH07XG5cdFx0XG5cdFx0b3B0aW9uLm9wdGlvbnMuZm9yRWFjaCgoY2hpbGQpID0+IHtcblx0XHRcdHRoaXMuX3BhcnNlTGlzdEl0ZW0oY2hpbGQsIGl0ZW0ub3B0aW9ucywgbGV2ZWwpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBpdGVtO1xuXHR9XG5cdFxuXHRfc29ydE9wdGlvbnMob3B0aW9ucyl7XG5cdFx0dmFyIHNvcnRlcjtcblx0XHRcblx0XHRpZih0aGlzLnBhcmFtcy5zb3J0KXtcblx0XHRcdHNvcnRlciA9IHR5cGVvZiB0aGlzLnBhcmFtcy5zb3J0ID09PSBcImZ1bmN0aW9uXCIgPyB0aGlzLnBhcmFtcy5zb3J0IDogdGhpcy5fZGVmYXVsdFNvcnRGdW5jdGlvbi5iaW5kKHRoaXMpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLl9zb3J0R3JvdXAoc29ydGVyLCBvcHRpb25zKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIG9wdGlvbnM7XG5cdH1cblx0XG5cdF9zb3J0R3JvdXAoc29ydGVyLCBvcHRpb25zKXtcblx0XHRvcHRpb25zLnNvcnQoKGEsYikgPT4ge1xuXHRcdFx0cmV0dXJuIHNvcnRlcihhLmxhYmVsLCBiLmxhYmVsLCBhLnZhbHVlLCBiLnZhbHVlLCBhLm9yaWdpbmFsLCBiLm9yaWdpbmFsKTtcblx0XHR9KTtcblx0XHRcblx0XHRvcHRpb25zLmZvckVhY2goKG9wdGlvbikgPT4ge1xuXHRcdFx0aWYob3B0aW9uLmdyb3VwKXtcblx0XHRcdFx0dGhpcy5fc29ydEdyb3VwKHNvcnRlciwgb3B0aW9uLm9wdGlvbnMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHRfZGVmYXVsdFNvcnRGdW5jdGlvbihhcywgYnMpe1xuXHRcdHZhciBhLCBiLCBhMSwgYjEsIGk9IDAsIEwsIHJ4ID0gLyhcXGQrKXwoXFxEKykvZywgcmQgPSAvXFxkLztcblx0XHR2YXIgZW1wdHlBbGlnbiA9IDA7XG5cdFx0XG5cdFx0aWYodGhpcy5wYXJhbXMuc29ydCA9PT0gXCJkZXNjXCIpe1xuXHRcdFx0W2FzLCBic10gPSBbYnMsIGFzXTtcblx0XHR9XG5cdFx0XG5cdFx0Ly9oYW5kbGUgZW1wdHkgdmFsdWVzXG5cdFx0aWYoIWFzICYmIGFzIT09IDApe1xuXHRcdFx0ZW1wdHlBbGlnbiA9ICAhYnMgJiYgYnMhPT0gMCA/IDAgOiAtMTtcblx0XHR9ZWxzZSBpZighYnMgJiYgYnMhPT0gMCl7XG5cdFx0XHRlbXB0eUFsaWduID0gIDE7XG5cdFx0fWVsc2Uge1xuXHRcdFx0aWYoaXNGaW5pdGUoYXMpICYmIGlzRmluaXRlKGJzKSkgcmV0dXJuIGFzIC0gYnM7XG5cdFx0XHRhID0gU3RyaW5nKGFzKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0YiA9IFN0cmluZyhicykudG9Mb3dlckNhc2UoKTtcblx0XHRcdGlmKGEgPT09IGIpIHJldHVybiAwO1xuXHRcdFx0aWYoIShyZC50ZXN0KGEpICYmIHJkLnRlc3QoYikpKSByZXR1cm4gYSA+IGIgPyAxIDogLTE7XG5cdFx0XHRhID0gYS5tYXRjaChyeCk7XG5cdFx0XHRiID0gYi5tYXRjaChyeCk7XG5cdFx0XHRMID0gYS5sZW5ndGggPiBiLmxlbmd0aCA/IGIubGVuZ3RoIDogYS5sZW5ndGg7XG5cdFx0XHR3aGlsZShpIDwgTCl7XG5cdFx0XHRcdGExPSBhW2ldO1xuXHRcdFx0XHRiMT0gYltpKytdO1xuXHRcdFx0XHRpZihhMSAhPT0gYjEpe1xuXHRcdFx0XHRcdGlmKGlzRmluaXRlKGExKSAmJiBpc0Zpbml0ZShiMSkpe1xuXHRcdFx0XHRcdFx0aWYoYTEuY2hhckF0KDApID09PSBcIjBcIikgYTEgPSBcIi5cIiArIGExO1xuXHRcdFx0XHRcdFx0aWYoYjEuY2hhckF0KDApID09PSBcIjBcIikgYjEgPSBcIi5cIiArIGIxO1xuXHRcdFx0XHRcdFx0cmV0dXJuIGExIC0gYjE7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGVsc2UgcmV0dXJuIGExID4gYjEgPyAxIDogLTE7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0cmV0dXJuIGEubGVuZ3RoID4gYi5sZW5ndGg7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBlbXB0eUFsaWduO1xuXHR9XG5cdFxuXHRfZmlsdGVyT3B0aW9ucygpe1xuXHRcdHZhciBmaWx0ZXJGdW5jID0gdGhpcy5wYXJhbXMuZmlsdGVyRnVuYyB8fCB0aGlzLl9kZWZhdWx0RmlsdGVyRnVuYyxcblx0XHR0ZXJtID0gdGhpcy5pbnB1dC52YWx1ZTtcblx0XHRcblx0XHRpZih0ZXJtKXtcblx0XHRcdHRoaXMuZmlsdGVyZWQgPSB0cnVlO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmRhdGEuZm9yRWFjaCgoaXRlbSkgPT4ge1xuXHRcdFx0XHR0aGlzLl9maWx0ZXJJdGVtKGZpbHRlckZ1bmMsIHRlcm0sIGl0ZW0pO1xuXHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5maWx0ZXJlZCA9IGZhbHNlO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gdGhpcy5kYXRhO1xuXHR9XG5cdFxuXHRfZmlsdGVySXRlbShmdW5jLCB0ZXJtLCBpdGVtKXtcblx0XHR2YXIgbWF0Y2hlcyA9IGZhbHNlO1xuXHRcdFxuXHRcdGlmKCFpdGVtLmdyb3VwKXtcblx0XHRcdGl0ZW0udmlzaWJsZSA9IGZ1bmModGVybSwgaXRlbS5sYWJlbCwgaXRlbS52YWx1ZSwgaXRlbS5vcmlnaW5hbCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0aXRlbS5vcHRpb25zLmZvckVhY2goKG9wdGlvbikgPT4ge1xuXHRcdFx0XHRpZih0aGlzLl9maWx0ZXJJdGVtKGZ1bmMsIHRlcm0sIG9wdGlvbikpe1xuXHRcdFx0XHRcdG1hdGNoZXMgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0aXRlbS52aXNpYmxlID0gbWF0Y2hlcztcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGl0ZW0udmlzaWJsZTtcblx0fVxuXHRcblx0X2RlZmF1bHRGaWx0ZXJGdW5jKHRlcm0sIGxhYmVsLCB2YWx1ZSwgaXRlbSl7XG5cdFx0dGVybSA9IFN0cmluZyh0ZXJtKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFxuXHRcdGlmKGxhYmVsICE9PSBudWxsICYmIHR5cGVvZiBsYWJlbCAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRpZihTdHJpbmcobGFiZWwpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXJtKSA+IC0xIHx8IFN0cmluZyh2YWx1ZSkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRlcm0pID4gLTEpe1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLyBEaXNwbGF5IExpc3QgLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0X2NsZWFyTGlzdCgpe1xuXHRcdHdoaWxlKHRoaXMubGlzdEVsLmZpcnN0Q2hpbGQpIHRoaXMubGlzdEVsLnJlbW92ZUNoaWxkKHRoaXMubGlzdEVsLmZpcnN0Q2hpbGQpO1xuXHRcdFxuXHRcdHRoaXMuZGlzcGxheUl0ZW1zID0gW107XG5cdH1cblx0XG5cdF9idWlsZExpc3QoZGF0YSl7XG5cdFx0dGhpcy5fY2xlYXJMaXN0KCk7XG5cdFx0XG5cdFx0ZGF0YS5mb3JFYWNoKChvcHRpb24pID0+IHtcblx0XHRcdHRoaXMuX2J1aWxkSXRlbShvcHRpb24pO1xuXHRcdH0pO1xuXHRcdFxuXHRcdGlmKCF0aGlzLmRpc3BsYXlJdGVtcy5sZW5ndGgpe1xuXHRcdFx0dGhpcy5fYWRkUGxhY2Vob2xkZXIodGhpcy5wYXJhbXMucGxhY2Vob2xkZXJFbXB0eSk7XG5cdFx0fSAgXG5cdH1cblx0XG5cdF9idWlsZEl0ZW0oaXRlbSl7XG5cdFx0dmFyIGVsID0gaXRlbS5lbGVtZW50LFxuXHRcdGNvbnRlbnRzO1xuXHRcdFxuXHRcdGlmKCF0aGlzLmZpbHRlcmVkIHx8IGl0ZW0udmlzaWJsZSl7XG5cdFx0XHRcblx0XHRcdGlmKCFlbCl7XG5cdFx0XHRcdGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFx0ZWwudGFiSW5kZXggPSAwO1xuXHRcdFx0XHRcblx0XHRcdFx0Y29udGVudHMgPSB0aGlzLnBhcmFtcy5pdGVtRm9ybWF0dGVyID8gdGhpcy5wYXJhbXMuaXRlbUZvcm1hdHRlcihpdGVtLmxhYmVsLCBpdGVtLnZhbHVlLCBpdGVtLm9yaWdpbmFsLCBlbCkgOiBpdGVtLmxhYmVsO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoY29udGVudHMgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCl7XG5cdFx0XHRcdFx0ZWwuYXBwZW5kQ2hpbGQoY29udGVudHMpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0ZWwuaW5uZXJIVE1MID0gY29udGVudHM7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKGl0ZW0uZ3JvdXApe1xuXHRcdFx0XHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdC1saXN0LWdyb3VwXCIpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0LWxpc3QtaXRlbVwiKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0LWxpc3QtZ3JvdXAtbGV2ZWwtXCIgKyBpdGVtLmxldmVsKTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKGl0ZW0uZWxlbWVudEF0dHJpYnV0ZXMgJiYgdHlwZW9mIGl0ZW0uZWxlbWVudEF0dHJpYnV0ZXMgPT0gXCJvYmplY3RcIil7XG5cdFx0XHRcdFx0Zm9yIChsZXQga2V5IGluIGl0ZW0uZWxlbWVudEF0dHJpYnV0ZXMpe1xuXHRcdFx0XHRcdFx0aWYoa2V5LmNoYXJBdCgwKSA9PSBcIitcIil7XG5cdFx0XHRcdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0XHRcdFx0ZWwuc2V0QXR0cmlidXRlKGtleSwgdGhpcy5pbnB1dC5nZXRBdHRyaWJ1dGUoa2V5KSArIGl0ZW0uZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0ZWwuc2V0QXR0cmlidXRlKGtleSwgaXRlbS5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKGl0ZW0uZ3JvdXApe1xuXHRcdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9ncm91cENsaWNrLmJpbmQodGhpcywgaXRlbSkpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2l0ZW1DbGljay5iaW5kKHRoaXMsIGl0ZW0pKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0ZWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9wcmV2ZW50Qmx1ci5iaW5kKHRoaXMpKTtcblx0XHRcdFx0XG5cdFx0XHRcdGl0ZW0uZWxlbWVudCA9IGVsO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLl9zdHlsZUl0ZW0oaXRlbSk7XG5cdFx0XHRcblx0XHRcdHRoaXMubGlzdEVsLmFwcGVuZENoaWxkKGVsKTtcblx0XHRcdFxuXHRcdFx0aWYoaXRlbS5ncm91cCl7XG5cdFx0XHRcdGl0ZW0ub3B0aW9ucy5mb3JFYWNoKChvcHRpb24pID0+IHtcblx0XHRcdFx0XHR0aGlzLl9idWlsZEl0ZW0ob3B0aW9uKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuZGlzcGxheUl0ZW1zLnB1c2goaXRlbSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRfc2hvd0xpc3QoKXtcblx0XHR2YXIgc3RhcnRWaXMgPSB0aGlzLnBvcHVwICYmIHRoaXMucG9wdXAuaXNWaXNpYmxlKCk7XG5cdFx0XG5cdFx0aWYodGhpcy5pbnB1dC5wYXJlbnROb2RlKXtcblx0XHRcdGlmKHRoaXMucGFyYW1zLmF1dG9jb21wbGV0ZSAmJiB0aGlzLmlucHV0LnZhbHVlID09PSBcIlwiICYmICF0aGlzLnBhcmFtcy5saXN0T25FbXB0eSl7XG5cdFx0XHRcdGlmKHRoaXMucG9wdXApe1xuXHRcdFx0XHRcdHRoaXMucG9wdXAuaGlkZSh0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuX3NldExpc3RXaWR0aCgpO1xuXHRcdFx0XG5cdFx0XHRpZighdGhpcy5wb3B1cCl7XG5cdFx0XHRcdHRoaXMucG9wdXAgPSB0aGlzLmVkaXQucG9wdXAodGhpcy5saXN0RWwpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnBvcHVwLnNob3codGhpcy5jZWxsLmdldEVsZW1lbnQoKSwgXCJib3R0b21cIik7XG5cdFx0XHRcblx0XHRcdGlmKCFzdGFydFZpcyl7XG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucG9wdXAuaGlkZU9uQmx1cih0aGlzLl9yZXNvbHZlVmFsdWUuYmluZCh0aGlzLCB0cnVlKSk7XG5cdFx0XHRcdH0sIDEwKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdF9zdHlsZUl0ZW0oaXRlbSl7XG5cdFx0aWYoaXRlbSAmJiBpdGVtLmVsZW1lbnQpe1xuXHRcdFx0aWYoaXRlbS5zZWxlY3RlZCl7XG5cdFx0XHRcdGl0ZW0uZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpdGVtLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBVc2VyIEludGVyYWN0aW9uIC8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRfaXRlbUNsaWNrKGl0ZW0sIGUpe1xuXHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XG5cdFx0dGhpcy5fY2hvb3NlSXRlbShpdGVtKTtcblx0fVxuXHRcblx0X2dyb3VwQ2xpY2soaXRlbSwgZSl7XG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0fVxuXHRcblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLyBDdXJyZW50IEl0ZW0gTWFuYWdlbWVudCAvLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRfY2FuY2VsKCl7XG5cdFx0dGhpcy5wb3B1cC5oaWRlKHRydWUpO1xuXHRcdHRoaXMuYWN0aW9ucy5jYW5jZWwoKTtcblx0fVxuXHRcblx0X2NsZWFyQ2hvaWNlcygpe1xuXHRcdHRoaXMudHlwaW5nID0gdHJ1ZTtcblx0XHRcblx0XHR0aGlzLmN1cnJlbnRJdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG5cdFx0XHRpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG5cdFx0XHR0aGlzLl9zdHlsZUl0ZW0oaXRlbSk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy5jdXJyZW50SXRlbXMgPSBbXTtcblx0XHRcblx0XHR0aGlzLmZvY3VzZWRJdGVtID0gbnVsbDtcblx0fVxuXHRcblx0X2Nob29zZUl0ZW0oaXRlbSwgc2lsZW50KXtcblx0XHR2YXIgaW5kZXg7XG5cdFx0XG5cdFx0dGhpcy50eXBpbmcgPSBmYWxzZTtcblx0XHRcblx0XHRpZih0aGlzLnBhcmFtcy5tdWx0aXNlbGVjdCl7XG5cdFx0XHRpbmRleCA9IHRoaXMuY3VycmVudEl0ZW1zLmluZGV4T2YoaXRlbSk7XG5cdFx0XHRcblx0XHRcdGlmKGluZGV4ID4gLTEpe1xuXHRcdFx0XHR0aGlzLmN1cnJlbnRJdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0XHRpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuY3VycmVudEl0ZW1zLnB1c2goaXRlbSk7XG5cdFx0XHRcdGl0ZW0uc2VsZWN0ZWQgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmlucHV0LnZhbHVlID0gdGhpcy5jdXJyZW50SXRlbXMubWFwKGl0ZW0gPT4gaXRlbS5sYWJlbCkuam9pbihcIixcIik7XG5cdFx0XHRcblx0XHRcdHRoaXMuX3N0eWxlSXRlbShpdGVtKTtcblx0XHRcdFxuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuY3VycmVudEl0ZW1zID0gW2l0ZW1dO1xuXHRcdFx0aXRlbS5zZWxlY3RlZCA9IHRydWU7XG5cdFx0XHRcblx0XHRcdHRoaXMuaW5wdXQudmFsdWUgPSBpdGVtLmxhYmVsO1xuXHRcdFx0XG5cdFx0XHR0aGlzLl9zdHlsZUl0ZW0oaXRlbSk7XG5cdFx0XHRcblx0XHRcdGlmKCFzaWxlbnQpe1xuXHRcdFx0XHR0aGlzLl9yZXNvbHZlVmFsdWUoKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5fZm9jdXNJdGVtKGl0ZW0pO1xuXHR9XG5cdFxuXHRfcmVzb2x2ZVZhbHVlKGJsdXIpe1xuXHRcdHZhciBvdXRwdXQsIGluaXRpYWxWYWx1ZTtcblx0XHRcblx0XHRpZih0aGlzLnBvcHVwKXtcblx0XHRcdHRoaXMucG9wdXAuaGlkZSh0cnVlKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy5wYXJhbXMubXVsdGlzZWxlY3Qpe1xuXHRcdFx0b3V0cHV0ID0gdGhpcy5jdXJyZW50SXRlbXMubWFwKGl0ZW0gPT4gaXRlbS52YWx1ZSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0aWYoYmx1ciAmJiB0aGlzLnBhcmFtcy5hdXRvY29tcGxldGUgJiYgdGhpcy50eXBpbmcpe1xuXHRcdFx0XHRpZih0aGlzLnBhcmFtcy5mcmVldGV4dCB8fCAodGhpcy5wYXJhbXMuYWxsb3dFbXB0eSAmJiB0aGlzLmlucHV0LnZhbHVlID09PSBcIlwiKSl7XG5cdFx0XHRcdFx0b3V0cHV0ID0gdGhpcy5pbnB1dC52YWx1ZTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuYWN0aW9ucy5jYW5jZWwoKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYodGhpcy5jdXJyZW50SXRlbXNbMF0pe1xuXHRcdFx0XHRcdG91dHB1dCA9IHRoaXMuY3VycmVudEl0ZW1zWzBdLnZhbHVlO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0aW5pdGlhbFZhbHVlID0gQXJyYXkuaXNBcnJheSh0aGlzLmluaXRpYWxWYWx1ZXMpID8gdGhpcy5pbml0aWFsVmFsdWVzWzBdIDogdGhpcy5pbml0aWFsVmFsdWVzO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKGluaXRpYWxWYWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgaW5pdGlhbFZhbHVlID09PSBcInVuZGVmaW5lZFwiIHx8IGluaXRpYWxWYWx1ZSA9PT0gXCJcIil7XG5cdFx0XHRcdFx0XHRvdXRwdXQgPSBpbml0aWFsVmFsdWU7XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0b3V0cHV0ID0gdGhpcy5wYXJhbXMuZW1wdHlWYWx1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGlmKG91dHB1dCA9PT0gXCJcIil7XG5cdFx0XHRvdXRwdXQgPSB0aGlzLnBhcmFtcy5lbXB0eVZhbHVlO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmFjdGlvbnMuc3VjY2VzcyhvdXRwdXQpO1xuXHRcdFxuXHRcdGlmKHRoaXMuaXNGaWx0ZXIpe1xuXHRcdFx0dGhpcy5pbml0aWFsVmFsdWVzID0gb3V0cHV0ICYmICFBcnJheS5pc0FycmF5KG91dHB1dCkgPyBbb3V0cHV0XSA6IG91dHB1dDtcblx0XHRcdHRoaXMuY3VycmVudEl0ZW1zID0gW107XG5cdFx0fVxuXHR9XG5cdFxufTtcblxuZnVuY3Rpb24gbGlzdChjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcyl7XG5cdHZhciBsaXN0ID0gbmV3IEVkaXQkMSh0aGlzLCBjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcyk7XG5cblx0cmV0dXJuIGxpc3QuaW5wdXQ7XG59XG5cbi8vc3RhciByYXRpbmdcbmZ1bmN0aW9uIHN0YXIkMShjZWxsLCBvblJlbmRlcmVkLCBzdWNjZXNzLCBjYW5jZWwsIGVkaXRvclBhcmFtcyl7XG5cdHZhciBzZWxmID0gdGhpcyxcblx0ZWxlbWVudCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHR2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0bWF4U3RhcnMgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic3ZnXCIpLmxlbmd0aCB8fCA1LFxuXHRzaXplID0gZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInN2Z1wiKVswXSA/IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzdmdcIilbMF0uZ2V0QXR0cmlidXRlKFwid2lkdGhcIikgOiAxNCxcblx0c3RhcnMgPSBbXSxcblx0c3RhcnNIb2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRzdGFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsIFwic3ZnXCIpO1xuXG5cblx0Ly9jaGFuZ2Ugc3RhciB0eXBlXG5cdGZ1bmN0aW9uIHN0YXJDaGFuZ2UodmFsKXtcblx0XHRzdGFycy5mb3JFYWNoKGZ1bmN0aW9uKHN0YXIsIGkpe1xuXHRcdFx0aWYoaSA8IHZhbCl7XG5cdFx0XHRcdGlmKHNlbGYudGFibGUuYnJvd3NlciA9PSBcImllXCIpe1xuXHRcdFx0XHRcdHN0YXIuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJ0YWJ1bGF0b3Itc3Rhci1hY3RpdmVcIik7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRzdGFyLmNsYXNzTGlzdC5yZXBsYWNlKFwidGFidWxhdG9yLXN0YXItaW5hY3RpdmVcIiwgXCJ0YWJ1bGF0b3Itc3Rhci1hY3RpdmVcIik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzdGFyLmlubmVySFRNTCA9ICc8cG9seWdvbiBmaWxsPVwiIzQ4OENFOVwiIHN0cm9rZT1cIiMwMTRBQUVcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZihzZWxmLnRhYmxlLmJyb3dzZXIgPT0gXCJpZVwiKXtcblx0XHRcdFx0XHRzdGFyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwidGFidWxhdG9yLXN0YXItaW5hY3RpdmVcIik7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRzdGFyLmNsYXNzTGlzdC5yZXBsYWNlKFwidGFidWxhdG9yLXN0YXItYWN0aXZlXCIsIFwidGFidWxhdG9yLXN0YXItaW5hY3RpdmVcIik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzdGFyLmlubmVySFRNTCA9ICc8cG9seWdvbiBmaWxsPVwiIzAxMDE1NVwiIHN0cm9rZT1cIiM2ODY4NjhcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0Ly9idWlsZCBzdGFyc1xuXHRmdW5jdGlvbiBidWlsZFN0YXIoaSl7XG5cblx0XHR2YXIgc3RhckhvbGRlciA9ICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcblx0XHR2YXIgbmV4dFN0YXIgPSBzdGFyLmNsb25lTm9kZSh0cnVlKTtcblxuXHRcdHN0YXJzLnB1c2gobmV4dFN0YXIpO1xuXG5cdFx0c3RhckhvbGRlci5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBmdW5jdGlvbihlKXtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdFx0c3RhckNoYW5nZShpKTtcblx0XHR9KTtcblxuXHRcdHN0YXJIb2xkZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbihlKXtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXHRcdH0pO1xuXG5cdFx0c3RhckhvbGRlci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSl7XG5cdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblx0XHRcdHN1Y2Nlc3MoaSk7XG5cdFx0XHRlbGVtZW50LmJsdXIoKTtcblx0XHR9KTtcblxuXHRcdHN0YXJIb2xkZXIuYXBwZW5kQ2hpbGQobmV4dFN0YXIpO1xuXHRcdHN0YXJzSG9sZGVyLmFwcGVuZENoaWxkKHN0YXJIb2xkZXIpO1xuXG5cdH1cblxuXHQvL2hhbmRsZSBrZXlib2FyZCBuYXZpZ2F0aW9uIHZhbHVlIGNoYW5nZVxuXHRmdW5jdGlvbiBjaGFuZ2VWYWx1ZSh2YWwpe1xuXHRcdHZhbHVlID0gdmFsO1xuXHRcdHN0YXJDaGFuZ2UodmFsKTtcblx0fVxuXG5cdC8vc3R5bGUgY2VsbFxuXHRlbGVtZW50LnN0eWxlLndoaXRlU3BhY2UgPSBcIm5vd3JhcFwiO1xuXHRlbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblx0ZWxlbWVudC5zdHlsZS50ZXh0T3ZlcmZsb3cgPSBcImVsbGlwc2lzXCI7XG5cblx0Ly9zdHlsZSBob2xkaW5nIGVsZW1lbnRcblx0c3RhcnNIb2xkZXIuc3R5bGUudmVydGljYWxBbGlnbiA9IFwibWlkZGxlXCI7XG5cdHN0YXJzSG9sZGVyLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuXHRzdGFyc0hvbGRlci5zdHlsZS5wYWRkaW5nID0gXCI0cHhcIjtcblxuXHQvL3N0eWxlIHN0YXJcblx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLCBzaXplKTtcblx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwgc2l6ZSk7XG5cdHN0YXIuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBcIjAgMCA1MTIgNTEyXCIpO1xuXHRzdGFyLnNldEF0dHJpYnV0ZShcInhtbDpzcGFjZVwiLCBcInByZXNlcnZlXCIpO1xuXHRzdGFyLnN0eWxlLnBhZGRpbmcgPSBcIjAgMXB4XCI7XG5cblx0aWYoZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzICYmIHR5cGVvZiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgPT0gXCJvYmplY3RcIil7XG5cdFx0Zm9yIChsZXQga2V5IGluIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyl7XG5cdFx0XHRpZihrZXkuY2hhckF0KDApID09IFwiK1wiKXtcblx0XHRcdFx0a2V5ID0ga2V5LnNsaWNlKDEpO1xuXHRcdFx0XHRzdGFyc0hvbGRlci5zZXRBdHRyaWJ1dGUoa2V5LCBzdGFyc0hvbGRlci5nZXRBdHRyaWJ1dGUoa2V5KSArIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1tcIitcIiArIGtleV0pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRzdGFyc0hvbGRlci5zZXRBdHRyaWJ1dGUoa2V5LCBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNba2V5XSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly9jcmVhdGUgY29ycmVjdCBudW1iZXIgb2Ygc3RhcnNcblx0Zm9yKHZhciBpPTE7aTw9IG1heFN0YXJzO2krKyl7XG5cdFx0YnVpbGRTdGFyKGkpO1xuXHR9XG5cblx0Ly9lbnN1cmUgdmFsdWUgZG9lcyBub3QgZXhjZWVkIG51bWJlciBvZiBzdGFyc1xuXHR2YWx1ZSA9IE1hdGgubWluKHBhcnNlSW50KHZhbHVlKSwgbWF4U3RhcnMpO1xuXG5cdC8vIHNldCBpbml0aWFsIHN0eWxpbmcgb2Ygc3RhcnNcblx0c3RhckNoYW5nZSh2YWx1ZSk7XG5cblx0c3RhcnNIb2xkZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbihlKXtcblx0XHRzdGFyQ2hhbmdlKDApO1xuXHR9KTtcblxuXHRzdGFyc0hvbGRlci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZSl7XG5cdFx0c3VjY2VzcygwKTtcblx0fSk7XG5cblx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCBmdW5jdGlvbihlKXtcblx0XHRjYW5jZWwoKTtcblx0fSk7XG5cblx0Ly9hbGxvdyBrZXkgYmFzZWQgbmF2aWdhdGlvblxuXHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdHN3aXRjaChlLmtleUNvZGUpe1xuXHRcdFx0Y2FzZSAzOTogLy9yaWdodCBhcnJvd1xuXHRcdFx0XHRjaGFuZ2VWYWx1ZSh2YWx1ZSArIDEpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSAzNzogLy9sZWZ0IGFycm93XG5cdFx0XHRcdGNoYW5nZVZhbHVlKHZhbHVlIC0gMSk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIDEzOiAvL2VudGVyXG5cdFx0XHRcdHN1Y2Nlc3ModmFsdWUpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSAyNzogLy9lc2NhcGVcblx0XHRcdFx0Y2FuY2VsKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fSk7XG5cblx0cmV0dXJuIHN0YXJzSG9sZGVyO1xufVxuXG4vL2RyYWdnYWJsZSBwcm9ncmVzcyBiYXJcbmZ1bmN0aW9uIHByb2dyZXNzJDEoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpe1xuXHR2YXIgZWxlbWVudCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRtYXggPSB0eXBlb2YgZWRpdG9yUGFyYW1zLm1heCA9PT0gXCJ1bmRlZmluZWRcIiA/ICgoZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRpdlwiKVswXSAmJiBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiZGl2XCIpWzBdLmdldEF0dHJpYnV0ZShcIm1heFwiKSkgfHwgMTAwKSA6IGVkaXRvclBhcmFtcy5tYXgsXG5cdG1pbiA9IHR5cGVvZiBlZGl0b3JQYXJhbXMubWluID09PSBcInVuZGVmaW5lZFwiID8gKChlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiZGl2XCIpWzBdICYmIGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkaXZcIilbMF0uZ2V0QXR0cmlidXRlKFwibWluXCIpKSB8fCAwKSA6IGVkaXRvclBhcmFtcy5taW4sXG5cdHBlcmNlbnQgPSAobWF4IC0gbWluKSAvIDEwMCxcblx0dmFsdWUgPSBjZWxsLmdldFZhbHVlKCkgfHwgMCxcblx0aGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0YmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0bW91c2VEcmFnLCBtb3VzZURyYWdXaWR0aDtcblxuXHQvL3NldCBuZXcgdmFsdWVcblx0ZnVuY3Rpb24gdXBkYXRlVmFsdWUoKXtcblx0XHR2YXIgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKTtcblxuXHRcdHZhciBjYWxjVmFsID0gKHBlcmNlbnQgKiBNYXRoLnJvdW5kKGJhci5vZmZzZXRXaWR0aCAvICgoZWxlbWVudC5jbGllbnRXaWR0aCAtIHBhcnNlSW50KHN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCJwYWRkaW5nLWxlZnRcIikpIC0gcGFyc2VJbnQoc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShcInBhZGRpbmctcmlnaHRcIikpKS8xMDApKSkgKyBtaW47XG5cdFx0c3VjY2VzcyhjYWxjVmFsKTtcblx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtdmFsdWVub3dcIiwgY2FsY1ZhbCk7XG5cdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHZhbHVlKTtcblx0fVxuXG5cdC8vc3R5bGUgaGFuZGxlXG5cdGhhbmRsZS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblx0aGFuZGxlLnN0eWxlLnJpZ2h0ID0gXCIwXCI7XG5cdGhhbmRsZS5zdHlsZS50b3AgPSBcIjBcIjtcblx0aGFuZGxlLnN0eWxlLmJvdHRvbSA9IFwiMFwiO1xuXHRoYW5kbGUuc3R5bGUud2lkdGggPSBcIjVweFwiO1xuXHRoYW5kbGUuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcm9ncmVzcy1oYW5kbGVcIik7XG5cblx0Ly9zdHlsZSBiYXJcblx0YmFyLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuXHRiYXIuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG5cdC8vIGJhci5zdHlsZS50b3AgPSBcIjhweFwiO1xuXHQvLyBiYXIuc3R5bGUuYm90dG9tID0gXCI4cHhcIjtcblx0Ly8gYmFyLnN0eWxlLmxlZnQgPSBcIjRweFwiO1xuXHQvLyBiYXIuc3R5bGUubWFyZ2luUmlnaHQgPSBcIjRweFwiO1xuXHRiYXIuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cdGJhci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiM0ODhDRTlcIjtcblx0YmFyLnN0eWxlLm1heFdpZHRoID0gXCIxMDAlXCI7XG5cdGJhci5zdHlsZS5taW5XaWR0aCA9IFwiMCVcIjtcblxuXHRpZihlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMgJiYgdHlwZW9mIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyA9PSBcIm9iamVjdFwiKXtcblx0XHRmb3IgKGxldCBrZXkgaW4gZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzKXtcblx0XHRcdGlmKGtleS5jaGFyQXQoMCkgPT0gXCIrXCIpe1xuXHRcdFx0XHRrZXkgPSBrZXkuc2xpY2UoMSk7XG5cdFx0XHRcdGJhci5zZXRBdHRyaWJ1dGUoa2V5LCBiYXIuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0YmFyLnNldEF0dHJpYnV0ZShrZXksIGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlc1trZXldKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvL3N0eWxlIGNlbGxcblx0ZWxlbWVudC5zdHlsZS5wYWRkaW5nID0gXCI0cHggNHB4XCI7XG5cblx0Ly9tYWtlIHN1cmUgdmFsdWUgaXMgaW4gcmFuZ2Vcblx0dmFsdWUgPSBNYXRoLm1pbihwYXJzZUZsb2F0KHZhbHVlKSwgbWF4KTtcblx0dmFsdWUgPSBNYXRoLm1heChwYXJzZUZsb2F0KHZhbHVlKSwgbWluKTtcblxuXHQvL3dvcmtvdXQgcGVyY2VudGFnZVxuXHR2YWx1ZSA9IE1hdGgucm91bmQoKHZhbHVlIC0gbWluKSAvIHBlcmNlbnQpO1xuXHQvLyBiYXIuc3R5bGUucmlnaHQgPSB2YWx1ZSArIFwiJVwiO1xuXHRiYXIuc3R5bGUud2lkdGggPSB2YWx1ZSArIFwiJVwiO1xuXG5cdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS12YWx1ZW1pblwiLCBtaW4pO1xuXHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtdmFsdWVtYXhcIiwgbWF4KTtcblxuXHRiYXIuYXBwZW5kQ2hpbGQoaGFuZGxlKTtcblxuXHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKXtcblx0XHRtb3VzZURyYWcgPSBlLnNjcmVlblg7XG5cdFx0bW91c2VEcmFnV2lkdGggPSBiYXIub2Zmc2V0V2lkdGg7XG5cdH0pO1xuXG5cdGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uKCl7XG5cdFx0aGFuZGxlLnN0eWxlLmN1cnNvciA9IFwiZXctcmVzaXplXCI7XG5cdH0pO1xuXG5cdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbihlKXtcblx0XHRpZihtb3VzZURyYWcpe1xuXHRcdFx0YmFyLnN0eWxlLndpZHRoID0gKG1vdXNlRHJhZ1dpZHRoICsgZS5zY3JlZW5YIC0gbW91c2VEcmFnKSArIFwicHhcIjtcblx0XHR9XG5cdH0pO1xuXG5cdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24oZSl7XG5cdFx0aWYobW91c2VEcmFnKXtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuXG5cdFx0XHRtb3VzZURyYWcgPSBmYWxzZTtcblx0XHRcdG1vdXNlRHJhZ1dpZHRoID0gZmFsc2U7XG5cblx0XHRcdHVwZGF0ZVZhbHVlKCk7XG5cdFx0fVxuXHR9KTtcblxuXHQvL2FsbG93IGtleSBiYXNlZCBuYXZpZ2F0aW9uXG5cdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24oZSl7XG5cdFx0c3dpdGNoKGUua2V5Q29kZSl7XG5cdFx0XHRjYXNlIDM5OiAvL3JpZ2h0IGFycm93XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0YmFyLnN0eWxlLndpZHRoID0gKGJhci5jbGllbnRXaWR0aCArIGVsZW1lbnQuY2xpZW50V2lkdGgvMTAwKSArIFwicHhcIjtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgMzc6IC8vbGVmdCBhcnJvd1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGJhci5zdHlsZS53aWR0aCA9IChiYXIuY2xpZW50V2lkdGggLSBlbGVtZW50LmNsaWVudFdpZHRoLzEwMCkgKyBcInB4XCI7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIDk6IC8vdGFiXG5cdFx0XHRjYXNlIDEzOiAvL2VudGVyXG5cdFx0XHRcdHVwZGF0ZVZhbHVlKCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIDI3OiAvL2VzY2FwZVxuXHRcdFx0XHRjYW5jZWwoKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHR9XG5cdH0pO1xuXG5cdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgZnVuY3Rpb24oKXtcblx0XHRjYW5jZWwoKTtcblx0fSk7XG5cblx0cmV0dXJuIGJhcjtcbn1cblxuLy9jaGVja2JveFxuZnVuY3Rpb24gdGlja0Nyb3NzJDEoY2VsbCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBlZGl0b3JQYXJhbXMpe1xuXHR2YXIgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpLFxuXHR0cmlzdGF0ZSA9IGVkaXRvclBhcmFtcy50cmlzdGF0ZSxcblx0aW5kZXRlcm1WYWx1ZSA9IHR5cGVvZiBlZGl0b3JQYXJhbXMuaW5kZXRlcm1pbmF0ZVZhbHVlID09PSBcInVuZGVmaW5lZFwiID8gbnVsbCA6IGVkaXRvclBhcmFtcy5pbmRldGVybWluYXRlVmFsdWUsXG5cdGluZGV0ZXJtU3RhdGUgPSBmYWxzZSxcblx0dHJ1ZVZhbHVlU2V0ID0gT2JqZWN0LmtleXMoZWRpdG9yUGFyYW1zKS5pbmNsdWRlcyhcInRydWVWYWx1ZVwiKSxcblx0ZmFsc2VWYWx1ZVNldCA9IE9iamVjdC5rZXlzKGVkaXRvclBhcmFtcykuaW5jbHVkZXMoXCJmYWxzZVZhbHVlXCIpO1xuXHRcblx0aW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImNoZWNrYm94XCIpO1xuXHRpbnB1dC5zdHlsZS5tYXJnaW5Ub3AgPSBcIjVweFwiO1xuXHRpbnB1dC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcblx0XG5cdGlmKGVkaXRvclBhcmFtcy5lbGVtZW50QXR0cmlidXRlcyAmJiB0eXBlb2YgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzID09IFwib2JqZWN0XCIpe1xuXHRcdGZvciAobGV0IGtleSBpbiBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXMpe1xuXHRcdFx0aWYoa2V5LmNoYXJBdCgwKSA9PSBcIitcIil7XG5cdFx0XHRcdGtleSA9IGtleS5zbGljZSgxKTtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgaW5wdXQuZ2V0QXR0cmlidXRlKGtleSkgKyBlZGl0b3JQYXJhbXMuZWxlbWVudEF0dHJpYnV0ZXNbXCIrXCIgKyBrZXldKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aW5wdXQuc2V0QXR0cmlidXRlKGtleSwgZWRpdG9yUGFyYW1zLmVsZW1lbnRBdHRyaWJ1dGVzW2tleV0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0aW5wdXQudmFsdWUgPSB2YWx1ZTtcblx0XG5cdGlmKHRyaXN0YXRlICYmICh0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIgfHwgdmFsdWUgPT09IGluZGV0ZXJtVmFsdWUgfHwgdmFsdWUgPT09IFwiXCIpKXtcblx0XHRpbmRldGVybVN0YXRlID0gdHJ1ZTtcblx0XHRpbnB1dC5pbmRldGVybWluYXRlID0gdHJ1ZTtcblx0fVxuXHRcblx0aWYodGhpcy50YWJsZS5icm93c2VyICE9IFwiZmlyZWZveFwiICYmIHRoaXMudGFibGUuYnJvd3NlciAhPSBcInNhZmFyaVwiKXsgLy9wcmV2ZW50IGJsdXIgaXNzdWUgb24gbWFjIGZpcmVmb3hcblx0XHRvblJlbmRlcmVkKGZ1bmN0aW9uKCl7XG5cdFx0XHRpZihjZWxsLmdldFR5cGUoKSA9PT0gXCJjZWxsXCIpe1xuXHRcdFx0XHRpbnB1dC5mb2N1cyh7cHJldmVudFNjcm9sbDogdHJ1ZX0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHRpbnB1dC5jaGVja2VkID0gdHJ1ZVZhbHVlU2V0ID8gdmFsdWUgPT09IGVkaXRvclBhcmFtcy50cnVlVmFsdWUgOiAodmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09IFwidHJ1ZVwiIHx8IHZhbHVlID09PSBcIlRydWVcIiB8fCB2YWx1ZSA9PT0gMSk7XG5cdFxuXHRmdW5jdGlvbiBzZXRWYWx1ZShibHVyKXtcblx0XHR2YXIgY2hlY2tlZFZhbHVlID0gaW5wdXQuY2hlY2tlZDtcblx0XHRcblx0XHRpZih0cnVlVmFsdWVTZXQgJiYgY2hlY2tlZFZhbHVlKXtcblx0XHRcdGNoZWNrZWRWYWx1ZSA9IGVkaXRvclBhcmFtcy50cnVlVmFsdWU7XG5cdFx0fWVsc2UgaWYoZmFsc2VWYWx1ZVNldCAmJiAhY2hlY2tlZFZhbHVlKXtcblx0XHRcdGNoZWNrZWRWYWx1ZSA9IGVkaXRvclBhcmFtcy5mYWxzZVZhbHVlO1xuXHRcdH1cblx0XHRcblx0XHRpZih0cmlzdGF0ZSl7XG5cdFx0XHRpZighYmx1cil7XG5cdFx0XHRcdGlmKGlucHV0LmNoZWNrZWQgJiYgIWluZGV0ZXJtU3RhdGUpe1xuXHRcdFx0XHRcdGlucHV0LmNoZWNrZWQgPSBmYWxzZTtcblx0XHRcdFx0XHRpbnB1dC5pbmRldGVybWluYXRlID0gdHJ1ZTtcblx0XHRcdFx0XHRpbmRldGVybVN0YXRlID0gdHJ1ZTtcblx0XHRcdFx0XHRyZXR1cm4gaW5kZXRlcm1WYWx1ZTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGluZGV0ZXJtU3RhdGUgPSBmYWxzZTtcblx0XHRcdFx0XHRyZXR1cm4gY2hlY2tlZFZhbHVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGlmKGluZGV0ZXJtU3RhdGUpe1xuXHRcdFx0XHRcdHJldHVybiBpbmRldGVybVZhbHVlO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGNoZWNrZWRWYWx1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiBjaGVja2VkVmFsdWU7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3N1Ym1pdCBuZXcgdmFsdWUgb24gYmx1clxuXHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdHN1Y2Nlc3Moc2V0VmFsdWUoKSk7XG5cdH0pO1xuXG5cdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdHN1Y2Nlc3Moc2V0VmFsdWUodHJ1ZSkpO1xuXHR9KTtcblx0XG5cdC8vc3VibWl0IG5ldyB2YWx1ZSBvbiBlbnRlclxuXHRpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbihlKXtcblx0XHRpZihlLmtleUNvZGUgPT0gMTMpe1xuXHRcdFx0c3VjY2VzcyhzZXRWYWx1ZSgpKTtcblx0XHR9XG5cdFx0aWYoZS5rZXlDb2RlID09IDI3KXtcblx0XHRcdGNhbmNlbCgpO1xuXHRcdH1cblx0fSk7XG5cdFxuXHRyZXR1cm4gaW5wdXQ7XG59XG5cbmZ1bmN0aW9uIGFkYXB0YWJsZSQxKGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgcGFyYW1zKXtcclxuXHR2YXIgY29sdW1uID0gY2VsbC5fZ2V0U2VsZigpLmNvbHVtbixcclxuXHRsb29rdXAsIGVkaXRvckZ1bmMsIGVkaXRvclBhcmFtcztcclxuICAgIFxyXG5cdGZ1bmN0aW9uIGRlZmF1bHRMb29rdXAoY2VsbCl7XHJcblx0XHR2YXIgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXHJcblx0XHRlZGl0b3IgPSBcImlucHV0XCI7XHJcbiAgICAgICAgXHJcblx0XHRzd2l0Y2godHlwZW9mIHZhbHVlKXtcclxuXHRcdFx0Y2FzZSBcIm51bWJlclwiOlxyXG5cdFx0XHRcdGVkaXRvciA9IFwibnVtYmVyXCI7XHJcblx0XHRcdFx0YnJlYWs7XHJcbiAgICAgICAgICAgIFxyXG5cdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxyXG5cdFx0XHRcdGVkaXRvciA9IFwidGlja0Nyb3NzXCI7XHJcblx0XHRcdFx0YnJlYWs7XHJcbiAgICAgICAgICAgIFxyXG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XHJcblx0XHRcdFx0aWYodmFsdWUuaW5jbHVkZXMoXCJcXG5cIikpe1xyXG5cdFx0XHRcdFx0ZWRpdG9yID0gXCJ0ZXh0YXJlYVwiO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRicmVhaztcclxuXHRcdH1cclxuICAgICAgICBcclxuXHRcdHJldHVybiBlZGl0b3I7XHJcblx0fVxyXG4gICAgXHJcblx0bG9va3VwID0gcGFyYW1zLmVkaXRvckxvb2t1cCA/IHBhcmFtcy5lZGl0b3JMb29rdXAoY2VsbCkgOiBkZWZhdWx0TG9va3VwKGNlbGwpO1xyXG5cclxuXHRpZihwYXJhbXMucGFyYW1zTG9va3VwKXtcclxuXHRcdGVkaXRvclBhcmFtcyA9IHR5cGVvZiBwYXJhbXMucGFyYW1zTG9va3VwID09PSBcImZ1bmN0aW9uXCIgPyBwYXJhbXMucGFyYW1zTG9va3VwKGxvb2t1cCwgY2VsbCkgOiBwYXJhbXMucGFyYW1zTG9va3VwW2xvb2t1cF07XHJcblx0fVxyXG5cclxuXHRlZGl0b3JGdW5jID0gdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQubG9va3VwRWRpdG9yKGxvb2t1cCwgY29sdW1uKTtcclxuICAgIFxyXG5cdHJldHVybiAgZWRpdG9yRnVuYy5jYWxsKHRoaXMsIGNlbGwsIG9uUmVuZGVyZWQsIHN1Y2Nlc3MsIGNhbmNlbCwgZWRpdG9yUGFyYW1zIHx8IHt9KTtcclxufVxuXG52YXIgZGVmYXVsdEVkaXRvcnMgPSB7XG5cdGlucHV0OmlucHV0LFxuXHR0ZXh0YXJlYTp0ZXh0YXJlYSQxLFxuXHRudW1iZXI6bnVtYmVyJDEsXG5cdHJhbmdlOnJhbmdlLFxuXHRkYXRlOmRhdGUkMSxcblx0dGltZTp0aW1lJDEsXG5cdGRhdGV0aW1lOmRhdGV0aW1lJDIsXG5cdGxpc3Q6bGlzdCxcblx0c3RhcjpzdGFyJDEsXG5cdHByb2dyZXNzOnByb2dyZXNzJDEsXG5cdHRpY2tDcm9zczp0aWNrQ3Jvc3MkMSxcblx0YWRhcHRhYmxlOmFkYXB0YWJsZSQxLFxufTtcblxuY2xhc3MgRWRpdCBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwiZWRpdFwiO1xuXG5cdC8vbG9hZCBkZWZhdWx0c1xuXHRzdGF0aWMgZWRpdG9ycyA9IGRlZmF1bHRFZGl0b3JzO1xuXHRcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLmN1cnJlbnRDZWxsID0gZmFsc2U7IC8vaG9sZCBjdXJyZW50bHkgZWRpdGluZyBjZWxsXG5cdFx0dGhpcy5tb3VzZUNsaWNrID0gZmFsc2U7IC8vaG9sZCBtb3VzZWRvd24gc3RhdGUgdG8gcHJldmVudCBjbGljayBiaW5kaW5nIGJlaW5nIG92ZXJyaWRkZW4gYnkgZWRpdG9yIG9wZW5pbmdcblx0XHR0aGlzLnJlY3Vyc2lvbkJsb2NrID0gZmFsc2U7IC8vcHJldmVudCBmb2N1cyByZWN1cnNpb25cblx0XHR0aGlzLmludmFsaWRFZGl0ID0gZmFsc2U7XG5cdFx0dGhpcy5lZGl0ZWRDZWxscyA9IFtdO1xuXHRcdHRoaXMuY29udmVydEVtcHR5VmFsdWVzID0gZmFsc2U7XG5cdFx0XG5cdFx0dGhpcy5lZGl0b3JzID0gRWRpdC5lZGl0b3JzO1xuXHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJlZGl0VHJpZ2dlckV2ZW50XCIsIFwiZm9jdXNcIik7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZWRpdG9yRW1wdHlWYWx1ZVwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJlZGl0b3JFbXB0eVZhbHVlRnVuY1wiLCB0aGlzLmVtcHR5VmFsdWVDaGVjay5iaW5kKHRoaXMpKTtcblxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJlZGl0YWJsZVwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiZWRpdG9yXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJlZGl0b3JQYXJhbXNcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImVkaXRvckVtcHR5VmFsdWVcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImVkaXRvckVtcHR5VmFsdWVGdW5jXCIpO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJjZWxsRWRpdGluZ1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiY2VsbEVkaXRlZFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiY2VsbEVkaXRDYW5jZWxsZWRcIik7XG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRFZGl0ZWRDZWxsc1wiLCB0aGlzLmdldEVkaXRlZENlbGxzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiY2xlYXJDZWxsRWRpdGVkXCIsIHRoaXMuY2xlYXJDZWxsRWRpdGVkLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwibmF2aWdhdGVQcmV2XCIsIHRoaXMubmF2aWdhdGVQcmV2LmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwibmF2aWdhdGVOZXh0XCIsIHRoaXMubmF2aWdhdGVOZXh0LmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwibmF2aWdhdGVMZWZ0XCIsIHRoaXMubmF2aWdhdGVMZWZ0LmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwibmF2aWdhdGVSaWdodFwiLCB0aGlzLm5hdmlnYXRlUmlnaHQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJuYXZpZ2F0ZVVwXCIsIHRoaXMubmF2aWdhdGVVcC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcIm5hdmlnYXRlRG93blwiLCB0aGlzLm5hdmlnYXRlRG93bi5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJjZWxsXCIsIFwiaXNFZGl0ZWRcIiwgdGhpcy5jZWxsSXNFZGl0ZWQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY2VsbFwiLCBcImNsZWFyRWRpdGVkXCIsIHRoaXMuY2xlYXJFZGl0ZWQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY2VsbFwiLCBcImVkaXRcIiwgdGhpcy5lZGl0Q2VsbC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJjZWxsXCIsIFwiY2FuY2VsRWRpdFwiLCB0aGlzLmNlbGxDYW5jZWxFZGl0LmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcImNlbGxcIiwgXCJuYXZpZ2F0ZVByZXZcIiwgdGhpcy5uYXZpZ2F0ZVByZXYuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY2VsbFwiLCBcIm5hdmlnYXRlTmV4dFwiLCB0aGlzLm5hdmlnYXRlTmV4dC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJjZWxsXCIsIFwibmF2aWdhdGVMZWZ0XCIsIHRoaXMubmF2aWdhdGVMZWZ0LmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcImNlbGxcIiwgXCJuYXZpZ2F0ZVJpZ2h0XCIsIHRoaXMubmF2aWdhdGVSaWdodC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJjZWxsXCIsIFwibmF2aWdhdGVVcFwiLCB0aGlzLm5hdmlnYXRlVXAuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY2VsbFwiLCBcIm5hdmlnYXRlRG93blwiLCB0aGlzLm5hdmlnYXRlRG93bi5iaW5kKHRoaXMpKTtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1pbml0XCIsIHRoaXMuYmluZEVkaXRvci5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtZGVsZXRlXCIsIHRoaXMuY2xlYXJFZGl0ZWQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLXZhbHVlLWNoYW5nZWRcIiwgdGhpcy51cGRhdGVDZWxsQ2xhc3MuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tbGF5b3V0XCIsIHRoaXMuaW5pdGlhbGl6ZUNvbHVtbkNoZWNrLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWRlbGV0ZVwiLCB0aGlzLmNvbHVtbkRlbGV0ZUNoZWNrLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWRlbGV0aW5nXCIsIHRoaXMucm93RGVsZXRlQ2hlY2suYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctbGF5b3V0XCIsIHRoaXMucm93RWRpdGFibGVDaGVjay5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImRhdGEtcmVmcmVzaGluZ1wiLCB0aGlzLmNhbmNlbEVkaXQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjbGlwYm9hcmQtcGFzdGVcIiwgdGhpcy5wYXN0ZUJsb2NrZXIuYmluZCh0aGlzKSk7XG5cdFx0XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJrZXliaW5kaW5nLW5hdi1wcmV2XCIsIHRoaXMubmF2aWdhdGVQcmV2LmJpbmQodGhpcywgdW5kZWZpbmVkKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJrZXliaW5kaW5nLW5hdi1uZXh0XCIsIHRoaXMua2V5YmluZGluZ05hdmlnYXRlTmV4dC5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHQvLyB0aGlzLnN1YnNjcmliZShcImtleWJpbmRpbmctbmF2LWxlZnRcIiwgdGhpcy5uYXZpZ2F0ZUxlZnQuYmluZCh0aGlzLCB1bmRlZmluZWQpKTtcblx0XHQvLyB0aGlzLnN1YnNjcmliZShcImtleWJpbmRpbmctbmF2LXJpZ2h0XCIsIHRoaXMubmF2aWdhdGVSaWdodC5iaW5kKHRoaXMsIHVuZGVmaW5lZCkpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwia2V5YmluZGluZy1uYXYtdXBcIiwgdGhpcy5uYXZpZ2F0ZVVwLmJpbmQodGhpcywgdW5kZWZpbmVkKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJrZXliaW5kaW5nLW5hdi1kb3duXCIsIHRoaXMubmF2aWdhdGVEb3duLmJpbmQodGhpcywgdW5kZWZpbmVkKSk7XG5cblx0XHRpZihPYmplY3Qua2V5cyh0aGlzLnRhYmxlLm9wdGlvbnMpLmluY2x1ZGVzKFwiZWRpdG9yRW1wdHlWYWx1ZVwiKSl7XG5cdFx0XHR0aGlzLmNvbnZlcnRFbXB0eVZhbHVlcyA9IHRydWU7XG5cdFx0fVxuXHR9XG5cdFxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIFBhc3RlIE5lZ2F0aW9uIC8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdHBhc3RlQmxvY2tlcihlKXtcblx0XHRpZih0aGlzLmN1cnJlbnRDZWxsKXtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0fVxuXHRcblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLyBLZXliaW5kaW5nIEZ1bmN0aW9ucyAvLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRrZXliaW5kaW5nTmF2aWdhdGVOZXh0KGUpe1xuXHRcdHZhciBjZWxsID0gdGhpcy5jdXJyZW50Q2VsbCxcblx0XHRuZXdSb3cgPSB0aGlzLm9wdGlvbnMoXCJ0YWJFbmROZXdSb3dcIik7XG5cblx0XHRpZihjZWxsKXtcblx0XHRcdGlmKCF0aGlzLm5hdmlnYXRlTmV4dChjZWxsLCBlKSl7XG5cdFx0XHRcdGlmKG5ld1Jvdyl7XG5cdFx0XHRcdFx0Y2VsbC5nZXRFbGVtZW50KCkuZmlyc3RDaGlsZC5ibHVyKCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYoIXRoaXMuaW52YWxpZEVkaXQpe1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZihuZXdSb3cgPT09IHRydWUpe1xuXHRcdFx0XHRcdFx0XHRuZXdSb3cgPSB0aGlzLnRhYmxlLmFkZFJvdyh7fSk7XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGlmKHR5cGVvZiBuZXdSb3cgPT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0XHRcdFx0XHRuZXdSb3cgPSB0aGlzLnRhYmxlLmFkZFJvdyhuZXdSb3coY2VsbC5yb3cuZ2V0Q29tcG9uZW50KCkpKTtcblx0XHRcdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdG5ld1JvdyA9IHRoaXMudGFibGUuYWRkUm93KE9iamVjdC5hc3NpZ24oe30sIG5ld1JvdykpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdG5ld1Jvdy50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0Y2VsbC5nZXRDb21wb25lbnQoKS5uYXZpZ2F0ZU5leHQoKTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBDZWxsIEZ1bmN0aW9ucyAvLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRjZWxsSXNFZGl0ZWQoY2VsbCl7XG5cdFx0cmV0dXJuICEhIGNlbGwubW9kdWxlcy5lZGl0ICYmIGNlbGwubW9kdWxlcy5lZGl0LmVkaXRlZDtcblx0fVxuXHRcblx0Y2VsbENhbmNlbEVkaXQoY2VsbCl7XG5cdFx0aWYoY2VsbCA9PT0gdGhpcy5jdXJyZW50Q2VsbCl7XG5cdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jYW5jZWxFZGl0KCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiQ2FuY2VsIEVkaXRvciBFcnJvciAtIFRoaXMgY2VsbCBpcyBub3QgY3VycmVudGx5IGJlaW5nIGVkaXRlZCBcIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIFRhYmxlIEZ1bmN0aW9ucyAvLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0dXBkYXRlQ2VsbENsYXNzKGNlbGwpe1xuXHRcdGlmKHRoaXMuYWxsb3dFZGl0KGNlbGwpKSB7XG5cdFx0XHRjZWxsLmdldEVsZW1lbnQoKS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWVkaXRhYmxlXCIpO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItZWRpdGFibGVcIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRjbGVhckNlbGxFZGl0ZWQoY2VsbHMpe1xuXHRcdGlmKCFjZWxscyl7XG5cdFx0XHRjZWxscyA9IHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmdldEVkaXRlZENlbGxzKCk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCFBcnJheS5pc0FycmF5KGNlbGxzKSl7XG5cdFx0XHRjZWxscyA9IFtjZWxsc107XG5cdFx0fVxuXHRcdFxuXHRcdGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmNsZWFyRWRpdGVkKGNlbGwuX2dldFNlbGYoKSk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdG5hdmlnYXRlUHJldihjZWxsID0gdGhpcy5jdXJyZW50Q2VsbCwgZSl7XG5cdFx0dmFyIG5leHRDZWxsLCBwcmV2Um93O1xuXHRcdFxuXHRcdGlmKGNlbGwpe1xuXHRcdFx0XG5cdFx0XHRpZihlKXtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRuZXh0Q2VsbCA9IHRoaXMubmF2aWdhdGVMZWZ0KCk7XG5cdFx0XHRcblx0XHRcdGlmKG5leHRDZWxsKXtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHByZXZSb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIucHJldkRpc3BsYXlSb3coY2VsbC5yb3csIHRydWUpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYocHJldlJvdyl7XG5cdFx0XHRcdFx0bmV4dENlbGwgPSB0aGlzLmZpbmRQcmV2RWRpdGFibGVDZWxsKHByZXZSb3csIHByZXZSb3cuY2VsbHMubGVuZ3RoKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZihuZXh0Q2VsbCl7XG5cdFx0XHRcdFx0XHRuZXh0Q2VsbC5nZXRDb21wb25lbnQoKS5lZGl0KCk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdFxuXHRuYXZpZ2F0ZU5leHQoY2VsbCA9IHRoaXMuY3VycmVudENlbGwsIGUpe1xuXHRcdHZhciBuZXh0Q2VsbCwgbmV4dFJvdztcblx0XHRcblx0XHRpZihjZWxsKXtcblx0XHRcdFxuXHRcdFx0aWYoZSl7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0bmV4dENlbGwgPSB0aGlzLm5hdmlnYXRlUmlnaHQoKTtcblx0XHRcdFxuXHRcdFx0aWYobmV4dENlbGwpe1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0bmV4dFJvdyA9IHRoaXMudGFibGUucm93TWFuYWdlci5uZXh0RGlzcGxheVJvdyhjZWxsLnJvdywgdHJ1ZSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihuZXh0Um93KXtcblx0XHRcdFx0XHRuZXh0Q2VsbCA9IHRoaXMuZmluZE5leHRFZGl0YWJsZUNlbGwobmV4dFJvdywgLTEpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKG5leHRDZWxsKXtcblx0XHRcdFx0XHRcdG5leHRDZWxsLmdldENvbXBvbmVudCgpLmVkaXQoKTtcblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0XG5cdG5hdmlnYXRlTGVmdChjZWxsID0gdGhpcy5jdXJyZW50Q2VsbCwgZSl7XG5cdFx0dmFyIGluZGV4LCBuZXh0Q2VsbDtcblx0XHRcblx0XHRpZihjZWxsKXtcblx0XHRcdFxuXHRcdFx0aWYoZSl7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aW5kZXggPSBjZWxsLmdldEluZGV4KCk7XG5cdFx0XHRuZXh0Q2VsbCA9IHRoaXMuZmluZFByZXZFZGl0YWJsZUNlbGwoY2VsbC5yb3csIGluZGV4KTtcblx0XHRcdFxuXHRcdFx0aWYobmV4dENlbGwpe1xuXHRcdFx0XHRuZXh0Q2VsbC5nZXRDb21wb25lbnQoKS5lZGl0KCk7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0XG5cdG5hdmlnYXRlUmlnaHQoY2VsbCA9IHRoaXMuY3VycmVudENlbGwsIGUpe1xuXHRcdHZhciBpbmRleCwgbmV4dENlbGw7XG5cdFx0XG5cdFx0aWYoY2VsbCl7XG5cdFx0XHRcblx0XHRcdGlmKGUpe1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGluZGV4ID0gY2VsbC5nZXRJbmRleCgpO1xuXHRcdFx0bmV4dENlbGwgPSB0aGlzLmZpbmROZXh0RWRpdGFibGVDZWxsKGNlbGwucm93LCBpbmRleCk7XG5cdFx0XHRcblx0XHRcdGlmKG5leHRDZWxsKXtcblx0XHRcdFx0bmV4dENlbGwuZ2V0Q29tcG9uZW50KCkuZWRpdCgpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdFxuXHRuYXZpZ2F0ZVVwKGNlbGwgPSB0aGlzLmN1cnJlbnRDZWxsLCBlKXtcblx0XHR2YXIgaW5kZXgsIG5leHRSb3c7XG5cdFx0XG5cdFx0aWYoY2VsbCl7XG5cdFx0XHRcblx0XHRcdGlmKGUpe1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGluZGV4ID0gY2VsbC5nZXRJbmRleCgpO1xuXHRcdFx0bmV4dFJvdyA9IHRoaXMudGFibGUucm93TWFuYWdlci5wcmV2RGlzcGxheVJvdyhjZWxsLnJvdywgdHJ1ZSk7XG5cdFx0XHRcblx0XHRcdGlmKG5leHRSb3cpe1xuXHRcdFx0XHRuZXh0Um93LmNlbGxzW2luZGV4XS5nZXRDb21wb25lbnQoKS5lZGl0KCk7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0XG5cdG5hdmlnYXRlRG93bihjZWxsID0gdGhpcy5jdXJyZW50Q2VsbCwgZSl7XG5cdFx0dmFyIGluZGV4LCBuZXh0Um93O1xuXHRcdFxuXHRcdGlmKGNlbGwpe1xuXHRcdFx0XG5cdFx0XHRpZihlKXtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpbmRleCA9IGNlbGwuZ2V0SW5kZXgoKTtcblx0XHRcdG5leHRSb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIubmV4dERpc3BsYXlSb3coY2VsbC5yb3csIHRydWUpO1xuXHRcdFx0XG5cdFx0XHRpZihuZXh0Um93KXtcblx0XHRcdFx0bmV4dFJvdy5jZWxsc1tpbmRleF0uZ2V0Q29tcG9uZW50KCkuZWRpdCgpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdFxuXHRmaW5kTmV4dEVkaXRhYmxlQ2VsbChyb3csIGluZGV4KXtcblx0XHR2YXIgbmV4dENlbGwgPSBmYWxzZTtcblx0XHRcblx0XHRpZihpbmRleCA8IHJvdy5jZWxscy5sZW5ndGgtMSl7XG5cdFx0XHRmb3IodmFyIGkgPSBpbmRleCsxOyBpIDwgcm93LmNlbGxzLmxlbmd0aDsgaSsrKXtcblx0XHRcdFx0bGV0IGNlbGwgPSByb3cuY2VsbHNbaV07XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQgJiYgSGVscGVycy5lbFZpc2libGUoY2VsbC5nZXRFbGVtZW50KCkpKXtcblx0XHRcdFx0XHRsZXQgYWxsb3dFZGl0ID0gdGhpcy5hbGxvd0VkaXQoY2VsbCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYoYWxsb3dFZGl0KXtcblx0XHRcdFx0XHRcdG5leHRDZWxsID0gY2VsbDtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gbmV4dENlbGw7XG5cdH1cblx0XG5cdGZpbmRQcmV2RWRpdGFibGVDZWxsKHJvdywgaW5kZXgpe1xuXHRcdHZhciBwcmV2Q2VsbCA9IGZhbHNlO1xuXHRcdFxuXHRcdGlmKGluZGV4ID4gMCl7XG5cdFx0XHRmb3IodmFyIGkgPSBpbmRleC0xOyBpID49IDA7IGktLSl7XG5cdFx0XHRcdGxldCBjZWxsID0gcm93LmNlbGxzW2ldO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoY2VsbC5jb2x1bW4ubW9kdWxlcy5lZGl0ICYmIEhlbHBlcnMuZWxWaXNpYmxlKGNlbGwuZ2V0RWxlbWVudCgpKSl7XG5cdFx0XHRcdFx0bGV0IGFsbG93RWRpdCA9IHRoaXMuYWxsb3dFZGl0KGNlbGwpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKGFsbG93RWRpdCl7XG5cdFx0XHRcdFx0XHRwcmV2Q2VsbCA9IGNlbGw7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHByZXZDZWxsO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gSW50ZXJuYWwgTG9naWMgLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0aW5pdGlhbGl6ZUNvbHVtbkNoZWNrKGNvbHVtbil7XG5cdFx0aWYodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmVkaXRvciAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVDb2x1bW4oY29sdW1uKTtcblx0XHR9XG5cdH1cblx0XG5cdGNvbHVtbkRlbGV0ZUNoZWNrKGNvbHVtbil7XG5cdFx0aWYodGhpcy5jdXJyZW50Q2VsbCAmJiB0aGlzLmN1cnJlbnRDZWxsLmNvbHVtbiA9PT0gY29sdW1uKXtcblx0XHRcdHRoaXMuY2FuY2VsRWRpdCgpO1xuXHRcdH1cblx0fVxuXHRcblx0cm93RGVsZXRlQ2hlY2socm93KXtcblx0XHRpZih0aGlzLmN1cnJlbnRDZWxsICYmIHRoaXMuY3VycmVudENlbGwucm93ID09PSByb3cpe1xuXHRcdFx0dGhpcy5jYW5jZWxFZGl0KCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRyb3dFZGl0YWJsZUNoZWNrKHJvdyl7XG5cdFx0cm93LmdldENlbGxzKCkuZm9yRWFjaCgoY2VsbCkgPT4ge1xuXHRcdFx0aWYoY2VsbC5jb2x1bW4ubW9kdWxlcy5lZGl0ICYmIHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2sgPT09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRcdHRoaXMudXBkYXRlQ2VsbENsYXNzKGNlbGwpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHQvL2luaXRpYWxpemUgY29sdW1uIGVkaXRvclxuXHRpbml0aWFsaXplQ29sdW1uKGNvbHVtbil7XG5cdFx0dmFyIGNvbnZlcnRFbXB0eSA9IE9iamVjdC5rZXlzKGNvbHVtbi5kZWZpbml0aW9uKS5pbmNsdWRlcyhcImVkaXRvckVtcHR5VmFsdWVcIik7XG5cblx0XHR2YXIgY29uZmlnID0ge1xuXHRcdFx0ZWRpdG9yOmZhbHNlLFxuXHRcdFx0YmxvY2tlZDpmYWxzZSxcblx0XHRcdGNoZWNrOmNvbHVtbi5kZWZpbml0aW9uLmVkaXRhYmxlLFxuXHRcdFx0cGFyYW1zOmNvbHVtbi5kZWZpbml0aW9uLmVkaXRvclBhcmFtcyB8fCB7fSxcblx0XHRcdGNvbnZlcnRFbXB0eVZhbHVlczpjb252ZXJ0RW1wdHksXG5cdFx0XHRlZGl0b3JFbXB0eVZhbHVlOmNvbHVtbi5kZWZpbml0aW9uLmVkaXRvckVtcHR5VmFsdWUsXG5cdFx0XHRlZGl0b3JFbXB0eVZhbHVlRnVuYzpjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3JFbXB0eVZhbHVlRnVuYyxcblx0XHR9O1xuXHRcdFxuXHRcdC8vc2V0IGNvbHVtbiBlZGl0b3Jcblx0XHRjb25maWcuZWRpdG9yID0gdGhpcy5sb29rdXBFZGl0b3IoY29sdW1uLmRlZmluaXRpb24uZWRpdG9yLCBjb2x1bW4pO1xuXHRcdFxuXHRcdGlmKGNvbmZpZy5lZGl0b3Ipe1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZWRpdCA9IGNvbmZpZztcblx0XHR9XG5cdH1cblxuXHRsb29rdXBFZGl0b3IoZWRpdG9yLCBjb2x1bW4pe1xuXHRcdHZhciBlZGl0b3JGdW5jO1xuXG5cdFx0c3dpdGNoKHR5cGVvZiBlZGl0b3Ipe1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRpZih0aGlzLmVkaXRvcnNbZWRpdG9yXSl7XG5cdFx0XHRcdFx0ZWRpdG9yRnVuYyA9IHRoaXMuZWRpdG9yc1tlZGl0b3JdO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRWRpdG9yIEVycm9yIC0gTm8gc3VjaCBlZGl0b3IgZm91bmQ6IFwiLCBlZGl0b3IpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0ZWRpdG9yRnVuYyA9IGVkaXRvcjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJib29sZWFuXCI6XG5cdFx0XHRcdGlmKGVkaXRvciA9PT0gdHJ1ZSl7XG5cdFx0XHRcdFx0aWYodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlciAhPT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0XHRcdGlmKHRoaXMuZWRpdG9yc1tjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXJdKXtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yRnVuYyA9IHRoaXMuZWRpdG9yc1tjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXJdO1xuXHRcdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0XHRlZGl0b3JGdW5jID0gdGhpcy5lZGl0b3JzW1wiaW5wdXRcIl07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRWRpdG9yIEVycm9yIC0gQ2Fubm90IGF1dG8gbG9va3VwIGVkaXRvciBmb3IgYSBjdXN0b20gZm9ybWF0dGVyOiBcIiwgY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGVkaXRvckZ1bmM7XG5cdH1cblx0XG5cdGdldEN1cnJlbnRDZWxsKCl7XG5cdFx0cmV0dXJuIHRoaXMuY3VycmVudENlbGwgPyB0aGlzLmN1cnJlbnRDZWxsLmdldENvbXBvbmVudCgpIDogZmFsc2U7XG5cdH1cblx0XG5cdGNsZWFyRWRpdG9yKGNhbmNlbCl7XG5cdFx0dmFyIGNlbGwgPSB0aGlzLmN1cnJlbnRDZWxsLFxuXHRcdGNlbGxFbDtcblx0XHRcblx0XHR0aGlzLmludmFsaWRFZGl0ID0gZmFsc2U7XG5cdFx0XG5cdFx0aWYoY2VsbCl7XG5cdFx0XHR0aGlzLmN1cnJlbnRDZWxsID0gZmFsc2U7XG5cdFx0XHRcblx0XHRcdGNlbGxFbCA9IGNlbGwuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwiZWRpdC1lZGl0b3ItY2xlYXJcIiwgY2VsbCwgY2FuY2VsKTtcblx0XHRcdFxuXHRcdFx0Y2VsbEVsLmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItZWRpdGluZ1wiKTtcblx0XHRcdFxuXHRcdFx0d2hpbGUoY2VsbEVsLmZpcnN0Q2hpbGQpIGNlbGxFbC5yZW1vdmVDaGlsZChjZWxsRWwuZmlyc3RDaGlsZCk7XG5cdFx0XHRcblx0XHRcdGNlbGwucm93LmdldEVsZW1lbnQoKS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLWVkaXRpbmdcIik7XG5cdFx0XHRcblx0XHRcdGNlbGwudGFibGUuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLWVkaXRpbmdcIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRjYW5jZWxFZGl0KCl7XG5cdFx0aWYodGhpcy5jdXJyZW50Q2VsbCl7XG5cdFx0XHR2YXIgY2VsbCA9IHRoaXMuY3VycmVudENlbGw7XG5cdFx0XHR2YXIgY29tcG9uZW50ID0gdGhpcy5jdXJyZW50Q2VsbC5nZXRDb21wb25lbnQoKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5jbGVhckVkaXRvcih0cnVlKTtcblx0XHRcdGNlbGwuc2V0VmFsdWVBY3R1YWwoY2VsbC5nZXRWYWx1ZSgpKTtcblx0XHRcdGNlbGwuY2VsbFJlbmRlcmVkKCk7XG5cdFx0XHRcblx0XHRcdGlmKGNlbGwuY29sdW1uLmRlZmluaXRpb24uZWRpdG9yID09IFwidGV4dGFyZWFcIiB8fCBjZWxsLmNvbHVtbi5kZWZpbml0aW9uLnZhcmlhYmxlSGVpZ2h0KXtcblx0XHRcdFx0Y2VsbC5yb3cubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihjZWxsLmNvbHVtbi5kZWZpbml0aW9uLmNlbGxFZGl0Q2FuY2VsbGVkKXtcblx0XHRcdFx0Y2VsbC5jb2x1bW4uZGVmaW5pdGlvbi5jZWxsRWRpdENhbmNlbGxlZC5jYWxsKHRoaXMudGFibGUsIGNvbXBvbmVudCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJlZGl0LWNhbmNlbGxlZFwiLCBjZWxsKTtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImNlbGxFZGl0Q2FuY2VsbGVkXCIsIGNvbXBvbmVudCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3JldHVybiBhIGZvcm1hdHRlZCB2YWx1ZSBmb3IgYSBjZWxsXG5cdGJpbmRFZGl0b3IoY2VsbCl7XG5cdFx0aWYoY2VsbC5jb2x1bW4ubW9kdWxlcy5lZGl0KXtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdGVsZW1lbnQgPSBjZWxsLmdldEVsZW1lbnQodHJ1ZSk7XG5cdFx0XHRcblx0XHRcdHRoaXMudXBkYXRlQ2VsbENsYXNzKGNlbGwpO1xuXHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCAwKTtcblx0XHRcdFxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoZS5idXR0b24gPT09IDIpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRzZWxmLm1vdXNlQ2xpY2sgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYodGhpcy5vcHRpb25zKFwiZWRpdFRyaWdnZXJFdmVudFwiKSA9PT0gXCJkYmxjbGlja1wiKXtcblx0XHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0aWYoIWVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGFidWxhdG9yLWVkaXRpbmdcIikpe1xuXHRcdFx0XHRcdFx0ZWxlbWVudC5mb2N1cyh7cHJldmVudFNjcm9sbDogdHJ1ZX0pO1xuXHRcdFx0XHRcdFx0c2VsZi5lZGl0KGNlbGwsIGUsIGZhbHNlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMub3B0aW9ucyhcImVkaXRUcmlnZ2VyRXZlbnRcIikgPT09IFwiZm9jdXNcIiB8fCB0aGlzLm9wdGlvbnMoXCJlZGl0VHJpZ2dlckV2ZW50XCIpID09PSBcImNsaWNrXCIpe1xuXHRcdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRpZighZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJ0YWJ1bGF0b3ItZWRpdGluZ1wiKSl7XG5cdFx0XHRcdFx0XHRlbGVtZW50LmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiB0cnVlfSk7XG5cdFx0XHRcdFx0XHRzZWxmLmVkaXQoY2VsbCwgZSwgZmFsc2UpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMub3B0aW9ucyhcImVkaXRUcmlnZ2VyRXZlbnRcIikgPT09IFwiZm9jdXNcIil7XG5cdFx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdGlmKCFzZWxmLnJlY3Vyc2lvbkJsb2NrKXtcblx0XHRcdFx0XHRcdHNlbGYuZWRpdChjZWxsLCBlLCBmYWxzZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGZvY3VzQ2VsbE5vRXZlbnQoY2VsbCwgYmxvY2spe1xuXHRcdHRoaXMucmVjdXJzaW9uQmxvY2sgPSB0cnVlO1xuXHRcdFxuXHRcdGlmKCEoYmxvY2sgJiYgdGhpcy50YWJsZS5icm93c2VyID09PSBcImllXCIpKXtcblx0XHRcdGNlbGwuZ2V0RWxlbWVudCgpLmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiB0cnVlfSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMucmVjdXJzaW9uQmxvY2sgPSBmYWxzZTtcblx0fVxuXHRcblx0ZWRpdENlbGwoY2VsbCwgZm9yY2VFZGl0KXtcblx0XHR0aGlzLmZvY3VzQ2VsbE5vRXZlbnQoY2VsbCk7XG5cdFx0dGhpcy5lZGl0KGNlbGwsIGZhbHNlLCBmb3JjZUVkaXQpO1xuXHR9XG5cdFxuXHRmb2N1c1Njcm9sbEFkanVzdChjZWxsKXtcblx0XHRpZih0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0UmVuZGVyTW9kZSgpID09IFwidmlydHVhbFwiKXtcblx0XHRcdHZhciB0b3BFZGdlID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsVG9wLFxuXHRcdFx0Ym90dG9tRWRnZSA9IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudEhlaWdodCArIHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbFRvcCxcblx0XHRcdHJvd0VsID0gY2VsbC5yb3cuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XG5cdFx0XHRpZihyb3dFbC5vZmZzZXRUb3AgPCB0b3BFZGdlKXtcblx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsVG9wIC09ICh0b3BFZGdlIC0gcm93RWwub2Zmc2V0VG9wKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYocm93RWwub2Zmc2V0VG9wICsgcm93RWwub2Zmc2V0SGVpZ2h0ICA+IGJvdHRvbUVkZ2Upe1xuXHRcdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbFRvcCArPSAocm93RWwub2Zmc2V0VG9wICsgcm93RWwub2Zmc2V0SGVpZ2h0IC0gYm90dG9tRWRnZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0dmFyIGxlZnRFZGdlID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsTGVmdCxcblx0XHRcdHJpZ2h0RWRnZSA9IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudFdpZHRoICsgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsTGVmdCxcblx0XHRcdGNlbGxFbCA9IGNlbGwuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImZyb3plbkNvbHVtbnNcIikpe1xuXHRcdFx0XHRsZWZ0RWRnZSArPSBwYXJzZUludCh0aGlzLnRhYmxlLm1vZHVsZXMuZnJvemVuQ29sdW1ucy5sZWZ0TWFyZ2luIHx8IDApO1xuXHRcdFx0XHRyaWdodEVkZ2UgLT0gcGFyc2VJbnQodGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMucmlnaHRNYXJnaW4gfHwgMCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5yZW5kZXJIb3Jpem9udGFsID09PSBcInZpcnR1YWxcIil7XG5cdFx0XHRcdGxlZnRFZGdlIC09IHBhcnNlSW50KHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5yZW5kZXJlci52RG9tUGFkTGVmdCk7XG5cdFx0XHRcdHJpZ2h0RWRnZSAtPSBwYXJzZUludCh0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIucmVuZGVyZXIudkRvbVBhZExlZnQpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihjZWxsRWwub2Zmc2V0TGVmdCA8IGxlZnRFZGdlKXtcblx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsTGVmdCAtPSAobGVmdEVkZ2UgLSBjZWxsRWwub2Zmc2V0TGVmdCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGlmKGNlbGxFbC5vZmZzZXRMZWZ0ICsgY2VsbEVsLm9mZnNldFdpZHRoICA+IHJpZ2h0RWRnZSl7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsTGVmdCArPSAoY2VsbEVsLm9mZnNldExlZnQgKyBjZWxsRWwub2Zmc2V0V2lkdGggLSByaWdodEVkZ2UpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRhbGxvd0VkaXQoY2VsbCkge1xuXHRcdHZhciBjaGVjayA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdCA/IHRydWUgOiBmYWxzZTtcblx0XHRcblx0XHRpZihjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQpe1xuXHRcdFx0c3dpdGNoKHR5cGVvZiBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2spe1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRpZihjZWxsLnJvdy5pbml0aWFsaXplZCl7XG5cdFx0XHRcdFx0XHRjaGVjayA9IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5jaGVjayhjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFxuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0Y2hlY2sgPSAhIWNlbGwucm93LmRhdGFbY2VsbC5jb2x1bW4ubW9kdWxlcy5lZGl0LmNoZWNrXTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XG5cdFx0XHRcdGNhc2UgXCJib29sZWFuXCI6XG5cdFx0XHRcdFx0Y2hlY2sgPSBjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuY2hlY2s7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBjaGVjaztcblx0fVxuXHRcblx0ZWRpdChjZWxsLCBlLCBmb3JjZUVkaXQpe1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRhbGxvd0VkaXQgPSB0cnVlLFxuXHRcdHJlbmRlcmVkID0gZnVuY3Rpb24oKXt9LFxuXHRcdGVsZW1lbnQgPSBjZWxsLmdldEVsZW1lbnQoKSxcblx0XHRlZGl0RmluaXNoZWQgPSBmYWxzZSxcblx0XHRjZWxsRWRpdG9yLCBjb21wb25lbnQsIHBhcmFtcztcblxuXHRcdC8vcHJldmVudCBlZGl0aW5nIGlmIGFub3RoZXIgY2VsbCBpcyByZWZ1c2luZyB0byBsZWF2ZSBmb2N1cyAoZWcuIHZhbGlkYXRpb24gZmFpbClcblx0XHRcblx0XHRpZih0aGlzLmN1cnJlbnRDZWxsKXtcblx0XHRcdGlmKCF0aGlzLmludmFsaWRFZGl0ICYmIHRoaXMuY3VycmVudENlbGwgIT09IGNlbGwpe1xuXHRcdFx0XHR0aGlzLmNhbmNlbEVkaXQoKTtcblx0XHRcdH1cblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0XG5cdFx0Ly9oYW5kbGUgc3VjY2Vzc2Z1bCB2YWx1ZSBjaGFuZ2Vcblx0XHRmdW5jdGlvbiBzdWNjZXNzKHZhbHVlKXtcblx0XHRcdGlmKHNlbGYuY3VycmVudENlbGwgPT09IGNlbGwgJiYgIWVkaXRGaW5pc2hlZCl7XG5cdFx0XHRcdHZhciB2YWxpZCA9IHNlbGYuY2hhaW4oXCJlZGl0LXN1Y2Nlc3NcIiwgW2NlbGwsIHZhbHVlXSwgdHJ1ZSwgdHJ1ZSk7XG5cblx0XHRcdFx0aWYodmFsaWQgPT09IHRydWUgfHwgc2VsZi50YWJsZS5vcHRpb25zLnZhbGlkYXRpb25Nb2RlID09PSBcImhpZ2hsaWdodFwiKXtcblxuXHRcdFx0XHRcdGVkaXRGaW5pc2hlZCA9IHRydWU7XG5cblx0XHRcdFx0XHRzZWxmLmNsZWFyRWRpdG9yKCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYoIWNlbGwubW9kdWxlcy5lZGl0KXtcblx0XHRcdFx0XHRcdGNlbGwubW9kdWxlcy5lZGl0ID0ge307XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGNlbGwubW9kdWxlcy5lZGl0LmVkaXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYoc2VsZi5lZGl0ZWRDZWxscy5pbmRleE9mKGNlbGwpID09IC0xKXtcblx0XHRcdFx0XHRcdHNlbGYuZWRpdGVkQ2VsbHMucHVzaChjZWxsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR2YWx1ZSA9IHNlbGYudHJhbnNmb3JtRW1wdHlWYWx1ZXModmFsdWUsIGNlbGwpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGNlbGwuc2V0VmFsdWUodmFsdWUsIHRydWUpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIHZhbGlkID09PSB0cnVlO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0ZWRpdEZpbmlzaGVkID0gdHJ1ZTtcblx0XHRcdFx0XHRzZWxmLmludmFsaWRFZGl0ID0gdHJ1ZTtcblx0XHRcdFx0XHRzZWxmLmZvY3VzQ2VsbE5vRXZlbnQoY2VsbCwgdHJ1ZSk7XG5cdFx0XHRcdFx0cmVuZGVyZWQoKTtcblxuXHRcdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdFx0ZWRpdEZpbmlzaGVkID0gZmFsc2U7XG5cdFx0XHRcdFx0fSwgMTApO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHQvL2hhbmRsZSBhYm9ydGVkIGVkaXRcblx0XHRmdW5jdGlvbiBjYW5jZWwoKXtcblx0XHRcdC8vIGVkaXRGaW5pc2hlZCA9IHRydWU7XG5cblx0XHRcdGlmKHNlbGYuY3VycmVudENlbGwgPT09IGNlbGwgJiYgIWVkaXRGaW5pc2hlZCl7XG5cdFx0XHRcdHNlbGYuY2FuY2VsRWRpdCgpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRmdW5jdGlvbiBvblJlbmRlcmVkKGNhbGxiYWNrKXtcblx0XHRcdHJlbmRlcmVkID0gY2FsbGJhY2s7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCFjZWxsLmNvbHVtbi5tb2R1bGVzLmVkaXQuYmxvY2tlZCl7XG5cdFx0XHRpZihlKXtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0YWxsb3dFZGl0ID0gdGhpcy5hbGxvd0VkaXQoY2VsbCk7XG5cdFx0XHRcblx0XHRcdGlmKGFsbG93RWRpdCB8fCBmb3JjZUVkaXQpe1xuXHRcdFx0XHRzZWxmLmNhbmNlbEVkaXQoKTtcblx0XHRcdFx0XG5cdFx0XHRcdHNlbGYuY3VycmVudENlbGwgPSBjZWxsO1xuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5mb2N1c1Njcm9sbEFkanVzdChjZWxsKTtcblx0XHRcdFx0XG5cdFx0XHRcdGNvbXBvbmVudCA9IGNlbGwuZ2V0Q29tcG9uZW50KCk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0aGlzLm1vdXNlQ2xpY2spe1xuXHRcdFx0XHRcdHRoaXMubW91c2VDbGljayA9IGZhbHNlO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKGNlbGwuY29sdW1uLmRlZmluaXRpb24uY2VsbENsaWNrKXtcblx0XHRcdFx0XHRcdGNlbGwuY29sdW1uLmRlZmluaXRpb24uY2VsbENsaWNrLmNhbGwodGhpcy50YWJsZSwgZSwgY29tcG9uZW50KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKGNlbGwuY29sdW1uLmRlZmluaXRpb24uY2VsbEVkaXRpbmcpe1xuXHRcdFx0XHRcdGNlbGwuY29sdW1uLmRlZmluaXRpb24uY2VsbEVkaXRpbmcuY2FsbCh0aGlzLnRhYmxlLCBjb21wb25lbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLmRpc3BhdGNoKFwiY2VsbC1lZGl0aW5nXCIsIGNlbGwpO1xuXHRcdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJjZWxsRWRpdGluZ1wiLCBjb21wb25lbnQpO1xuXHRcdFx0XHRcblx0XHRcdFx0cGFyYW1zID0gdHlwZW9mIGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5wYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5wYXJhbXMoY29tcG9uZW50KSA6IGNlbGwuY29sdW1uLm1vZHVsZXMuZWRpdC5wYXJhbXM7XG5cdFx0XHRcdFxuXHRcdFx0XHRjZWxsRWRpdG9yID0gY2VsbC5jb2x1bW4ubW9kdWxlcy5lZGl0LmVkaXRvci5jYWxsKHNlbGYsIGNvbXBvbmVudCwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBwYXJhbXMpO1xuXHRcdFx0XHRcblx0XHRcdFx0Ly9pZiBlZGl0b3IgcmV0dXJuZWQsIGFkZCB0byBET00sIGlmIGZhbHNlLCBhYm9ydCBlZGl0XG5cdFx0XHRcdGlmKHRoaXMuY3VycmVudENlbGwgJiYgY2VsbEVkaXRvciAhPT0gZmFsc2Upe1xuXHRcdFx0XHRcdGlmKGNlbGxFZGl0b3IgaW5zdGFuY2VvZiBOb2RlKXtcblx0XHRcdFx0XHRcdGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1lZGl0aW5nXCIpO1xuXHRcdFx0XHRcdFx0Y2VsbC5yb3cuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZWRpdGluZ1wiKTtcblx0XHRcdFx0XHRcdGNlbGwudGFibGUuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWVkaXRpbmdcIik7XG5cdFx0XHRcdFx0XHR3aGlsZShlbGVtZW50LmZpcnN0Q2hpbGQpIGVsZW1lbnQucmVtb3ZlQ2hpbGQoZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcdFx0XHRcdGVsZW1lbnQuYXBwZW5kQ2hpbGQoY2VsbEVkaXRvcik7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdC8vdHJpZ2dlciBvblJlbmRlcmVkIENhbGxiYWNrXG5cdFx0XHRcdFx0XHRyZW5kZXJlZCgpO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHQvL3ByZXZlbnQgZWRpdGluZyBmcm9tIHRyaWdnZXJpbmcgcm93Q2xpY2sgZXZlbnRcblx0XHRcdFx0XHRcdHZhciBjaGlsZHJlbiA9IGVsZW1lbnQuY2hpbGRyZW47XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRcdFx0Y2hpbGRyZW5baV0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkVkaXQgRXJyb3IgLSBFZGl0b3Igc2hvdWxkIHJldHVybiBhbiBpbnN0YW5jZSBvZiBOb2RlLCB0aGUgZWRpdG9yIHJldHVybmVkOlwiLCBjZWxsRWRpdG9yKTtcblx0XHRcdFx0XHRcdHRoaXMuYmx1cihlbGVtZW50KTtcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR0aGlzLmJsdXIoZWxlbWVudCk7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5tb3VzZUNsaWNrID0gZmFsc2U7XG5cdFx0XHRcdHRoaXMuYmx1cihlbGVtZW50KTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMubW91c2VDbGljayA9IGZhbHNlO1xuXHRcdFx0dGhpcy5ibHVyKGVsZW1lbnQpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fVxuXG5cdGVtcHR5VmFsdWVDaGVjayh2YWx1ZSl7XG5cdFx0cmV0dXJuIHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIjtcblx0fVxuXG5cdHRyYW5zZm9ybUVtcHR5VmFsdWVzKHZhbHVlLCBjZWxsKXtcblx0XHR2YXIgbW9kID0gY2VsbC5jb2x1bW4ubW9kdWxlcy5lZGl0LCBcblx0XHRjb252ZXJ0ID0gbW9kLmNvbnZlcnRFbXB0eVZhbHVlcyB8fCB0aGlzLmNvbnZlcnRFbXB0eVZhbHVlcyxcblx0XHRjaGVja0Z1bmM7XG5cdFx0XG5cdFx0aWYoY29udmVydCl7XG5cdFx0XHRjaGVja0Z1bmMgPSBtb2QuZWRpdG9yRW1wdHlWYWx1ZUZ1bmMgfHwgdGhpcy5vcHRpb25zKFwiZWRpdG9yRW1wdHlWYWx1ZUZ1bmNcIik7XG5cblx0XHRcdGlmKGNoZWNrRnVuYyAmJiBjaGVja0Z1bmModmFsdWUpKXtcblx0XHRcdFx0dmFsdWUgPSBtb2QuY29udmVydEVtcHR5VmFsdWVzID8gbW9kLmVkaXRvckVtcHR5VmFsdWUgOiB0aGlzLm9wdGlvbnMoXCJlZGl0b3JFbXB0eVZhbHVlXCIpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gdmFsdWU7XG5cdH1cblx0XG5cdGJsdXIoZWxlbWVudCl7XG5cdFx0aWYoIXRoaXMuY29uZmlybShcImVkaXQtYmx1clwiLCBbZWxlbWVudF0pICl7XG5cdFx0XHRlbGVtZW50LmJsdXIoKTtcblx0XHR9XG5cdH1cblx0XG5cdGdldEVkaXRlZENlbGxzKCl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXHRcdFxuXHRcdHRoaXMuZWRpdGVkQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuXHRcdFx0b3V0cHV0LnB1c2goY2VsbC5nZXRDb21wb25lbnQoKSk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXHRcblx0Y2xlYXJFZGl0ZWQoY2VsbCl7XG5cdFx0dmFyIGVkaXRJbmRleDtcblx0XHRcblx0XHRpZihjZWxsLm1vZHVsZXMuZWRpdCAmJiBjZWxsLm1vZHVsZXMuZWRpdC5lZGl0ZWQpe1xuXHRcdFx0Y2VsbC5tb2R1bGVzLmVkaXQuZWRpdGVkID0gZmFsc2U7XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJlZGl0LWVkaXRlZC1jbGVhclwiLCBjZWxsKTtcblx0XHR9XG5cdFx0XG5cdFx0ZWRpdEluZGV4ID0gdGhpcy5lZGl0ZWRDZWxscy5pbmRleE9mKGNlbGwpO1xuXHRcdFxuXHRcdGlmKGVkaXRJbmRleCA+IC0xKXtcblx0XHRcdHRoaXMuZWRpdGVkQ2VsbHMuc3BsaWNlKGVkaXRJbmRleCwgMSk7XG5cdFx0fVxuXHR9XG59XG5cbmNsYXNzIEV4cG9ydFJvd3tcblx0Y29uc3RydWN0b3IodHlwZSwgY29sdW1ucywgY29tcG9uZW50LCBpbmRlbnQpe1xuXHRcdHRoaXMudHlwZSA9IHR5cGU7XG5cdFx0dGhpcy5jb2x1bW5zID0gY29sdW1ucztcblx0XHR0aGlzLmNvbXBvbmVudCA9IGNvbXBvbmVudCB8fCBmYWxzZTtcblx0XHR0aGlzLmluZGVudCA9IGluZGVudCB8fCAwO1xuXHR9XG59XG5cbmNsYXNzIEV4cG9ydENvbHVtbntcblx0Y29uc3RydWN0b3IodmFsdWUsIGNvbXBvbmVudCwgd2lkdGgsIGhlaWdodCwgZGVwdGgpe1xuXHRcdHRoaXMudmFsdWUgPSB2YWx1ZTtcblx0XHR0aGlzLmNvbXBvbmVudCA9IGNvbXBvbmVudCB8fCBmYWxzZTtcblx0XHR0aGlzLndpZHRoID0gd2lkdGg7XG5cdFx0dGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG5cdFx0dGhpcy5kZXB0aCA9IGRlcHRoO1xuXHR9XG59XG5cbnZhciBjb2x1bW5Mb29rdXBzJDEgPSB7XHJcblxyXG59O1xuXG52YXIgcm93TG9va3VwcyQxID0ge1xyXG5cdHZpc2libGU6ZnVuY3Rpb24oKXtcclxuXHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0VmlzaWJsZVJvd3MoZmFsc2UsIHRydWUpO1xyXG5cdH0sXHJcblx0YWxsOmZ1bmN0aW9uKCl7XHJcblx0XHRyZXR1cm4gdGhpcy5yb3dNYW5hZ2VyLnJvd3M7XHJcblx0fSxcclxuXHRzZWxlY3RlZDpmdW5jdGlvbigpe1xyXG5cdFx0cmV0dXJuIHRoaXMubW9kdWxlcy5zZWxlY3RSb3cuc2VsZWN0ZWRSb3dzO1xyXG5cdH0sXHJcblx0YWN0aXZlOmZ1bmN0aW9uKCl7XHJcblx0XHRpZih0aGlzLm9wdGlvbnMucGFnaW5hdGlvbil7XHJcblx0XHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3ModGhpcy5yb3dNYW5hZ2VyLmRpc3BsYXlSb3dzLmxlbmd0aCAtIDIpO1xyXG5cdFx0fWVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCk7XHJcblx0XHR9XHJcblx0fSxcclxufTtcblxuY2xhc3MgRXhwb3J0IGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJleHBvcnRcIjtcblxuXHRzdGF0aWMgY29sdW1uTG9va3VwcyA9IGNvbHVtbkxvb2t1cHMkMTtcblx0c3RhdGljIHJvd0xvb2t1cHMgPSByb3dMb29rdXBzJDE7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMuY29uZmlnID0ge307XG5cdFx0dGhpcy5jbG9uZVRhYmxlU3R5bGUgPSB0cnVlO1xuXHRcdHRoaXMuY29sVmlzUHJvcCA9IFwiXCI7XG5cdFx0dGhpcy5jb2xWaXNQcm9wQXR0YWNoID0gXCJcIjtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJodG1sT3V0cHV0Q29uZmlnXCIsIGZhbHNlKTsgLy9odG1sIG91dHB1dCBjb25maWdcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaHRtbE91dHB1dFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwidGl0bGVIdG1sT3V0cHV0XCIpO1xuXHR9XG5cdFxuXHRpbml0aWFsaXplKCl7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRIdG1sXCIsIHRoaXMuZ2V0SHRtbC5iaW5kKHRoaXMpKTtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIEludGVybmFsIExvZ2ljIC8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdGdlbmVyYXRlRXhwb3J0TGlzdChjb25maWcsIHN0eWxlLCByYW5nZSwgY29sVmlzUHJvcCl7XG5cdFx0dmFyIGhlYWRlcnMsIGJvZHksIGNvbHVtbnMsIGNvbExvb2t1cDtcblxuXHRcdHRoaXMuY2xvbmVUYWJsZVN0eWxlID0gc3R5bGU7XG5cdFx0dGhpcy5jb25maWcgPSBjb25maWcgfHwge307XG5cdFx0dGhpcy5jb2xWaXNQcm9wID0gY29sVmlzUHJvcDtcblx0XHR0aGlzLmNvbFZpc1Byb3BBdHRhY2ggPSB0aGlzLmNvbFZpc1Byb3AuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLmNvbFZpc1Byb3Auc2xpY2UoMSk7XG5cblx0XHRjb2xMb29rdXAgPSBFeHBvcnQuY29sdW1uTG9va3Vwc1tyYW5nZV07XG5cblx0XHRpZihjb2xMb29rdXApe1xuXHRcdFx0Y29sdW1ucyA9IGNvbExvb2t1cC5jYWxsKHRoaXMudGFibGUpO1xuXHRcdFx0Y29sdW1ucyA9IGNvbHVtbnMuZmlsdGVyKGNvbCA9PiB0aGlzLmNvbHVtblZpc0NoZWNrKGNvbCkpO1xuXHRcdH1cblxuXHRcdGhlYWRlcnMgPSB0aGlzLmNvbmZpZy5jb2x1bW5IZWFkZXJzICE9PSBmYWxzZSA/IHRoaXMuaGVhZGVyc1RvRXhwb3J0Um93cyh0aGlzLmdlbmVyYXRlQ29sdW1uR3JvdXBIZWFkZXJzKGNvbHVtbnMpKSA6IFtdO1xuXG5cdFx0aWYoY29sdW1ucyl7XG5cdFx0XHRjb2x1bW5zID0gY29sdW1ucy5tYXAoY29sID0+IGNvbC5nZXRDb21wb25lbnQoKSk7XG5cdFx0fVxuXHRcdFxuXHRcdGJvZHkgPSB0aGlzLmJvZHlUb0V4cG9ydFJvd3ModGhpcy5yb3dMb29rdXAocmFuZ2UpLCBjb2x1bW5zKTtcblxuXHRcdHJldHVybiBoZWFkZXJzLmNvbmNhdChib2R5KTtcblx0fVxuXHRcblx0Z2VuZXJhdGVUYWJsZShjb25maWcsIHN0eWxlLCByYW5nZSwgY29sVmlzUHJvcCl7XG5cdFx0dmFyIGxpc3QgPSB0aGlzLmdlbmVyYXRlRXhwb3J0TGlzdChjb25maWcsIHN0eWxlLCByYW5nZSwgY29sVmlzUHJvcCk7XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXMuZ2VuZXJhdGVUYWJsZUVsZW1lbnQobGlzdCk7XG5cdH1cblx0XG5cdHJvd0xvb2t1cChyYW5nZSl7XG5cdFx0dmFyIHJvd3MgPSBbXSwgXG5cdFx0cm93TG9va3VwO1xuXHRcdFxuXHRcdGlmKHR5cGVvZiByYW5nZSA9PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0cmFuZ2UuY2FsbCh0aGlzLnRhYmxlKS5mb3JFYWNoKChyb3cpID0+e1xuXHRcdFx0XHRyb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyhyb3cpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYocm93KXtcblx0XHRcdFx0XHRyb3dzLnB1c2gocm93KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cm93TG9va3VwID0gRXhwb3J0LnJvd0xvb2t1cHNbcmFuZ2VdIHx8IEV4cG9ydC5yb3dMb29rdXBzW1wiYWN0aXZlXCJdO1xuXG5cdFx0XHRyb3dzID0gcm93TG9va3VwLmNhbGwodGhpcy50YWJsZSk7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBPYmplY3QuYXNzaWduKFtdLCByb3dzKTtcblx0fVxuXHRcblx0Z2VuZXJhdGVDb2x1bW5Hcm91cEhlYWRlcnMoY29sdW1ucyl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXHRcdFxuXHRcdGlmICghY29sdW1ucykge1xuXHRcdFx0Y29sdW1ucyA9IHRoaXMuY29uZmlnLmNvbHVtbkdyb3VwcyAhPT0gZmFsc2UgPyB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1ucyA6IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleDtcblx0XHR9XG5cdFx0XG5cdFx0Y29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdHZhciBjb2xEYXRhID0gdGhpcy5wcm9jZXNzQ29sdW1uR3JvdXAoY29sdW1uKTtcblx0XHRcdFxuXHRcdFx0aWYoY29sRGF0YSl7XG5cdFx0XHRcdG91dHB1dC5wdXNoKGNvbERhdGEpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH1cblx0XG5cdHByb2Nlc3NDb2x1bW5Hcm91cChjb2x1bW4pe1xuXHRcdHZhciBzdWJHcm91cHMgPSBjb2x1bW4uY29sdW1ucyxcblx0XHRtYXhEZXB0aCA9IDAsXG5cdFx0dGl0bGUgPSBjb2x1bW4uZGVmaW5pdGlvbltcInRpdGxlXCIgKyAodGhpcy5jb2xWaXNQcm9wQXR0YWNoKV0gfHwgY29sdW1uLmRlZmluaXRpb24udGl0bGU7XG5cdFx0XG5cdFx0dmFyIGdyb3VwRGF0YSA9IHtcblx0XHRcdHRpdGxlOnRpdGxlLFxuXHRcdFx0Y29sdW1uOmNvbHVtbixcblx0XHRcdGRlcHRoOjEsXG5cdFx0fTtcblx0XHRcblx0XHRpZihzdWJHcm91cHMubGVuZ3RoKXtcblx0XHRcdGdyb3VwRGF0YS5zdWJHcm91cHMgPSBbXTtcblx0XHRcdGdyb3VwRGF0YS53aWR0aCA9IDA7XG5cdFx0XHRcblx0XHRcdHN1Ykdyb3Vwcy5mb3JFYWNoKChzdWJHcm91cCkgPT4ge1xuXHRcdFx0XHR2YXIgc3ViR3JvdXBEYXRhID0gdGhpcy5wcm9jZXNzQ29sdW1uR3JvdXAoc3ViR3JvdXApO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoc3ViR3JvdXBEYXRhKXtcblx0XHRcdFx0XHRncm91cERhdGEud2lkdGggKz0gc3ViR3JvdXBEYXRhLndpZHRoO1xuXHRcdFx0XHRcdGdyb3VwRGF0YS5zdWJHcm91cHMucHVzaChzdWJHcm91cERhdGEpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKHN1Ykdyb3VwRGF0YS5kZXB0aCA+IG1heERlcHRoKXtcblx0XHRcdFx0XHRcdG1heERlcHRoID0gc3ViR3JvdXBEYXRhLmRlcHRoO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdGdyb3VwRGF0YS5kZXB0aCArPSBtYXhEZXB0aDtcblx0XHRcdFxuXHRcdFx0aWYoIWdyb3VwRGF0YS53aWR0aCl7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRpZih0aGlzLmNvbHVtblZpc0NoZWNrKGNvbHVtbikpe1xuXHRcdFx0XHRncm91cERhdGEud2lkdGggPSAxO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBncm91cERhdGE7XG5cdH1cblx0XG5cdGNvbHVtblZpc0NoZWNrKGNvbHVtbil7XG5cdFx0dmFyIHZpc1Byb3AgPSBjb2x1bW4uZGVmaW5pdGlvblt0aGlzLmNvbFZpc1Byb3BdO1xuXG5cdFx0aWYodGhpcy5jb25maWcucm93SGVhZGVycyA9PT0gZmFsc2UgJiYgY29sdW1uLmlzUm93SGVhZGVyKXtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodHlwZW9mIHZpc1Byb3AgPT09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHR2aXNQcm9wID0gdmlzUHJvcC5jYWxsKHRoaXMudGFibGUsIGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0fVxuXG5cdFx0aWYodmlzUHJvcCA9PT0gZmFsc2UgfHwgdmlzUHJvcCA9PT0gdHJ1ZSl7XG5cdFx0XHRyZXR1cm4gdmlzUHJvcDtcblx0XHR9XG5cblx0XHRyZXR1cm4gY29sdW1uLnZpc2libGUgJiYgY29sdW1uLmZpZWxkO1xuXHR9XG5cdFxuXHRoZWFkZXJzVG9FeHBvcnRSb3dzKGNvbHVtbnMpe1xuXHRcdHZhciBoZWFkZXJzID0gW10sXG5cdFx0aGVhZGVyRGVwdGggPSAwLFxuXHRcdGV4cG9ydFJvd3MgPSBbXTtcblx0XHRcblx0XHRmdW5jdGlvbiBwYXJzZUNvbHVtbkdyb3VwKGNvbHVtbiwgbGV2ZWwpe1xuXHRcdFx0XG5cdFx0XHR2YXIgZGVwdGggPSBoZWFkZXJEZXB0aCAtIGxldmVsO1xuXHRcdFx0XG5cdFx0XHRpZih0eXBlb2YgaGVhZGVyc1tsZXZlbF0gPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0XHRoZWFkZXJzW2xldmVsXSA9IFtdO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRjb2x1bW4uaGVpZ2h0ID0gY29sdW1uLnN1Ykdyb3VwcyA/IDEgOiAoZGVwdGggLSBjb2x1bW4uZGVwdGgpICsgMTtcblx0XHRcdFxuXHRcdFx0aGVhZGVyc1tsZXZlbF0ucHVzaChjb2x1bW4pO1xuXHRcdFx0XG5cdFx0XHRpZihjb2x1bW4uaGVpZ2h0ID4gMSl7XG5cdFx0XHRcdGZvcihsZXQgaSA9IDE7IGkgPCBjb2x1bW4uaGVpZ2h0OyBpICsrKXtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZih0eXBlb2YgaGVhZGVyc1tsZXZlbCArIGldID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRcdGhlYWRlcnNbbGV2ZWwgKyBpXSA9IFtdO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0XHRoZWFkZXJzW2xldmVsICsgaV0ucHVzaChmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uLndpZHRoID4gMSl7XG5cdFx0XHRcdGZvcihsZXQgaSA9IDE7IGkgPCBjb2x1bW4ud2lkdGg7IGkgKyspe1xuXHRcdFx0XHRcdGhlYWRlcnNbbGV2ZWxdLnB1c2goZmFsc2UpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKGNvbHVtbi5zdWJHcm91cHMpe1xuXHRcdFx0XHRjb2x1bW4uc3ViR3JvdXBzLmZvckVhY2goZnVuY3Rpb24oc3ViR3JvdXApe1xuXHRcdFx0XHRcdHBhcnNlQ29sdW1uR3JvdXAoc3ViR3JvdXAsIGxldmVsKzEpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0Ly9jYWxjdWxhdGUgbWF4aW11bSBoZWFkZXIgZGVwdGhcblx0XHRjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcblx0XHRcdGlmKGNvbHVtbi5kZXB0aCA+IGhlYWRlckRlcHRoKXtcblx0XHRcdFx0aGVhZGVyRGVwdGggPSBjb2x1bW4uZGVwdGg7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0XHRwYXJzZUNvbHVtbkdyb3VwKGNvbHVtbiwwKTtcblx0XHR9KTtcblx0XHRcblx0XHRoZWFkZXJzLmZvckVhY2goKGhlYWRlcikgPT4ge1xuXHRcdFx0dmFyIGNvbHVtbnMgPSBbXTtcblx0XHRcdFxuXHRcdFx0aGVhZGVyLmZvckVhY2goKGNvbCkgPT4ge1xuXHRcdFx0XHRpZihjb2wpe1xuXHRcdFx0XHRcdGxldCB0aXRsZSA9IHR5cGVvZiBjb2wudGl0bGUgPT09IFwidW5kZWZpbmVkXCIgPyBcIlwiIDogY29sLnRpdGxlO1xuXHRcdFx0XHRcdGNvbHVtbnMucHVzaChuZXcgRXhwb3J0Q29sdW1uKHRpdGxlLCBjb2wuY29sdW1uLmdldENvbXBvbmVudCgpLCBjb2wud2lkdGgsIGNvbC5oZWlnaHQsIGNvbC5kZXB0aCkpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29sdW1ucy5wdXNoKG51bGwpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0ZXhwb3J0Um93cy5wdXNoKG5ldyBFeHBvcnRSb3coXCJoZWFkZXJcIiwgY29sdW1ucykpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBleHBvcnRSb3dzO1xuXHR9XG5cdFxuXHRib2R5VG9FeHBvcnRSb3dzKHJvd3MsIGNvbHVtbnMgPSBbXSl7XG5cdFx0dmFyIGV4cG9ydFJvd3MgPSBbXTtcblx0XHRcblx0XHRpZiAoY29sdW1ucy5sZW5ndGggPT09IDApIHtcblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdFx0aWYgKHRoaXMuY29sdW1uVmlzQ2hlY2soY29sdW1uKSkge1xuXHRcdFx0XHRcdGNvbHVtbnMucHVzaChjb2x1bW4uZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy5jb25maWcuY29sdW1uQ2FsY3MgIT09IGZhbHNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpe1xuXHRcdFx0aWYodGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnRvcEluaXRpYWxpemVkKXtcblx0XHRcdFx0cm93cy51bnNoaWZ0KHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy50b3BSb3cpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuYm90SW5pdGlhbGl6ZWQpe1xuXHRcdFx0XHRyb3dzLnB1c2godGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmJvdFJvdyk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cm93cyA9IHJvd3MuZmlsdGVyKChyb3cpID0+IHtcblx0XHRcdHN3aXRjaChyb3cudHlwZSl7XG5cdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdHJldHVybiB0aGlzLmNvbmZpZy5yb3dHcm91cHMgIT09IGZhbHNlO1xuXHRcdFx0XHRcblx0XHRcdFx0Y2FzZSBcImNhbGNcIjpcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5jb25maWcuY29sdW1uQ2FsY3MgIT09IGZhbHNlO1xuXHRcdFx0XHRcblx0XHRcdFx0Y2FzZSBcInJvd1wiOlxuXHRcdFx0XHRcdHJldHVybiAhKHRoaXMudGFibGUub3B0aW9ucy5kYXRhVHJlZSAmJiB0aGlzLmNvbmZpZy5kYXRhVHJlZSA9PT0gZmFsc2UgJiYgcm93Lm1vZHVsZXMuZGF0YVRyZWUucGFyZW50KTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cm93cy5mb3JFYWNoKChyb3csIGkpID0+IHtcblx0XHRcdHZhciByb3dEYXRhID0gcm93LmdldERhdGEodGhpcy5jb2xWaXNQcm9wKTtcblx0XHRcdHZhciBleHBvcnRDb2xzID0gW107XG5cdFx0XHR2YXIgaW5kZW50ID0gMDtcblx0XHRcdFxuXHRcdFx0c3dpdGNoKHJvdy50eXBlKXtcblx0XHRcdFx0Y2FzZSBcImdyb3VwXCI6XG5cdFx0XHRcdFx0aW5kZW50ID0gcm93LmxldmVsO1xuXHRcdFx0XHRcdGV4cG9ydENvbHMucHVzaChuZXcgRXhwb3J0Q29sdW1uKHJvdy5rZXksIHJvdy5nZXRDb21wb25lbnQoKSwgY29sdW1ucy5sZW5ndGgsIDEpKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XG5cdFx0XHRcdGNhc2UgXCJjYWxjXCIgOlxuXHRcdFx0XHRjYXNlIFwicm93XCIgOlxuXHRcdFx0XHRcdGNvbHVtbnMuZm9yRWFjaCgoY29sKSA9PiB7XG5cdFx0XHRcdFx0XHRleHBvcnRDb2xzLnB1c2gobmV3IEV4cG9ydENvbHVtbihjb2wuX2NvbHVtbi5nZXRGaWVsZFZhbHVlKHJvd0RhdGEpLCBjb2wsIDEsIDEpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmIHRoaXMuY29uZmlnLmRhdGFUcmVlICE9PSBmYWxzZSl7XG5cdFx0XHRcdFx0XHRpbmRlbnQgPSByb3cubW9kdWxlcy5kYXRhVHJlZS5pbmRleDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGV4cG9ydFJvd3MucHVzaChuZXcgRXhwb3J0Um93KHJvdy50eXBlLCBleHBvcnRDb2xzLCByb3cuZ2V0Q29tcG9uZW50KCksIGluZGVudCkpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBleHBvcnRSb3dzO1xuXHR9XG5cdFxuXHRnZW5lcmF0ZVRhYmxlRWxlbWVudChsaXN0KXtcblx0XHR2YXIgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGFibGVcIiksXG5cdFx0aGVhZGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhlYWRcIiksXG5cdFx0Ym9keUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRib2R5XCIpLFxuXHRcdHN0eWxlcyA9IHRoaXMubG9va3VwVGFibGVTdHlsZXMoKSxcblx0XHRyb3dGb3JtYXR0ZXIgPSB0aGlzLnRhYmxlLm9wdGlvbnNbXCJyb3dGb3JtYXR0ZXJcIiArICh0aGlzLmNvbFZpc1Byb3BBdHRhY2gpXSxcblx0XHRzZXR1cCA9IHt9O1xuXHRcdFxuXHRcdHNldHVwLnJvd0Zvcm1hdHRlciA9IHJvd0Zvcm1hdHRlciAhPT0gbnVsbCA/IHJvd0Zvcm1hdHRlciA6IHRoaXMudGFibGUub3B0aW9ucy5yb3dGb3JtYXR0ZXI7XG5cdFx0XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlICYmdGhpcy5jb25maWcuZGF0YVRyZWUgIT09IGZhbHNlICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikpe1xuXHRcdFx0c2V0dXAudHJlZUVsZW1lbnRGaWVsZCA9IHRoaXMudGFibGUubW9kdWxlcy5kYXRhVHJlZS5lbGVtZW50RmllbGQ7XG5cdFx0fVxuXHRcdFxuXHRcdC8vYXNzaWduIGdyb3VwIGhlYWRlciBmb3JtYXR0ZXJcblx0XHRzZXR1cC5ncm91cEhlYWRlciA9IHRoaXMudGFibGUub3B0aW9uc1tcImdyb3VwSGVhZGVyXCIgKyAodGhpcy5jb2xWaXNQcm9wQXR0YWNoKV07XG5cdFx0XG5cdFx0aWYoc2V0dXAuZ3JvdXBIZWFkZXIgJiYgIUFycmF5LmlzQXJyYXkoc2V0dXAuZ3JvdXBIZWFkZXIpKXtcblx0XHRcdHNldHVwLmdyb3VwSGVhZGVyID0gW3NldHVwLmdyb3VwSGVhZGVyXTtcblx0XHR9XG5cdFx0XG5cdFx0dGFibGUuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZVwiKTtcblx0XHRcblx0XHR0aGlzLm1hcEVsZW1lbnRTdHlsZXModGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEhlYWRlcnNFbGVtZW50KCksIGhlYWRlckVsLCBbXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiLCBcImNvbG9yXCIsIFwiZm9udC13ZWlnaHRcIiwgXCJmb250LWZhbWlseVwiLCBcImZvbnQtc2l6ZVwiXSk7XG5cblx0XHRpZihsaXN0Lmxlbmd0aCA+IDEwMDApe1xuXHRcdFx0Y29uc29sZS53YXJuKFwiSXQgbWF5IHRha2UgYSBsb25nIHRpbWUgdG8gcmVuZGVyIGFuIEhUTUwgdGFibGUgd2l0aCBtb3JlIHRoYW4gMTAwMCByb3dzXCIpO1xuXHRcdH1cblx0XHRcblx0XHRsaXN0LmZvckVhY2goKHJvdywgaSkgPT4ge1xuXHRcdFx0bGV0IHJvd0VsO1xuXHRcdFx0XG5cdFx0XHRzd2l0Y2gocm93LnR5cGUpe1xuXHRcdFx0XHRjYXNlIFwiaGVhZGVyXCI6XG5cdFx0XHRcdFx0aGVhZGVyRWwuYXBwZW5kQ2hpbGQodGhpcy5nZW5lcmF0ZUhlYWRlckVsZW1lbnQocm93LCBzZXR1cCwgc3R5bGVzKSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFxuXHRcdFx0XHRjYXNlIFwiZ3JvdXBcIjpcblx0XHRcdFx0XHRib2R5RWwuYXBwZW5kQ2hpbGQodGhpcy5nZW5lcmF0ZUdyb3VwRWxlbWVudChyb3csIHNldHVwLCBzdHlsZXMpKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XG5cdFx0XHRcdGNhc2UgXCJjYWxjXCI6XG5cdFx0XHRcdFx0Ym9keUVsLmFwcGVuZENoaWxkKHRoaXMuZ2VuZXJhdGVDYWxjRWxlbWVudChyb3csIHNldHVwLCBzdHlsZXMpKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XG5cdFx0XHRcdGNhc2UgXCJyb3dcIjpcblx0XHRcdFx0XHRyb3dFbCA9IHRoaXMuZ2VuZXJhdGVSb3dFbGVtZW50KHJvdywgc2V0dXAsIHN0eWxlcyk7XG5cdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMubWFwRWxlbWVudFN0eWxlcygoKGkgJSAyKSAmJiBzdHlsZXMuZXZlblJvdykgPyBzdHlsZXMuZXZlblJvdyA6IHN0eWxlcy5vZGRSb3csIHJvd0VsLCBbXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiY29sb3JcIiwgXCJmb250LXdlaWdodFwiLCBcImZvbnQtZmFtaWx5XCIsIFwiZm9udC1zaXplXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiXSk7XG5cdFx0XHRcdFx0Ym9keUVsLmFwcGVuZENoaWxkKHJvd0VsKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRpZihoZWFkZXJFbC5pbm5lckhUTUwpe1xuXHRcdFx0dGFibGUuYXBwZW5kQ2hpbGQoaGVhZGVyRWwpO1xuXHRcdH1cblx0XHRcblx0XHR0YWJsZS5hcHBlbmRDaGlsZChib2R5RWwpO1xuXHRcdFxuXHRcdFxuXHRcdHRoaXMubWFwRWxlbWVudFN0eWxlcyh0aGlzLnRhYmxlLmVsZW1lbnQsIHRhYmxlLCBbXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCJdKTtcblx0XHRyZXR1cm4gdGFibGU7XG5cdH1cblx0XG5cdGxvb2t1cFRhYmxlU3R5bGVzKCl7XG5cdFx0dmFyIHN0eWxlcyA9IHt9O1xuXHRcdFxuXHRcdC8vbG9va3VwIHJvdyBzdHlsZXNcblx0XHRpZih0aGlzLmNsb25lVGFibGVTdHlsZSAmJiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSl7XG5cdFx0XHRzdHlsZXMub2RkUm93ID0gdGhpcy50YWJsZS5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFidWxhdG9yLXJvdy1vZGQ6bm90KC50YWJ1bGF0b3ItZ3JvdXApOm5vdCgudGFidWxhdG9yLWNhbGNzKVwiKTtcblx0XHRcdHN0eWxlcy5ldmVuUm93ID0gdGhpcy50YWJsZS5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFidWxhdG9yLXJvdy1ldmVuOm5vdCgudGFidWxhdG9yLWdyb3VwKTpub3QoLnRhYnVsYXRvci1jYWxjcylcIik7XG5cdFx0XHRzdHlsZXMuY2FsY1JvdyA9IHRoaXMudGFibGUuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnRhYnVsYXRvci1yb3cudGFidWxhdG9yLWNhbGNzXCIpO1xuXHRcdFx0c3R5bGVzLmZpcnN0Um93ID0gdGhpcy50YWJsZS5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFidWxhdG9yLXJvdzpub3QoLnRhYnVsYXRvci1ncm91cCk6bm90KC50YWJ1bGF0b3ItY2FsY3MpXCIpO1xuXHRcdFx0c3R5bGVzLmZpcnN0R3JvdXAgPSB0aGlzLnRhYmxlLmVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInRhYnVsYXRvci1ncm91cFwiKVswXTtcblx0XHRcdFxuXHRcdFx0aWYoc3R5bGVzLmZpcnN0Um93KXtcblx0XHRcdFx0c3R5bGVzLnN0eWxlQ2VsbHMgPSBzdHlsZXMuZmlyc3RSb3cuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInRhYnVsYXRvci1jZWxsXCIpO1xuXHRcdFx0XHRzdHlsZXMuc3R5bGVSb3dIZWFkZXIgPSBzdHlsZXMuZmlyc3RSb3cuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInRhYnVsYXRvci1yb3ctaGVhZGVyXCIpWzBdO1xuXHRcdFx0XHRzdHlsZXMuZmlyc3RDZWxsID0gc3R5bGVzLnN0eWxlQ2VsbHNbMF07XG5cdFx0XHRcdHN0eWxlcy5sYXN0Q2VsbCA9IHN0eWxlcy5zdHlsZUNlbGxzW3N0eWxlcy5zdHlsZUNlbGxzLmxlbmd0aCAtIDFdO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gc3R5bGVzO1xuXHR9XG5cdFxuXHRnZW5lcmF0ZUhlYWRlckVsZW1lbnQocm93LCBzZXR1cCwgc3R5bGVzKXtcblx0XHR2YXIgcm93RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XG5cdFx0XG5cdFx0cm93LmNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG5cdFx0XHRpZihjb2x1bW4pe1xuXHRcdFx0XHR2YXIgY2VsbEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRoXCIpO1xuXHRcdFx0XHR2YXIgY2xhc3NOYW1lcyA9IGNvbHVtbi5jb21wb25lbnQuX2NvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzID8gY29sdW1uLmNvbXBvbmVudC5fY29sdW1uLmRlZmluaXRpb24uY3NzQ2xhc3Muc3BsaXQoXCIgXCIpIDogW107XG5cdFx0XHRcdFxuXHRcdFx0XHRjZWxsRWwuY29sU3BhbiA9IGNvbHVtbi53aWR0aDtcblx0XHRcdFx0Y2VsbEVsLnJvd1NwYW4gPSBjb2x1bW4uaGVpZ2h0O1xuXHRcdFx0XHRcblx0XHRcdFx0Y2VsbEVsLmlubmVySFRNTCA9IGNvbHVtbi52YWx1ZTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMuY2xvbmVUYWJsZVN0eWxlKXtcblx0XHRcdFx0XHRjZWxsRWwuc3R5bGUuYm94U2l6aW5nID0gXCJib3JkZXItYm94XCI7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGNsYXNzTmFtZXMuZm9yRWFjaChmdW5jdGlvbihjbGFzc05hbWUpIHtcblx0XHRcdFx0XHRjZWxsRWwuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMubWFwRWxlbWVudFN0eWxlcyhjb2x1bW4uY29tcG9uZW50LmdldEVsZW1lbnQoKSwgY2VsbEVsLCBbXCJ0ZXh0LWFsaWduXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFwiY29sb3JcIiwgXCJmb250LXdlaWdodFwiLCBcImZvbnQtZmFtaWx5XCIsIFwiZm9udC1zaXplXCJdKTtcblx0XHRcdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKGNvbHVtbi5jb21wb25lbnQuX2NvbHVtbi5jb250ZW50RWxlbWVudCwgY2VsbEVsLCBbXCJwYWRkaW5nLXRvcFwiLCBcInBhZGRpbmctbGVmdFwiLCBcInBhZGRpbmctcmlnaHRcIiwgXCJwYWRkaW5nLWJvdHRvbVwiXSk7XG5cdFx0XG5cdFx0XHRcdGlmKGNvbHVtbi5jb21wb25lbnQuX2NvbHVtbi52aXNpYmxlKXtcblx0XHRcdFx0XHR0aGlzLm1hcEVsZW1lbnRTdHlsZXMoY29sdW1uLmNvbXBvbmVudC5nZXRFbGVtZW50KCksIGNlbGxFbCwgW1wid2lkdGhcIl0pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0aWYoY29sdW1uLmNvbXBvbmVudC5fY29sdW1uLmRlZmluaXRpb24ud2lkdGgpe1xuXHRcdFx0XHRcdFx0Y2VsbEVsLnN0eWxlLndpZHRoID0gY29sdW1uLmNvbXBvbmVudC5fY29sdW1uLmRlZmluaXRpb24ud2lkdGggKyBcInB4XCI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihjb2x1bW4uY29tcG9uZW50Ll9jb2x1bW4ucGFyZW50ICYmIGNvbHVtbi5jb21wb25lbnQuX2NvbHVtbi5wYXJlbnQuaXNHcm91cCl7XG5cdFx0XHRcdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKGNvbHVtbi5jb21wb25lbnQuX2NvbHVtbi5wYXJlbnQuZ3JvdXBFbGVtZW50LCBjZWxsRWwsIFtcImJvcmRlci10b3BcIl0pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKGNvbHVtbi5jb21wb25lbnQuZ2V0RWxlbWVudCgpLCBjZWxsRWwsIFtcImJvcmRlci10b3BcIl0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihjb2x1bW4uY29tcG9uZW50Ll9jb2x1bW4uaXNHcm91cCl7XG5cdFx0XHRcdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKGNvbHVtbi5jb21wb25lbnQuZ2V0RWxlbWVudCgpLCBjZWxsRWwsIFtcImJvcmRlci1ib3R0b21cIl0pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCksIGNlbGxFbCwgW1wiYm9yZGVyLWJvdHRvbVwiXSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHJvd0VsLmFwcGVuZENoaWxkKGNlbGxFbCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIHJvd0VsO1xuXHR9XG5cdFxuXHRnZW5lcmF0ZUdyb3VwRWxlbWVudChyb3csIHNldHVwLCBzdHlsZXMpe1xuXHRcdFxuXHRcdHZhciByb3dFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKSxcblx0XHRjZWxsRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIiksXG5cdFx0Z3JvdXAgPSByb3cuY29sdW1uc1swXTtcblx0XHRcblx0XHRyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LXRhYmxlLXJvd1wiKTtcblx0XHRcblx0XHRpZihzZXR1cC5ncm91cEhlYWRlciAmJiBzZXR1cC5ncm91cEhlYWRlcltyb3cuaW5kZW50XSl7XG5cdFx0XHRncm91cC52YWx1ZSA9IHNldHVwLmdyb3VwSGVhZGVyW3Jvdy5pbmRlbnRdKGdyb3VwLnZhbHVlLCByb3cuY29tcG9uZW50Ll9ncm91cC5nZXRSb3dDb3VudCgpLCByb3cuY29tcG9uZW50Ll9ncm91cC5nZXREYXRhKCksIHJvdy5jb21wb25lbnQpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHNldHVwLmdyb3VwSGVhZGVyICE9PSBmYWxzZSl7XG5cdFx0XHRcdGdyb3VwLnZhbHVlID0gcm93LmNvbXBvbmVudC5fZ3JvdXAuZ2VuZXJhdG9yKGdyb3VwLnZhbHVlLCByb3cuY29tcG9uZW50Ll9ncm91cC5nZXRSb3dDb3VudCgpLCByb3cuY29tcG9uZW50Ll9ncm91cC5nZXREYXRhKCksIHJvdy5jb21wb25lbnQpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRjZWxsRWwuY29sU3BhbiA9IGdyb3VwLndpZHRoO1xuXHRcdGNlbGxFbC5pbm5lckhUTUwgPSBncm91cC52YWx1ZTtcblx0XHRcblx0XHRyb3dFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LXRhYmxlLWdyb3VwXCIpO1xuXHRcdHJvd0VsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXAtbGV2ZWwtXCIgKyByb3cuaW5kZW50KTtcblx0XHRcblx0XHRpZihncm91cC5jb21wb25lbnQuaXNWaXNpYmxlKCkpe1xuXHRcdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1ncm91cC12aXNpYmxlXCIpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLm1hcEVsZW1lbnRTdHlsZXMoc3R5bGVzLmZpcnN0R3JvdXAsIHJvd0VsLCBbXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiY29sb3JcIiwgXCJmb250LXdlaWdodFwiLCBcImZvbnQtZmFtaWx5XCIsIFwiZm9udC1zaXplXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiXSk7XG5cdFx0dGhpcy5tYXBFbGVtZW50U3R5bGVzKHN0eWxlcy5maXJzdEdyb3VwLCBjZWxsRWwsIFtcInBhZGRpbmctdG9wXCIsIFwicGFkZGluZy1sZWZ0XCIsIFwicGFkZGluZy1yaWdodFwiLCBcInBhZGRpbmctYm90dG9tXCJdKTtcblx0XHRcblx0XHRyb3dFbC5hcHBlbmRDaGlsZChjZWxsRWwpO1xuXHRcdFxuXHRcdHJldHVybiByb3dFbDtcblx0fVxuXHRcblx0Z2VuZXJhdGVDYWxjRWxlbWVudChyb3csIHNldHVwLCBzdHlsZXMpe1xuXHRcdHZhciByb3dFbCA9IHRoaXMuZ2VuZXJhdGVSb3dFbGVtZW50KHJvdywgc2V0dXAsIHN0eWxlcyk7XG5cdFx0XG5cdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZS1jYWxjc1wiKTtcblx0XHR0aGlzLm1hcEVsZW1lbnRTdHlsZXMoc3R5bGVzLmNhbGNSb3csIHJvd0VsLCBbXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiY29sb3JcIiwgXCJmb250LXdlaWdodFwiLCBcImZvbnQtZmFtaWx5XCIsIFwiZm9udC1zaXplXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiXSk7XG5cdFx0XG5cdFx0cmV0dXJuIHJvd0VsO1xuXHR9XG5cdFxuXHRnZW5lcmF0ZVJvd0VsZW1lbnQocm93LCBzZXR1cCwgc3R5bGVzKXtcblx0XHR2YXIgcm93RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XG5cdFx0XG5cdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC10YWJsZS1yb3dcIik7XG5cdFx0XG5cdFx0cm93LmNvbHVtbnMuZm9yRWFjaCgoY29sLCBpKSA9PiB7XG5cdFx0XHRpZihjb2wpe1xuXHRcdFx0XHR2YXIgY2VsbEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpLFxuXHRcdFx0XHRjb2x1bW4gPSBjb2wuY29tcG9uZW50Ll9jb2x1bW4sXG5cdFx0XHRcdHRhYmxlID0gIHRoaXMudGFibGUsXG5cdFx0XHRcdGluZGV4ID0gdGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uSW5kZXgoY29sdW1uKSxcblx0XHRcdFx0dmFsdWUgPSBjb2wudmFsdWUsXG5cdFx0XHRcdGNlbGxTdHlsZSwgc3R5bGVQcm9wcztcblx0XHRcdFx0XG5cdFx0XHRcdHZhciBjZWxsV3JhcHBlciA9IHtcblx0XHRcdFx0XHRtb2R1bGVzOnt9LFxuXHRcdFx0XHRcdGdldFZhbHVlOmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRGaWVsZDpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5kZWZpbml0aW9uLmZpZWxkO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0RWxlbWVudDpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNlbGxFbDtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGdldFR5cGU6ZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHJldHVybiBcImNlbGxcIjtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGdldENvbHVtbjpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5nZXRDb21wb25lbnQoKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGdldERhdGE6ZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHJldHVybiByb3cuY29tcG9uZW50LmdldERhdGEoKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGdldFJvdzpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0cmV0dXJuIHJvdy5jb21wb25lbnQ7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRUYWJsZTpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRhYmxlO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0Q29tcG9uZW50OmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gY2VsbFdyYXBwZXI7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRjb2x1bW46Y29sdW1uLFxuXHRcdFx0XHR9O1xuXHRcdFx0XHRcblx0XHRcdFx0dmFyIGNsYXNzTmFtZXMgPSBjb2x1bW4uZGVmaW5pdGlvbi5jc3NDbGFzcyA/IGNvbHVtbi5kZWZpbml0aW9uLmNzc0NsYXNzLnNwbGl0KFwiIFwiKSA6IFtdO1xuXHRcdFx0XHRcblx0XHRcdFx0Y2xhc3NOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKGNsYXNzTmFtZSkge1xuXHRcdFx0XHRcdGNlbGxFbC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJmb3JtYXRcIikgJiYgdGhpcy5jb25maWcuZm9ybWF0Q2VsbHMgIT09IGZhbHNlKXtcblx0XHRcdFx0XHR2YWx1ZSA9IHRoaXMudGFibGUubW9kdWxlcy5mb3JtYXQuZm9ybWF0RXhwb3J0VmFsdWUoY2VsbFdyYXBwZXIsIHRoaXMuY29sVmlzUHJvcCk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRzd2l0Y2godHlwZW9mIHZhbHVlKXtcblx0XHRcdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZSAhPT0gbnVsbCA/IEpTT04uc3RyaW5naWZ5KHZhbHVlKSA6IFwiXCI7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cdFx0XHRcdFx0XHRcdHZhbHVlID0gXCJcIjtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih2YWx1ZSBpbnN0YW5jZW9mIE5vZGUpe1xuXHRcdFx0XHRcdGNlbGxFbC5hcHBlbmRDaGlsZCh2YWx1ZSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRjZWxsRWwuaW5uZXJIVE1MID0gdmFsdWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzdHlsZVByb3BzID0gW1wicGFkZGluZy10b3BcIiwgXCJwYWRkaW5nLWxlZnRcIiwgXCJwYWRkaW5nLXJpZ2h0XCIsIFwicGFkZGluZy1ib3R0b21cIiwgXCJib3JkZXItdG9wXCIsIFwiYm9yZGVyLWxlZnRcIiwgXCJib3JkZXItcmlnaHRcIiwgXCJib3JkZXItYm90dG9tXCIsIFwiY29sb3JcIiwgXCJmb250LXdlaWdodFwiLCBcImZvbnQtZmFtaWx5XCIsIFwiZm9udC1zaXplXCIsIFwidGV4dC1hbGlnblwiXTtcblxuXHRcdFx0XHRpZihjb2x1bW4uaXNSb3dIZWFkZXIpe1xuXHRcdFx0XHRcdGNlbGxTdHlsZSA9IHN0eWxlcy5zdHlsZVJvd0hlYWRlcjtcblx0XHRcdFx0XHRzdHlsZVByb3BzLnB1c2goXCJiYWNrZ3JvdW5kLWNvbG9yXCIpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y2VsbFN0eWxlID0gc3R5bGVzLnN0eWxlQ2VsbHMgJiYgc3R5bGVzLnN0eWxlQ2VsbHNbaW5kZXhdID8gc3R5bGVzLnN0eWxlQ2VsbHNbaW5kZXhdIDogc3R5bGVzLmZpcnN0Q2VsbDtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYoY2VsbFN0eWxlKXtcblx0XHRcdFx0XHR0aGlzLm1hcEVsZW1lbnRTdHlsZXMoY2VsbFN0eWxlLCBjZWxsRWwsIHN0eWxlUHJvcHMpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLmFsaWduKXtcblx0XHRcdFx0XHRcdGNlbGxFbC5zdHlsZS50ZXh0QWxpZ24gPSBjb2x1bW4uZGVmaW5pdGlvbi5hbGlnbjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5kYXRhVHJlZSAmJiB0aGlzLmNvbmZpZy5kYXRhVHJlZSAhPT0gZmFsc2Upe1xuXHRcdFx0XHRcdGlmKChzZXR1cC50cmVlRWxlbWVudEZpZWxkICYmIHNldHVwLnRyZWVFbGVtZW50RmllbGQgPT0gY29sdW1uLmZpZWxkKSB8fCAoIXNldHVwLnRyZWVFbGVtZW50RmllbGQgJiYgaSA9PSAwKSl7XG5cdFx0XHRcdFx0XHRpZihyb3cuY29tcG9uZW50Ll9yb3cubW9kdWxlcy5kYXRhVHJlZS5jb250cm9sRWwpe1xuXHRcdFx0XHRcdFx0XHRjZWxsRWwuaW5zZXJ0QmVmb3JlKHJvdy5jb21wb25lbnQuX3Jvdy5tb2R1bGVzLmRhdGFUcmVlLmNvbnRyb2xFbC5jbG9uZU5vZGUodHJ1ZSksIGNlbGxFbC5maXJzdENoaWxkKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGlmKHJvdy5jb21wb25lbnQuX3Jvdy5tb2R1bGVzLmRhdGFUcmVlLmJyYW5jaEVsKXtcblx0XHRcdFx0XHRcdFx0Y2VsbEVsLmluc2VydEJlZm9yZShyb3cuY29tcG9uZW50Ll9yb3cubW9kdWxlcy5kYXRhVHJlZS5icmFuY2hFbC5jbG9uZU5vZGUodHJ1ZSksIGNlbGxFbC5maXJzdENoaWxkKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHJvd0VsLmFwcGVuZENoaWxkKGNlbGxFbCk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihjZWxsV3JhcHBlci5tb2R1bGVzLmZvcm1hdCAmJiBjZWxsV3JhcHBlci5tb2R1bGVzLmZvcm1hdC5yZW5kZXJlZENhbGxiYWNrKXtcblx0XHRcdFx0XHRjZWxsV3JhcHBlci5tb2R1bGVzLmZvcm1hdC5yZW5kZXJlZENhbGxiYWNrKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRpZihzZXR1cC5yb3dGb3JtYXR0ZXIgJiYgcm93LnR5cGUgPT09IFwicm93XCIgJiYgdGhpcy5jb25maWcuZm9ybWF0Q2VsbHMgIT09IGZhbHNlKXtcblx0XHRcdGxldCBmb3JtYXRDb21wb25lbnQgPSBPYmplY3QuYXNzaWduKHJvdy5jb21wb25lbnQpO1xuXG5cdFx0XHRmb3JtYXRDb21wb25lbnQuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uKCl7cmV0dXJuIHJvd0VsO307XG5cblx0XHRcdHNldHVwLnJvd0Zvcm1hdHRlcihyb3cuY29tcG9uZW50KTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHJvd0VsO1xuXHR9XG5cdFxuXHRnZW5lcmF0ZUhUTUxUYWJsZShsaXN0KXtcblx0XHR2YXIgaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcblx0XHRob2xkZXIuYXBwZW5kQ2hpbGQodGhpcy5nZW5lcmF0ZVRhYmxlRWxlbWVudChsaXN0KSk7XG5cdFx0XG5cdFx0cmV0dXJuIGhvbGRlci5pbm5lckhUTUw7XG5cdH1cblx0XG5cdGdldEh0bWwodmlzaWJsZSwgc3R5bGUsIGNvbmZpZywgY29sVmlzUHJvcCl7XG5cdFx0dmFyIGxpc3QgPSB0aGlzLmdlbmVyYXRlRXhwb3J0TGlzdChjb25maWcgfHwgdGhpcy50YWJsZS5vcHRpb25zLmh0bWxPdXRwdXRDb25maWcsIHN0eWxlLCB2aXNpYmxlLCBjb2xWaXNQcm9wIHx8IFwiaHRtbE91dHB1dFwiKTtcblx0XHRcblx0XHRyZXR1cm4gdGhpcy5nZW5lcmF0ZUhUTUxUYWJsZShsaXN0KTtcblx0fVxuXHRcblx0bWFwRWxlbWVudFN0eWxlcyhmcm9tLCB0bywgcHJvcHMpe1xuXHRcdGlmKHRoaXMuY2xvbmVUYWJsZVN0eWxlICYmIGZyb20gJiYgdG8pe1xuXHRcdFx0XG5cdFx0XHR2YXIgbG9va3VwID0ge1xuXHRcdFx0XHRcImJhY2tncm91bmQtY29sb3JcIiA6IFwiYmFja2dyb3VuZENvbG9yXCIsXG5cdFx0XHRcdFwiY29sb3JcIiA6IFwiZm9udENvbG9yXCIsXG5cdFx0XHRcdFwid2lkdGhcIiA6IFwid2lkdGhcIixcblx0XHRcdFx0XCJmb250LXdlaWdodFwiIDogXCJmb250V2VpZ2h0XCIsXG5cdFx0XHRcdFwiZm9udC1mYW1pbHlcIiA6IFwiZm9udEZhbWlseVwiLFxuXHRcdFx0XHRcImZvbnQtc2l6ZVwiIDogXCJmb250U2l6ZVwiLFxuXHRcdFx0XHRcInRleHQtYWxpZ25cIiA6IFwidGV4dEFsaWduXCIsXG5cdFx0XHRcdFwiYm9yZGVyLXRvcFwiIDogXCJib3JkZXJUb3BcIixcblx0XHRcdFx0XCJib3JkZXItbGVmdFwiIDogXCJib3JkZXJMZWZ0XCIsXG5cdFx0XHRcdFwiYm9yZGVyLXJpZ2h0XCIgOiBcImJvcmRlclJpZ2h0XCIsXG5cdFx0XHRcdFwiYm9yZGVyLWJvdHRvbVwiIDogXCJib3JkZXJCb3R0b21cIixcblx0XHRcdFx0XCJwYWRkaW5nLXRvcFwiIDogXCJwYWRkaW5nVG9wXCIsXG5cdFx0XHRcdFwicGFkZGluZy1sZWZ0XCIgOiBcInBhZGRpbmdMZWZ0XCIsXG5cdFx0XHRcdFwicGFkZGluZy1yaWdodFwiIDogXCJwYWRkaW5nUmlnaHRcIixcblx0XHRcdFx0XCJwYWRkaW5nLWJvdHRvbVwiIDogXCJwYWRkaW5nQm90dG9tXCIsXG5cdFx0XHR9O1xuXHRcdFx0XG5cdFx0XHRpZih3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSl7XG5cdFx0XHRcdHZhciBmcm9tU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShmcm9tKTtcblxuXHRcdFx0XHRwcm9wcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3Ape1xuXHRcdFx0XHRcdGlmKCF0by5zdHlsZVtsb29rdXBbcHJvcF1dKXtcblx0XHRcdFx0XHRcdHRvLnN0eWxlW2xvb2t1cFtwcm9wXV0gPSBmcm9tU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG52YXIgZGVmYXVsdEZpbHRlcnMgPSB7XG5cblx0Ly9lcXVhbCB0b1xuXHRcIj1cIjpmdW5jdGlvbihmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKXtcblx0XHRyZXR1cm4gcm93VmFsID09IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0fSxcblxuXHQvL2xlc3MgdGhhblxuXHRcIjxcIjpmdW5jdGlvbihmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKXtcblx0XHRyZXR1cm4gcm93VmFsIDwgZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHR9LFxuXG5cdC8vbGVzcyB0aGFuIG9yIGVxdWFsIHRvXG5cdFwiPD1cIjpmdW5jdGlvbihmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKXtcblx0XHRyZXR1cm4gcm93VmFsIDw9IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0fSxcblxuXHQvL2dyZWF0ZXIgdGhhblxuXHRcIj5cIjpmdW5jdGlvbihmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKXtcblx0XHRyZXR1cm4gcm93VmFsID4gZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHR9LFxuXG5cdC8vZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvXG5cdFwiPj1cIjpmdW5jdGlvbihmaWx0ZXJWYWwsIHJvd1ZhbCwgcm93RGF0YSwgZmlsdGVyUGFyYW1zKXtcblx0XHRyZXR1cm4gcm93VmFsID49IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0fSxcblxuXHQvL25vdCBlcXVhbCB0b1xuXHRcIiE9XCI6ZnVuY3Rpb24oZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcyl7XG5cdFx0cmV0dXJuIHJvd1ZhbCAhPSBmaWx0ZXJWYWwgPyB0cnVlIDogZmFsc2U7XG5cdH0sXG5cblx0XCJyZWdleFwiOmZ1bmN0aW9uKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpe1xuXG5cdFx0aWYodHlwZW9mIGZpbHRlclZhbCA9PSBcInN0cmluZ1wiKXtcblx0XHRcdGZpbHRlclZhbCA9IG5ldyBSZWdFeHAoZmlsdGVyVmFsKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmlsdGVyVmFsLnRlc3Qocm93VmFsKTtcblx0fSxcblxuXHQvL2NvbnRhaW5zIHRoZSBzdHJpbmdcblx0XCJsaWtlXCI6ZnVuY3Rpb24oZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcyl7XG5cdFx0aWYoZmlsdGVyVmFsID09PSBudWxsIHx8IHR5cGVvZiBmaWx0ZXJWYWwgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0cmV0dXJuIHJvd1ZhbCA9PT0gZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHR5cGVvZiByb3dWYWwgIT09ICd1bmRlZmluZWQnICYmIHJvd1ZhbCAhPT0gbnVsbCl7XG5cdFx0XHRcdHJldHVybiBTdHJpbmcocm93VmFsKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoZmlsdGVyVmFsLnRvTG93ZXJDYXNlKCkpID4gLTE7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0fSxcblxuXHQvL2NvbnRhaW5zIHRoZSBrZXl3b3Jkc1xuXHRcImtleXdvcmRzXCI6ZnVuY3Rpb24oZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcyl7XG5cdFx0dmFyIGtleXdvcmRzID0gZmlsdGVyVmFsLnRvTG93ZXJDYXNlKCkuc3BsaXQodHlwZW9mIGZpbHRlclBhcmFtcy5zZXBhcmF0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcIiBcIiA6IGZpbHRlclBhcmFtcy5zZXBhcmF0b3IpLFxuXHRcdHZhbHVlID0gU3RyaW5nKHJvd1ZhbCA9PT0gbnVsbCB8fCB0eXBlb2Ygcm93VmFsID09PSBcInVuZGVmaW5lZFwiID8gXCJcIiA6IHJvd1ZhbCkudG9Mb3dlckNhc2UoKSxcblx0XHRtYXRjaGVzID0gW107XG5cblx0XHRrZXl3b3Jkcy5mb3JFYWNoKChrZXl3b3JkKSA9Pntcblx0XHRcdGlmKHZhbHVlLmluY2x1ZGVzKGtleXdvcmQpKXtcblx0XHRcdFx0bWF0Y2hlcy5wdXNoKHRydWUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGZpbHRlclBhcmFtcy5tYXRjaEFsbCA/IG1hdGNoZXMubGVuZ3RoID09PSBrZXl3b3Jkcy5sZW5ndGggOiAhIW1hdGNoZXMubGVuZ3RoO1xuXHR9LFxuXG5cdC8vc3RhcnRzIHdpdGggdGhlIHN0cmluZ1xuXHRcInN0YXJ0c1wiOmZ1bmN0aW9uKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpe1xuXHRcdGlmKGZpbHRlclZhbCA9PT0gbnVsbCB8fCB0eXBlb2YgZmlsdGVyVmFsID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdHJldHVybiByb3dWYWwgPT09IGZpbHRlclZhbCA/IHRydWUgOiBmYWxzZTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRpZih0eXBlb2Ygcm93VmFsICE9PSAndW5kZWZpbmVkJyAmJiByb3dWYWwgIT09IG51bGwpe1xuXHRcdFx0XHRyZXR1cm4gU3RyaW5nKHJvd1ZhbCkudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKGZpbHRlclZhbC50b0xvd2VyQ2FzZSgpKTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXG5cdC8vZW5kcyB3aXRoIHRoZSBzdHJpbmdcblx0XCJlbmRzXCI6ZnVuY3Rpb24oZmlsdGVyVmFsLCByb3dWYWwsIHJvd0RhdGEsIGZpbHRlclBhcmFtcyl7XG5cdFx0aWYoZmlsdGVyVmFsID09PSBudWxsIHx8IHR5cGVvZiBmaWx0ZXJWYWwgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0cmV0dXJuIHJvd1ZhbCA9PT0gZmlsdGVyVmFsID8gdHJ1ZSA6IGZhbHNlO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHR5cGVvZiByb3dWYWwgIT09ICd1bmRlZmluZWQnICYmIHJvd1ZhbCAhPT0gbnVsbCl7XG5cdFx0XHRcdHJldHVybiBTdHJpbmcocm93VmFsKS50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKGZpbHRlclZhbC50b0xvd2VyQ2FzZSgpKTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuXG5cdC8vaW4gYXJyYXlcblx0XCJpblwiOmZ1bmN0aW9uKGZpbHRlclZhbCwgcm93VmFsLCByb3dEYXRhLCBmaWx0ZXJQYXJhbXMpe1xuXHRcdGlmKEFycmF5LmlzQXJyYXkoZmlsdGVyVmFsKSl7XG5cdFx0XHRyZXR1cm4gZmlsdGVyVmFsLmxlbmd0aCA/IGZpbHRlclZhbC5pbmRleE9mKHJvd1ZhbCkgPiAtMSA6IHRydWU7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRmlsdGVyIEVycm9yIC0gZmlsdGVyIHZhbHVlIGlzIG5vdCBhbiBhcnJheTpcIiwgZmlsdGVyVmFsKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH0sXG59O1xuXG5jbGFzcyBGaWx0ZXIgZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcImZpbHRlclwiO1xuXG5cdC8vbG9hZCBkZWZhdWx0c1xuXHRzdGF0aWMgZmlsdGVycyA9IGRlZmF1bHRGaWx0ZXJzO1xuXG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cblx0XHR0aGlzLmZpbHRlckxpc3QgPSBbXTsgLy9ob2xkIGZpbHRlciBsaXN0XG5cdFx0dGhpcy5oZWFkZXJGaWx0ZXJzID0ge307IC8vaG9sZCBjb2x1bW4gZmlsdGVyc1xuXHRcdHRoaXMuaGVhZGVyRmlsdGVyQ29sdW1ucyA9IFtdOyAvL2hvbGQgY29sdW1ucyB0aGF0IHVzZSBoZWFkZXIgZmlsdGVyc1xuXG5cdFx0dGhpcy5wcmV2SGVhZGVyRmlsdGVyQ2hhbmdlQ2hlY2sgPSBcIlwiO1xuXHRcdHRoaXMucHJldkhlYWRlckZpbHRlckNoYW5nZUNoZWNrID0gXCJ7fVwiO1xuXG5cdFx0dGhpcy5jaGFuZ2VkID0gZmFsc2U7IC8vaGFzIGZpbHRlcmluZyBjaGFuZ2VkIHNpbmNlIGxhc3QgcmVuZGVyXG5cdFx0dGhpcy50YWJsZUluaXRpYWxpemVkID0gZmFsc2U7XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJmaWx0ZXJNb2RlXCIsIFwibG9jYWxcIik7IC8vbG9jYWwgb3IgcmVtb3RlIGZpbHRlcmluZ1xuXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiaW5pdGlhbEZpbHRlclwiLCBmYWxzZSk7IC8vaW5pdGlhbCBmaWx0ZXJpbmcgY3JpdGVyaWFcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJpbml0aWFsSGVhZGVyRmlsdGVyXCIsIGZhbHNlKTsgLy9pbml0aWFsIGhlYWRlciBmaWx0ZXJpbmcgY3JpdGVyaWFcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJoZWFkZXJGaWx0ZXJMaXZlRmlsdGVyRGVsYXlcIiwgMzAwKTsgLy9kZWxheSBiZWZvcmUgdXBkYXRpbmcgY29sdW1uIGFmdGVyIHVzZXIgdHlwZXMgaW4gaGVhZGVyIGZpbHRlclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInBsYWNlaG9sZGVySGVhZGVyRmlsdGVyXCIsIGZhbHNlKTsgLy9wbGFjZWhvbGRlciB3aGVuIGhlYWRlciBmaWx0ZXIgaXMgZW1wdHlcblxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJGaWx0ZXJcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckZpbHRlclBsYWNlaG9sZGVyXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJGaWx0ZXJQYXJhbXNcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckZpbHRlckVtcHR5Q2hlY2tcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckZpbHRlckZ1bmNcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckZpbHRlckZ1bmNQYXJhbXNcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckZpbHRlckxpdmVGaWx0ZXJcIik7XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInNlYXJjaFJvd3NcIiwgdGhpcy5zZWFyY2hSb3dzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwic2VhcmNoRGF0YVwiLCB0aGlzLnNlYXJjaERhdGEuYmluZCh0aGlzKSk7XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInNldEZpbHRlclwiLCB0aGlzLnVzZXJTZXRGaWx0ZXIuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJyZWZyZXNoRmlsdGVyXCIsIHRoaXMudXNlclJlZnJlc2hGaWx0ZXIuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJhZGRGaWx0ZXJcIiwgdGhpcy51c2VyQWRkRmlsdGVyLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiZ2V0RmlsdGVyc1wiLCB0aGlzLmdldEZpbHRlcnMuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJzZXRIZWFkZXJGaWx0ZXJGb2N1c1wiLCB0aGlzLnVzZXJTZXRIZWFkZXJGaWx0ZXJGb2N1cy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldEhlYWRlckZpbHRlclZhbHVlXCIsIHRoaXMudXNlckdldEhlYWRlckZpbHRlclZhbHVlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwic2V0SGVhZGVyRmlsdGVyVmFsdWVcIiwgdGhpcy51c2VyU2V0SGVhZGVyRmlsdGVyVmFsdWUuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRIZWFkZXJGaWx0ZXJzXCIsIHRoaXMuZ2V0SGVhZGVyRmlsdGVycy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInJlbW92ZUZpbHRlclwiLCB0aGlzLnVzZXJSZW1vdmVGaWx0ZXIuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJjbGVhckZpbHRlclwiLCB0aGlzLnVzZXJDbGVhckZpbHRlci5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImNsZWFySGVhZGVyRmlsdGVyXCIsIHRoaXMudXNlckNsZWFySGVhZGVyRmlsdGVyLmJpbmQodGhpcykpO1xuXG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY29sdW1uXCIsIFwiaGVhZGVyRmlsdGVyRm9jdXNcIiwgdGhpcy5zZXRIZWFkZXJGaWx0ZXJGb2N1cy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJjb2x1bW5cIiwgXCJyZWxvYWRIZWFkZXJGaWx0ZXJcIiwgdGhpcy5yZWxvYWRIZWFkZXJGaWx0ZXIuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY29sdW1uXCIsIFwiZ2V0SGVhZGVyRmlsdGVyVmFsdWVcIiwgdGhpcy5nZXRIZWFkZXJGaWx0ZXJWYWx1ZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJjb2x1bW5cIiwgXCJzZXRIZWFkZXJGaWx0ZXJWYWx1ZVwiLCB0aGlzLnNldEhlYWRlckZpbHRlclZhbHVlLmJpbmQodGhpcykpO1xuXHR9XG5cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWluaXRcIiwgdGhpcy5pbml0aWFsaXplQ29sdW1uSGVhZGVyRmlsdGVyLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLXdpZHRoLWZpdC1iZWZvcmVcIiwgdGhpcy5oaWRlSGVhZGVyRmlsdGVyRWxlbWVudHMuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4td2lkdGgtZml0LWFmdGVyXCIsIHRoaXMuc2hvd0hlYWRlckZpbHRlckVsZW1lbnRzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtYnVpbHRcIiwgdGhpcy50YWJsZUJ1aWx0LmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwicGxhY2Vob2xkZXJcIiwgdGhpcy5nZW5lcmF0ZVBsYWNlaG9sZGVyLmJpbmQodGhpcykpO1xuXG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmZpbHRlck1vZGUgPT09IFwicmVtb3RlXCIpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLXBhcmFtc1wiLCB0aGlzLnJlbW90ZUZpbHRlclBhcmFtcy5iaW5kKHRoaXMpKTtcblx0XHR9XG5cblx0XHR0aGlzLnJlZ2lzdGVyRGF0YUhhbmRsZXIodGhpcy5maWx0ZXIuYmluZCh0aGlzKSwgMTApO1xuXHR9XG5cblx0dGFibGVCdWlsdCgpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5pbml0aWFsRmlsdGVyKXtcblx0XHRcdHRoaXMuc2V0RmlsdGVyKHRoaXMudGFibGUub3B0aW9ucy5pbml0aWFsRmlsdGVyKTtcblx0XHR9XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuaW5pdGlhbEhlYWRlckZpbHRlcil7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuaW5pdGlhbEhlYWRlckZpbHRlci5mb3JFYWNoKChpdGVtKSA9PiB7XG5cblx0XHRcdFx0dmFyIGNvbHVtbiA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGl0ZW0uZmllbGQpO1xuXG5cdFx0XHRcdGlmKGNvbHVtbil7XG5cdFx0XHRcdFx0dGhpcy5zZXRIZWFkZXJGaWx0ZXJWYWx1ZShjb2x1bW4sIGl0ZW0udmFsdWUpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIEZpbHRlciBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgaXRlbS5maWVsZCk7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHR0aGlzLnRhYmxlSW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHR9XG5cblx0cmVtb3RlRmlsdGVyUGFyYW1zKGRhdGEsIGNvbmZpZywgc2lsZW50LCBwYXJhbXMpe1xuXHRcdHBhcmFtcy5maWx0ZXIgPSB0aGlzLmdldEZpbHRlcnModHJ1ZSwgdHJ1ZSk7XG5cdFx0cmV0dXJuIHBhcmFtcztcblx0fVxuXG5cdGdlbmVyYXRlUGxhY2Vob2xkZXIodGV4dCl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVySGVhZGVyRmlsdGVyICYmIE9iamVjdC5rZXlzKHRoaXMuaGVhZGVyRmlsdGVycykubGVuZ3RoKXtcblx0XHRcdHJldHVybiB0aGlzLnRhYmxlLm9wdGlvbnMucGxhY2Vob2xkZXJIZWFkZXJGaWx0ZXI7XG5cdFx0fVxuXHR9XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIFRhYmxlIEZ1bmN0aW9ucyAvLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHQvL3NldCBzdGFuZGFyZCBmaWx0ZXJzXG5cdHVzZXJTZXRGaWx0ZXIoZmllbGQsIHR5cGUsIHZhbHVlLCBwYXJhbXMpe1xuXHRcdHRoaXMuc2V0RmlsdGVyKGZpZWxkLCB0eXBlLCB2YWx1ZSwgcGFyYW1zKTtcblx0XHR0aGlzLnJlZnJlc2hGaWx0ZXIoKTtcblx0fVxuXG5cdC8vc2V0IHN0YW5kYXJkIGZpbHRlcnNcblx0dXNlclJlZnJlc2hGaWx0ZXIoKXtcblx0XHR0aGlzLnJlZnJlc2hGaWx0ZXIoKTtcblx0fVxuXG5cdC8vYWRkIGZpbHRlciB0byBhcnJheVxuXHR1c2VyQWRkRmlsdGVyKGZpZWxkLCB0eXBlLCB2YWx1ZSwgcGFyYW1zKXtcblx0XHR0aGlzLmFkZEZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUsIHBhcmFtcyk7XG5cdFx0dGhpcy5yZWZyZXNoRmlsdGVyKCk7XG5cdH1cblxuXHR1c2VyU2V0SGVhZGVyRmlsdGVyRm9jdXMoZmllbGQpe1xuXHRcdHZhciBjb2x1bW4gPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRpZihjb2x1bW4pe1xuXHRcdFx0dGhpcy5zZXRIZWFkZXJGaWx0ZXJGb2N1cyhjb2x1bW4pO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRm9jdXMgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblxuXHR1c2VyR2V0SGVhZGVyRmlsdGVyVmFsdWUoZmllbGQpIHtcblx0XHR2YXIgY29sdW1uID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXG5cdFx0aWYoY29sdW1uKXtcblx0XHRcdHJldHVybiB0aGlzLmdldEhlYWRlckZpbHRlclZhbHVlKGNvbHVtbik7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIEZpbHRlciBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXHRcdH1cblx0fVxuXG5cdHVzZXJTZXRIZWFkZXJGaWx0ZXJWYWx1ZShmaWVsZCwgdmFsdWUpe1xuXHRcdHZhciBjb2x1bW4gPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7XG5cblx0XHRpZihjb2x1bW4pe1xuXHRcdFx0dGhpcy5zZXRIZWFkZXJGaWx0ZXJWYWx1ZShjb2x1bW4sIHZhbHVlKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cblx0Ly9yZW1vdmUgZmlsdGVyIGZyb20gYXJyYXlcblx0dXNlclJlbW92ZUZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUpe1xuXHRcdHRoaXMucmVtb3ZlRmlsdGVyKGZpZWxkLCB0eXBlLCB2YWx1ZSk7XG5cdFx0dGhpcy5yZWZyZXNoRmlsdGVyKCk7XG5cdH1cblxuXHQvL2NsZWFyIGZpbHRlcnNcblx0dXNlckNsZWFyRmlsdGVyKGFsbCl7XG5cdFx0dGhpcy5jbGVhckZpbHRlcihhbGwpO1xuXHRcdHRoaXMucmVmcmVzaEZpbHRlcigpO1xuXHR9XG5cblx0Ly9jbGVhciBoZWFkZXIgZmlsdGVyc1xuXHR1c2VyQ2xlYXJIZWFkZXJGaWx0ZXIoKXtcblx0XHR0aGlzLmNsZWFySGVhZGVyRmlsdGVyKCk7XG5cdFx0dGhpcy5yZWZyZXNoRmlsdGVyKCk7XG5cdH1cblxuXG5cdC8vc2VhcmNoIGZvciBzcGVjaWZpYyByb3cgY29tcG9uZW50c1xuXHRzZWFyY2hSb3dzKGZpZWxkLCB0eXBlLCB2YWx1ZSl7XG5cdFx0cmV0dXJuIHRoaXMuc2VhcmNoKFwicm93c1wiLCBmaWVsZCwgdHlwZSwgdmFsdWUpO1xuXHR9XG5cblx0Ly9zZWFyY2ggZm9yIHNwZWNpZmljIGRhdGFcblx0c2VhcmNoRGF0YShmaWVsZCwgdHlwZSwgdmFsdWUpe1xuXHRcdHJldHVybiB0aGlzLnNlYXJjaChcImRhdGFcIiwgZmllbGQsIHR5cGUsIHZhbHVlKTtcblx0fVxuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBJbnRlcm5hbCBMb2dpYyAvLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0aW5pdGlhbGl6ZUNvbHVtbkhlYWRlckZpbHRlcihjb2x1bW4pe1xuXHRcdHZhciBkZWYgPSBjb2x1bW4uZGVmaW5pdGlvbjtcblxuXHRcdGlmKGRlZi5oZWFkZXJGaWx0ZXIpe1xuXHRcdFx0dGhpcy5pbml0aWFsaXplQ29sdW1uKGNvbHVtbik7XG5cdFx0fVxuXHR9XG5cblx0Ly9pbml0aWFsaXplIGNvbHVtbiBoZWFkZXIgZmlsdGVyXG5cdGluaXRpYWxpemVDb2x1bW4oY29sdW1uLCB2YWx1ZSl7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdGZpZWxkID0gY29sdW1uLmdldEZpZWxkKCk7XG5cblx0XHQvL2hhbmRsZSBzdWNjZXNzZnVsbHkgdmFsdWUgY2hhbmdlXG5cdFx0ZnVuY3Rpb24gc3VjY2Vzcyh2YWx1ZSl7XG5cdFx0XHR2YXIgZmlsdGVyVHlwZSA9IChjb2x1bW4ubW9kdWxlcy5maWx0ZXIudGFnVHlwZSA9PSBcImlucHV0XCIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmF0dHJUeXBlID09IFwidGV4dFwiKSB8fCBjb2x1bW4ubW9kdWxlcy5maWx0ZXIudGFnVHlwZSA9PSBcInRleHRhcmVhXCIgPyBcInBhcnRpYWxcIiA6IFwibWF0Y2hcIixcblx0XHRcdHR5cGUgPSBcIlwiLFxuXHRcdFx0ZmlsdGVyQ2hhbmdlQ2hlY2sgPSBcIlwiLFxuXHRcdFx0ZmlsdGVyRnVuYztcblxuXHRcdFx0aWYodHlwZW9mIGNvbHVtbi5tb2R1bGVzLmZpbHRlci5wcmV2U3VjY2VzcyA9PT0gXCJ1bmRlZmluZWRcIiB8fCBjb2x1bW4ubW9kdWxlcy5maWx0ZXIucHJldlN1Y2Nlc3MgIT09IHZhbHVlKXtcblxuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIucHJldlN1Y2Nlc3MgPSB2YWx1ZTtcblxuXHRcdFx0XHRpZighY29sdW1uLm1vZHVsZXMuZmlsdGVyLmVtcHR5RnVuYyh2YWx1ZSkpe1xuXHRcdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci52YWx1ZSA9IHZhbHVlO1xuXG5cdFx0XHRcdFx0c3dpdGNoKHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jKXtcblx0XHRcdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRcdFx0aWYoRmlsdGVyLmZpbHRlcnNbY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuY10pe1xuXHRcdFx0XHRcdFx0XHRcdHR5cGUgPSBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jO1xuXHRcdFx0XHRcdFx0XHRcdGZpbHRlckZ1bmMgPSBmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBwYXJhbXMgPSBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jUGFyYW1zIHx8IHt9O1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIGZpZWxkVmFsID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBwYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IHBhcmFtcyh2YWx1ZSwgZmllbGRWYWwsIGRhdGEpIDogcGFyYW1zO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gRmlsdGVyLmZpbHRlcnNbY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuY10odmFsdWUsIGZpZWxkVmFsLCBkYXRhLCBwYXJhbXMpO1xuXHRcdFx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJIZWFkZXIgRmlsdGVyIEVycm9yIC0gTWF0Y2hpbmcgZmlsdGVyIGZ1bmN0aW9uIG5vdCBmb3VuZDogXCIsIGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckZ1bmMpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRcdFx0ZmlsdGVyRnVuYyA9IGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRcdFx0XHRcdHZhciBwYXJhbXMgPSBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJGdW5jUGFyYW1zIHx8IHt9O1xuXHRcdFx0XHRcdFx0XHRcdHZhciBmaWVsZFZhbCA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpO1xuXG5cdFx0XHRcdFx0XHRcdFx0cGFyYW1zID0gdHlwZW9mIHBhcmFtcyA9PT0gXCJmdW5jdGlvblwiID8gcGFyYW1zKHZhbHVlLCBmaWVsZFZhbCwgZGF0YSkgOiBwYXJhbXM7XG5cblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRnVuYyh2YWx1ZSwgZmllbGRWYWwsIGRhdGEsIHBhcmFtcyk7XG5cdFx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdFx0dHlwZSA9IGZpbHRlckZ1bmM7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmKCFmaWx0ZXJGdW5jKXtcblx0XHRcdFx0XHRcdHN3aXRjaChmaWx0ZXJUeXBlKXtcblx0XHRcdFx0XHRcdFx0Y2FzZSBcInBhcnRpYWxcIjpcblx0XHRcdFx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgY29sVmFsID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmKHR5cGVvZiBjb2xWYWwgIT09ICd1bmRlZmluZWQnICYmIGNvbFZhbCAhPT0gbnVsbCl7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBTdHJpbmcoY29sVmFsKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoU3RyaW5nKHZhbHVlKS50b0xvd2VyQ2FzZSgpKSA+IC0xO1xuXHRcdFx0XHRcdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHR0eXBlID0gXCJsaWtlXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSkgPT0gdmFsdWU7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0XHR0eXBlID0gXCI9XCI7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi5oZWFkZXJGaWx0ZXJzW2ZpZWxkXSA9IHt2YWx1ZTp2YWx1ZSwgZnVuYzpmaWx0ZXJGdW5jLCB0eXBlOnR5cGV9O1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0ZGVsZXRlIHNlbGYuaGVhZGVyRmlsdGVyc1tmaWVsZF07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIudmFsdWUgPSB2YWx1ZTtcblxuXHRcdFx0XHRmaWx0ZXJDaGFuZ2VDaGVjayA9IEpTT04uc3RyaW5naWZ5KHNlbGYuaGVhZGVyRmlsdGVycyk7XG5cblx0XHRcdFx0aWYoc2VsZi5wcmV2SGVhZGVyRmlsdGVyQ2hhbmdlQ2hlY2sgIT09IGZpbHRlckNoYW5nZUNoZWNrKXtcblx0XHRcdFx0XHRzZWxmLnByZXZIZWFkZXJGaWx0ZXJDaGFuZ2VDaGVjayA9IGZpbHRlckNoYW5nZUNoZWNrO1xuXG5cdFx0XHRcdFx0c2VsZi50cmFja0NoYW5nZXMoKTtcblx0XHRcdFx0XHRzZWxmLnJlZnJlc2hGaWx0ZXIoKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIgPSB7XG5cdFx0XHRzdWNjZXNzOnN1Y2Nlc3MsXG5cdFx0XHRhdHRyVHlwZTpmYWxzZSxcblx0XHRcdHRhZ1R5cGU6ZmFsc2UsXG5cdFx0XHRlbXB0eUZ1bmM6ZmFsc2UsXG5cdFx0fTtcblxuXHRcdHRoaXMuZ2VuZXJhdGVIZWFkZXJGaWx0ZXJFbGVtZW50KGNvbHVtbik7XG5cdH1cblxuXHRnZW5lcmF0ZUhlYWRlckZpbHRlckVsZW1lbnQoY29sdW1uLCBpbml0aWFsVmFsdWUsIHJlaW5pdGlhbGl6ZSl7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdHN1Y2Nlc3MgPSBjb2x1bW4ubW9kdWxlcy5maWx0ZXIuc3VjY2Vzcyxcblx0XHRmaWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpLFxuXHRcdGZpbHRlckVsZW1lbnQsIGVkaXRvciwgZWRpdG9yRWxlbWVudCwgY2VsbFdyYXBwZXIsIHR5cGluZ1RpbWVyLCBzZWFyY2hUcmlnZ2VyLCBwYXJhbXMsIG9uUmVuZGVyZWRDYWxsYmFjaztcblxuXHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci52YWx1ZSA9IGluaXRpYWxWYWx1ZTtcblxuXHRcdC8vaGFuZGxlIGFib3J0ZWQgZWRpdFxuXHRcdGZ1bmN0aW9uIGNhbmNlbCgpe31cblxuXHRcdGZ1bmN0aW9uIG9uUmVuZGVyZWQoY2FsbGJhY2spe1xuXHRcdFx0b25SZW5kZXJlZENhbGxiYWNrID0gY2FsbGJhY2s7XG5cdFx0fVxuXG5cdFx0aWYoY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQucGFyZW50Tm9kZSl7XG5cdFx0XHRjb2x1bW4uY29udGVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQucGFyZW50Tm9kZSk7XG5cdFx0fVxuXG5cdFx0aWYoZmllbGQpe1xuXG5cdFx0XHQvL3NldCBlbXB0eSB2YWx1ZSBmdW5jdGlvblxuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmVtcHR5RnVuYyA9IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckVtcHR5Q2hlY2sgfHwgZnVuY3Rpb24odmFsdWUpe1xuXHRcdFx0XHRyZXR1cm4gIXZhbHVlICYmIHZhbHVlICE9PSAwO1xuXHRcdFx0fTtcblxuXHRcdFx0ZmlsdGVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRmaWx0ZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItaGVhZGVyLWZpbHRlclwiKTtcblxuXHRcdFx0Ly9zZXQgY29sdW1uIGVkaXRvclxuXHRcdFx0c3dpdGNoKHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXIpe1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0aWYoc2VsZi50YWJsZS5tb2R1bGVzLmVkaXQuZWRpdG9yc1tjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXJdKXtcblx0XHRcdFx0XHRcdGVkaXRvciA9IHNlbGYudGFibGUubW9kdWxlcy5lZGl0LmVkaXRvcnNbY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyXTtcblxuXHRcdFx0XHRcdFx0aWYoKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlciA9PT0gXCJ0aWNrXCIgfHwgY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyID09PSBcInRpY2tDcm9zc1wiKSAmJiAhY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRW1wdHlDaGVjayl7XG5cdFx0XHRcdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZpbHRlci5lbXB0eUZ1bmMgPSBmdW5jdGlvbih2YWx1ZSl7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlICE9PSB0cnVlICYmIHZhbHVlICE9PSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGaWx0ZXIgRXJyb3IgLSBDYW5ub3QgYnVpbGQgaGVhZGVyIGZpbHRlciwgTm8gc3VjaCBlZGl0b3IgZm91bmQ6IFwiLCBjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3IpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRlZGl0b3IgPSBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXI7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcImJvb2xlYW5cIjpcblx0XHRcdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5lZGl0ICYmIGNvbHVtbi5tb2R1bGVzLmVkaXQuZWRpdG9yKXtcblx0XHRcdFx0XHRcdGVkaXRvciA9IGNvbHVtbi5tb2R1bGVzLmVkaXQuZWRpdG9yO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlciAmJiBzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlcl0pe1xuXHRcdFx0XHRcdFx0XHRlZGl0b3IgPSBzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5lZGl0b3JzW2NvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlcl07XG5cblx0XHRcdFx0XHRcdFx0aWYoKGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlciA9PT0gXCJ0aWNrXCIgfHwgY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyID09PSBcInRpY2tDcm9zc1wiKSAmJiAhY29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyRW1wdHlDaGVjayl7XG5cdFx0XHRcdFx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmVtcHR5RnVuYyA9IGZ1bmN0aW9uKHZhbHVlKXtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiB2YWx1ZSAhPT0gdHJ1ZSAmJiB2YWx1ZSAhPT0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0XHRlZGl0b3IgPSBzZWxmLnRhYmxlLm1vZHVsZXMuZWRpdC5lZGl0b3JzW1wiaW5wdXRcIl07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihlZGl0b3Ipe1xuXG5cdFx0XHRcdGNlbGxXcmFwcGVyID0ge1xuXHRcdFx0XHRcdGdldFZhbHVlOmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHlwZW9mIGluaXRpYWxWYWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGluaXRpYWxWYWx1ZSA6IFwiXCI7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRGaWVsZDpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0cmV0dXJuIGNvbHVtbi5kZWZpbml0aW9uLmZpZWxkO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Z2V0RWxlbWVudDpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZpbHRlckVsZW1lbnQ7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRDb2x1bW46ZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHJldHVybiBjb2x1bW4uZ2V0Q29tcG9uZW50KCk7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRUYWJsZTooKSA9PiB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdGhpcy50YWJsZTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGdldFR5cGU6KCkgPT4ge1xuXHRcdFx0XHRcdFx0cmV0dXJuIFwiaGVhZGVyXCI7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRnZXRSb3c6ZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0XHRcdG5vcm1hbGl6ZUhlaWdodDpmdW5jdGlvbigpe1xuXG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHBhcmFtcyA9IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlclBhcmFtcyB8fCB7fTtcblxuXHRcdFx0XHRwYXJhbXMgPSB0eXBlb2YgcGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBwYXJhbXMuY2FsbChzZWxmLnRhYmxlLCBjZWxsV3JhcHBlcikgOiBwYXJhbXM7XG5cblx0XHRcdFx0ZWRpdG9yRWxlbWVudCA9IGVkaXRvci5jYWxsKHRoaXMudGFibGUubW9kdWxlcy5lZGl0LCBjZWxsV3JhcHBlciwgb25SZW5kZXJlZCwgc3VjY2VzcywgY2FuY2VsLCBwYXJhbXMpO1xuXG5cdFx0XHRcdGlmKCFlZGl0b3JFbGVtZW50KXtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJGaWx0ZXIgRXJyb3IgLSBDYW5ub3QgYWRkIGZpbHRlciB0byBcIiArIGZpZWxkICsgXCIgY29sdW1uLCBlZGl0b3IgcmV0dXJuZWQgYSB2YWx1ZSBvZiBmYWxzZVwiKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZighKGVkaXRvckVsZW1lbnQgaW5zdGFuY2VvZiBOb2RlKSl7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRmlsdGVyIEVycm9yIC0gQ2Fubm90IGFkZCBmaWx0ZXIgdG8gXCIgKyBmaWVsZCArIFwiIGNvbHVtbiwgZWRpdG9yIHNob3VsZCByZXR1cm4gYW4gaW5zdGFuY2Ugb2YgTm9kZSwgdGhlIGVkaXRvciByZXR1cm5lZDpcIiwgZWRpdG9yRWxlbWVudCk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9zZXQgUGxhY2Vob2xkZXIgVGV4dFxuXHRcdFx0XHRzZWxmLmxhbmdCaW5kKFwiaGVhZGVyRmlsdGVyc3xjb2x1bW5zfFwiICsgY29sdW1uLmRlZmluaXRpb24uZmllbGQsIGZ1bmN0aW9uKHZhbHVlKXtcblx0XHRcdFx0XHRlZGl0b3JFbGVtZW50LnNldEF0dHJpYnV0ZShcInBsYWNlaG9sZGVyXCIsIHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiB2YWx1ZSA/IHZhbHVlIDogKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlclBsYWNlaG9sZGVyIHx8IHNlbGYubGFuZ1RleHQoXCJoZWFkZXJGaWx0ZXJzfGRlZmF1bHRcIikpKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Ly9mb2N1cyBvbiBlbGVtZW50IG9uIGNsaWNrXG5cdFx0XHRcdGVkaXRvckVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5mb2N1cygpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlZGl0b3JFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoZSkgPT4ge1xuXHRcdFx0XHRcdHZhciBsZWZ0ID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbnRlbnRzRWxlbWVudC5zY3JvbGxMZWZ0O1xuXG5cdFx0XHRcdFx0dmFyIGhlYWRlclBvcyA9IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbExlZnQ7XG5cblx0XHRcdFx0XHRpZihsZWZ0ICE9PSBoZWFkZXJQb3Mpe1xuXHRcdFx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vbGl2ZSB1cGRhdGUgZmlsdGVycyBhcyB1c2VyIHR5cGVzXG5cdFx0XHRcdHR5cGluZ1RpbWVyID0gZmFsc2U7XG5cblx0XHRcdFx0c2VhcmNoVHJpZ2dlciA9IGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdGlmKHR5cGluZ1RpbWVyKXtcblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dCh0eXBpbmdUaW1lcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dHlwaW5nVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRzdWNjZXNzKGVkaXRvckVsZW1lbnQudmFsdWUpO1xuXHRcdFx0XHRcdH0sc2VsZi50YWJsZS5vcHRpb25zLmhlYWRlckZpbHRlckxpdmVGaWx0ZXJEZWxheSk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQgPSBlZGl0b3JFbGVtZW50O1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuYXR0clR5cGUgPSBlZGl0b3JFbGVtZW50Lmhhc0F0dHJpYnV0ZShcInR5cGVcIikgPyBlZGl0b3JFbGVtZW50LmdldEF0dHJpYnV0ZShcInR5cGVcIikudG9Mb3dlckNhc2UoKSA6IFwiXCIgO1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIudGFnVHlwZSA9IGVkaXRvckVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG5cdFx0XHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlckxpdmVGaWx0ZXIgIT09IGZhbHNlKXtcblxuXHRcdFx0XHRcdGlmIChcblx0XHRcdFx0XHRcdCEoXG5cdFx0XHRcdFx0XHRcdGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlckZpbHRlciA9PT0gJ2F1dG9jb21wbGV0ZScgfHxcblx0XHRcdFx0XHRcdFx0Y29sdW1uLmRlZmluaXRpb24uaGVhZGVyRmlsdGVyID09PSAndGlja0Nyb3NzJyB8fFxuXHRcdFx0XHRcdFx0XHQoKGNvbHVtbi5kZWZpbml0aW9uLmVkaXRvciA9PT0gJ2F1dG9jb21wbGV0ZScgfHxcblx0XHRcdFx0XHRcdFx0XHRjb2x1bW4uZGVmaW5pdGlvbi5lZGl0b3IgPT09ICd0aWNrQ3Jvc3MnKSAmJlxuXHRcdFx0XHRcdFx0XHRjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJGaWx0ZXIgPT09IHRydWUpXG5cdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0KSB7XG5cdFx0XHRcdFx0XHRlZGl0b3JFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBzZWFyY2hUcmlnZ2VyKTtcblx0XHRcdFx0XHRcdGVkaXRvckVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInNlYXJjaFwiLCBzZWFyY2hUcmlnZ2VyKTtcblxuXG5cdFx0XHRcdFx0XHQvL3VwZGF0ZSBudW1iZXIgZmlsdGVyZWQgY29sdW1ucyBvbiBjaGFuZ2Vcblx0XHRcdFx0XHRcdGlmKGNvbHVtbi5tb2R1bGVzLmZpbHRlci5hdHRyVHlwZSA9PSBcIm51bWJlclwiKXtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0XHRcdHN1Y2Nlc3MoZWRpdG9yRWxlbWVudC52YWx1ZSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvL2NoYW5nZSB0ZXh0IGlucHV0cyB0byBzZWFyY2ggaW5wdXRzIHRvIGFsbG93IGZvciBjbGVhcmluZyBvZiBmaWVsZFxuXHRcdFx0XHRcdFx0aWYoY29sdW1uLm1vZHVsZXMuZmlsdGVyLmF0dHJUeXBlID09IFwidGV4dFwiICYmIHRoaXMudGFibGUuYnJvd3NlciAhPT0gXCJpZVwiKXtcblx0XHRcdFx0XHRcdFx0ZWRpdG9yRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwic2VhcmNoXCIpO1xuXHRcdFx0XHRcdFx0Ly8gZWRpdG9yRWxlbWVudC5vZmYoXCJjaGFuZ2UgYmx1clwiKTsgLy9wcmV2ZW50IGJsdXIgZnJvbSB0cmlnZ2VyaW5nIGZpbHRlciBhbmQgcHJldmVudGluZyBzZWxlY3Rpb24gY2xpY2tcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vcHJldmVudCBpbnB1dCBhbmQgc2VsZWN0IGVsZW1lbnRzIGZyb20gcHJvcGFnYXRpbmcgY2xpY2sgdG8gY29sdW1uIHNvcnRlcnMgZXRjXG5cdFx0XHRcdFx0aWYoY29sdW1uLm1vZHVsZXMuZmlsdGVyLnRhZ1R5cGUgPT0gXCJpbnB1dFwiIHx8IGNvbHVtbi5tb2R1bGVzLmZpbHRlci50YWdUeXBlID09IFwic2VsZWN0XCIgfHwgY29sdW1uLm1vZHVsZXMuZmlsdGVyLnRhZ1R5cGUgPT0gXCJ0ZXh0YXJlYVwiKXtcblx0XHRcdFx0XHRcdGVkaXRvckVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZmlsdGVyRWxlbWVudC5hcHBlbmRDaGlsZChlZGl0b3JFbGVtZW50KTtcblxuXHRcdFx0XHRjb2x1bW4uY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZmlsdGVyRWxlbWVudCk7XG5cblx0XHRcdFx0aWYoIXJlaW5pdGlhbGl6ZSl7XG5cdFx0XHRcdFx0c2VsZi5oZWFkZXJGaWx0ZXJDb2x1bW5zLnB1c2goY29sdW1uKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmKG9uUmVuZGVyZWRDYWxsYmFjayl7XG5cdFx0XHRcdFx0b25SZW5kZXJlZENhbGxiYWNrKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJGaWx0ZXIgRXJyb3IgLSBDYW5ub3QgYWRkIGhlYWRlciBmaWx0ZXIsIGNvbHVtbiBoYXMgbm8gZmllbGQgc2V0OlwiLCBjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSk7XG5cdFx0fVxuXHR9XG5cblx0Ly9oaWRlIGFsbCBoZWFkZXIgZmlsdGVyIGVsZW1lbnRzICh1c2VkIHRvIGVuc3VyZSBjb3JyZWN0IGNvbHVtbiB3aWR0aHMgaW4gXCJmaXREYXRhXCIgbGF5b3V0IG1vZGUpXG5cdGhpZGVIZWFkZXJGaWx0ZXJFbGVtZW50cygpe1xuXHRcdHRoaXMuaGVhZGVyRmlsdGVyQ29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpe1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0Ly9zaG93IGFsbCBoZWFkZXIgZmlsdGVyIGVsZW1lbnRzICh1c2VkIHRvIGVuc3VyZSBjb3JyZWN0IGNvbHVtbiB3aWR0aHMgaW4gXCJmaXREYXRhXCIgbGF5b3V0IG1vZGUpXG5cdHNob3dIZWFkZXJGaWx0ZXJFbGVtZW50cygpe1xuXHRcdHRoaXMuaGVhZGVyRmlsdGVyQ29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpe1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5maWx0ZXIuaGVhZGVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHQvL3Byb2dyYW1tYXRpY2FsbHkgc2V0IGZvY3VzIG9mIGhlYWRlciBmaWx0ZXJcblx0c2V0SGVhZGVyRmlsdGVyRm9jdXMoY29sdW1uKXtcblx0XHRpZihjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpe1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQuZm9jdXMoKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEZvY3VzIEVycm9yIC0gTm8gaGVhZGVyIGZpbHRlciBzZXQgb24gY29sdW1uOlwiLCBjb2x1bW4uZ2V0RmllbGQoKSk7XG5cdFx0fVxuXHR9XG5cblx0Ly9wcm9ncmFtbWF0aWNhbGx5IGdldCB2YWx1ZSBvZiBoZWFkZXIgZmlsdGVyXG5cdGdldEhlYWRlckZpbHRlclZhbHVlKGNvbHVtbil7XG5cdFx0aWYoY29sdW1uLm1vZHVsZXMuZmlsdGVyICYmIGNvbHVtbi5tb2R1bGVzLmZpbHRlci5oZWFkZXJFbGVtZW50KXtcblx0XHRcdHJldHVybiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIudmFsdWU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRXJyb3IgLSBObyBoZWFkZXIgZmlsdGVyIHNldCBvbiBjb2x1bW46XCIsIGNvbHVtbi5nZXRGaWVsZCgpKTtcblx0XHR9XG5cdH1cblxuXHQvL3Byb2dyYW1tYXRpY2FsbHkgc2V0IHZhbHVlIG9mIGhlYWRlciBmaWx0ZXJcblx0c2V0SGVhZGVyRmlsdGVyVmFsdWUoY29sdW1uLCB2YWx1ZSl7XG5cdFx0aWYgKGNvbHVtbil7XG5cdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpe1xuXHRcdFx0XHR0aGlzLmdlbmVyYXRlSGVhZGVyRmlsdGVyRWxlbWVudChjb2x1bW4sIHZhbHVlLCB0cnVlKTtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLnN1Y2Nlc3ModmFsdWUpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb2x1bW4gRmlsdGVyIEVycm9yIC0gTm8gaGVhZGVyIGZpbHRlciBzZXQgb24gY29sdW1uOlwiLCBjb2x1bW4uZ2V0RmllbGQoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmVsb2FkSGVhZGVyRmlsdGVyKGNvbHVtbil7XG5cdFx0aWYgKGNvbHVtbil7XG5cdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5maWx0ZXIgJiYgY29sdW1uLm1vZHVsZXMuZmlsdGVyLmhlYWRlckVsZW1lbnQpe1xuXHRcdFx0XHR0aGlzLmdlbmVyYXRlSGVhZGVyRmlsdGVyRWxlbWVudChjb2x1bW4sIGNvbHVtbi5tb2R1bGVzLmZpbHRlci52YWx1ZSwgdHJ1ZSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBGaWx0ZXIgRXJyb3IgLSBObyBoZWFkZXIgZmlsdGVyIHNldCBvbiBjb2x1bW46XCIsIGNvbHVtbi5nZXRGaWVsZCgpKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZWZyZXNoRmlsdGVyKCl7XG5cdFx0aWYodGhpcy50YWJsZUluaXRpYWxpemVkKXtcblx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5maWx0ZXJNb2RlID09PSBcInJlbW90ZVwiKXtcblx0XHRcdFx0dGhpcy5yZWxvYWREYXRhKG51bGwsIGZhbHNlLCBmYWxzZSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMucmVmcmVzaERhdGEodHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly9UT0RPIC0gUGVyc2lzdCBsZWZ0IHBvc2l0aW9uIG9mIHJvdyBtYW5hZ2VyXG5cdFx0Ly8gbGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcblx0XHQvLyB0aGlzLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdH1cblxuXHQvL2NoZWNrIGlmIHRoZSBmaWx0ZXJzIGhhcyBjaGFuZ2VkIHNpbmNlIGxhc3QgdXNlXG5cdHRyYWNrQ2hhbmdlcygpe1xuXHRcdHRoaXMuY2hhbmdlZCA9IHRydWU7XG5cdFx0dGhpcy5kaXNwYXRjaChcImZpbHRlci1jaGFuZ2VkXCIpO1xuXHR9XG5cblx0Ly9jaGVjayBpZiB0aGUgZmlsdGVycyBoYXMgY2hhbmdlZCBzaW5jZSBsYXN0IHVzZVxuXHRoYXNDaGFuZ2VkKCl7XG5cdFx0dmFyIGNoYW5nZWQgPSB0aGlzLmNoYW5nZWQ7XG5cdFx0dGhpcy5jaGFuZ2VkID0gZmFsc2U7XG5cdFx0cmV0dXJuIGNoYW5nZWQ7XG5cdH1cblxuXHQvL3NldCBzdGFuZGFyZCBmaWx0ZXJzXG5cdHNldEZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUsIHBhcmFtcyl7XG5cdFx0dGhpcy5maWx0ZXJMaXN0ID0gW107XG5cblx0XHRpZighQXJyYXkuaXNBcnJheShmaWVsZCkpe1xuXHRcdFx0ZmllbGQgPSBbe2ZpZWxkOmZpZWxkLCB0eXBlOnR5cGUsIHZhbHVlOnZhbHVlLCBwYXJhbXM6cGFyYW1zfV07XG5cdFx0fVxuXG5cdFx0dGhpcy5hZGRGaWx0ZXIoZmllbGQpO1xuXHR9XG5cblx0Ly9hZGQgZmlsdGVyIHRvIGFycmF5XG5cdGFkZEZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUsIHBhcmFtcyl7XG5cdFx0dmFyIGNoYW5nZWQgPSBmYWxzZTtcblxuXHRcdGlmKCFBcnJheS5pc0FycmF5KGZpZWxkKSl7XG5cdFx0XHRmaWVsZCA9IFt7ZmllbGQ6ZmllbGQsIHR5cGU6dHlwZSwgdmFsdWU6dmFsdWUsIHBhcmFtczpwYXJhbXN9XTtcblx0XHR9XG5cblx0XHRmaWVsZC5mb3JFYWNoKChmaWx0ZXIpID0+IHtcblx0XHRcdGZpbHRlciA9IHRoaXMuZmluZEZpbHRlcihmaWx0ZXIpO1xuXG5cdFx0XHRpZihmaWx0ZXIpe1xuXHRcdFx0XHR0aGlzLmZpbHRlckxpc3QucHVzaChmaWx0ZXIpO1xuXHRcdFx0XHRjaGFuZ2VkID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmKGNoYW5nZWQpe1xuXHRcdFx0dGhpcy50cmFja0NoYW5nZXMoKTtcblx0XHR9XG5cdH1cblxuXHRmaW5kRmlsdGVyKGZpbHRlcil7XG5cdFx0dmFyIGNvbHVtbjtcblxuXHRcdGlmKEFycmF5LmlzQXJyYXkoZmlsdGVyKSl7XG5cdFx0XHRyZXR1cm4gdGhpcy5maW5kU3ViRmlsdGVycyhmaWx0ZXIpO1xuXHRcdH1cblxuXHRcdHZhciBmaWx0ZXJGdW5jID0gZmFsc2U7XG5cblx0XHRpZih0eXBlb2YgZmlsdGVyLmZpZWxkID09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJldHVybiBmaWx0ZXIuZmllbGQoZGF0YSwgZmlsdGVyLnR5cGUgfHwge30pOy8vIHBhc3MgcGFyYW1zIHRvIGN1c3RvbSBmaWx0ZXIgZnVuY3Rpb25cblx0XHRcdH07XG5cdFx0fWVsc2Uge1xuXG5cdFx0XHRpZihGaWx0ZXIuZmlsdGVyc1tmaWx0ZXIudHlwZV0pe1xuXG5cdFx0XHRcdGNvbHVtbiA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUZpZWxkKGZpbHRlci5maWVsZCk7XG5cblx0XHRcdFx0aWYoY29sdW1uKXtcblx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gRmlsdGVyLmZpbHRlcnNbZmlsdGVyLnR5cGVdKGZpbHRlci52YWx1ZSwgY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSksIGRhdGEsIGZpbHRlci5wYXJhbXMgfHwge30pO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRmaWx0ZXJGdW5jID0gZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gRmlsdGVyLmZpbHRlcnNbZmlsdGVyLnR5cGVdKGZpbHRlci52YWx1ZSwgZGF0YVtmaWx0ZXIuZmllbGRdLCBkYXRhLCBmaWx0ZXIucGFyYW1zIHx8IHt9KTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9XG5cblxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJGaWx0ZXIgRXJyb3IgLSBObyBzdWNoIGZpbHRlciB0eXBlIGZvdW5kLCBpZ25vcmluZzogXCIsIGZpbHRlci50eXBlKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmaWx0ZXIuZnVuYyA9IGZpbHRlckZ1bmM7XG5cblx0XHRyZXR1cm4gZmlsdGVyLmZ1bmMgPyBmaWx0ZXIgOiBmYWxzZTtcblx0fVxuXG5cdGZpbmRTdWJGaWx0ZXJzKGZpbHRlcnMpe1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdGZpbHRlcnMuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG5cdFx0XHRmaWx0ZXIgPSB0aGlzLmZpbmRGaWx0ZXIoZmlsdGVyKTtcblxuXHRcdFx0aWYoZmlsdGVyKXtcblx0XHRcdFx0b3V0cHV0LnB1c2goZmlsdGVyKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQubGVuZ3RoID8gb3V0cHV0IDogZmFsc2U7XG5cdH1cblxuXHQvL2dldCBhbGwgZmlsdGVyc1xuXHRnZXRGaWx0ZXJzKGFsbCwgYWpheCl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0aWYoYWxsKXtcblx0XHRcdG91dHB1dCA9IHRoaXMuZ2V0SGVhZGVyRmlsdGVycygpO1xuXHRcdH1cblxuXHRcdGlmKGFqYXgpe1xuXHRcdFx0b3V0cHV0LmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG5cdFx0XHRcdGlmKHR5cGVvZiBpdGVtLnR5cGUgPT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0XHRpdGVtLnR5cGUgPSBcImZ1bmN0aW9uXCI7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdG91dHB1dCA9IG91dHB1dC5jb25jYXQodGhpcy5maWx0ZXJzVG9BcnJheSh0aGlzLmZpbHRlckxpc3QsIGFqYXgpKTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH1cblxuXHQvL2ZpbHRlciB0byBPYmplY3Rcblx0ZmlsdGVyc1RvQXJyYXkoZmlsdGVyTGlzdCwgYWpheCl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXG5cdFx0ZmlsdGVyTGlzdC5mb3JFYWNoKChmaWx0ZXIpID0+IHtcblx0XHRcdHZhciBpdGVtO1xuXG5cdFx0XHRpZihBcnJheS5pc0FycmF5KGZpbHRlcikpe1xuXHRcdFx0XHRvdXRwdXQucHVzaCh0aGlzLmZpbHRlcnNUb0FycmF5KGZpbHRlciwgYWpheCkpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpdGVtID0ge2ZpZWxkOmZpbHRlci5maWVsZCwgdHlwZTpmaWx0ZXIudHlwZSwgdmFsdWU6ZmlsdGVyLnZhbHVlfTtcblxuXHRcdFx0XHRpZihhamF4KXtcblx0XHRcdFx0XHRpZih0eXBlb2YgaXRlbS50eXBlID09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRcdFx0XHRpdGVtLnR5cGUgPSBcImZ1bmN0aW9uXCI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0b3V0cHV0LnB1c2goaXRlbSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cblx0Ly9nZXQgYWxsIGZpbHRlcnNcblx0Z2V0SGVhZGVyRmlsdGVycygpe1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdGZvcih2YXIga2V5IGluIHRoaXMuaGVhZGVyRmlsdGVycyl7XG5cdFx0XHRvdXRwdXQucHVzaCh7ZmllbGQ6a2V5LCB0eXBlOnRoaXMuaGVhZGVyRmlsdGVyc1trZXldLnR5cGUsIHZhbHVlOnRoaXMuaGVhZGVyRmlsdGVyc1trZXldLnZhbHVlfSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXG5cdC8vcmVtb3ZlIGZpbHRlciBmcm9tIGFycmF5XG5cdHJlbW92ZUZpbHRlcihmaWVsZCwgdHlwZSwgdmFsdWUpe1xuXHRcdGlmKCFBcnJheS5pc0FycmF5KGZpZWxkKSl7XG5cdFx0XHRmaWVsZCA9IFt7ZmllbGQ6ZmllbGQsIHR5cGU6dHlwZSwgdmFsdWU6dmFsdWV9XTtcblx0XHR9XG5cblx0XHRmaWVsZC5mb3JFYWNoKChmaWx0ZXIpID0+IHtcblx0XHRcdHZhciBpbmRleCA9IC0xO1xuXG5cdFx0XHRpZih0eXBlb2YgZmlsdGVyLmZpZWxkID09IFwib2JqZWN0XCIpe1xuXHRcdFx0XHRpbmRleCA9IHRoaXMuZmlsdGVyTGlzdC5maW5kSW5kZXgoKGVsZW1lbnQpID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gZmlsdGVyID09PSBlbGVtZW50O1xuXHRcdFx0XHR9KTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aW5kZXggPSB0aGlzLmZpbHRlckxpc3QuZmluZEluZGV4KChlbGVtZW50KSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGZpbHRlci5maWVsZCA9PT0gZWxlbWVudC5maWVsZCAmJiBmaWx0ZXIudHlwZSA9PT0gZWxlbWVudC50eXBlICAmJiBmaWx0ZXIudmFsdWUgPT09IGVsZW1lbnQudmFsdWU7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihpbmRleCA+IC0xKXtcblx0XHRcdFx0dGhpcy5maWx0ZXJMaXN0LnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkZpbHRlciBFcnJvciAtIE5vIG1hdGNoaW5nIGZpbHRlciB0eXBlIGZvdW5kLCBpZ25vcmluZzogXCIsIGZpbHRlci50eXBlKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHRoaXMudHJhY2tDaGFuZ2VzKCk7XG5cdH1cblxuXHQvL2NsZWFyIGZpbHRlcnNcblx0Y2xlYXJGaWx0ZXIoYWxsKXtcblx0XHR0aGlzLmZpbHRlckxpc3QgPSBbXTtcblxuXHRcdGlmKGFsbCl7XG5cdFx0XHR0aGlzLmNsZWFySGVhZGVyRmlsdGVyKCk7XG5cdFx0fVxuXG5cdFx0dGhpcy50cmFja0NoYW5nZXMoKTtcblx0fVxuXG5cdC8vY2xlYXIgaGVhZGVyIGZpbHRlcnNcblx0Y2xlYXJIZWFkZXJGaWx0ZXIoKXtcblx0XHR0aGlzLmhlYWRlckZpbHRlcnMgPSB7fTtcblx0XHR0aGlzLnByZXZIZWFkZXJGaWx0ZXJDaGFuZ2VDaGVjayA9IFwie31cIjtcblxuXHRcdHRoaXMuaGVhZGVyRmlsdGVyQ29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdGlmKHR5cGVvZiBjb2x1bW4ubW9kdWxlcy5maWx0ZXIudmFsdWUgIT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0XHRkZWxldGUgY29sdW1uLm1vZHVsZXMuZmlsdGVyLnZhbHVlO1xuXHRcdFx0fVxuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZmlsdGVyLnByZXZTdWNjZXNzID0gdW5kZWZpbmVkO1xuXHRcdFx0dGhpcy5yZWxvYWRIZWFkZXJGaWx0ZXIoY29sdW1uKTtcblx0XHR9KTtcblxuXHRcdHRoaXMudHJhY2tDaGFuZ2VzKCk7XG5cdH1cblxuXHQvL3NlYXJjaCBkYXRhIGFuZCByZXR1cm4gbWF0Y2hpbmcgcm93c1xuXHRzZWFyY2ggKHNlYXJjaFR5cGUsIGZpZWxkLCB0eXBlLCB2YWx1ZSl7XG5cdFx0dmFyIGFjdGl2ZVJvd3MgPSBbXSxcblx0XHRmaWx0ZXJMaXN0ID0gW107XG5cblx0XHRpZighQXJyYXkuaXNBcnJheShmaWVsZCkpe1xuXHRcdFx0ZmllbGQgPSBbe2ZpZWxkOmZpZWxkLCB0eXBlOnR5cGUsIHZhbHVlOnZhbHVlfV07XG5cdFx0fVxuXG5cdFx0ZmllbGQuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG5cdFx0XHRmaWx0ZXIgPSB0aGlzLmZpbmRGaWx0ZXIoZmlsdGVyKTtcblxuXHRcdFx0aWYoZmlsdGVyKXtcblx0XHRcdFx0ZmlsdGVyTGlzdC5wdXNoKGZpbHRlcik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdHZhciBtYXRjaCA9IHRydWU7XG5cblx0XHRcdGZpbHRlckxpc3QuZm9yRWFjaCgoZmlsdGVyKSA9PiB7XG5cdFx0XHRcdGlmKCF0aGlzLmZpbHRlclJlY3Vyc2UoZmlsdGVyLCByb3cuZ2V0RGF0YSgpKSl7XG5cdFx0XHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmKG1hdGNoKXtcblx0XHRcdFx0YWN0aXZlUm93cy5wdXNoKHNlYXJjaFR5cGUgPT09IFwiZGF0YVwiID8gcm93LmdldERhdGEoXCJkYXRhXCIpIDogcm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGFjdGl2ZVJvd3M7XG5cdH1cblxuXHQvL2ZpbHRlciByb3cgYXJyYXlcblx0ZmlsdGVyKHJvd0xpc3QsIGZpbHRlcnMpe1xuXHRcdHZhciBhY3RpdmVSb3dzID0gW10sXG5cdFx0YWN0aXZlUm93Q29tcG9uZW50cyA9IFtdO1xuXG5cdFx0aWYodGhpcy5zdWJzY3JpYmVkRXh0ZXJuYWwoXCJkYXRhRmlsdGVyaW5nXCIpKXtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFGaWx0ZXJpbmdcIiwgdGhpcy5nZXRGaWx0ZXJzKHRydWUpKTtcblx0XHR9XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZmlsdGVyTW9kZSAhPT0gXCJyZW1vdGVcIiAmJiAodGhpcy5maWx0ZXJMaXN0Lmxlbmd0aCB8fCBPYmplY3Qua2V5cyh0aGlzLmhlYWRlckZpbHRlcnMpLmxlbmd0aCkpe1xuXG5cdFx0XHRyb3dMaXN0LmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0XHRpZih0aGlzLmZpbHRlclJvdyhyb3cpKXtcblx0XHRcdFx0XHRhY3RpdmVSb3dzLnB1c2gocm93KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHR9ZWxzZSB7XG5cdFx0XHRhY3RpdmVSb3dzID0gcm93TGlzdC5zbGljZSgwKTtcblx0XHR9XG5cblx0XHRpZih0aGlzLnN1YnNjcmliZWRFeHRlcm5hbChcImRhdGFGaWx0ZXJlZFwiKSl7XG5cblx0XHRcdGFjdGl2ZVJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdGFjdGl2ZVJvd0NvbXBvbmVudHMucHVzaChyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFGaWx0ZXJlZFwiLCB0aGlzLmdldEZpbHRlcnModHJ1ZSksIGFjdGl2ZVJvd0NvbXBvbmVudHMpO1xuXHRcdH1cblxuXHRcdHJldHVybiBhY3RpdmVSb3dzO1xuXHR9XG5cblx0Ly9maWx0ZXIgaW5kaXZpZHVhbCByb3dcblx0ZmlsdGVyUm93KHJvdywgZmlsdGVycyl7XG5cdFx0dmFyIG1hdGNoID0gdHJ1ZSxcblx0XHRkYXRhID0gcm93LmdldERhdGEoKTtcblxuXHRcdHRoaXMuZmlsdGVyTGlzdC5mb3JFYWNoKChmaWx0ZXIpID0+IHtcblx0XHRcdGlmKCF0aGlzLmZpbHRlclJlY3Vyc2UoZmlsdGVyLCBkYXRhKSl7XG5cdFx0XHRcdG1hdGNoID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblxuXHRcdGZvcih2YXIgZmllbGQgaW4gdGhpcy5oZWFkZXJGaWx0ZXJzKXtcblx0XHRcdGlmKCF0aGlzLmhlYWRlckZpbHRlcnNbZmllbGRdLmZ1bmMoZGF0YSkpe1xuXHRcdFx0XHRtYXRjaCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBtYXRjaDtcblx0fVxuXG5cdGZpbHRlclJlY3Vyc2UoZmlsdGVyLCBkYXRhKXtcblx0XHR2YXIgbWF0Y2ggPSBmYWxzZTtcblxuXHRcdGlmKEFycmF5LmlzQXJyYXkoZmlsdGVyKSl7XG5cdFx0XHRmaWx0ZXIuZm9yRWFjaCgoc3ViRmlsdGVyKSA9PiB7XG5cdFx0XHRcdGlmKHRoaXMuZmlsdGVyUmVjdXJzZShzdWJGaWx0ZXIsIGRhdGEpKXtcblx0XHRcdFx0XHRtYXRjaCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdG1hdGNoID0gZmlsdGVyLmZ1bmMoZGF0YSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1hdGNoO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHBsYWludGV4dChjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHRyZXR1cm4gdGhpcy5lbXB0eVRvU3BhY2UodGhpcy5zYW5pdGl6ZUhUTUwoY2VsbC5nZXRWYWx1ZSgpKSk7XG59XG5cbmZ1bmN0aW9uIGh0bWwoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKXtcblx0cmV0dXJuIGNlbGwuZ2V0VmFsdWUoKTtcbn1cblxuZnVuY3Rpb24gdGV4dGFyZWEoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKXtcblx0Y2VsbC5nZXRFbGVtZW50KCkuc3R5bGUud2hpdGVTcGFjZSA9IFwicHJlLXdyYXBcIjtcblx0cmV0dXJuIHRoaXMuZW1wdHlUb1NwYWNlKHRoaXMuc2FuaXRpemVIVE1MKGNlbGwuZ2V0VmFsdWUoKSkpO1xufVxuXG5mdW5jdGlvbiBtb25leShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHR2YXIgZmxvYXRWYWwgPSBwYXJzZUZsb2F0KGNlbGwuZ2V0VmFsdWUoKSksXG5cdHNpZ24gPSBcIlwiLFxuXHRudW1iZXIsIGludGVnZXIsIGRlY2ltYWwsIHJneCwgdmFsdWU7XG5cblx0dmFyIGRlY2ltYWxTeW0gPSBmb3JtYXR0ZXJQYXJhbXMuZGVjaW1hbCB8fCBcIi5cIjtcblx0dmFyIHRob3VzYW5kU3ltID0gZm9ybWF0dGVyUGFyYW1zLnRob3VzYW5kIHx8IFwiLFwiO1xuXHR2YXIgbmVnYXRpdmVTaWduID0gZm9ybWF0dGVyUGFyYW1zLm5lZ2F0aXZlU2lnbiB8fCBcIi1cIjtcblx0dmFyIHN5bWJvbCA9IGZvcm1hdHRlclBhcmFtcy5zeW1ib2wgfHwgXCJcIjtcblx0dmFyIGFmdGVyID0gISFmb3JtYXR0ZXJQYXJhbXMuc3ltYm9sQWZ0ZXI7XG5cdHZhciBwcmVjaXNpb24gPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLnByZWNpc2lvbiAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5wcmVjaXNpb24gOiAyO1xuXG5cdGlmKGlzTmFOKGZsb2F0VmFsKSl7XG5cdFx0cmV0dXJuIHRoaXMuZW1wdHlUb1NwYWNlKHRoaXMuc2FuaXRpemVIVE1MKGNlbGwuZ2V0VmFsdWUoKSkpO1xuXHR9XG5cblx0aWYoZmxvYXRWYWwgPCAwKXtcblx0XHRmbG9hdFZhbCA9IE1hdGguYWJzKGZsb2F0VmFsKTtcblx0XHRzaWduID0gbmVnYXRpdmVTaWduO1xuXHR9XG5cblx0bnVtYmVyID0gcHJlY2lzaW9uICE9PSBmYWxzZSA/IGZsb2F0VmFsLnRvRml4ZWQocHJlY2lzaW9uKSA6IGZsb2F0VmFsO1xuXHRudW1iZXIgPSBTdHJpbmcobnVtYmVyKS5zcGxpdChcIi5cIik7XG5cblx0aW50ZWdlciA9IG51bWJlclswXTtcblx0ZGVjaW1hbCA9IG51bWJlci5sZW5ndGggPiAxID8gZGVjaW1hbFN5bSArIG51bWJlclsxXSA6IFwiXCI7XG5cblx0aWYgKGZvcm1hdHRlclBhcmFtcy50aG91c2FuZCAhPT0gZmFsc2UpIHtcblx0XHRyZ3ggPSAvKFxcZCspKFxcZHszfSkvO1xuXG5cdFx0d2hpbGUgKHJneC50ZXN0KGludGVnZXIpKXtcblx0XHRcdGludGVnZXIgPSBpbnRlZ2VyLnJlcGxhY2Uocmd4LCBcIiQxXCIgKyB0aG91c2FuZFN5bSArIFwiJDJcIik7XG5cdFx0fVxuXHR9XG5cblx0dmFsdWUgPSBpbnRlZ2VyICsgZGVjaW1hbDtcblx0XG5cdGlmKHNpZ24gPT09IHRydWUpe1xuXHRcdHZhbHVlID0gXCIoXCIgKyB2YWx1ZSAgKyBcIilcIjtcblx0XHRyZXR1cm4gYWZ0ZXIgPyB2YWx1ZSArIHN5bWJvbCA6IHN5bWJvbCArIHZhbHVlO1xuXHR9ZWxzZSB7XG5cdFx0cmV0dXJuIGFmdGVyID8gc2lnbiArIHZhbHVlICsgc3ltYm9sIDogc2lnbiArIHN5bWJvbCArIHZhbHVlO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGxpbmsoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKXtcblx0dmFyIHZhbHVlID0gY2VsbC5nZXRWYWx1ZSgpLFxuXHR1cmxQcmVmaXggPSBmb3JtYXR0ZXJQYXJhbXMudXJsUHJlZml4IHx8IFwiXCIsXG5cdGRvd25sb2FkID0gZm9ybWF0dGVyUGFyYW1zLmRvd25sb2FkLFxuXHRsYWJlbCA9IHZhbHVlLFxuXHRlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpLFxuXHRkYXRhO1xuXG5cdGZ1bmN0aW9uIGxhYmVsVHJhdmVyc2UocGF0aCwgZGF0YSl7XG5cdFx0dmFyIGl0ZW0gPSBwYXRoLnNoaWZ0KCksXG5cdFx0dmFsdWUgPSBkYXRhW2l0ZW1dO1xuXHRcdFxuXHRcdGlmKHBhdGgubGVuZ3RoICYmIHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIil7XG5cdFx0XHRyZXR1cm4gbGFiZWxUcmF2ZXJzZShwYXRoLCB2YWx1ZSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHZhbHVlO1xuXHR9XG5cblx0aWYoZm9ybWF0dGVyUGFyYW1zLmxhYmVsRmllbGQpe1xuXHRcdGRhdGEgPSBjZWxsLmdldERhdGEoKTtcblx0XHRsYWJlbCA9IGxhYmVsVHJhdmVyc2UoZm9ybWF0dGVyUGFyYW1zLmxhYmVsRmllbGQuc3BsaXQodGhpcy50YWJsZS5vcHRpb25zLm5lc3RlZEZpZWxkU2VwYXJhdG9yKSwgZGF0YSk7XG5cdH1cblxuXHRpZihmb3JtYXR0ZXJQYXJhbXMubGFiZWwpe1xuXHRcdHN3aXRjaCh0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLmxhYmVsKXtcblx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0bGFiZWwgPSBmb3JtYXR0ZXJQYXJhbXMubGFiZWw7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0bGFiZWwgPSBmb3JtYXR0ZXJQYXJhbXMubGFiZWwoY2VsbCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fVxuXG5cdGlmKGxhYmVsKXtcblx0XHRpZihmb3JtYXR0ZXJQYXJhbXMudXJsRmllbGQpe1xuXHRcdFx0ZGF0YSA9IGNlbGwuZ2V0RGF0YSgpO1xuXG5cdFx0XHR2YWx1ZSA9IEhlbHBlcnMucmV0cmlldmVOZXN0ZWREYXRhKHRoaXMudGFibGUub3B0aW9ucy5uZXN0ZWRGaWVsZFNlcGFyYXRvciwgZm9ybWF0dGVyUGFyYW1zLnVybEZpZWxkLCBkYXRhKTtcblx0XHR9XG5cblx0XHRpZihmb3JtYXR0ZXJQYXJhbXMudXJsKXtcblx0XHRcdHN3aXRjaCh0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLnVybCl7XG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHR2YWx1ZSA9IGZvcm1hdHRlclBhcmFtcy51cmw7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdFx0dmFsdWUgPSBmb3JtYXR0ZXJQYXJhbXMudXJsKGNlbGwpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGVsLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgdXJsUHJlZml4ICsgdmFsdWUpO1xuXG5cdFx0aWYoZm9ybWF0dGVyUGFyYW1zLnRhcmdldCl7XG5cdFx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJ0YXJnZXRcIiwgZm9ybWF0dGVyUGFyYW1zLnRhcmdldCk7XG5cdFx0fVxuXG5cdFx0aWYoZm9ybWF0dGVyUGFyYW1zLmRvd25sb2FkKXtcblxuXHRcdFx0aWYodHlwZW9mIGRvd25sb2FkID09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRcdGRvd25sb2FkID0gZG93bmxvYWQoY2VsbCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGRvd25sb2FkID0gZG93bmxvYWQgPT09IHRydWUgPyBcIlwiIDogZG93bmxvYWQ7XG5cdFx0XHR9XG5cblx0XHRcdGVsLnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGRvd25sb2FkKTtcblx0XHR9XG5cblx0XHRlbC5pbm5lckhUTUwgPSB0aGlzLmVtcHR5VG9TcGFjZSh0aGlzLnNhbml0aXplSFRNTChsYWJlbCkpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9ZWxzZSB7XG5cdFx0cmV0dXJuIFwiJm5ic3A7XCI7XG5cdH1cbn1cblxuZnVuY3Rpb24gaW1hZ2UoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKXtcblx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKSxcblx0c3JjID0gY2VsbC5nZXRWYWx1ZSgpO1xuXG5cdGlmKGZvcm1hdHRlclBhcmFtcy51cmxQcmVmaXgpe1xuXHRcdHNyYyA9IGZvcm1hdHRlclBhcmFtcy51cmxQcmVmaXggKyBjZWxsLmdldFZhbHVlKCk7XG5cdH1cblxuXHRpZihmb3JtYXR0ZXJQYXJhbXMudXJsU3VmZml4KXtcblx0XHRzcmMgPSBzcmMgKyBmb3JtYXR0ZXJQYXJhbXMudXJsU3VmZml4O1xuXHR9XG5cblx0ZWwuc2V0QXR0cmlidXRlKFwic3JjXCIsIHNyYyk7XG5cblx0c3dpdGNoKHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuaGVpZ2h0KXtcblx0XHRjYXNlIFwibnVtYmVyXCI6XG5cdFx0XHRlbC5zdHlsZS5oZWlnaHQgPSBmb3JtYXR0ZXJQYXJhbXMuaGVpZ2h0ICsgXCJweFwiO1xuXHRcdFx0YnJlYWs7XG5cblx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRlbC5zdHlsZS5oZWlnaHQgPSBmb3JtYXR0ZXJQYXJhbXMuaGVpZ2h0O1xuXHRcdFx0YnJlYWs7XG5cdH1cblxuXHRzd2l0Y2godHlwZW9mIGZvcm1hdHRlclBhcmFtcy53aWR0aCl7XG5cdFx0Y2FzZSBcIm51bWJlclwiOlxuXHRcdFx0ZWwuc3R5bGUud2lkdGggPSBmb3JtYXR0ZXJQYXJhbXMud2lkdGggKyBcInB4XCI7XG5cdFx0XHRicmVhaztcblxuXHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdGVsLnN0eWxlLndpZHRoID0gZm9ybWF0dGVyUGFyYW1zLndpZHRoO1xuXHRcdFx0YnJlYWs7XG5cdH1cblxuXHRlbC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBmdW5jdGlvbigpe1xuXHRcdGNlbGwuZ2V0Um93KCkubm9ybWFsaXplSGVpZ2h0KCk7XG5cdH0pO1xuXG5cdHJldHVybiBlbDtcbn1cblxuZnVuY3Rpb24gdGlja0Nyb3NzKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCl7XG5cdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcblx0ZWxlbWVudCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRlbXB0eSA9IGZvcm1hdHRlclBhcmFtcy5hbGxvd0VtcHR5LFxuXHR0cnV0aHkgPSBmb3JtYXR0ZXJQYXJhbXMuYWxsb3dUcnV0aHksXG5cdHRydWVWYWx1ZVNldCA9IE9iamVjdC5rZXlzKGZvcm1hdHRlclBhcmFtcykuaW5jbHVkZXMoXCJ0cnVlVmFsdWVcIiksXG5cdHRpY2sgPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLnRpY2tFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLnRpY2tFbGVtZW50IDogJzxzdmcgZW5hYmxlLWJhY2tncm91bmQ9XCJuZXcgMCAwIDI0IDI0XCIgaGVpZ2h0PVwiMTRcIiB3aWR0aD1cIjE0XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIHhtbDpzcGFjZT1cInByZXNlcnZlXCIgPjxwYXRoIGZpbGw9XCIjMkRDMjE0XCIgY2xpcC1ydWxlPVwiZXZlbm9kZFwiIGQ9XCJNMjEuNjUyLDMuMjExYy0wLjI5My0wLjI5NS0wLjc3LTAuMjk1LTEuMDYxLDBMOS40MSwxNC4zNCAgYy0wLjI5MywwLjI5Ny0wLjc3MSwwLjI5Ny0xLjA2MiwwTDMuNDQ5LDkuMzUxQzMuMzA0LDkuMjAzLDMuMTE0LDkuMTMsMi45MjMsOS4xMjlDMi43Myw5LjEyOCwyLjUzNCw5LjIwMSwyLjM4Nyw5LjM1MSAgbC0yLjE2NSwxLjk0NkMwLjA3OCwxMS40NDUsMCwxMS42MywwLDExLjgyM2MwLDAuMTk0LDAuMDc4LDAuMzk3LDAuMjIzLDAuNTQ0bDQuOTQsNS4xODRjMC4yOTIsMC4yOTYsMC43NzEsMC43NzYsMS4wNjIsMS4wNyAgbDIuMTI0LDIuMTQxYzAuMjkyLDAuMjkzLDAuNzY5LDAuMjkzLDEuMDYyLDBsMTQuMzY2LTE0LjM0YzAuMjkzLTAuMjk0LDAuMjkzLTAuNzc3LDAtMS4wNzFMMjEuNjUyLDMuMjExelwiIGZpbGwtcnVsZT1cImV2ZW5vZGRcIi8+PC9zdmc+Jyxcblx0Y3Jvc3MgPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLmNyb3NzRWxlbWVudCAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5jcm9zc0VsZW1lbnQgOiAnPHN2ZyBlbmFibGUtYmFja2dyb3VuZD1cIm5ldyAwIDAgMjQgMjRcIiBoZWlnaHQ9XCIxNFwiIHdpZHRoPVwiMTRcIiAgdmlld0JveD1cIjAgMCAyNCAyNFwiIHhtbDpzcGFjZT1cInByZXNlcnZlXCIgPjxwYXRoIGZpbGw9XCIjQ0UxNTE1XCIgZD1cIk0yMi4yNDUsNC4wMTVjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjEzOWwtNi4yNzYsNi4yN2MtMC4zMTMsMC4zMTItMC4zMTMsMC44MjYsMCwxLjE0bDYuMjczLDYuMjcyICBjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjE0bC0yLjI4NSwyLjI3N2MtMC4zMTQsMC4zMTItMC44MjgsMC4zMTItMS4xNDIsMGwtNi4yNzEtNi4yNzFjLTAuMzEzLTAuMzEzLTAuODI4LTAuMzEzLTEuMTQxLDAgIGwtNi4yNzYsNi4yNjdjLTAuMzEzLDAuMzEzLTAuODI4LDAuMzEzLTEuMTQxLDBsLTIuMjgyLTIuMjhjLTAuMzEzLTAuMzEzLTAuMzEzLTAuODI2LDAtMS4xNGw2LjI3OC02LjI2OSAgYzAuMzEzLTAuMzEyLDAuMzEzLTAuODI2LDAtMS4xNEwxLjcwOSw1LjE0N2MtMC4zMTQtMC4zMTMtMC4zMTQtMC44MjcsMC0xLjE0bDIuMjg0LTIuMjc4QzQuMzA4LDEuNDE3LDQuODIxLDEuNDE3LDUuMTM1LDEuNzMgIEwxMS40MDUsOGMwLjMxNCwwLjMxNCwwLjgyOCwwLjMxNCwxLjE0MSwwLjAwMWw2LjI3Ni02LjI2N2MwLjMxMi0wLjMxMiwwLjgyNi0wLjMxMiwxLjE0MSwwTDIyLjI0NSw0LjAxNXpcIi8+PC9zdmc+JztcblxuXHRpZigodHJ1ZVZhbHVlU2V0ICYmIHZhbHVlID09PSBmb3JtYXR0ZXJQYXJhbXMudHJ1ZVZhbHVlKSB8fCAoIXRydWVWYWx1ZVNldCAmJiAoKHRydXRoeSAmJiB2YWx1ZSkgfHwgKHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSBcInRydWVcIiB8fCB2YWx1ZSA9PT0gXCJUcnVlXCIgfHwgdmFsdWUgPT09IDEgfHwgdmFsdWUgPT09IFwiMVwiKSkpKXtcblx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtY2hlY2tlZFwiLCB0cnVlKTtcblx0XHRyZXR1cm4gdGljayB8fCBcIlwiO1xuXHR9ZWxzZSB7XG5cdFx0aWYoZW1wdHkgJiYgKHZhbHVlID09PSBcIm51bGxcIiB8fCB2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpKXtcblx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS1jaGVja2VkXCIsIFwibWl4ZWRcIik7XG5cdFx0XHRyZXR1cm4gXCJcIjtcblx0XHR9ZWxzZSB7XG5cdFx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtY2hlY2tlZFwiLCBmYWxzZSk7XG5cdFx0XHRyZXR1cm4gY3Jvc3MgfHwgXCJcIjtcblx0XHR9XG5cdH1cbn1cblxuZnVuY3Rpb24gZGF0ZXRpbWUkMShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHR2YXIgRFQgPSB0aGlzLnRhYmxlLmRlcGVuZGVuY3lSZWdpc3RyeS5sb29rdXAoW1wibHV4b25cIiwgXCJEYXRlVGltZVwiXSwgXCJEYXRlVGltZVwiKTtcblx0dmFyIGlucHV0Rm9ybWF0ID0gZm9ybWF0dGVyUGFyYW1zLmlucHV0Rm9ybWF0IHx8IFwieXl5eS1NTS1kZCBISDptbTpzc1wiO1xuXHR2YXJcdG91dHB1dEZvcm1hdCA9IGZvcm1hdHRlclBhcmFtcy5vdXRwdXRGb3JtYXQgfHwgXCJkZC9NTS95eXl5IEhIOm1tOnNzXCI7XG5cdHZhclx0aW52YWxpZCA9IHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuaW52YWxpZFBsYWNlaG9sZGVyICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLmludmFsaWRQbGFjZWhvbGRlciA6IFwiXCI7XG5cdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKTtcblxuXHRpZih0eXBlb2YgRFQgIT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0dmFyIG5ld0RhdGV0aW1lO1xuXG5cdFx0aWYoRFQuaXNEYXRlVGltZSh2YWx1ZSkpe1xuXHRcdFx0bmV3RGF0ZXRpbWUgPSB2YWx1ZTtcblx0XHR9ZWxzZSBpZihpbnB1dEZvcm1hdCA9PT0gXCJpc29cIil7XG5cdFx0XHRuZXdEYXRldGltZSA9IERULmZyb21JU08oU3RyaW5nKHZhbHVlKSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0bmV3RGF0ZXRpbWUgPSBEVC5mcm9tRm9ybWF0KFN0cmluZyh2YWx1ZSksIGlucHV0Rm9ybWF0KTtcblx0XHR9XG5cblx0XHRpZihuZXdEYXRldGltZS5pc1ZhbGlkKXtcblx0XHRcdGlmKGZvcm1hdHRlclBhcmFtcy50aW1lem9uZSl7XG5cdFx0XHRcdG5ld0RhdGV0aW1lID0gbmV3RGF0ZXRpbWUuc2V0Wm9uZShmb3JtYXR0ZXJQYXJhbXMudGltZXpvbmUpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gbmV3RGF0ZXRpbWUudG9Gb3JtYXQob3V0cHV0Rm9ybWF0KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRpZihpbnZhbGlkID09PSB0cnVlIHx8ICF2YWx1ZSl7XG5cdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdH1lbHNlIGlmKHR5cGVvZiBpbnZhbGlkID09PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0XHRyZXR1cm4gaW52YWxpZCh2YWx1ZSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHJldHVybiBpbnZhbGlkO1xuXHRcdFx0fVxuXHRcdH1cblx0fWVsc2Uge1xuXHRcdGNvbnNvbGUuZXJyb3IoXCJGb3JtYXQgRXJyb3IgLSAnZGF0ZXRpbWUnIGZvcm1hdHRlciBpcyBkZXBlbmRhbnQgb24gbHV4b24uanNcIik7XG5cdH1cbn1cblxuZnVuY3Rpb24gZGF0ZXRpbWVkaWZmIChjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpIHtcblx0dmFyIERUID0gdGhpcy50YWJsZS5kZXBlbmRlbmN5UmVnaXN0cnkubG9va3VwKFtcImx1eG9uXCIsIFwiRGF0ZVRpbWVcIl0sIFwiRGF0ZVRpbWVcIik7XG5cdHZhciBpbnB1dEZvcm1hdCA9IGZvcm1hdHRlclBhcmFtcy5pbnB1dEZvcm1hdCB8fCBcInl5eXktTU0tZGQgSEg6bW06c3NcIjtcblx0dmFyIGludmFsaWQgPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLmludmFsaWRQbGFjZWhvbGRlciAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5pbnZhbGlkUGxhY2Vob2xkZXIgOiBcIlwiO1xuXHR2YXIgc3VmZml4ID0gdHlwZW9mIGZvcm1hdHRlclBhcmFtcy5zdWZmaXggIT09IFwidW5kZWZpbmVkXCIgPyBmb3JtYXR0ZXJQYXJhbXMuc3VmZml4IDogZmFsc2U7XG5cdHZhciB1bml0ID0gdHlwZW9mIGZvcm1hdHRlclBhcmFtcy51bml0ICE9PSBcInVuZGVmaW5lZFwiID8gZm9ybWF0dGVyUGFyYW1zLnVuaXQgOiBcImRheXNcIjtcblx0dmFyIGh1bWFuaXplID0gdHlwZW9mIGZvcm1hdHRlclBhcmFtcy5odW1hbml6ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5odW1hbml6ZSA6IGZhbHNlO1xuXHR2YXIgZGF0ZSA9IHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuZGF0ZSAhPT0gXCJ1bmRlZmluZWRcIiA/IGZvcm1hdHRlclBhcmFtcy5kYXRlIDogRFQubm93KCk7XG5cdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKTtcblxuXHRpZih0eXBlb2YgRFQgIT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0dmFyIG5ld0RhdGV0aW1lO1xuXG5cdFx0aWYoRFQuaXNEYXRlVGltZSh2YWx1ZSkpe1xuXHRcdFx0bmV3RGF0ZXRpbWUgPSB2YWx1ZTtcblx0XHR9ZWxzZSBpZihpbnB1dEZvcm1hdCA9PT0gXCJpc29cIil7XG5cdFx0XHRuZXdEYXRldGltZSA9IERULmZyb21JU08oU3RyaW5nKHZhbHVlKSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0bmV3RGF0ZXRpbWUgPSBEVC5mcm9tRm9ybWF0KFN0cmluZyh2YWx1ZSksIGlucHV0Rm9ybWF0KTtcblx0XHR9XG5cblx0XHRpZiAobmV3RGF0ZXRpbWUuaXNWYWxpZCl7XG5cdFx0XHRpZihodW1hbml6ZSl7XG5cdFx0XHRcdHJldHVybiBuZXdEYXRldGltZS5kaWZmKGRhdGUsIHVuaXQpLnRvSHVtYW4oKSAgKyAoc3VmZml4ID8gXCIgXCIgKyBzdWZmaXggOiBcIlwiKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0cmV0dXJuIHBhcnNlSW50KG5ld0RhdGV0aW1lLmRpZmYoZGF0ZSwgdW5pdClbdW5pdF0pICsgKHN1ZmZpeCA/IFwiIFwiICsgc3VmZml4IDogXCJcIik7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblxuXHRcdFx0aWYgKGludmFsaWQgPT09IHRydWUpIHtcblx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgaW52YWxpZCA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0XHRcdHJldHVybiBpbnZhbGlkKHZhbHVlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJldHVybiBpbnZhbGlkO1xuXHRcdFx0fVxuXHRcdH1cblx0fWVsc2Uge1xuXHRcdGNvbnNvbGUuZXJyb3IoXCJGb3JtYXQgRXJyb3IgLSAnZGF0ZXRpbWVkaWZmJyBmb3JtYXR0ZXIgaXMgZGVwZW5kYW50IG9uIGx1eG9uLmpzXCIpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGxvb2t1cCAoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKSB7XG5cdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKTtcblxuXHRpZiAodHlwZW9mIGZvcm1hdHRlclBhcmFtc1t2YWx1ZV0gPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRjb25zb2xlLndhcm4oJ01pc3NpbmcgZGlzcGxheSB2YWx1ZSBmb3IgJyArIHZhbHVlKTtcblx0XHRyZXR1cm4gdmFsdWU7XG5cdH1cblxuXHRyZXR1cm4gZm9ybWF0dGVyUGFyYW1zW3ZhbHVlXTtcbn1cblxuZnVuY3Rpb24gc3RhcihjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHR2YXIgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdGVsZW1lbnQgPSBjZWxsLmdldEVsZW1lbnQoKSxcblx0bWF4U3RhcnMgPSBmb3JtYXR0ZXJQYXJhbXMgJiYgZm9ybWF0dGVyUGFyYW1zLnN0YXJzID8gZm9ybWF0dGVyUGFyYW1zLnN0YXJzIDogNSxcblx0c3RhcnMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKSxcblx0c3RhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCBcInN2Z1wiKSxcblx0c3RhckFjdGl2ZSA9ICc8cG9seWdvbiBmaWxsPVwiI0ZGRUEwMFwiIHN0cm9rZT1cIiNDMUFCNjBcIiBzdHJva2Utd2lkdGg9XCIzNy42MTUyXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZS1saW5lam9pbj1cInJvdW5kXCIgc3Ryb2tlLW1pdGVybGltaXQ9XCIxMFwiIHBvaW50cz1cIjI1OS4yMTYsMjkuOTQyIDMzMC4yNywxNzMuOTE5IDQ4OS4xNiwxOTcuMDA3IDM3NC4xODUsMzA5LjA4IDQwMS4zMyw0NjcuMzEgMjU5LjIxNiwzOTIuNjEyIDExNy4xMDQsNDY3LjMxIDE0NC4yNSwzMDkuMDggMjkuMjc0LDE5Ny4wMDcgMTg4LjE2NSwxNzMuOTE5IFwiLz4nLFxuXHRzdGFySW5hY3RpdmUgPSAnPHBvbHlnb24gZmlsbD1cIiNEMkQyRDJcIiBzdHJva2U9XCIjNjg2ODY4XCIgc3Ryb2tlLXdpZHRoPVwiMzcuNjE1MlwiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiIHN0cm9rZS1taXRlcmxpbWl0PVwiMTBcIiBwb2ludHM9XCIyNTkuMjE2LDI5Ljk0MiAzMzAuMjcsMTczLjkxOSA0ODkuMTYsMTk3LjAwNyAzNzQuMTg1LDMwOS4wOCA0MDEuMzMsNDY3LjMxIDI1OS4yMTYsMzkyLjYxMiAxMTcuMTA0LDQ2Ny4zMSAxNDQuMjUsMzA5LjA4IDI5LjI3NCwxOTcuMDA3IDE4OC4xNjUsMTczLjkxOSBcIi8+JztcblxuXHQvL3N0eWxlIHN0YXJzIGhvbGRlclxuXHRzdGFycy5zdHlsZS52ZXJ0aWNhbEFsaWduID0gXCJtaWRkbGVcIjtcblxuXHQvL3N0eWxlIHN0YXJcblx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiLCBcIjE0XCIpO1xuXHRzdGFyLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCBcIjE0XCIpO1xuXHRzdGFyLnNldEF0dHJpYnV0ZShcInZpZXdCb3hcIiwgXCIwIDAgNTEyIDUxMlwiKTtcblx0c3Rhci5zZXRBdHRyaWJ1dGUoXCJ4bWw6c3BhY2VcIiwgXCJwcmVzZXJ2ZVwiKTtcblx0c3Rhci5zdHlsZS5wYWRkaW5nID0gXCIwIDFweFwiO1xuXG5cdHZhbHVlID0gdmFsdWUgJiYgIWlzTmFOKHZhbHVlKSA/IHBhcnNlSW50KHZhbHVlKSA6IDA7XG5cblx0dmFsdWUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih2YWx1ZSwgbWF4U3RhcnMpKTtcblxuXHRmb3IodmFyIGk9MTtpPD0gbWF4U3RhcnM7aSsrKXtcblx0XHR2YXIgbmV4dFN0YXIgPSBzdGFyLmNsb25lTm9kZSh0cnVlKTtcblx0XHRuZXh0U3Rhci5pbm5lckhUTUwgPSBpIDw9IHZhbHVlID8gc3RhckFjdGl2ZSA6IHN0YXJJbmFjdGl2ZTtcblxuXHRcdHN0YXJzLmFwcGVuZENoaWxkKG5leHRTdGFyKTtcblx0fVxuXG5cdGVsZW1lbnQuc3R5bGUud2hpdGVTcGFjZSA9IFwibm93cmFwXCI7XG5cdGVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xuXHRlbGVtZW50LnN0eWxlLnRleHRPdmVyZmxvdyA9IFwiZWxsaXBzaXNcIjtcblxuXHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdmFsdWUpO1xuXG5cdHJldHVybiBzdGFycztcbn1cblxuZnVuY3Rpb24gdHJhZmZpYyhjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHR2YXIgdmFsdWUgPSB0aGlzLnNhbml0aXplSFRNTChjZWxsLmdldFZhbHVlKCkpIHx8IDAsXG5cdGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIiksXG5cdG1heCA9IGZvcm1hdHRlclBhcmFtcyAmJiBmb3JtYXR0ZXJQYXJhbXMubWF4ID8gZm9ybWF0dGVyUGFyYW1zLm1heCA6IDEwMCxcblx0bWluID0gZm9ybWF0dGVyUGFyYW1zICYmIGZvcm1hdHRlclBhcmFtcy5taW4gPyBmb3JtYXR0ZXJQYXJhbXMubWluIDogMCxcblx0Y29sb3JzID0gZm9ybWF0dGVyUGFyYW1zICYmIHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMuY29sb3IgIT09IFwidW5kZWZpbmVkXCIgPyBmb3JtYXR0ZXJQYXJhbXMuY29sb3IgOiBbXCJyZWRcIiwgXCJvcmFuZ2VcIiwgXCJncmVlblwiXSxcblx0Y29sb3IgPSBcIiM2NjY2NjZcIixcblx0cGVyY2VudCwgcGVyY2VudFZhbHVlO1xuXG5cdGlmKGlzTmFOKHZhbHVlKSB8fCB0eXBlb2YgY2VsbC5nZXRWYWx1ZSgpID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXRyYWZmaWMtbGlnaHRcIik7XG5cblx0Ly9tYWtlIHN1cmUgdmFsdWUgaXMgaW4gcmFuZ2Vcblx0cGVyY2VudFZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSkgPD0gbWF4ID8gcGFyc2VGbG9hdCh2YWx1ZSkgOiBtYXg7XG5cdHBlcmNlbnRWYWx1ZSA9IHBhcnNlRmxvYXQocGVyY2VudFZhbHVlKSA+PSBtaW4gPyBwYXJzZUZsb2F0KHBlcmNlbnRWYWx1ZSkgOiBtaW47XG5cblx0Ly93b3Jrb3V0IHBlcmNlbnRhZ2Vcblx0cGVyY2VudCA9IChtYXggLSBtaW4pIC8gMTAwO1xuXHRwZXJjZW50VmFsdWUgPSBNYXRoLnJvdW5kKChwZXJjZW50VmFsdWUgLSBtaW4pIC8gcGVyY2VudCk7XG5cblx0Ly9zZXQgY29sb3Jcblx0c3dpdGNoKHR5cGVvZiBjb2xvcnMpe1xuXHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdGNvbG9yID0gY29sb3JzO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRjb2xvciA9IGNvbG9ycyh2YWx1ZSk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwib2JqZWN0XCI6XG5cdFx0XHRpZihBcnJheS5pc0FycmF5KGNvbG9ycykpe1xuXHRcdFx0XHR2YXIgdW5pdCA9IDEwMCAvIGNvbG9ycy5sZW5ndGg7XG5cdFx0XHRcdHZhciBpbmRleCA9IE1hdGguZmxvb3IocGVyY2VudFZhbHVlIC8gdW5pdCk7XG5cblx0XHRcdFx0aW5kZXggPSBNYXRoLm1pbihpbmRleCwgY29sb3JzLmxlbmd0aCAtIDEpO1xuXHRcdFx0XHRpbmRleCA9IE1hdGgubWF4KGluZGV4LCAwKTtcblx0XHRcdFx0Y29sb3IgPSBjb2xvcnNbaW5kZXhdO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0fVxuXG5cdGVsLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuXG5cdHJldHVybiBlbDtcbn1cblxuZnVuY3Rpb24gcHJvZ3Jlc3MoY2VsbCwgZm9ybWF0dGVyUGFyYW1zID0ge30sIG9uUmVuZGVyZWQpeyAvL3Byb2dyZXNzIGJhclxuXHR2YXIgdmFsdWUgPSB0aGlzLnNhbml0aXplSFRNTChjZWxsLmdldFZhbHVlKCkpIHx8IDAsXG5cdGVsZW1lbnQgPSBjZWxsLmdldEVsZW1lbnQoKSxcblx0bWF4ID0gZm9ybWF0dGVyUGFyYW1zLm1heCA/IGZvcm1hdHRlclBhcmFtcy5tYXggOiAxMDAsXG5cdG1pbiA9IGZvcm1hdHRlclBhcmFtcy5taW4gPyBmb3JtYXR0ZXJQYXJhbXMubWluIDogMCxcblx0bGVnZW5kQWxpZ24gPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQWxpZ24gPyBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQWxpZ24gOiBcImNlbnRlclwiLFxuXHRwZXJjZW50LCBwZXJjZW50VmFsdWUsIGNvbG9yLCBsZWdlbmQsIGxlZ2VuZENvbG9yO1xuXG5cdC8vbWFrZSBzdXJlIHZhbHVlIGlzIGluIHJhbmdlXG5cdHBlcmNlbnRWYWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpIDw9IG1heCA/IHBhcnNlRmxvYXQodmFsdWUpIDogbWF4O1xuXHRwZXJjZW50VmFsdWUgPSBwYXJzZUZsb2F0KHBlcmNlbnRWYWx1ZSkgPj0gbWluID8gcGFyc2VGbG9hdChwZXJjZW50VmFsdWUpIDogbWluO1xuXG5cdC8vd29ya291dCBwZXJjZW50YWdlXG5cdHBlcmNlbnQgPSAobWF4IC0gbWluKSAvIDEwMDtcblx0cGVyY2VudFZhbHVlID0gTWF0aC5yb3VuZCgocGVyY2VudFZhbHVlIC0gbWluKSAvIHBlcmNlbnQpO1xuXG5cdC8vc2V0IGJhciBjb2xvclxuXHRzd2l0Y2godHlwZW9mIGZvcm1hdHRlclBhcmFtcy5jb2xvcil7XG5cdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0Y29sb3IgPSBmb3JtYXR0ZXJQYXJhbXMuY29sb3I7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdGNvbG9yID0gZm9ybWF0dGVyUGFyYW1zLmNvbG9yKHZhbHVlKTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdGlmKEFycmF5LmlzQXJyYXkoZm9ybWF0dGVyUGFyYW1zLmNvbG9yKSl7XG5cdFx0XHRcdGxldCB1bml0ID0gMTAwIC8gZm9ybWF0dGVyUGFyYW1zLmNvbG9yLmxlbmd0aDtcblx0XHRcdFx0bGV0IGluZGV4ID0gTWF0aC5mbG9vcihwZXJjZW50VmFsdWUgLyB1bml0KTtcblxuXHRcdFx0XHRpbmRleCA9IE1hdGgubWluKGluZGV4LCBmb3JtYXR0ZXJQYXJhbXMuY29sb3IubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdGluZGV4ID0gTWF0aC5tYXgoaW5kZXgsIDApO1xuXHRcdFx0XHRjb2xvciA9IGZvcm1hdHRlclBhcmFtcy5jb2xvcltpbmRleF07XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdGRlZmF1bHQ6XG5cdFx0XHRjb2xvciA9IFwiIzJEQzIxNFwiO1xuXHR9XG5cblx0Ly9nZW5lcmF0ZSBsZWdlbmRcblx0c3dpdGNoKHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kKXtcblx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRsZWdlbmQgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRsZWdlbmQgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kKHZhbHVlKTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJib29sZWFuXCI6XG5cdFx0XHRsZWdlbmQgPSB2YWx1ZTtcblx0XHRcdGJyZWFrO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHRsZWdlbmQgPSBmYWxzZTtcblx0fVxuXG5cdC8vc2V0IGxlZ2VuZCBjb2xvclxuXHRzd2l0Y2godHlwZW9mIGZvcm1hdHRlclBhcmFtcy5sZWdlbmRDb2xvcil7XG5cdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0bGVnZW5kQ29sb3IgPSBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQ29sb3I7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdGxlZ2VuZENvbG9yID0gZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yKHZhbHVlKTtcblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdGlmKEFycmF5LmlzQXJyYXkoZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yKSl7XG5cdFx0XHRcdGxldCB1bml0ID0gMTAwIC8gZm9ybWF0dGVyUGFyYW1zLmxlZ2VuZENvbG9yLmxlbmd0aDtcblx0XHRcdFx0bGV0IGluZGV4ID0gTWF0aC5mbG9vcihwZXJjZW50VmFsdWUgLyB1bml0KTtcblxuXHRcdFx0XHRpbmRleCA9IE1hdGgubWluKGluZGV4LCBmb3JtYXR0ZXJQYXJhbXMubGVnZW5kQ29sb3IubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdGluZGV4ID0gTWF0aC5tYXgoaW5kZXgsIDApO1xuXHRcdFx0XHRsZWdlbmRDb2xvciA9IGZvcm1hdHRlclBhcmFtcy5sZWdlbmRDb2xvcltpbmRleF07XG5cdFx0XHR9XG5cdFx0XHRicmVhaztcblx0XHRkZWZhdWx0OlxuXHRcdFx0bGVnZW5kQ29sb3IgPSBcIiMwMDBcIjtcblx0fVxuXG5cdGVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBcIjMwcHhcIjtcblx0ZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcblxuXHRlbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgcGVyY2VudFZhbHVlKTtcblxuXHR2YXIgYmFyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRiYXJFbC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcblx0YmFyRWwuc3R5bGUud2lkdGggPSBwZXJjZW50VmFsdWUgKyBcIiVcIjtcblx0YmFyRWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3I7XG5cdGJhckVsLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXG5cdGJhckVsLnNldEF0dHJpYnV0ZSgnZGF0YS1tYXgnLCBtYXgpO1xuXHRiYXJFbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtbWluJywgbWluKTtcblxuXHR2YXIgYmFyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0YmFyQ29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuXHRiYXJDb250YWluZXIuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcblx0YmFyQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuXG5cdGlmKGxlZ2VuZCl7XG5cdFx0dmFyIGxlZ2VuZEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRsZWdlbmRFbC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblx0XHRsZWdlbmRFbC5zdHlsZS50b3AgPSAwO1xuXHRcdGxlZ2VuZEVsLnN0eWxlLmxlZnQgPSAwO1xuXHRcdGxlZ2VuZEVsLnN0eWxlLnRleHRBbGlnbiA9IGxlZ2VuZEFsaWduO1xuXHRcdGxlZ2VuZEVsLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG5cdFx0bGVnZW5kRWwuc3R5bGUuY29sb3IgPSBsZWdlbmRDb2xvcjtcblx0XHRsZWdlbmRFbC5pbm5lckhUTUwgPSBsZWdlbmQ7XG5cdH1cblxuXHRvblJlbmRlcmVkKGZ1bmN0aW9uKCl7XG5cblx0XHQvL2hhbmRsZSBjdXN0b20gZWxlbWVudCBuZWVkZWQgaWYgZm9ybWF0dGVyIGlzIHRvIGJlIGluY2x1ZGVkIGluIHByaW50ZWQvZG93bmxvYWRlZCBvdXRwdXRcblx0XHRpZighKGNlbGwgaW5zdGFuY2VvZiBDZWxsQ29tcG9uZW50KSl7XG5cdFx0XHR2YXIgaG9sZGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0aG9sZGVyRWwuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG5cdFx0XHRob2xkZXJFbC5zdHlsZS50b3AgPSBcIjRweFwiO1xuXHRcdFx0aG9sZGVyRWwuc3R5bGUuYm90dG9tID0gXCI0cHhcIjtcblx0XHRcdGhvbGRlckVsLnN0eWxlLmxlZnQgPSBcIjRweFwiO1xuXHRcdFx0aG9sZGVyRWwuc3R5bGUucmlnaHQgPSBcIjRweFwiO1xuXG5cdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKGhvbGRlckVsKTtcblxuXHRcdFx0ZWxlbWVudCA9IGhvbGRlckVsO1xuXHRcdH1cblxuXHRcdGVsZW1lbnQuYXBwZW5kQ2hpbGQoYmFyQ29udGFpbmVyKTtcblx0XHRiYXJDb250YWluZXIuYXBwZW5kQ2hpbGQoYmFyRWwpO1xuXG5cdFx0aWYobGVnZW5kKXtcblx0XHRcdGJhckNvbnRhaW5lci5hcHBlbmRDaGlsZChsZWdlbmRFbCk7XG5cdFx0fVxuXHR9KTtcblxuXHRyZXR1cm4gXCJcIjtcbn1cblxuZnVuY3Rpb24gY29sb3IoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKXtcblx0Y2VsbC5nZXRFbGVtZW50KCkuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gdGhpcy5zYW5pdGl6ZUhUTUwoY2VsbC5nZXRWYWx1ZSgpKTtcblx0cmV0dXJuIFwiXCI7XG59XG5cbmZ1bmN0aW9uIGJ1dHRvblRpY2soY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKXtcblx0cmV0dXJuICc8c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPVwibmV3IDAgMCAyNCAyNFwiIGhlaWdodD1cIjE0XCIgd2lkdGg9XCIxNFwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIiB4bWw6c3BhY2U9XCJwcmVzZXJ2ZVwiID48cGF0aCBmaWxsPVwiIzJEQzIxNFwiIGNsaXAtcnVsZT1cImV2ZW5vZGRcIiBkPVwiTTIxLjY1MiwzLjIxMWMtMC4yOTMtMC4yOTUtMC43Ny0wLjI5NS0xLjA2MSwwTDkuNDEsMTQuMzQgIGMtMC4yOTMsMC4yOTctMC43NzEsMC4yOTctMS4wNjIsMEwzLjQ0OSw5LjM1MUMzLjMwNCw5LjIwMywzLjExNCw5LjEzLDIuOTIzLDkuMTI5QzIuNzMsOS4xMjgsMi41MzQsOS4yMDEsMi4zODcsOS4zNTEgIGwtMi4xNjUsMS45NDZDMC4wNzgsMTEuNDQ1LDAsMTEuNjMsMCwxMS44MjNjMCwwLjE5NCwwLjA3OCwwLjM5NywwLjIyMywwLjU0NGw0Ljk0LDUuMTg0YzAuMjkyLDAuMjk2LDAuNzcxLDAuNzc2LDEuMDYyLDEuMDcgIGwyLjEyNCwyLjE0MWMwLjI5MiwwLjI5MywwLjc2OSwwLjI5MywxLjA2MiwwbDE0LjM2Ni0xNC4zNGMwLjI5My0wLjI5NCwwLjI5My0wLjc3NywwLTEuMDcxTDIxLjY1MiwzLjIxMXpcIiBmaWxsLXJ1bGU9XCJldmVub2RkXCIvPjwvc3ZnPic7XG59XG5cbmZ1bmN0aW9uIGJ1dHRvbkNyb3NzKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCl7XG5cdHJldHVybiAnPHN2ZyBlbmFibGUtYmFja2dyb3VuZD1cIm5ldyAwIDAgMjQgMjRcIiBoZWlnaHQ9XCIxNFwiIHdpZHRoPVwiMTRcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgeG1sOnNwYWNlPVwicHJlc2VydmVcIiA+PHBhdGggZmlsbD1cIiNDRTE1MTVcIiBkPVwiTTIyLjI0NSw0LjAxNWMwLjMxMywwLjMxMywwLjMxMywwLjgyNiwwLDEuMTM5bC02LjI3Niw2LjI3Yy0wLjMxMywwLjMxMi0wLjMxMywwLjgyNiwwLDEuMTRsNi4yNzMsNi4yNzIgIGMwLjMxMywwLjMxMywwLjMxMywwLjgyNiwwLDEuMTRsLTIuMjg1LDIuMjc3Yy0wLjMxNCwwLjMxMi0wLjgyOCwwLjMxMi0xLjE0MiwwbC02LjI3MS02LjI3MWMtMC4zMTMtMC4zMTMtMC44MjgtMC4zMTMtMS4xNDEsMCAgbC02LjI3Niw2LjI2N2MtMC4zMTMsMC4zMTMtMC44MjgsMC4zMTMtMS4xNDEsMGwtMi4yODItMi4yOGMtMC4zMTMtMC4zMTMtMC4zMTMtMC44MjYsMC0xLjE0bDYuMjc4LTYuMjY5ICBjMC4zMTMtMC4zMTIsMC4zMTMtMC44MjYsMC0xLjE0TDEuNzA5LDUuMTQ3Yy0wLjMxNC0wLjMxMy0wLjMxNC0wLjgyNywwLTEuMTRsMi4yODQtMi4yNzhDNC4zMDgsMS40MTcsNC44MjEsMS40MTcsNS4xMzUsMS43MyAgTDExLjQwNSw4YzAuMzE0LDAuMzE0LDAuODI4LDAuMzE0LDEuMTQxLDAuMDAxbDYuMjc2LTYuMjY3YzAuMzEyLTAuMzEyLDAuODI2LTAuMzEyLDEuMTQxLDBMMjIuMjQ1LDQuMDE1elwiLz48L3N2Zz4nO1xufVxuXG5mdW5jdGlvbiB0b2dnbGUoY2VsbCwgZm9ybWF0dGVyUGFyYW1zLCBvblJlbmRlcmVkKXtcclxuXHR2YXIgdmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXHJcblx0c2l6ZSA9IGZvcm1hdHRlclBhcmFtcy5zaXplIHx8MTUsXHJcblx0c2l6ZVB4ID0gc2l6ZSArIFwicHhcIixcclxuXHRjb250YWluRWwsIHN3aXRjaEVsLFxyXG5cdG9uVmFsdWUgPSBmb3JtYXR0ZXJQYXJhbXMuaGFzT3duUHJvcGVydHkoXCJvblZhbHVlXCIpID8gZm9ybWF0dGVyUGFyYW1zLm9uVmFsdWUgOiB0cnVlLFxyXG5cdG9mZlZhbHVlID0gZm9ybWF0dGVyUGFyYW1zLmhhc093blByb3BlcnR5KFwib2ZmVmFsdWVcIikgPyBmb3JtYXR0ZXJQYXJhbXMub2ZmVmFsdWUgOiBmYWxzZSxcclxuXHJcblxyXG5cdHN0YXRlID0gZm9ybWF0dGVyUGFyYW1zLm9uVHJ1dGh5ID8gdmFsdWUgOiB2YWx1ZSA9PT0gb25WYWx1ZTtcclxuXHJcblx0XHJcblx0Y29udGFpbkVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuXHRjb250YWluRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci10b2dnbGVcIik7XHJcblxyXG5cdGlmKHN0YXRlKXtcclxuXHRcdGNvbnRhaW5FbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXRvZ2dsZS1vblwiKTtcclxuXHRcdGNvbnRhaW5FbC5zdHlsZS5mbGV4RGlyZWN0aW9uID0gXCJyb3ctcmV2ZXJzZVwiO1xyXG5cclxuXHRcdGlmKGZvcm1hdHRlclBhcmFtcy5vbkNvbG9yKXtcclxuXHRcdFx0Y29udGFpbkVsLnN0eWxlLmJhY2tncm91bmQgPSBmb3JtYXR0ZXJQYXJhbXMub25Db2xvcjtcclxuXHRcdH1cclxuXHR9ZWxzZSB7XHJcblx0XHRpZihmb3JtYXR0ZXJQYXJhbXMub2ZmQ29sb3Ipe1xyXG5cdFx0XHRjb250YWluRWwuc3R5bGUuYmFja2dyb3VuZCA9IGZvcm1hdHRlclBhcmFtcy5vZmZDb2xvcjtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGNvbnRhaW5FbC5zdHlsZS53aWR0aCA9ICgyLjUgKiBzaXplKSArIFwicHhcIjtcclxuXHRjb250YWluRWwuc3R5bGUuYm9yZGVyUmFkaXVzID0gc2l6ZVB4O1xyXG5cclxuXHRpZihmb3JtYXR0ZXJQYXJhbXMuY2xpY2thYmxlKXtcclxuXHRcdGNvbnRhaW5FbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuXHRcdFx0Y2VsbC5zZXRWYWx1ZShzdGF0ZSA/IG9mZlZhbHVlIDogb25WYWx1ZSk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN3aXRjaEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuXHRzd2l0Y2hFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXRvZ2dsZS1zd2l0Y2hcIik7XHJcblxyXG5cdHN3aXRjaEVsLnN0eWxlLmhlaWdodCA9IHNpemVQeDtcclxuXHRzd2l0Y2hFbC5zdHlsZS53aWR0aCA9IHNpemVQeDtcclxuXHRzd2l0Y2hFbC5zdHlsZS5ib3JkZXJSYWRpdXMgPSBzaXplUHg7XHJcblx0XHJcblx0Y29udGFpbkVsLmFwcGVuZENoaWxkKHN3aXRjaEVsKTtcclxuXHRcclxuXHRyZXR1cm4gY29udGFpbkVsO1xyXG59XG5cbmZ1bmN0aW9uIHJvd251bShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHR2YXIgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXHR2YXIgcm93ID0gY2VsbC5nZXRSb3coKTtcblx0dmFyIHRhYmxlID0gY2VsbC5nZXRUYWJsZSgpO1xuXG5cdHJvdy53YXRjaFBvc2l0aW9uKChwb3NpdGlvbikgPT4ge1xuXHRcdGlmIChmb3JtYXR0ZXJQYXJhbXMucmVsYXRpdmVUb1BhZ2UpIHtcblx0XHRcdHBvc2l0aW9uICs9IHRhYmxlLm1vZHVsZXMucGFnZS5nZXRQYWdlU2l6ZSgpICogKHRhYmxlLm1vZHVsZXMucGFnZS5nZXRQYWdlKCkgLSAxKTtcblx0XHR9XG5cdFx0Y29udGVudC5pbm5lclRleHQgPSBwb3NpdGlvbjtcblx0fSk7XG5cdFxuXHRyZXR1cm4gY29udGVudDtcbn1cblxuZnVuY3Rpb24gaGFuZGxlKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCl7XG5cdGNlbGwuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LWhhbmRsZVwiKTtcblx0cmV0dXJuIFwiPGRpdiBjbGFzcz0ndGFidWxhdG9yLXJvdy1oYW5kbGUtYm94Jz48ZGl2IGNsYXNzPSd0YWJ1bGF0b3Itcm93LWhhbmRsZS1iYXInPjwvZGl2PjxkaXYgY2xhc3M9J3RhYnVsYXRvci1yb3ctaGFuZGxlLWJhcic+PC9kaXY+PGRpdiBjbGFzcz0ndGFidWxhdG9yLXJvdy1oYW5kbGUtYmFyJz48L2Rpdj48L2Rpdj5cIjtcbn1cblxuZnVuY3Rpb24gYWRhcHRhYmxlKGNlbGwsIHBhcmFtcywgb25SZW5kZXJlZCl7XHJcblx0dmFyIGxvb2t1cCwgZm9ybWF0dGVyRnVuYywgZm9ybWF0dGVyUGFyYW1zO1xyXG4gICAgXHJcblx0ZnVuY3Rpb24gZGVmYXVsdExvb2t1cChjZWxsKXtcclxuXHRcdHZhciB2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKSxcclxuXHRcdGZvcm1hdHRlciA9IFwicGxhaW50ZXh0XCI7XHJcbiAgICAgICAgXHJcblx0XHRzd2l0Y2godHlwZW9mIHZhbHVlKXsgICAgICAgICAgIFxyXG5cdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxyXG5cdFx0XHRcdGZvcm1hdHRlciA9IFwidGlja0Nyb3NzXCI7XHJcblx0XHRcdFx0YnJlYWs7XHJcbiAgICAgICAgICAgIFxyXG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XHJcblx0XHRcdFx0aWYodmFsdWUuaW5jbHVkZXMoXCJcXG5cIikpe1xyXG5cdFx0XHRcdFx0Zm9ybWF0dGVyID0gXCJ0ZXh0YXJlYVwiO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRicmVhaztcclxuXHRcdH1cclxuICAgICAgICBcclxuXHRcdHJldHVybiBmb3JtYXR0ZXI7XHJcblx0fVxyXG4gICAgXHJcblx0bG9va3VwID0gcGFyYW1zLmZvcm1hdHRlckxvb2t1cCA/IHBhcmFtcy5mb3JtYXR0ZXJMb29rdXAoY2VsbCkgOiBkZWZhdWx0TG9va3VwKGNlbGwpO1xyXG5cclxuXHRpZihwYXJhbXMucGFyYW1zTG9va3VwKXtcclxuXHRcdGZvcm1hdHRlclBhcmFtcyA9IHR5cGVvZiBwYXJhbXMucGFyYW1zTG9va3VwID09PSBcImZ1bmN0aW9uXCIgPyBwYXJhbXMucGFyYW1zTG9va3VwKGxvb2t1cCwgY2VsbCkgOiBwYXJhbXMucGFyYW1zTG9va3VwW2xvb2t1cF07XHJcblx0fVxyXG5cclxuXHRmb3JtYXR0ZXJGdW5jID0gdGhpcy50YWJsZS5tb2R1bGVzLmZvcm1hdC5sb29rdXBGb3JtYXR0ZXIobG9va3VwKTtcclxuICAgIFxyXG5cdHJldHVybiAgZm9ybWF0dGVyRnVuYy5jYWxsKHRoaXMsIGNlbGwsIGZvcm1hdHRlclBhcmFtcyB8fCB7fSwgb25SZW5kZXJlZCk7XHJcbn1cblxuZnVuY3Rpb24gYXJyYXkkMihjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHR2YXIgZGVsaW1pdGVyID0gZm9ybWF0dGVyUGFyYW1zLmRlbGltaXRlciB8fCBcIixcIixcblx0dmFsdWUgPSBjZWxsLmdldFZhbHVlKCksXG5cdHRhYmxlID0gdGhpcy50YWJsZSxcblx0dmFsdWVNYXA7XG5cdFxuXHRpZihmb3JtYXR0ZXJQYXJhbXMudmFsdWVNYXApe1xuXHRcdGlmKHR5cGVvZiBmb3JtYXR0ZXJQYXJhbXMudmFsdWVNYXAgPT09IFwic3RyaW5nXCIpe1xuXHRcdFx0dmFsdWVNYXAgPSBmdW5jdGlvbih2YWx1ZSl7XG5cdFx0XHRcdHJldHVybiB2YWx1ZS5tYXAoKGl0ZW0pID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gSGVscGVycy5yZXRyaWV2ZU5lc3RlZERhdGEodGFibGUub3B0aW9ucy5uZXN0ZWRGaWVsZFNlcGFyYXRvciwgZm9ybWF0dGVyUGFyYW1zLnZhbHVlTWFwLCBpdGVtKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9O1xuXHRcdH1lbHNlIHtcblx0XHRcdHZhbHVlTWFwID0gZm9ybWF0dGVyUGFyYW1zLnZhbHVlTWFwO1xuXHRcdH1cblx0fVxuXG5cdGlmKEFycmF5LmlzQXJyYXkodmFsdWUpKXtcblx0XHRpZih2YWx1ZU1hcCl7XG5cdFx0XHR2YWx1ZSA9IHZhbHVlTWFwKHZhbHVlKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdmFsdWUuam9pbihkZWxpbWl0ZXIpO1xuXHR9ZWxzZSB7XG5cdFx0cmV0dXJuIHZhbHVlO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGpzb24kMShjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHR2YXIgaW5kZW50ID0gZm9ybWF0dGVyUGFyYW1zLmluZGVudCB8fCBcIlxcdFwiLFxuXHRtdWx0aWxpbmUgPSB0eXBlb2YgZm9ybWF0dGVyUGFyYW1zLm11bHRpbGluZSA9PT0gXCJ1bmRlZmluZWRcIiA/IHRydWUgOiBmb3JtYXR0ZXJQYXJhbXMubXVsdGlsaW5lLFxuXHRyZXBsYWNlciA9IGZvcm1hdHRlclBhcmFtcy5yZXBsYWNlciB8fCBudWxsLFxuXHR2YWx1ZSA9IGNlbGwuZ2V0VmFsdWUoKTtcblx0XG5cdGlmKG11bHRpbGluZSl7XG5cdFx0Y2VsbC5nZXRFbGVtZW50KCkuc3R5bGUud2hpdGVTcGFjZSA9IFwicHJlLXdyYXBcIjtcblx0fVxuXG5cdHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSwgcmVwbGFjZXIsIGluZGVudCk7XG59XG5cbnZhciBkZWZhdWx0Rm9ybWF0dGVycyA9IHtcblx0cGxhaW50ZXh0OnBsYWludGV4dCxcblx0aHRtbDpodG1sLFxuXHR0ZXh0YXJlYTp0ZXh0YXJlYSxcblx0bW9uZXk6bW9uZXksXG5cdGxpbms6bGluayxcblx0aW1hZ2U6aW1hZ2UsXG5cdHRpY2tDcm9zczp0aWNrQ3Jvc3MsXG5cdGRhdGV0aW1lOmRhdGV0aW1lJDEsXG5cdGRhdGV0aW1lZGlmZjpkYXRldGltZWRpZmYsXG5cdGxvb2t1cDpsb29rdXAsXG5cdHN0YXI6c3Rhcixcblx0dHJhZmZpYzp0cmFmZmljLFxuXHRwcm9ncmVzczpwcm9ncmVzcyxcblx0Y29sb3I6Y29sb3IsXG5cdGJ1dHRvblRpY2s6YnV0dG9uVGljayxcblx0YnV0dG9uQ3Jvc3M6YnV0dG9uQ3Jvc3MsXG5cdHRvZ2dsZTp0b2dnbGUsXG5cdHJvd251bTpyb3dudW0sXG5cdGhhbmRsZTpoYW5kbGUsXG5cdGFkYXB0YWJsZTphZGFwdGFibGUsXG5cdGFycmF5OmFycmF5JDIsXG5cdGpzb246anNvbiQxLFxufTtcblxuY2xhc3MgRm9ybWF0IGV4dGVuZHMgTW9kdWxle1xuXHRcblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcImZvcm1hdFwiO1xuXHRcblx0Ly9sb2FkIGRlZmF1bHRzXG5cdHN0YXRpYyBmb3JtYXR0ZXJzID0gZGVmYXVsdEZvcm1hdHRlcnM7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJmb3JtYXR0ZXJcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImZvcm1hdHRlclBhcmFtc1wiKTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiZm9ybWF0dGVyUHJpbnRcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImZvcm1hdHRlclByaW50UGFyYW1zXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJmb3JtYXR0ZXJDbGlwYm9hcmRcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImZvcm1hdHRlckNsaXBib2FyZFBhcmFtc1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiZm9ybWF0dGVySHRtbE91dHB1dFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiZm9ybWF0dGVySHRtbE91dHB1dFBhcmFtc1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwidGl0bGVGb3JtYXR0ZXJcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcInRpdGxlRm9ybWF0dGVyUGFyYW1zXCIpO1xuXHR9XG5cdFxuXHRpbml0aWFsaXplKCl7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLWZvcm1hdFwiLCB0aGlzLmZvcm1hdFZhbHVlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1yZW5kZXJlZFwiLCB0aGlzLmNlbGxSZW5kZXJlZC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1sYXlvdXRcIiwgdGhpcy5pbml0aWFsaXplQ29sdW1uLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWZvcm1hdFwiLCB0aGlzLmZvcm1hdEhlYWRlci5iaW5kKHRoaXMpKTtcblx0fVxuXHRcblx0Ly9pbml0aWFsaXplIGNvbHVtbiBmb3JtYXR0ZXJcblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdGNvbHVtbi5tb2R1bGVzLmZvcm1hdCA9IHRoaXMubG9va3VwVHlwZUZvcm1hdHRlcihjb2x1bW4sIFwiXCIpO1xuXHRcdFxuXHRcdGlmKHR5cGVvZiBjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXJQcmludCAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5mb3JtYXQucHJpbnQgPSB0aGlzLmxvb2t1cFR5cGVGb3JtYXR0ZXIoY29sdW1uLCBcIlByaW50XCIpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0eXBlb2YgY29sdW1uLmRlZmluaXRpb24uZm9ybWF0dGVyQ2xpcGJvYXJkICE9PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLmZvcm1hdC5jbGlwYm9hcmQgPSB0aGlzLmxvb2t1cFR5cGVGb3JtYXR0ZXIoY29sdW1uLCBcIkNsaXBib2FyZFwiKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlckh0bWxPdXRwdXQgIT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZm9ybWF0Lmh0bWxPdXRwdXQgPSB0aGlzLmxvb2t1cFR5cGVGb3JtYXR0ZXIoY29sdW1uLCBcIkh0bWxPdXRwdXRcIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRsb29rdXBUeXBlRm9ybWF0dGVyKGNvbHVtbiwgdHlwZSl7XG5cdFx0dmFyIGNvbmZpZyA9IHtwYXJhbXM6Y29sdW1uLmRlZmluaXRpb25bXCJmb3JtYXR0ZXJcIiArIHR5cGUgKyBcIlBhcmFtc1wiXSB8fCB7fX0sXG5cdFx0Zm9ybWF0dGVyID0gY29sdW1uLmRlZmluaXRpb25bXCJmb3JtYXR0ZXJcIiArIHR5cGVdO1xuXHRcdFxuXHRcdGNvbmZpZy5mb3JtYXR0ZXIgPSB0aGlzLmxvb2t1cEZvcm1hdHRlcihmb3JtYXR0ZXIpO1xuXHRcdFxuXHRcdHJldHVybiBjb25maWc7XG5cdH1cblx0XG5cdFxuXHRsb29rdXBGb3JtYXR0ZXIoZm9ybWF0dGVyKXtcblx0XHR2YXIgZm9ybWF0dGVyRnVuYztcblxuXHRcdC8vc2V0IGNvbHVtbiBmb3JtYXR0ZXJcblx0XHRzd2l0Y2godHlwZW9mIGZvcm1hdHRlcil7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdGlmKEZvcm1hdC5mb3JtYXR0ZXJzW2Zvcm1hdHRlcl0pe1xuXHRcdFx0XHRcdGZvcm1hdHRlckZ1bmMgPSBGb3JtYXQuZm9ybWF0dGVyc1tmb3JtYXR0ZXJdO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRm9ybWF0dGVyIEVycm9yIC0gTm8gc3VjaCBmb3JtYXR0ZXIgZm91bmQ6IFwiLCBmb3JtYXR0ZXIpO1xuXHRcdFx0XHRcdGZvcm1hdHRlckZ1bmMgPSBGb3JtYXQuZm9ybWF0dGVycy5wbGFpbnRleHQ7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRmb3JtYXR0ZXJGdW5jID0gZm9ybWF0dGVyO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0Zm9ybWF0dGVyRnVuYyA9IEZvcm1hdC5mb3JtYXR0ZXJzLnBsYWludGV4dDtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBmb3JtYXR0ZXJGdW5jO1xuXHR9XG5cdFxuXHRjZWxsUmVuZGVyZWQoY2VsbCl7XG5cdFx0aWYoY2VsbC5tb2R1bGVzLmZvcm1hdCAmJiBjZWxsLm1vZHVsZXMuZm9ybWF0LnJlbmRlcmVkQ2FsbGJhY2sgJiYgIWNlbGwubW9kdWxlcy5mb3JtYXQucmVuZGVyZWQpe1xuXHRcdFx0Y2VsbC5tb2R1bGVzLmZvcm1hdC5yZW5kZXJlZENhbGxiYWNrKCk7XG5cdFx0XHRjZWxsLm1vZHVsZXMuZm9ybWF0LnJlbmRlcmVkID0gdHJ1ZTtcblx0XHR9XG5cdH1cblx0XG5cdC8vcmV0dXJuIGEgZm9ybWF0dGVkIHZhbHVlIGZvciBhIGNvbHVtbiBoZWFkZXJcblx0Zm9ybWF0SGVhZGVyKGNvbHVtbiwgdGl0bGUsIGVsKXtcblx0XHR2YXIgZm9ybWF0dGVyLCBwYXJhbXMsIG9uUmVuZGVyZWQsIG1vY2tDZWxsO1xuXHRcdFxuXHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLnRpdGxlRm9ybWF0dGVyKXtcblx0XHRcdGZvcm1hdHRlciA9IHRoaXMubG9va3VwRm9ybWF0dGVyKGNvbHVtbi5kZWZpbml0aW9uLnRpdGxlRm9ybWF0dGVyKTtcblx0XHRcdFxuXHRcdFx0b25SZW5kZXJlZCA9IChjYWxsYmFjaykgPT4ge1xuXHRcdFx0XHRjb2x1bW4udGl0bGVGb3JtYXR0ZXJSZW5kZXJlZCA9IGNhbGxiYWNrO1xuXHRcdFx0fTtcblx0XHRcdFxuXHRcdFx0bW9ja0NlbGwgPSB7XG5cdFx0XHRcdGdldFZhbHVlOmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0cmV0dXJuIHRpdGxlO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRnZXRFbGVtZW50OmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0cmV0dXJuIGVsO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRnZXRUeXBlOmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0cmV0dXJuIFwiaGVhZGVyXCI7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdGdldENvbHVtbjpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdHJldHVybiBjb2x1bW4uZ2V0Q29tcG9uZW50KCk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdGdldFRhYmxlOigpID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy50YWJsZTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdFxuXHRcdFx0cGFyYW1zID0gY29sdW1uLmRlZmluaXRpb24udGl0bGVGb3JtYXR0ZXJQYXJhbXMgfHwge307XG5cdFx0XHRcblx0XHRcdHBhcmFtcyA9IHR5cGVvZiBwYXJhbXMgPT09IFwiZnVuY3Rpb25cIiA/IHBhcmFtcygpIDogcGFyYW1zO1xuXHRcdFx0XG5cdFx0XHRyZXR1cm4gZm9ybWF0dGVyLmNhbGwodGhpcywgbW9ja0NlbGwsIHBhcmFtcywgb25SZW5kZXJlZCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmV0dXJuIHRpdGxlO1xuXHRcdH1cblx0fVxuXHRcblx0XG5cdC8vcmV0dXJuIGEgZm9ybWF0dGVkIHZhbHVlIGZvciBhIGNlbGxcblx0Zm9ybWF0VmFsdWUoY2VsbCl7XG5cdFx0dmFyIGNvbXBvbmVudCA9IGNlbGwuZ2V0Q29tcG9uZW50KCksXG5cdFx0cGFyYW1zID0gdHlwZW9mIGNlbGwuY29sdW1uLm1vZHVsZXMuZm9ybWF0LnBhcmFtcyA9PT0gXCJmdW5jdGlvblwiID8gY2VsbC5jb2x1bW4ubW9kdWxlcy5mb3JtYXQucGFyYW1zKGNvbXBvbmVudCkgOiBjZWxsLmNvbHVtbi5tb2R1bGVzLmZvcm1hdC5wYXJhbXM7XG5cdFx0XG5cdFx0ZnVuY3Rpb24gb25SZW5kZXJlZChjYWxsYmFjayl7XG5cdFx0XHRpZighY2VsbC5tb2R1bGVzLmZvcm1hdCl7XG5cdFx0XHRcdGNlbGwubW9kdWxlcy5mb3JtYXQgPSB7fTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Y2VsbC5tb2R1bGVzLmZvcm1hdC5yZW5kZXJlZENhbGxiYWNrID0gY2FsbGJhY2s7XG5cdFx0XHRjZWxsLm1vZHVsZXMuZm9ybWF0LnJlbmRlcmVkID0gZmFsc2U7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBjZWxsLmNvbHVtbi5tb2R1bGVzLmZvcm1hdC5mb3JtYXR0ZXIuY2FsbCh0aGlzLCBjb21wb25lbnQsIHBhcmFtcywgb25SZW5kZXJlZCk7XG5cdH1cblx0XG5cdGZvcm1hdEV4cG9ydFZhbHVlKGNlbGwsIHR5cGUpe1xuXHRcdHZhciBmb3JtYXR0ZXIgPSBjZWxsLmNvbHVtbi5tb2R1bGVzLmZvcm1hdFt0eXBlXSxcblx0XHRwYXJhbXM7XG5cdFx0XG5cdFx0aWYoZm9ybWF0dGVyKXtcblx0XHRcdHBhcmFtcyA9IHR5cGVvZiBmb3JtYXR0ZXIucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBmb3JtYXR0ZXIucGFyYW1zKGNlbGwuZ2V0Q29tcG9uZW50KCkpIDogZm9ybWF0dGVyLnBhcmFtcztcblx0XHRcdFxuXHRcdFx0ZnVuY3Rpb24gb25SZW5kZXJlZChjYWxsYmFjayl7XG5cdFx0XHRcdGlmKCFjZWxsLm1vZHVsZXMuZm9ybWF0KXtcblx0XHRcdFx0XHRjZWxsLm1vZHVsZXMuZm9ybWF0ID0ge307XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGNlbGwubW9kdWxlcy5mb3JtYXQucmVuZGVyZWRDYWxsYmFjayA9IGNhbGxiYWNrO1xuXHRcdFx0XHRjZWxsLm1vZHVsZXMuZm9ybWF0LnJlbmRlcmVkID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHJldHVybiBmb3JtYXR0ZXIuZm9ybWF0dGVyLmNhbGwodGhpcywgY2VsbC5nZXRDb21wb25lbnQoKSwgcGFyYW1zLCBvblJlbmRlcmVkKTtcblx0XHRcdFxuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLmZvcm1hdFZhbHVlKGNlbGwpO1xuXHRcdH1cblx0fVxuXHRcblx0c2FuaXRpemVIVE1MKHZhbHVlKXtcblx0XHRpZih2YWx1ZSl7XG5cdFx0XHR2YXIgZW50aXR5TWFwID0ge1xuXHRcdFx0XHQnJic6ICcmYW1wOycsXG5cdFx0XHRcdCc8JzogJyZsdDsnLFxuXHRcdFx0XHQnPic6ICcmZ3Q7Jyxcblx0XHRcdFx0J1wiJzogJyZxdW90OycsXG5cdFx0XHRcdFwiJ1wiOiAnJiMzOTsnLFxuXHRcdFx0XHQnLyc6ICcmI3gyRjsnLFxuXHRcdFx0XHQnYCc6ICcmI3g2MDsnLFxuXHRcdFx0XHQnPSc6ICcmI3gzRDsnXG5cdFx0XHR9O1xuXHRcdFx0XG5cdFx0XHRyZXR1cm4gU3RyaW5nKHZhbHVlKS5yZXBsYWNlKC9bJjw+XCInYD0vXS9nLCBmdW5jdGlvbiAocykge1xuXHRcdFx0XHRyZXR1cm4gZW50aXR5TWFwW3NdO1xuXHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdH1cblx0fVxuXHRcblx0ZW1wdHlUb1NwYWNlKHZhbHVlKXtcblx0XHRyZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiIHx8IHZhbHVlID09PSBcIlwiID8gXCImbmJzcDtcIiA6IHZhbHVlO1xuXHR9XG5cdFxufVxuXG5jbGFzcyBGcm96ZW5Db2x1bW5zIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJmcm96ZW5Db2x1bW5zXCI7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMubGVmdENvbHVtbnMgPSBbXTtcblx0XHR0aGlzLnJpZ2h0Q29sdW1ucyA9IFtdO1xuXHRcdHRoaXMuaW5pdGlhbGl6YXRpb25Nb2RlID0gXCJsZWZ0XCI7XG5cdFx0dGhpcy5hY3RpdmUgPSBmYWxzZTtcblx0XHR0aGlzLmJsb2NrZWQgPSB0cnVlO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJmcm96ZW5cIik7XG5cdH1cblx0XG5cdC8vcmVzZXQgaW5pdGlhbCBzdGF0ZVxuXHRyZXNldCgpe1xuXHRcdHRoaXMuaW5pdGlhbGl6YXRpb25Nb2RlID0gXCJsZWZ0XCI7XG5cdFx0dGhpcy5sZWZ0Q29sdW1ucyA9IFtdO1xuXHRcdHRoaXMucmlnaHRDb2x1bW5zID0gW107XG5cdFx0dGhpcy5hY3RpdmUgPSBmYWxzZTtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1sYXlvdXRcIiwgdGhpcy5sYXlvdXRDZWxsLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWluaXRcIiwgdGhpcy5pbml0aWFsaXplQ29sdW1uLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLXdpZHRoXCIsIHRoaXMubGF5b3V0LmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWxheW91dC1hZnRlclwiLCB0aGlzLmxheW91dFJvdy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLWxheW91dFwiLCB0aGlzLmxheW91dC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbnMtbG9hZGluZ1wiLCB0aGlzLnJlc2V0LmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWFkZFwiLCB0aGlzLnJlaW5pdGlhbGl6ZUNvbHVtbnMuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tZGVsZXRlZFwiLCB0aGlzLnJlaW5pdGlhbGl6ZUNvbHVtbnMuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4taGlkZVwiLCB0aGlzLnJlaW5pdGlhbGl6ZUNvbHVtbnMuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tc2hvd1wiLCB0aGlzLnJlaW5pdGlhbGl6ZUNvbHVtbnMuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW5zLWxvYWRlZFwiLCB0aGlzLnJlaW5pdGlhbGl6ZUNvbHVtbnMuYmluZCh0aGlzKSk7XG5cdFx0XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJ0YWJsZS1yZWRyYXdcIiwgdGhpcy5sYXlvdXQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJsYXlvdXQtcmVmcmVzaGluZ1wiLCB0aGlzLmJsb2NrTGF5b3V0LmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwibGF5b3V0LXJlZnJlc2hlZFwiLCB0aGlzLnVuYmxvY2tMYXlvdXQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJzY3JvbGxiYXItdmVydGljYWxcIiwgdGhpcy5hZGp1c3RGb3JTY3JvbGxiYXIuYmluZCh0aGlzKSk7XG5cdH1cblx0XG5cdGJsb2NrTGF5b3V0KCl7XG5cdFx0dGhpcy5ibG9ja2VkID0gdHJ1ZTtcblx0fVxuXHRcblx0dW5ibG9ja0xheW91dCgpe1xuXHRcdHRoaXMuYmxvY2tlZCA9IGZhbHNlO1xuXHR9XG5cdFxuXHRsYXlvdXRDZWxsKGNlbGwpe1xuXHRcdHRoaXMubGF5b3V0RWxlbWVudChjZWxsLmVsZW1lbnQsIGNlbGwuY29sdW1uKTtcblx0fVxuXHRcblx0cmVpbml0aWFsaXplQ29sdW1ucygpe1xuXHRcdHRoaXMucmVzZXQoKTtcblx0XHRcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaCgoY29sdW1uKSA9PiB7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVDb2x1bW4oY29sdW1uKTtcblx0XHR9KTtcblxuXHRcdHRoaXMubGF5b3V0KCk7XG5cdH1cblx0XG5cdC8vaW5pdGlhbGl6ZSBzcGVjaWZpYyBjb2x1bW5cblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdHZhciBjb25maWcgPSB7bWFyZ2luOjAsIGVkZ2U6ZmFsc2V9O1xuXHRcdFxuXHRcdGlmKCFjb2x1bW4uaXNHcm91cCl7XHRcdFx0XG5cdFx0XHRpZih0aGlzLmZyb3plbkNoZWNrKGNvbHVtbikpe1xuXHRcdFx0XHRjb25maWcucG9zaXRpb24gPSB0aGlzLmluaXRpYWxpemF0aW9uTW9kZTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMuaW5pdGlhbGl6YXRpb25Nb2RlID09IFwibGVmdFwiKXtcblx0XHRcdFx0XHR0aGlzLmxlZnRDb2x1bW5zLnB1c2goY29sdW1uKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHRoaXMucmlnaHRDb2x1bW5zLnVuc2hpZnQoY29sdW1uKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5hY3RpdmUgPSB0cnVlO1xuXHRcdFx0XHRcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuID0gY29uZmlnO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmluaXRpYWxpemF0aW9uTW9kZSA9IFwicmlnaHRcIjtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGZyb3plbkNoZWNrKGNvbHVtbil7XG5cdFx0aWYoY29sdW1uLnBhcmVudC5pc0dyb3VwICYmIGNvbHVtbi5kZWZpbml0aW9uLmZyb3plbil7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJGcm96ZW4gQ29sdW1uIEVycm9yIC0gUGFyZW50IGNvbHVtbiBncm91cCBtdXN0IGJlIGZyb3plbiwgbm90IGluZGl2aWR1YWwgY29sdW1ucyBvciBzdWIgY29sdW1uIGdyb3Vwc1wiKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoY29sdW1uLnBhcmVudC5pc0dyb3VwKXtcblx0XHRcdHJldHVybiB0aGlzLmZyb3plbkNoZWNrKGNvbHVtbi5wYXJlbnQpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiBjb2x1bW4uZGVmaW5pdGlvbi5mcm96ZW47XG5cdFx0fVxuXHR9XG5cdFxuXHQvL2xheW91dCBjYWxjdWxhdGlvbiByb3dzXG5cdGxheW91dENhbGNSb3dzKCl7XG5cdFx0aWYodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSl7XG5cdFx0XHRpZih0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MudG9wSW5pdGlhbGl6ZWQgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnRvcFJvdyl7XG5cdFx0XHRcdHRoaXMubGF5b3V0Um93KHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy50b3BSb3cpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuYm90SW5pdGlhbGl6ZWQgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmJvdFJvdyl7XG5cdFx0XHRcdHRoaXMubGF5b3V0Um93KHRoaXMudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5ib3RSb3cpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImdyb3VwUm93c1wiKSl7XG5cdFx0XHRcdHRoaXMubGF5b3V0R3JvdXBDYWxjcyh0aGlzLnRhYmxlLm1vZHVsZXMuZ3JvdXBSb3dzLmdldEdyb3VwcygpKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGxheW91dEdyb3VwQ2FsY3MoZ3JvdXBzKXtcblx0XHRncm91cHMuZm9yRWFjaCgoZ3JvdXApID0+IHtcblx0XHRcdGlmKGdyb3VwLmNhbGNzLnRvcCl7XG5cdFx0XHRcdHRoaXMubGF5b3V0Um93KGdyb3VwLmNhbGNzLnRvcCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKGdyb3VwLmNhbGNzLmJvdHRvbSl7XG5cdFx0XHRcdHRoaXMubGF5b3V0Um93KGdyb3VwLmNhbGNzLmJvdHRvbSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKGdyb3VwLmdyb3VwTGlzdCAmJiBncm91cC5ncm91cExpc3QubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy5sYXlvdXRHcm91cENhbGNzKGdyb3VwLmdyb3VwTGlzdCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0XG5cdC8vY2FsY3VsYXRlIGNvbHVtbiBwb3NpdGlvbnMgYW5kIGxheW91dCBoZWFkZXJzXG5cdGxheW91dENvbHVtblBvc2l0aW9uKGFsbENlbGxzKXtcblx0XHR2YXIgbGVmdFBhcmVudHMgPSBbXTtcblx0XHRcblx0XHR2YXIgbGVmdE1hcmdpbiA9IDA7XG5cdFx0dmFyIHJpZ2h0TWFyZ2luID0gMDtcblx0XHRcblx0XHR0aGlzLmxlZnRDb2x1bW5zLmZvckVhY2goKGNvbHVtbiwgaSkgPT4ge1x0XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5mcm96ZW4ubWFyZ2luVmFsdWUgPSBsZWZ0TWFyZ2luO1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLm1hcmdpbiA9IGNvbHVtbi5tb2R1bGVzLmZyb3plbi5tYXJnaW5WYWx1ZSArIFwicHhcIjtcblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uLnZpc2libGUpe1xuXHRcdFx0XHRsZWZ0TWFyZ2luICs9IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihpID09IHRoaXMubGVmdENvbHVtbnMubGVuZ3RoIC0gMSl7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZyb3plbi5lZGdlID0gdHJ1ZTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLmVkZ2UgPSBmYWxzZTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uLnBhcmVudC5pc0dyb3VwKXtcblx0XHRcdFx0dmFyIHBhcmVudEVsID0gdGhpcy5nZXRDb2xHcm91cFBhcmVudEVsZW1lbnQoY29sdW1uKTtcblx0XHRcdFx0aWYoIWxlZnRQYXJlbnRzLmluY2x1ZGVzKHBhcmVudEVsKSl7XG5cdFx0XHRcdFx0dGhpcy5sYXlvdXRFbGVtZW50KHBhcmVudEVsLCBjb2x1bW4pO1xuXHRcdFx0XHRcdGxlZnRQYXJlbnRzLnB1c2gocGFyZW50RWwpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRwYXJlbnRFbC5jbGFzc0xpc3QudG9nZ2xlKFwidGFidWxhdG9yLWZyb3plbi1sZWZ0XCIsICBjb2x1bW4ubW9kdWxlcy5mcm96ZW4uZWRnZSAmJiBjb2x1bW4ubW9kdWxlcy5mcm96ZW4ucG9zaXRpb24gPT09IFwibGVmdFwiKTtcblx0XHRcdFx0cGFyZW50RWwuY2xhc3NMaXN0LnRvZ2dsZShcInRhYnVsYXRvci1mcm96ZW4tcmlnaHRcIiwgY29sdW1uLm1vZHVsZXMuZnJvemVuLmVkZ2UgJiYgY29sdW1uLm1vZHVsZXMuZnJvemVuLnBvc2l0aW9uID09PSBcInJpZ2h0XCIpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmxheW91dEVsZW1lbnQoY29sdW1uLmdldEVsZW1lbnQoKSwgY29sdW1uKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoYWxsQ2VsbHMpe1xuXHRcdFx0XHRjb2x1bW4uY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMubGF5b3V0RWxlbWVudChjZWxsLmdldEVsZW1lbnQodHJ1ZSksIGNvbHVtbik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdHRoaXMucmlnaHRDb2x1bW5zLmZvckVhY2goKGNvbHVtbiwgaSkgPT4ge1xuXHRcdFx0XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy5mcm96ZW4ubWFyZ2luVmFsdWUgPSByaWdodE1hcmdpbjtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLmZyb3plbi5tYXJnaW4gPSBjb2x1bW4ubW9kdWxlcy5mcm96ZW4ubWFyZ2luVmFsdWUgKyBcInB4XCI7XG5cdFx0XHRcblx0XHRcdGlmKGNvbHVtbi52aXNpYmxlKXtcblx0XHRcdFx0cmlnaHRNYXJnaW4gKz0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKGkgPT0gdGhpcy5yaWdodENvbHVtbnMubGVuZ3RoIC0gMSl7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLmZyb3plbi5lZGdlID0gdHJ1ZTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Y29sdW1uLm1vZHVsZXMuZnJvemVuLmVkZ2UgPSBmYWxzZTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uLnBhcmVudC5pc0dyb3VwKXtcblx0XHRcdFx0dGhpcy5sYXlvdXRFbGVtZW50KHRoaXMuZ2V0Q29sR3JvdXBQYXJlbnRFbGVtZW50KGNvbHVtbiksIGNvbHVtbik7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMubGF5b3V0RWxlbWVudChjb2x1bW4uZ2V0RWxlbWVudCgpLCBjb2x1bW4pO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihhbGxDZWxscyl7XG5cdFx0XHRcdGNvbHVtbi5jZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5sYXlvdXRFbGVtZW50KGNlbGwuZ2V0RWxlbWVudCh0cnVlKSwgY29sdW1uKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0XG5cdGdldENvbEdyb3VwUGFyZW50RWxlbWVudChjb2x1bW4pe1xuXHRcdHJldHVybiBjb2x1bW4ucGFyZW50LmlzR3JvdXAgPyB0aGlzLmdldENvbEdyb3VwUGFyZW50RWxlbWVudChjb2x1bW4ucGFyZW50KSA6IGNvbHVtbi5nZXRFbGVtZW50KCk7XG5cdH1cblx0XG5cdC8vbGF5b3V0IGNvbHVtbnMgYXBwcm9wcmlhdGVseVxuXHRsYXlvdXQoKXtcdFxuXHRcdGlmKHRoaXMuYWN0aXZlICYmICF0aGlzLmJsb2NrZWQpe1xuXHRcdFx0Ly9jYWxjdWxhdGUgbGVmdCBjb2x1bW5zXG5cdFx0XHR0aGlzLmxheW91dENvbHVtblBvc2l0aW9uKCk7XG5cdFx0XHRcblx0XHRcdHRoaXMucmVpbml0aWFsaXplUm93cygpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmxheW91dENhbGNSb3dzKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRyZWluaXRpYWxpemVSb3dzKCl7XG5cdFx0dmFyIHZpc2libGVSb3dzID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFZpc2libGVSb3dzKHRydWUpO1xuXHRcdHZhciBvdGhlclJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93cygpLmZpbHRlcihyb3cgPT4gIXZpc2libGVSb3dzLmluY2x1ZGVzKHJvdykpO1xuXHRcdFxuXHRcdG90aGVyUm93cy5mb3JFYWNoKChyb3cpID0+e1xuXHRcdFx0cm93LmRlaW5pdGlhbGl6ZSgpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHZpc2libGVSb3dzLmZvckVhY2goKHJvdykgPT57XG5cdFx0XHRpZihyb3cudHlwZSA9PT0gXCJyb3dcIil7XG5cdFx0XHRcdHRoaXMubGF5b3V0Um93KHJvdyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0XG5cdGxheW91dFJvdyhyb3cpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5sYXlvdXQgPT09IFwiZml0RGF0YUZpbGxcIiAmJiB0aGlzLnJpZ2h0Q29sdW1ucy5sZW5ndGgpe1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFRhYmxlRWxlbWVudCgpLnN0eWxlLm1pbldpZHRoID0gXCJjYWxjKDEwMCUgLSBcIiArIHRoaXMucmlnaHRNYXJnaW4gKyBcIilcIjtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5sZWZ0Q29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdHZhciBjZWxsID0gcm93LmdldENlbGwoY29sdW1uKTtcblx0XHRcdFxuXHRcdFx0aWYoY2VsbCl7XG5cdFx0XHRcdHRoaXMubGF5b3V0RWxlbWVudChjZWxsLmdldEVsZW1lbnQodHJ1ZSksIGNvbHVtbik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy5yaWdodENvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG5cdFx0XHR2YXIgY2VsbCA9IHJvdy5nZXRDZWxsKGNvbHVtbik7XG5cdFx0XHRcblx0XHRcdGlmKGNlbGwpe1xuXHRcdFx0XHR0aGlzLmxheW91dEVsZW1lbnQoY2VsbC5nZXRFbGVtZW50KHRydWUpLCBjb2x1bW4pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHRsYXlvdXRFbGVtZW50KGVsZW1lbnQsIGNvbHVtbil7XG5cdFx0dmFyIHBvc2l0aW9uO1xuXHRcdFxuXHRcdGlmKGNvbHVtbi5tb2R1bGVzLmZyb3plbiAmJiBlbGVtZW50KXtcblx0XHRcdGVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSBcInN0aWNreVwiO1xuXG5cdFx0XHRpZih0aGlzLnRhYmxlLnJ0bCl7XG5cdFx0XHRcdHBvc2l0aW9uID0gY29sdW1uLm1vZHVsZXMuZnJvemVuLnBvc2l0aW9uID09PSBcImxlZnRcIiA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRwb3NpdGlvbiA9IGNvbHVtbi5tb2R1bGVzLmZyb3plbi5wb3NpdGlvbjtcblx0XHRcdH1cblx0XHRcblx0XHRcdGVsZW1lbnQuc3R5bGVbcG9zaXRpb25dID0gY29sdW1uLm1vZHVsZXMuZnJvemVuLm1hcmdpbjtcblxuXHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWZyb3plblwiKTtcblx0XHRcdFxuXHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKFwidGFidWxhdG9yLWZyb3plbi1sZWZ0XCIsICBjb2x1bW4ubW9kdWxlcy5mcm96ZW4uZWRnZSAmJiBjb2x1bW4ubW9kdWxlcy5mcm96ZW4ucG9zaXRpb24gPT09IFwibGVmdFwiKTtcblx0XHRcdGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZShcInRhYnVsYXRvci1mcm96ZW4tcmlnaHRcIiwgY29sdW1uLm1vZHVsZXMuZnJvemVuLmVkZ2UgJiYgY29sdW1uLm1vZHVsZXMuZnJvemVuLnBvc2l0aW9uID09PSBcInJpZ2h0XCIpO1xuXHRcdH1cblx0fVxuXG5cdGFkanVzdEZvclNjcm9sbGJhcih3aWR0aCl7XG5cdFx0aWYodGhpcy5yaWdodENvbHVtbnMubGVuZ3RoKXtcblx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb250ZW50c0VsZW1lbnQoKS5zdHlsZS53aWR0aCA9IFwiY2FsYygxMDAlIC0gXCIgKyB3aWR0aCArIFwicHgpXCI7XG5cdFx0fVxuXHR9XG5cblx0Z2V0RnJvemVuQ29sdW1ucygpe1xuXHRcdHJldHVybiB0aGlzLmxlZnRDb2x1bW5zLmNvbmNhdCh0aGlzLnJpZ2h0Q29sdW1ucyk7XG5cdH1cblx0XG5cdF9jYWxjU3BhY2UoY29sdW1ucywgaW5kZXgpe1xuXHRcdHZhciB3aWR0aCA9IDA7XG5cdFx0XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleDsgaSsrKXtcblx0XHRcdGlmKGNvbHVtbnNbaV0udmlzaWJsZSl7XG5cdFx0XHRcdHdpZHRoICs9IGNvbHVtbnNbaV0uZ2V0V2lkdGgoKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHdpZHRoO1xuXHR9XG59XG5cbmNsYXNzIEZyb3plblJvd3MgZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcImZyb3plblJvd3NcIjtcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy50b3BFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHR0aGlzLnJvd3MgPSBbXTtcblxuXHRcdC8vcmVnaXN0ZXIgY29tcG9uZW50IGZ1bmN0aW9uc1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcInJvd1wiLCBcImZyZWV6ZVwiLCB0aGlzLmZyZWV6ZVJvdy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJyb3dcIiwgXCJ1bmZyZWV6ZVwiLCB0aGlzLnVuZnJlZXplUm93LmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcInJvd1wiLCBcImlzRnJvemVuXCIsIHRoaXMuaXNSb3dGcm96ZW4uYmluZCh0aGlzKSk7XG5cblx0XHQvL3JlZ2lzdGVyIHRhYmxlIG9wdGlvbnNcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJmcm96ZW5Sb3dzRmllbGRcIiwgXCJpZFwiKTsgLy9maWVsZCB0byBjaG9vc2UgZnJvemVuIHJvd3MgYnlcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJmcm96ZW5Sb3dzXCIsIGZhbHNlKTsgLy9ob2xkZXIgZm9yIGZyb3plbiByb3cgaWRlbnRpZmllcnNcblx0fVxuXG5cdGluaXRpYWxpemUoKXtcblx0XHR2YXJcdGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXHRcdFxuXHRcdHRoaXMucm93cyA9IFtdO1xuXG5cdFx0dGhpcy50b3BFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZnJvemVuLXJvd3MtaG9sZGVyXCIpO1xuXHRcdFxuXHRcdGZyYWdtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJiclwiKSk7XG5cdFx0ZnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy50b3BFbGVtZW50KTtcblxuXHRcdC8vIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5lbGVtZW50LmFwcGVuZCh0aGlzLnRvcEVsZW1lbnQpO1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb250ZW50c0VsZW1lbnQoKS5pbnNlcnRCZWZvcmUoZnJhZ21lbnQsIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5oZWFkZXJzRWxlbWVudC5uZXh0U2libGluZyk7XG5cblx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1kZWxldGluZ1wiLCB0aGlzLmRldGFjaFJvdy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcInJvd3MtdmlzaWJsZVwiLCB0aGlzLnZpc2libGVSb3dzLmJpbmQodGhpcykpO1xuXG5cdFx0dGhpcy5yZWdpc3RlckRpc3BsYXlIYW5kbGVyKHRoaXMuZ2V0Um93cy5iaW5kKHRoaXMpLCAxMCk7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZnJvemVuUm93cyl7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImRhdGEtcHJvY2Vzc2VkXCIsIHRoaXMuaW5pdGlhbGl6ZVJvd3MuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1hZGRlZFwiLCB0aGlzLmluaXRpYWxpemVSb3cuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLXJlZHJhd2luZ1wiLCB0aGlzLnJlc2l6ZUhvbGRlcldpZHRoLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tcmVzaXplZFwiLCB0aGlzLnJlc2l6ZUhvbGRlcldpZHRoLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tc2hvd1wiLCB0aGlzLnJlc2l6ZUhvbGRlcldpZHRoLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4taGlkZVwiLCB0aGlzLnJlc2l6ZUhvbGRlcldpZHRoLmJpbmQodGhpcykpO1xuXHRcdH1cblxuXHRcdHRoaXMucmVzaXplSG9sZGVyV2lkdGgoKTtcblx0fVxuXG5cdHJlc2l6ZUhvbGRlcldpZHRoKCl7XG5cdFx0dGhpcy50b3BFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmhlYWRlcnNFbGVtZW50Lm9mZnNldFdpZHRoICsgXCJweFwiO1xuXHR9XG5cblx0aW5pdGlhbGl6ZVJvd3MoKXtcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93cygpLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0dGhpcy5pbml0aWFsaXplUm93KHJvdyk7XG5cdFx0fSk7XG5cdH1cblxuXHRpbml0aWFsaXplUm93KHJvdyl7XG5cdFx0dmFyIGZyb3plblJvd3MgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZnJvemVuUm93cyxcblx0XHRyb3dUeXBlID0gdHlwZW9mIGZyb3plblJvd3M7XG5cblx0XHRpZihyb3dUeXBlID09PSBcIm51bWJlclwiKXtcblx0XHRcdGlmKHJvdy5nZXRQb3NpdGlvbigpICYmIChyb3cuZ2V0UG9zaXRpb24oKSArIHRoaXMucm93cy5sZW5ndGgpIDw9IGZyb3plblJvd3Mpe1xuXHRcdFx0XHR0aGlzLmZyZWV6ZVJvdyhyb3cpO1xuXHRcdFx0fVxuXHRcdH1lbHNlIGlmKHJvd1R5cGUgPT09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRpZihmcm96ZW5Sb3dzLmNhbGwodGhpcy50YWJsZSwgcm93LmdldENvbXBvbmVudCgpKSl7XG5cdFx0XHRcdHRoaXMuZnJlZXplUm93KHJvdyk7XG5cdFx0XHR9XG5cdFx0fWVsc2UgaWYoQXJyYXkuaXNBcnJheShmcm96ZW5Sb3dzKSl7XG5cdFx0XHRpZihmcm96ZW5Sb3dzLmluY2x1ZGVzKHJvdy5kYXRhW3RoaXMub3B0aW9ucyhcImZyb3plblJvd3NGaWVsZFwiKV0pKXtcblx0XHRcdFx0dGhpcy5mcmVlemVSb3cocm93KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRpc1Jvd0Zyb3plbihyb3cpe1xuXHRcdHZhciBpbmRleCA9IHRoaXMucm93cy5pbmRleE9mKHJvdyk7XG5cdFx0cmV0dXJuIGluZGV4ID4gLTE7XG5cdH1cblxuXHRpc0Zyb3plbigpe1xuXHRcdHJldHVybiAhIXRoaXMucm93cy5sZW5ndGg7XG5cdH1cblxuXHR2aXNpYmxlUm93cyh2aWV3YWJsZSwgcm93cyl7XG5cdFx0dGhpcy5yb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0cm93cy5wdXNoKHJvdyk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcm93cztcblx0fVxuXG5cdC8vZmlsdGVyIGZyb3plbiByb3dzIG91dCBvZiBkaXNwbGF5IGRhdGFcblx0Z2V0Um93cyhyb3dzKXtcblx0XHR2YXIgb3V0cHV0ID0gcm93cy5zbGljZSgwKTtcblxuXHRcdHRoaXMucm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHR2YXIgaW5kZXggPSBvdXRwdXQuaW5kZXhPZihyb3cpO1xuXG5cdFx0XHRpZihpbmRleCA+IC0xKXtcblx0XHRcdFx0b3V0cHV0LnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cblx0ZnJlZXplUm93KHJvdyl7XG5cdFx0aWYoIXJvdy5tb2R1bGVzLmZyb3plbil7XG5cdFx0XHRyb3cubW9kdWxlcy5mcm96ZW4gPSB0cnVlO1xuXHRcdFx0dGhpcy50b3BFbGVtZW50LmFwcGVuZENoaWxkKHJvdy5nZXRFbGVtZW50KCkpO1xuXHRcdFx0cm93LmluaXRpYWxpemUoKTtcblx0XHRcdHJvdy5ub3JtYWxpemVIZWlnaHQoKTtcblx0XHRcblx0XHRcdHRoaXMucm93cy5wdXNoKHJvdyk7XG5cblx0XHRcdHRoaXMucmVmcmVzaERhdGEoZmFsc2UsIFwiZGlzcGxheVwiKTtcblxuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkanVzdFRhYmxlU2l6ZSgpO1xuXG5cdFx0XHR0aGlzLnN0eWxlUm93cygpO1xuXG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRnJlZXplIEVycm9yIC0gUm93IGlzIGFscmVhZHkgZnJvemVuXCIpO1xuXHRcdH1cblx0fVxuXG5cdHVuZnJlZXplUm93KHJvdyl7XG5cdFx0aWYocm93Lm1vZHVsZXMuZnJvemVuKXtcblxuXHRcdFx0cm93Lm1vZHVsZXMuZnJvemVuID0gZmFsc2U7XG5cblx0XHRcdHRoaXMuZGV0YWNoUm93KHJvdyk7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblxuXHRcdFx0dGhpcy5yZWZyZXNoRGF0YShmYWxzZSwgXCJkaXNwbGF5XCIpO1xuXG5cdFx0XHRpZih0aGlzLnJvd3MubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy5zdHlsZVJvd3MoKTtcblx0XHRcdH1cblxuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkZyZWV6ZSBFcnJvciAtIFJvdyBpcyBhbHJlYWR5IHVuZnJvemVuXCIpO1xuXHRcdH1cblx0fVxuXG5cdGRldGFjaFJvdyhyb3cpe1xuXHRcdHZhciBpbmRleCA9IHRoaXMucm93cy5pbmRleE9mKHJvdyk7XG5cblx0XHRpZihpbmRleCA+IC0xKXtcblx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cblx0XHRcdGlmKHJvd0VsLnBhcmVudE5vZGUpe1xuXHRcdFx0XHRyb3dFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd0VsKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5yb3dzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0fVxuXHR9XG5cblx0c3R5bGVSb3dzKHJvdyl7XG5cdFx0dGhpcy5yb3dzLmZvckVhY2goKHJvdywgaSkgPT4ge1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnN0eWxlUm93KHJvdywgaSk7XG5cdFx0fSk7XG5cdH1cbn1cblxuLy9wdWJsaWMgZ3JvdXAgb2JqZWN0XG5jbGFzcyBHcm91cENvbXBvbmVudCB7XG5cdGNvbnN0cnVjdG9yIChncm91cCl7XG5cdFx0dGhpcy5fZ3JvdXAgPSBncm91cDtcblx0XHR0aGlzLnR5cGUgPSBcIkdyb3VwQ29tcG9uZW50XCI7XG5cblx0XHRyZXR1cm4gbmV3IFByb3h5KHRoaXMsIHtcblx0XHRcdGdldDogZnVuY3Rpb24odGFyZ2V0LCBuYW1lLCByZWNlaXZlcikge1xuXHRcdFx0XHRpZiAodHlwZW9mIHRhcmdldFtuYW1lXSAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHRcdFx0XHRcdHJldHVybiB0YXJnZXRbbmFtZV07XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gdGFyZ2V0Ll9ncm91cC5ncm91cE1hbmFnZXIudGFibGUuY29tcG9uZW50RnVuY3Rpb25CaW5kZXIuaGFuZGxlKFwiZ3JvdXBcIiwgdGFyZ2V0Ll9ncm91cCwgbmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdGdldEtleSgpe1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5rZXk7XG5cdH1cblxuXHRnZXRGaWVsZCgpe1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5maWVsZDtcblx0fVxuXG5cdGdldEVsZW1lbnQoKXtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAuZWxlbWVudDtcblx0fVxuXG5cdGdldFJvd3MoKXtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAuZ2V0Um93cyh0cnVlKTtcblx0fVxuXG5cdGdldFN1Ykdyb3Vwcygpe1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5nZXRTdWJHcm91cHModHJ1ZSk7XG5cdH1cblxuXHRnZXRQYXJlbnRHcm91cCgpe1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5wYXJlbnQgPyB0aGlzLl9ncm91cC5wYXJlbnQuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fVxuXG5cdGlzVmlzaWJsZSgpe1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC52aXNpYmxlO1xuXHR9XG5cblx0c2hvdygpe1xuXHRcdHRoaXMuX2dyb3VwLnNob3coKTtcblx0fVxuXG5cdGhpZGUoKXtcblx0XHR0aGlzLl9ncm91cC5oaWRlKCk7XG5cdH1cblxuXHR0b2dnbGUoKXtcblx0XHR0aGlzLl9ncm91cC50b2dnbGVWaXNpYmlsaXR5KCk7XG5cdH1cblxuXHRzY3JvbGxUbyhwb3NpdGlvbiwgaWZWaXNpYmxlKXtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXAuZ3JvdXBNYW5hZ2VyLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsVG9Sb3codGhpcy5fZ3JvdXAsIHBvc2l0aW9uLCBpZlZpc2libGUpO1xuXHR9XG5cblx0X2dldFNlbGYoKXtcblx0XHRyZXR1cm4gdGhpcy5fZ3JvdXA7XG5cdH1cblxuXHRnZXRUYWJsZSgpe1xuXHRcdHJldHVybiB0aGlzLl9ncm91cC5ncm91cE1hbmFnZXIudGFibGU7XG5cdH1cbn1cblxuLy9Hcm91cCBmdW5jdGlvbnNcbmNsYXNzIEdyb3Vwe1xuXHRcblx0Y29uc3RydWN0b3IoZ3JvdXBNYW5hZ2VyLCBwYXJlbnQsIGxldmVsLCBrZXksIGZpZWxkLCBnZW5lcmF0b3IsIG9sZEdyb3VwKXtcblx0XHR0aGlzLmdyb3VwTWFuYWdlciA9IGdyb3VwTWFuYWdlcjtcblx0XHR0aGlzLnBhcmVudCA9IHBhcmVudDtcblx0XHR0aGlzLmtleSA9IGtleTtcblx0XHR0aGlzLmxldmVsID0gbGV2ZWw7XG5cdFx0dGhpcy5maWVsZCA9IGZpZWxkO1xuXHRcdHRoaXMuaGFzU3ViR3JvdXBzID0gbGV2ZWwgPCAoZ3JvdXBNYW5hZ2VyLmdyb3VwSURMb29rdXBzLmxlbmd0aCAtIDEpO1xuXHRcdHRoaXMuYWRkUm93ID0gdGhpcy5oYXNTdWJHcm91cHMgPyB0aGlzLl9hZGRSb3dUb0dyb3VwIDogdGhpcy5fYWRkUm93O1xuXHRcdHRoaXMudHlwZSA9IFwiZ3JvdXBcIjsgLy90eXBlIG9mIGVsZW1lbnRcblx0XHR0aGlzLm9sZCA9IG9sZEdyb3VwO1xuXHRcdHRoaXMucm93cyA9IFtdO1xuXHRcdHRoaXMuZ3JvdXBzID0gW107XG5cdFx0dGhpcy5ncm91cExpc3QgPSBbXTtcblx0XHR0aGlzLmdlbmVyYXRvciA9IGdlbmVyYXRvcjtcblx0XHR0aGlzLmVsZW1lbnQgPSBmYWxzZTtcblx0XHR0aGlzLmVsZW1lbnRDb250ZW50cyA9IGZhbHNlO1xuXHRcdHRoaXMuaGVpZ2h0ID0gMDtcblx0XHR0aGlzLm91dGVySGVpZ2h0ID0gMDtcblx0XHR0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0dGhpcy5jYWxjcyA9IHt9O1xuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLm1vZHVsZXMgPSB7fTtcblx0XHR0aGlzLmFycm93RWxlbWVudCA9IGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMudmlzaWJsZSA9IG9sZEdyb3VwID8gb2xkR3JvdXAudmlzaWJsZSA6ICh0eXBlb2YgZ3JvdXBNYW5hZ2VyLnN0YXJ0T3BlbltsZXZlbF0gIT09IFwidW5kZWZpbmVkXCIgPyBncm91cE1hbmFnZXIuc3RhcnRPcGVuW2xldmVsXSA6IGdyb3VwTWFuYWdlci5zdGFydE9wZW5bMF0pO1xuXHRcdFxuXHRcdHRoaXMuY29tcG9uZW50ID0gbnVsbDtcblx0XHRcblx0XHR0aGlzLmNyZWF0ZUVsZW1lbnRzKCk7XG5cdFx0dGhpcy5hZGRCaW5kaW5ncygpO1xuXHRcdFxuXHRcdHRoaXMuY3JlYXRlVmFsdWVHcm91cHMoKTtcblx0fVxuXHRcblx0d2lwZShlbGVtZW50c09ubHkpe1xuXHRcdGlmKCFlbGVtZW50c09ubHkpe1xuXHRcdFx0aWYodGhpcy5ncm91cExpc3QubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaChmdW5jdGlvbihncm91cCl7XG5cdFx0XHRcdFx0Z3JvdXAud2lwZSgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5yb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0XHRcdGlmKHJvdy5tb2R1bGVzKXtcblx0XHRcdFx0XHRcdGRlbGV0ZSByb3cubW9kdWxlcy5ncm91cDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHR0aGlzLmVsZW1lbnQgPSBmYWxzZTtcblx0XHR0aGlzLmFycm93RWxlbWVudCA9IGZhbHNlO1xuXHRcdHRoaXMuZWxlbWVudENvbnRlbnRzID0gZmFsc2U7XG5cdH1cblx0XG5cdGNyZWF0ZUVsZW1lbnRzKCl7XG5cdFx0dmFyIGFycm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRhcnJvdy5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWFycm93XCIpO1xuXHRcdFxuXHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93XCIpO1xuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWdyb3VwXCIpO1xuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWdyb3VwLWxldmVsLVwiICsgdGhpcy5sZXZlbCk7XG5cdFx0dGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJyb3dncm91cFwiKTtcblx0XHRcblx0XHR0aGlzLmFycm93RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5hcnJvd0VsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1ncm91cC10b2dnbGVcIik7XG5cdFx0dGhpcy5hcnJvd0VsZW1lbnQuYXBwZW5kQ2hpbGQoYXJyb3cpO1xuXHRcdFxuXHRcdC8vc2V0dXAgbW92YWJsZSByb3dzXG5cdFx0aWYodGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93cyAhPT0gZmFsc2UgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kRXhpc3RzKFwibW92ZVJvd1wiKSl7XG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLm1vdmVSb3cuaW5pdGlhbGl6ZUdyb3VwSGVhZGVyKHRoaXMpO1xuXHRcdH1cblx0fVxuXHRcblx0Y3JlYXRlVmFsdWVHcm91cHMoKXtcblx0XHR2YXIgbGV2ZWwgPSB0aGlzLmxldmVsICsgMTtcblx0XHRpZih0aGlzLmdyb3VwTWFuYWdlci5hbGxvd2VkVmFsdWVzICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLmFsbG93ZWRWYWx1ZXNbbGV2ZWxdKXtcblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLmFsbG93ZWRWYWx1ZXNbbGV2ZWxdLmZvckVhY2goKHZhbHVlKSA9PiB7XG5cdFx0XHRcdHRoaXMuX2NyZWF0ZUdyb3VwKHZhbHVlLCBsZXZlbCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblx0XG5cdGFkZEJpbmRpbmdzKCl7XG5cdFx0dmFyIHRvZ2dsZUVsZW1lbnQ7XG5cdFx0XG5cdFx0aWYodGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cFRvZ2dsZUVsZW1lbnQpe1xuXHRcdFx0dG9nZ2xlRWxlbWVudCA9IHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuZ3JvdXBUb2dnbGVFbGVtZW50ID09IFwiYXJyb3dcIiA/IHRoaXMuYXJyb3dFbGVtZW50IDogdGhpcy5lbGVtZW50O1xuXHRcdFx0XG5cdFx0XHR0b2dnbGVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuXHRcdFx0XHRpZih0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwVG9nZ2xlRWxlbWVudCA9PT0gXCJhcnJvd1wiKXtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL2FsbG93IGNsaWNrIGV2ZW50IHRvIHByb3BhZ2F0ZSBiZWZvcmUgdG9nZ2xpbmcgdmlzaWJpbGl0eVxuXHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHR0aGlzLnRvZ2dsZVZpc2liaWxpdHkoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblx0XG5cdF9jcmVhdGVHcm91cChncm91cElELCBsZXZlbCl7XG5cdFx0dmFyIGdyb3VwS2V5ID0gbGV2ZWwgKyBcIl9cIiArIGdyb3VwSUQ7XG5cdFx0dmFyIGdyb3VwID0gbmV3IEdyb3VwKHRoaXMuZ3JvdXBNYW5hZ2VyLCB0aGlzLCBsZXZlbCwgZ3JvdXBJRCwgIHRoaXMuZ3JvdXBNYW5hZ2VyLmdyb3VwSURMb29rdXBzW2xldmVsXS5maWVsZCwgdGhpcy5ncm91cE1hbmFnZXIuaGVhZGVyR2VuZXJhdG9yW2xldmVsXSB8fCB0aGlzLmdyb3VwTWFuYWdlci5oZWFkZXJHZW5lcmF0b3JbMF0sIHRoaXMub2xkID8gdGhpcy5vbGQuZ3JvdXBzW2dyb3VwS2V5XSA6IGZhbHNlKTtcblx0XHRcblx0XHR0aGlzLmdyb3Vwc1tncm91cEtleV0gPSBncm91cDtcblx0XHR0aGlzLmdyb3VwTGlzdC5wdXNoKGdyb3VwKTtcblx0fVxuXHRcblx0X2FkZFJvd1RvR3JvdXAocm93KXtcblx0XHRcblx0XHR2YXIgbGV2ZWwgPSB0aGlzLmxldmVsICsgMTtcblx0XHRcblx0XHRpZih0aGlzLmhhc1N1Ykdyb3Vwcyl7XG5cdFx0XHR2YXIgZ3JvdXBJRCA9IHRoaXMuZ3JvdXBNYW5hZ2VyLmdyb3VwSURMb29rdXBzW2xldmVsXS5mdW5jKHJvdy5nZXREYXRhKCkpLFxuXHRcdFx0Z3JvdXBLZXkgPSBsZXZlbCArIFwiX1wiICsgZ3JvdXBJRDtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5ncm91cE1hbmFnZXIuYWxsb3dlZFZhbHVlcyAmJiB0aGlzLmdyb3VwTWFuYWdlci5hbGxvd2VkVmFsdWVzW2xldmVsXSl7XG5cdFx0XHRcdGlmKHRoaXMuZ3JvdXBzW2dyb3VwS2V5XSl7XG5cdFx0XHRcdFx0dGhpcy5ncm91cHNbZ3JvdXBLZXldLmFkZFJvdyhyb3cpO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGlmKCF0aGlzLmdyb3Vwc1tncm91cEtleV0pe1xuXHRcdFx0XHRcdHRoaXMuX2NyZWF0ZUdyb3VwKGdyb3VwSUQsIGxldmVsKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5ncm91cHNbZ3JvdXBLZXldLmFkZFJvdyhyb3cpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0X2FkZFJvdyhyb3cpe1xuXHRcdHRoaXMucm93cy5wdXNoKHJvdyk7XG5cdFx0cm93Lm1vZHVsZXMuZ3JvdXAgPSB0aGlzO1xuXHR9XG5cdFxuXHRpbnNlcnRSb3cocm93LCB0bywgYWZ0ZXIpe1xuXHRcdHZhciBkYXRhID0gdGhpcy5jb25mb3JtUm93RGF0YSh7fSk7XG5cdFx0XG5cdFx0cm93LnVwZGF0ZURhdGEoZGF0YSk7XG5cdFx0XG5cdFx0dmFyIHRvSW5kZXggPSB0aGlzLnJvd3MuaW5kZXhPZih0byk7XG5cdFx0XG5cdFx0aWYodG9JbmRleCA+IC0xKXtcblx0XHRcdGlmKGFmdGVyKXtcblx0XHRcdFx0dGhpcy5yb3dzLnNwbGljZSh0b0luZGV4KzEsIDAsIHJvdyk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMucm93cy5zcGxpY2UodG9JbmRleCwgMCwgcm93KTtcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRpZihhZnRlcil7XG5cdFx0XHRcdHRoaXMucm93cy5wdXNoKHJvdyk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMucm93cy51bnNoaWZ0KHJvdyk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHJvdy5tb2R1bGVzLmdyb3VwID0gdGhpcztcblx0XHRcblx0XHQvLyB0aGlzLmdlbmVyYXRlR3JvdXBIZWFkZXJDb250ZW50cygpO1xuXHRcdFxuXHRcdGlmKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJ0YWJsZVwiKXtcblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjR3JvdXAodGhpcyk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnVwZGF0ZUdyb3VwUm93cyh0cnVlKTtcblx0fVxuXHRcblx0c2Nyb2xsSGVhZGVyKGxlZnQpe1xuXHRcdGlmKHRoaXMuYXJyb3dFbGVtZW50KXtcblx0XHRcdHRoaXMuYXJyb3dFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBsZWZ0O1xuXHRcdFx0XG5cdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGNoaWxkKXtcblx0XHRcdFx0Y2hpbGQuc2Nyb2xsSGVhZGVyKGxlZnQpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRnZXRSb3dJbmRleChyb3cpe31cblx0XG5cdC8vdXBkYXRlIHJvdyBkYXRhIHRvIG1hdGNoIGdyb3VwaW5nIGNvbnN0cmFpbnRzXG5cdGNvbmZvcm1Sb3dEYXRhKGRhdGEpe1xuXHRcdGlmKHRoaXMuZmllbGQpe1xuXHRcdFx0ZGF0YVt0aGlzLmZpZWxkXSA9IHRoaXMua2V5O1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkRhdGEgQ29uZm9ybWluZyBFcnJvciAtIENhbm5vdCBjb25mb3JtIHJvdyBkYXRhIHRvIG1hdGNoIG5ldyBncm91cCBhcyBncm91cEJ5IGlzIGEgZnVuY3Rpb25cIik7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMucGFyZW50KXtcblx0XHRcdGRhdGEgPSB0aGlzLnBhcmVudC5jb25mb3JtUm93RGF0YShkYXRhKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGRhdGE7XG5cdH1cblx0XG5cdHJlbW92ZVJvdyhyb3cpe1xuXHRcdHZhciBpbmRleCA9IHRoaXMucm93cy5pbmRleE9mKHJvdyk7XG5cdFx0dmFyIGVsID0gcm93LmdldEVsZW1lbnQoKTtcblx0XHRcblx0XHRpZihpbmRleCA+IC0xKXtcblx0XHRcdHRoaXMucm93cy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdH1cblx0XHRcblx0XHRpZighdGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cFZhbHVlcyAmJiAhdGhpcy5yb3dzLmxlbmd0aCl7XG5cdFx0XHRpZih0aGlzLnBhcmVudCl7XG5cdFx0XHRcdHRoaXMucGFyZW50LnJlbW92ZUdyb3VwKHRoaXMpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmdyb3VwTWFuYWdlci5yZW1vdmVHcm91cCh0aGlzKTtcblx0XHRcdH1cdFx0XG5cdFx0XHRcblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnVwZGF0ZUdyb3VwUm93cyh0cnVlKTtcblx0XHRcdFxuXHRcdH1lbHNlIHtcblx0XHRcdFxuXHRcdFx0aWYoZWwucGFyZW50Tm9kZSl7XG5cdFx0XHRcdGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZighdGhpcy5ncm91cE1hbmFnZXIuYmxvY2tSZWRyYXcpe1xuXHRcdFx0XHR0aGlzLmdlbmVyYXRlR3JvdXBIZWFkZXJDb250ZW50cygpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYodGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcInRhYmxlXCIpe1xuXHRcdFx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVjYWxjR3JvdXAodGhpcyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdH1cblx0fVxuXHRcblx0cmVtb3ZlR3JvdXAoZ3JvdXApe1xuXHRcdHZhciBncm91cEtleSA9IGdyb3VwLmxldmVsICsgXCJfXCIgKyBncm91cC5rZXksXG5cdFx0aW5kZXg7XG5cdFx0XG5cdFx0aWYodGhpcy5ncm91cHNbZ3JvdXBLZXldKXtcblx0XHRcdGRlbGV0ZSB0aGlzLmdyb3Vwc1tncm91cEtleV07XG5cdFx0XHRcblx0XHRcdGluZGV4ID0gdGhpcy5ncm91cExpc3QuaW5kZXhPZihncm91cCk7XG5cdFx0XHRcblx0XHRcdGlmKGluZGV4ID4gLTEpe1xuXHRcdFx0XHR0aGlzLmdyb3VwTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZighdGhpcy5ncm91cExpc3QubGVuZ3RoKXtcblx0XHRcdFx0aWYodGhpcy5wYXJlbnQpe1xuXHRcdFx0XHRcdHRoaXMucGFyZW50LnJlbW92ZUdyb3VwKHRoaXMpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5ncm91cE1hbmFnZXIucmVtb3ZlR3JvdXAodGhpcyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGdldEhlYWRlcnNBbmRSb3dzKCl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXHRcdFxuXHRcdG91dHB1dC5wdXNoKHRoaXMpO1xuXHRcdFxuXHRcdHRoaXMuX3Zpc1NldCgpO1xuXHRcdFxuXHRcdFxuXHRcdGlmKHRoaXMuY2FsY3MudG9wKXtcblx0XHRcdHRoaXMuY2FsY3MudG9wLmRldGFjaEVsZW1lbnQoKTtcblx0XHRcdHRoaXMuY2FsY3MudG9wLmRlbGV0ZUNlbGxzKCk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMuY2FsY3MuYm90dG9tKXtcblx0XHRcdHRoaXMuY2FsY3MuYm90dG9tLmRldGFjaEVsZW1lbnQoKTtcblx0XHRcdHRoaXMuY2FsY3MuYm90dG9tLmRlbGV0ZUNlbGxzKCk7XG5cdFx0fVxuXHRcdFxuXHRcdFxuXHRcdFxuXHRcdGlmKHRoaXMudmlzaWJsZSl7XG5cdFx0XHRpZih0aGlzLmdyb3VwTGlzdC5sZW5ndGgpe1xuXHRcdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGdyb3VwKXtcblx0XHRcdFx0XHRvdXRwdXQgPSBvdXRwdXQuY29uY2F0KGdyb3VwLmdldEhlYWRlcnNBbmRSb3dzKCkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGlmKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJ0YWJsZVwiICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaGFzVG9wQ2FsY3MoKSl7XG5cdFx0XHRcdFx0dGhpcy5jYWxjcy50b3AgPSB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmdlbmVyYXRlVG9wUm93KHRoaXMucm93cyk7XG5cdFx0XHRcdFx0b3V0cHV0LnB1c2godGhpcy5jYWxjcy50b3ApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRvdXRwdXQgPSBvdXRwdXQuY29uY2F0KHRoaXMucm93cyk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwidGFibGVcIiAmJiAgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kRXhpc3RzKFwiY29sdW1uQ2FsY3NcIikgJiYgdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5oYXNCb3R0b21DYWxjcygpKXtcblx0XHRcdFx0XHR0aGlzLmNhbGNzLmJvdHRvbSA9IHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuZ2VuZXJhdGVCb3R0b21Sb3codGhpcy5yb3dzKTtcblx0XHRcdFx0XHRvdXRwdXQucHVzaCh0aGlzLmNhbGNzLmJvdHRvbSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRpZighdGhpcy5ncm91cExpc3QubGVuZ3RoICYmIHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgIT0gXCJ0YWJsZVwiKXtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpKXtcblx0XHRcdFx0XHRpZih0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmhhc1RvcENhbGNzKCkpe1xuXHRcdFx0XHRcdFx0aWYodGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5ncm91cENsb3NlZFNob3dDYWxjcyl7XG5cdFx0XHRcdFx0XHRcdHRoaXMuY2FsY3MudG9wID0gdGhpcy5ncm91cE1hbmFnZXIudGFibGUubW9kdWxlcy5jb2x1bW5DYWxjcy5nZW5lcmF0ZVRvcFJvdyh0aGlzLnJvd3MpO1xuXHRcdFx0XHRcdFx0XHRvdXRwdXQucHVzaCh0aGlzLmNhbGNzLnRvcCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaGFzQm90dG9tQ2FsY3MoKSl7XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZih0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5vcHRpb25zLmdyb3VwQ2xvc2VkU2hvd0NhbGNzKXtcblx0XHRcdFx0XHRcdFx0dGhpcy5jYWxjcy5ib3R0b20gPSB0aGlzLmdyb3VwTWFuYWdlci50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmdlbmVyYXRlQm90dG9tUm93KHRoaXMucm93cyk7XG5cdFx0XHRcdFx0XHRcdG91dHB1dC5wdXNoKHRoaXMuY2FsY3MuYm90dG9tKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHRnZXREYXRhKHZpc2libGUsIHRyYW5zZm9ybSl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXHRcdFxuXHRcdHRoaXMuX3Zpc1NldCgpO1xuXHRcdFxuXHRcdGlmKCF2aXNpYmxlIHx8ICh2aXNpYmxlICYmIHRoaXMudmlzaWJsZSkpe1xuXHRcdFx0dGhpcy5yb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0XHRvdXRwdXQucHVzaChyb3cuZ2V0RGF0YSh0cmFuc2Zvcm0gfHwgXCJkYXRhXCIpKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHRnZXRSb3dDb3VudCgpe1xuXHRcdHZhciBjb3VudCA9IDA7XG5cdFx0XG5cdFx0aWYodGhpcy5ncm91cExpc3QubGVuZ3RoKXtcblx0XHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goKGdyb3VwKSA9PiB7XG5cdFx0XHRcdGNvdW50ICs9IGdyb3VwLmdldFJvd0NvdW50KCk7XG5cdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb3VudCA9IHRoaXMucm93cy5sZW5ndGg7XG5cdFx0fVxuXHRcdHJldHVybiBjb3VudDtcblx0fVxuXG5cdFxuXHR0b2dnbGVWaXNpYmlsaXR5KCl7XG5cdFx0aWYodGhpcy52aXNpYmxlKXtcblx0XHRcdHRoaXMuaGlkZSgpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuc2hvdygpO1xuXHRcdH1cblx0fVxuXHRcblx0aGlkZSgpe1xuXHRcdHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuXHRcdFxuXHRcdGlmKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLnJvd01hbmFnZXIuZ2V0UmVuZGVyTW9kZSgpID09IFwiYmFzaWNcIiAmJiAhdGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uKXtcblx0XHRcdFxuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItZ3JvdXAtdmlzaWJsZVwiKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5ncm91cExpc3QubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaCgoZ3JvdXApID0+IHtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR2YXIgcm93cyA9IGdyb3VwLmdldEhlYWRlcnNBbmRSb3dzKCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0XHRcdHJvdy5kZXRhY2hFbGVtZW50KCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5yb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3dFbCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci51cGRhdGVHcm91cFJvd3ModHJ1ZSk7XG5cdFx0XHRcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci51cGRhdGVHcm91cFJvd3ModHJ1ZSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLmV4dGVybmFsRXZlbnRzLmRpc3BhdGNoKFwiZ3JvdXBWaXNpYmlsaXR5Q2hhbmdlZFwiLCB0aGlzLmdldENvbXBvbmVudCgpLCBmYWxzZSk7XG5cdH1cblx0XG5cdHNob3coKXtcblx0XHR0aGlzLnZpc2libGUgPSB0cnVlO1xuXHRcdFxuXHRcdGlmKHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLnJvd01hbmFnZXIuZ2V0UmVuZGVyTW9kZSgpID09IFwiYmFzaWNcIiAmJiAhdGhpcy5ncm91cE1hbmFnZXIudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uKXtcblx0XHRcdFxuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXAtdmlzaWJsZVwiKTtcblx0XHRcdFxuXHRcdFx0dmFyIHByZXYgPSB0aGlzLmdlbmVyYXRlRWxlbWVudCgpO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLmdyb3VwTGlzdC5sZW5ndGgpe1xuXHRcdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKChncm91cCkgPT4ge1xuXHRcdFx0XHRcdHZhciByb3dzID0gZ3JvdXAuZ2V0SGVhZGVyc0FuZFJvd3MoKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRyb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0XHRcdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblx0XHRcdFx0XHRcdHByZXYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocm93RWwsIHByZXYubmV4dFNpYmxpbmcpO1xuXHRcdFx0XHRcdFx0cm93LmluaXRpYWxpemUoKTtcblx0XHRcdFx0XHRcdHByZXYgPSByb3dFbDtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdFxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLnJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblx0XHRcdFx0XHRwcmV2LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHJvd0VsLCBwcmV2Lm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRyb3cuaW5pdGlhbGl6ZSgpO1xuXHRcdFx0XHRcdHByZXYgPSByb3dFbDtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnVwZGF0ZUdyb3VwUm93cyh0cnVlKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmdyb3VwTWFuYWdlci51cGRhdGVHcm91cFJvd3ModHJ1ZSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuZ3JvdXBNYW5hZ2VyLnRhYmxlLmV4dGVybmFsRXZlbnRzLmRpc3BhdGNoKFwiZ3JvdXBWaXNpYmlsaXR5Q2hhbmdlZFwiLCB0aGlzLmdldENvbXBvbmVudCgpLCB0cnVlKTtcblx0fVxuXHRcblx0X3Zpc1NldCgpe1xuXHRcdHZhciBkYXRhID0gW107XG5cdFx0XG5cdFx0aWYodHlwZW9mIHRoaXMudmlzaWJsZSA9PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0XG5cdFx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpe1xuXHRcdFx0XHRkYXRhLnB1c2gocm93LmdldERhdGEoKSk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy52aXNpYmxlID0gdGhpcy52aXNpYmxlKHRoaXMua2V5LCB0aGlzLmdldFJvd0NvdW50KCksIGRhdGEsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH1cblx0fVxuXHRcblx0Z2V0Um93R3JvdXAocm93KXtcblx0XHR2YXIgbWF0Y2ggPSBmYWxzZTtcblx0XHRpZih0aGlzLmdyb3VwTGlzdC5sZW5ndGgpe1xuXHRcdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaChmdW5jdGlvbihncm91cCl7XG5cdFx0XHRcdHZhciByZXN1bHQgPSBncm91cC5nZXRSb3dHcm91cChyb3cpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYocmVzdWx0KXtcblx0XHRcdFx0XHRtYXRjaCA9IHJlc3VsdDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0aWYodGhpcy5yb3dzLmZpbmQoZnVuY3Rpb24oaXRlbSl7XG5cdFx0XHRcdHJldHVybiBpdGVtID09PSByb3c7XG5cdFx0XHR9KSl7XG5cdFx0XHRcdG1hdGNoID0gdGhpcztcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIG1hdGNoO1xuXHR9XG5cdFxuXHRnZXRTdWJHcm91cHMoY29tcG9uZW50KXtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cdFx0XG5cdFx0dGhpcy5ncm91cExpc3QuZm9yRWFjaChmdW5jdGlvbihjaGlsZCl7XG5cdFx0XHRvdXRwdXQucHVzaChjb21wb25lbnQgPyBjaGlsZC5nZXRDb21wb25lbnQoKSA6IGNoaWxkKTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHRnZXRSb3dzKGNvbXBvbmVudCwgaW5jbHVkZUNoaWxkcmVuKXtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cdFx0XG5cdFx0aWYoaW5jbHVkZUNoaWxkcmVuICYmIHRoaXMuZ3JvdXBMaXN0Lmxlbmd0aCl7XG5cdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKChncm91cCkgPT4ge1xuXHRcdFx0XHRvdXRwdXQgPSBvdXRwdXQuY29uY2F0KGdyb3VwLmdldFJvd3MoY29tcG9uZW50LCBpbmNsdWRlQ2hpbGRyZW4pKTtcblx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMucm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHRcdG91dHB1dC5wdXNoKGNvbXBvbmVudCA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHJvdyk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXHRcblx0Z2VuZXJhdGVHcm91cEhlYWRlckNvbnRlbnRzKCl7XG5cdFx0dmFyIGRhdGEgPSBbXTtcblx0XHRcblx0XHR2YXIgcm93cyA9IHRoaXMuZ2V0Um93cyhmYWxzZSwgdHJ1ZSk7XG5cdFx0XG5cdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHRkYXRhLnB1c2gocm93LmdldERhdGEoKSk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy5lbGVtZW50Q29udGVudHMgPSB0aGlzLmdlbmVyYXRvcih0aGlzLmtleSwgdGhpcy5nZXRSb3dDb3VudCgpLCBkYXRhLCB0aGlzLmdldENvbXBvbmVudCgpKTtcblx0XHRcblx0XHR3aGlsZSh0aGlzLmVsZW1lbnQuZmlyc3RDaGlsZCkgdGhpcy5lbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcblx0XHRpZih0eXBlb2YgdGhpcy5lbGVtZW50Q29udGVudHMgPT09IFwic3RyaW5nXCIpe1xuXHRcdFx0dGhpcy5lbGVtZW50LmlubmVySFRNTCA9IHRoaXMuZWxlbWVudENvbnRlbnRzO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnRDb250ZW50cyk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuZWxlbWVudC5pbnNlcnRCZWZvcmUodGhpcy5hcnJvd0VsZW1lbnQsIHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0fVxuXHRcblx0Z2V0UGF0aChwYXRoID0gW10pIHtcblx0XHRwYXRoLnVuc2hpZnQodGhpcy5rZXkpO1xuXHRcdGlmKHRoaXMucGFyZW50KSB7XG5cdFx0XHR0aGlzLnBhcmVudC5nZXRQYXRoKHBhdGgpO1xuXHRcdH1cblx0XHRyZXR1cm4gcGF0aDtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8gU3RhbmRhcmQgUm93IEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy8vL1xuXHRcblx0Z2V0RWxlbWVudCgpe1xuXHRcdHJldHVybiB0aGlzLmVsZW1lbnRDb250ZW50cyA/IHRoaXMuZWxlbWVudCA6IHRoaXMuZ2VuZXJhdGVFbGVtZW50KCk7XG5cdH1cblx0XG5cdGdlbmVyYXRlRWxlbWVudCgpe1xuXHRcdHRoaXMuYWRkQmluZGluZ3MgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLl92aXNTZXQoKTtcblx0XHRcblx0XHRpZih0aGlzLnZpc2libGUpe1xuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZ3JvdXAtdmlzaWJsZVwiKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1ncm91cC12aXNpYmxlXCIpO1xuXHRcdH1cblx0XHRcblx0XHRmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoOyArK2kpe1xuXHRcdFx0dGhpcy5lbGVtZW50LmNoaWxkTm9kZXNbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQuY2hpbGROb2Rlc1tpXSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuZ2VuZXJhdGVHcm91cEhlYWRlckNvbnRlbnRzKCk7XG5cdFx0XG5cdFx0Ly8gdGhpcy5hZGRCaW5kaW5ncygpO1xuXHRcdFxuXHRcdHJldHVybiB0aGlzLmVsZW1lbnQ7XG5cdH1cblx0XG5cdGRldGFjaEVsZW1lbnQoKXtcblx0XHRpZiAodGhpcy5lbGVtZW50ICYmIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlKXtcblx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL25vcm1hbGl6ZSB0aGUgaGVpZ2h0IG9mIGVsZW1lbnRzIGluIHRoZSByb3dcblx0bm9ybWFsaXplSGVpZ2h0KCl7XG5cdFx0dGhpcy5zZXRIZWlnaHQodGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCk7XG5cdH1cblx0XG5cdGluaXRpYWxpemUoZm9yY2Upe1xuXHRcdGlmKCF0aGlzLmluaXRpYWxpemVkIHx8IGZvcmNlKXtcblx0XHRcdHRoaXMubm9ybWFsaXplSGVpZ2h0KCk7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcblx0XHR9XG5cdH1cblx0XG5cdHJlaW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLmhlaWdodCA9IDA7XG5cdFx0XG5cdFx0aWYoSGVscGVycy5lbFZpc2libGUodGhpcy5lbGVtZW50KSl7XG5cdFx0XHR0aGlzLmluaXRpYWxpemUodHJ1ZSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRzZXRIZWlnaHQoaGVpZ2h0KXtcblx0XHRpZih0aGlzLmhlaWdodCAhPSBoZWlnaHQpe1xuXHRcdFx0dGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG5cdFx0XHR0aGlzLm91dGVySGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDtcblx0XHR9XG5cdH1cblx0XG5cdC8vcmV0dXJuIHJvd3Mgb3V0ZXIgaGVpZ2h0XG5cdGdldEhlaWdodCgpe1xuXHRcdHJldHVybiB0aGlzLm91dGVySGVpZ2h0O1xuXHR9XG5cdFxuXHRnZXRHcm91cCgpe1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cdFxuXHRyZWluaXRpYWxpemVIZWlnaHQoKXt9XG5cdFxuXHRjYWxjSGVpZ2h0KCl7fVxuXHRcblx0c2V0Q2VsbEhlaWdodCgpe31cblx0XG5cdGNsZWFyQ2VsbEhlaWdodCgpe31cblx0XG5cdGRlaW5pdGlhbGl6ZUhlaWdodCgpe31cblxuXHRyZW5kZXJlZCgpe31cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8gT2JqZWN0IEdlbmVyYXRpb24gLy8vLy8vLy8vLy8vLy8vLy9cblx0Z2V0Q29tcG9uZW50KCl7XG5cdFx0aWYoIXRoaXMuY29tcG9uZW50KXtcblx0XHRcdHRoaXMuY29tcG9uZW50ID0gbmV3IEdyb3VwQ29tcG9uZW50KHRoaXMpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gdGhpcy5jb21wb25lbnQ7XG5cdH1cbn1cblxuY2xhc3MgR3JvdXBSb3dzIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJncm91cFJvd3NcIjtcblx0XG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5ncm91cElETG9va3VwcyA9IGZhbHNlOyAvL2VuYWJsZSB0YWJsZSBncm91cGluZyBhbmQgc2V0IGZpZWxkIHRvIGdyb3VwIGJ5XG5cdFx0dGhpcy5zdGFydE9wZW4gPSBbZnVuY3Rpb24oKXtyZXR1cm4gZmFsc2U7fV07IC8vc3RhcnRpbmcgc3RhdGUgb2YgZ3JvdXBcblx0XHR0aGlzLmhlYWRlckdlbmVyYXRvciA9IFtmdW5jdGlvbigpe3JldHVybiBcIlwiO31dO1xuXHRcdHRoaXMuZ3JvdXBMaXN0ID0gW107IC8vb3JkZXJlZCBsaXN0IG9mIGdyb3Vwc1xuXHRcdHRoaXMuYWxsb3dlZFZhbHVlcyA9IGZhbHNlO1xuXHRcdHRoaXMuZ3JvdXBzID0ge307IC8vaG9sZCByb3cgZ3JvdXBzXG5cdFx0XG5cdFx0dGhpcy5kaXNwbGF5SGFuZGxlciA9IHRoaXMuZ2V0Um93cy5iaW5kKHRoaXMpO1xuXG5cdFx0dGhpcy5ibG9ja1JlZHJhdyA9IGZhbHNlO1xuXHRcdFxuXHRcdC8vcmVnaXN0ZXIgdGFibGUgb3B0aW9uc1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImdyb3VwQnlcIiwgZmFsc2UpOyAvL2VuYWJsZSB0YWJsZSBncm91cGluZyBhbmQgc2V0IGZpZWxkIHRvIGdyb3VwIGJ5XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZ3JvdXBTdGFydE9wZW5cIiwgdHJ1ZSk7IC8vc3RhcnRpbmcgc3RhdGUgb2YgZ3JvdXBcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJncm91cFZhbHVlc1wiLCBmYWxzZSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZ3JvdXBVcGRhdGVPbkNlbGxFZGl0XCIsIGZhbHNlKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJncm91cEhlYWRlclwiLCBmYWxzZSk7IC8vaGVhZGVyIGdlbmVyYXRpb24gZnVuY3Rpb25cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJncm91cEhlYWRlclByaW50XCIsIG51bGwpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImdyb3VwSGVhZGVyQ2xpcGJvYXJkXCIsIG51bGwpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImdyb3VwSGVhZGVySHRtbE91dHB1dFwiLCBudWxsKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJncm91cEhlYWRlckRvd25sb2FkXCIsIG51bGwpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImdyb3VwVG9nZ2xlRWxlbWVudFwiLCBcImFycm93XCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImdyb3VwQ2xvc2VkU2hvd0NhbGNzXCIsIGZhbHNlKTtcblx0XHRcblx0XHQvL3JlZ2lzdGVyIHRhYmxlIGZ1bmN0aW9uc1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwic2V0R3JvdXBCeVwiLCB0aGlzLnNldEdyb3VwQnkuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJzZXRHcm91cFZhbHVlc1wiLCB0aGlzLnNldEdyb3VwVmFsdWVzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwic2V0R3JvdXBTdGFydE9wZW5cIiwgdGhpcy5zZXRHcm91cFN0YXJ0T3Blbi5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInNldEdyb3VwSGVhZGVyXCIsIHRoaXMuc2V0R3JvdXBIZWFkZXIuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRHcm91cHNcIiwgdGhpcy51c2VyR2V0R3JvdXBzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiZ2V0R3JvdXBlZERhdGFcIiwgdGhpcy51c2VyR2V0R3JvdXBlZERhdGEuYmluZCh0aGlzKSk7XG5cdFx0XG5cdFx0Ly9yZWdpc3RlciBjb21wb25lbnQgZnVuY3Rpb25zXG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwicm93XCIsIFwiZ2V0R3JvdXBcIiwgdGhpcy5yb3dHZXRHcm91cC5iaW5kKHRoaXMpKTtcblx0fVxuXHRcblx0Ly9pbml0aWFsaXplIGdyb3VwIGNvbmZpZ3VyYXRpb25cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtZGVzdHJveVwiLCB0aGlzLl9ibG9ja1JlZHJhd2luZy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcInJvd3Mtd2lwZVwiLCB0aGlzLl9ibG9ja1JlZHJhd2luZy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcInJvd3Mtd2lwZWRcIiwgdGhpcy5fcmVzdG9yZV9yZWRyYXdpbmcuYmluZCh0aGlzKSk7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSl7XG5cdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBVcGRhdGVPbkNlbGxFZGl0KXtcblx0XHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLXZhbHVlLXVwZGF0ZWRcIiwgdGhpcy5jZWxsVXBkYXRlZC5iaW5kKHRoaXMpKTtcblx0XHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctZGF0YS1jaGFuZ2VkXCIsIHRoaXMucmVhc3NpZ25Sb3dUb0dyb3VwLmJpbmQodGhpcyksIDApO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLWJ1aWx0XCIsIHRoaXMuY29uZmlndXJlR3JvdXBTZXR1cC5iaW5kKHRoaXMpKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctZGVsZXRpbmdcIiwgdGhpcy5yb3dEZWxldGluZy5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWRlbGV0ZWRcIiwgdGhpcy5yb3dzVXBkYXRlZC5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwic2Nyb2xsLWhvcml6b250YWxcIiwgdGhpcy5zY3JvbGxIZWFkZXJzLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3dzLXdpcGVcIiwgdGhpcy53aXBlLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3dzLWFkZGVkXCIsIHRoaXMucm93c1VwZGF0ZWQuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1tb3ZpbmdcIiwgdGhpcy5yb3dNb3ZpbmcuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1hZGRpbmctaW5kZXhcIiwgdGhpcy5yb3dBZGRpbmdJbmRleC5iaW5kKHRoaXMpKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3dzLXNhbXBsZVwiLCB0aGlzLnJvd1NhbXBsZS5iaW5kKHRoaXMpKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyZW5kZXItdmlydHVhbC1maWxsXCIsIHRoaXMudmlydHVhbFJlbmRlckZpbGwuYmluZCh0aGlzKSk7XG5cdFx0XHRcblx0XHRcdHRoaXMucmVnaXN0ZXJEaXNwbGF5SGFuZGxlcih0aGlzLmRpc3BsYXlIYW5kbGVyLCAyMCk7XG5cdFx0XHRcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdH1cblx0fVxuXHRcblx0X2Jsb2NrUmVkcmF3aW5nKCl7XG5cdFx0dGhpcy5ibG9ja1JlZHJhdyA9IHRydWU7XG5cdH1cblxuXHRfcmVzdG9yZV9yZWRyYXdpbmcoKXtcblx0XHR0aGlzLmJsb2NrUmVkcmF3ID0gZmFsc2U7XG5cdH1cblxuXHRjb25maWd1cmVHcm91cFNldHVwKCl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkpe1xuXHRcdFx0dmFyIGdyb3VwQnkgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSxcblx0XHRcdHN0YXJ0T3BlbiA9IHRoaXMudGFibGUub3B0aW9ucy5ncm91cFN0YXJ0T3Blbixcblx0XHRcdGdyb3VwSGVhZGVyID0gdGhpcy50YWJsZS5vcHRpb25zLmdyb3VwSGVhZGVyO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmFsbG93ZWRWYWx1ZXMgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBWYWx1ZXM7XG5cdFx0XHRcblx0XHRcdGlmKEFycmF5LmlzQXJyYXkoZ3JvdXBCeSkgJiYgQXJyYXkuaXNBcnJheShncm91cEhlYWRlcikgJiYgZ3JvdXBCeS5sZW5ndGggPiBncm91cEhlYWRlci5sZW5ndGgpe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJFcnJvciBjcmVhdGluZyBncm91cCBoZWFkZXJzLCBncm91cEhlYWRlciBhcnJheSBpcyBzaG9ydGVyIHRoYW4gZ3JvdXBCeSBhcnJheVwiKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0dGhpcy5oZWFkZXJHZW5lcmF0b3IgPSBbZnVuY3Rpb24oKXtyZXR1cm4gXCJcIjt9XTtcblx0XHRcdHRoaXMuc3RhcnRPcGVuID0gW2Z1bmN0aW9uKCl7cmV0dXJuIGZhbHNlO31dOyAvL3N0YXJ0aW5nIHN0YXRlIG9mIGdyb3VwXG5cdFx0XHRcblx0XHRcdHRoaXMubGFuZ0JpbmQoXCJncm91cHN8aXRlbVwiLCAobGFuZ1ZhbHVlLCBsYW5nKSA9PiB7XG5cdFx0XHRcdHRoaXMuaGVhZGVyR2VuZXJhdG9yWzBdID0gKHZhbHVlLCBjb3VudCwgZGF0YSkgPT4geyAvL2hlYWRlciBsYXlvdXQgZnVuY3Rpb25cblx0XHRcdFx0XHRyZXR1cm4gKHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIiA/IFwiXCIgOiB2YWx1ZSkgKyBcIjxzcGFuPihcIiArIGNvdW50ICsgXCIgXCIgKyAoKGNvdW50ID09PSAxKSA/IGxhbmdWYWx1ZSA6IGxhbmcuZ3JvdXBzLml0ZW1zKSArIFwiKTwvc3Bhbj5cIjtcblx0XHRcdFx0fTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmdyb3VwSURMb29rdXBzID0gW107XG5cdFx0XHRcblx0XHRcdGlmKGdyb3VwQnkpe1xuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpICYmIHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcInRhYmxlXCIgJiYgdGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkNhbGNzICE9IFwiYm90aFwiKXtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MucmVtb3ZlQ2FsY3MoKTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImNvbHVtbkNhbGNzXCIpICYmIHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5DYWxjcyAhPSBcImdyb3VwXCIpe1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHZhciBjb2xzID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldFJlYWxDb2x1bW5zKCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0Y29scy5mb3JFYWNoKChjb2wpID0+IHtcblx0XHRcdFx0XHRcdGlmKGNvbC5kZWZpbml0aW9uLnRvcENhbGMpe1xuXHRcdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuY29sdW1uQ2FsY3MuaW5pdGlhbGl6ZVRvcFJvdygpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZihjb2wuZGVmaW5pdGlvbi5ib3R0b21DYWxjKXtcblx0XHRcdFx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLmluaXRpYWxpemVCb3R0b21Sb3coKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZighQXJyYXkuaXNBcnJheShncm91cEJ5KSl7XG5cdFx0XHRcdGdyb3VwQnkgPSBbZ3JvdXBCeV07XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGdyb3VwQnkuZm9yRWFjaCgoZ3JvdXAsIGkpID0+IHtcblx0XHRcdFx0dmFyIGxvb2t1cEZ1bmMsIGNvbHVtbjtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHR5cGVvZiBncm91cCA9PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0XHRcdGxvb2t1cEZ1bmMgPSBncm91cDtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGNvbHVtbiA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5CeUZpZWxkKGdyb3VwKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZihjb2x1bW4pe1xuXHRcdFx0XHRcdFx0bG9va3VwRnVuYyA9IGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldEZpZWxkVmFsdWUoZGF0YSk7XG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGxvb2t1cEZ1bmMgPSBmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGRhdGFbZ3JvdXBdO1xuXHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuZ3JvdXBJRExvb2t1cHMucHVzaCh7XG5cdFx0XHRcdFx0ZmllbGQ6IHR5cGVvZiBncm91cCA9PT0gXCJmdW5jdGlvblwiID8gZmFsc2UgOiBncm91cCxcblx0XHRcdFx0XHRmdW5jOmxvb2t1cEZ1bmMsXG5cdFx0XHRcdFx0dmFsdWVzOnRoaXMuYWxsb3dlZFZhbHVlcyA/IHRoaXMuYWxsb3dlZFZhbHVlc1tpXSA6IGZhbHNlLFxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRpZihzdGFydE9wZW4pe1xuXHRcdFx0XHRpZighQXJyYXkuaXNBcnJheShzdGFydE9wZW4pKXtcblx0XHRcdFx0XHRzdGFydE9wZW4gPSBbc3RhcnRPcGVuXTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0c3RhcnRPcGVuLmZvckVhY2goKGxldmVsKSA9PiB7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5zdGFydE9wZW4gPSBzdGFydE9wZW47XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKGdyb3VwSGVhZGVyKXtcblx0XHRcdFx0dGhpcy5oZWFkZXJHZW5lcmF0b3IgPSBBcnJheS5pc0FycmF5KGdyb3VwSGVhZGVyKSA/IGdyb3VwSGVhZGVyIDogW2dyb3VwSGVhZGVyXTtcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmdyb3VwTGlzdCA9IFtdO1xuXHRcdFx0dGhpcy5ncm91cHMgPSB7fTtcblx0XHR9XG5cdH1cblx0XG5cdHJvd1NhbXBsZShyb3dzLCBwcmV2VmFsdWUpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5KXtcblx0XHRcdHZhciBncm91cCA9IHRoaXMuZ2V0R3JvdXBzKGZhbHNlKVswXTtcblx0XHRcdFxuXHRcdFx0cHJldlZhbHVlLnB1c2goZ3JvdXAuZ2V0Um93cyhmYWxzZSlbMF0pO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gcHJldlZhbHVlO1xuXHR9XG5cdFxuXHR2aXJ0dWFsUmVuZGVyRmlsbCgpe1xuXHRcdHZhciBlbCA9IHRoaXMudGFibGUucm93TWFuYWdlci50YWJsZUVsZW1lbnQ7XG5cdFx0dmFyIHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0VmlzaWJsZVJvd3MoKTtcblx0XHRcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSl7XG5cdFx0XHRyb3dzID0gcm93cy5maWx0ZXIoKHJvdykgPT4ge1xuXHRcdFx0XHRyZXR1cm4gcm93LnR5cGUgIT09IFwiZ3JvdXBcIjtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRlbC5zdHlsZS5taW5XaWR0aCA9ICFyb3dzLmxlbmd0aCA/IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpICsgXCJweFwiIDogXCJcIjtcblx0XHR9ZWxzZSB7XG5cdFx0XHRyZXR1cm4gcm93cztcblx0XHR9XG5cdH1cblx0XG5cdHJvd0FkZGluZ0luZGV4KHJvdywgaW5kZXgsIHRvcCl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkpe1xuXHRcdFx0dGhpcy5hc3NpZ25Sb3dUb0dyb3VwKHJvdyk7XG5cdFx0XHRcblx0XHRcdHZhciBncm91cFJvd3MgPSByb3cubW9kdWxlcy5ncm91cC5yb3dzO1xuXHRcdFx0XG5cdFx0XHRpZihncm91cFJvd3MubGVuZ3RoID4gMSl7XG5cdFx0XHRcdGlmKCFpbmRleCB8fCAoaW5kZXggJiYgZ3JvdXBSb3dzLmluZGV4T2YoaW5kZXgpID09IC0xKSl7XG5cdFx0XHRcdFx0aWYodG9wKXtcblx0XHRcdFx0XHRcdGlmKGdyb3VwUm93c1swXSAhPT0gcm93KXtcblx0XHRcdFx0XHRcdFx0aW5kZXggPSBncm91cFJvd3NbMF07XG5cdFx0XHRcdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5tb3ZlUm93SW5BcnJheShyb3cubW9kdWxlcy5ncm91cC5yb3dzLCByb3csIGluZGV4LCAhdG9wKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRpZihncm91cFJvd3NbZ3JvdXBSb3dzLmxlbmd0aCAtMV0gIT09IHJvdyl7XG5cdFx0XHRcdFx0XHRcdGluZGV4ID0gZ3JvdXBSb3dzW2dyb3VwUm93cy5sZW5ndGggLTFdO1xuXHRcdFx0XHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIubW92ZVJvd0luQXJyYXkocm93Lm1vZHVsZXMuZ3JvdXAucm93cywgcm93LCBpbmRleCwgIXRvcCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3dJbkFycmF5KHJvdy5tb2R1bGVzLmdyb3VwLnJvd3MsIHJvdywgaW5kZXgsICF0b3ApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHJldHVybiBpbmRleDtcblx0XHR9XG5cdH1cblx0XG5cdHRyYWNrQ2hhbmdlcygpe1xuXHRcdHRoaXMuZGlzcGF0Y2goXCJncm91cC1jaGFuZ2VkXCIpO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gVGFibGUgRnVuY3Rpb25zIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0c2V0R3JvdXBCeShncm91cHMpe1xuXHRcdHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ID0gZ3JvdXBzO1xuXHRcdFxuXHRcdGlmKCF0aGlzLmluaXRpYWxpemVkKXtcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZSgpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmNvbmZpZ3VyZUdyb3VwU2V0dXAoKTtcblxuXHRcdGlmKCFncm91cHMgJiYgdGhpcy50YWJsZS5tb2RFeGlzdHMoXCJjb2x1bW5DYWxjc1wiKSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uQ2FsY3MgPT09IHRydWUpe1xuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmNvbHVtbkNhbGNzLnJlaW5pdGlhbGl6ZUNhbGNzKCk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMucmVmcmVzaERhdGEoKTtcblx0XHRcblx0XHR0aGlzLnRyYWNrQ2hhbmdlcygpO1xuXHR9XG5cdFxuXHRzZXRHcm91cFZhbHVlcyhncm91cFZhbHVlcyl7XG5cdFx0dGhpcy50YWJsZS5vcHRpb25zLmdyb3VwVmFsdWVzID0gZ3JvdXBWYWx1ZXM7XG5cdFx0dGhpcy5jb25maWd1cmVHcm91cFNldHVwKCk7XG5cdFx0dGhpcy5yZWZyZXNoRGF0YSgpO1xuXHRcdFxuXHRcdHRoaXMudHJhY2tDaGFuZ2VzKCk7XG5cdH1cblx0XG5cdHNldEdyb3VwU3RhcnRPcGVuKHZhbHVlcyl7XG5cdFx0dGhpcy50YWJsZS5vcHRpb25zLmdyb3VwU3RhcnRPcGVuID0gdmFsdWVzO1xuXHRcdHRoaXMuY29uZmlndXJlR3JvdXBTZXR1cCgpO1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5KXtcblx0XHRcdHRoaXMucmVmcmVzaERhdGEoKTtcblx0XHRcdFxuXHRcdFx0dGhpcy50cmFja0NoYW5nZXMoKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJHcm91cGluZyBVcGRhdGUgLSBjYW50IHJlZnJlc2ggdmlldywgbm8gZ3JvdXBzIGhhdmUgYmVlbiBzZXRcIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRzZXRHcm91cEhlYWRlcih2YWx1ZXMpe1xuXHRcdHRoaXMudGFibGUub3B0aW9ucy5ncm91cEhlYWRlciA9IHZhbHVlcztcblx0XHR0aGlzLmNvbmZpZ3VyZUdyb3VwU2V0dXAoKTtcblx0XHRcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSl7XG5cdFx0XHR0aGlzLnJlZnJlc2hEYXRhKCk7XG5cdFx0XHRcblx0XHRcdHRoaXMudHJhY2tDaGFuZ2VzKCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiR3JvdXBpbmcgVXBkYXRlIC0gY2FudCByZWZyZXNoIHZpZXcsIG5vIGdyb3VwcyBoYXZlIGJlZW4gc2V0XCIpO1xuXHRcdH1cblx0fVxuXHRcblx0dXNlckdldEdyb3Vwcyh2YWx1ZXMpe1xuXHRcdHJldHVybiB0aGlzLmdldEdyb3Vwcyh0cnVlKTtcblx0fVxuXHRcblx0Ly8gZ2V0IGdyb3VwZWQgdGFibGUgZGF0YSBpbiB0aGUgc2FtZSBmb3JtYXQgYXMgZ2V0RGF0YSgpXG5cdHVzZXJHZXRHcm91cGVkRGF0YSgpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSA/IHRoaXMuZ2V0R3JvdXBlZERhdGEoKSA6IHRoaXMuZ2V0RGF0YSgpO1xuXHR9XG5cdFxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBDb21wb25lbnQgRnVuY3Rpb25zIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdHJvd0dldEdyb3VwKHJvdyl7XG5cdFx0cmV0dXJuIHJvdy5tb2R1bGVzLmdyb3VwID8gcm93Lm1vZHVsZXMuZ3JvdXAuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIEludGVybmFsIExvZ2ljIC8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdHJvd01vdmluZyhmcm9tLCB0bywgYWZ0ZXIpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5KXtcblx0XHRcdGlmKCFhZnRlciAmJiB0byBpbnN0YW5jZW9mIEdyb3VwKXtcblx0XHRcdFx0dG8gPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIucHJldkRpc3BsYXlSb3coZnJvbSkgfHwgdG87XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHZhciB0b0dyb3VwID0gdG8gaW5zdGFuY2VvZiBHcm91cCA/IHRvIDogdG8ubW9kdWxlcy5ncm91cDtcblx0XHRcdHZhciBmcm9tR3JvdXAgPSBmcm9tIGluc3RhbmNlb2YgR3JvdXAgPyBmcm9tIDogZnJvbS5tb2R1bGVzLmdyb3VwO1xuXHRcdFx0XG5cdFx0XHRpZih0b0dyb3VwID09PSBmcm9tR3JvdXApe1xuXHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIubW92ZVJvd0luQXJyYXkodG9Hcm91cC5yb3dzLCBmcm9tLCB0bywgYWZ0ZXIpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZihmcm9tR3JvdXApe1xuXHRcdFx0XHRcdGZyb21Hcm91cC5yZW1vdmVSb3coZnJvbSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHRvR3JvdXAuaW5zZXJ0Um93KGZyb20sIHRvLCBhZnRlcik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRcblx0cm93RGVsZXRpbmcocm93KXtcblx0XHQvL3JlbW92ZSBmcm9tIGdyb3VwXG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnkgJiYgcm93Lm1vZHVsZXMuZ3JvdXApe1xuXHRcdFx0cm93Lm1vZHVsZXMuZ3JvdXAucmVtb3ZlUm93KHJvdyk7XG5cdFx0fVxuXHR9XG5cdFxuXHRyb3dzVXBkYXRlZChyb3cpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5KXtcblx0XHRcdHRoaXMudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdH1cdFxuXHR9XG5cdFxuXHRjZWxsVXBkYXRlZChjZWxsKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSl7XG5cdFx0XHR0aGlzLnJlYXNzaWduUm93VG9Hcm91cChjZWxsLnJvdyk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3JldHVybiBhcHByb3ByaWF0ZSByb3dzIHdpdGggZ3JvdXAgaGVhZGVyc1xuXHRnZXRSb3dzKHJvd3Mpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMuZ3JvdXBJRExvb2t1cHMubGVuZ3RoKXtcblx0XHRcdFxuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiZGF0YUdyb3VwaW5nXCIpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmdlbmVyYXRlR3JvdXBzKHJvd3MpO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnN1YnNjcmliZWRFeHRlcm5hbChcImRhdGFHcm91cGVkXCIpKXtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiZGF0YUdyb3VwZWRcIiwgdGhpcy5nZXRHcm91cHModHJ1ZSkpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRyZXR1cm4gdGhpcy51cGRhdGVHcm91cFJvd3MoKTtcblx0XHRcdFxuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiByb3dzLnNsaWNlKDApO1xuXHRcdH1cblx0fVxuXHRcblx0Z2V0R3JvdXBzKGNvbXBvbmVudCl7XG5cdFx0dmFyIGdyb3VwQ29tcG9uZW50cyA9IFtdO1xuXHRcdFxuXHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goZnVuY3Rpb24oZ3JvdXApe1xuXHRcdFx0Z3JvdXBDb21wb25lbnRzLnB1c2goY29tcG9uZW50ID8gZ3JvdXAuZ2V0Q29tcG9uZW50KCkgOiBncm91cCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIGdyb3VwQ29tcG9uZW50cztcblx0fVxuXHRcblx0Z2V0Q2hpbGRHcm91cHMoZ3JvdXApe1xuXHRcdHZhciBncm91cENvbXBvbmVudHMgPSBbXTtcblx0XHRcblx0XHRpZighZ3JvdXApe1xuXHRcdFx0Z3JvdXAgPSB0aGlzO1xuXHRcdH1cblx0XHRcblx0XHRncm91cC5ncm91cExpc3QuZm9yRWFjaCgoY2hpbGQpID0+IHtcblx0XHRcdGlmKGNoaWxkLmdyb3VwTGlzdC5sZW5ndGgpe1xuXHRcdFx0XHRncm91cENvbXBvbmVudHMgPSBncm91cENvbXBvbmVudHMuY29uY2F0KHRoaXMuZ2V0Q2hpbGRHcm91cHMoY2hpbGQpKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Z3JvdXBDb21wb25lbnRzLnB1c2goY2hpbGQpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBncm91cENvbXBvbmVudHM7XG5cdH1cblx0XG5cdHdpcGUoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSl7XG5cdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGdyb3VwKXtcblx0XHRcdFx0Z3JvdXAud2lwZSgpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuZ3JvdXBMaXN0ID0gW107XG5cdFx0XHR0aGlzLmdyb3VwcyA9IHt9O1xuXHRcdH1cblx0fVxuXHRcblx0cHVsbEdyb3VwTGlzdERhdGEoZ3JvdXBMaXN0KSB7XG5cdFx0dmFyIGdyb3VwTGlzdERhdGEgPSBbXTtcblx0XHRcblx0XHRncm91cExpc3QuZm9yRWFjaCgoZ3JvdXApID0+IHtcblx0XHRcdHZhciBncm91cEhlYWRlciA9IHt9O1xuXHRcdFx0Z3JvdXBIZWFkZXIubGV2ZWwgPSAwO1xuXHRcdFx0Z3JvdXBIZWFkZXIucm93Q291bnQgPSAwO1xuXHRcdFx0Z3JvdXBIZWFkZXIuaGVhZGVyQ29udGVudCA9IFwiXCI7XG5cdFx0XHR2YXIgY2hpbGREYXRhID0gW107XG5cdFx0XHRcblx0XHRcdGlmIChncm91cC5oYXNTdWJHcm91cHMpIHtcblx0XHRcdFx0Y2hpbGREYXRhID0gdGhpcy5wdWxsR3JvdXBMaXN0RGF0YShncm91cC5ncm91cExpc3QpO1xuXHRcdFx0XHRcblx0XHRcdFx0Z3JvdXBIZWFkZXIubGV2ZWwgPSBncm91cC5sZXZlbDtcblx0XHRcdFx0Z3JvdXBIZWFkZXIucm93Q291bnQgPSBjaGlsZERhdGEubGVuZ3RoIC0gZ3JvdXAuZ3JvdXBMaXN0Lmxlbmd0aDsgLy8gZGF0YSBsZW5ndGggbWludXMgbnVtYmVyIG9mIHN1Yi1oZWFkZXJzXG5cdFx0XHRcdGdyb3VwSGVhZGVyLmhlYWRlckNvbnRlbnQgPSBncm91cC5nZW5lcmF0b3IoZ3JvdXAua2V5LCBncm91cEhlYWRlci5yb3dDb3VudCwgZ3JvdXAucm93cywgZ3JvdXApO1xuXHRcdFx0XHRcblx0XHRcdFx0Z3JvdXBMaXN0RGF0YS5wdXNoKGdyb3VwSGVhZGVyKTtcblx0XHRcdFx0Z3JvdXBMaXN0RGF0YSA9IGdyb3VwTGlzdERhdGEuY29uY2F0KGNoaWxkRGF0YSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRncm91cEhlYWRlci5sZXZlbCA9IGdyb3VwLmxldmVsO1xuXHRcdFx0XHRncm91cEhlYWRlci5oZWFkZXJDb250ZW50ID0gZ3JvdXAuZ2VuZXJhdG9yKGdyb3VwLmtleSwgZ3JvdXAucm93cy5sZW5ndGgsIGdyb3VwLnJvd3MsIGdyb3VwKTtcblx0XHRcdFx0Z3JvdXBIZWFkZXIucm93Q291bnQgPSBncm91cC5nZXRSb3dzKCkubGVuZ3RoO1xuXHRcdFx0XHRcblx0XHRcdFx0Z3JvdXBMaXN0RGF0YS5wdXNoKGdyb3VwSGVhZGVyKTtcblx0XHRcdFx0XG5cdFx0XHRcdGdyb3VwLmdldFJvd3MoKS5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0XHRncm91cExpc3REYXRhLnB1c2gocm93LmdldERhdGEoXCJkYXRhXCIpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIGdyb3VwTGlzdERhdGE7XG5cdH1cblx0XG5cdGdldEdyb3VwZWREYXRhKCl7XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXMucHVsbEdyb3VwTGlzdERhdGEodGhpcy5ncm91cExpc3QpO1xuXHR9XG5cdFxuXHRnZXRSb3dHcm91cChyb3cpe1xuXHRcdHZhciBtYXRjaCA9IGZhbHNlO1xuXHRcdFxuXHRcdGlmKHRoaXMub3B0aW9ucyhcImRhdGFUcmVlXCIpKXtcblx0XHRcdHJvdyA9IHRoaXMudGFibGUubW9kdWxlcy5kYXRhVHJlZS5nZXRUcmVlUGFyZW50Um9vdChyb3cpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKChncm91cCkgPT4ge1xuXHRcdFx0dmFyIHJlc3VsdCA9IGdyb3VwLmdldFJvd0dyb3VwKHJvdyk7XG5cdFx0XHRcblx0XHRcdGlmKHJlc3VsdCl7XG5cdFx0XHRcdG1hdGNoID0gcmVzdWx0O1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBtYXRjaDtcblx0fVxuXHRcblx0Y291bnRHcm91cHMoKXtcblx0XHRyZXR1cm4gdGhpcy5ncm91cExpc3QubGVuZ3RoO1xuXHR9XG5cdFxuXHRnZW5lcmF0ZUdyb3Vwcyhyb3dzKXtcblx0XHR2YXIgb2xkR3JvdXBzID0gdGhpcy5ncm91cHM7XG5cdFx0XG5cdFx0dGhpcy5ncm91cHMgPSB7fTtcblx0XHR0aGlzLmdyb3VwTGlzdCA9IFtdO1xuXHRcdFxuXHRcdGlmKHRoaXMuYWxsb3dlZFZhbHVlcyAmJiB0aGlzLmFsbG93ZWRWYWx1ZXNbMF0pe1xuXHRcdFx0dGhpcy5hbGxvd2VkVmFsdWVzWzBdLmZvckVhY2goKHZhbHVlKSA9PiB7XG5cdFx0XHRcdHRoaXMuY3JlYXRlR3JvdXAodmFsdWUsIDAsIG9sZEdyb3Vwcyk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0cm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0dGhpcy5hc3NpZ25Sb3dUb0V4aXN0aW5nR3JvdXAocm93LCBvbGRHcm91cHMpO1xuXHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0dGhpcy5hc3NpZ25Sb3dUb0dyb3VwKHJvdywgb2xkR3JvdXBzKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRcblx0XHRPYmplY3QudmFsdWVzKG9sZEdyb3VwcykuZm9yRWFjaCgoZ3JvdXApID0+IHtcblx0XHRcdGdyb3VwLndpcGUodHJ1ZSk7XG5cdFx0fSk7XHRcblx0fVxuXHRcblx0XG5cdGNyZWF0ZUdyb3VwKGdyb3VwSUQsIGxldmVsLCBvbGRHcm91cHMpe1xuXHRcdHZhciBncm91cEtleSA9IGxldmVsICsgXCJfXCIgKyBncm91cElELFxuXHRcdGdyb3VwO1xuXHRcdFxuXHRcdG9sZEdyb3VwcyA9IG9sZEdyb3VwcyB8fCBbXTtcblx0XHRcblx0XHRncm91cCA9IG5ldyBHcm91cCh0aGlzLCBmYWxzZSwgbGV2ZWwsIGdyb3VwSUQsIHRoaXMuZ3JvdXBJRExvb2t1cHNbMF0uZmllbGQsIHRoaXMuaGVhZGVyR2VuZXJhdG9yWzBdLCBvbGRHcm91cHNbZ3JvdXBLZXldKTtcblx0XHRcblx0XHR0aGlzLmdyb3Vwc1tncm91cEtleV0gPSBncm91cDtcblx0XHR0aGlzLmdyb3VwTGlzdC5wdXNoKGdyb3VwKTtcblx0fVxuXHRcblx0YXNzaWduUm93VG9FeGlzdGluZ0dyb3VwKHJvdywgb2xkR3JvdXBzKXtcblx0XHR2YXIgZ3JvdXBJRCA9IHRoaXMuZ3JvdXBJRExvb2t1cHNbMF0uZnVuYyhyb3cuZ2V0RGF0YSgpKSxcblx0XHRncm91cEtleSA9IFwiMF9cIiArIGdyb3VwSUQ7XG5cdFx0XG5cdFx0aWYodGhpcy5ncm91cHNbZ3JvdXBLZXldKXtcblx0XHRcdHRoaXMuZ3JvdXBzW2dyb3VwS2V5XS5hZGRSb3cocm93KTtcblx0XHR9XG5cdH1cblx0XG5cdGFzc2lnblJvd1RvR3JvdXAocm93LCBvbGRHcm91cHMpe1xuXHRcdHZhciBncm91cElEID0gdGhpcy5ncm91cElETG9va3Vwc1swXS5mdW5jKHJvdy5nZXREYXRhKCkpLFxuXHRcdG5ld0dyb3VwTmVlZGVkID0gIXRoaXMuZ3JvdXBzW1wiMF9cIiArIGdyb3VwSURdO1xuXHRcdFxuXHRcdGlmKG5ld0dyb3VwTmVlZGVkKXtcblx0XHRcdHRoaXMuY3JlYXRlR3JvdXAoZ3JvdXBJRCwgMCwgb2xkR3JvdXBzKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5ncm91cHNbXCIwX1wiICsgZ3JvdXBJRF0uYWRkUm93KHJvdyk7XG5cdFx0XG5cdFx0cmV0dXJuICFuZXdHcm91cE5lZWRlZDtcblx0fVxuXHRcblx0cmVhc3NpZ25Sb3dUb0dyb3VwKHJvdyl7XG5cdFx0aWYocm93LnR5cGUgPT09IFwicm93XCIpe1xuXHRcdFx0dmFyIG9sZFJvd0dyb3VwID0gcm93Lm1vZHVsZXMuZ3JvdXAsXG5cdFx0XHRvbGRHcm91cFBhdGggPSBvbGRSb3dHcm91cC5nZXRQYXRoKCksXG5cdFx0XHRuZXdHcm91cFBhdGggPSB0aGlzLmdldEV4cGVjdGVkUGF0aChyb3cpLFxuXHRcdFx0c2FtZVBhdGg7XG5cdFx0XHRcblx0XHRcdC8vIGZpZ3VyZSBvdXQgaWYgbmV3IGdyb3VwIHBhdGggaXMgdGhlIHNhbWUgYXMgb2xkIGdyb3VwIHBhdGhcblx0XHRcdHNhbWVQYXRoID0gKG9sZEdyb3VwUGF0aC5sZW5ndGggPT0gbmV3R3JvdXBQYXRoLmxlbmd0aCkgJiYgb2xkR3JvdXBQYXRoLmV2ZXJ5KChlbGVtZW50LCBpbmRleCkgPT4ge1xuXHRcdFx0XHRyZXR1cm4gZWxlbWVudCA9PT0gbmV3R3JvdXBQYXRoW2luZGV4XTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHQvLyByZWZyZXNoIGlmIHRoZXkgbmV3IHBhdGggYW5kIG9sZCBwYXRoIGFyZW4ndCB0aGUgc2FtZSAoYWthIHRoZSByb3cncyBncm91cGluZ3MgaGF2ZSBjaGFuZ2VkKVxuXHRcdFx0aWYoIXNhbWVQYXRoKSB7XG5cdFx0XHRcdG9sZFJvd0dyb3VwLnJlbW92ZVJvdyhyb3cpO1xuXHRcdFx0XHR0aGlzLmFzc2lnblJvd1RvR3JvdXAocm93LCB0aGlzLmdyb3Vwcyk7XG5cdFx0XHRcdHRoaXMucmVmcmVzaERhdGEodHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRnZXRFeHBlY3RlZFBhdGgocm93KSB7XG5cdFx0dmFyIGdyb3VwUGF0aCA9IFtdLCByb3dEYXRhID0gcm93LmdldERhdGEoKTtcblx0XHRcblx0XHR0aGlzLmdyb3VwSURMb29rdXBzLmZvckVhY2goKGdyb3VwSWQpID0+IHtcblx0XHRcdGdyb3VwUGF0aC5wdXNoKGdyb3VwSWQuZnVuYyhyb3dEYXRhKSk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIGdyb3VwUGF0aDtcblx0fVxuXHRcblx0dXBkYXRlR3JvdXBSb3dzKGZvcmNlKXtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cblx0XHRpZighdGhpcy5ibG9ja1JlZHJhdyl7XG5cdFx0XHR0aGlzLmdyb3VwTGlzdC5mb3JFYWNoKChncm91cCkgPT4ge1xuXHRcdFx0XHRvdXRwdXQgPSBvdXRwdXQuY29uY2F0KGdyb3VwLmdldEhlYWRlcnNBbmRSb3dzKCkpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdGlmKGZvcmNlKXtcblx0XHRcdFx0dGhpcy5yZWZyZXNoRGF0YSh0cnVlKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXHRcblx0c2Nyb2xsSGVhZGVycyhsZWZ0KXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSl7XG5cdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucmVuZGVySG9yaXpvbnRhbCA9PT0gXCJ2aXJ0dWFsXCIpe1xuXHRcdFx0XHRsZWZ0IC09IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5yZW5kZXJlci52RG9tUGFkTGVmdDtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0bGVmdCA9IGxlZnQgKyBcInB4XCI7XG5cdFx0XHRcblx0XHRcdHRoaXMuZ3JvdXBMaXN0LmZvckVhY2goKGdyb3VwKSA9PiB7XG5cdFx0XHRcdGdyb3VwLnNjcm9sbEhlYWRlcihsZWZ0KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXHRcblx0cmVtb3ZlR3JvdXAoZ3JvdXApe1xuXHRcdHZhciBncm91cEtleSA9IGdyb3VwLmxldmVsICsgXCJfXCIgKyBncm91cC5rZXksXG5cdFx0aW5kZXg7XG5cdFx0XG5cdFx0aWYodGhpcy5ncm91cHNbZ3JvdXBLZXldKXtcblx0XHRcdGRlbGV0ZSB0aGlzLmdyb3Vwc1tncm91cEtleV07XG5cdFx0XHRcblx0XHRcdGluZGV4ID0gdGhpcy5ncm91cExpc3QuaW5kZXhPZihncm91cCk7XG5cdFx0XHRcblx0XHRcdGlmKGluZGV4ID4gLTEpe1xuXHRcdFx0XHR0aGlzLmdyb3VwTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Y2hlY2tCYXNpY01vZGVHcm91cEhlYWRlcldpZHRoKCl7XG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIudGFibGVFbGVtZW50LFxuXHRcdG9ubHlHcm91cEhlYWRlcnMgPSB0cnVlO1xuXHRcdFxuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLmZvckVhY2goKHJvdywgaW5kZXgpID0+e1xuXHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnN0eWxlUm93KHJvdywgaW5kZXgpO1xuXHRcdFx0ZWxlbWVudC5hcHBlbmRDaGlsZChyb3cuZ2V0RWxlbWVudCgpKTtcblx0XHRcdHJvdy5pbml0aWFsaXplKHRydWUpO1xuXHRcdFx0XG5cdFx0XHRpZihyb3cudHlwZSAhPT0gXCJncm91cFwiKXtcblx0XHRcdFx0b25seUdyb3VwSGVhZGVycyA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdGlmKG9ubHlHcm91cEhlYWRlcnMpe1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpICsgXCJweFwiO1xuXHRcdH1lbHNlIHtcblx0XHRcdGVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBcIlwiO1xuXHRcdH1cblx0fVxuXHRcbn1cblxudmFyIGRlZmF1bHRVbmRvZXJzID0ge1xuXHRjZWxsRWRpdDogZnVuY3Rpb24oYWN0aW9uKXtcblx0XHRhY3Rpb24uY29tcG9uZW50LnNldFZhbHVlUHJvY2Vzc0RhdGEoYWN0aW9uLmRhdGEub2xkVmFsdWUpO1xuXHRcdGFjdGlvbi5jb21wb25lbnQuY2VsbFJlbmRlcmVkKCk7XG5cdH0sXG5cblx0cm93QWRkOiBmdW5jdGlvbihhY3Rpb24pe1xuXHRcdGFjdGlvbi5jb21wb25lbnQuZGVsZXRlQWN0dWFsKCk7XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuY2hlY2tQbGFjZWhvbGRlcigpO1xuXHR9LFxuXG5cdHJvd0RlbGV0ZTogZnVuY3Rpb24oYWN0aW9uKXtcblx0XHR2YXIgbmV3Um93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChhY3Rpb24uZGF0YS5kYXRhLCBhY3Rpb24uZGF0YS5wb3MsIGFjdGlvbi5kYXRhLmluZGV4KTtcblxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKXtcblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3JlYmluZFJvdyhhY3Rpb24uY29tcG9uZW50LCBuZXdSb3cpO1xuXG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmNoZWNrUGxhY2Vob2xkZXIoKTtcblx0fSxcblxuXHRyb3dNb3ZlOiBmdW5jdGlvbihhY3Rpb24pe1xuXHRcdHZhciBhZnRlciA9IChhY3Rpb24uZGF0YS5wb3NGcm9tICAtIGFjdGlvbi5kYXRhLnBvc1RvKSA+IDA7XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIubW92ZVJvd0FjdHVhbChhY3Rpb24uY29tcG9uZW50LCB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93RnJvbVBvc2l0aW9uKGFjdGlvbi5kYXRhLnBvc0Zyb20pLCBhZnRlcik7XG5cblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVnZW5lcmF0ZVJvd1Bvc2l0aW9ucygpO1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZVJlbmRlckluUG9zaXRpb24oKTtcblx0fSxcbn07XG5cbnZhciBkZWZhdWx0UmVkb2VycyA9IHtcblx0Y2VsbEVkaXQ6IGZ1bmN0aW9uKGFjdGlvbil7XG5cdFx0YWN0aW9uLmNvbXBvbmVudC5zZXRWYWx1ZVByb2Nlc3NEYXRhKGFjdGlvbi5kYXRhLm5ld1ZhbHVlKTtcblx0XHRhY3Rpb24uY29tcG9uZW50LmNlbGxSZW5kZXJlZCgpO1xuXHR9LFxuXG5cdHJvd0FkZDogZnVuY3Rpb24oYWN0aW9uKXtcblx0XHR2YXIgbmV3Um93ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChhY3Rpb24uZGF0YS5kYXRhLCBhY3Rpb24uZGF0YS5wb3MsIGFjdGlvbi5kYXRhLmluZGV4KTtcblxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cEJ5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiZ3JvdXBSb3dzXCIpKXtcblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5ncm91cFJvd3MudXBkYXRlR3JvdXBSb3dzKHRydWUpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3JlYmluZFJvdyhhY3Rpb24uY29tcG9uZW50LCBuZXdSb3cpO1xuXG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmNoZWNrUGxhY2Vob2xkZXIoKTtcblx0fSxcblxuXHRyb3dEZWxldGU6ZnVuY3Rpb24oYWN0aW9uKXtcblx0XHRhY3Rpb24uY29tcG9uZW50LmRlbGV0ZUFjdHVhbCgpO1xuXG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmNoZWNrUGxhY2Vob2xkZXIoKTtcblx0fSxcblxuXHRyb3dNb3ZlOiBmdW5jdGlvbihhY3Rpb24pe1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5tb3ZlUm93QWN0dWFsKGFjdGlvbi5jb21wb25lbnQsIHRoaXMudGFibGUucm93TWFuYWdlci5nZXRSb3dGcm9tUG9zaXRpb24oYWN0aW9uLmRhdGEucG9zVG8pLCBhY3Rpb24uZGF0YS5hZnRlcik7XG5cdFx0XG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlZ2VuZXJhdGVSb3dQb3NpdGlvbnMoKTtcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVSZW5kZXJJblBvc2l0aW9uKCk7XG5cdH0sXG59O1xuXG52YXIgYmluZGluZ3MkMSA9IHtcclxuXHR1bmRvOltcImN0cmwgKyA5MFwiLCBcIm1ldGEgKyA5MFwiXSxcclxuXHRyZWRvOltcImN0cmwgKyA4OVwiLCBcIm1ldGEgKyA4OVwiXSxcclxufTtcblxudmFyIGFjdGlvbnMkMSA9IHtcclxuXHR1bmRvOmZ1bmN0aW9uKGUpe1xyXG5cdFx0dmFyIGNlbGwgPSBmYWxzZTtcclxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiaGlzdG9yeVwiKSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpe1xyXG5cclxuXHRcdFx0Y2VsbCA9IHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xyXG5cclxuXHRcdFx0aWYoIWNlbGwpe1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuaGlzdG9yeS51bmRvKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRyZWRvOmZ1bmN0aW9uKGUpe1xyXG5cdFx0dmFyIGNlbGwgPSBmYWxzZTtcclxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5oaXN0b3J5ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwiaGlzdG9yeVwiKSAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcImVkaXRcIikpe1xyXG5cclxuXHRcdFx0Y2VsbCA9IHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsO1xyXG5cclxuXHRcdFx0aWYoIWNlbGwpe1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuaGlzdG9yeS5yZWRvKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG59O1xuXG52YXIgZXh0ZW5zaW9ucyQzID0ge1xyXG5cdGtleWJpbmRpbmdzOntcclxuXHRcdGJpbmRpbmdzOmJpbmRpbmdzJDEsXHJcblx0XHRhY3Rpb25zOmFjdGlvbnMkMVxyXG5cdH0sXHJcbn07XG5cbmNsYXNzIEhpc3RvcnkgZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcImhpc3RvcnlcIjtcblx0c3RhdGljIG1vZHVsZUV4dGVuc2lvbnMgPSBleHRlbnNpb25zJDM7XG5cblx0Ly9sb2FkIGRlZmF1bHRzXG5cdHN0YXRpYyB1bmRvZXJzID0gZGVmYXVsdFVuZG9lcnM7XG5cdHN0YXRpYyByZWRvZXJzID0gZGVmYXVsdFJlZG9lcnM7XG5cblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblxuXHRcdHRoaXMuaGlzdG9yeSA9IFtdO1xuXHRcdHRoaXMuaW5kZXggPSAtMTtcblxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImhpc3RvcnlcIiwgZmFsc2UpOyAvL2VuYWJsZSBlZGl0IGhpc3Rvcnlcblx0fVxuXG5cdGluaXRpYWxpemUoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuaGlzdG9yeSl7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtdmFsdWUtdXBkYXRlZFwiLCB0aGlzLmNlbGxVcGRhdGVkLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLWRlbGV0ZVwiLCB0aGlzLmNsZWFyQ29tcG9uZW50SGlzdG9yeS5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWRlbGV0ZVwiLCB0aGlzLnJvd0RlbGV0ZWQuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvd3Mtd2lwZVwiLCB0aGlzLmNsZWFyLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctYWRkZWRcIiwgdGhpcy5yb3dBZGRlZC5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LW1vdmVcIiwgdGhpcy5yb3dNb3ZlZC5iaW5kKHRoaXMpKTtcblx0XHR9XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInVuZG9cIiwgdGhpcy51bmRvLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwicmVkb1wiLCB0aGlzLnJlZG8uYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRIaXN0b3J5VW5kb1NpemVcIiwgdGhpcy5nZXRIaXN0b3J5VW5kb1NpemUuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRIaXN0b3J5UmVkb1NpemVcIiwgdGhpcy5nZXRIaXN0b3J5UmVkb1NpemUuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJjbGVhckhpc3RvcnlcIiwgdGhpcy5jbGVhci5iaW5kKHRoaXMpKTtcblx0fVxuXG5cdHJvd01vdmVkKGZyb20sIHRvLCBhZnRlcil7XG5cdFx0dGhpcy5hY3Rpb24oXCJyb3dNb3ZlXCIsIGZyb20sIHtwb3NGcm9tOmZyb20uZ2V0UG9zaXRpb24oKSwgcG9zVG86dG8uZ2V0UG9zaXRpb24oKSwgdG86dG8sIGFmdGVyOmFmdGVyfSk7XG5cdH1cblxuXHRyb3dBZGRlZChyb3csIGRhdGEsIHBvcywgaW5kZXgpe1xuXHRcdHRoaXMuYWN0aW9uKFwicm93QWRkXCIsIHJvdywge2RhdGE6ZGF0YSwgcG9zOnBvcywgaW5kZXg6aW5kZXh9KTtcblx0fVxuXG5cdHJvd0RlbGV0ZWQocm93KXtcblx0XHR2YXIgaW5kZXgsIHJvd3M7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSl7XG5cblx0XHRcdHJvd3MgPSByb3cuZ2V0Q29tcG9uZW50KCkuZ2V0R3JvdXAoKS5fZ2V0U2VsZigpLnJvd3M7XG5cdFx0XHRpbmRleCA9IHJvd3MuaW5kZXhPZihyb3cpO1xuXG5cdFx0XHRpZihpbmRleCl7XG5cdFx0XHRcdGluZGV4ID0gcm93c1tpbmRleC0xXTtcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRpbmRleCA9IHJvdy50YWJsZS5yb3dNYW5hZ2VyLmdldFJvd0luZGV4KHJvdyk7XG5cblx0XHRcdGlmKGluZGV4KXtcblx0XHRcdFx0aW5kZXggPSByb3cudGFibGUucm93TWFuYWdlci5yb3dzW2luZGV4LTFdO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuYWN0aW9uKFwicm93RGVsZXRlXCIsIHJvdywge2RhdGE6cm93LmdldERhdGEoKSwgcG9zOiFpbmRleCwgaW5kZXg6aW5kZXh9KTtcblx0fVxuXG5cdGNlbGxVcGRhdGVkKGNlbGwpe1xuXHRcdHRoaXMuYWN0aW9uKFwiY2VsbEVkaXRcIiwgY2VsbCwge29sZFZhbHVlOmNlbGwub2xkVmFsdWUsIG5ld1ZhbHVlOmNlbGwudmFsdWV9KTtcblx0fVxuXG5cdGNsZWFyKCl7XG5cdFx0dGhpcy5oaXN0b3J5ID0gW107XG5cdFx0dGhpcy5pbmRleCA9IC0xO1xuXHR9XG5cblx0YWN0aW9uKHR5cGUsIGNvbXBvbmVudCwgZGF0YSl7XG5cdFx0dGhpcy5oaXN0b3J5ID0gdGhpcy5oaXN0b3J5LnNsaWNlKDAsIHRoaXMuaW5kZXggKyAxKTtcblxuXHRcdHRoaXMuaGlzdG9yeS5wdXNoKHtcblx0XHRcdHR5cGU6dHlwZSxcblx0XHRcdGNvbXBvbmVudDpjb21wb25lbnQsXG5cdFx0XHRkYXRhOmRhdGEsXG5cdFx0fSk7XG5cblx0XHR0aGlzLmluZGV4ICsrO1xuXHR9XG5cblx0Z2V0SGlzdG9yeVVuZG9TaXplKCl7XG5cdFx0cmV0dXJuIHRoaXMuaW5kZXggKyAxO1xuXHR9XG5cblx0Z2V0SGlzdG9yeVJlZG9TaXplKCl7XG5cdFx0cmV0dXJuIHRoaXMuaGlzdG9yeS5sZW5ndGggLSAodGhpcy5pbmRleCArIDEpO1xuXHR9XG5cblx0Y2xlYXJDb21wb25lbnRIaXN0b3J5KGNvbXBvbmVudCl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy5oaXN0b3J5LmZpbmRJbmRleChmdW5jdGlvbihpdGVtKXtcblx0XHRcdHJldHVybiBpdGVtLmNvbXBvbmVudCA9PT0gY29tcG9uZW50O1xuXHRcdH0pO1xuXG5cdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHR0aGlzLmhpc3Rvcnkuc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdGlmKGluZGV4IDw9IHRoaXMuaW5kZXgpe1xuXHRcdFx0XHR0aGlzLmluZGV4LS07XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuY2xlYXJDb21wb25lbnRIaXN0b3J5KGNvbXBvbmVudCk7XG5cdFx0fVxuXHR9XG5cblx0dW5kbygpe1xuXHRcdGlmKHRoaXMuaW5kZXggPiAtMSl7XG5cdFx0XHRsZXQgYWN0aW9uID0gdGhpcy5oaXN0b3J5W3RoaXMuaW5kZXhdO1xuXG5cdFx0XHRIaXN0b3J5LnVuZG9lcnNbYWN0aW9uLnR5cGVdLmNhbGwodGhpcywgYWN0aW9uKTtcblxuXHRcdFx0dGhpcy5pbmRleC0tO1xuXG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJoaXN0b3J5VW5kb1wiLCBhY3Rpb24udHlwZSwgYWN0aW9uLmNvbXBvbmVudC5nZXRDb21wb25lbnQoKSwgYWN0aW9uLmRhdGEpO1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4odGhpcy5vcHRpb25zKFwiaGlzdG9yeVwiKSA/IFwiSGlzdG9yeSBVbmRvIEVycm9yIC0gTm8gbW9yZSBoaXN0b3J5IHRvIHVuZG9cIiA6IFwiSGlzdG9yeSBtb2R1bGUgbm90IGVuYWJsZWRcIik7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cblx0cmVkbygpe1xuXHRcdGlmKHRoaXMuaGlzdG9yeS5sZW5ndGgtMSA+IHRoaXMuaW5kZXgpe1xuXG5cdFx0XHR0aGlzLmluZGV4Kys7XG5cblx0XHRcdGxldCBhY3Rpb24gPSB0aGlzLmhpc3RvcnlbdGhpcy5pbmRleF07XG5cblx0XHRcdEhpc3RvcnkucmVkb2Vyc1thY3Rpb24udHlwZV0uY2FsbCh0aGlzLCBhY3Rpb24pO1xuXG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJoaXN0b3J5UmVkb1wiLCBhY3Rpb24udHlwZSwgYWN0aW9uLmNvbXBvbmVudC5nZXRDb21wb25lbnQoKSwgYWN0aW9uLmRhdGEpO1xuXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4odGhpcy5vcHRpb25zKFwiaGlzdG9yeVwiKSA/IFwiSGlzdG9yeSBSZWRvIEVycm9yIC0gTm8gbW9yZSBoaXN0b3J5IHRvIHJlZG9cIiA6IFwiSGlzdG9yeSBtb2R1bGUgbm90IGVuYWJsZWRcIik7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cblx0Ly9yZWJpbmQgcm93cyB0byBuZXcgZWxlbWVudCBhZnRlciBkZWxldGlvblxuXHRfcmViaW5kUm93KG9sZFJvdywgbmV3Um93KXtcblx0XHR0aGlzLmhpc3RvcnkuZm9yRWFjaChmdW5jdGlvbihhY3Rpb24pe1xuXHRcdFx0aWYoYWN0aW9uLmNvbXBvbmVudCBpbnN0YW5jZW9mIFJvdyl7XG5cdFx0XHRcdGlmKGFjdGlvbi5jb21wb25lbnQgPT09IG9sZFJvdyl7XG5cdFx0XHRcdFx0YWN0aW9uLmNvbXBvbmVudCA9IG5ld1Jvdztcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2UgaWYoYWN0aW9uLmNvbXBvbmVudCBpbnN0YW5jZW9mIENlbGwpe1xuXHRcdFx0XHRpZihhY3Rpb24uY29tcG9uZW50LnJvdyA9PT0gb2xkUm93KXtcblx0XHRcdFx0XHR2YXIgZmllbGQgPSBhY3Rpb24uY29tcG9uZW50LmNvbHVtbi5nZXRGaWVsZCgpO1xuXG5cdFx0XHRcdFx0aWYoZmllbGQpe1xuXHRcdFx0XHRcdFx0YWN0aW9uLmNvbXBvbmVudCA9IG5ld1Jvdy5nZXRDZWxsKGZpZWxkKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG59XG5cbmNsYXNzIEh0bWxUYWJsZUltcG9ydCBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwiaHRtbFRhYmxlSW1wb3J0XCI7XG5cblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblxuXHRcdHRoaXMuZmllbGRJbmRleCA9IFtdO1xuXHRcdHRoaXMuaGFzSW5kZXggPSBmYWxzZTtcblx0fVxuXG5cdGluaXRpYWxpemUoKXtcblx0XHR0aGlzLnRhYmxlRWxlbWVudENoZWNrKCk7XG5cdH1cblxuXHR0YWJsZUVsZW1lbnRDaGVjaygpe1xuXHRcdGlmKHRoaXMudGFibGUub3JpZ2luYWxFbGVtZW50ICYmIHRoaXMudGFibGUub3JpZ2luYWxFbGVtZW50LnRhZ05hbWUgPT09IFwiVEFCTEVcIil7XG5cdFx0XHRpZih0aGlzLnRhYmxlLm9yaWdpbmFsRWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aCl7XG5cdFx0XHRcdHRoaXMucGFyc2VUYWJsZSgpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVbmFibGUgdG8gcGFyc2UgZGF0YSBmcm9tIGVtcHR5IHRhYmxlIHRhZywgVGFidWxhdG9yIHNob3VsZCBiZSBpbml0aWFsaXplZCBvbiBhIGRpdiB0YWcgdW5sZXNzIGltcG9ydGluZyBkYXRhIGZyb20gYSB0YWJsZSBlbGVtZW50LlwiKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRwYXJzZVRhYmxlKCl7XG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLnRhYmxlLm9yaWdpbmFsRWxlbWVudCxcblx0XHRvcHRpb25zID0gdGhpcy50YWJsZS5vcHRpb25zLFxuXHRcdGhlYWRlcnMgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGhcIiksXG5cdFx0cm93cyA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJ0Ym9keVwiKVswXSxcblx0XHRkYXRhID0gW107XG5cblx0XHR0aGlzLmhhc0luZGV4ID0gZmFsc2U7XG5cblx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJodG1sSW1wb3J0aW5nXCIpO1xuXG5cdFx0cm93cyA9IHJvd3MgPyByb3dzLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidHJcIikgOiBbXTtcblxuXHRcdC8vY2hlY2sgZm9yIFRhYnVsYXRvciBpbmxpbmUgb3B0aW9uc1xuXHRcdHRoaXMuX2V4dHJhY3RPcHRpb25zKGVsZW1lbnQsIG9wdGlvbnMpO1xuXG5cdFx0aWYoaGVhZGVycy5sZW5ndGgpe1xuXHRcdFx0dGhpcy5fZXh0cmFjdEhlYWRlcnMoaGVhZGVycywgcm93cyk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5fZ2VuZXJhdGVCbGFua0hlYWRlcnMoaGVhZGVycywgcm93cyk7XG5cdFx0fVxuXG5cdFx0Ly9pdGVyYXRlIHRocm91Z2ggdGFibGUgcm93cyBhbmQgYnVpbGQgZGF0YSBzZXRcblx0XHRmb3IodmFyIGluZGV4ID0gMDsgaW5kZXggPCByb3dzLmxlbmd0aDsgaW5kZXgrKyl7XG5cdFx0XHR2YXIgcm93ID0gcm93c1tpbmRleF0sXG5cdFx0XHRjZWxscyA9IHJvdy5nZXRFbGVtZW50c0J5VGFnTmFtZShcInRkXCIpLFxuXHRcdFx0aXRlbSA9IHt9O1xuXG5cdFx0XHQvL2NyZWF0ZSBpbmRleCBpZiB0aGUgZG9uJ3QgZXhpc3QgaW4gdGFibGVcblx0XHRcdGlmKCF0aGlzLmhhc0luZGV4KXtcblx0XHRcdFx0aXRlbVtvcHRpb25zLmluZGV4XSA9IGluZGV4O1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IodmFyIGkgPSAwOyBpIDwgY2VsbHMubGVuZ3RoOyBpKyspe1xuXHRcdFx0XHR2YXIgY2VsbCA9IGNlbGxzW2ldO1xuXHRcdFx0XHRpZih0eXBlb2YgdGhpcy5maWVsZEluZGV4W2ldICE9PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRpdGVtW3RoaXMuZmllbGRJbmRleFtpXV0gPSBjZWxsLmlubmVySFRNTDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL2FkZCByb3cgZGF0YSB0byBpdGVtXG5cdFx0XHRkYXRhLnB1c2goaXRlbSk7XG5cdFx0fVxuXG5cdFx0b3B0aW9ucy5kYXRhID0gZGF0YTtcblxuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImh0bWxJbXBvcnRlZFwiKTtcblx0fVxuXG5cdC8vZXh0cmFjdCB0YWJ1bGF0b3IgYXR0cmlidXRlIG9wdGlvbnNcblx0X2V4dHJhY3RPcHRpb25zKGVsZW1lbnQsIG9wdGlvbnMsIGRlZmF1bHRPcHRpb25zKXtcblx0XHR2YXIgYXR0cmlidXRlcyA9IGVsZW1lbnQuYXR0cmlidXRlcztcblx0XHR2YXIgb3B0aW9uc0FyciA9IGRlZmF1bHRPcHRpb25zID8gT2JqZWN0LmtleXMoZGVmYXVsdE9wdGlvbnMpIDogT2JqZWN0LmtleXMob3B0aW9ucyk7XG5cdFx0dmFyIG9wdGlvbnNMaXN0ID0ge307XG5cblx0XHRvcHRpb25zQXJyLmZvckVhY2goKGl0ZW0pID0+IHtcblx0XHRcdG9wdGlvbnNMaXN0W2l0ZW0udG9Mb3dlckNhc2UoKV0gPSBpdGVtO1xuXHRcdH0pO1xuXG5cdFx0Zm9yKHZhciBpbmRleCBpbiBhdHRyaWJ1dGVzKXtcblx0XHRcdHZhciBhdHRyaWIgPSBhdHRyaWJ1dGVzW2luZGV4XTtcblx0XHRcdHZhciBuYW1lO1xuXG5cdFx0XHRpZihhdHRyaWIgJiYgdHlwZW9mIGF0dHJpYiA9PSBcIm9iamVjdFwiICYmIGF0dHJpYi5uYW1lICYmIGF0dHJpYi5uYW1lLmluZGV4T2YoXCJ0YWJ1bGF0b3ItXCIpID09PSAwKXtcblx0XHRcdFx0bmFtZSA9IGF0dHJpYi5uYW1lLnJlcGxhY2UoXCJ0YWJ1bGF0b3ItXCIsIFwiXCIpO1xuXG5cdFx0XHRcdGlmKHR5cGVvZiBvcHRpb25zTGlzdFtuYW1lXSAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRcdFx0b3B0aW9uc1tvcHRpb25zTGlzdFtuYW1lXV0gPSB0aGlzLl9hdHRyaWJWYWx1ZShhdHRyaWIudmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly9nZXQgdmFsdWUgb2YgYXR0cmlidXRlXG5cdF9hdHRyaWJWYWx1ZSh2YWx1ZSl7XG5cdFx0aWYodmFsdWUgPT09IFwidHJ1ZVwiKXtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblxuXHRcdGlmKHZhbHVlID09PSBcImZhbHNlXCIpe1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdHJldHVybiB2YWx1ZTtcblx0fVxuXG5cdC8vZmluZCBjb2x1bW4gaWYgaXQgaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkXG5cdF9maW5kQ29sKHRpdGxlKXtcblx0XHR2YXIgbWF0Y2ggPSB0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucy5maW5kKChjb2x1bW4pID0+IHtcblx0XHRcdHJldHVybiBjb2x1bW4udGl0bGUgPT09IHRpdGxlO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIG1hdGNoIHx8IGZhbHNlO1xuXHR9XG5cblx0Ly9leHRyYWN0IGNvbHVtbiBmcm9tIGhlYWRlcnNcblx0X2V4dHJhY3RIZWFkZXJzKGhlYWRlcnMsIHJvd3Mpe1xuXHRcdGZvcih2YXIgaW5kZXggPSAwOyBpbmRleCA8IGhlYWRlcnMubGVuZ3RoOyBpbmRleCsrKXtcblx0XHRcdHZhciBoZWFkZXIgPSBoZWFkZXJzW2luZGV4XSxcblx0XHRcdGV4aXN0cyA9IGZhbHNlLFxuXHRcdFx0Y29sID0gdGhpcy5fZmluZENvbChoZWFkZXIudGV4dENvbnRlbnQpLFxuXHRcdFx0d2lkdGg7XG5cblx0XHRcdGlmKGNvbCl7XG5cdFx0XHRcdGV4aXN0cyA9IHRydWU7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbCA9IHt0aXRsZTpoZWFkZXIudGV4dENvbnRlbnQudHJpbSgpfTtcblx0XHRcdH1cblxuXHRcdFx0aWYoIWNvbC5maWVsZCkge1xuXHRcdFx0XHRjb2wuZmllbGQgPSBoZWFkZXIudGV4dENvbnRlbnQudHJpbSgpLnRvTG93ZXJDYXNlKCkucmVwbGFjZUFsbChcIiBcIiwgXCJfXCIpO1xuXHRcdFx0fVxuXG5cdFx0XHR3aWR0aCA9IGhlYWRlci5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKTtcblxuXHRcdFx0aWYod2lkdGggJiYgIWNvbC53aWR0aClcdHtcblx0XHRcdFx0Y29sLndpZHRoID0gd2lkdGg7XG5cdFx0XHR9XG5cblx0XHRcdC8vY2hlY2sgZm9yIFRhYnVsYXRvciBpbmxpbmUgb3B0aW9uc1xuXHRcdFx0dGhpcy5fZXh0cmFjdE9wdGlvbnMoaGVhZGVyLCBjb2wsIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5vcHRpb25zTGlzdC5yZWdpc3RlcmVkRGVmYXVsdHMpO1xuXG5cdFx0XHR0aGlzLmZpZWxkSW5kZXhbaW5kZXhdID0gY29sLmZpZWxkO1xuXG5cdFx0XHRpZihjb2wuZmllbGQgPT0gdGhpcy50YWJsZS5vcHRpb25zLmluZGV4KXtcblx0XHRcdFx0dGhpcy5oYXNJbmRleCA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmKCFleGlzdHMpe1xuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucy5wdXNoKGNvbCk7XG5cdFx0XHR9XG5cblx0XHR9XG5cdH1cblxuXHQvL2dlbmVyYXRlIGJsYW5rIGhlYWRlcnNcblx0X2dlbmVyYXRlQmxhbmtIZWFkZXJzKGhlYWRlcnMsIHJvd3Mpe1xuXHRcdGZvcih2YXIgaW5kZXggPSAwOyBpbmRleCA8IGhlYWRlcnMubGVuZ3RoOyBpbmRleCsrKXtcblx0XHRcdHZhciBoZWFkZXIgPSBoZWFkZXJzW2luZGV4XSxcblx0XHRcdGNvbCA9IHt0aXRsZTpcIlwiLCBmaWVsZDpcImNvbFwiICsgaW5kZXh9O1xuXG5cdFx0XHR0aGlzLmZpZWxkSW5kZXhbaW5kZXhdID0gY29sLmZpZWxkO1xuXG5cdFx0XHR2YXIgd2lkdGggPSBoZWFkZXIuZ2V0QXR0cmlidXRlKFwid2lkdGhcIik7XG5cblx0XHRcdGlmKHdpZHRoKXtcblx0XHRcdFx0Y29sLndpZHRoID0gd2lkdGg7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5zLnB1c2goY29sKTtcblx0XHR9XG5cdH1cbn1cblxuZnVuY3Rpb24gY3N2KGlucHV0KXtcblx0dmFyIGRhdGEgPSBbXSxcblx0cm93ID0gMCwgXG5cdGNvbCA9IDAsXG5cdGluUXVvdGUgPSBmYWxzZTtcbiAgICBcblx0Ly9JdGVyYXRlIG92ZXIgZWFjaCBjaGFyYWN0ZXJcblx0Zm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGlucHV0Lmxlbmd0aDsgaW5kZXgrKykge1xuXHRcdGxldCBjaGFyID0gaW5wdXRbaW5kZXhdLCBcblx0XHRuZXh0Q2hhciA9IGlucHV0W2luZGV4KzFdOyAgICAgIFxuICAgICAgICBcblx0XHQvL0luaXRpYWxpemUgZW1wdHkgcm93XG5cdFx0aWYoIWRhdGFbcm93XSl7XG5cdFx0XHRkYXRhW3Jvd10gPSBbXTtcblx0XHR9XG5cblx0XHQvL0luaXRpYWxpemUgZW1wdHkgY29sdW1uXG5cdFx0aWYoIWRhdGFbcm93XVtjb2xdKXtcblx0XHRcdGRhdGFbcm93XVtjb2xdID0gXCJcIjtcblx0XHR9XG4gICAgICAgIFxuXHRcdC8vSGFuZGxlIHF1b3RhdGlvbiBtYXJrIGluc2lkZSBzdHJpbmdcblx0XHRpZiAoY2hhciA9PSAnXCInICYmIGluUXVvdGUgJiYgbmV4dENoYXIgPT0gJ1wiJykgeyBcblx0XHRcdGRhdGFbcm93XVtjb2xdICs9IGNoYXI7IFxuXHRcdFx0aW5kZXgrKztcblx0XHRcdGNvbnRpbnVlOyBcblx0XHR9XG4gICAgICAgIFxuXHRcdC8vQmVnaW4gLyBFbmQgUXVvdGVcblx0XHRpZiAoY2hhciA9PSAnXCInKSB7IFxuXHRcdFx0aW5RdW90ZSA9ICFpblF1b3RlO1xuXHRcdFx0Y29udGludWU7XG5cdFx0fVxuICAgICAgICBcblx0XHQvL05leHQgY29sdW1uIChpZiBub3QgaW4gcXVvdGUpXG5cdFx0aWYgKGNoYXIgPT0gJywnICYmICFpblF1b3RlKSB7IFxuXHRcdFx0Y29sKys7XG5cdFx0XHRjb250aW51ZTsgXG5cdFx0fVxuICAgICAgICBcblx0XHQvL05ldyByb3cgaWYgbmV3IGxpbmUgYW5kIG5vdCBpbiBxdW90ZSAoQ1JMRikgXG5cdFx0aWYgKGNoYXIgPT0gJ1xccicgJiYgbmV4dENoYXIgPT0gJ1xcbicgJiYgIWluUXVvdGUpIHsgXG5cdFx0XHRjb2wgPSAwOyBcblx0XHRcdHJvdysrOyBcblx0XHRcdGluZGV4Kys7IFxuXHRcdFx0Y29udGludWU7IFxuXHRcdH1cbiAgICAgICAgXG5cdFx0Ly9OZXcgcm93IGlmIG5ldyBsaW5lIGFuZCBub3QgaW4gcXVvdGUgKENSIG9yIExGKSBcblx0XHRpZiAoKGNoYXIgPT0gJ1xccicgfHwgY2hhciA9PSAnXFxuJykgJiYgIWluUXVvdGUpIHsgXG5cdFx0XHRjb2wgPSAwO1xuXHRcdFx0cm93Kys7XG5cdFx0XHRjb250aW51ZTsgXG5cdFx0fVxuXG5cdFx0Ly9Ob3JtYWwgQ2hhcmFjdGVyLCBhcHBlbmQgdG8gY29sdW1uXG5cdFx0ZGF0YVtyb3ddW2NvbF0gKz0gY2hhcjtcblx0fVxuXG5cdHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBqc29uKGlucHV0KXtcblx0dHJ5IHtcblx0XHRyZXR1cm4gSlNPTi5wYXJzZShpbnB1dCk7XG5cdH0gY2F0Y2goZSkge1xuXHRcdGNvbnNvbGUud2FybihcIkpTT04gSW1wb3J0IEVycm9yIC0gRmlsZSBjb250ZW50cyBpcyBpbnZhbGlkIEpTT05cIiwgZSk7XG5cdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gYXJyYXkkMSAoaW5wdXQpe1xuXHRyZXR1cm4gaW5wdXQ7XG59XG5cbmZ1bmN0aW9uIHhsc3goaW5wdXQpe1xyXG5cdHZhciBYTFNYTGliID0gdGhpcy5kZXBlbmRlbmN5UmVnaXN0cnkubG9va3VwKFwiWExTWFwiKSxcclxuXHR3b3JrYm9vazIgPSBYTFNYTGliLnJlYWQoaW5wdXQpLFxyXG5cdHNoZWV0ID0gd29ya2Jvb2syLlNoZWV0c1t3b3JrYm9vazIuU2hlZXROYW1lc1swXV07XHJcblx0XHJcblx0cmV0dXJuIFhMU1hMaWIudXRpbHMuc2hlZXRfdG9fanNvbihzaGVldCwge2hlYWRlcjogMSB9KTtcclxufVxuXG52YXIgZGVmYXVsdEltcG9ydGVycyA9IHtcblx0Y3N2OmNzdixcblx0anNvbjpqc29uLFxuXHRhcnJheTphcnJheSQxLFxuXHR4bHN4Onhsc3gsXG59O1xuXG5jbGFzcyBJbXBvcnQgZXh0ZW5kcyBNb2R1bGV7XG5cdFxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwiaW1wb3J0XCI7XG5cdFxuXHQvL2xvYWQgZGVmYXVsdHNcblx0c3RhdGljIGltcG9ydGVycyA9IGRlZmF1bHRJbXBvcnRlcnM7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImltcG9ydEZvcm1hdFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJpbXBvcnRSZWFkZXJcIiwgXCJ0ZXh0XCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImltcG9ydEhlYWRlclRyYW5zZm9ybVwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJpbXBvcnRWYWx1ZVRyYW5zZm9ybVwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJpbXBvcnREYXRhVmFsaWRhdG9yXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImltcG9ydEZpbGVWYWxpZGF0b3JcIik7XG5cdH1cblx0XG5cdGluaXRpYWxpemUoKXtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImltcG9ydFwiLCB0aGlzLmltcG9ydEZyb21GaWxlLmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5pbXBvcnRGb3JtYXQpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLWxvYWRpbmdcIiwgdGhpcy5sb2FkRGF0YUNoZWNrLmJpbmQodGhpcyksIDEwKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiZGF0YS1sb2FkXCIsIHRoaXMubG9hZERhdGEuYmluZCh0aGlzKSwgMTApO1xuXHRcdH1cblx0fVxuXHRcblx0bG9hZERhdGFDaGVjayhkYXRhKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5vcHRpb25zLmltcG9ydEZvcm1hdCAmJiAodHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIgfHwgKEFycmF5LmlzQXJyYXkoZGF0YSkgJiYgZGF0YS5sZW5ndGggJiYgQXJyYXkuaXNBcnJheShkYXRhKSkpO1xuXHR9XG5cdFxuXHRsb2FkRGF0YShkYXRhLCBwYXJhbXMsIGNvbmZpZywgc2lsZW50LCBwcmV2aW91c0RhdGEpe1xuXHRcdHJldHVybiB0aGlzLmltcG9ydERhdGEodGhpcy5sb29rdXBJbXBvcnRlcigpLCBkYXRhKVxuXHRcdFx0LnRoZW4odGhpcy5zdHJ1Y3R1cmVEYXRhLmJpbmQodGhpcykpXG5cdFx0XHQuY2F0Y2goKGVycikgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKFwiSW1wb3J0IEVycm9yOlwiLCBlcnIgfHwgXCJVbmFibGUgdG8gaW1wb3J0IGRhdGFcIik7XG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdH1cblx0XG5cdGxvb2t1cEltcG9ydGVyKGltcG9ydEZvcm1hdCl7XG5cdFx0dmFyIGltcG9ydGVyO1xuXHRcdFxuXHRcdGlmKCFpbXBvcnRGb3JtYXQpe1xuXHRcdFx0aW1wb3J0Rm9ybWF0ID0gdGhpcy50YWJsZS5vcHRpb25zLmltcG9ydEZvcm1hdDtcblx0XHR9XG5cdFx0XG5cdFx0aWYodHlwZW9mIGltcG9ydEZvcm1hdCA9PT0gXCJzdHJpbmdcIil7XG5cdFx0XHRpbXBvcnRlciA9IEltcG9ydC5pbXBvcnRlcnNbaW1wb3J0Rm9ybWF0XTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRpbXBvcnRlciA9IGltcG9ydEZvcm1hdDtcblx0XHR9XG5cdFx0XG5cdFx0aWYoIWltcG9ydGVyKXtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJJbXBvcnQgRXJyb3IgLSBJbXBvcnRlciBub3QgZm91bmQ6XCIsIGltcG9ydEZvcm1hdCk7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBpbXBvcnRlcjtcblx0fVxuXHRcblx0aW1wb3J0RnJvbUZpbGUoaW1wb3J0Rm9ybWF0LCBleHRlbnNpb24sIGltcG9ydFJlYWRlcil7XG5cdFx0dmFyIGltcG9ydGVyID0gdGhpcy5sb29rdXBJbXBvcnRlcihpbXBvcnRGb3JtYXQpO1xuXHRcdFxuXHRcdGlmKGltcG9ydGVyKXtcblx0XHRcdHJldHVybiB0aGlzLnBpY2tGaWxlKGV4dGVuc2lvbiwgaW1wb3J0UmVhZGVyKVxuXHRcdFx0XHQudGhlbih0aGlzLmltcG9ydERhdGEuYmluZCh0aGlzLCBpbXBvcnRlcikpXG5cdFx0XHRcdC50aGVuKHRoaXMuc3RydWN0dXJlRGF0YS5iaW5kKHRoaXMpKVxuXHRcdFx0XHQudGhlbih0aGlzLm11dGF0ZURhdGEuYmluZCh0aGlzKSlcblx0XHRcdFx0LnRoZW4odGhpcy52YWxpZGF0ZURhdGEuYmluZCh0aGlzKSlcblx0XHRcdFx0LnRoZW4odGhpcy5zZXREYXRhLmJpbmQodGhpcykpXG5cdFx0XHRcdC5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5kaXNwYXRjaChcImltcG9ydC1lcnJvclwiLCBlcnIpO1xuXHRcdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImltcG9ydEVycm9yXCIsIGVycik7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcIkltcG9ydCBFcnJvcjpcIiwgZXJyIHx8IFwiVW5hYmxlIHRvIGltcG9ydCBmaWxlXCIpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMudGFibGUuZGF0YUxvYWRlci5hbGVydEVycm9yKCk7XG5cblx0XHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRcdHRoaXMudGFibGUuZGF0YUxvYWRlci5jbGVhckFsZXJ0KCk7XG5cdFx0XHRcdFx0fSwgMzAwMCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXHRcblx0cGlja0ZpbGUoZXh0ZW5zaW9ucywgaW1wb3J0UmVhZGVyKXtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0dmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuXHRcdFx0aW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuXHRcdFx0aW5wdXQuYWNjZXB0ID0gZXh0ZW5zaW9ucztcblx0XHRcdFxuXHRcdFx0aW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZSkgPT4ge1xuXHRcdFx0XHR2YXIgZmlsZSA9IGlucHV0LmZpbGVzWzBdLFxuXHRcdFx0XHRyZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpLFxuXHRcdFx0XHR2YWxpZCA9IHRoaXMudmFsaWRhdGVGaWxlKGZpbGUpO1xuXG5cdFx0XHRcdGlmKHZhbGlkID09PSB0cnVlKXtcblx0XHRcdFx0XG5cdFx0XHRcdFx0dGhpcy5kaXNwYXRjaChcImltcG9ydC1pbXBvcnRpbmdcIiwgaW5wdXQuZmlsZXMpO1xuXHRcdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImltcG9ydEltcG9ydGluZ1wiLCBpbnB1dC5maWxlcyk7XG5cdFx0XHRcdFxuXHRcdFx0XHRcdHN3aXRjaChpbXBvcnRSZWFkZXIgfHwgdGhpcy50YWJsZS5vcHRpb25zLmltcG9ydFJlYWRlcil7XG5cdFx0XHRcdFx0XHRjYXNlIFwiYnVmZmVyXCI6XG5cdFx0XHRcdFx0XHRcdHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGNhc2UgXCJiaW5hcnlcIjpcblx0XHRcdFx0XHRcdFx0cmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGNhc2UgXCJ1cmxcIjpcblx0XHRcdFx0XHRcdFx0cmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRjYXNlIFwidGV4dFwiOlxuXHRcdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdFx0cmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHJlYWRlci5vbmxvYWQgPSAoZSkgPT4ge1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShyZWFkZXIucmVzdWx0KTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHJlYWRlci5vbmVycm9yID0gKGUpID0+IHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkZpbGUgTG9hZCBFcnJvciAtIFVuYWJsZSB0byByZWFkIGZpbGVcIik7XG5cdFx0XHRcdFx0XHRyZWplY3QoZSk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHJlamVjdCh2YWxpZCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwiaW1wb3J0LWNob29zZVwiKTtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImltcG9ydENob29zZVwiKTtcblx0XHRcdGlucHV0LmNsaWNrKCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdGltcG9ydERhdGEoaW1wb3J0ZXIsIGZpbGVDb250ZW50cyl7XG5cdFx0dmFyIGRhdGE7XG5cdFx0XG5cdFx0dGhpcy50YWJsZS5kYXRhTG9hZGVyLmFsZXJ0TG9hZGVyKCk7XG5cdFx0XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRkYXRhID0gaW1wb3J0ZXIuY2FsbCh0aGlzLnRhYmxlLCBmaWxlQ29udGVudHMpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoZGF0YSBpbnN0YW5jZW9mIFByb21pc2Upe1xuXHRcdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRkYXRhID8gcmVzb2x2ZShkYXRhKSA6IHJlamVjdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCAxMCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdHN0cnVjdHVyZURhdGEocGFyc2VkRGF0YSl7XG5cdFx0dmFyIGRhdGEgPSBbXTtcblx0XHRcblx0XHRpZihBcnJheS5pc0FycmF5KHBhcnNlZERhdGEpICYmIHBhcnNlZERhdGEubGVuZ3RoICYmIEFycmF5LmlzQXJyYXkocGFyc2VkRGF0YVswXSkpe1xuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmF1dG9Db2x1bW5zKXtcblx0XHRcdFx0ZGF0YSA9IHRoaXMuc3RydWN0dXJlQXJyYXlUb09iamVjdChwYXJzZWREYXRhKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0ZGF0YSA9IHRoaXMuc3RydWN0dXJlQXJyYXlUb0NvbHVtbnMocGFyc2VkRGF0YSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHJldHVybiBkYXRhO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiBwYXJzZWREYXRhO1xuXHRcdH1cblx0fVxuXHRcblx0bXV0YXRlRGF0YShkYXRhKXtcblx0XHR2YXIgb3V0cHV0ID0gW107XG5cdFx0XG5cdFx0aWYoQXJyYXkuaXNBcnJheShkYXRhKSl7XG5cdFx0XHRkYXRhLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0XHRvdXRwdXQucHVzaCh0aGlzLnRhYmxlLm1vZHVsZXMubXV0YXRvci50cmFuc2Zvcm1Sb3cocm93LCBcImltcG9ydFwiKSk7XG5cdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRvdXRwdXQgPSBkYXRhO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHR0cmFuc2Zvcm1IZWFkZXIoaGVhZGVycyl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5pbXBvcnRIZWFkZXJUcmFuc2Zvcm0pe1xuXHRcdFx0aGVhZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG5cdFx0XHRcdG91dHB1dC5wdXNoKHRoaXMudGFibGUub3B0aW9ucy5pbXBvcnRIZWFkZXJUcmFuc2Zvcm0uY2FsbCh0aGlzLnRhYmxlLCBpdGVtLCBoZWFkZXJzKSk7XG5cdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRyZXR1cm4gaGVhZGVycztcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXHRcblx0dHJhbnNmb3JtRGF0YShyb3cpe1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5pbXBvcnRWYWx1ZVRyYW5zZm9ybSl7XG5cdFx0XHRyb3cuZm9yRWFjaCgoaXRlbSkgPT4ge1xuXHRcdFx0XHRvdXRwdXQucHVzaCh0aGlzLnRhYmxlLm9wdGlvbnMuaW1wb3J0VmFsdWVUcmFuc2Zvcm0uY2FsbCh0aGlzLnRhYmxlLCBpdGVtLCByb3cpKTtcblx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiByb3c7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH1cblx0XG5cdHN0cnVjdHVyZUFycmF5VG9PYmplY3QocGFyc2VkRGF0YSl7XG5cdFx0dmFyIGNvbHVtbnMgPSB0aGlzLnRyYW5zZm9ybUhlYWRlcihwYXJzZWREYXRhLnNoaWZ0KCkpO1x0XG5cdFx0XG5cdFx0dmFyIGRhdGEgPSBwYXJzZWREYXRhLm1hcCgodmFsdWVzKSA9PiB7XG5cdFx0XHR2YXIgcm93ID0ge307XG5cblx0XHRcdHZhbHVlcyA9IHRoaXMudHJhbnNmb3JtRGF0YSh2YWx1ZXMpO1xuXHRcdFx0XG5cdFx0XHRjb2x1bW5zLmZvckVhY2goKGtleSwgaSkgPT4ge1xuXHRcdFx0XHRyb3dba2V5XSA9IHZhbHVlc1tpXTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRyZXR1cm4gcm93O1xuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBkYXRhO1xuXHR9XG5cdFxuXHRzdHJ1Y3R1cmVBcnJheVRvQ29sdW1ucyhwYXJzZWREYXRhKXtcblx0XHR2YXIgZGF0YSA9IFtdLFxuXHRcdGZpcnN0Um93ID0gdGhpcy50cmFuc2Zvcm1IZWFkZXIocGFyc2VkRGF0YVswXSksXG5cdFx0Y29sdW1ucyA9IHRoaXMudGFibGUuZ2V0Q29sdW1ucygpO1xuXHRcdFxuXHRcdC8vcmVtb3ZlIGZpcnN0IHJvdyBpZiBpdCBpcyB0aGUgY29sdW1uIG5hbWVzXG5cdFx0aWYoY29sdW1uc1swXSAmJiBmaXJzdFJvd1swXSl7XG5cdFx0XHRpZihjb2x1bW5zWzBdLmdldERlZmluaXRpb24oKS50aXRsZSA9PT0gZmlyc3RSb3dbMF0pe1xuXHRcdFx0XHRwYXJzZWREYXRhLnNoaWZ0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdC8vY29udmVydCByb3cgYXJyYXlzIHRvIG9iamVjdHNcblx0XHRwYXJzZWREYXRhLmZvckVhY2goKHJvd0RhdGEpID0+IHtcblx0XHRcdHZhciByb3cgPSB7fTtcblxuXHRcdFx0cm93RGF0YSA9IHRoaXMudHJhbnNmb3JtRGF0YShyb3dEYXRhKTtcblx0XHRcdFxuXHRcdFx0cm93RGF0YS5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHtcblx0XHRcdFx0dmFyIGNvbHVtbiA9IGNvbHVtbnNbaW5kZXhdO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoY29sdW1uKXtcblx0XHRcdFx0XHRyb3dbY29sdW1uLmdldEZpZWxkKCldID0gdmFsdWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRkYXRhLnB1c2gocm93KTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gZGF0YTtcblx0fVxuXG5cdHZhbGlkYXRlRmlsZShmaWxlKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuaW1wb3J0RmlsZVZhbGlkYXRvcil7XG5cdFx0XHRyZXR1cm4gdGhpcy50YWJsZS5vcHRpb25zLmltcG9ydEZpbGVWYWxpZGF0b3IuY2FsbCh0aGlzLnRhYmxlLCBmaWxlKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdHZhbGlkYXRlRGF0YShkYXRhKXtcblx0XHR2YXIgcmVzdWx0O1xuXG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmltcG9ydERhdGFWYWxpZGF0b3Ipe1xuXHRcdFx0cmVzdWx0ID0gdGhpcy50YWJsZS5vcHRpb25zLmltcG9ydERhdGFWYWxpZGF0b3IuY2FsbCh0aGlzLnRhYmxlLCBkYXRhKTtcblxuXHRcdFx0aWYocmVzdWx0ID09PSB0cnVlKXtcblx0XHRcdFx0cmV0dXJuIGRhdGE7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChyZXN1bHQpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9XG5cdFxuXHRzZXREYXRhKGRhdGEpe1xuXHRcdHRoaXMuZGlzcGF0Y2goXCJpbXBvcnQtaW1wb3J0ZWRcIiwgZGF0YSk7XG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiaW1wb3J0SW1wb3J0ZWRcIiwgZGF0YSk7XG5cdFx0XG5cdFx0dGhpcy50YWJsZS5kYXRhTG9hZGVyLmNsZWFyQWxlcnQoKTtcblx0XHRcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5zZXREYXRhKGRhdGEpO1xuXHR9XG59XG5cbmNsYXNzIEludGVyYWN0aW9uIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJpbnRlcmFjdGlvblwiO1xuXG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cblx0XHR0aGlzLmV2ZW50TWFwID0ge1xuXHRcdFx0Ly9yb3cgZXZlbnRzXG5cdFx0XHRyb3dDbGljazpcInJvdy1jbGlja1wiLFxuXHRcdFx0cm93RGJsQ2xpY2s6XCJyb3ctZGJsY2xpY2tcIixcblx0XHRcdHJvd0NvbnRleHQ6XCJyb3ctY29udGV4dG1lbnVcIixcblx0XHRcdHJvd01vdXNlRW50ZXI6XCJyb3ctbW91c2VlbnRlclwiLFxuXHRcdFx0cm93TW91c2VMZWF2ZTpcInJvdy1tb3VzZWxlYXZlXCIsXG5cdFx0XHRyb3dNb3VzZU92ZXI6XCJyb3ctbW91c2VvdmVyXCIsXG5cdFx0XHRyb3dNb3VzZU91dDpcInJvdy1tb3VzZW91dFwiLFxuXHRcdFx0cm93TW91c2VNb3ZlOlwicm93LW1vdXNlbW92ZVwiLFxuXHRcdFx0cm93TW91c2VEb3duOlwicm93LW1vdXNlZG93blwiLFxuXHRcdFx0cm93TW91c2VVcDpcInJvdy1tb3VzZXVwXCIsXG5cdFx0XHRyb3dUYXA6XCJyb3dcIixcblx0XHRcdHJvd0RibFRhcDpcInJvd1wiLFxuXHRcdFx0cm93VGFwSG9sZDpcInJvd1wiLFxuXG5cdFx0XHQvL2NlbGwgZXZlbnRzXG5cdFx0XHRjZWxsQ2xpY2s6XCJjZWxsLWNsaWNrXCIsXG5cdFx0XHRjZWxsRGJsQ2xpY2s6XCJjZWxsLWRibGNsaWNrXCIsXG5cdFx0XHRjZWxsQ29udGV4dDpcImNlbGwtY29udGV4dG1lbnVcIixcblx0XHRcdGNlbGxNb3VzZUVudGVyOlwiY2VsbC1tb3VzZWVudGVyXCIsXG5cdFx0XHRjZWxsTW91c2VMZWF2ZTpcImNlbGwtbW91c2VsZWF2ZVwiLFxuXHRcdFx0Y2VsbE1vdXNlT3ZlcjpcImNlbGwtbW91c2VvdmVyXCIsXG5cdFx0XHRjZWxsTW91c2VPdXQ6XCJjZWxsLW1vdXNlb3V0XCIsXG5cdFx0XHRjZWxsTW91c2VNb3ZlOlwiY2VsbC1tb3VzZW1vdmVcIixcblx0XHRcdGNlbGxNb3VzZURvd246XCJjZWxsLW1vdXNlZG93blwiLFxuXHRcdFx0Y2VsbE1vdXNlVXA6XCJjZWxsLW1vdXNldXBcIixcblx0XHRcdGNlbGxUYXA6XCJjZWxsXCIsXG5cdFx0XHRjZWxsRGJsVGFwOlwiY2VsbFwiLFxuXHRcdFx0Y2VsbFRhcEhvbGQ6XCJjZWxsXCIsXG5cblx0XHRcdC8vY29sdW1uIGhlYWRlciBldmVudHNcblx0XHRcdGhlYWRlckNsaWNrOlwiY29sdW1uLWNsaWNrXCIsXG5cdFx0XHRoZWFkZXJEYmxDbGljazpcImNvbHVtbi1kYmxjbGlja1wiLFxuXHRcdFx0aGVhZGVyQ29udGV4dDpcImNvbHVtbi1jb250ZXh0bWVudVwiLFxuXHRcdFx0aGVhZGVyTW91c2VFbnRlcjpcImNvbHVtbi1tb3VzZWVudGVyXCIsXG5cdFx0XHRoZWFkZXJNb3VzZUxlYXZlOlwiY29sdW1uLW1vdXNlbGVhdmVcIixcblx0XHRcdGhlYWRlck1vdXNlT3ZlcjpcImNvbHVtbi1tb3VzZW92ZXJcIixcblx0XHRcdGhlYWRlck1vdXNlT3V0OlwiY29sdW1uLW1vdXNlb3V0XCIsXG5cdFx0XHRoZWFkZXJNb3VzZU1vdmU6XCJjb2x1bW4tbW91c2Vtb3ZlXCIsXG5cdFx0XHRoZWFkZXJNb3VzZURvd246XCJjb2x1bW4tbW91c2Vkb3duXCIsXG5cdFx0XHRoZWFkZXJNb3VzZVVwOlwiY29sdW1uLW1vdXNldXBcIixcblx0XHRcdGhlYWRlclRhcDpcImNvbHVtblwiLFxuXHRcdFx0aGVhZGVyRGJsVGFwOlwiY29sdW1uXCIsXG5cdFx0XHRoZWFkZXJUYXBIb2xkOlwiY29sdW1uXCIsXG5cblx0XHRcdC8vZ3JvdXAgaGVhZGVyXG5cdFx0XHRncm91cENsaWNrOlwiZ3JvdXAtY2xpY2tcIixcblx0XHRcdGdyb3VwRGJsQ2xpY2s6XCJncm91cC1kYmxjbGlja1wiLFxuXHRcdFx0Z3JvdXBDb250ZXh0OlwiZ3JvdXAtY29udGV4dG1lbnVcIixcblx0XHRcdGdyb3VwTW91c2VFbnRlcjpcImdyb3VwLW1vdXNlZW50ZXJcIixcblx0XHRcdGdyb3VwTW91c2VMZWF2ZTpcImdyb3VwLW1vdXNlbGVhdmVcIixcblx0XHRcdGdyb3VwTW91c2VPdmVyOlwiZ3JvdXAtbW91c2VvdmVyXCIsXG5cdFx0XHRncm91cE1vdXNlT3V0OlwiZ3JvdXAtbW91c2VvdXRcIixcblx0XHRcdGdyb3VwTW91c2VNb3ZlOlwiZ3JvdXAtbW91c2Vtb3ZlXCIsXG5cdFx0XHRncm91cE1vdXNlRG93bjpcImdyb3VwLW1vdXNlZG93blwiLFxuXHRcdFx0Z3JvdXBNb3VzZVVwOlwiZ3JvdXAtbW91c2V1cFwiLFxuXHRcdFx0Z3JvdXBUYXA6XCJncm91cFwiLFxuXHRcdFx0Z3JvdXBEYmxUYXA6XCJncm91cFwiLFxuXHRcdFx0Z3JvdXBUYXBIb2xkOlwiZ3JvdXBcIixcblx0XHR9O1xuXG5cdFx0dGhpcy5zdWJzY3JpYmVycyA9IHt9O1xuXG5cdFx0dGhpcy50b3VjaFN1YnNjcmliZXJzID0ge307XG5cblx0XHR0aGlzLmNvbHVtblN1YnNjcmliZXJzID0ge307XG5cblx0XHR0aGlzLnRvdWNoV2F0Y2hlcnMgPSB7XG5cdFx0XHRyb3c6e1xuXHRcdFx0XHR0YXA6bnVsbCxcblx0XHRcdFx0dGFwRGJsOm51bGwsXG5cdFx0XHRcdHRhcEhvbGQ6bnVsbCxcblx0XHRcdH0sXG5cdFx0XHRjZWxsOntcblx0XHRcdFx0dGFwOm51bGwsXG5cdFx0XHRcdHRhcERibDpudWxsLFxuXHRcdFx0XHR0YXBIb2xkOm51bGwsXG5cdFx0XHR9LFxuXHRcdFx0Y29sdW1uOntcblx0XHRcdFx0dGFwOm51bGwsXG5cdFx0XHRcdHRhcERibDpudWxsLFxuXHRcdFx0XHR0YXBIb2xkOm51bGwsXG5cdFx0XHR9LFxuXHRcdFx0Z3JvdXA6e1xuXHRcdFx0XHR0YXA6bnVsbCxcblx0XHRcdFx0dGFwRGJsOm51bGwsXG5cdFx0XHRcdHRhcEhvbGQ6bnVsbCxcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckNsaWNrXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJEYmxDbGlja1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyQ29udGV4dFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyTW91c2VFbnRlclwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyTW91c2VMZWF2ZVwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyTW91c2VPdmVyXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJNb3VzZU91dFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyTW91c2VNb3ZlXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJNb3VzZURvd25cIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlck1vdXNlVXBcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlclRhcFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyRGJsVGFwXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJUYXBIb2xkXCIpO1xuXG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImNlbGxDbGlja1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiY2VsbERibENsaWNrXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJjZWxsQ29udGV4dFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiY2VsbE1vdXNlRW50ZXJcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImNlbGxNb3VzZUxlYXZlXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJjZWxsTW91c2VPdmVyXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJjZWxsTW91c2VPdXRcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImNlbGxNb3VzZU1vdmVcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImNlbGxNb3VzZURvd25cIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImNlbGxNb3VzZVVwXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJjZWxsVGFwXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJjZWxsRGJsVGFwXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJjZWxsVGFwSG9sZFwiKTtcblxuXHR9XG5cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuaW5pdGlhbGl6ZUV4dGVybmFsRXZlbnRzKCk7XG5cblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1pbml0XCIsIHRoaXMuaW5pdGlhbGl6ZUNvbHVtbi5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtZGJsY2xpY2tcIiwgdGhpcy5jZWxsQ29udGVudHNTZWxlY3Rpb25GaXhlci5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcInNjcm9sbC1ob3Jpem9udGFsXCIsIHRoaXMuY2xlYXJUb3VjaFdhdGNoZXJzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwic2Nyb2xsLXZlcnRpY2FsXCIsIHRoaXMuY2xlYXJUb3VjaFdhdGNoZXJzLmJpbmQodGhpcykpO1xuXHR9XG5cblx0Y2xlYXJUb3VjaFdhdGNoZXJzKCl7XG5cdFx0dmFyIHR5cGVzID0gT2JqZWN0LnZhbHVlcyh0aGlzLnRvdWNoV2F0Y2hlcnMpO1xuXG5cdFx0dHlwZXMuZm9yRWFjaCgodHlwZSkgPT4ge1xuXHRcdFx0Zm9yKGxldCBrZXkgaW4gdHlwZSl7XG5cdFx0XHRcdHR5cGVba2V5XSA9IG51bGw7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0XHRcblx0Y2VsbENvbnRlbnRzU2VsZWN0aW9uRml4ZXIoZSwgY2VsbCl7XG5cdFx0dmFyIHJhbmdlO1xuXG5cdFx0aWYodGhpcy50YWJsZS5tb2RFeGlzdHMoXCJlZGl0XCIpKXtcblx0XHRcdGlmICh0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbCA9PT0gY2VsbCl7XG5cdFx0XHRcdHJldHVybjsgLy9wcmV2ZW50IGluc3RhbnQgc2VsZWN0aW9uIG9mIGVkaXRvciBjb250ZW50XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0dHJ5e1xuXHRcdFx0aWYgKGRvY3VtZW50LnNlbGVjdGlvbikgeyAvLyBJRVxuXHRcdFx0XHRyYW5nZSA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG5cdFx0XHRcdHJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KGNlbGwuZ2V0RWxlbWVudCgpKTtcblx0XHRcdFx0cmFuZ2Uuc2VsZWN0KCk7XG5cdFx0XHR9IGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHtcblx0XHRcdFx0cmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuXHRcdFx0XHRyYW5nZS5zZWxlY3ROb2RlKGNlbGwuZ2V0RWxlbWVudCgpKTtcblx0XHRcdFx0d2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpO1xuXHRcdFx0XHR3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuYWRkUmFuZ2UocmFuZ2UpO1xuXHRcdFx0fVxuXHRcdH1jYXRjaChlKXt9XG5cdH1cblxuXHRpbml0aWFsaXplRXh0ZXJuYWxFdmVudHMoKXtcblx0XHRmb3IobGV0IGtleSBpbiB0aGlzLmV2ZW50TWFwKXtcblx0XHRcdHRoaXMuc3Vic2NyaXB0aW9uQ2hhbmdlRXh0ZXJuYWwoa2V5LCB0aGlzLnN1YnNjcmlwdGlvbkNoYW5nZWQuYmluZCh0aGlzLCBrZXkpKTtcblx0XHR9XG5cdH1cblxuXHRzdWJzY3JpcHRpb25DaGFuZ2VkKGtleSwgYWRkZWQpe1xuXHRcdGlmKGFkZGVkKXtcblx0XHRcdGlmKCF0aGlzLnN1YnNjcmliZXJzW2tleV0pe1xuXHRcdFx0XHRpZih0aGlzLmV2ZW50TWFwW2tleV0uaW5jbHVkZXMoXCItXCIpKXtcblx0XHRcdFx0XHR0aGlzLnN1YnNjcmliZXJzW2tleV0gPSB0aGlzLmhhbmRsZS5iaW5kKHRoaXMsIGtleSk7XG5cdFx0XHRcdFx0dGhpcy5zdWJzY3JpYmUodGhpcy5ldmVudE1hcFtrZXldLCB0aGlzLnN1YnNjcmliZXJzW2tleV0pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5zdWJzY3JpYmVUb3VjaEV2ZW50cyhrZXkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0aWYodGhpcy5ldmVudE1hcFtrZXldLmluY2x1ZGVzKFwiLVwiKSl7XG5cdFx0XHRcdGlmKHRoaXMuc3Vic2NyaWJlcnNba2V5XSAmJiAhdGhpcy5jb2x1bW5TdWJzY3JpYmVyc1trZXldICAmJiAhdGhpcy5zdWJzY3JpYmVkRXh0ZXJuYWwoa2V5KSl7XG5cdFx0XHRcdFx0dGhpcy51bnN1YnNjcmliZSh0aGlzLmV2ZW50TWFwW2tleV0sIHRoaXMuc3Vic2NyaWJlcnNba2V5XSk7XG5cdFx0XHRcdFx0ZGVsZXRlIHRoaXMuc3Vic2NyaWJlcnNba2V5XTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLnVuc3Vic2NyaWJlVG91Y2hFdmVudHMoa2V5KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXG5cdHN1YnNjcmliZVRvdWNoRXZlbnRzKGtleSl7XG5cdFx0dmFyIHR5cGUgPSB0aGlzLmV2ZW50TWFwW2tleV07XG5cblx0XHRpZighdGhpcy50b3VjaFN1YnNjcmliZXJzW3R5cGUgKyBcIi10b3VjaHN0YXJ0XCJdKXtcblx0XHRcdHRoaXMudG91Y2hTdWJzY3JpYmVyc1t0eXBlICsgXCItdG91Y2hzdGFydFwiXSA9IHRoaXMuaGFuZGxlVG91Y2guYmluZCh0aGlzLCB0eXBlLCBcInN0YXJ0XCIpO1xuXHRcdFx0dGhpcy50b3VjaFN1YnNjcmliZXJzW3R5cGUgKyBcIi10b3VjaGVuZFwiXSA9IHRoaXMuaGFuZGxlVG91Y2guYmluZCh0aGlzLCB0eXBlLCBcImVuZFwiKTtcblxuXHRcdFx0dGhpcy5zdWJzY3JpYmUodHlwZSArIFwiLXRvdWNoc3RhcnRcIiwgdGhpcy50b3VjaFN1YnNjcmliZXJzW3R5cGUgKyBcIi10b3VjaHN0YXJ0XCJdKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKHR5cGUgKyBcIi10b3VjaGVuZFwiLCB0aGlzLnRvdWNoU3Vic2NyaWJlcnNbdHlwZSArIFwiLXRvdWNoZW5kXCJdKTtcblx0XHR9XG5cblx0XHR0aGlzLnN1YnNjcmliZXJzW2tleV0gPSB0cnVlO1xuXHR9XG5cblx0dW5zdWJzY3JpYmVUb3VjaEV2ZW50cyhrZXkpe1xuXHRcdHZhciBub1RvdWNoID0gdHJ1ZSxcblx0XHR0eXBlID0gdGhpcy5ldmVudE1hcFtrZXldO1xuXG5cdFx0aWYodGhpcy5zdWJzY3JpYmVyc1trZXldICYmICF0aGlzLnN1YnNjcmliZWRFeHRlcm5hbChrZXkpKXtcblx0XHRcdGRlbGV0ZSB0aGlzLnN1YnNjcmliZXJzW2tleV07XG5cblx0XHRcdGZvcihsZXQgaSBpbiB0aGlzLmV2ZW50TWFwKXtcblx0XHRcdFx0aWYodGhpcy5ldmVudE1hcFtpXSA9PT0gdHlwZSl7XG5cdFx0XHRcdFx0aWYodGhpcy5zdWJzY3JpYmVyc1tpXSl7XG5cdFx0XHRcdFx0XHRub1RvdWNoID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmKG5vVG91Y2gpe1xuXHRcdFx0XHR0aGlzLnVuc3Vic2NyaWJlKHR5cGUgKyBcIi10b3VjaHN0YXJ0XCIsIHRoaXMudG91Y2hTdWJzY3JpYmVyc1t0eXBlICsgXCItdG91Y2hzdGFydFwiXSk7XG5cdFx0XHRcdHRoaXMudW5zdWJzY3JpYmUodHlwZSArIFwiLXRvdWNoZW5kXCIsIHRoaXMudG91Y2hTdWJzY3JpYmVyc1t0eXBlICsgXCItdG91Y2hlbmRcIl0pO1xuXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLnRvdWNoU3Vic2NyaWJlcnNbdHlwZSArIFwiLXRvdWNoc3RhcnRcIl07XG5cdFx0XHRcdGRlbGV0ZSB0aGlzLnRvdWNoU3Vic2NyaWJlcnNbdHlwZSArIFwiLXRvdWNoZW5kXCJdO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGluaXRpYWxpemVDb2x1bW4oY29sdW1uKXtcblx0XHR2YXIgZGVmID0gY29sdW1uLmRlZmluaXRpb247XG5cblx0XHRmb3IobGV0IGtleSBpbiB0aGlzLmV2ZW50TWFwKXtcblx0XHRcdGlmKGRlZltrZXldKXtcblx0XHRcdFx0dGhpcy5zdWJzY3JpcHRpb25DaGFuZ2VkKGtleSwgdHJ1ZSk7XG5cblx0XHRcdFx0aWYoIXRoaXMuY29sdW1uU3Vic2NyaWJlcnNba2V5XSl7XG5cdFx0XHRcdFx0dGhpcy5jb2x1bW5TdWJzY3JpYmVyc1trZXldID0gW107XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLmNvbHVtblN1YnNjcmliZXJzW2tleV0ucHVzaChjb2x1bW4pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGhhbmRsZShhY3Rpb24sIGUsIGNvbXBvbmVudCl7XG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KGFjdGlvbiwgZSwgY29tcG9uZW50KTtcblx0fVxuXG5cdGhhbmRsZVRvdWNoKHR5cGUsIGFjdGlvbiwgZSwgY29tcG9uZW50KXtcblx0XHR2YXIgd2F0Y2hlcnMgPSB0aGlzLnRvdWNoV2F0Y2hlcnNbdHlwZV07XG5cblx0XHRpZih0eXBlID09PSBcImNvbHVtblwiKXtcblx0XHRcdHR5cGUgPSBcImhlYWRlclwiO1xuXHRcdH1cblxuXHRcdHN3aXRjaChhY3Rpb24pe1xuXHRcdFx0Y2FzZSBcInN0YXJ0XCI6XG5cdFx0XHRcdHdhdGNoZXJzLnRhcCA9IHRydWU7XG5cblx0XHRcdFx0Y2xlYXJUaW1lb3V0KHdhdGNoZXJzLnRhcEhvbGQpO1xuXG5cdFx0XHRcdHdhdGNoZXJzLnRhcEhvbGQgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRjbGVhclRpbWVvdXQod2F0Y2hlcnMudGFwSG9sZCk7XG5cdFx0XHRcdFx0d2F0Y2hlcnMudGFwSG9sZCA9IG51bGw7XG5cblx0XHRcdFx0XHR3YXRjaGVycy50YXAgPSBudWxsO1xuXHRcdFx0XHRcdGNsZWFyVGltZW91dCh3YXRjaGVycy50YXBEYmwpO1xuXHRcdFx0XHRcdHdhdGNoZXJzLnRhcERibCA9IG51bGw7XG5cblx0XHRcdFx0XHR0aGlzLmRpc3BhdGNoRXZlbnQodHlwZSArIFwiVGFwSG9sZFwiLCBlLCAgY29tcG9uZW50KTtcblx0XHRcdFx0fSwgMTAwMCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZW5kXCI6XG5cdFx0XHRcdGlmKHdhdGNoZXJzLnRhcCl7XG5cblx0XHRcdFx0XHR3YXRjaGVycy50YXAgPSBudWxsO1xuXHRcdFx0XHRcdHRoaXMuZGlzcGF0Y2hFdmVudCh0eXBlICsgXCJUYXBcIiwgZSwgIGNvbXBvbmVudCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZih3YXRjaGVycy50YXBEYmwpe1xuXHRcdFx0XHRcdGNsZWFyVGltZW91dCh3YXRjaGVycy50YXBEYmwpO1xuXHRcdFx0XHRcdHdhdGNoZXJzLnRhcERibCA9IG51bGw7XG5cblx0XHRcdFx0XHR0aGlzLmRpc3BhdGNoRXZlbnQodHlwZSArIFwiRGJsVGFwXCIsIGUsICBjb21wb25lbnQpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0d2F0Y2hlcnMudGFwRGJsID0gc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdFx0XHRjbGVhclRpbWVvdXQod2F0Y2hlcnMudGFwRGJsKTtcblx0XHRcdFx0XHRcdHdhdGNoZXJzLnRhcERibCA9IG51bGw7XG5cdFx0XHRcdFx0fSwgMzAwKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNsZWFyVGltZW91dCh3YXRjaGVycy50YXBIb2xkKTtcblx0XHRcdFx0d2F0Y2hlcnMudGFwSG9sZCA9IG51bGw7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fVxuXG5cdGRpc3BhdGNoRXZlbnQoYWN0aW9uLCBlLCBjb21wb25lbnQpe1xuXHRcdHZhciBjb21wb25lbnRPYmogPSBjb21wb25lbnQuZ2V0Q29tcG9uZW50KCksXG5cdFx0Y2FsbGJhY2s7XG5cblx0XHRpZih0aGlzLmNvbHVtblN1YnNjcmliZXJzW2FjdGlvbl0pe1xuXG5cdFx0XHRpZihjb21wb25lbnQgaW5zdGFuY2VvZiBDZWxsKXtcblx0XHRcdFx0Y2FsbGJhY2sgPSBjb21wb25lbnQuY29sdW1uLmRlZmluaXRpb25bYWN0aW9uXTtcblx0XHRcdH1lbHNlIGlmKGNvbXBvbmVudCBpbnN0YW5jZW9mIENvbHVtbil7XG5cdFx0XHRcdGNhbGxiYWNrID0gY29tcG9uZW50LmRlZmluaXRpb25bYWN0aW9uXTtcblx0XHRcdH1cblxuXHRcdFx0aWYoY2FsbGJhY2spe1xuXHRcdFx0XHRjYWxsYmFjayhlLCBjb21wb25lbnRPYmopO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChhY3Rpb24sIGUsIGNvbXBvbmVudE9iaik7XG5cdH1cbn1cblxudmFyIGRlZmF1bHRCaW5kaW5ncyA9IHtcblx0bmF2UHJldjpcInNoaWZ0ICsgOVwiLFxuXHRuYXZOZXh0OjksXG5cdG5hdlVwOjM4LFxuXHRuYXZEb3duOjQwLFxuXHRuYXZMZWZ0OjM3LFxuXHRuYXZSaWdodDozOSxcblx0c2Nyb2xsUGFnZVVwOjMzLFxuXHRzY3JvbGxQYWdlRG93bjozNCxcblx0c2Nyb2xsVG9TdGFydDozNixcblx0c2Nyb2xsVG9FbmQ6MzUsXG59O1xuXG52YXIgZGVmYXVsdEFjdGlvbnMgPSB7XG5cdGtleUJsb2NrOmZ1bmN0aW9uKGUpe1xuXHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHR9LFxuXG5cdHNjcm9sbFBhZ2VVcDpmdW5jdGlvbihlKXtcblx0XHR2YXIgcm93TWFuYWdlciA9IHRoaXMudGFibGUucm93TWFuYWdlcixcblx0XHRuZXdQb3MgPSByb3dNYW5hZ2VyLnNjcm9sbFRvcCAtIHJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRIZWlnaHQ7XG5cblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRpZihyb3dNYW5hZ2VyLmRpc3BsYXlSb3dzQ291bnQpe1xuXHRcdFx0aWYobmV3UG9zID49IDApe1xuXHRcdFx0XHRyb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsVG9wID0gbmV3UG9zO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRyb3dNYW5hZ2VyLnNjcm9sbFRvUm93KHJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKVswXSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmZvY3VzKCk7XG5cdH0sXG5cblx0c2Nyb2xsUGFnZURvd246ZnVuY3Rpb24oZSl7XG5cdFx0dmFyIHJvd01hbmFnZXIgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIsXG5cdFx0bmV3UG9zID0gcm93TWFuYWdlci5zY3JvbGxUb3AgKyByb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50SGVpZ2h0LFxuXHRcdHNjcm9sbE1heCA9IHJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxIZWlnaHQ7XG5cblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRpZihyb3dNYW5hZ2VyLmRpc3BsYXlSb3dzQ291bnQpe1xuXHRcdFx0aWYobmV3UG9zIDw9IHNjcm9sbE1heCl7XG5cdFx0XHRcdHJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3AgPSBuZXdQb3M7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHJvd01hbmFnZXIuc2Nyb2xsVG9Sb3cocm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpW3Jvd01hbmFnZXIuZGlzcGxheVJvd3NDb3VudCAtIDFdKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuZm9jdXMoKTtcblxuXHR9LFxuXG5cdHNjcm9sbFRvU3RhcnQ6ZnVuY3Rpb24oZSl7XG5cdFx0dmFyIHJvd01hbmFnZXIgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXI7XG5cblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRpZihyb3dNYW5hZ2VyLmRpc3BsYXlSb3dzQ291bnQpe1xuXHRcdFx0cm93TWFuYWdlci5zY3JvbGxUb1Jvdyhyb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKClbMF0pO1xuXHRcdH1cblxuXHRcdHRoaXMudGFibGUuZWxlbWVudC5mb2N1cygpO1xuXHR9LFxuXG5cdHNjcm9sbFRvRW5kOmZ1bmN0aW9uKGUpe1xuXHRcdHZhciByb3dNYW5hZ2VyID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyO1xuXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0aWYocm93TWFuYWdlci5kaXNwbGF5Um93c0NvdW50KXtcblx0XHRcdHJvd01hbmFnZXIuc2Nyb2xsVG9Sb3cocm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpW3Jvd01hbmFnZXIuZGlzcGxheVJvd3NDb3VudCAtIDFdKTtcblx0XHR9XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuZm9jdXMoKTtcblx0fSxcblxuXHRuYXZQcmV2OmZ1bmN0aW9uKGUpe1xuXHRcdHRoaXMuZGlzcGF0Y2goXCJrZXliaW5kaW5nLW5hdi1wcmV2XCIsIGUpO1xuXHR9LFxuXG5cdG5hdk5leHQ6ZnVuY3Rpb24oZSl7XG5cdFx0dGhpcy5kaXNwYXRjaChcImtleWJpbmRpbmctbmF2LW5leHRcIiwgZSk7XG5cdH0sXG5cblx0bmF2TGVmdDpmdW5jdGlvbihlKXtcblx0XHR0aGlzLmRpc3BhdGNoKFwia2V5YmluZGluZy1uYXYtbGVmdFwiLCBlKTtcblx0fSxcblxuXHRuYXZSaWdodDpmdW5jdGlvbihlKXtcblx0XHR0aGlzLmRpc3BhdGNoKFwia2V5YmluZGluZy1uYXYtcmlnaHRcIiwgZSk7XG5cdH0sXG5cblx0bmF2VXA6ZnVuY3Rpb24oZSl7XG5cdFx0dGhpcy5kaXNwYXRjaChcImtleWJpbmRpbmctbmF2LXVwXCIsIGUpO1xuXHR9LFxuXG5cdG5hdkRvd246ZnVuY3Rpb24oZSl7XG5cdFx0dGhpcy5kaXNwYXRjaChcImtleWJpbmRpbmctbmF2LWRvd25cIiwgZSk7XG5cdH0sXG59O1xuXG5jbGFzcyBLZXliaW5kaW5ncyBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwia2V5YmluZGluZ3NcIjtcblxuXHQvL2xvYWQgZGVmYXVsdHNcblx0c3RhdGljIGJpbmRpbmdzID0gZGVmYXVsdEJpbmRpbmdzO1xuXHRzdGF0aWMgYWN0aW9ucyA9IGRlZmF1bHRBY3Rpb25zO1xuXG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cblx0XHR0aGlzLndhdGNoS2V5cyA9IG51bGw7XG5cdFx0dGhpcy5wcmVzc2VkS2V5cyA9IG51bGw7XG5cdFx0dGhpcy5rZXl1cEJpbmRpbmcgPSBmYWxzZTtcblx0XHR0aGlzLmtleWRvd25CaW5kaW5nID0gZmFsc2U7XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJrZXliaW5kaW5nc1wiLCB7fSk7IC8vYXJyYXkgZm9yIGtleWJpbmRpbmdzXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwidGFiRW5kTmV3Um93XCIsIGZhbHNlKTsgLy9jcmVhdGUgbmV3IHJvdyB3aGVuIHRhYiB0byBlbmQgb2YgdGFibGVcblx0fVxuXG5cdGluaXRpYWxpemUoKXtcblx0XHR2YXIgYmluZGluZ3MgPSB0aGlzLnRhYmxlLm9wdGlvbnMua2V5YmluZGluZ3MsXG5cdFx0bWVyZ2VkQmluZGluZ3MgPSB7fTtcblxuXHRcdHRoaXMud2F0Y2hLZXlzID0ge307XG5cdFx0dGhpcy5wcmVzc2VkS2V5cyA9IFtdO1xuXG5cdFx0aWYoYmluZGluZ3MgIT09IGZhbHNlKXtcblx0XHRcdE9iamVjdC5hc3NpZ24obWVyZ2VkQmluZGluZ3MsIEtleWJpbmRpbmdzLmJpbmRpbmdzKTtcblx0XHRcdE9iamVjdC5hc3NpZ24obWVyZ2VkQmluZGluZ3MsIGJpbmRpbmdzKTtcblxuXHRcdFx0dGhpcy5tYXBCaW5kaW5ncyhtZXJnZWRCaW5kaW5ncyk7XG5cdFx0XHR0aGlzLmJpbmRFdmVudHMoKTtcblx0XHR9XG5cblx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLWRlc3Ryb3lcIiwgdGhpcy5jbGVhckJpbmRpbmdzLmJpbmQodGhpcykpO1xuXHR9XG5cblx0bWFwQmluZGluZ3MoYmluZGluZ3Mpe1xuXHRcdGZvcihsZXQga2V5IGluIGJpbmRpbmdzKXtcblx0XHRcdGlmKEtleWJpbmRpbmdzLmFjdGlvbnNba2V5XSl7XG5cdFx0XHRcdGlmKGJpbmRpbmdzW2tleV0pe1xuXHRcdFx0XHRcdGlmKHR5cGVvZiBiaW5kaW5nc1trZXldICE9PSBcIm9iamVjdFwiKXtcblx0XHRcdFx0XHRcdGJpbmRpbmdzW2tleV0gPSBbYmluZGluZ3Nba2V5XV07XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YmluZGluZ3Nba2V5XS5mb3JFYWNoKChiaW5kaW5nKSA9PiB7XG5cdFx0XHRcdFx0XHR2YXIgYmluZGluZ0xpc3QgPSBBcnJheS5pc0FycmF5KGJpbmRpbmcpID8gIGJpbmRpbmcgOiBbYmluZGluZ107XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGJpbmRpbmdMaXN0LmZvckVhY2goKGl0ZW0pID0+IHtcblx0XHRcdFx0XHRcdFx0dGhpcy5tYXBCaW5kaW5nKGtleSwgaXRlbSk7XG5cdFx0XHRcdFx0XHR9KTtcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJLZXkgQmluZGluZyBFcnJvciAtIG5vIHN1Y2ggYWN0aW9uOlwiLCBrZXkpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdG1hcEJpbmRpbmcoYWN0aW9uLCBzeW1ib2xzTGlzdCl7XG5cdFx0dmFyIGJpbmRpbmcgPSB7XG5cdFx0XHRhY3Rpb246IEtleWJpbmRpbmdzLmFjdGlvbnNbYWN0aW9uXSxcblx0XHRcdGtleXM6IFtdLFxuXHRcdFx0Y3RybDogZmFsc2UsXG5cdFx0XHRzaGlmdDogZmFsc2UsXG5cdFx0XHRtZXRhOiBmYWxzZSxcblx0XHR9O1xuXG5cdFx0dmFyIHN5bWJvbHMgPSBzeW1ib2xzTGlzdC50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuc3BsaXQoXCIgXCIpLmpvaW4oXCJcIikuc3BsaXQoXCIrXCIpO1xuXG5cdFx0c3ltYm9scy5mb3JFYWNoKChzeW1ib2wpID0+IHtcblx0XHRcdHN3aXRjaChzeW1ib2wpe1xuXHRcdFx0XHRjYXNlIFwiY3RybFwiOlxuXHRcdFx0XHRcdGJpbmRpbmcuY3RybCA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcInNoaWZ0XCI6XG5cdFx0XHRcdFx0YmluZGluZy5zaGlmdCA9IHRydWU7XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcIm1ldGFcIjpcblx0XHRcdFx0XHRiaW5kaW5nLm1ldGEgPSB0cnVlO1xuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0c3ltYm9sID0gaXNOYU4oc3ltYm9sKSA/IHN5bWJvbC50b1VwcGVyQ2FzZSgpLmNoYXJDb2RlQXQoMCkgOiBwYXJzZUludChzeW1ib2wpO1xuXHRcdFx0XHRcdGJpbmRpbmcua2V5cy5wdXNoKHN5bWJvbCk7XG5cblx0XHRcdFx0XHRpZighdGhpcy53YXRjaEtleXNbc3ltYm9sXSl7XG5cdFx0XHRcdFx0XHR0aGlzLndhdGNoS2V5c1tzeW1ib2xdID0gW107XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0dGhpcy53YXRjaEtleXNbc3ltYm9sXS5wdXNoKGJpbmRpbmcpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0YmluZEV2ZW50cygpe1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHRoaXMua2V5dXBCaW5kaW5nID0gZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgY29kZSA9IGUua2V5Q29kZTtcblx0XHRcdHZhciBiaW5kaW5ncyA9IHNlbGYud2F0Y2hLZXlzW2NvZGVdO1xuXG5cdFx0XHRpZihiaW5kaW5ncyl7XG5cblx0XHRcdFx0c2VsZi5wcmVzc2VkS2V5cy5wdXNoKGNvZGUpO1xuXG5cdFx0XHRcdGJpbmRpbmdzLmZvckVhY2goZnVuY3Rpb24oYmluZGluZyl7XG5cdFx0XHRcdFx0c2VsZi5jaGVja0JpbmRpbmcoZSwgYmluZGluZyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHR0aGlzLmtleWRvd25CaW5kaW5nID0gZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgY29kZSA9IGUua2V5Q29kZTtcblx0XHRcdHZhciBiaW5kaW5ncyA9IHNlbGYud2F0Y2hLZXlzW2NvZGVdO1xuXG5cdFx0XHRpZihiaW5kaW5ncyl7XG5cblx0XHRcdFx0dmFyIGluZGV4ID0gc2VsZi5wcmVzc2VkS2V5cy5pbmRleE9mKGNvZGUpO1xuXG5cdFx0XHRcdGlmKGluZGV4ID4gLTEpe1xuXHRcdFx0XHRcdHNlbGYucHJlc3NlZEtleXMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5rZXl1cEJpbmRpbmcpO1xuXG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLmtleWRvd25CaW5kaW5nKTtcblx0fVxuXG5cdGNsZWFyQmluZGluZ3MoKXtcblx0XHRpZih0aGlzLmtleXVwQmluZGluZyl7XG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5rZXl1cEJpbmRpbmcpO1xuXHRcdH1cblxuXHRcdGlmKHRoaXMua2V5ZG93bkJpbmRpbmcpe1xuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLmtleWRvd25CaW5kaW5nKTtcblx0XHR9XG5cdH1cblxuXHRjaGVja0JpbmRpbmcoZSwgYmluZGluZyl7XG5cdFx0dmFyIG1hdGNoID0gdHJ1ZTtcblxuXHRcdGlmKGUuY3RybEtleSA9PSBiaW5kaW5nLmN0cmwgJiYgZS5zaGlmdEtleSA9PSBiaW5kaW5nLnNoaWZ0ICYmIGUubWV0YUtleSA9PSBiaW5kaW5nLm1ldGEpe1xuXHRcdFx0YmluZGluZy5rZXlzLmZvckVhY2goKGtleSkgPT4ge1xuXHRcdFx0XHR2YXIgaW5kZXggPSB0aGlzLnByZXNzZWRLZXlzLmluZGV4T2Yoa2V5KTtcblxuXHRcdFx0XHRpZihpbmRleCA9PSAtMSl7XG5cdFx0XHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmKG1hdGNoKXtcblx0XHRcdFx0YmluZGluZy5hY3Rpb24uY2FsbCh0aGlzLCBlKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59XG5cbmNsYXNzIE1lbnUgZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcIm1lbnVcIjtcblx0XG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5tZW51Q29udGFpbmVyID0gbnVsbDtcblx0XHR0aGlzLm5lc3RlZE1lbnVCbG9jayA9IGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMuY3VycmVudENvbXBvbmVudCA9IG51bGw7XG5cdFx0dGhpcy5yb290UG9wdXAgPSBudWxsO1xuXHRcdFxuXHRcdHRoaXMuY29sdW1uU3Vic2NyaWJlcnMgPSB7fTtcblx0XHRcblx0XHQvLyB0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJtZW51Q29udGFpbmVyXCIsIHVuZGVmaW5lZCk7IC8vZGVwcmVjYXRlZFxuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInJvd0NvbnRleHRNZW51XCIsIGZhbHNlKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJyb3dDbGlja01lbnVcIiwgZmFsc2UpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInJvd0RibENsaWNrTWVudVwiLCBmYWxzZSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZ3JvdXBDb250ZXh0TWVudVwiLCBmYWxzZSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZ3JvdXBDbGlja01lbnVcIiwgZmFsc2UpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImdyb3VwRGJsQ2xpY2tNZW51XCIsIGZhbHNlKTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyQ29udGV4dE1lbnVcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckNsaWNrTWVudVwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyRGJsQ2xpY2tNZW51XCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJNZW51XCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJNZW51SWNvblwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiY29udGV4dE1lbnVcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImNsaWNrTWVudVwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiZGJsQ2xpY2tNZW51XCIpO1xuXHRcdFxuXHR9XG5cdFxuXHRpbml0aWFsaXplKCl7XG5cdFx0dGhpcy5kZXByZWNhdGVkT3B0aW9uc0NoZWNrKCk7XG5cdFx0dGhpcy5pbml0aWFsaXplUm93V2F0Y2hlcnMoKTtcblx0XHR0aGlzLmluaXRpYWxpemVHcm91cFdhdGNoZXJzKCk7XG5cdFx0XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4taW5pdFwiLCB0aGlzLmluaXRpYWxpemVDb2x1bW4uYmluZCh0aGlzKSk7XG5cdH1cblx0XG5cdGRlcHJlY2F0ZWRPcHRpb25zQ2hlY2soKXtcblx0XHQvLyBpZighdGhpcy5kZXByZWNhdGlvbkNoZWNrKFwibWVudUNvbnRhaW5lclwiLCBcInBvcHVwQ29udGFpbmVyXCIpKXtcblx0XHQvLyBcdHRoaXMudGFibGUub3B0aW9ucy5wb3B1cENvbnRhaW5lciA9IHRoaXMudGFibGUub3B0aW9ucy5tZW51Q29udGFpbmVyO1xuXHRcdC8vIH1cblx0fVx0XG5cdFxuXHRpbml0aWFsaXplUm93V2F0Y2hlcnMoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucm93Q29udGV4dE1lbnUpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctY29udGV4dG1lbnVcIiwgdGhpcy5sb2FkTWVudUV2ZW50LmJpbmQodGhpcywgdGhpcy50YWJsZS5vcHRpb25zLnJvd0NvbnRleHRNZW51KSk7XG5cdFx0XHR0aGlzLnRhYmxlLm9uKFwicm93VGFwSG9sZFwiLCB0aGlzLmxvYWRNZW51RXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMucm93Q29udGV4dE1lbnUpKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnJvd0NsaWNrTWVudSl7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1jbGlja1wiLCB0aGlzLmxvYWRNZW51RXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMucm93Q2xpY2tNZW51KSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5yb3dEYmxDbGlja01lbnUpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctZGJsY2xpY2tcIiwgdGhpcy5sb2FkTWVudUV2ZW50LmJpbmQodGhpcywgdGhpcy50YWJsZS5vcHRpb25zLnJvd0RibENsaWNrTWVudSkpO1xuXHRcdH1cblx0fVxuXHRcblx0aW5pdGlhbGl6ZUdyb3VwV2F0Y2hlcnMoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBDb250ZXh0TWVudSl7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImdyb3VwLWNvbnRleHRtZW51XCIsIHRoaXMubG9hZE1lbnVFdmVudC5iaW5kKHRoaXMsIHRoaXMudGFibGUub3B0aW9ucy5ncm91cENvbnRleHRNZW51KSk7XG5cdFx0XHR0aGlzLnRhYmxlLm9uKFwiZ3JvdXBUYXBIb2xkXCIsIHRoaXMubG9hZE1lbnVFdmVudC5iaW5kKHRoaXMsIHRoaXMudGFibGUub3B0aW9ucy5ncm91cENvbnRleHRNZW51KSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5ncm91cENsaWNrTWVudSl7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImdyb3VwLWNsaWNrXCIsIHRoaXMubG9hZE1lbnVFdmVudC5iaW5kKHRoaXMsIHRoaXMudGFibGUub3B0aW9ucy5ncm91cENsaWNrTWVudSkpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBEYmxDbGlja01lbnUpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJncm91cC1kYmxjbGlja1wiLCB0aGlzLmxvYWRNZW51RXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBEYmxDbGlja01lbnUpKTtcblx0XHR9XG5cdH1cblxuXHRpbml0aWFsaXplQ29sdW1uKGNvbHVtbil7XG5cdFx0dmFyXHRkZWYgPSBjb2x1bW4uZGVmaW5pdGlvbjtcblx0XHRcblx0XHQvL2hhbmRsZSBjb2x1bW4gZXZlbnRzXG5cdFx0aWYoZGVmLmhlYWRlckNvbnRleHRNZW51ICYmICF0aGlzLmNvbHVtblN1YnNjcmliZXJzLmhlYWRlckNvbnRleHRNZW51KXtcblx0XHRcdHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuaGVhZGVyQ29udGV4dE1lbnUgPSB0aGlzLmxvYWRNZW51VGFibGVDb2x1bW5FdmVudC5iaW5kKHRoaXMsIFwiaGVhZGVyQ29udGV4dE1lbnVcIik7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1jb250ZXh0bWVudVwiLCB0aGlzLmNvbHVtblN1YnNjcmliZXJzLmhlYWRlckNvbnRleHRNZW51KTtcblx0XHRcdHRoaXMudGFibGUub24oXCJoZWFkZXJUYXBIb2xkXCIsIHRoaXMubG9hZE1lbnVUYWJsZUNvbHVtbkV2ZW50LmJpbmQodGhpcywgXCJoZWFkZXJDb250ZXh0TWVudVwiKSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGRlZi5oZWFkZXJDbGlja01lbnUgJiYgIXRoaXMuY29sdW1uU3Vic2NyaWJlcnMuaGVhZGVyQ2xpY2tNZW51KXtcblx0XHRcdHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuaGVhZGVyQ2xpY2tNZW51ID0gdGhpcy5sb2FkTWVudVRhYmxlQ29sdW1uRXZlbnQuYmluZCh0aGlzLCBcImhlYWRlckNsaWNrTWVudVwiKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWNsaWNrXCIsIHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuaGVhZGVyQ2xpY2tNZW51KTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoZGVmLmhlYWRlckRibENsaWNrTWVudSAmJiAhdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5oZWFkZXJEYmxDbGlja01lbnUpe1xuXHRcdFx0dGhpcy5jb2x1bW5TdWJzY3JpYmVycy5oZWFkZXJEYmxDbGlja01lbnUgPSB0aGlzLmxvYWRNZW51VGFibGVDb2x1bW5FdmVudC5iaW5kKHRoaXMsIFwiaGVhZGVyRGJsQ2xpY2tNZW51XCIpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tZGJsY2xpY2tcIiwgdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5oZWFkZXJEYmxDbGlja01lbnUpO1xuXHRcdH1cblx0XHRcblx0XHRpZihkZWYuaGVhZGVyTWVudSl7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVDb2x1bW5IZWFkZXJNZW51KGNvbHVtbik7XG5cdFx0fVxuXHRcdFxuXHRcdC8vaGFuZGxlIGNlbGwgZXZlbnRzXG5cdFx0aWYoZGVmLmNvbnRleHRNZW51ICYmICF0aGlzLmNvbHVtblN1YnNjcmliZXJzLmNvbnRleHRNZW51KXtcblx0XHRcdHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuY29udGV4dE1lbnUgPSB0aGlzLmxvYWRNZW51VGFibGVDZWxsRXZlbnQuYmluZCh0aGlzLCBcImNvbnRleHRNZW51XCIpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLWNvbnRleHRtZW51XCIsIHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuY29udGV4dE1lbnUpO1xuXHRcdFx0dGhpcy50YWJsZS5vbihcImNlbGxUYXBIb2xkXCIsIHRoaXMubG9hZE1lbnVUYWJsZUNlbGxFdmVudC5iaW5kKHRoaXMsIFwiY29udGV4dE1lbnVcIikpO1xuXHRcdH1cblx0XHRcblx0XHRpZihkZWYuY2xpY2tNZW51ICYmICF0aGlzLmNvbHVtblN1YnNjcmliZXJzLmNsaWNrTWVudSl7XG5cdFx0XHR0aGlzLmNvbHVtblN1YnNjcmliZXJzLmNsaWNrTWVudSA9IHRoaXMubG9hZE1lbnVUYWJsZUNlbGxFdmVudC5iaW5kKHRoaXMsIFwiY2xpY2tNZW51XCIpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLWNsaWNrXCIsIHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuY2xpY2tNZW51KTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoZGVmLmRibENsaWNrTWVudSAmJiAhdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5kYmxDbGlja01lbnUpe1xuXHRcdFx0dGhpcy5jb2x1bW5TdWJzY3JpYmVycy5kYmxDbGlja01lbnUgPSB0aGlzLmxvYWRNZW51VGFibGVDZWxsRXZlbnQuYmluZCh0aGlzLCBcImRibENsaWNrTWVudVwiKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1kYmxjbGlja1wiLCB0aGlzLmNvbHVtblN1YnNjcmliZXJzLmRibENsaWNrTWVudSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRpbml0aWFsaXplQ29sdW1uSGVhZGVyTWVudShjb2x1bW4pe1xuXHRcdHZhciBpY29uID0gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyTWVudUljb24sXG5cdFx0aGVhZGVyTWVudUVsO1xuXHRcdFxuXHRcdGhlYWRlck1lbnVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXHRcdGhlYWRlck1lbnVFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWhlYWRlci1wb3B1cC1idXR0b25cIik7XG5cdFx0XG5cdFx0aWYoaWNvbil7XG5cdFx0XHRpZih0eXBlb2YgaWNvbiA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0aWNvbiA9IGljb24oY29sdW1uLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoaWNvbiBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KXtcblx0XHRcdFx0aGVhZGVyTWVudUVsLmFwcGVuZENoaWxkKGljb24pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRoZWFkZXJNZW51RWwuaW5uZXJIVE1MID0gaWNvbjtcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRoZWFkZXJNZW51RWwuaW5uZXJIVE1MID0gXCImdmVsbGlwO1wiO1xuXHRcdH1cblx0XHRcblx0XHRoZWFkZXJNZW51RWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG5cdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmxvYWRNZW51RXZlbnQoY29sdW1uLmRlZmluaXRpb24uaGVhZGVyTWVudSwgZSwgY29sdW1uKTtcblx0XHR9KTtcblx0XHRcblx0XHRjb2x1bW4udGl0bGVFbGVtZW50Lmluc2VydEJlZm9yZShoZWFkZXJNZW51RWwsIGNvbHVtbi50aXRsZUVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdH1cblx0XG5cdGxvYWRNZW51VGFibGVDZWxsRXZlbnQob3B0aW9uLCBlLCBjZWxsKXtcblx0XHRpZihjZWxsLl9jZWxsKXtcblx0XHRcdGNlbGwgPSBjZWxsLl9jZWxsO1xuXHRcdH1cblx0XHRcblx0XHRpZihjZWxsLmNvbHVtbi5kZWZpbml0aW9uW29wdGlvbl0pe1xuXHRcdFx0dGhpcy5sb2FkTWVudUV2ZW50KGNlbGwuY29sdW1uLmRlZmluaXRpb25bb3B0aW9uXSwgZSwgY2VsbCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRsb2FkTWVudVRhYmxlQ29sdW1uRXZlbnQob3B0aW9uLCBlLCBjb2x1bW4pe1xuXHRcdGlmKGNvbHVtbi5fY29sdW1uKXtcblx0XHRcdGNvbHVtbiA9IGNvbHVtbi5fY29sdW1uO1xuXHRcdH1cblx0XHRcblx0XHRpZihjb2x1bW4uZGVmaW5pdGlvbltvcHRpb25dKXtcblx0XHRcdHRoaXMubG9hZE1lbnVFdmVudChjb2x1bW4uZGVmaW5pdGlvbltvcHRpb25dLCBlLCBjb2x1bW4pO1xuXHRcdH1cblx0fVxuXHRcblx0bG9hZE1lbnVFdmVudChtZW51LCBlLCBjb21wb25lbnQpe1xuXHRcdGlmKGNvbXBvbmVudC5fZ3JvdXApe1xuXHRcdFx0Y29tcG9uZW50ID0gY29tcG9uZW50Ll9ncm91cDtcblx0XHR9ZWxzZSBpZihjb21wb25lbnQuX3Jvdyl7XG5cdFx0XHRjb21wb25lbnQgPSBjb21wb25lbnQuX3Jvdztcblx0XHR9XG5cdFx0XG5cdFx0bWVudSA9IHR5cGVvZiBtZW51ID09IFwiZnVuY3Rpb25cIiA/IG1lbnUuY2FsbCh0aGlzLnRhYmxlLCBlLCBjb21wb25lbnQuZ2V0Q29tcG9uZW50KCkpIDogbWVudTtcblx0XHRcblx0XHR0aGlzLmxvYWRNZW51KGUsIGNvbXBvbmVudCwgbWVudSk7XG5cdH1cblx0XG5cdGxvYWRNZW51KGUsIGNvbXBvbmVudCwgbWVudSwgcGFyZW50RWwsIHBhcmVudFBvcHVwKXtcblx0XHR2YXIgdG91Y2ggPSAhKGUgaW5zdGFuY2VvZiBNb3VzZUV2ZW50KSxcdFx0XG5cdFx0bWVudUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0XHRwb3B1cDtcblx0XHRcblx0XHRtZW51RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tZW51XCIpO1xuXHRcdFxuXHRcdGlmKCF0b3VjaCl7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fVxuXHRcdFxuXHRcdC8vYWJvcnQgaWYgbm8gbWVudSBzZXRcblx0XHRpZighbWVudSB8fCAhbWVudS5sZW5ndGgpe1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRcblx0XHRpZighcGFyZW50RWwpe1xuXHRcdFx0aWYodGhpcy5uZXN0ZWRNZW51QmxvY2spe1xuXHRcdFx0XHQvL2Fib3J0IGlmIGNoaWxkIG1lbnUgYWxyZWFkeSBvcGVuXG5cdFx0XHRcdGlmKHRoaXMucm9vdFBvcHVwKXtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5uZXN0ZWRNZW51QmxvY2sgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHR0aGlzLm5lc3RlZE1lbnVCbG9jayA9IGZhbHNlO1xuXHRcdFx0XHR9LCAxMDApO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnJvb3RQb3B1cCl7XG5cdFx0XHRcdHRoaXMucm9vdFBvcHVwLmhpZGUoKTtcdFxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnJvb3RQb3B1cCA9IHBvcHVwID0gdGhpcy5wb3B1cChtZW51RWwpO1xuXHRcdFx0XG5cdFx0fWVsc2Uge1xuXHRcdFx0cG9wdXAgPSBwYXJlbnRQb3B1cC5jaGlsZChtZW51RWwpO1xuXHRcdH1cblx0XHRcblx0XHRtZW51LmZvckVhY2goKGl0ZW0pID0+IHtcblx0XHRcdHZhciBpdGVtRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRcdFx0bGFiZWwgPSBpdGVtLmxhYmVsLFxuXHRcdFx0ZGlzYWJsZWQgPSBpdGVtLmRpc2FibGVkO1xuXHRcdFx0XG5cdFx0XHRpZihpdGVtLnNlcGFyYXRvcil7XG5cdFx0XHRcdGl0ZW1FbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1lbnUtc2VwYXJhdG9yXCIpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpdGVtRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tZW51LWl0ZW1cIik7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0eXBlb2YgbGFiZWwgPT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0XHRsYWJlbCA9IGxhYmVsLmNhbGwodGhpcy50YWJsZSwgY29tcG9uZW50LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYobGFiZWwgaW5zdGFuY2VvZiBOb2RlKXtcblx0XHRcdFx0XHRpdGVtRWwuYXBwZW5kQ2hpbGQobGFiZWwpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0aXRlbUVsLmlubmVySFRNTCA9IGxhYmVsO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0eXBlb2YgZGlzYWJsZWQgPT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0XHRkaXNhYmxlZCA9IGRpc2FibGVkLmNhbGwodGhpcy50YWJsZSwgY29tcG9uZW50LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYoZGlzYWJsZWQpe1xuXHRcdFx0XHRcdGl0ZW1FbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1lbnUtaXRlbS1kaXNhYmxlZFwiKTtcblx0XHRcdFx0XHRpdGVtRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG5cdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0aWYoaXRlbS5tZW51ICYmIGl0ZW0ubWVudS5sZW5ndGgpe1xuXHRcdFx0XHRcdFx0aXRlbUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLmxvYWRNZW51KGUsIGNvbXBvbmVudCwgaXRlbS5tZW51LCBpdGVtRWwsIHBvcHVwKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGlmKGl0ZW0uYWN0aW9uKXtcblx0XHRcdFx0XHRcdFx0aXRlbUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdGl0ZW0uYWN0aW9uKGUsIGNvbXBvbmVudC5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYoaXRlbS5tZW51ICYmIGl0ZW0ubWVudS5sZW5ndGgpe1xuXHRcdFx0XHRcdGl0ZW1FbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1lbnUtaXRlbS1zdWJtZW51XCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdG1lbnVFbC5hcHBlbmRDaGlsZChpdGVtRWwpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdG1lbnVFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcblx0XHRcdGlmKHRoaXMucm9vdFBvcHVwKXtcblx0XHRcdFx0dGhpcy5yb290UG9wdXAuaGlkZSgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdHBvcHVwLnNob3cocGFyZW50RWwgfHwgZSk7XG5cdFx0XG5cdFx0aWYocG9wdXAgPT09IHRoaXMucm9vdFBvcHVwKXtcblx0XHRcdHRoaXMucm9vdFBvcHVwLmhpZGVPbkJsdXIoKCkgPT4ge1xuXHRcdFx0XHR0aGlzLnJvb3RQb3B1cCA9IG51bGw7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0aGlzLmN1cnJlbnRDb21wb25lbnQpe1xuXHRcdFx0XHRcdHRoaXMuZGlzcGF0Y2goXCJtZW51LWNsb3NlZFwiLCBtZW51LCBwb3B1cCk7XG5cdFx0XHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwibWVudUNsb3NlZFwiLCB0aGlzLmN1cnJlbnRDb21wb25lbnQuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHRcdHRoaXMuY3VycmVudENvbXBvbmVudCA9IG51bGw7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmN1cnJlbnRDb21wb25lbnQgPSBjb21wb25lbnQ7XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJtZW51LW9wZW5lZFwiLCBtZW51LCBwb3B1cCk7XG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJtZW51T3BlbmVkXCIsIGNvbXBvbmVudC5nZXRDb21wb25lbnQoKSk7XG5cdFx0fVxuXHR9XG59XG5cbmNsYXNzIE1vdmVDb2x1bW5zIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJtb3ZlQ29sdW1uXCI7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50ID0gdGhpcy5jcmVhdGVQbGFjZWhvbGRlckVsZW1lbnQoKTtcblx0XHR0aGlzLmhvdmVyRWxlbWVudCA9IGZhbHNlOyAvL2Zsb2F0aW5nIGNvbHVtbiBoZWFkZXIgZWxlbWVudFxuXHRcdHRoaXMuY2hlY2tUaW1lb3V0ID0gZmFsc2U7IC8vY2xpY2sgY2hlY2sgdGltZW91dCBob2xkZXJcblx0XHR0aGlzLmNoZWNrUGVyaW9kID0gMjUwOyAvL3BlcmlvZCB0byB3YWl0IG9uIG1vdXNlZG93biB0byBjb25zaWRlciB0aGlzIGEgbW92ZSBhbmQgbm90IGEgY2xpY2tcblx0XHR0aGlzLm1vdmluZyA9IGZhbHNlOyAvL2N1cnJlbnRseSBtb3ZpbmcgY29sdW1uXG5cdFx0dGhpcy50b0NvbCA9IGZhbHNlOyAvL2Rlc3RpbmF0aW9uIGNvbHVtblxuXHRcdHRoaXMudG9Db2xBZnRlciA9IGZhbHNlOyAvL3Bvc2l0aW9uIG9mIG1vdmluZyBjb2x1bW4gcmVsYXRpdmUgdG8gdGhlIGRlc3RpbmF0aW9uIGNvbHVtblxuXHRcdHRoaXMuc3RhcnRYID0gMDsgLy9zdGFydGluZyBwb3NpdGlvbiB3aXRoaW4gaGVhZGVyIGVsZW1lbnRcblx0XHR0aGlzLmF1dG9TY3JvbGxNYXJnaW4gPSA0MDsgLy9hdXRvIHNjcm9sbCBvbiBlZGdlIHdoZW4gd2l0aGluIG1hcmdpblxuXHRcdHRoaXMuYXV0b1Njcm9sbFN0ZXAgPSA1OyAvL2F1dG8gc2Nyb2xsIGRpc3RhbmNlIGluIHBpeGVsc1xuXHRcdHRoaXMuYXV0b1Njcm9sbFRpbWVvdXQgPSBmYWxzZTsgLy9hdXRvIHNjcm9sbCB0aW1lb3V0XG5cdFx0dGhpcy50b3VjaE1vdmUgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLm1vdmVIb3ZlciA9IHRoaXMubW92ZUhvdmVyLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5lbmRNb3ZlID0gdGhpcy5lbmRNb3ZlLmJpbmQodGhpcyk7XG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwibW92YWJsZUNvbHVtbnNcIiwgZmFsc2UpOyAvL2VuYWJsZSBtb3ZhYmxlIGNvbHVtbnNcblx0fVxuXHRcblx0Y3JlYXRlUGxhY2Vob2xkZXJFbGVtZW50KCl7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbFwiKTtcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC1wbGFjZWhvbGRlclwiKTtcblx0XHRcblx0XHRyZXR1cm4gZWw7XG5cdH1cblx0XG5cdGluaXRpYWxpemUoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZUNvbHVtbnMpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4taW5pdFwiLCB0aGlzLmluaXRpYWxpemVDb2x1bW4uYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImFsZXJ0LXNob3dcIiwgdGhpcy5hYm9ydE1vdmUuYmluZCh0aGlzKSk7XG5cdFx0fVxuXHR9XG5cblx0YWJvcnRNb3ZlKCl7XG5cdFx0Y2xlYXJUaW1lb3V0KHRoaXMuY2hlY2tUaW1lb3V0KTtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRjb25maWcgPSB7fSxcblx0XHRjb2xFbDtcblxuXHRcdGlmKCFjb2x1bW4ubW9kdWxlcy5mcm96ZW4gJiYgIWNvbHVtbi5pc0dyb3VwICYmICFjb2x1bW4uaXNSb3dIZWFkZXIpe1xuXHRcdFx0Y29sRWwgPSBjb2x1bW4uZ2V0RWxlbWVudCgpO1xuXHRcdFx0XG5cdFx0XHRjb25maWcubW91c2Vtb3ZlID0gZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmKGNvbHVtbi5wYXJlbnQgPT09IHNlbGYubW92aW5nLnBhcmVudCl7XG5cdFx0XHRcdFx0aWYoKCgoc2VsZi50b3VjaE1vdmUgPyBlLnRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYKSAtIEhlbHBlcnMuZWxPZmZzZXQoY29sRWwpLmxlZnQpICsgc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbnRlbnRzRWxlbWVudC5zY3JvbGxMZWZ0KSA+IChjb2x1bW4uZ2V0V2lkdGgoKSAvIDIpKXtcblx0XHRcdFx0XHRcdGlmKHNlbGYudG9Db2wgIT09IGNvbHVtbiB8fCAhc2VsZi50b0NvbEFmdGVyKXtcblx0XHRcdFx0XHRcdFx0Y29sRWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIGNvbEVsLm5leHRTaWJsaW5nKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5tb3ZlQ29sdW1uKGNvbHVtbiwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0aWYoc2VsZi50b0NvbCAhPT0gY29sdW1uIHx8IHNlbGYudG9Db2xBZnRlcil7XG5cdFx0XHRcdFx0XHRcdGNvbEVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCBjb2xFbCk7XG5cdFx0XHRcdFx0XHRcdHNlbGYubW92ZUNvbHVtbihjb2x1bW4sIGZhbHNlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0uYmluZChzZWxmKTtcblx0XHRcdFxuXHRcdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi50b3VjaE1vdmUgPSBmYWxzZTtcblx0XHRcdFx0aWYoZS53aGljaCA9PT0gMSl7XG5cdFx0XHRcdFx0c2VsZi5jaGVja1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCBjb2x1bW4pO1xuXHRcdFx0XHRcdH0sIHNlbGYuY2hlY2tQZXJpb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmKGUud2hpY2ggPT09IDEpe1xuXHRcdFx0XHRcdGlmKHNlbGYuY2hlY2tUaW1lb3V0KXtcblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0c2VsZi5iaW5kVG91Y2hFdmVudHMoY29sdW1uKTtcblx0XHR9XG5cdFx0XG5cdFx0Y29sdW1uLm1vZHVsZXMubW92ZUNvbHVtbiA9IGNvbmZpZztcblx0fVxuXHRcblx0YmluZFRvdWNoRXZlbnRzKGNvbHVtbil7XG5cdFx0dmFyIGNvbEVsID0gY29sdW1uLmdldEVsZW1lbnQoKSxcblx0XHRzdGFydFhNb3ZlID0gZmFsc2UsIC8vc2hpZnRpbmcgY2VudGVyIHBvc2l0aW9uIG9mIHRoZSBjZWxsXG5cdFx0bmV4dENvbCwgcHJldkNvbCwgbmV4dENvbFdpZHRoLCBwcmV2Q29sV2lkdGgsIG5leHRDb2xXaWR0aExhc3QsIHByZXZDb2xXaWR0aExhc3Q7XG5cdFx0XG5cdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgKGUpID0+IHtcblx0XHRcdHRoaXMuY2hlY2tUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdHRoaXMudG91Y2hNb3ZlID0gdHJ1ZTtcblx0XHRcdFx0bmV4dENvbCA9IGNvbHVtbi5uZXh0Q29sdW1uKCk7XG5cdFx0XHRcdG5leHRDb2xXaWR0aCA9IG5leHRDb2wgPyBuZXh0Q29sLmdldFdpZHRoKCkvMiA6IDA7XG5cdFx0XHRcdHByZXZDb2wgPSBjb2x1bW4ucHJldkNvbHVtbigpO1xuXHRcdFx0XHRwcmV2Q29sV2lkdGggPSBwcmV2Q29sID8gcHJldkNvbC5nZXRXaWR0aCgpLzIgOiAwO1xuXHRcdFx0XHRuZXh0Q29sV2lkdGhMYXN0ID0gMDtcblx0XHRcdFx0cHJldkNvbFdpZHRoTGFzdCA9IDA7XG5cdFx0XHRcdHN0YXJ0WE1vdmUgPSBmYWxzZTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuc3RhcnRNb3ZlKGUsIGNvbHVtbik7XG5cdFx0XHR9LCB0aGlzLmNoZWNrUGVyaW9kKTtcblx0XHR9LCB7cGFzc2l2ZTogdHJ1ZX0pO1xuXHRcdFxuXHRcdGNvbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaG1vdmVcIiwgKGUpID0+IHtcblx0XHRcdHZhciBkaWZmLCBtb3ZlVG9Db2w7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMubW92aW5nKXtcblx0XHRcdFx0dGhpcy5tb3ZlSG92ZXIoZSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZighc3RhcnRYTW92ZSl7XG5cdFx0XHRcdFx0c3RhcnRYTW92ZSA9IGUudG91Y2hlc1swXS5wYWdlWDtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0ZGlmZiA9IGUudG91Y2hlc1swXS5wYWdlWCAtIHN0YXJ0WE1vdmU7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihkaWZmID4gMCl7XG5cdFx0XHRcdFx0aWYobmV4dENvbCAmJiBkaWZmIC0gbmV4dENvbFdpZHRoTGFzdCA+IG5leHRDb2xXaWR0aCl7XG5cdFx0XHRcdFx0XHRtb3ZlVG9Db2wgPSBuZXh0Q29sO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZihtb3ZlVG9Db2wgIT09IGNvbHVtbil7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0WE1vdmUgPSBlLnRvdWNoZXNbMF0ucGFnZVg7XG5cdFx0XHRcdFx0XHRcdG1vdmVUb0NvbC5nZXRFbGVtZW50KCkucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQsIG1vdmVUb0NvbC5nZXRFbGVtZW50KCkubmV4dFNpYmxpbmcpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLm1vdmVDb2x1bW4obW92ZVRvQ29sLCB0cnVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRpZihwcmV2Q29sICYmIC1kaWZmIC0gcHJldkNvbFdpZHRoTGFzdCA+ICBwcmV2Q29sV2lkdGgpe1xuXHRcdFx0XHRcdFx0bW92ZVRvQ29sID0gcHJldkNvbDtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0aWYobW92ZVRvQ29sICE9PSBjb2x1bW4pe1xuXHRcdFx0XHRcdFx0XHRzdGFydFhNb3ZlID0gZS50b3VjaGVzWzBdLnBhZ2VYO1xuXHRcdFx0XHRcdFx0XHRtb3ZlVG9Db2wuZ2V0RWxlbWVudCgpLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LCBtb3ZlVG9Db2wuZ2V0RWxlbWVudCgpKTtcblx0XHRcdFx0XHRcdFx0dGhpcy5tb3ZlQ29sdW1uKG1vdmVUb0NvbCwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYobW92ZVRvQ29sKXtcblx0XHRcdFx0XHRuZXh0Q29sID0gbW92ZVRvQ29sLm5leHRDb2x1bW4oKTtcblx0XHRcdFx0XHRuZXh0Q29sV2lkdGhMYXN0ID0gbmV4dENvbFdpZHRoO1xuXHRcdFx0XHRcdG5leHRDb2xXaWR0aCA9IG5leHRDb2wgPyBuZXh0Q29sLmdldFdpZHRoKCkgLyAyIDogMDtcblx0XHRcdFx0XHRwcmV2Q29sID0gbW92ZVRvQ29sLnByZXZDb2x1bW4oKTtcblx0XHRcdFx0XHRwcmV2Q29sV2lkdGhMYXN0ID0gcHJldkNvbFdpZHRoO1xuXHRcdFx0XHRcdHByZXZDb2xXaWR0aCA9IHByZXZDb2wgPyBwcmV2Q29sLmdldFdpZHRoKCkgLyAyIDogMDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sIHtwYXNzaXZlOiB0cnVlfSk7XG5cdFx0XG5cdFx0Y29sRWwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIChlKSA9PiB7XG5cdFx0XHRpZih0aGlzLmNoZWNrVGltZW91dCl7XG5cdFx0XHRcdGNsZWFyVGltZW91dCh0aGlzLmNoZWNrVGltZW91dCk7XG5cdFx0XHR9XG5cdFx0XHRpZih0aGlzLm1vdmluZyl7XG5cdFx0XHRcdHRoaXMuZW5kTW92ZShlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHRcblx0c3RhcnRNb3ZlKGUsIGNvbHVtbil7XG5cdFx0dmFyIGVsZW1lbnQgPSBjb2x1bW4uZ2V0RWxlbWVudCgpLFxuXHRcdGhlYWRlckVsZW1lbnQgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29udGVudHNFbGVtZW50KCksXG5cdFx0aGVhZGVyc0VsZW1lbnQgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0SGVhZGVyc0VsZW1lbnQoKTtcblx0XHRcblx0XHQvL1ByZXZlbnQgbW92aW5nIGNvbHVtbnMgd2hlbiByYW5nZSBzZWxlY3Rpb24gaXMgYWN0aXZlXG5cdFx0aWYodGhpcy50YWJsZS5tb2R1bGVzLnNlbGVjdFJhbmdlICYmIHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSYW5nZS5jb2x1bW5TZWxlY3Rpb24pe1xuXHRcdFx0aWYodGhpcy50YWJsZS5tb2R1bGVzLnNlbGVjdFJhbmdlLm1vdXNlZG93biAmJiB0aGlzLnRhYmxlLm1vZHVsZXMuc2VsZWN0UmFuZ2Uuc2VsZWN0aW5nID09PSBcImNvbHVtblwiKXtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMubW92aW5nID0gY29sdW1uO1xuXHRcdHRoaXMuc3RhcnRYID0gKHRoaXMudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWCkgLSBIZWxwZXJzLmVsT2Zmc2V0KGVsZW1lbnQpLmxlZnQ7XG5cdFx0XG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXHRcdFxuXHRcdC8vY3JlYXRlIHBsYWNlaG9sZGVyXG5cdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUud2lkdGggPSBjb2x1bW4uZ2V0V2lkdGgoKSArIFwicHhcIjtcblx0XHR0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBjb2x1bW4uZ2V0SGVpZ2h0KCkgKyBcInB4XCI7XG5cdFx0XG5cdFx0ZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLnBsYWNlaG9sZGVyRWxlbWVudCwgZWxlbWVudCk7XG5cdFx0ZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuXHRcdFxuXHRcdC8vY3JlYXRlIGhvdmVyIGVsZW1lbnRcblx0XHR0aGlzLmhvdmVyRWxlbWVudCA9IGVsZW1lbnQuY2xvbmVOb2RlKHRydWUpO1xuXHRcdHRoaXMuaG92ZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItbW92aW5nXCIpO1xuXHRcdFxuXHRcdGhlYWRlckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5ob3ZlckVsZW1lbnQpO1xuXHRcdFxuXHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLmxlZnQgPSBcIjBcIjtcblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS5ib3R0b20gPSAoaGVhZGVyRWxlbWVudC5jbGllbnRIZWlnaHQgLSBoZWFkZXJzRWxlbWVudC5vZmZzZXRIZWlnaHQpICsgXCJweFwiO1xuXHRcdFxuXHRcdGlmKCF0aGlzLnRvdWNoTW92ZSl7XG5cdFx0XHR0aGlzLl9iaW5kTW91c2VNb3ZlKCk7XG5cdFx0XHRcblx0XHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm1vdmVIb3Zlcik7XG5cdFx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMuZW5kTW92ZSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMubW92ZUhvdmVyKGUpO1xuXG5cdFx0dGhpcy5kaXNwYXRjaChcImNvbHVtbi1tb3ZpbmdcIiwgZSwgdGhpcy5tb3ZpbmcpO1xuXHR9XG5cdFxuXHRfYmluZE1vdXNlTW92ZSgpe1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5tb3ZlQ29sdW1uLm1vdXNlbW92ZSl7XG5cdFx0XHRcdGNvbHVtbi5nZXRFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBjb2x1bW4ubW9kdWxlcy5tb3ZlQ29sdW1uLm1vdXNlbW92ZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0XG5cdF91bmJpbmRNb3VzZU1vdmUoKXtcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pe1xuXHRcdFx0aWYoY29sdW1uLm1vZHVsZXMubW92ZUNvbHVtbi5tb3VzZW1vdmUpe1xuXHRcdFx0XHRjb2x1bW4uZ2V0RWxlbWVudCgpLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgY29sdW1uLm1vZHVsZXMubW92ZUNvbHVtbi5tb3VzZW1vdmUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHRtb3ZlQ29sdW1uKGNvbHVtbiwgYWZ0ZXIpe1xuXHRcdHZhciBtb3ZpbmdDZWxscyA9IHRoaXMubW92aW5nLmdldENlbGxzKCk7XG5cdFx0XG5cdFx0dGhpcy50b0NvbCA9IGNvbHVtbjtcblx0XHR0aGlzLnRvQ29sQWZ0ZXIgPSBhZnRlcjtcblx0XHRcblx0XHRpZihhZnRlcil7XG5cdFx0XHRjb2x1bW4uZ2V0Q2VsbHMoKS5mb3JFYWNoKGZ1bmN0aW9uKGNlbGwsIGkpe1xuXHRcdFx0XHR2YXIgY2VsbEVsID0gY2VsbC5nZXRFbGVtZW50KHRydWUpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoY2VsbEVsLnBhcmVudE5vZGUgJiYgbW92aW5nQ2VsbHNbaV0pe1xuXHRcdFx0XHRcdGNlbGxFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShtb3ZpbmdDZWxsc1tpXS5nZXRFbGVtZW50KCksIGNlbGxFbC5uZXh0U2libGluZyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbHVtbi5nZXRDZWxscygpLmZvckVhY2goZnVuY3Rpb24oY2VsbCwgaSl7XG5cdFx0XHRcdHZhciBjZWxsRWwgPSBjZWxsLmdldEVsZW1lbnQodHJ1ZSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihjZWxsRWwucGFyZW50Tm9kZSAmJiBtb3ZpbmdDZWxsc1tpXSl7XG5cdFx0XHRcdFx0Y2VsbEVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG1vdmluZ0NlbGxzW2ldLmdldEVsZW1lbnQoKSwgY2VsbEVsKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRlbmRNb3ZlKGUpe1xuXHRcdGlmKGUud2hpY2ggPT09IDEgfHwgdGhpcy50b3VjaE1vdmUpe1xuXHRcdFx0dGhpcy5fdW5iaW5kTW91c2VNb3ZlKCk7XG5cdFx0XHRcblx0XHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMubW92aW5nLmdldEVsZW1lbnQoKSwgdGhpcy5wbGFjZWhvbGRlckVsZW1lbnQubmV4dFNpYmxpbmcpO1xuXHRcdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyRWxlbWVudCk7XG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblx0XHRcdFxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnRvQ29sKXtcblx0XHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLm1vdmVDb2x1bW5BY3R1YWwodGhpcy5tb3ZpbmcsIHRoaXMudG9Db2wsIHRoaXMudG9Db2xBZnRlcik7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMubW92aW5nID0gZmFsc2U7XG5cdFx0XHR0aGlzLnRvQ29sID0gZmFsc2U7XG5cdFx0XHR0aGlzLnRvQ29sQWZ0ZXIgPSBmYWxzZTtcblx0XHRcdFxuXHRcdFx0aWYoIXRoaXMudG91Y2hNb3ZlKXtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMubW92ZUhvdmVyKTtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLmVuZE1vdmUpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0bW92ZUhvdmVyKGUpe1xuXHRcdHZhciBjb2x1bW5Ib2xkZXIgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29udGVudHNFbGVtZW50KCksXG5cdFx0c2Nyb2xsTGVmdCA9IGNvbHVtbkhvbGRlci5zY3JvbGxMZWZ0LFxuXHRcdHhQb3MgPSAoKHRoaXMudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VYIDogZS5wYWdlWCkgLSBIZWxwZXJzLmVsT2Zmc2V0KGNvbHVtbkhvbGRlcikubGVmdCkgKyBzY3JvbGxMZWZ0LFxuXHRcdHNjcm9sbFBvcztcblx0XHRcblx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS5sZWZ0ID0gKHhQb3MgLSB0aGlzLnN0YXJ0WCkgKyBcInB4XCI7XG5cdFx0XG5cdFx0aWYoeFBvcyAtIHNjcm9sbExlZnQgPCB0aGlzLmF1dG9TY3JvbGxNYXJnaW4pe1xuXHRcdFx0aWYoIXRoaXMuYXV0b1Njcm9sbFRpbWVvdXQpe1xuXHRcdFx0XHR0aGlzLmF1dG9TY3JvbGxUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdFx0c2Nyb2xsUG9zID0gTWF0aC5tYXgoMCxzY3JvbGxMZWZ0LTUpO1xuXHRcdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5nZXRFbGVtZW50KCkuc2Nyb2xsTGVmdCA9IHNjcm9sbFBvcztcblx0XHRcdFx0XHR0aGlzLmF1dG9TY3JvbGxUaW1lb3V0ID0gZmFsc2U7XG5cdFx0XHRcdH0sIDEpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRpZihzY3JvbGxMZWZ0ICsgY29sdW1uSG9sZGVyLmNsaWVudFdpZHRoIC0geFBvcyA8IHRoaXMuYXV0b1Njcm9sbE1hcmdpbil7XG5cdFx0XHRpZighdGhpcy5hdXRvU2Nyb2xsVGltZW91dCl7XG5cdFx0XHRcdHRoaXMuYXV0b1Njcm9sbFRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRzY3JvbGxQb3MgPSBNYXRoLm1pbihjb2x1bW5Ib2xkZXIuY2xpZW50V2lkdGgsIHNjcm9sbExlZnQrNSk7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldEVsZW1lbnQoKS5zY3JvbGxMZWZ0ID0gc2Nyb2xsUG9zO1xuXHRcdFx0XHRcdHRoaXMuYXV0b1Njcm9sbFRpbWVvdXQgPSBmYWxzZTtcblx0XHRcdFx0fSwgMSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59XG5cbnZhciBkZWZhdWx0U2VuZGVycyA9IHtcclxuXHRkZWxldGU6ZnVuY3Rpb24oZnJvbVJvdywgdG9Sb3csIHRvVGFibGUpe1xyXG5cdFx0ZnJvbVJvdy5kZWxldGUoKTtcclxuXHR9XHJcbn07XG5cbnZhciBkZWZhdWx0UmVjZWl2ZXJzID0ge1xyXG5cdGluc2VydDpmdW5jdGlvbihmcm9tUm93LCB0b1JvdywgZnJvbVRhYmxlKXtcclxuXHRcdHRoaXMudGFibGUuYWRkUm93KGZyb21Sb3cuZ2V0RGF0YSgpLCB1bmRlZmluZWQsIHRvUm93KTtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdGFkZDpmdW5jdGlvbihmcm9tUm93LCB0b1JvdywgZnJvbVRhYmxlKXtcclxuXHRcdHRoaXMudGFibGUuYWRkUm93KGZyb21Sb3cuZ2V0RGF0YSgpKTtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTpmdW5jdGlvbihmcm9tUm93LCB0b1JvdywgZnJvbVRhYmxlKXtcclxuXHRcdGlmKHRvUm93KXtcclxuXHRcdFx0dG9Sb3cudXBkYXRlKGZyb21Sb3cuZ2V0RGF0YSgpKTtcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdHJlcGxhY2U6ZnVuY3Rpb24oZnJvbVJvdywgdG9Sb3csIGZyb21UYWJsZSl7XHJcblx0XHRpZih0b1Jvdyl7XHJcblx0XHRcdHRoaXMudGFibGUuYWRkUm93KGZyb21Sb3cuZ2V0RGF0YSgpLCB1bmRlZmluZWQsIHRvUm93KTtcclxuXHRcdFx0dG9Sb3cuZGVsZXRlKCk7XHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9LFxyXG59O1xuXG5jbGFzcyBNb3ZlUm93cyBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwibW92ZVJvd1wiO1xuXG5cdC8vbG9hZCBkZWZhdWx0c1xuXHRzdGF0aWMgc2VuZGVycyA9IGRlZmF1bHRTZW5kZXJzO1xuXHRzdGF0aWMgcmVjZWl2ZXJzID0gZGVmYXVsdFJlY2VpdmVycztcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQgPSB0aGlzLmNyZWF0ZVBsYWNlaG9sZGVyRWxlbWVudCgpO1xuXHRcdHRoaXMuaG92ZXJFbGVtZW50ID0gZmFsc2U7IC8vZmxvYXRpbmcgcm93IGhlYWRlciBlbGVtZW50XG5cdFx0dGhpcy5jaGVja1RpbWVvdXQgPSBmYWxzZTsgLy9jbGljayBjaGVjayB0aW1lb3V0IGhvbGRlclxuXHRcdHRoaXMuY2hlY2tQZXJpb2QgPSAxNTA7IC8vcGVyaW9kIHRvIHdhaXQgb24gbW91c2Vkb3duIHRvIGNvbnNpZGVyIHRoaXMgYSBtb3ZlIGFuZCBub3QgYSBjbGlja1xuXHRcdHRoaXMubW92aW5nID0gZmFsc2U7IC8vY3VycmVudGx5IG1vdmluZyByb3dcblx0XHR0aGlzLnRvUm93ID0gZmFsc2U7IC8vZGVzdGluYXRpb24gcm93XG5cdFx0dGhpcy50b1Jvd0FmdGVyID0gZmFsc2U7IC8vcG9zaXRpb24gb2YgbW92aW5nIHJvdyByZWxhdGl2ZSB0byB0aGUgZGVzdGluYXRpb24gcm93XG5cdFx0dGhpcy5oYXNIYW5kbGUgPSBmYWxzZTsgLy9yb3cgaGFzIGhhbmRsZSBpbnN0ZWFkIG9mIGZ1bGx5IG1vdmFibGUgcm93XG5cdFx0dGhpcy5zdGFydFkgPSAwOyAvL3N0YXJ0aW5nIFkgcG9zaXRpb24gd2l0aGluIGhlYWRlciBlbGVtZW50XG5cdFx0dGhpcy5zdGFydFggPSAwOyAvL3N0YXJ0aW5nIFggcG9zaXRpb24gd2l0aGluIGhlYWRlciBlbGVtZW50XG5cblx0XHR0aGlzLm1vdmVIb3ZlciA9IHRoaXMubW92ZUhvdmVyLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5lbmRNb3ZlID0gdGhpcy5lbmRNb3ZlLmJpbmQodGhpcyk7XG5cdFx0dGhpcy50YWJsZVJvd0Ryb3BFdmVudCA9IGZhbHNlO1xuXG5cdFx0dGhpcy50b3VjaE1vdmUgPSBmYWxzZTtcblxuXHRcdHRoaXMuY29ubmVjdGlvbiA9IGZhbHNlO1xuXHRcdHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcyA9IGZhbHNlO1xuXHRcdHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc0VsZW1lbnRzID0gZmFsc2U7XG5cdFx0dGhpcy5jb25uZWN0aW9uRWxlbWVudHMgPSBbXTtcblx0XHR0aGlzLmNvbm5lY3Rpb25zID0gW107XG5cblx0XHR0aGlzLmNvbm5lY3RlZFRhYmxlID0gZmFsc2U7XG5cdFx0dGhpcy5jb25uZWN0ZWRSb3cgPSBmYWxzZTtcblxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcIm1vdmFibGVSb3dzXCIsIGZhbHNlKTsgLy9lbmFibGUgbW92YWJsZSByb3dzXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwibW92YWJsZVJvd3NDb25uZWN0ZWRUYWJsZXNcIiwgZmFsc2UpOyAvL3RhYmxlcyBmb3IgbW92YWJsZSByb3dzIHRvIGJlIGNvbm5lY3RlZCB0b1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcIm1vdmFibGVSb3dzQ29ubmVjdGVkRWxlbWVudHNcIiwgZmFsc2UpOyAvL290aGVyIGVsZW1lbnRzIGZvciBtb3ZhYmxlIHJvd3MgdG8gYmUgY29ubmVjdGVkIHRvXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwibW92YWJsZVJvd3NTZW5kZXJcIiwgZmFsc2UpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcIm1vdmFibGVSb3dzUmVjZWl2ZXJcIiwgXCJpbnNlcnRcIik7XG5cblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwicm93SGFuZGxlXCIpO1xuXHR9XG5cblx0Y3JlYXRlUGxhY2Vob2xkZXJFbGVtZW50KCl7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93XCIpO1xuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LXBsYWNlaG9sZGVyXCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9XG5cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93cyl7XG5cdFx0XHR0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNUYWJsZXMgPSB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NDb25uZWN0ZWRUYWJsZXM7XG5cdFx0XHR0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNFbGVtZW50cyA9IHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c0Nvbm5lY3RlZEVsZW1lbnRzO1xuXG5cdFx0XHR0aGlzLmNvbm5lY3Rpb24gPSB0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNUYWJsZXMgfHwgdGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzRWxlbWVudHM7XG5cblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1pbml0XCIsIHRoaXMuaW5pdGlhbGl6ZUNlbGwuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1pbml0XCIsIHRoaXMuaW5pdGlhbGl6ZUNvbHVtbi5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWluaXRcIiwgdGhpcy5pbml0aWFsaXplUm93LmJpbmQodGhpcykpO1xuXHRcdH1cblx0fVxuXG5cdGluaXRpYWxpemVHcm91cEhlYWRlcihncm91cCl7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdGNvbmZpZyA9IHt9O1xuXG5cdFx0Ly9pbnRlciB0YWJsZSBkcmFnIGRyb3Bcblx0XHRjb25maWcubW91c2V1cCA9IGZ1bmN0aW9uKGUpe1xuXHRcdFx0c2VsZi50YWJsZVJvd0Ryb3AoZSwgZ3JvdXApO1xuXHRcdH0uYmluZChzZWxmKTtcblxuXHRcdC8vc2FtZSB0YWJsZSBkcmFnIGRyb3Bcblx0XHRjb25maWcubW91c2Vtb3ZlID0gZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgcm93RWw7XG5cblx0XHRcdGlmKCgoZS5wYWdlWSAtIEhlbHBlcnMuZWxPZmZzZXQoZ3JvdXAuZWxlbWVudCkudG9wKSArIHNlbGYudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbFRvcCkgPiAoZ3JvdXAuZ2V0SGVpZ2h0KCkgLyAyKSl7XG5cdFx0XHRcdGlmKHNlbGYudG9Sb3cgIT09IGdyb3VwIHx8ICFzZWxmLnRvUm93QWZ0ZXIpe1xuXHRcdFx0XHRcdHJvd0VsID0gZ3JvdXAuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XHRcdHJvd0VsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCByb3dFbC5uZXh0U2libGluZyk7XG5cdFx0XHRcdFx0c2VsZi5tb3ZlUm93KGdyb3VwLCB0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZihzZWxmLnRvUm93ICE9PSBncm91cCB8fCBzZWxmLnRvUm93QWZ0ZXIpe1xuXHRcdFx0XHRcdHJvd0VsID0gZ3JvdXAuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XHRcdGlmKHJvd0VsLnByZXZpb3VzU2libGluZyl7XG5cdFx0XHRcdFx0XHRyb3dFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLnBsYWNlaG9sZGVyRWxlbWVudCwgcm93RWwpO1xuXHRcdFx0XHRcdFx0c2VsZi5tb3ZlUm93KGdyb3VwLCBmYWxzZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fS5iaW5kKHNlbGYpO1xuXG5cdFx0Z3JvdXAubW9kdWxlcy5tb3ZlUm93ID0gY29uZmlnO1xuXHR9XG5cblx0aW5pdGlhbGl6ZVJvdyhyb3cpe1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRjb25maWcgPSB7fSxcblx0XHRyb3dFbDtcblxuXHRcdC8vaW50ZXIgdGFibGUgZHJhZyBkcm9wXG5cdFx0Y29uZmlnLm1vdXNldXAgPSBmdW5jdGlvbihlKXtcblx0XHRcdHNlbGYudGFibGVSb3dEcm9wKGUsIHJvdyk7XG5cdFx0fS5iaW5kKHNlbGYpO1xuXG5cdFx0Ly9zYW1lIHRhYmxlIGRyYWcgZHJvcFxuXHRcdGNvbmZpZy5tb3VzZW1vdmUgPSBmdW5jdGlvbihlKXtcblx0XHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cblx0XHRcdGlmKCgoZS5wYWdlWSAtIEhlbHBlcnMuZWxPZmZzZXQocm93RWwpLnRvcCkgKyBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3ApID4gKHJvdy5nZXRIZWlnaHQoKSAvIDIpKXtcblx0XHRcdFx0aWYoc2VsZi50b1JvdyAhPT0gcm93IHx8ICFzZWxmLnRvUm93QWZ0ZXIpe1xuXHRcdFx0XHRcdHJvd0VsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYucGxhY2Vob2xkZXJFbGVtZW50LCByb3dFbC5uZXh0U2libGluZyk7XG5cdFx0XHRcdFx0c2VsZi5tb3ZlUm93KHJvdywgdHJ1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYoc2VsZi50b1JvdyAhPT0gcm93IHx8IHNlbGYudG9Sb3dBZnRlcil7XG5cdFx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5wbGFjZWhvbGRlckVsZW1lbnQsIHJvd0VsKTtcblx0XHRcdFx0XHRzZWxmLm1vdmVSb3cocm93LCBmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9LmJpbmQoc2VsZik7XG5cblxuXHRcdGlmKCF0aGlzLmhhc0hhbmRsZSl7XG5cblx0XHRcdHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdFx0cm93RWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0aWYoZS53aGljaCA9PT0gMSl7XG5cdFx0XHRcdFx0c2VsZi5jaGVja1RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRzZWxmLnN0YXJ0TW92ZShlLCByb3cpO1xuXHRcdFx0XHRcdH0sIHNlbGYuY2hlY2tQZXJpb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0cm93RWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmKGUud2hpY2ggPT09IDEpe1xuXHRcdFx0XHRcdGlmKHNlbGYuY2hlY2tUaW1lb3V0KXtcblx0XHRcdFx0XHRcdGNsZWFyVGltZW91dChzZWxmLmNoZWNrVGltZW91dCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5iaW5kVG91Y2hFdmVudHMocm93LCByb3cuZ2V0RWxlbWVudCgpKTtcblx0XHR9XG5cblx0XHRyb3cubW9kdWxlcy5tb3ZlUm93ID0gY29uZmlnO1xuXHR9XG5cblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLnJvd0hhbmRsZSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3MgIT09IGZhbHNlKXtcblx0XHRcdHRoaXMuaGFzSGFuZGxlID0gdHJ1ZTtcblx0XHR9XG5cdH1cblxuXHRpbml0aWFsaXplQ2VsbChjZWxsKXtcblx0XHRpZihjZWxsLmNvbHVtbi5kZWZpbml0aW9uLnJvd0hhbmRsZSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3MgIT09IGZhbHNlKXtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdGNlbGxFbCA9IGNlbGwuZ2V0RWxlbWVudCh0cnVlKTtcblxuXHRcdFx0Y2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmKGUud2hpY2ggPT09IDEpe1xuXHRcdFx0XHRcdHNlbGYuY2hlY2tUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0c2VsZi5zdGFydE1vdmUoZSwgY2VsbC5yb3cpO1xuXHRcdFx0XHRcdH0sIHNlbGYuY2hlY2tQZXJpb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Y2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZihlLndoaWNoID09PSAxKXtcblx0XHRcdFx0XHRpZihzZWxmLmNoZWNrVGltZW91dCl7XG5cdFx0XHRcdFx0XHRjbGVhclRpbWVvdXQoc2VsZi5jaGVja1RpbWVvdXQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuYmluZFRvdWNoRXZlbnRzKGNlbGwucm93LCBjZWxsRWwpO1xuXHRcdH1cblx0fVxuXG5cdGJpbmRUb3VjaEV2ZW50cyhyb3csIGVsZW1lbnQpe1xuXHRcdHZhciBzdGFydFlNb3ZlID0gZmFsc2UsIC8vc2hpZnRpbmcgY2VudGVyIHBvc2l0aW9uIG9mIHRoZSBjZWxsXG5cdFx0bmV4dFJvdywgcHJldlJvdywgbmV4dFJvd0hlaWdodCwgcHJldlJvd0hlaWdodCwgbmV4dFJvd0hlaWdodExhc3QsIHByZXZSb3dIZWlnaHRMYXN0O1xuXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZSkgPT4ge1xuXHRcdFx0dGhpcy5jaGVja1RpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0dGhpcy50b3VjaE1vdmUgPSB0cnVlO1xuXHRcdFx0XHRuZXh0Um93ID0gcm93Lm5leHRSb3coKTtcblx0XHRcdFx0bmV4dFJvd0hlaWdodCA9IG5leHRSb3cgPyBuZXh0Um93LmdldEhlaWdodCgpLzIgOiAwO1xuXHRcdFx0XHRwcmV2Um93ID0gcm93LnByZXZSb3coKTtcblx0XHRcdFx0cHJldlJvd0hlaWdodCA9IHByZXZSb3cgPyBwcmV2Um93LmdldEhlaWdodCgpLzIgOiAwO1xuXHRcdFx0XHRuZXh0Um93SGVpZ2h0TGFzdCA9IDA7XG5cdFx0XHRcdHByZXZSb3dIZWlnaHRMYXN0ID0gMDtcblx0XHRcdFx0c3RhcnRZTW92ZSA9IGZhbHNlO1xuXG5cdFx0XHRcdHRoaXMuc3RhcnRNb3ZlKGUsIHJvdyk7XG5cdFx0XHR9LCB0aGlzLmNoZWNrUGVyaW9kKTtcblx0XHR9LCB7cGFzc2l2ZTogdHJ1ZX0pO1xuXHRcdHRoaXMubW92aW5nLCB0aGlzLnRvUm93LCB0aGlzLnRvUm93QWZ0ZXI7XG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIChlKSA9PiB7XG5cblx0XHRcdHZhciBkaWZmLCBtb3ZlVG9Sb3c7XG5cblx0XHRcdGlmKHRoaXMubW92aW5nKXtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRcdHRoaXMubW92ZUhvdmVyKGUpO1xuXG5cdFx0XHRcdGlmKCFzdGFydFlNb3ZlKXtcblx0XHRcdFx0XHRzdGFydFlNb3ZlID0gZS50b3VjaGVzWzBdLnBhZ2VZO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGlmZiA9IGUudG91Y2hlc1swXS5wYWdlWSAtIHN0YXJ0WU1vdmU7XG5cblx0XHRcdFx0aWYoZGlmZiA+IDApe1xuXHRcdFx0XHRcdGlmKG5leHRSb3cgJiYgZGlmZiAtIG5leHRSb3dIZWlnaHRMYXN0ID4gbmV4dFJvd0hlaWdodCl7XG5cdFx0XHRcdFx0XHRtb3ZlVG9Sb3cgPSBuZXh0Um93O1xuXG5cdFx0XHRcdFx0XHRpZihtb3ZlVG9Sb3cgIT09IHJvdyl7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0WU1vdmUgPSBlLnRvdWNoZXNbMF0ucGFnZVk7XG5cdFx0XHRcdFx0XHRcdG1vdmVUb1Jvdy5nZXRFbGVtZW50KCkucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQsIG1vdmVUb1Jvdy5nZXRFbGVtZW50KCkubmV4dFNpYmxpbmcpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLm1vdmVSb3cobW92ZVRvUm93LCB0cnVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRpZihwcmV2Um93ICYmIC1kaWZmIC0gcHJldlJvd0hlaWdodExhc3QgPiAgcHJldlJvd0hlaWdodCl7XG5cdFx0XHRcdFx0XHRtb3ZlVG9Sb3cgPSBwcmV2Um93O1xuXG5cdFx0XHRcdFx0XHRpZihtb3ZlVG9Sb3cgIT09IHJvdyl7XG5cdFx0XHRcdFx0XHRcdHN0YXJ0WU1vdmUgPSBlLnRvdWNoZXNbMF0ucGFnZVk7XG5cdFx0XHRcdFx0XHRcdG1vdmVUb1Jvdy5nZXRFbGVtZW50KCkucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQsIG1vdmVUb1Jvdy5nZXRFbGVtZW50KCkpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLm1vdmVSb3cobW92ZVRvUm93LCBmYWxzZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYobW92ZVRvUm93KXtcblx0XHRcdFx0XHRuZXh0Um93ID0gbW92ZVRvUm93Lm5leHRSb3coKTtcblx0XHRcdFx0XHRuZXh0Um93SGVpZ2h0TGFzdCA9IG5leHRSb3dIZWlnaHQ7XG5cdFx0XHRcdFx0bmV4dFJvd0hlaWdodCA9IG5leHRSb3cgPyBuZXh0Um93LmdldEhlaWdodCgpIC8gMiA6IDA7XG5cdFx0XHRcdFx0cHJldlJvdyA9IG1vdmVUb1Jvdy5wcmV2Um93KCk7XG5cdFx0XHRcdFx0cHJldlJvd0hlaWdodExhc3QgPSBwcmV2Um93SGVpZ2h0O1xuXHRcdFx0XHRcdHByZXZSb3dIZWlnaHQgPSBwcmV2Um93ID8gcHJldlJvdy5nZXRIZWlnaHQoKSAvIDIgOiAwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCAoZSkgPT4ge1xuXHRcdFx0aWYodGhpcy5jaGVja1RpbWVvdXQpe1xuXHRcdFx0XHRjbGVhclRpbWVvdXQodGhpcy5jaGVja1RpbWVvdXQpO1xuXHRcdFx0fVxuXHRcdFx0aWYodGhpcy5tb3Zpbmcpe1xuXHRcdFx0XHR0aGlzLmVuZE1vdmUoZSk7XG5cdFx0XHRcdHRoaXMudG91Y2hNb3ZlID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuXHRfYmluZE1vdXNlTW92ZSgpe1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0aWYoKHJvdy50eXBlID09PSBcInJvd1wiIHx8IHJvdy50eXBlID09PSBcImdyb3VwXCIpICYmIHJvdy5tb2R1bGVzLm1vdmVSb3cgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZW1vdmUpe1xuXHRcdFx0XHRyb3cuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZW1vdmUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0X3VuYmluZE1vdXNlTW92ZSgpe1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0aWYoKHJvdy50eXBlID09PSBcInJvd1wiIHx8IHJvdy50eXBlID09PSBcImdyb3VwXCIpICYmIHJvdy5tb2R1bGVzLm1vdmVSb3cgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZW1vdmUpe1xuXHRcdFx0XHRyb3cuZ2V0RWxlbWVudCgpLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZW1vdmUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0c3RhcnRNb3ZlKGUsIHJvdyl7XG5cdFx0dmFyIGVsZW1lbnQgPSByb3cuZ2V0RWxlbWVudCgpO1xuXG5cdFx0dGhpcy5zZXRTdGFydFBvc2l0aW9uKGUsIHJvdyk7XG5cblx0XHR0aGlzLm1vdmluZyA9IHJvdztcblxuXHRcdHRoaXMudGFibGUuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWJsb2NrLXNlbGVjdFwiKTtcblxuXHRcdC8vY3JlYXRlIHBsYWNlaG9sZGVyXG5cdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUud2lkdGggPSByb3cuZ2V0V2lkdGgoKSArIFwicHhcIjtcblx0XHR0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5zdHlsZS5oZWlnaHQgPSByb3cuZ2V0SGVpZ2h0KCkgKyBcInB4XCI7XG5cblx0XHRpZighdGhpcy5jb25uZWN0aW9uKXtcblx0XHRcdGVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQsIGVsZW1lbnQpO1xuXHRcdFx0ZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1vdmluZ3Jvdy1zZW5kaW5nXCIpO1xuXHRcdFx0dGhpcy5jb25uZWN0VG9UYWJsZXMocm93KTtcblx0XHR9XG5cblx0XHQvL2NyZWF0ZSBob3ZlciBlbGVtZW50XG5cdFx0dGhpcy5ob3ZlckVsZW1lbnQgPSBlbGVtZW50LmNsb25lTm9kZSh0cnVlKTtcblx0XHR0aGlzLmhvdmVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1vdmluZ1wiKTtcblxuXHRcdGlmKHRoaXMuY29ubmVjdGlvbil7XG5cdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLmxlZnQgPSBcIjBcIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLnRvcCA9IFwiMFwiO1xuXHRcdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGggKyBcInB4XCI7XG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS53aGl0ZVNwYWNlID0gXCJub3dyYXBcIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblx0XHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0VGFibGVFbGVtZW50KCkuYXBwZW5kQ2hpbGQodGhpcy5ob3ZlckVsZW1lbnQpO1xuXG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS5sZWZ0ID0gXCIwXCI7XG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5zdHlsZS50b3AgPSBcIjBcIjtcblxuXHRcdFx0dGhpcy5fYmluZE1vdXNlTW92ZSgpO1xuXHRcdH1cblxuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm1vdmVIb3Zlcik7XG5cdFx0ZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLmVuZE1vdmUpO1xuXG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicm93TW92aW5nXCIsIHJvdy5nZXRDb21wb25lbnQoKSk7XG5cblx0XHR0aGlzLm1vdmVIb3ZlcihlKTtcblx0fVxuXG5cdHNldFN0YXJ0UG9zaXRpb24oZSwgcm93KXtcblx0XHR2YXIgcGFnZVggPSB0aGlzLnRvdWNoTW92ZSA/IGUudG91Y2hlc1swXS5wYWdlWCA6IGUucGFnZVgsXG5cdFx0cGFnZVkgPSB0aGlzLnRvdWNoTW92ZSA/IGUudG91Y2hlc1swXS5wYWdlWSA6IGUucGFnZVksXG5cdFx0ZWxlbWVudCwgcG9zaXRpb247XG5cblx0XHRlbGVtZW50ID0gcm93LmdldEVsZW1lbnQoKTtcblx0XHRpZih0aGlzLmNvbm5lY3Rpb24pe1xuXHRcdFx0cG9zaXRpb24gPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG5cdFx0XHR0aGlzLnN0YXJ0WCA9IHBvc2l0aW9uLmxlZnQgLSBwYWdlWCArIHdpbmRvdy5wYWdlWE9mZnNldDtcblx0XHRcdHRoaXMuc3RhcnRZID0gcG9zaXRpb24udG9wIC0gcGFnZVkgKyB3aW5kb3cucGFnZVlPZmZzZXQ7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5zdGFydFkgPSAocGFnZVkgLSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCk7XG5cdFx0fVxuXHR9XG5cblx0ZW5kTW92ZShlKXtcblx0XHRpZighZSB8fCBlLndoaWNoID09PSAxIHx8IHRoaXMudG91Y2hNb3ZlKXtcblx0XHRcdHRoaXMuX3VuYmluZE1vdXNlTW92ZSgpO1xuXG5cdFx0XHRpZighdGhpcy5jb25uZWN0aW9uKXtcblx0XHRcdFx0dGhpcy5wbGFjZWhvbGRlckVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5tb3ZpbmcuZ2V0RWxlbWVudCgpLCB0aGlzLnBsYWNlaG9sZGVyRWxlbWVudC5uZXh0U2libGluZyk7XG5cdFx0XHRcdHRoaXMucGxhY2Vob2xkZXJFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlckVsZW1lbnQpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmhvdmVyRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuaG92ZXJFbGVtZW50KTtcblxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXG5cdFx0XHRpZih0aGlzLnRvUm93KXtcblx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLm1vdmVSb3codGhpcy5tb3ZpbmcsIHRoaXMudG9Sb3csIHRoaXMudG9Sb3dBZnRlcik7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInJvd01vdmVDYW5jZWxsZWRcIiwgdGhpcy5tb3ZpbmcuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLm1vdmluZyA9IGZhbHNlO1xuXHRcdFx0dGhpcy50b1JvdyA9IGZhbHNlO1xuXHRcdFx0dGhpcy50b1Jvd0FmdGVyID0gZmFsc2U7XG5cblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCB0aGlzLm1vdmVIb3Zlcik7XG5cdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMuZW5kTW92ZSk7XG5cblx0XHRcdGlmKHRoaXMuY29ubmVjdGlvbil7XG5cdFx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLW1vdmluZ3Jvdy1zZW5kaW5nXCIpO1xuXHRcdFx0XHR0aGlzLmRpc2Nvbm5lY3RGcm9tVGFibGVzKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0bW92ZVJvdyhyb3csIGFmdGVyKXtcblx0XHR0aGlzLnRvUm93ID0gcm93O1xuXHRcdHRoaXMudG9Sb3dBZnRlciA9IGFmdGVyO1xuXHR9XG5cblx0bW92ZUhvdmVyKGUpe1xuXHRcdGlmKHRoaXMuY29ubmVjdGlvbil7XG5cdFx0XHR0aGlzLm1vdmVIb3ZlckNvbm5lY3Rpb25zLmNhbGwodGhpcywgZSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5tb3ZlSG92ZXJUYWJsZS5jYWxsKHRoaXMsIGUpO1xuXHRcdH1cblx0fVxuXG5cdG1vdmVIb3ZlclRhYmxlKGUpe1xuXHRcdHZhciByb3dIb2xkZXIgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RWxlbWVudCgpLFxuXHRcdHNjcm9sbFRvcCA9IHJvd0hvbGRlci5zY3JvbGxUb3AsXG5cdFx0eVBvcyA9ICgodGhpcy50b3VjaE1vdmUgPyBlLnRvdWNoZXNbMF0ucGFnZVkgOiBlLnBhZ2VZKSAtIHJvd0hvbGRlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3ApICsgc2Nyb2xsVG9wO1xuXHRcdFxuXHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLnRvcCA9IE1hdGgubWluKHlQb3MgLSB0aGlzLnN0YXJ0WSwgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gdGhpcy5ob3ZlckVsZW1lbnQub2Zmc2V0SGVpZ2h0KSArIFwicHhcIjtcblx0fVxuXG5cdG1vdmVIb3ZlckNvbm5lY3Rpb25zKGUpe1xuXHRcdHRoaXMuaG92ZXJFbGVtZW50LnN0eWxlLmxlZnQgPSAodGhpcy5zdGFydFggKyAodGhpcy50b3VjaE1vdmUgPyBlLnRvdWNoZXNbMF0ucGFnZVggOiBlLnBhZ2VYKSkgKyBcInB4XCI7XG5cdFx0dGhpcy5ob3ZlckVsZW1lbnQuc3R5bGUudG9wID0gKHRoaXMuc3RhcnRZICsgKHRoaXMudG91Y2hNb3ZlID8gZS50b3VjaGVzWzBdLnBhZ2VZIDogZS5wYWdlWSkpICsgXCJweFwiO1xuXHR9XG5cblx0ZWxlbWVudFJvd0Ryb3AoZSwgZWxlbWVudCwgcm93KXtcblx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJtb3ZhYmxlUm93c0VsZW1lbnREcm9wXCIsIGUsIGVsZW1lbnQsIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IGZhbHNlKTtcblx0fVxuXG5cdC8vZXN0YWJsaXNoIGNvbm5lY3Rpb24gd2l0aCBvdGhlciB0YWJsZXNcblx0Y29ubmVjdFRvVGFibGVzKHJvdyl7XG5cdFx0dmFyIGNvbm5lY3Rpb25UYWJsZXM7XG5cblx0XHRpZih0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNUYWJsZXMpe1xuXHRcdFx0Y29ubmVjdGlvblRhYmxlcyA9IHRoaXMuY29tbXNDb25uZWN0aW9ucyh0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNUYWJsZXMpO1xuXG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJtb3ZhYmxlUm93c1NlbmRpbmdTdGFydFwiLCBjb25uZWN0aW9uVGFibGVzKTtcblxuXHRcdFx0dGhpcy5jb21tc1NlbmQodGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzVGFibGVzLCBcIm1vdmVSb3dcIiwgXCJjb25uZWN0XCIsIHtcblx0XHRcdFx0cm93OnJvdyxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmKHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc0VsZW1lbnRzKXtcblxuXHRcdFx0dGhpcy5jb25uZWN0aW9uRWxlbWVudHMgPSBbXTtcblxuXHRcdFx0aWYoIUFycmF5LmlzQXJyYXkodGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzRWxlbWVudHMpKXtcblx0XHRcdFx0dGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzRWxlbWVudHMgPSBbdGhpcy5jb25uZWN0aW9uU2VsZWN0b3JzRWxlbWVudHNdO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmNvbm5lY3Rpb25TZWxlY3RvcnNFbGVtZW50cy5mb3JFYWNoKChxdWVyeSkgPT4ge1xuXHRcdFx0XHRpZih0eXBlb2YgcXVlcnkgPT09IFwic3RyaW5nXCIpe1xuXHRcdFx0XHRcdHRoaXMuY29ubmVjdGlvbkVsZW1lbnRzID0gdGhpcy5jb25uZWN0aW9uRWxlbWVudHMuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXVlcnkpKSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR0aGlzLmNvbm5lY3Rpb25FbGVtZW50cy5wdXNoKHF1ZXJ5KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuY29ubmVjdGlvbkVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcblx0XHRcdFx0dmFyIGRyb3BFdmVudCA9IChlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5lbGVtZW50Um93RHJvcChlLCBlbGVtZW50LCB0aGlzLm1vdmluZyk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBkcm9wRXZlbnQpO1xuXHRcdFx0XHRlbGVtZW50LnRhYnVsYXRvckVsZW1lbnREcm9wRXZlbnQgPSBkcm9wRXZlbnQ7XG5cblx0XHRcdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLW1vdmluZ3Jvdy1yZWNlaXZpbmdcIik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHQvL2Rpc2Nvbm5lY3QgZnJvbSBvdGhlciB0YWJsZXNcblx0ZGlzY29ubmVjdEZyb21UYWJsZXMoKXtcblx0XHR2YXIgY29ubmVjdGlvblRhYmxlcztcblxuXHRcdGlmKHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcyl7XG5cdFx0XHRjb25uZWN0aW9uVGFibGVzID0gdGhpcy5jb21tc0Nvbm5lY3Rpb25zKHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcyk7XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcIm1vdmFibGVSb3dzU2VuZGluZ1N0b3BcIiwgY29ubmVjdGlvblRhYmxlcyk7XG5cblx0XHRcdHRoaXMuY29tbXNTZW5kKHRoaXMuY29ubmVjdGlvblNlbGVjdG9yc1RhYmxlcywgXCJtb3ZlUm93XCIsIFwiZGlzY29ubmVjdFwiKTtcblx0XHR9XG5cblx0XHR0aGlzLmNvbm5lY3Rpb25FbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG5cdFx0XHRlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItbW92aW5ncm93LXJlY2VpdmluZ1wiKTtcblx0XHRcdGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZWxlbWVudC50YWJ1bGF0b3JFbGVtZW50RHJvcEV2ZW50KTtcblx0XHRcdGRlbGV0ZSBlbGVtZW50LnRhYnVsYXRvckVsZW1lbnREcm9wRXZlbnQ7XG5cdFx0fSk7XG5cdH1cblxuXHQvL2FjY2VwdCBpbmNvbW1pbmcgY29ubmVjdGlvblxuXHRjb25uZWN0KHRhYmxlLCByb3cpe1xuXHRcdGlmKCF0aGlzLmNvbm5lY3RlZFRhYmxlKXtcblx0XHRcdHRoaXMuY29ubmVjdGVkVGFibGUgPSB0YWJsZTtcblx0XHRcdHRoaXMuY29ubmVjdGVkUm93ID0gcm93O1xuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1tb3Zpbmdyb3ctcmVjZWl2aW5nXCIpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKS5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0aWYocm93LnR5cGUgPT09IFwicm93XCIgJiYgcm93Lm1vZHVsZXMubW92ZVJvdyAmJiByb3cubW9kdWxlcy5tb3ZlUm93Lm1vdXNldXApe1xuXHRcdFx0XHRcdHJvdy5nZXRFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZXVwKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMudGFibGVSb3dEcm9wRXZlbnQgPSB0aGlzLnRhYmxlUm93RHJvcC5iaW5kKHRoaXMpO1xuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy50YWJsZVJvd0Ryb3BFdmVudCk7XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcIm1vdmFibGVSb3dzUmVjZWl2aW5nU3RhcnRcIiwgcm93LCB0YWJsZSk7XG5cblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIk1vdmUgUm93IEVycm9yIC0gVGFibGUgY2Fubm90IGFjY2VwdCBjb25uZWN0aW9uLCBhbHJlYWR5IGNvbm5lY3RlZCB0byB0YWJsZTpcIiwgdGhpcy5jb25uZWN0ZWRUYWJsZSk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cblx0Ly9jbG9zZSBpbmNvbWluZyBjb25uZWN0aW9uXG5cdGRpc2Nvbm5lY3QodGFibGUpe1xuXHRcdGlmKHRhYmxlID09PSB0aGlzLmNvbm5lY3RlZFRhYmxlKXtcblx0XHRcdHRoaXMuY29ubmVjdGVkVGFibGUgPSBmYWxzZTtcblx0XHRcdHRoaXMuY29ubmVjdGVkUm93ID0gZmFsc2U7XG5cblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLW1vdmluZ3Jvdy1yZWNlaXZpbmdcIik7XG5cblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLmZvckVhY2goKHJvdykgPT57XG5cdFx0XHRcdGlmKHJvdy50eXBlID09PSBcInJvd1wiICYmIHJvdy5tb2R1bGVzLm1vdmVSb3cgJiYgcm93Lm1vZHVsZXMubW92ZVJvdy5tb3VzZXVwKXtcblx0XHRcdFx0XHRyb3cuZ2V0RWxlbWVudCgpLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHJvdy5tb2R1bGVzLm1vdmVSb3cubW91c2V1cCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLnRhYmxlLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy50YWJsZVJvd0Ryb3BFdmVudCk7XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcIm1vdmFibGVSb3dzUmVjZWl2aW5nU3RvcFwiLCB0YWJsZSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiTW92ZSBSb3cgRXJyb3IgLSB0cnlpbmcgdG8gZGlzY29ubmVjdCBmcm9tIG5vbiBjb25uZWN0ZWQgdGFibGVcIik7XG5cdFx0fVxuXHR9XG5cblx0ZHJvcENvbXBsZXRlKHRhYmxlLCByb3csIHN1Y2Nlc3Mpe1xuXHRcdHZhciBzZW5kZXIgPSBmYWxzZTtcblxuXHRcdGlmKHN1Y2Nlc3Mpe1xuXG5cdFx0XHRzd2l0Y2godHlwZW9mIHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbmRlcil7XG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRzZW5kZXIgPSBNb3ZlUm93cy5zZW5kZXJzW3RoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbmRlcl07XG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdFx0c2VuZGVyID0gdGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzU2VuZGVyO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihzZW5kZXIpe1xuXHRcdFx0XHRzZW5kZXIuY2FsbCh0aGlzLCB0aGlzLm1vdmluZyA/IHRoaXMubW92aW5nLmdldENvbXBvbmVudCgpIDogdW5kZWZpbmVkLCByb3cgPyByb3cuZ2V0Q29tcG9uZW50KCkgOiB1bmRlZmluZWQsIHRhYmxlKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzU2VuZGVyKXtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlciBSb3cgRXJyb3IgLSBubyBtYXRjaGluZyBzZW5kZXIgZm91bmQ6XCIsIHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1NlbmRlcik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwibW92YWJsZVJvd3NTZW50XCIsIHRoaXMubW92aW5nLmdldENvbXBvbmVudCgpLCByb3cgPyByb3cuZ2V0Q29tcG9uZW50KCkgOiB1bmRlZmluZWQsIHRhYmxlKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJtb3ZhYmxlUm93c1NlbnRGYWlsZWRcIiwgdGhpcy5tb3ZpbmcuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGFibGUpO1xuXHRcdH1cblxuXHRcdHRoaXMuZW5kTW92ZSgpO1xuXHR9XG5cblx0dGFibGVSb3dEcm9wKGUsIHJvdyl7XG5cdFx0dmFyIHJlY2VpdmVyID0gZmFsc2UsXG5cdFx0c3VjY2VzcyA9IGZhbHNlO1xuXG5cdFx0ZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcblxuXHRcdHN3aXRjaCh0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLm1vdmFibGVSb3dzUmVjZWl2ZXIpe1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRyZWNlaXZlciA9IE1vdmVSb3dzLnJlY2VpdmVyc1t0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NSZWNlaXZlcl07XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0cmVjZWl2ZXIgPSB0aGlzLnRhYmxlLm9wdGlvbnMubW92YWJsZVJvd3NSZWNlaXZlcjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0aWYocmVjZWl2ZXIpe1xuXHRcdFx0c3VjY2VzcyA9IHJlY2VpdmVyLmNhbGwodGhpcywgdGhpcy5jb25uZWN0ZWRSb3cuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGhpcy5jb25uZWN0ZWRUYWJsZSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiTW92ZXIgUm93IEVycm9yIC0gbm8gbWF0Y2hpbmcgcmVjZWl2ZXIgZm91bmQ6XCIsIHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlUm93c1JlY2VpdmVyKTtcblx0XHR9XG5cblx0XHRpZihzdWNjZXNzKXtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcIm1vdmFibGVSb3dzUmVjZWl2ZWRcIiwgdGhpcy5jb25uZWN0ZWRSb3cuZ2V0Q29tcG9uZW50KCksIHJvdyA/IHJvdy5nZXRDb21wb25lbnQoKSA6IHVuZGVmaW5lZCwgdGhpcy5jb25uZWN0ZWRUYWJsZSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwibW92YWJsZVJvd3NSZWNlaXZlZEZhaWxlZFwiLCB0aGlzLmNvbm5lY3RlZFJvdy5nZXRDb21wb25lbnQoKSwgcm93ID8gcm93LmdldENvbXBvbmVudCgpIDogdW5kZWZpbmVkLCB0aGlzLmNvbm5lY3RlZFRhYmxlKTtcblx0XHR9XG5cblx0XHR0aGlzLmNvbW1zU2VuZCh0aGlzLmNvbm5lY3RlZFRhYmxlLCBcIm1vdmVSb3dcIiwgXCJkcm9wY29tcGxldGVcIiwge1xuXHRcdFx0cm93OnJvdyxcblx0XHRcdHN1Y2Nlc3M6c3VjY2Vzcyxcblx0XHR9KTtcblx0fVxuXG5cdGNvbW1zUmVjZWl2ZWQodGFibGUsIGFjdGlvbiwgZGF0YSl7XG5cdFx0c3dpdGNoKGFjdGlvbil7XG5cdFx0XHRjYXNlIFwiY29ubmVjdFwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5jb25uZWN0KHRhYmxlLCBkYXRhLnJvdyk7XG5cblx0XHRcdGNhc2UgXCJkaXNjb25uZWN0XCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLmRpc2Nvbm5lY3QodGFibGUpO1xuXG5cdFx0XHRjYXNlIFwiZHJvcGNvbXBsZXRlXCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLmRyb3BDb21wbGV0ZSh0YWJsZSwgZGF0YS5yb3csIGRhdGEuc3VjY2Vzcyk7XG5cdFx0fVxuXHR9XG59XG5cbnZhciBkZWZhdWx0TXV0YXRvcnMgPSB7fTtcblxuY2xhc3MgTXV0YXRvciBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwibXV0YXRvclwiO1xuXG5cdC8vbG9hZCBkZWZhdWx0c1xuXHRzdGF0aWMgbXV0YXRvcnMgPSBkZWZhdWx0TXV0YXRvcnM7XG5cblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblxuXHRcdHRoaXMuYWxsb3dlZFR5cGVzID0gW1wiXCIsIFwiZGF0YVwiLCBcImVkaXRcIiwgXCJjbGlwYm9hcmRcIiwgXCJpbXBvcnRcIl07IC8vbGlzdCBvZiBtdXRhdGlvbiB0eXBlc1xuXHRcdHRoaXMuZW5hYmxlZCA9IHRydWU7XG5cblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwibXV0YXRvclwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwibXV0YXRvclBhcmFtc1wiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwibXV0YXRvckRhdGFcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcIm11dGF0b3JEYXRhUGFyYW1zXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJtdXRhdG9yRWRpdFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwibXV0YXRvckVkaXRQYXJhbXNcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcIm11dGF0b3JDbGlwYm9hcmRcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcIm11dGF0b3JDbGlwYm9hcmRQYXJhbXNcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcIm11dGF0b3JJbXBvcnRcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcIm11dGF0b3JJbXBvcnRQYXJhbXNcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcIm11dGF0ZUxpbmtcIik7XG5cdH1cblxuXHRpbml0aWFsaXplKCl7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLXZhbHVlLWNoYW5naW5nXCIsIHRoaXMudHJhbnNmb3JtQ2VsbC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtdmFsdWUtY2hhbmdlZFwiLCB0aGlzLm11dGF0ZUxpbmsuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tbGF5b3V0XCIsIHRoaXMuaW5pdGlhbGl6ZUNvbHVtbi5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1kYXRhLWluaXQtYmVmb3JlXCIsIHRoaXMucm93RGF0YUNoYW5nZWQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctZGF0YS1jaGFuZ2luZ1wiLCB0aGlzLnJvd0RhdGFDaGFuZ2VkLmJpbmQodGhpcykpO1xuXHR9XG5cblx0cm93RGF0YUNoYW5nZWQocm93LCB0ZW1wRGF0YSwgdXBkYXRlZERhdGEpe1xuXHRcdHJldHVybiB0aGlzLnRyYW5zZm9ybVJvdyh0ZW1wRGF0YSwgXCJkYXRhXCIsIHVwZGF0ZWREYXRhKTtcblx0fVxuXG5cdC8vaW5pdGlhbGl6ZSBjb2x1bW4gbXV0YXRvclxuXHRpbml0aWFsaXplQ29sdW1uKGNvbHVtbil7XG5cdFx0dmFyIG1hdGNoID0gZmFsc2UsXG5cdFx0Y29uZmlnID0ge307XG5cblx0XHR0aGlzLmFsbG93ZWRUeXBlcy5mb3JFYWNoKCh0eXBlKSA9PiB7XG5cdFx0XHR2YXIga2V5ID0gXCJtdXRhdG9yXCIgKyAodHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR5cGUuc2xpY2UoMSkpLFxuXHRcdFx0bXV0YXRvcjtcblxuXHRcdFx0aWYoY29sdW1uLmRlZmluaXRpb25ba2V5XSl7XG5cdFx0XHRcdG11dGF0b3IgPSB0aGlzLmxvb2t1cE11dGF0b3IoY29sdW1uLmRlZmluaXRpb25ba2V5XSk7XG5cblx0XHRcdFx0aWYobXV0YXRvcil7XG5cdFx0XHRcdFx0bWF0Y2ggPSB0cnVlO1xuXG5cdFx0XHRcdFx0Y29uZmlnW2tleV0gPSB7XG5cdFx0XHRcdFx0XHRtdXRhdG9yOm11dGF0b3IsXG5cdFx0XHRcdFx0XHRwYXJhbXM6IGNvbHVtbi5kZWZpbml0aW9uW2tleSArIFwiUGFyYW1zXCJdIHx8IHt9LFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmKG1hdGNoKXtcblx0XHRcdGNvbHVtbi5tb2R1bGVzLm11dGF0ZSA9IGNvbmZpZztcblx0XHR9XG5cdH1cblxuXHRsb29rdXBNdXRhdG9yKHZhbHVlKXtcblx0XHR2YXIgbXV0YXRvciA9IGZhbHNlO1xuXG5cdFx0Ly9zZXQgY29sdW1uIG11dGF0b3Jcblx0XHRzd2l0Y2godHlwZW9mIHZhbHVlKXtcblx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0aWYoTXV0YXRvci5tdXRhdG9yc1t2YWx1ZV0pe1xuXHRcdFx0XHRcdG11dGF0b3IgPSBNdXRhdG9yLm11dGF0b3JzW3ZhbHVlXTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIk11dGF0b3IgRXJyb3IgLSBObyBzdWNoIG11dGF0b3IgZm91bmQsIGlnbm9yaW5nOiBcIiwgdmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0bXV0YXRvciA9IHZhbHVlO1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cblx0XHRyZXR1cm4gbXV0YXRvcjtcblx0fVxuXG5cdC8vYXBwbHkgbXV0YXRvciB0byByb3dcblx0dHJhbnNmb3JtUm93KGRhdGEsIHR5cGUsIHVwZGF0ZWREYXRhKXtcblx0XHR2YXIga2V5ID0gXCJtdXRhdG9yXCIgKyAodHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR5cGUuc2xpY2UoMSkpLFxuXHRcdHZhbHVlO1xuXG5cdFx0Ly8gY29uc29sZS5sb2coXCJrZXlcIiwga2V5KVxuXG5cdFx0aWYodGhpcy5lbmFibGVkKXtcblxuXHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLnRyYXZlcnNlKChjb2x1bW4pID0+IHtcblx0XHRcdFx0dmFyIG11dGF0b3IsIHBhcmFtcywgY29tcG9uZW50O1xuXG5cdFx0XHRcdGlmKGNvbHVtbi5tb2R1bGVzLm11dGF0ZSl7XG5cdFx0XHRcdFx0bXV0YXRvciA9IGNvbHVtbi5tb2R1bGVzLm11dGF0ZVtrZXldIHx8IGNvbHVtbi5tb2R1bGVzLm11dGF0ZS5tdXRhdG9yIHx8IGZhbHNlO1xuXG5cdFx0XHRcdFx0aWYobXV0YXRvcil7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKHR5cGVvZiB1cGRhdGVkRGF0YSAhPT0gXCJ1bmRlZmluZWRcIiA/IHVwZGF0ZWREYXRhIDogZGF0YSk7XG5cblx0XHRcdFx0XHRcdGlmKCh0eXBlID09IFwiZGF0YVwiICYmICF1cGRhdGVkRGF0YSl8fCB0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0XHRcdFx0XHRjb21wb25lbnQgPSBjb2x1bW4uZ2V0Q29tcG9uZW50KCk7XG5cdFx0XHRcdFx0XHRcdHBhcmFtcyA9IHR5cGVvZiBtdXRhdG9yLnBhcmFtcyA9PT0gXCJmdW5jdGlvblwiID8gbXV0YXRvci5wYXJhbXModmFsdWUsIGRhdGEsIHR5cGUsIGNvbXBvbmVudCkgOiBtdXRhdG9yLnBhcmFtcztcblx0XHRcdFx0XHRcdFx0Y29sdW1uLnNldEZpZWxkVmFsdWUoZGF0YSwgbXV0YXRvci5tdXRhdG9yKHZhbHVlLCBkYXRhLCB0eXBlLCBwYXJhbXMsIGNvbXBvbmVudCkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH1cblxuXHQvL2FwcGx5IG11dGF0b3IgdG8gbmV3IGNlbGwgdmFsdWVcblx0dHJhbnNmb3JtQ2VsbChjZWxsLCB2YWx1ZSl7XG5cdFx0aWYoY2VsbC5jb2x1bW4ubW9kdWxlcy5tdXRhdGUpe1xuXHRcdFx0dmFyIG11dGF0b3IgPSBjZWxsLmNvbHVtbi5tb2R1bGVzLm11dGF0ZS5tdXRhdG9yRWRpdCB8fCBjZWxsLmNvbHVtbi5tb2R1bGVzLm11dGF0ZS5tdXRhdG9yIHx8IGZhbHNlLFxuXHRcdFx0dGVtcERhdGEgPSB7fTtcblxuXHRcdFx0aWYobXV0YXRvcil7XG5cdFx0XHRcdHRlbXBEYXRhID0gT2JqZWN0LmFzc2lnbih0ZW1wRGF0YSwgY2VsbC5yb3cuZ2V0RGF0YSgpKTtcblx0XHRcdFx0Y2VsbC5jb2x1bW4uc2V0RmllbGRWYWx1ZSh0ZW1wRGF0YSwgdmFsdWUpO1xuXHRcdFx0XHRyZXR1cm4gbXV0YXRvci5tdXRhdG9yKHZhbHVlLCB0ZW1wRGF0YSwgXCJlZGl0XCIsIG11dGF0b3IucGFyYW1zLCBjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdmFsdWU7XG5cdH1cblxuXHRtdXRhdGVMaW5rKGNlbGwpe1xuXHRcdHZhciBsaW5rcyA9IGNlbGwuY29sdW1uLmRlZmluaXRpb24ubXV0YXRlTGluaztcblxuXHRcdGlmKGxpbmtzKXtcblx0XHRcdGlmKCFBcnJheS5pc0FycmF5KGxpbmtzKSl7XG5cdFx0XHRcdGxpbmtzID0gW2xpbmtzXTtcblx0XHRcdH1cblxuXHRcdFx0bGlua3MuZm9yRWFjaCgobGluaykgPT4ge1xuXHRcdFx0XHR2YXIgbGlua0NlbGwgPSBjZWxsLnJvdy5nZXRDZWxsKGxpbmspO1xuXG5cdFx0XHRcdGlmKGxpbmtDZWxsKXtcblx0XHRcdFx0XHRsaW5rQ2VsbC5zZXRWYWx1ZShsaW5rQ2VsbC5nZXRWYWx1ZSgpLCB0cnVlLCB0cnVlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0ZW5hYmxlKCl7XG5cdFx0dGhpcy5lbmFibGVkID0gdHJ1ZTtcblx0fVxuXG5cdGRpc2FibGUoKXtcblx0XHR0aGlzLmVuYWJsZWQgPSBmYWxzZTtcblx0fVxufVxuXG5mdW5jdGlvbiByb3dzKHBhZ2VTaXplLCBjdXJyZW50Um93LCBjdXJyZW50UGFnZSwgdG90YWxSb3dzLCB0b3RhbFBhZ2VzKXtcblx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIiksXG5cdHNob3dpbmdFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpLFxuXHR2YWx1ZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIiksXG5cdG9mRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKSxcblx0dG90YWxFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpLFxuXHRyb3dzRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcblxuXHR0aGlzLnRhYmxlLm1vZHVsZXMubG9jYWxpemUubGFuZ0JpbmQoXCJwYWdpbmF0aW9ufGNvdW50ZXJ8c2hvd2luZ1wiLCAodmFsdWUpID0+IHtcblx0XHRzaG93aW5nRWwuaW5uZXJIVE1MID0gdmFsdWU7XG5cdH0pO1xuXG5cdHRoaXMudGFibGUubW9kdWxlcy5sb2NhbGl6ZS5sYW5nQmluZChcInBhZ2luYXRpb258Y291bnRlcnxvZlwiLCAodmFsdWUpID0+IHtcblx0XHRvZkVsLmlubmVySFRNTCA9IHZhbHVlO1xuXHR9KTtcblxuXHR0aGlzLnRhYmxlLm1vZHVsZXMubG9jYWxpemUubGFuZ0JpbmQoXCJwYWdpbmF0aW9ufGNvdW50ZXJ8cm93c1wiLCAodmFsdWUpID0+IHtcblx0XHRyb3dzRWwuaW5uZXJIVE1MID0gdmFsdWU7XG5cdH0pO1xuXG5cdGlmKHRvdGFsUm93cyl7XG5cdFx0dmFsdWVFbC5pbm5lckhUTUwgPSBcIiBcIiArIGN1cnJlbnRSb3cgKyBcIi1cIiArIE1hdGgubWluKChjdXJyZW50Um93ICsgcGFnZVNpemUgLSAxKSwgdG90YWxSb3dzKSArIFwiIFwiO1xuXHRcdFxuXHRcdHRvdGFsRWwuaW5uZXJIVE1MID0gXCIgXCIgKyB0b3RhbFJvd3MgKyBcIiBcIjtcblx0XHRcblx0XHRlbC5hcHBlbmRDaGlsZChzaG93aW5nRWwpO1xuXHRcdGVsLmFwcGVuZENoaWxkKHZhbHVlRWwpO1xuXHRcdGVsLmFwcGVuZENoaWxkKG9mRWwpO1xuXHRcdGVsLmFwcGVuZENoaWxkKHRvdGFsRWwpO1xuXHRcdGVsLmFwcGVuZENoaWxkKHJvd3NFbCk7XG5cdH1lbHNlIHtcblx0XHR2YWx1ZUVsLmlubmVySFRNTCA9IFwiIDAgXCI7XG5cblx0XHRlbC5hcHBlbmRDaGlsZChzaG93aW5nRWwpO1xuXHRcdGVsLmFwcGVuZENoaWxkKHZhbHVlRWwpO1xuXHRcdGVsLmFwcGVuZENoaWxkKHJvd3NFbCk7XG5cdH1cblx0XG5cdHJldHVybiBlbDtcbn1cblxuZnVuY3Rpb24gcGFnZXMocGFnZVNpemUsIGN1cnJlbnRSb3csIGN1cnJlbnRQYWdlLCB0b3RhbFJvd3MsIHRvdGFsUGFnZXMpe1xuXG5cdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpLFxuXHRzaG93aW5nRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKSxcblx0dmFsdWVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpLFxuXHRvZkVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIiksXG5cdHRvdGFsRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKSxcblx0cm93c0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG5cdFxuXHR0aGlzLnRhYmxlLm1vZHVsZXMubG9jYWxpemUubGFuZ0JpbmQoXCJwYWdpbmF0aW9ufGNvdW50ZXJ8c2hvd2luZ1wiLCAodmFsdWUpID0+IHtcblx0XHRzaG93aW5nRWwuaW5uZXJIVE1MID0gdmFsdWU7XG5cdH0pO1xuXHRcblx0dmFsdWVFbC5pbm5lckhUTUwgPSBcIiBcIiArIGN1cnJlbnRQYWdlICsgXCIgXCI7XG5cdFxuXHR0aGlzLnRhYmxlLm1vZHVsZXMubG9jYWxpemUubGFuZ0JpbmQoXCJwYWdpbmF0aW9ufGNvdW50ZXJ8b2ZcIiwgKHZhbHVlKSA9PiB7XG5cdFx0b2ZFbC5pbm5lckhUTUwgPSB2YWx1ZTtcblx0fSk7XG5cdFxuXHR0b3RhbEVsLmlubmVySFRNTCA9IFwiIFwiICsgdG90YWxQYWdlcyArIFwiIFwiO1xuXHRcblx0dGhpcy50YWJsZS5tb2R1bGVzLmxvY2FsaXplLmxhbmdCaW5kKFwicGFnaW5hdGlvbnxjb3VudGVyfHBhZ2VzXCIsICh2YWx1ZSkgPT4ge1xuXHRcdHJvd3NFbC5pbm5lckhUTUwgPSB2YWx1ZTtcblx0fSk7XG5cdFxuXHRlbC5hcHBlbmRDaGlsZChzaG93aW5nRWwpO1xuXHRlbC5hcHBlbmRDaGlsZCh2YWx1ZUVsKTtcblx0ZWwuYXBwZW5kQ2hpbGQob2ZFbCk7XG5cdGVsLmFwcGVuZENoaWxkKHRvdGFsRWwpO1xuXHRlbC5hcHBlbmRDaGlsZChyb3dzRWwpO1xuXHRcblx0cmV0dXJuIGVsO1xufVxuXG52YXIgZGVmYXVsdFBhZ2VDb3VudGVycyA9IHtcblx0cm93czpyb3dzLFxuXHRwYWdlczpwYWdlcyxcbn07XG5cbmNsYXNzIFBhZ2UgZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcInBhZ2VcIjtcblxuXHQvL2xvYWQgZGVmYXVsdHNcblx0c3RhdGljIHBhZ2VDb3VudGVycyA9IGRlZmF1bHRQYWdlQ291bnRlcnM7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMubW9kZSA9IFwibG9jYWxcIjtcblx0XHR0aGlzLnByb2dyZXNzaXZlTG9hZCA9IGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMuZWxlbWVudCA9IG51bGw7XG5cdFx0dGhpcy5wYWdlQ291bnRlckVsZW1lbnQgPSBudWxsO1xuXHRcdHRoaXMucGFnZUNvdW50ZXIgPSBudWxsO1xuXHRcdFxuXHRcdHRoaXMuc2l6ZSA9IDA7XG5cdFx0dGhpcy5wYWdlID0gMTtcblx0XHR0aGlzLmNvdW50ID0gNTtcblx0XHR0aGlzLm1heCA9IDE7XG5cblx0XHR0aGlzLnJlbW90ZVJvd0NvdW50RXN0aW1hdGUgPSBudWxsO1xuXHRcdFxuXHRcdHRoaXMuaW5pdGlhbExvYWQgPSB0cnVlO1xuXHRcdHRoaXMuZGF0YUNoYW5naW5nID0gZmFsc2U7IC8vZmxhZyB0byBjaGVjayBpZiBkYXRhIGlzIGJlaW5nIGNoYW5nZWQgYnkgdGhpcyBtb2R1bGVcblx0XHRcblx0XHR0aGlzLnBhZ2VTaXplcyA9IFtdO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInBhZ2luYXRpb25cIiwgZmFsc2UpOyAvL3NldCBwYWdpbmF0aW9uIHR5cGVcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwYWdpbmF0aW9uTW9kZVwiLCBcImxvY2FsXCIpOyAvL2xvY2FsIG9yIHJlbW90ZSBwYWdpbmF0aW9uXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicGFnaW5hdGlvblNpemVcIiwgZmFsc2UpOyAvL3NldCBudW1iZXIgb2Ygcm93cyB0byBhIHBhZ2Vcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwYWdpbmF0aW9uSW5pdGlhbFBhZ2VcIiwgMSk7IC8vaW5pdGlhbCBwYWdlIHRvIHNob3cgb24gbG9hZFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInBhZ2luYXRpb25Db3VudGVyXCIsIGZhbHNlKTsgIC8vIHNldCBwYWdpbmF0aW9uIGNvdW50ZXJcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwYWdpbmF0aW9uQ291bnRlckVsZW1lbnRcIiwgZmFsc2UpOyAgLy8gc2V0IHBhZ2luYXRpb24gY291bnRlclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInBhZ2luYXRpb25CdXR0b25Db3VudFwiLCA1KTsgIC8vIHNldCBjb3VudCBvZiBwYWdlIGJ1dHRvblxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInBhZ2luYXRpb25TaXplU2VsZWN0b3JcIiwgZmFsc2UpOyAvL2FkZCBwYWdpbmF0aW9uIHNpemUgc2VsZWN0b3IgZWxlbWVudFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInBhZ2luYXRpb25FbGVtZW50XCIsIGZhbHNlKTsgLy9lbGVtZW50IHRvIGhvbGQgcGFnaW5hdGlvbiBudW1iZXJzXG5cdFx0Ly8gdGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicGFnaW5hdGlvbkRhdGFTZW50XCIsIHt9KTsgLy9wYWdpbmF0aW9uIGRhdGEgc2VudCB0byB0aGUgc2VydmVyXG5cdFx0Ly8gdGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicGFnaW5hdGlvbkRhdGFSZWNlaXZlZFwiLCB7fSk7IC8vcGFnaW5hdGlvbiBkYXRhIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInBhZ2luYXRpb25BZGRSb3dcIiwgXCJwYWdlXCIpOyAvL2FkZCByb3dzIG9uIHRhYmxlIG9yIHBhZ2Vcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwYWdpbmF0aW9uT3V0T2ZSYW5nZVwiLCBmYWxzZSk7IC8vcmVzZXQgdGhlIGN1cnJlbnQgcGFnZSB3aGVuIHRoZSBsYXN0IHBhZ2UgPCB0aGlzLnBhZ2UsIHZhbHVlczogZmFsc2V8ZnVuY3Rpb258YW55IHZhbHVlIGFjY2VwdGVkIGJ5IHNldFBhZ2UoKVxuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInByb2dyZXNzaXZlTG9hZFwiLCBmYWxzZSk7IC8vcHJvZ3Jlc3NpdmUgbG9hZGluZ1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInByb2dyZXNzaXZlTG9hZERlbGF5XCIsIDApOyAvL2RlbGF5IGJldHdlZW4gcmVxdWVzdHNcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwcm9ncmVzc2l2ZUxvYWRTY3JvbGxNYXJnaW5cIiwgMCk7IC8vbWFyZ2luIGJlZm9yZSBzY3JvbGwgYmVnaW5zXG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJzZXRNYXhQYWdlXCIsIHRoaXMuc2V0TWF4UGFnZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInNldFBhZ2VcIiwgdGhpcy5zZXRQYWdlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwic2V0UGFnZVRvUm93XCIsIHRoaXMudXNlclNldFBhZ2VUb1Jvdy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInNldFBhZ2VTaXplXCIsIHRoaXMudXNlclNldFBhZ2VTaXplLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiZ2V0UGFnZVNpemVcIiwgdGhpcy5nZXRQYWdlU2l6ZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInByZXZpb3VzUGFnZVwiLCB0aGlzLnByZXZpb3VzUGFnZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcIm5leHRQYWdlXCIsIHRoaXMubmV4dFBhZ2UuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRQYWdlXCIsIHRoaXMuZ2V0UGFnZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldFBhZ2VNYXhcIiwgdGhpcy5nZXRQYWdlTWF4LmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdC8vcmVnaXN0ZXIgY29tcG9uZW50IGZ1bmN0aW9uc1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcInJvd1wiLCBcInBhZ2VUb1wiLCB0aGlzLnNldFBhZ2VUb1Jvdy5iaW5kKHRoaXMpKTtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uKXtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWRlbGV0ZWRcIiwgdGhpcy5yb3dzVXBkYXRlZC5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWFkZGVkXCIsIHRoaXMucm93c1VwZGF0ZWQuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImRhdGEtcHJvY2Vzc2VkXCIsIHRoaXMuaW5pdGlhbExvYWRDb21wbGV0ZS5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtYnVpbHRcIiwgdGhpcy5jYWxjdWxhdGVQYWdlU2l6ZXMuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImZvb3Rlci1yZWRyYXdcIiwgdGhpcy5mb290ZXJSZWRyYXcuYmluZCh0aGlzKSk7XG5cblx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uQWRkUm93ID09IFwicGFnZVwiKXtcblx0XHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctYWRkaW5nLXBvc2l0aW9uXCIsIHRoaXMucm93QWRkaW5nUG9zaXRpb24uYmluZCh0aGlzKSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uTW9kZSA9PT0gXCJyZW1vdGVcIil7XG5cdFx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiZGF0YS1wYXJhbXNcIiwgdGhpcy5yZW1vdGVQYWdlUGFyYW1zLmJpbmQodGhpcykpO1xuXHRcdFx0XHR0aGlzLnN1YnNjcmliZShcImRhdGEtbG9hZGVkXCIsIHRoaXMuX3BhcnNlUmVtb3RlRGF0YS5iaW5kKHRoaXMpKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnByb2dyZXNzaXZlTG9hZCl7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJQcm9ncmVzc2l2ZSBMb2FkIEVycm9yIC0gUGFnaW5hdGlvbiBhbmQgcHJvZ3Jlc3NpdmUgbG9hZCBjYW5ub3QgYmUgdXNlZCBhdCB0aGUgc2FtZSB0aW1lXCIpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnJlZ2lzdGVyRGlzcGxheUhhbmRsZXIodGhpcy5yZXN0T25SZW5kZXJCZWZvcmUuYmluZCh0aGlzKSwgNDApO1xuXHRcdFx0dGhpcy5yZWdpc3RlckRpc3BsYXlIYW5kbGVyKHRoaXMuZ2V0Um93cy5iaW5kKHRoaXMpLCA1MCk7XG5cdFx0XHRcblx0XHRcdHRoaXMuY3JlYXRlRWxlbWVudHMoKTtcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZVBhZ2VDb3VudGVyKCk7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVQYWdpbmF0b3IoKTtcblx0XHR9ZWxzZSBpZih0aGlzLnRhYmxlLm9wdGlvbnMucHJvZ3Jlc3NpdmVMb2FkKXtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiZGF0YS1wYXJhbXNcIiwgdGhpcy5yZW1vdGVQYWdlUGFyYW1zLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLWxvYWRlZFwiLCB0aGlzLl9wYXJzZVJlbW90ZURhdGEuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLWJ1aWx0XCIsIHRoaXMuY2FsY3VsYXRlUGFnZVNpemVzLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLXByb2Nlc3NlZFwiLCB0aGlzLmluaXRpYWxMb2FkQ29tcGxldGUuYmluZCh0aGlzKSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZVByb2dyZXNzaXZlKHRoaXMudGFibGUub3B0aW9ucy5wcm9ncmVzc2l2ZUxvYWQpO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucHJvZ3Jlc3NpdmVMb2FkID09PSBcInNjcm9sbFwiKXtcblx0XHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJzY3JvbGwtdmVydGljYWxcIiwgdGhpcy5zY3JvbGxWZXJ0aWNhbC5iaW5kKHRoaXMpKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdHJvd0FkZGluZ1Bvc2l0aW9uKHJvdywgdG9wKXtcblx0XHR2YXIgcm93TWFuYWdlciA9IHRoaXMudGFibGUucm93TWFuYWdlcixcblx0XHRkaXNwbGF5Um93cyA9IHJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKSxcblx0XHRpbmRleDtcblx0XHRcblx0XHRpZih0b3Ape1xuXHRcdFx0aWYoZGlzcGxheVJvd3MubGVuZ3RoKXtcblx0XHRcdFx0aW5kZXggPSBkaXNwbGF5Um93c1swXTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYocm93TWFuYWdlci5hY3RpdmVSb3dzLmxlbmd0aCl7XG5cdFx0XHRcdFx0aW5kZXggPSByb3dNYW5hZ2VyLmFjdGl2ZVJvd3Nbcm93TWFuYWdlci5hY3RpdmVSb3dzLmxlbmd0aC0xXTtcblx0XHRcdFx0XHR0b3AgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGlmKGRpc3BsYXlSb3dzLmxlbmd0aCl7XG5cdFx0XHRcdGluZGV4ID0gZGlzcGxheVJvd3NbZGlzcGxheVJvd3MubGVuZ3RoIC0gMV07XG5cdFx0XHRcdHRvcCA9IGRpc3BsYXlSb3dzLmxlbmd0aCA8IHRoaXMuc2l6ZSA/IGZhbHNlIDogdHJ1ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHtpbmRleCwgdG9wfTtcblx0fVxuXHRcblx0Y2FsY3VsYXRlUGFnZVNpemVzKCl7XG5cdFx0dmFyIHRlc3RFbFJvdywgdGVzdEVsQ2VsbDtcblx0XHRcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvblNpemUpe1xuXHRcdFx0dGhpcy5zaXplID0gdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25TaXplO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRlc3RFbFJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHR0ZXN0RWxSb3cuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3dcIik7XG5cdFx0XHR0ZXN0RWxSb3cuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG5cdFx0XHRcblx0XHRcdHRlc3RFbENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0dGVzdEVsQ2VsbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNlbGxcIik7XG5cdFx0XHR0ZXN0RWxDZWxsLmlubmVySFRNTCA9IFwiUGFnZSBSb3cgVGVzdFwiO1xuXHRcdFx0XG5cdFx0XHR0ZXN0RWxSb3cuYXBwZW5kQ2hpbGQodGVzdEVsQ2VsbCk7XG5cdFx0XHRcblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5nZXRUYWJsZUVsZW1lbnQoKS5hcHBlbmRDaGlsZCh0ZXN0RWxSb3cpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnNpemUgPSBNYXRoLmZsb29yKHRoaXMudGFibGUucm93TWFuYWdlci5nZXRFbGVtZW50KCkuY2xpZW50SGVpZ2h0IC8gdGVzdEVsUm93Lm9mZnNldEhlaWdodCk7XG5cdFx0XHRcblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5nZXRUYWJsZUVsZW1lbnQoKS5yZW1vdmVDaGlsZCh0ZXN0RWxSb3cpO1xuXHRcdH1cblxuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInBhZ2VTaXplQ2hhbmdlZFwiLCB0aGlzLnNpemUpO1xuXHRcdFxuXHRcdHRoaXMuZ2VuZXJhdGVQYWdlU2l6ZVNlbGVjdExpc3QoKTtcblx0fVxuXHRcblx0aW5pdGlhbExvYWRDb21wbGV0ZSgpe1xuXHRcdHRoaXMuaW5pdGlhbExvYWQgPSBmYWxzZTtcblx0fVxuXHRcblx0cmVtb3RlUGFnZVBhcmFtcyhkYXRhLCBjb25maWcsIHNpbGVudCwgcGFyYW1zKXtcblx0XHRpZighdGhpcy5pbml0aWFsTG9hZCl7XG5cdFx0XHRpZigodGhpcy5wcm9ncmVzc2l2ZUxvYWQgJiYgIXNpbGVudCkgfHwgKCF0aGlzLnByb2dyZXNzaXZlTG9hZCAmJiAhdGhpcy5kYXRhQ2hhbmdpbmcpKXtcblx0XHRcdFx0dGhpcy5yZXNldCh0cnVlKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0Ly9jb25maWd1cmUgcmVxdWVzdCBwYXJhbXNcblx0XHRwYXJhbXMucGFnZSA9IHRoaXMucGFnZTtcblx0XHRcblx0XHQvL3NldCBwYWdlIHNpemUgaWYgZGVmaW5lZFxuXHRcdGlmKHRoaXMuc2l6ZSl7XG5cdFx0XHRwYXJhbXMuc2l6ZSA9IHRoaXMuc2l6ZTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHBhcmFtcztcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIFRhYmxlIEZ1bmN0aW9ucyAvLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdHVzZXJTZXRQYWdlVG9Sb3cocm93KXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbil7XG5cdFx0XHRyb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyhyb3cpO1xuXHRcdFx0XG5cdFx0XHRpZihyb3cpe1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5zZXRQYWdlVG9Sb3cocm93KTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG5cdH1cblx0XG5cdHVzZXJTZXRQYWdlU2l6ZShzaXplKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbil7XG5cdFx0XHR0aGlzLnNldFBhZ2VTaXplKHNpemUpO1xuXHRcdFx0cmV0dXJuIHRoaXMuc2V0UGFnZSgxKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBJbnRlcm5hbCBMb2dpYyAvLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRzY3JvbGxWZXJ0aWNhbCh0b3AsIGRpcil7XG5cdFx0dmFyIGVsZW1lbnQsIGRpZmYsIG1hcmdpbjtcblx0XHRpZighZGlyICYmICF0aGlzLnRhYmxlLmRhdGFMb2FkZXIubG9hZGluZyl7XG5cdFx0XHRlbGVtZW50ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldEVsZW1lbnQoKTtcblx0XHRcdGRpZmYgPSBlbGVtZW50LnNjcm9sbEhlaWdodCAtIGVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdG9wO1xuXHRcdFx0bWFyZ2luID0gdGhpcy50YWJsZS5vcHRpb25zLnByb2dyZXNzaXZlTG9hZFNjcm9sbE1hcmdpbiB8fCAoZWxlbWVudC5jbGllbnRIZWlnaHQgKiAyKTtcblx0XHRcdFxuXHRcdFx0aWYoZGlmZiA8IG1hcmdpbil7XG5cdFx0XHRcdHRoaXMubmV4dFBhZ2UoKVxuXHRcdFx0XHRcdC5jYXRjaCgoKSA9PiB7fSk7IC8vY29uc3VtZSB0aGUgZXhjZXB0aW9uIHRocm93biB3aGVuIG9uIHRoZSBsYXN0IHBhZ2Vcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdHJlc3RPblJlbmRlckJlZm9yZShyb3dzLCByZW5kZXJJblBvc2l0aW9uKXtcblx0XHRpZighcmVuZGVySW5Qb3NpdGlvbil7XG5cdFx0XHRpZih0aGlzLm1vZGUgPT09IFwibG9jYWxcIil7XG5cdFx0XHRcdHRoaXMucmVzZXQoKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHJvd3M7XG5cdH1cblx0XG5cdHJvd3NVcGRhdGVkKCl7XG5cdFx0dGhpcy5yZWZyZXNoRGF0YSh0cnVlLCBcImFsbFwiKTtcblx0fVxuXHRcblx0Y3JlYXRlRWxlbWVudHMoKXtcblx0XHR2YXIgYnV0dG9uO1xuXHRcdFxuXHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXBhZ2luYXRvclwiKTtcblx0XHRcblx0XHR0aGlzLnBhZ2VzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXHRcdHRoaXMucGFnZXNFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcGFnZXNcIik7XG5cdFx0XG5cdFx0YnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcblx0XHRidXR0b24uY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wYWdlXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYnV0dG9uXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBcIlwiKTtcblx0XHRcblx0XHR0aGlzLmZpcnN0QnV0ID0gYnV0dG9uLmNsb25lTm9kZSh0cnVlKTtcblx0XHR0aGlzLmZpcnN0QnV0LnNldEF0dHJpYnV0ZShcImRhdGEtcGFnZVwiLCBcImZpcnN0XCIpO1xuXHRcdFxuXHRcdHRoaXMucHJldkJ1dCA9IGJ1dHRvbi5jbG9uZU5vZGUodHJ1ZSk7XG5cdFx0dGhpcy5wcmV2QnV0LnNldEF0dHJpYnV0ZShcImRhdGEtcGFnZVwiLCBcInByZXZcIik7XG5cdFx0XG5cdFx0dGhpcy5uZXh0QnV0ID0gYnV0dG9uLmNsb25lTm9kZSh0cnVlKTtcblx0XHR0aGlzLm5leHRCdXQuc2V0QXR0cmlidXRlKFwiZGF0YS1wYWdlXCIsIFwibmV4dFwiKTtcblx0XHRcblx0XHR0aGlzLmxhc3RCdXQgPSBidXR0b24uY2xvbmVOb2RlKHRydWUpO1xuXHRcdHRoaXMubGFzdEJ1dC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXBhZ2VcIiwgXCJsYXN0XCIpO1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uU2l6ZVNlbGVjdG9yKXtcblx0XHRcdHRoaXMucGFnZVNpemVTZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xuXHRcdFx0dGhpcy5wYWdlU2l6ZVNlbGVjdC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXBhZ2Utc2l6ZVwiKTtcblx0XHR9XG5cdH1cblx0XG5cdGdlbmVyYXRlUGFnZVNpemVTZWxlY3RMaXN0KCl7XG5cdFx0dmFyIHBhZ2VTaXplcyA9IFtdO1xuXHRcdFxuXHRcdGlmKHRoaXMucGFnZVNpemVTZWxlY3Qpe1xuXHRcdFx0XG5cdFx0XHRpZihBcnJheS5pc0FycmF5KHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uU2l6ZVNlbGVjdG9yKSl7XG5cdFx0XHRcdHBhZ2VTaXplcyA9IHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uU2l6ZVNlbGVjdG9yO1xuXHRcdFx0XHR0aGlzLnBhZ2VTaXplcyA9IHBhZ2VTaXplcztcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMucGFnZVNpemVzLmluZGV4T2YodGhpcy5zaXplKSA9PSAtMSl7XG5cdFx0XHRcdFx0cGFnZVNpemVzLnVuc2hpZnQodGhpcy5zaXplKTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcblx0XHRcdFx0aWYodGhpcy5wYWdlU2l6ZXMuaW5kZXhPZih0aGlzLnNpemUpID09IC0xKXtcblx0XHRcdFx0XHRwYWdlU2l6ZXMgPSBbXTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRmb3IgKGxldCBpID0gMTsgaSA8IDU7IGkrKyl7XG5cdFx0XHRcdFx0XHRwYWdlU2l6ZXMucHVzaCh0aGlzLnNpemUgKiBpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0dGhpcy5wYWdlU2l6ZXMgPSBwYWdlU2l6ZXM7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRwYWdlU2l6ZXMgPSB0aGlzLnBhZ2VTaXplcztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR3aGlsZSh0aGlzLnBhZ2VTaXplU2VsZWN0LmZpcnN0Q2hpbGQpIHRoaXMucGFnZVNpemVTZWxlY3QucmVtb3ZlQ2hpbGQodGhpcy5wYWdlU2l6ZVNlbGVjdC5maXJzdENoaWxkKTtcblx0XHRcdFxuXHRcdFx0cGFnZVNpemVzLmZvckVhY2goKGl0ZW0pID0+IHtcblx0XHRcdFx0dmFyIGl0ZW1FbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XG5cdFx0XHRcdGl0ZW1FbC52YWx1ZSA9IGl0ZW07XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihpdGVtID09PSB0cnVlKXtcblx0XHRcdFx0XHR0aGlzLmxhbmdCaW5kKFwicGFnaW5hdGlvbnxhbGxcIiwgZnVuY3Rpb24odmFsdWUpe1xuXHRcdFx0XHRcdFx0aXRlbUVsLmlubmVySFRNTCA9IHZhbHVlO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0aXRlbUVsLmlubmVySFRNTCA9IGl0ZW07XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdFxuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5wYWdlU2l6ZVNlbGVjdC5hcHBlbmRDaGlsZChpdGVtRWwpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMucGFnZVNpemVTZWxlY3QudmFsdWUgPSB0aGlzLnNpemU7XG5cdFx0fVxuXHR9XG5cdFxuXHRpbml0aWFsaXplUGFnZUNvdW50ZXIoKXtcblx0XHR2YXIgY291bnRlciA9IHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uQ291bnRlcixcblx0XHRwYWdlQ291bnRlciA9IG51bGw7XG5cdFx0XG5cdFx0aWYoY291bnRlcil7XG5cdFx0XHRpZih0eXBlb2YgY291bnRlciA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0cGFnZUNvdW50ZXIgPSBjb3VudGVyO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRwYWdlQ291bnRlciA9IFBhZ2UucGFnZUNvdW50ZXJzW2NvdW50ZXJdO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihwYWdlQ291bnRlcil7XG5cdFx0XHRcdHRoaXMucGFnZUNvdW50ZXIgPSBwYWdlQ291bnRlcjtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMucGFnZUNvdW50ZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG5cdFx0XHRcdHRoaXMucGFnZUNvdW50ZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcGFnZS1jb3VudGVyXCIpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJQYWdpbmF0aW9uIEVycm9yIC0gTm8gc3VjaCBwYWdlIGNvdW50ZXIgZm91bmQ6IFwiLCBjb3VudGVyKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdC8vc2V0dXAgcGFnaW5hdGlvblxuXHRpbml0aWFsaXplUGFnaW5hdG9yKGhpZGRlbil7XG5cdFx0dmFyIHBhZ2VTZWxlY3RMYWJlbCwgcGFnaW5hdGlvbkNvdW50ZXJIb2xkZXI7XG5cdFx0XG5cdFx0aWYoIWhpZGRlbil7XG5cdFx0XHQvL2J1aWxkIHBhZ2luYXRpb24gZWxlbWVudFxuXHRcdFx0XG5cdFx0XHQvL2JpbmQgbG9jYWxpemF0aW9uc1xuXHRcdFx0dGhpcy5sYW5nQmluZChcInBhZ2luYXRpb258Zmlyc3RcIiwgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdHRoaXMuZmlyc3RCdXQuaW5uZXJIVE1MID0gdmFsdWU7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5sYW5nQmluZChcInBhZ2luYXRpb258Zmlyc3RfdGl0bGVcIiwgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdHRoaXMuZmlyc3RCdXQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSk7XG5cdFx0XHRcdHRoaXMuZmlyc3RCdXQuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgdmFsdWUpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMubGFuZ0JpbmQoXCJwYWdpbmF0aW9ufHByZXZcIiwgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdHRoaXMucHJldkJ1dC5pbm5lckhUTUwgPSB2YWx1ZTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmxhbmdCaW5kKFwicGFnaW5hdGlvbnxwcmV2X3RpdGxlXCIsICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHR0aGlzLnByZXZCdXQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSk7XG5cdFx0XHRcdHRoaXMucHJldkJ1dC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB2YWx1ZSk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5sYW5nQmluZChcInBhZ2luYXRpb258bmV4dFwiLCAodmFsdWUpID0+IHtcblx0XHRcdFx0dGhpcy5uZXh0QnV0LmlubmVySFRNTCA9IHZhbHVlO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMubGFuZ0JpbmQoXCJwYWdpbmF0aW9ufG5leHRfdGl0bGVcIiwgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdHRoaXMubmV4dEJ1dC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHZhbHVlKTtcblx0XHRcdFx0dGhpcy5uZXh0QnV0LnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIHZhbHVlKTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmxhbmdCaW5kKFwicGFnaW5hdGlvbnxsYXN0XCIsICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHR0aGlzLmxhc3RCdXQuaW5uZXJIVE1MID0gdmFsdWU7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5sYW5nQmluZChcInBhZ2luYXRpb258bGFzdF90aXRsZVwiLCAodmFsdWUpID0+IHtcblx0XHRcdFx0dGhpcy5sYXN0QnV0LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdmFsdWUpO1xuXHRcdFx0XHR0aGlzLmxhc3RCdXQuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgdmFsdWUpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdC8vY2xpY2sgYmluZGluZ3Ncblx0XHRcdHRoaXMuZmlyc3RCdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcblx0XHRcdFx0dGhpcy5zZXRQYWdlKDEpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMucHJldkJ1dC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuXHRcdFx0XHR0aGlzLnByZXZpb3VzUGFnZSgpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMubmV4dEJ1dC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuXHRcdFx0XHR0aGlzLm5leHRQYWdlKCk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5sYXN0QnV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG5cdFx0XHRcdHRoaXMuc2V0UGFnZSh0aGlzLm1heCk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25FbGVtZW50KXtcblx0XHRcdFx0dGhpcy5lbGVtZW50ID0gdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25FbGVtZW50O1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnBhZ2VTaXplU2VsZWN0KXtcblx0XHRcdFx0cGFnZVNlbGVjdExhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxhYmVsXCIpO1xuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5sYW5nQmluZChcInBhZ2luYXRpb258cGFnZV9zaXplXCIsICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGFnZVNpemVTZWxlY3Quc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSk7XG5cdFx0XHRcdFx0dGhpcy5wYWdlU2l6ZVNlbGVjdC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCB2YWx1ZSk7XG5cdFx0XHRcdFx0cGFnZVNlbGVjdExhYmVsLmlubmVySFRNTCA9IHZhbHVlO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChwYWdlU2VsZWN0TGFiZWwpO1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5wYWdlU2l6ZVNlbGVjdCk7XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLnBhZ2VTaXplU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGUpID0+IHtcblx0XHRcdFx0XHR0aGlzLnNldFBhZ2VTaXplKHRoaXMucGFnZVNpemVTZWxlY3QudmFsdWUgPT0gXCJ0cnVlXCIgPyB0cnVlIDogdGhpcy5wYWdlU2l6ZVNlbGVjdC52YWx1ZSk7XG5cdFx0XHRcdFx0dGhpcy5zZXRQYWdlKDEpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Ly9hcHBlbmQgdG8gRE9NXG5cdFx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5maXJzdEJ1dCk7XG5cdFx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5wcmV2QnV0KTtcblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnBhZ2VzRWxlbWVudCk7XG5cdFx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5uZXh0QnV0KTtcblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmxhc3RCdXQpO1xuXHRcdFx0XG5cdFx0XHRpZighdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25FbGVtZW50KXtcblx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25Db3VudGVyKXtcblxuXHRcdFx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uQ291bnRlckVsZW1lbnQpe1xuXHRcdFx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25Db3VudGVyRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KXtcblx0XHRcdFx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25Db3VudGVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnBhZ2VDb3VudGVyRWxlbWVudCk7XG5cdFx0XHRcdFx0XHR9ZWxzZSBpZih0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25Db3VudGVyRWxlbWVudCA9PT0gXCJzdHJpbmdcIil7XG5cdFx0XHRcdFx0XHRcdHBhZ2luYXRpb25Db3VudGVySG9sZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbkNvdW50ZXJFbGVtZW50KTtcblx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdGlmKHBhZ2luYXRpb25Db3VudGVySG9sZGVyKXtcblx0XHRcdFx0XHRcdFx0XHRwYWdpbmF0aW9uQ291bnRlckhvbGRlci5hcHBlbmRDaGlsZCh0aGlzLnBhZ2VDb3VudGVyRWxlbWVudCk7XG5cdFx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJQYWdpbmF0aW9uIEVycm9yIC0gVW5hYmxlIHRvIGZpbmQgZWxlbWVudCBtYXRjaGluZyBwYWdpbmF0aW9uQ291bnRlckVsZW1lbnQgc2VsZWN0b3I6XCIsIHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uQ291bnRlckVsZW1lbnQpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0dGhpcy5mb290ZXJBcHBlbmQodGhpcy5wYWdlQ291bnRlckVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5mb290ZXJBcHBlbmQodGhpcy5lbGVtZW50KTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0dGhpcy5wYWdlID0gdGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25Jbml0aWFsUGFnZTtcblx0XHRcdHRoaXMuY291bnQgPSB0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbkJ1dHRvbkNvdW50O1xuXHRcdH1cblx0XHRcblx0XHQvL3NldCBkZWZhdWx0IHZhbHVlc1xuXHRcdHRoaXMubW9kZSA9IHRoaXMudGFibGUub3B0aW9ucy5wYWdpbmF0aW9uTW9kZTtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZVByb2dyZXNzaXZlKG1vZGUpe1xuXHRcdHRoaXMuaW5pdGlhbGl6ZVBhZ2luYXRvcih0cnVlKTtcblx0XHR0aGlzLm1vZGUgPSBcInByb2dyZXNzaXZlX1wiICsgbW9kZTtcblx0XHR0aGlzLnByb2dyZXNzaXZlTG9hZCA9IHRydWU7XG5cdH1cblx0XG5cdHRyYWNrQ2hhbmdlcygpe1xuXHRcdHRoaXMuZGlzcGF0Y2goXCJwYWdlLWNoYW5nZWRcIik7XG5cdH1cblx0XG5cdC8vY2FsY3VsYXRlIG1heGltdW0gcGFnZSBmcm9tIG51bWJlciBvZiByb3dzXG5cdHNldE1heFJvd3Mocm93Q291bnQpe1xuXHRcdGlmKCFyb3dDb3VudCl7XG5cdFx0XHR0aGlzLm1heCA9IDE7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5tYXggPSB0aGlzLnNpemUgPT09IHRydWUgPyAgMSA6IE1hdGguY2VpbChyb3dDb3VudC90aGlzLnNpemUpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLnBhZ2UgPiB0aGlzLm1heCl7XG5cdFx0XHR0aGlzLnBhZ2UgPSB0aGlzLm1heDtcblx0XHR9XG5cdH1cblx0XG5cdC8vcmVzZXQgdG8gZmlyc3QgcGFnZSB3aXRob3V0IHRyaWdnZXJpbmcgYWN0aW9uXG5cdHJlc2V0KGZvcmNlKXtcblx0XHRpZighdGhpcy5pbml0aWFsTG9hZCl7XG5cdFx0XHRpZih0aGlzLm1vZGUgPT0gXCJsb2NhbFwiIHx8IGZvcmNlKXtcblx0XHRcdFx0dGhpcy5wYWdlID0gMTtcblx0XHRcdFx0dGhpcy50cmFja0NoYW5nZXMoKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdC8vc2V0IHRoZSBtYXhpbXVtIHBhZ2Vcblx0c2V0TWF4UGFnZShtYXgpe1xuXHRcdFxuXHRcdG1heCA9IHBhcnNlSW50KG1heCk7XG5cdFx0XG5cdFx0dGhpcy5tYXggPSBtYXggfHwgMTtcblx0XHRcblx0XHRpZih0aGlzLnBhZ2UgPiB0aGlzLm1heCl7XG5cdFx0XHR0aGlzLnBhZ2UgPSB0aGlzLm1heDtcblx0XHRcdHRoaXMudHJpZ2dlcigpO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9zZXQgY3VycmVudCBwYWdlIG51bWJlclxuXHRzZXRQYWdlKHBhZ2Upe1xuXHRcdHN3aXRjaChwYWdlKXtcblx0XHRcdGNhc2UgXCJmaXJzdFwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5zZXRQYWdlKDEpO1xuXHRcblx0XHRcdGNhc2UgXCJwcmV2XCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLnByZXZpb3VzUGFnZSgpO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwibmV4dFwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5uZXh0UGFnZSgpO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwibGFzdFwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5zZXRQYWdlKHRoaXMubWF4KTtcblx0XHR9XG5cdFx0XG5cdFx0cGFnZSA9IHBhcnNlSW50KHBhZ2UpO1xuXHRcdFxuXHRcdGlmKChwYWdlID4gMCAmJiBwYWdlIDw9IHRoaXMubWF4KSB8fCB0aGlzLm1vZGUgIT09IFwibG9jYWxcIil7XG5cdFx0XHR0aGlzLnBhZ2UgPSBwYWdlO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnRyYWNrQ2hhbmdlcygpO1xuXHRcdFx0XG5cdFx0XHRyZXR1cm4gdGhpcy50cmlnZ2VyKCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiUGFnaW5hdGlvbiBFcnJvciAtIFJlcXVlc3RlZCBwYWdlIGlzIG91dCBvZiByYW5nZSBvZiAxIC0gXCIgKyB0aGlzLm1heCArIFwiOlwiLCBwYWdlKTtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdCgpO1xuXHRcdH1cblx0fVxuXHRcblx0c2V0UGFnZVRvUm93KHJvdyl7XG5cdFx0dmFyIHJvd3MgPSB0aGlzLmRpc3BsYXlSb3dzKC0xKTtcblx0XHR2YXIgaW5kZXggPSByb3dzLmluZGV4T2Yocm93KTtcblx0XG5cdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHR2YXIgcGFnZSA9IHRoaXMuc2l6ZSA9PT0gdHJ1ZSA/IDEgOiBNYXRoLmNlaWwoKGluZGV4ICsgMSkgLyB0aGlzLnNpemUpO1xuXHRcdFx0XG5cdFx0XHRyZXR1cm4gdGhpcy5zZXRQYWdlKHBhZ2UpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIlBhZ2luYXRpb24gRXJyb3IgLSBSZXF1ZXN0ZWQgcm93IGlzIG5vdCB2aXNpYmxlXCIpO1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRzZXRQYWdlU2l6ZShzaXplKXtcblx0XHRpZihzaXplICE9PSB0cnVlKXtcblx0XHRcdHNpemUgPSBwYXJzZUludChzaXplKTtcblx0XHR9XG5cblx0XHRpZihzaXplID4gMCl7XG5cdFx0XHR0aGlzLnNpemUgPSBzaXplO1xuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicGFnZVNpemVDaGFuZ2VkXCIsIHNpemUpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLnBhZ2VTaXplU2VsZWN0KXtcblx0XHRcdC8vIHRoaXMucGFnZVNpemVTZWxlY3QudmFsdWUgPSBzaXplO1xuXHRcdFx0dGhpcy5nZW5lcmF0ZVBhZ2VTaXplU2VsZWN0TGlzdCgpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLnRyYWNrQ2hhbmdlcygpO1xuXHR9XG5cdFxuXHRfc2V0UGFnZUNvdW50ZXIodG90YWxSb3dzLCBzaXplLCBjdXJyZW50Um93KXtcblx0XHR2YXIgY29udGVudDtcblx0XHRcblx0XHRpZih0aGlzLnBhZ2VDb3VudGVyKXtcblxuXHRcdFx0aWYodGhpcy5tb2RlID09PSBcInJlbW90ZVwiKXtcblx0XHRcdFx0c2l6ZSA9IHRoaXMuc2l6ZTtcblx0XHRcdFx0Y3VycmVudFJvdyA9ICgodGhpcy5wYWdlIC0gMSkgKiB0aGlzLnNpemUpICsgMTtcblx0XHRcdFx0dG90YWxSb3dzID0gdGhpcy5yZW1vdGVSb3dDb3VudEVzdGltYXRlO1xuXHRcdFx0fVxuXG5cdFx0XHRjb250ZW50ID0gdGhpcy5wYWdlQ291bnRlci5jYWxsKHRoaXMsIHNpemUsIGN1cnJlbnRSb3csIHRoaXMucGFnZSwgdG90YWxSb3dzLCB0aGlzLm1heCk7XG5cdFx0XHRcblx0XHRcdHN3aXRjaCh0eXBlb2YgY29udGVudCl7XG5cdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRpZihjb250ZW50IGluc3RhbmNlb2YgTm9kZSl7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHQvL2NsZWFyIHByZXZpb3VzIGNlbGwgY29udGVudHNcblx0XHRcdFx0XHRcdHdoaWxlKHRoaXMucGFnZUNvdW50ZXJFbGVtZW50LmZpcnN0Q2hpbGQpIHRoaXMucGFnZUNvdW50ZXJFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMucGFnZUNvdW50ZXJFbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0dGhpcy5wYWdlQ291bnRlckVsZW1lbnQuYXBwZW5kQ2hpbGQoY29udGVudCk7XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0dGhpcy5wYWdlQ291bnRlckVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmKGNvbnRlbnQgIT0gbnVsbCl7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIlBhZ2UgQ291bnRlciBFcnJvciAtIFBhZ2UgQ291bnRlciBoYXMgcmV0dXJuZWQgYSB0eXBlIG9mIG9iamVjdCwgdGhlIG9ubHkgdmFsaWQgcGFnZSBjb3VudGVyIG9iamVjdCByZXR1cm4gaXMgYW4gaW5zdGFuY2Ugb2YgTm9kZSwgdGhlIHBhZ2UgY291bnRlciByZXR1cm5lZDpcIiwgY29udGVudCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cdFx0XHRcdFx0dGhpcy5wYWdlQ291bnRlckVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHR0aGlzLnBhZ2VDb3VudGVyRWxlbWVudC5pbm5lckhUTUwgPSBjb250ZW50O1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Ly9zZXR1cCB0aGUgcGFnaW5hdGlvbiBidXR0b25zXG5cdF9zZXRQYWdlQnV0dG9ucygpe1xuXHRcdGxldCBsZWZ0U2l6ZSA9IE1hdGguZmxvb3IoKHRoaXMuY291bnQtMSkgLyAyKTtcblx0XHRsZXQgcmlnaHRTaXplID0gTWF0aC5jZWlsKCh0aGlzLmNvdW50LTEpIC8gMik7XG5cdFx0bGV0IG1pbiA9IHRoaXMubWF4IC0gdGhpcy5wYWdlICsgbGVmdFNpemUgKyAxIDwgdGhpcy5jb3VudCA/IHRoaXMubWF4LXRoaXMuY291bnQrMTogTWF0aC5tYXgodGhpcy5wYWdlLWxlZnRTaXplLDEpO1xuXHRcdGxldCBtYXggPSB0aGlzLnBhZ2UgPD0gcmlnaHRTaXplPyBNYXRoLm1pbih0aGlzLmNvdW50LCB0aGlzLm1heCkgOk1hdGgubWluKHRoaXMucGFnZStyaWdodFNpemUsIHRoaXMubWF4KTtcblx0XHRcblx0XHR3aGlsZSh0aGlzLnBhZ2VzRWxlbWVudC5maXJzdENoaWxkKSB0aGlzLnBhZ2VzRWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLnBhZ2VzRWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcblx0XHRpZih0aGlzLnBhZ2UgPT0gMSl7XG5cdFx0XHR0aGlzLmZpcnN0QnV0LmRpc2FibGVkID0gdHJ1ZTtcblx0XHRcdHRoaXMucHJldkJ1dC5kaXNhYmxlZCA9IHRydWU7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5maXJzdEJ1dC5kaXNhYmxlZCA9IGZhbHNlO1xuXHRcdFx0dGhpcy5wcmV2QnV0LmRpc2FibGVkID0gZmFsc2U7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMucGFnZSA9PSB0aGlzLm1heCl7XG5cdFx0XHR0aGlzLmxhc3RCdXQuZGlzYWJsZWQgPSB0cnVlO1xuXHRcdFx0dGhpcy5uZXh0QnV0LmRpc2FibGVkID0gdHJ1ZTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmxhc3RCdXQuZGlzYWJsZWQgPSBmYWxzZTtcblx0XHRcdHRoaXMubmV4dEJ1dC5kaXNhYmxlZCA9IGZhbHNlO1xuXHRcdH1cblx0XHRcblx0XHRmb3IobGV0IGkgPSBtaW47IGkgPD0gbWF4OyBpKyspe1xuXHRcdFx0aWYoaT4wICYmIGkgPD0gdGhpcy5tYXgpe1xuXHRcdFx0XHR0aGlzLnBhZ2VzRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9nZW5lcmF0ZVBhZ2VCdXR0b24oaSkpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHR0aGlzLmZvb3RlclJlZHJhdygpO1xuXHR9XG5cdFxuXHRfZ2VuZXJhdGVQYWdlQnV0dG9uKHBhZ2Upe1xuXHRcdHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuXHRcdFxuXHRcdGJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXBhZ2VcIik7XG5cdFx0aWYocGFnZSA9PSB0aGlzLnBhZ2Upe1xuXHRcdFx0YnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG5cdFx0fVxuXHRcdFxuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiYnV0dG9uXCIpO1xuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYnV0dG9uXCIpO1xuXHRcdFxuXHRcdHRoaXMubGFuZ0JpbmQoXCJwYWdpbmF0aW9ufHBhZ2VfdGl0bGVcIiwgKHZhbHVlKSA9PiB7XG5cdFx0XHRidXR0b24uc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB2YWx1ZSArIFwiIFwiICsgcGFnZSk7XG5cdFx0XHRidXR0b24uc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgdmFsdWUgKyBcIiBcIiArIHBhZ2UpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkYXRhLXBhZ2VcIiwgcGFnZSk7XG5cdFx0YnV0dG9uLnRleHRDb250ZW50ID0gcGFnZTtcblx0XHRcblx0XHRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG5cdFx0XHR0aGlzLnNldFBhZ2UocGFnZSk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIGJ1dHRvbjtcblx0fVxuXHRcblx0Ly9wcmV2aW91cyBwYWdlXG5cdHByZXZpb3VzUGFnZSgpe1xuXHRcdGlmKHRoaXMucGFnZSA+IDEpe1xuXHRcdFx0dGhpcy5wYWdlLS07XG5cdFx0XHRcblx0XHRcdHRoaXMudHJhY2tDaGFuZ2VzKCk7XG5cdFx0XHRcblx0XHRcdHJldHVybiB0aGlzLnRyaWdnZXIoKTtcblx0XHRcdFxuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIlBhZ2luYXRpb24gRXJyb3IgLSBQcmV2aW91cyBwYWdlIHdvdWxkIGJlIGxlc3MgdGhhbiBwYWdlIDE6XCIsIDApO1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL25leHQgcGFnZVxuXHRuZXh0UGFnZSgpe1xuXHRcdGlmKHRoaXMucGFnZSA8IHRoaXMubWF4KXtcblx0XHRcdHRoaXMucGFnZSsrO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnRyYWNrQ2hhbmdlcygpO1xuXHRcdFx0XG5cdFx0XHRyZXR1cm4gdGhpcy50cmlnZ2VyKCk7XG5cdFx0XHRcblx0XHR9ZWxzZSB7XG5cdFx0XHRpZighdGhpcy5wcm9ncmVzc2l2ZUxvYWQpe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJQYWdpbmF0aW9uIEVycm9yIC0gTmV4dCBwYWdlIHdvdWxkIGJlIGdyZWF0ZXIgdGhhbiBtYXhpbXVtIHBhZ2Ugb2YgXCIgKyB0aGlzLm1heCArIFwiOlwiLCB0aGlzLm1heCArIDEpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3JldHVybiBjdXJyZW50IHBhZ2UgbnVtYmVyXG5cdGdldFBhZ2UoKXtcblx0XHRyZXR1cm4gdGhpcy5wYWdlO1xuXHR9XG5cdFxuXHQvL3JldHVybiBtYXggcGFnZSBudW1iZXJcblx0Z2V0UGFnZU1heCgpe1xuXHRcdHJldHVybiB0aGlzLm1heDtcblx0fVxuXHRcblx0Z2V0UGFnZVNpemUoc2l6ZSl7XG5cdFx0cmV0dXJuIHRoaXMuc2l6ZTtcblx0fVxuXHRcblx0Z2V0TW9kZSgpe1xuXHRcdHJldHVybiB0aGlzLm1vZGU7XG5cdH1cblx0XG5cdC8vcmV0dXJuIGFwcHJvcHJpYXRlIHJvd3MgZm9yIGN1cnJlbnQgcGFnZVxuXHRnZXRSb3dzKGRhdGEpe1xuXHRcdHZhciBhY3R1YWxSb3dQYWdlU2l6ZSA9IDAsXG5cdFx0b3V0cHV0LCBzdGFydCwgZW5kLCBhY3R1YWxTdGFydFJvdztcblxuXHRcdHZhciBhY3R1YWxSb3dzID0gZGF0YS5maWx0ZXIoKHJvdykgPT4ge1xuXHRcdFx0cmV0dXJuIHJvdy50eXBlID09PSBcInJvd1wiO1xuXHRcdH0pO1xuXHRcdFxuXHRcdGlmKHRoaXMubW9kZSA9PSBcImxvY2FsXCIpe1xuXHRcdFx0b3V0cHV0ID0gW107XG5cdFx0XHRcblx0XHRcdHRoaXMuc2V0TWF4Um93cyhkYXRhLmxlbmd0aCk7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuc2l6ZSA9PT0gdHJ1ZSl7XG5cdFx0XHRcdHN0YXJ0ID0gMDtcblx0XHRcdFx0ZW5kID0gZGF0YS5sZW5ndGg7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHN0YXJ0ID0gdGhpcy5zaXplICogKHRoaXMucGFnZSAtIDEpO1xuXHRcdFx0XHRlbmQgPSBzdGFydCArIHBhcnNlSW50KHRoaXMuc2l6ZSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuX3NldFBhZ2VCdXR0b25zKCk7XG5cdFx0XHRcblx0XHRcdGZvcihsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspe1xuXHRcdFx0XHRsZXQgcm93ID0gZGF0YVtpXTtcblxuXHRcdFx0XHRpZihyb3cpe1xuXHRcdFx0XHRcdG91dHB1dC5wdXNoKHJvdyk7XG5cblx0XHRcdFx0XHRpZihyb3cudHlwZSA9PT0gXCJyb3dcIil7XG5cdFx0XHRcdFx0XHRpZighYWN0dWFsU3RhcnRSb3cpe1xuXHRcdFx0XHRcdFx0XHRhY3R1YWxTdGFydFJvdyA9IHJvdztcblx0XHRcdFx0XHRcdH1cdFxuXG5cdFx0XHRcdFx0XHRhY3R1YWxSb3dQYWdlU2l6ZSsrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLl9zZXRQYWdlQ291bnRlcihhY3R1YWxSb3dzLmxlbmd0aCwgYWN0dWFsUm93UGFnZVNpemUsIGFjdHVhbFN0YXJ0Um93ID8gKGFjdHVhbFJvd3MuaW5kZXhPZihhY3R1YWxTdGFydFJvdykgKyAxKSA6IDApO1xuXHRcdFx0XG5cdFx0XHRyZXR1cm4gb3V0cHV0O1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuX3NldFBhZ2VCdXR0b25zKCk7XG5cdFx0XHR0aGlzLl9zZXRQYWdlQ291bnRlcihhY3R1YWxSb3dzLmxlbmd0aCk7XG5cdFx0XHRcblx0XHRcdHJldHVybiBkYXRhLnNsaWNlKDApO1xuXHRcdH1cblx0fVxuXHRcblx0dHJpZ2dlcigpe1xuXHRcdHZhciBsZWZ0O1xuXHRcdFxuXHRcdHN3aXRjaCh0aGlzLm1vZGUpe1xuXHRcdFx0Y2FzZSBcImxvY2FsXCI6XG5cdFx0XHRcdGxlZnQgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsTGVmdDtcblx0XHRcdFxuXHRcdFx0XHR0aGlzLnJlZnJlc2hEYXRhKCk7XG5cdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHRcdFx0XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInBhZ2VMb2FkZWRcIiwgdGhpcy5nZXRQYWdlKCkpO1xuXHRcdFx0XG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblx0XHRcdFxuXHRcdFx0Y2FzZSBcInJlbW90ZVwiOlxuXHRcdFx0XHR0aGlzLmRhdGFDaGFuZ2luZyA9IHRydWU7XG5cdFx0XHRcdHJldHVybiB0aGlzLnJlbG9hZERhdGEobnVsbClcblx0XHRcdFx0XHQuZmluYWxseSgoKSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLmRhdGFDaGFuZ2luZyA9IGZhbHNlO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwicHJvZ3Jlc3NpdmVfbG9hZFwiOlxuXHRcdFx0Y2FzZSBcInByb2dyZXNzaXZlX3Njcm9sbFwiOlxuXHRcdFx0XHRyZXR1cm4gdGhpcy5yZWxvYWREYXRhKG51bGwsIHRydWUpO1xuXHRcdFx0XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJQYWdpbmF0aW9uIEVycm9yIC0gbm8gc3VjaCBwYWdpbmF0aW9uIG1vZGU6XCIsIHRoaXMubW9kZSk7XG5cdFx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdCgpO1xuXHRcdH1cblx0fVxuXHRcblx0X3BhcnNlUmVtb3RlRGF0YShkYXRhKXtcblx0XHR2YXIgbWFyZ2luLCBwYWdpbmF0aW9uT3V0T2ZSYW5nZTtcblx0XHRcblx0XHRpZih0eXBlb2YgZGF0YS5sYXN0X3BhZ2UgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0Y29uc29sZS53YXJuKFwiUmVtb3RlIFBhZ2luYXRpb24gRXJyb3IgLSBTZXJ2ZXIgcmVzcG9uc2UgbWlzc2luZyAnXCIgKyAodGhpcy5vcHRpb25zKFwiZGF0YVJlY2VpdmVQYXJhbXNcIikubGFzdF9wYWdlIHx8IFwibGFzdF9wYWdlXCIpICsgXCInIHByb3BlcnR5XCIpO1xuXHRcdH1cblx0XHRcblx0XHRpZihkYXRhLmRhdGEpe1xuXHRcdFx0dGhpcy5tYXggPSBwYXJzZUludChkYXRhLmxhc3RfcGFnZSkgfHwgMTtcblxuXHRcdFx0dGhpcy5yZW1vdGVSb3dDb3VudEVzdGltYXRlID0gdHlwZW9mIGRhdGEubGFzdF9yb3cgIT09IFwidW5kZWZpbmVkXCIgPyBkYXRhLmxhc3Rfcm93IDogKGRhdGEubGFzdF9wYWdlICogdGhpcy5zaXplIC0gKHRoaXMucGFnZSA9PSBkYXRhLmxhc3RfcGFnZSA/ICh0aGlzLnNpemUgLSBkYXRhLmRhdGEubGVuZ3RoKSA6IDApKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5wcm9ncmVzc2l2ZUxvYWQpe1xuXHRcdFx0XHRzd2l0Y2godGhpcy5tb2RlKXtcblx0XHRcdFx0XHRjYXNlIFwicHJvZ3Jlc3NpdmVfbG9hZFwiOlxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0aWYodGhpcy5wYWdlID09IDEpe1xuXHRcdFx0XHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2V0RGF0YShkYXRhLmRhdGEsIGZhbHNlLCB0aGlzLnBhZ2UgPT0gMSk7XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGRSb3dzKGRhdGEuZGF0YSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZih0aGlzLnBhZ2UgPCB0aGlzLm1heCl7XG5cdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdHRoaXMubmV4dFBhZ2UoKTtcblx0XHRcdFx0XHRcdFx0fSwgdGhpcy50YWJsZS5vcHRpb25zLnByb2dyZXNzaXZlTG9hZERlbGF5KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGNhc2UgXCJwcm9ncmVzc2l2ZV9zY3JvbGxcIjpcblx0XHRcdFx0XHRcdGRhdGEgPSB0aGlzLnBhZ2UgPT09IDEgPyBkYXRhLmRhdGEgOiB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGF0YSgpLmNvbmNhdChkYXRhLmRhdGEpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNldERhdGEoZGF0YSwgdGhpcy5wYWdlICE9PSAxLCB0aGlzLnBhZ2UgPT0gMSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRtYXJnaW4gPSB0aGlzLnRhYmxlLm9wdGlvbnMucHJvZ3Jlc3NpdmVMb2FkU2Nyb2xsTWFyZ2luIHx8ICh0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5jbGllbnRIZWlnaHQgKiAyKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmKHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbEhlaWdodCA8PSAodGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50SGVpZ2h0ICsgbWFyZ2luKSl7XG5cdFx0XHRcdFx0XHRcdGlmKHRoaXMucGFnZSA8IHRoaXMubWF4KXtcblx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdHRoaXMubmV4dFBhZ2UoKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1lbHNlIHtcblxuXHRcdFx0XHRpZih0aGlzLnBhZ2UgPiB0aGlzLm1heCl7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKCBcIlJlbW90ZSBQYWdpbmF0aW9uIEVycm9yIC0gU2VydmVyIHJldHVybmVkIGxhc3QgcGFnZSB2YWx1ZSBsb3dlciB0aGFuIHRoZSBjdXJyZW50IHBhZ2VcIiApO1xuXG5cdFx0XHRcdFx0cGFnaW5hdGlvbk91dE9mUmFuZ2UgPSB0aGlzLm9wdGlvbnMoJ3BhZ2luYXRpb25PdXRPZlJhbmdlJyk7XG5cblx0XHRcdFx0XHRpZihwYWdpbmF0aW9uT3V0T2ZSYW5nZSl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdGhpcy5zZXRQYWdlKHR5cGVvZiBwYWdpbmF0aW9uT3V0T2ZSYW5nZSA9PT0gJ2Z1bmN0aW9uJyA/IHBhZ2luYXRpb25PdXRPZlJhbmdlLmNhbGwodGhpcywgdGhpcy5wYWdlLCB0aGlzLm1heCkgOlx0cGFnaW5hdGlvbk91dE9mUmFuZ2UpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIGxlZnQgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsTGVmdDtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicGFnZUxvYWRlZFwiLCAgdGhpcy5nZXRQYWdlKCkpO1xuXHRcdFx0XHQvLyB0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsSG9yaXpvbnRhbChsZWZ0KTtcblx0XHRcdFx0Ly8gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJSZW1vdGUgUGFnaW5hdGlvbiBFcnJvciAtIFNlcnZlciByZXNwb25zZSBtaXNzaW5nICdcIiArICh0aGlzLm9wdGlvbnMoXCJkYXRhUmVjZWl2ZVBhcmFtc1wiKS5kYXRhIHx8IFwiZGF0YVwiKSArIFwiJyBwcm9wZXJ0eVwiKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGRhdGEuZGF0YTtcblx0fVxuXHRcblx0Ly9oYW5kbGUgdGhlIGZvb3RlciBlbGVtZW50IGJlaW5nIHJlZHJhd25cblx0Zm9vdGVyUmVkcmF3KCl7XG5cdFx0dmFyIGZvb3RlciA9IHRoaXMudGFibGUuZm9vdGVyTWFuYWdlci5jb250YWluZXJFbGVtZW50O1xuXG5cdFx0aWYoKE1hdGguY2VpbChmb290ZXIuY2xpZW50V2lkdGgpIC0gZm9vdGVyLnNjcm9sbFdpZHRoKSA8IDApe1xuXHRcdFx0dGhpcy5wYWdlc0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLnBhZ2VzRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG5cdFx0XHRcblx0XHRcdGlmKChNYXRoLmNlaWwoZm9vdGVyLmNsaWVudFdpZHRoKSAtIGZvb3Rlci5zY3JvbGxXaWR0aCkgPCAwKXtcblx0XHRcdFx0dGhpcy5wYWdlc0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdH1cblx0XHR9XG5cdH1cbn1cblxuLy8gcmVhZCBwZXJzaXN0YW5jZSBpbmZvcm1hdGlvbiBmcm9tIHN0b3JhZ2VcbnZhciBkZWZhdWx0UmVhZGVycyA9IHtcblx0bG9jYWw6ZnVuY3Rpb24oaWQsIHR5cGUpe1xuXHRcdHZhciBkYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oaWQgKyBcIi1cIiArIHR5cGUpO1xuXG5cdFx0cmV0dXJuIGRhdGEgPyBKU09OLnBhcnNlKGRhdGEpIDogZmFsc2U7XG5cdH0sXG5cdGNvb2tpZTpmdW5jdGlvbihpZCwgdHlwZSl7XG5cdFx0dmFyIGNvb2tpZSA9IGRvY3VtZW50LmNvb2tpZSxcblx0XHRrZXkgPSBpZCArIFwiLVwiICsgdHlwZSxcblx0XHRjb29raWVQb3MgPSBjb29raWUuaW5kZXhPZihrZXkgKyBcIj1cIiksXG5cdFx0ZW5kLCBkYXRhO1xuXG5cdFx0Ly9pZiBjb29raWUgZXhpc3RzLCBkZWNvZGUgYW5kIGxvYWQgY29sdW1uIGRhdGEgaW50byB0YWJ1bGF0b3Jcblx0XHRpZihjb29raWVQb3MgPiAtMSl7XG5cdFx0XHRjb29raWUgPSBjb29raWUuc2xpY2UoY29va2llUG9zKTtcblxuXHRcdFx0ZW5kID0gY29va2llLmluZGV4T2YoXCI7XCIpO1xuXG5cdFx0XHRpZihlbmQgPiAtMSl7XG5cdFx0XHRcdGNvb2tpZSA9IGNvb2tpZS5zbGljZSgwLCBlbmQpO1xuXHRcdFx0fVxuXG5cdFx0XHRkYXRhID0gY29va2llLnJlcGxhY2Uoa2V5ICsgXCI9XCIsIFwiXCIpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhID8gSlNPTi5wYXJzZShkYXRhKSA6IGZhbHNlO1xuXHR9XG59O1xuXG4vL3dyaXRlIHBlcnNpc3RlbmNlIGluZm9ybWF0aW9uIHRvIHN0b3JhZ2VcbnZhciBkZWZhdWx0V3JpdGVycyA9IHtcblx0bG9jYWw6ZnVuY3Rpb24oaWQsIHR5cGUsIGRhdGEpe1xuXHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKGlkICsgXCItXCIgKyB0eXBlLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG5cdH0sXG5cdGNvb2tpZTpmdW5jdGlvbihpZCwgdHlwZSwgZGF0YSl7XG5cdFx0dmFyIGV4cGlyZURhdGUgPSBuZXcgRGF0ZSgpO1xuXG5cdFx0ZXhwaXJlRGF0ZS5zZXREYXRlKGV4cGlyZURhdGUuZ2V0RGF0ZSgpICsgMTAwMDApO1xuXG5cdFx0ZG9jdW1lbnQuY29va2llID0gaWQgKyBcIi1cIiArIHR5cGUgKyBcIj1cIiArIEpTT04uc3RyaW5naWZ5KGRhdGEpICsgXCI7IGV4cGlyZXM9XCIgKyBleHBpcmVEYXRlLnRvVVRDU3RyaW5nKCk7XG5cdH1cbn07XG5cbmNsYXNzIFBlcnNpc3RlbmNlIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJwZXJzaXN0ZW5jZVwiO1xuXG5cdHN0YXRpYyBtb2R1bGVJbml0T3JkZXIgPSAtMTA7XG5cblx0Ly9sb2FkIGRlZmF1bHRzXG5cdHN0YXRpYyByZWFkZXJzID0gZGVmYXVsdFJlYWRlcnM7XG5cdHN0YXRpYyB3cml0ZXJzID0gZGVmYXVsdFdyaXRlcnM7XG5cblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblxuXHRcdHRoaXMubW9kZSA9IFwiXCI7XG5cdFx0dGhpcy5pZCA9IFwiXCI7XG5cdFx0Ly8gdGhpcy5wZXJzaXN0UHJvcHMgPSBbXCJmaWVsZFwiLCBcIndpZHRoXCIsIFwidmlzaWJsZVwiXTtcblx0XHR0aGlzLmRlZldhdGNoZXJCbG9jayA9IGZhbHNlO1xuXHRcdHRoaXMuY29uZmlnID0ge307XG5cdFx0dGhpcy5yZWFkRnVuYyA9IGZhbHNlO1xuXHRcdHRoaXMud3JpdGVGdW5jID0gZmFsc2U7XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwZXJzaXN0ZW5jZVwiLCBmYWxzZSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicGVyc2lzdGVuY2VJRFwiLCBcIlwiKTsgLy9rZXkgZm9yIHBlcnNpc3RlbnQgc3RvcmFnZVxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInBlcnNpc3RlbmNlTW9kZVwiLCB0cnVlKTsgLy9tb2RlIGZvciBzdG9yaW5nIHBlcnNpc3RlbmNlIGluZm9ybWF0aW9uXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicGVyc2lzdGVuY2VSZWFkZXJGdW5jXCIsIGZhbHNlKTsgLy9mdW5jdGlvbiBmb3IgaGFuZGxpbmcgcGVyc2lzdGVuY2UgZGF0YSByZWFkaW5nXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicGVyc2lzdGVuY2VXcml0ZXJGdW5jXCIsIGZhbHNlKTsgLy9mdW5jdGlvbiBmb3IgaGFuZGxpbmcgcGVyc2lzdGVuY2UgZGF0YSB3cml0aW5nXG5cdH1cblxuXHQvLyBUZXN0IGZvciB3aGV0aGVyIGxvY2FsU3RvcmFnZSBpcyBhdmFpbGFibGUgZm9yIHVzZS5cblx0bG9jYWxTdG9yYWdlVGVzdCgpIHtcblx0XHR2YXIgIHRlc3RLZXkgPSAgXCJfdGFidWxhdG9yX3Rlc3RcIjtcblxuXHRcdHRyeSB7XG5cdFx0XHR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oIHRlc3RLZXksIHRlc3RLZXkpO1xuXHRcdFx0d2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCB0ZXN0S2V5ICk7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9IGNhdGNoKGUpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblxuXHQvL3NldHVwIHBhcmFtZXRlcnNcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSl7XG5cdFx0XHQvL2RldGVybWluZSBwZXJzaXN0ZW50IGxheW91dCBzdG9yYWdlIHR5cGVcblx0XHRcdHZhciBtb2RlID0gdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlTW9kZSxcblx0XHRcdGlkID0gdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlSUQsXG5cdFx0XHRyZXRyaWV2ZWREYXRhO1xuXG5cdFx0XHR0aGlzLm1vZGUgPSBtb2RlICE9PSB0cnVlID8gIG1vZGUgOiAodGhpcy5sb2NhbFN0b3JhZ2VUZXN0KCkgPyBcImxvY2FsXCIgOiBcImNvb2tpZVwiKTtcblxuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlUmVhZGVyRnVuYyl7XG5cdFx0XHRcdGlmKHR5cGVvZiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VSZWFkZXJGdW5jID09PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0XHRcdHRoaXMucmVhZEZ1bmMgPSB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VSZWFkZXJGdW5jO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0aWYoUGVyc2lzdGVuY2UucmVhZGVyc1t0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VSZWFkZXJGdW5jXSl7XG5cdFx0XHRcdFx0XHR0aGlzLnJlYWRGdW5jID0gUGVyc2lzdGVuY2UucmVhZGVyc1t0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VSZWFkZXJGdW5jXTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJQZXJzaXN0ZW5jZSBSZWFkIEVycm9yIC0gaW52YWxpZCByZWFkZXIgc2V0XCIsIHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVJlYWRlckZ1bmMpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZihQZXJzaXN0ZW5jZS5yZWFkZXJzW3RoaXMubW9kZV0pe1xuXHRcdFx0XHRcdHRoaXMucmVhZEZ1bmMgPSBQZXJzaXN0ZW5jZS5yZWFkZXJzW3RoaXMubW9kZV07XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJQZXJzaXN0ZW5jZSBSZWFkIEVycm9yIC0gaW52YWxpZCByZWFkZXIgc2V0XCIsIHRoaXMubW9kZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuYyl7XG5cdFx0XHRcdGlmKHR5cGVvZiB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2VXcml0ZXJGdW5jID09PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0XHRcdHRoaXMud3JpdGVGdW5jID0gdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuYztcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGlmKFBlcnNpc3RlbmNlLndyaXRlcnNbdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlV3JpdGVyRnVuY10pe1xuXHRcdFx0XHRcdFx0dGhpcy53cml0ZUZ1bmMgPSBQZXJzaXN0ZW5jZS53cml0ZXJzW3RoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVdyaXRlckZ1bmNdO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUud2FybihcIlBlcnNpc3RlbmNlIFdyaXRlIEVycm9yIC0gaW52YWxpZCByZWFkZXIgc2V0XCIsIHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZVdyaXRlckZ1bmMpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZihQZXJzaXN0ZW5jZS53cml0ZXJzW3RoaXMubW9kZV0pe1xuXHRcdFx0XHRcdHRoaXMud3JpdGVGdW5jID0gUGVyc2lzdGVuY2Uud3JpdGVyc1t0aGlzLm1vZGVdO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiUGVyc2lzdGVuY2UgV3JpdGUgRXJyb3IgLSBpbnZhbGlkIHdyaXRlciBzZXRcIiwgdGhpcy5tb2RlKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvL3NldCBzdG9yYWdlIHRhZ1xuXHRcdFx0dGhpcy5pZCA9IFwidGFidWxhdG9yLVwiICsgKGlkIHx8ICh0aGlzLnRhYmxlLmVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiaWRcIikgfHwgXCJcIikpO1xuXG5cdFx0XHR0aGlzLmNvbmZpZyA9IHtcblx0XHRcdFx0c29ydDp0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgfHwgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlLnNvcnQsXG5cdFx0XHRcdGZpbHRlcjp0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgfHwgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlLmZpbHRlcixcblx0XHRcdFx0aGVhZGVyRmlsdGVyOnRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSA9PT0gdHJ1ZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UuaGVhZGVyRmlsdGVyLFxuXHRcdFx0XHRncm91cDp0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgfHwgdGhpcy50YWJsZS5vcHRpb25zLnBlcnNpc3RlbmNlLmdyb3VwLFxuXHRcdFx0XHRwYWdlOnRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZSA9PT0gdHJ1ZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UucGFnZSxcblx0XHRcdFx0Y29sdW1uczp0aGlzLnRhYmxlLm9wdGlvbnMucGVyc2lzdGVuY2UgPT09IHRydWUgPyBbXCJ0aXRsZVwiLCBcIndpZHRoXCIsIFwidmlzaWJsZVwiXSA6IHRoaXMudGFibGUub3B0aW9ucy5wZXJzaXN0ZW5jZS5jb2x1bW5zLFxuXHRcdFx0fTtcblxuXHRcdFx0Ly9sb2FkIHBhZ2luYXRpb24gZGF0YSBpZiBuZWVkZWRcblx0XHRcdGlmKHRoaXMuY29uZmlnLnBhZ2Upe1xuXHRcdFx0XHRyZXRyaWV2ZWREYXRhID0gdGhpcy5yZXRyaWV2ZURhdGEoXCJwYWdlXCIpO1xuXG5cdFx0XHRcdGlmKHJldHJpZXZlZERhdGEpe1xuXHRcdFx0XHRcdGlmKHR5cGVvZiByZXRyaWV2ZWREYXRhLnBhZ2luYXRpb25TaXplICE9PSBcInVuZGVmaW5lZFwiICYmICh0aGlzLmNvbmZpZy5wYWdlID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLnBhZ2Uuc2l6ZSkpe1xuXHRcdFx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnBhZ2luYXRpb25TaXplID0gcmV0cmlldmVkRGF0YS5wYWdpbmF0aW9uU2l6ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZih0eXBlb2YgcmV0cmlldmVkRGF0YS5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UgIT09IFwidW5kZWZpbmVkXCIgJiYgKHRoaXMuY29uZmlnLnBhZ2UgPT09IHRydWUgfHwgdGhpcy5jb25maWcucGFnZS5wYWdlKSl7XG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbkluaXRpYWxQYWdlID0gcmV0cmlldmVkRGF0YS5wYWdpbmF0aW9uSW5pdGlhbFBhZ2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vbG9hZCBncm91cCBkYXRhIGlmIG5lZWRlZFxuXHRcdFx0aWYodGhpcy5jb25maWcuZ3JvdXApe1xuXHRcdFx0XHRyZXRyaWV2ZWREYXRhID0gdGhpcy5yZXRyaWV2ZURhdGEoXCJncm91cFwiKTtcblxuXHRcdFx0XHRpZihyZXRyaWV2ZWREYXRhKXtcblx0XHRcdFx0XHRpZih0eXBlb2YgcmV0cmlldmVkRGF0YS5ncm91cEJ5ICE9PSBcInVuZGVmaW5lZFwiICYmICh0aGlzLmNvbmZpZy5ncm91cCA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5ncm91cC5ncm91cEJ5KSl7XG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBCeSA9IHJldHJpZXZlZERhdGEuZ3JvdXBCeTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYodHlwZW9mIHJldHJpZXZlZERhdGEuZ3JvdXBTdGFydE9wZW4gIT09IFwidW5kZWZpbmVkXCIgJiYgKHRoaXMuY29uZmlnLmdyb3VwID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLmdyb3VwLmdyb3VwU3RhcnRPcGVuKSl7XG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBTdGFydE9wZW4gPSByZXRyaWV2ZWREYXRhLmdyb3VwU3RhcnRPcGVuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZih0eXBlb2YgcmV0cmlldmVkRGF0YS5ncm91cEhlYWRlciAhPT0gXCJ1bmRlZmluZWRcIiAmJiAodGhpcy5jb25maWcuZ3JvdXAgPT09IHRydWUgfHwgdGhpcy5jb25maWcuZ3JvdXAuZ3JvdXBIZWFkZXIpKXtcblx0XHRcdFx0XHRcdHRoaXMudGFibGUub3B0aW9ucy5ncm91cEhlYWRlciA9IHJldHJpZXZlZERhdGEuZ3JvdXBIZWFkZXI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmKHRoaXMuY29uZmlnLmNvbHVtbnMpe1xuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucyA9IHRoaXMubG9hZChcImNvbHVtbnNcIiwgdGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbnMpO1xuXHRcdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1pbml0XCIsIHRoaXMuaW5pdGlhbGl6ZUNvbHVtbi5iaW5kKHRoaXMpKTtcblx0XHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tc2hvd1wiLCB0aGlzLnNhdmUuYmluZCh0aGlzLCBcImNvbHVtbnNcIikpO1xuXHRcdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1oaWRlXCIsIHRoaXMuc2F2ZS5iaW5kKHRoaXMsIFwiY29sdW1uc1wiKSk7XG5cdFx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLW1vdmVkXCIsIHRoaXMuc2F2ZS5iaW5kKHRoaXMsIFwiY29sdW1uc1wiKSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtYnVpbHRcIiwgdGhpcy50YWJsZUJ1aWx0LmJpbmQodGhpcyksIDApO1xuXG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLXJlZHJhd1wiLCB0aGlzLnRhYmxlUmVkcmF3LmJpbmQodGhpcykpO1xuXG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImZpbHRlci1jaGFuZ2VkXCIsIHRoaXMuZXZlbnRTYXZlLmJpbmQodGhpcywgXCJmaWx0ZXJcIikpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJmaWx0ZXItY2hhbmdlZFwiLCB0aGlzLmV2ZW50U2F2ZS5iaW5kKHRoaXMsIFwiaGVhZGVyRmlsdGVyXCIpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwic29ydC1jaGFuZ2VkXCIsIHRoaXMuZXZlbnRTYXZlLmJpbmQodGhpcywgXCJzb3J0XCIpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiZ3JvdXAtY2hhbmdlZFwiLCB0aGlzLmV2ZW50U2F2ZS5iaW5kKHRoaXMsIFwiZ3JvdXBcIikpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJwYWdlLWNoYW5nZWRcIiwgdGhpcy5ldmVudFNhdmUuYmluZCh0aGlzLCBcInBhZ2VcIikpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tcmVzaXplZFwiLCB0aGlzLmV2ZW50U2F2ZS5iaW5kKHRoaXMsIFwiY29sdW1uc1wiKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi13aWR0aFwiLCB0aGlzLmV2ZW50U2F2ZS5iaW5kKHRoaXMsIFwiY29sdW1uc1wiKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImxheW91dC1yZWZyZXNoZWRcIiwgdGhpcy5ldmVudFNhdmUuYmluZCh0aGlzLCBcImNvbHVtbnNcIikpO1xuXHRcdH1cblxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiZ2V0Q29sdW1uTGF5b3V0XCIsIHRoaXMuZ2V0Q29sdW1uTGF5b3V0LmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwic2V0Q29sdW1uTGF5b3V0XCIsIHRoaXMuc2V0Q29sdW1uTGF5b3V0LmJpbmQodGhpcykpO1xuXHR9XG5cblx0ZXZlbnRTYXZlKHR5cGUpe1xuXHRcdGlmKHRoaXMuY29uZmlnW3R5cGVdKXtcblx0XHRcdHRoaXMuc2F2ZSh0eXBlKTtcblx0XHR9XG5cdH1cblxuXHR0YWJsZUJ1aWx0KCl7XG5cdFx0dmFyIHNvcnRlcnMsIGZpbHRlcnMsIGhlYWRlckZpbHRlcnM7XG5cblx0XHRpZih0aGlzLmNvbmZpZy5zb3J0KXtcblx0XHRcdHNvcnRlcnMgPSB0aGlzLmxvYWQoXCJzb3J0XCIpO1xuXG5cdFx0XHRpZighc29ydGVycyA9PT0gZmFsc2Upe1xuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuaW5pdGlhbFNvcnQgPSBzb3J0ZXJzO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmKHRoaXMuY29uZmlnLmZpbHRlcil7XG5cdFx0XHRmaWx0ZXJzID0gdGhpcy5sb2FkKFwiZmlsdGVyXCIpO1xuXG5cdFx0XHRpZighZmlsdGVycyA9PT0gZmFsc2Upe1xuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuaW5pdGlhbEZpbHRlciA9IGZpbHRlcnM7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKHRoaXMuY29uZmlnLmhlYWRlckZpbHRlcil7XG5cdFx0XHRoZWFkZXJGaWx0ZXJzID0gdGhpcy5sb2FkKFwiaGVhZGVyRmlsdGVyXCIpO1xuXG5cdFx0XHRpZighaGVhZGVyRmlsdGVycyA9PT0gZmFsc2Upe1xuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuaW5pdGlhbEhlYWRlckZpbHRlciA9IGhlYWRlckZpbHRlcnM7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHR9XG5cblx0dGFibGVSZWRyYXcoZm9yY2Upe1xuXHRcdGlmKGZvcmNlICYmIHRoaXMuY29uZmlnLmNvbHVtbnMpe1xuXHRcdFx0dGhpcy5zYXZlKFwiY29sdW1uc1wiKTtcblx0XHR9XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gVGFibGUgRnVuY3Rpb25zIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdGdldENvbHVtbkxheW91dCgpe1xuXHRcdHJldHVybiB0aGlzLnBhcnNlQ29sdW1ucyh0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0Q29sdW1ucygpKTtcblx0fVxuXG5cdHNldENvbHVtbkxheW91dChsYXlvdXQpe1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5zZXRDb2x1bW5zKHRoaXMubWVyZ2VEZWZpbml0aW9uKHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5zLCBsYXlvdXQsIHRydWUpKTtcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBJbnRlcm5hbCBMb2dpYyAvLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdHZhciBkZWYsIGtleXM7XG5cblx0XHRpZih0aGlzLmNvbmZpZy5jb2x1bW5zKXtcblx0XHRcdHRoaXMuZGVmV2F0Y2hlckJsb2NrID0gdHJ1ZTtcblxuXHRcdFx0ZGVmID0gY29sdW1uLmdldERlZmluaXRpb24oKTtcblxuXHRcdFx0a2V5cyA9IHRoaXMuY29uZmlnLmNvbHVtbnMgPT09IHRydWUgPyBPYmplY3Qua2V5cyhkZWYpIDogdGhpcy5jb25maWcuY29sdW1ucztcblxuXHRcdFx0a2V5cy5mb3JFYWNoKChrZXkpPT57XG5cdFx0XHRcdHZhciBwcm9wcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZGVmLCBrZXkpO1xuXHRcdFx0XHR2YXIgdmFsdWUgPSBkZWZba2V5XTtcblxuXHRcdFx0XHRpZihwcm9wcyl7XG5cdFx0XHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGRlZiwga2V5LCB7XG5cdFx0XHRcdFx0XHRzZXQ6IChuZXdWYWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0XHR2YWx1ZSA9IG5ld1ZhbHVlO1xuXG5cdFx0XHRcdFx0XHRcdGlmKCF0aGlzLmRlZldhdGNoZXJCbG9jayl7XG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5zYXZlKFwiY29sdW1uc1wiKTtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdGlmKHByb3BzLnNldCl7XG5cdFx0XHRcdFx0XHRcdFx0cHJvcHMuc2V0KG5ld1ZhbHVlKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldDooKSA9PiB7XG5cdFx0XHRcdFx0XHRcdGlmKHByb3BzLmdldCl7XG5cdFx0XHRcdFx0XHRcdFx0cHJvcHMuZ2V0KCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5kZWZXYXRjaGVyQmxvY2sgPSBmYWxzZTtcblx0XHR9XG5cdH1cblxuXHQvL2xvYWQgc2F2ZWQgZGVmaW5pdGlvbnNcblx0bG9hZCh0eXBlLCBjdXJyZW50KXtcblx0XHR2YXIgZGF0YSA9IHRoaXMucmV0cmlldmVEYXRhKHR5cGUpO1xuXG5cdFx0aWYoY3VycmVudCl7XG5cdFx0XHRkYXRhID0gZGF0YSA/IHRoaXMubWVyZ2VEZWZpbml0aW9uKGN1cnJlbnQsIGRhdGEpIDogY3VycmVudDtcblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fVxuXG5cdC8vcmV0cmlldmUgZGF0YSBmcm9tIG1lbW9yeVxuXHRyZXRyaWV2ZURhdGEodHlwZSl7XG5cdFx0cmV0dXJuIHRoaXMucmVhZEZ1bmMgPyB0aGlzLnJlYWRGdW5jKHRoaXMuaWQsIHR5cGUpIDogZmFsc2U7XG5cdH1cblxuXHQvL21lcmdlIG9sZCBhbmQgbmV3IGNvbHVtbiBkZWZpbml0aW9uc1xuXHRtZXJnZURlZmluaXRpb24ob2xkQ29scywgbmV3Q29scywgbWVyZ2VBbGxOZXcpe1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblxuXHRcdG5ld0NvbHMgPSBuZXdDb2xzIHx8IFtdO1xuXG5cdFx0bmV3Q29scy5mb3JFYWNoKChjb2x1bW4sIHRvKSA9PiB7XG5cdFx0XHR2YXIgZnJvbSA9IHRoaXMuX2ZpbmRDb2x1bW4ob2xkQ29scywgY29sdW1uKSxcblx0XHRcdGtleXM7XG5cblx0XHRcdGlmKGZyb20pe1xuXHRcdFx0XHRpZihtZXJnZUFsbE5ldyl7XG5cdFx0XHRcdFx0a2V5cyA9IE9iamVjdC5rZXlzKGNvbHVtbik7XG5cdFx0XHRcdH1lbHNlIGlmKHRoaXMuY29uZmlnLmNvbHVtbnMgPT09IHRydWUgfHwgdGhpcy5jb25maWcuY29sdW1ucyA9PSB1bmRlZmluZWQpe1xuXHRcdFx0XHRcdGtleXMgPSAgT2JqZWN0LmtleXMoZnJvbSk7XG5cdFx0XHRcdFx0a2V5cy5wdXNoKFwid2lkdGhcIik7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRrZXlzID0gdGhpcy5jb25maWcuY29sdW1ucztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGtleXMuZm9yRWFjaCgoa2V5KT0+e1xuXHRcdFx0XHRcdGlmKGtleSAhPT0gXCJjb2x1bW5zXCIgJiYgdHlwZW9mIGNvbHVtbltrZXldICE9PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRcdGZyb21ba2V5XSA9IGNvbHVtbltrZXldO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYoZnJvbS5jb2x1bW5zKXtcblx0XHRcdFx0XHRmcm9tLmNvbHVtbnMgPSB0aGlzLm1lcmdlRGVmaW5pdGlvbihmcm9tLmNvbHVtbnMsIGNvbHVtbi5jb2x1bW5zKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdG91dHB1dC5wdXNoKGZyb20pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0b2xkQ29scy5mb3JFYWNoKChjb2x1bW4sIGkpID0+IHtcblx0XHRcdHZhciBmcm9tID0gdGhpcy5fZmluZENvbHVtbihuZXdDb2xzLCBjb2x1bW4pO1xuXG5cdFx0XHRpZiAoIWZyb20pIHtcblx0XHRcdFx0aWYob3V0cHV0Lmxlbmd0aD5pKXtcblx0XHRcdFx0XHRvdXRwdXQuc3BsaWNlKGksIDAsIGNvbHVtbik7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaChjb2x1bW4pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cblx0Ly9maW5kIG1hdGNoaW5nIGNvbHVtbnNcblx0X2ZpbmRDb2x1bW4oY29sdW1ucywgc3ViamVjdCl7XG5cdFx0dmFyIHR5cGUgPSBzdWJqZWN0LmNvbHVtbnMgPyBcImdyb3VwXCIgOiAoc3ViamVjdC5maWVsZCA/IFwiZmllbGRcIiA6IFwib2JqZWN0XCIpO1xuXG5cdFx0cmV0dXJuIGNvbHVtbnMuZmluZChmdW5jdGlvbihjb2wpe1xuXHRcdFx0c3dpdGNoKHR5cGUpe1xuXHRcdFx0XHRjYXNlIFwiZ3JvdXBcIjpcblx0XHRcdFx0XHRyZXR1cm4gY29sLnRpdGxlID09PSBzdWJqZWN0LnRpdGxlICYmIGNvbC5jb2x1bW5zLmxlbmd0aCA9PT0gc3ViamVjdC5jb2x1bW5zLmxlbmd0aDtcblxuXHRcdFx0XHRjYXNlIFwiZmllbGRcIjpcblx0XHRcdFx0XHRyZXR1cm4gY29sLmZpZWxkID09PSBzdWJqZWN0LmZpZWxkO1xuXG5cdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRyZXR1cm4gY29sID09PSBzdWJqZWN0O1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0Ly9zYXZlIGRhdGFcblx0c2F2ZSh0eXBlKXtcblx0XHR2YXIgZGF0YSA9IHt9O1xuXG5cdFx0c3dpdGNoKHR5cGUpe1xuXHRcdFx0Y2FzZSBcImNvbHVtbnNcIjpcblx0XHRcdFx0ZGF0YSA9IHRoaXMucGFyc2VDb2x1bW5zKHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb2x1bW5zKCkpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImZpbHRlclwiOlxuXHRcdFx0XHRkYXRhID0gdGhpcy50YWJsZS5tb2R1bGVzLmZpbHRlci5nZXRGaWx0ZXJzKCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwiaGVhZGVyRmlsdGVyXCI6XG5cdFx0XHRcdGRhdGEgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZmlsdGVyLmdldEhlYWRlckZpbHRlcnMoKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJzb3J0XCI6XG5cdFx0XHRcdGRhdGEgPSB0aGlzLnZhbGlkYXRlU29ydGVycyh0aGlzLnRhYmxlLm1vZHVsZXMuc29ydC5nZXRTb3J0KCkpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcImdyb3VwXCI6XG5cdFx0XHRcdGRhdGEgPSB0aGlzLmdldEdyb3VwQ29uZmlnKCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwicGFnZVwiOlxuXHRcdFx0XHRkYXRhID0gdGhpcy5nZXRQYWdlQ29uZmlnKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdGlmKHRoaXMud3JpdGVGdW5jKXtcblx0XHRcdHRoaXMud3JpdGVGdW5jKHRoaXMuaWQsIHR5cGUsIGRhdGEpO1xuXHRcdH1cblxuXHR9XG5cblx0Ly9lbnN1cmUgc29ydGVycyBjb250YWluIG5vIGZ1bmN0aW9uIGRhdGFcblx0dmFsaWRhdGVTb3J0ZXJzKGRhdGEpe1xuXHRcdGRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcblx0XHRcdGl0ZW0uY29sdW1uID0gaXRlbS5maWVsZDtcblx0XHRcdGRlbGV0ZSBpdGVtLmZpZWxkO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH1cblxuXHRnZXRHcm91cENvbmZpZygpe1xuXHRcdHZhciBkYXRhID0ge307XG5cblx0XHRpZih0aGlzLmNvbmZpZy5ncm91cCl7XG5cdFx0XHRpZih0aGlzLmNvbmZpZy5ncm91cCA9PT0gdHJ1ZSB8fCB0aGlzLmNvbmZpZy5ncm91cC5ncm91cEJ5KXtcblx0XHRcdFx0ZGF0YS5ncm91cEJ5ID0gdGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQnk7XG5cdFx0XHR9XG5cblx0XHRcdGlmKHRoaXMuY29uZmlnLmdyb3VwID09PSB0cnVlIHx8IHRoaXMuY29uZmlnLmdyb3VwLmdyb3VwU3RhcnRPcGVuKXtcblx0XHRcdFx0ZGF0YS5ncm91cFN0YXJ0T3BlbiA9IHRoaXMudGFibGUub3B0aW9ucy5ncm91cFN0YXJ0T3Blbjtcblx0XHRcdH1cblxuXHRcdFx0aWYodGhpcy5jb25maWcuZ3JvdXAgPT09IHRydWUgfHwgdGhpcy5jb25maWcuZ3JvdXAuZ3JvdXBIZWFkZXIpe1xuXHRcdFx0XHRkYXRhLmdyb3VwSGVhZGVyID0gdGhpcy50YWJsZS5vcHRpb25zLmdyb3VwSGVhZGVyO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9XG5cblx0Z2V0UGFnZUNvbmZpZygpe1xuXHRcdHZhciBkYXRhID0ge307XG5cblx0XHRpZih0aGlzLmNvbmZpZy5wYWdlKXtcblx0XHRcdGlmKHRoaXMuY29uZmlnLnBhZ2UgPT09IHRydWUgfHwgdGhpcy5jb25maWcucGFnZS5zaXplKXtcblx0XHRcdFx0ZGF0YS5wYWdpbmF0aW9uU2l6ZSA9IHRoaXMudGFibGUubW9kdWxlcy5wYWdlLmdldFBhZ2VTaXplKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmKHRoaXMuY29uZmlnLnBhZ2UgPT09IHRydWUgfHwgdGhpcy5jb25maWcucGFnZS5wYWdlKXtcblx0XHRcdFx0ZGF0YS5wYWdpbmF0aW9uSW5pdGlhbFBhZ2UgPSB0aGlzLnRhYmxlLm1vZHVsZXMucGFnZS5nZXRQYWdlKCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGE7XG5cdH1cblxuXG5cdC8vcGFyc2UgY29sdW1ucyBmb3IgZGF0YSB0byBzdG9yZVxuXHRwYXJzZUNvbHVtbnMoY29sdW1ucyl7XG5cdFx0dmFyIGRlZmluaXRpb25zID0gW10sXG5cdFx0ZXhjbHVkZWRLZXlzID0gW1wiaGVhZGVyQ29udGV4dE1lbnVcIiwgXCJoZWFkZXJNZW51XCIsIFwiY29udGV4dE1lbnVcIiwgXCJjbGlja01lbnVcIl07XG5cblx0XHRjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuXHRcdFx0dmFyIGRlZlN0b3JlID0ge30sXG5cdFx0XHRjb2xEZWYgPSBjb2x1bW4uZ2V0RGVmaW5pdGlvbigpLFxuXHRcdFx0a2V5cztcblxuXHRcdFx0aWYoY29sdW1uLmlzR3JvdXApe1xuXHRcdFx0XHRkZWZTdG9yZS50aXRsZSA9IGNvbERlZi50aXRsZTtcblx0XHRcdFx0ZGVmU3RvcmUuY29sdW1ucyA9IHRoaXMucGFyc2VDb2x1bW5zKGNvbHVtbi5nZXRDb2x1bW5zKCkpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRkZWZTdG9yZS5maWVsZCA9IGNvbHVtbi5nZXRGaWVsZCgpO1xuXG5cdFx0XHRcdGlmKHRoaXMuY29uZmlnLmNvbHVtbnMgPT09IHRydWUgfHwgdGhpcy5jb25maWcuY29sdW1ucyA9PSB1bmRlZmluZWQpe1xuXHRcdFx0XHRcdGtleXMgPSAgT2JqZWN0LmtleXMoY29sRGVmKTtcblx0XHRcdFx0XHRrZXlzLnB1c2goXCJ3aWR0aFwiKTtcblx0XHRcdFx0XHRrZXlzLnB1c2goXCJ2aXNpYmxlXCIpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0a2V5cyA9IHRoaXMuY29uZmlnLmNvbHVtbnM7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRrZXlzLmZvckVhY2goKGtleSk9Pntcblx0XHRcdFx0XHRzd2l0Y2goa2V5KXtcblx0XHRcdFx0XHRcdGNhc2UgXCJ3aWR0aFwiOlxuXHRcdFx0XHRcdFx0XHRkZWZTdG9yZS53aWR0aCA9IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdGNhc2UgXCJ2aXNpYmxlXCI6XG5cdFx0XHRcdFx0XHRcdGRlZlN0b3JlLnZpc2libGUgPSBjb2x1bW4udmlzaWJsZTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdGlmKHR5cGVvZiBjb2xEZWZba2V5XSAhPT0gXCJmdW5jdGlvblwiICYmIGV4Y2x1ZGVkS2V5cy5pbmRleE9mKGtleSkgPT09IC0xKXtcblx0XHRcdFx0XHRcdFx0XHRkZWZTdG9yZVtrZXldID0gY29sRGVmW2tleV07XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRkZWZpbml0aW9ucy5wdXNoKGRlZlN0b3JlKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBkZWZpbml0aW9ucztcblx0fVxufVxuXG5jbGFzcyBQb3B1cCBleHRlbmRzIE1vZHVsZXtcblx0XG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJwb3B1cFwiO1xuXHRcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLmNvbHVtblN1YnNjcmliZXJzID0ge307XG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicm93Q29udGV4dFBvcHVwXCIsIGZhbHNlKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJyb3dDbGlja1BvcHVwXCIsIGZhbHNlKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJyb3dEYmxDbGlja1BvcHVwXCIsIGZhbHNlKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJncm91cENvbnRleHRQb3B1cFwiLCBmYWxzZSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiZ3JvdXBDbGlja1BvcHVwXCIsIGZhbHNlKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJncm91cERibENsaWNrUG9wdXBcIiwgZmFsc2UpO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJDb250ZXh0UG9wdXBcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckNsaWNrUG9wdXBcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlckRibENsaWNrUG9wdXBcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlclBvcHVwXCIpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJQb3B1cEljb25cIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImNvbnRleHRQb3B1cFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiY2xpY2tQb3B1cFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiZGJsQ2xpY2tQb3B1cFwiKTtcblxuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcImNlbGxcIiwgXCJwb3B1cFwiLCB0aGlzLl9jb21wb25lbnRQb3B1cENhbGwuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY29sdW1uXCIsIFwicG9wdXBcIiwgdGhpcy5fY29tcG9uZW50UG9wdXBDYWxsLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcInJvd1wiLCBcInBvcHVwXCIsIHRoaXMuX2NvbXBvbmVudFBvcHVwQ2FsbC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJncm91cFwiLCBcInBvcHVwXCIsIHRoaXMuX2NvbXBvbmVudFBvcHVwQ2FsbC5iaW5kKHRoaXMpKTtcblx0XHRcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuaW5pdGlhbGl6ZVJvd1dhdGNoZXJzKCk7XG5cdFx0dGhpcy5pbml0aWFsaXplR3JvdXBXYXRjaGVycygpO1xuXHRcdFxuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWluaXRcIiwgdGhpcy5pbml0aWFsaXplQ29sdW1uLmJpbmQodGhpcykpO1xuXHR9XG5cblx0X2NvbXBvbmVudFBvcHVwQ2FsbChjb21wb25lbnQsIGNvbnRlbnRzLCBwb3NpdGlvbil7XG5cdFx0dGhpcy5sb2FkUG9wdXBFdmVudChjb250ZW50cywgbnVsbCwgY29tcG9uZW50LCBwb3NpdGlvbik7XG5cdH1cblx0XG5cdGluaXRpYWxpemVSb3dXYXRjaGVycygpe1xuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5yb3dDb250ZXh0UG9wdXApe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctY29udGV4dG1lbnVcIiwgdGhpcy5sb2FkUG9wdXBFdmVudC5iaW5kKHRoaXMsIHRoaXMudGFibGUub3B0aW9ucy5yb3dDb250ZXh0UG9wdXApKTtcblx0XHRcdHRoaXMudGFibGUub24oXCJyb3dUYXBIb2xkXCIsIHRoaXMubG9hZFBvcHVwRXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMucm93Q29udGV4dFBvcHVwKSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5yb3dDbGlja1BvcHVwKXtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWNsaWNrXCIsIHRoaXMubG9hZFBvcHVwRXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMucm93Q2xpY2tQb3B1cCkpO1xuXHRcdH1cblxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5yb3dEYmxDbGlja1BvcHVwKXtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWRibGNsaWNrXCIsIHRoaXMubG9hZFBvcHVwRXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMucm93RGJsQ2xpY2tQb3B1cCkpO1xuXHRcdH1cblx0fVxuXHRcblx0aW5pdGlhbGl6ZUdyb3VwV2F0Y2hlcnMoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBDb250ZXh0UG9wdXApe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJncm91cC1jb250ZXh0bWVudVwiLCB0aGlzLmxvYWRQb3B1cEV2ZW50LmJpbmQodGhpcywgdGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQ29udGV4dFBvcHVwKSk7XG5cdFx0XHR0aGlzLnRhYmxlLm9uKFwiZ3JvdXBUYXBIb2xkXCIsIHRoaXMubG9hZFBvcHVwRXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBDb250ZXh0UG9wdXApKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwQ2xpY2tQb3B1cCl7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImdyb3VwLWNsaWNrXCIsIHRoaXMubG9hZFBvcHVwRXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBDbGlja1BvcHVwKSk7XG5cdFx0fVxuXG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmdyb3VwRGJsQ2xpY2tQb3B1cCl7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImdyb3VwLWRibGNsaWNrXCIsIHRoaXMubG9hZFBvcHVwRXZlbnQuYmluZCh0aGlzLCB0aGlzLnRhYmxlLm9wdGlvbnMuZ3JvdXBEYmxDbGlja1BvcHVwKSk7XG5cdFx0fVxuXHR9XG5cblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdHZhciBkZWYgPSBjb2x1bW4uZGVmaW5pdGlvbjtcblx0XHRcblx0XHQvL2hhbmRsZSBjb2x1bW4gZXZlbnRzXG5cdFx0aWYoZGVmLmhlYWRlckNvbnRleHRQb3B1cCAmJiAhdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5oZWFkZXJDb250ZXh0UG9wdXApe1xuXHRcdFx0dGhpcy5jb2x1bW5TdWJzY3JpYmVycy5oZWFkZXJDb250ZXh0UG9wdXAgPSB0aGlzLmxvYWRQb3B1cFRhYmxlQ29sdW1uRXZlbnQuYmluZCh0aGlzLCBcImhlYWRlckNvbnRleHRQb3B1cFwiKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWNvbnRleHRtZW51XCIsIHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuaGVhZGVyQ29udGV4dFBvcHVwKTtcblx0XHRcdHRoaXMudGFibGUub24oXCJoZWFkZXJUYXBIb2xkXCIsIHRoaXMubG9hZFBvcHVwVGFibGVDb2x1bW5FdmVudC5iaW5kKHRoaXMsIFwiaGVhZGVyQ29udGV4dFBvcHVwXCIpKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoZGVmLmhlYWRlckNsaWNrUG9wdXAgJiYgIXRoaXMuY29sdW1uU3Vic2NyaWJlcnMuaGVhZGVyQ2xpY2tQb3B1cCl7XG5cdFx0XHR0aGlzLmNvbHVtblN1YnNjcmliZXJzLmhlYWRlckNsaWNrUG9wdXAgPSB0aGlzLmxvYWRQb3B1cFRhYmxlQ29sdW1uRXZlbnQuYmluZCh0aGlzLCBcImhlYWRlckNsaWNrUG9wdXBcIik7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1jbGlja1wiLCB0aGlzLmNvbHVtblN1YnNjcmliZXJzLmhlYWRlckNsaWNrUG9wdXApO1xuXHRcdFxuXHRcdFxuXHRcdH1pZihkZWYuaGVhZGVyRGJsQ2xpY2tQb3B1cCAmJiAhdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5oZWFkZXJEYmxDbGlja1BvcHVwKXtcblx0XHRcdHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuaGVhZGVyRGJsQ2xpY2tQb3B1cCA9IHRoaXMubG9hZFBvcHVwVGFibGVDb2x1bW5FdmVudC5iaW5kKHRoaXMsIFwiaGVhZGVyRGJsQ2xpY2tQb3B1cFwiKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWRibGNsaWNrXCIsIHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuaGVhZGVyRGJsQ2xpY2tQb3B1cCk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGRlZi5oZWFkZXJQb3B1cCl7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVDb2x1bW5IZWFkZXJQb3B1cChjb2x1bW4pO1xuXHRcdH1cblx0XHRcblx0XHQvL2hhbmRsZSBjZWxsIGV2ZW50c1xuXHRcdGlmKGRlZi5jb250ZXh0UG9wdXAgJiYgIXRoaXMuY29sdW1uU3Vic2NyaWJlcnMuY29udGV4dFBvcHVwKXtcblx0XHRcdHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuY29udGV4dFBvcHVwID0gdGhpcy5sb2FkUG9wdXBUYWJsZUNlbGxFdmVudC5iaW5kKHRoaXMsIFwiY29udGV4dFBvcHVwXCIpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLWNvbnRleHRtZW51XCIsIHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuY29udGV4dFBvcHVwKTtcblx0XHRcdHRoaXMudGFibGUub24oXCJjZWxsVGFwSG9sZFwiLCB0aGlzLmxvYWRQb3B1cFRhYmxlQ2VsbEV2ZW50LmJpbmQodGhpcywgXCJjb250ZXh0UG9wdXBcIikpO1xuXHRcdH1cblx0XHRcblx0XHRpZihkZWYuY2xpY2tQb3B1cCAmJiAhdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5jbGlja1BvcHVwKXtcblx0XHRcdHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuY2xpY2tQb3B1cCA9IHRoaXMubG9hZFBvcHVwVGFibGVDZWxsRXZlbnQuYmluZCh0aGlzLCBcImNsaWNrUG9wdXBcIik7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtY2xpY2tcIiwgdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5jbGlja1BvcHVwKTtcblx0XHR9XG5cblx0XHRpZihkZWYuZGJsQ2xpY2tQb3B1cCAmJiAhdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5kYmxDbGlja1BvcHVwKXtcblx0XHRcdHRoaXMuY29sdW1uU3Vic2NyaWJlcnMuZGJsQ2xpY2tQb3B1cCA9IHRoaXMubG9hZFBvcHVwVGFibGVDZWxsRXZlbnQuYmluZCh0aGlzLCBcImRibENsaWNrUG9wdXBcIik7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtY2xpY2tcIiwgdGhpcy5jb2x1bW5TdWJzY3JpYmVycy5kYmxDbGlja1BvcHVwKTtcblx0XHR9XG5cdH1cblx0XG5cdGluaXRpYWxpemVDb2x1bW5IZWFkZXJQb3B1cChjb2x1bW4pe1xuXHRcdHZhciBpY29uID0gY29sdW1uLmRlZmluaXRpb24uaGVhZGVyUG9wdXBJY29uLFxuXHRcdGhlYWRlclBvcHVwRWw7XG5cdFx0XG5cdFx0aGVhZGVyUG9wdXBFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXHRcdGhlYWRlclBvcHVwRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1oZWFkZXItcG9wdXAtYnV0dG9uXCIpO1xuXG5cdFx0aWYoaWNvbil7XG5cdFx0XHRpZih0eXBlb2YgaWNvbiA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0aWNvbiA9IGljb24oY29sdW1uLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblxuXHRcdFx0aWYoaWNvbiBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KXtcblx0XHRcdFx0aGVhZGVyUG9wdXBFbC5hcHBlbmRDaGlsZChpY29uKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aGVhZGVyUG9wdXBFbC5pbm5lckhUTUwgPSBpY29uO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGhlYWRlclBvcHVwRWwuaW5uZXJIVE1MID0gXCImdmVsbGlwO1wiO1xuXHRcdH1cblx0XHRcblx0XHRoZWFkZXJQb3B1cEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuXHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5sb2FkUG9wdXBFdmVudChjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJQb3B1cCwgZSwgY29sdW1uKTtcblx0XHR9KTtcblx0XHRcblx0XHRjb2x1bW4udGl0bGVFbGVtZW50Lmluc2VydEJlZm9yZShoZWFkZXJQb3B1cEVsLCBjb2x1bW4udGl0bGVFbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHR9XG5cdFxuXHRsb2FkUG9wdXBUYWJsZUNlbGxFdmVudChvcHRpb24sIGUsIGNlbGwpe1xuXHRcdGlmKGNlbGwuX2NlbGwpe1xuXHRcdFx0Y2VsbCA9IGNlbGwuX2NlbGw7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGNlbGwuY29sdW1uLmRlZmluaXRpb25bb3B0aW9uXSl7XG5cdFx0XHR0aGlzLmxvYWRQb3B1cEV2ZW50KGNlbGwuY29sdW1uLmRlZmluaXRpb25bb3B0aW9uXSwgZSwgY2VsbCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRsb2FkUG9wdXBUYWJsZUNvbHVtbkV2ZW50KG9wdGlvbiwgZSwgY29sdW1uKXtcblx0XHRpZihjb2x1bW4uX2NvbHVtbil7XG5cdFx0XHRjb2x1bW4gPSBjb2x1bW4uX2NvbHVtbjtcblx0XHR9XG5cdFx0XG5cdFx0aWYoY29sdW1uLmRlZmluaXRpb25bb3B0aW9uXSl7XG5cdFx0XHR0aGlzLmxvYWRQb3B1cEV2ZW50KGNvbHVtbi5kZWZpbml0aW9uW29wdGlvbl0sIGUsIGNvbHVtbik7XG5cdFx0fVxuXHR9XG5cdFxuXHRsb2FkUG9wdXBFdmVudChjb250ZW50cywgZSwgY29tcG9uZW50LCBwb3NpdGlvbil7XG5cdFx0dmFyIHJlbmRlcmVkQ2FsbGJhY2s7XG5cblx0XHRmdW5jdGlvbiBvblJlbmRlcmVkKGNhbGxiYWNrKXtcblx0XHRcdHJlbmRlcmVkQ2FsbGJhY2sgPSBjYWxsYmFjaztcblx0XHR9XG5cdFx0XG5cdFx0aWYoY29tcG9uZW50Ll9ncm91cCl7XG5cdFx0XHRjb21wb25lbnQgPSBjb21wb25lbnQuX2dyb3VwO1xuXHRcdH1lbHNlIGlmKGNvbXBvbmVudC5fcm93KXtcblx0XHRcdGNvbXBvbmVudCA9IGNvbXBvbmVudC5fcm93O1xuXHRcdH1cblx0XHRcblx0XHRjb250ZW50cyA9IHR5cGVvZiBjb250ZW50cyA9PSBcImZ1bmN0aW9uXCIgPyBjb250ZW50cy5jYWxsKHRoaXMudGFibGUsIGUsIGNvbXBvbmVudC5nZXRDb21wb25lbnQoKSwgIG9uUmVuZGVyZWQpIDogY29udGVudHM7XG5cdFx0XG5cdFx0dGhpcy5sb2FkUG9wdXAoZSwgY29tcG9uZW50LCBjb250ZW50cywgcmVuZGVyZWRDYWxsYmFjaywgcG9zaXRpb24pO1xuXHR9XG5cdFxuXHRsb2FkUG9wdXAoZSwgY29tcG9uZW50LCBjb250ZW50cywgcmVuZGVyZWRDYWxsYmFjaywgcG9zaXRpb24pe1xuXHRcdHZhciB0b3VjaCA9ICEoZSBpbnN0YW5jZW9mIE1vdXNlRXZlbnQpLFxuXHRcdGNvbnRlbnRzRWwsIHBvcHVwO1xuXHRcdFxuXHRcdGlmKGNvbnRlbnRzIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpe1xuXHRcdFx0Y29udGVudHNFbCA9IGNvbnRlbnRzO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnRlbnRzRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0Y29udGVudHNFbC5pbm5lckhUTUwgPSBjb250ZW50cztcblx0XHR9XG5cdFx0XG5cdFx0Y29udGVudHNFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXBvcHVwXCIpO1xuXG5cdFx0Y29udGVudHNFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+e1xuXHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHR9KTtcblxuXHRcdGlmKCF0b3VjaCl7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fVxuXHRcdFxuXHRcdHBvcHVwID0gdGhpcy5wb3B1cChjb250ZW50c0VsKTtcblxuXHRcdGlmKHR5cGVvZiByZW5kZXJlZENhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0cG9wdXAucmVuZGVyQ2FsbGJhY2socmVuZGVyZWRDYWxsYmFjayk7XG5cdFx0fVxuXG5cdFx0aWYoZSl7XG5cdFx0XHRwb3B1cC5zaG93KGUpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHBvcHVwLnNob3coY29tcG9uZW50LmdldEVsZW1lbnQoKSwgcG9zaXRpb24gfHwgXCJjZW50ZXJcIik7XG5cdFx0fVxuXG5cdFx0XG5cdFx0cG9wdXAuaGlkZU9uQmx1cigoKSA9PiB7XG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJwb3B1cENsb3NlZFwiLCBjb21wb25lbnQuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicG9wdXBPcGVuZWRcIiwgY29tcG9uZW50LmdldENvbXBvbmVudCgpKTtcblx0fVxufVxuXG5jbGFzcyBQcmludCBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwicHJpbnRcIjtcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy5lbGVtZW50ID0gZmFsc2U7XG5cdFx0dGhpcy5tYW51YWxCbG9jayA9IGZhbHNlO1xuXHRcdHRoaXMuYmVmb3JlcHJpbnRFdmVudEhhbmRsZXIgPSBudWxsO1xuXHRcdHRoaXMuYWZ0ZXJwcmludEV2ZW50SGFuZGxlciA9IG51bGw7XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwcmludEFzSHRtbFwiLCBmYWxzZSk7IC8vZW5hYmxlIHByaW50IGFzIGh0bWxcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwcmludEZvcm1hdHRlclwiLCBmYWxzZSk7IC8vcHJpbnRpbmcgcGFnZSBmb3JtYXR0ZXJcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwcmludEhlYWRlclwiLCBmYWxzZSk7IC8vcGFnZSBoZWFkZXIgY29udGVudHNcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwcmludEZvb3RlclwiLCBmYWxzZSk7IC8vcGFnZSBmb290ZXIgY29udGVudHNcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwcmludFN0eWxlZFwiLCB0cnVlKTsgLy9lbmFibGUgcHJpbnQgYXMgaHRtbCBzdHlsaW5nXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicHJpbnRSb3dSYW5nZVwiLCBcInZpc2libGVcIik7IC8vcmVzdHJpY3QgcHJpbnQgdG8gdmlzaWJsZSByb3dzIG9ubHlcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJwcmludENvbmZpZ1wiLCB7fSk7IC8vcHJpbnQgY29uZmlnIG9wdGlvbnNcblxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJwcmludFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwidGl0bGVQcmludFwiKTtcblx0fVxuXG5cdGluaXRpYWxpemUoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRBc0h0bWwpe1xuXHRcdFx0dGhpcy5iZWZvcmVwcmludEV2ZW50SGFuZGxlciA9IHRoaXMucmVwbGFjZVRhYmxlLmJpbmQodGhpcyk7XG5cdFx0XHR0aGlzLmFmdGVycHJpbnRFdmVudEhhbmRsZXIgPSB0aGlzLmNsZWFudXAuYmluZCh0aGlzKTtcblxuXHRcdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJiZWZvcmVwcmludFwiLCB0aGlzLmJlZm9yZXByaW50RXZlbnRIYW5kbGVyICk7XG5cdFx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImFmdGVycHJpbnRcIiwgdGhpcy5hZnRlcnByaW50RXZlbnRIYW5kbGVyKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtZGVzdHJveVwiLCB0aGlzLmRlc3Ryb3kuYmluZCh0aGlzKSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJwcmludFwiLCB0aGlzLnByaW50RnVsbHNjcmVlbi5iaW5kKHRoaXMpKTtcblx0fVxuXG5cdGRlc3Ryb3koKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRBc0h0bWwpe1xuXHRcdFx0d2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoIFwiYmVmb3JlcHJpbnRcIiwgdGhpcy5iZWZvcmVwcmludEV2ZW50SGFuZGxlciApO1xuXHRcdFx0d2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoIFwiYWZ0ZXJwcmludFwiLCB0aGlzLmFmdGVycHJpbnRFdmVudEhhbmRsZXIgKTtcblx0XHR9XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gVGFibGUgRnVuY3Rpb25zIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBJbnRlcm5hbCBMb2dpYyAvLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0cmVwbGFjZVRhYmxlKCl7XG5cdFx0aWYoIXRoaXMubWFudWFsQmxvY2spe1xuXHRcdFx0dGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LXRhYmxlXCIpO1xuXG5cdFx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy50YWJsZS5tb2R1bGVzLmV4cG9ydC5nZW5lcmF0ZVRhYmxlKHRoaXMudGFibGUub3B0aW9ucy5wcmludENvbmZpZywgdGhpcy50YWJsZS5vcHRpb25zLnByaW50U3R5bGVkLCB0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRSb3dSYW5nZSwgXCJwcmludFwiKSk7XG5cblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLmVsZW1lbnQsIHRoaXMudGFibGUuZWxlbWVudCk7XG5cdFx0fVxuXHR9XG5cblx0Y2xlYW51cCgpe1xuXHRcdGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1wcmludC1mdWxsc2NyZWVuLWhpZGVcIik7XG5cblx0XHRpZih0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUpe1xuXHRcdFx0dGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTtcblx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblx0XHR9XG5cdH1cblxuXHRwcmludEZ1bGxzY3JlZW4odmlzaWJsZSwgc3R5bGUsIGNvbmZpZyl7XG5cdFx0dmFyIHNjcm9sbFggPSB3aW5kb3cuc2Nyb2xsWCxcblx0XHRzY3JvbGxZID0gd2luZG93LnNjcm9sbFksXG5cdFx0aGVhZGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuXHRcdGZvb3RlckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcblx0XHR0YWJsZUVsID0gdGhpcy50YWJsZS5tb2R1bGVzLmV4cG9ydC5nZW5lcmF0ZVRhYmxlKHR5cGVvZiBjb25maWcgIT0gXCJ1bmRlZmluZWRcIiA/IGNvbmZpZyA6IHRoaXMudGFibGUub3B0aW9ucy5wcmludENvbmZpZywgdHlwZW9mIHN0eWxlICE9IFwidW5kZWZpbmVkXCIgPyBzdHlsZSA6IHRoaXMudGFibGUub3B0aW9ucy5wcmludFN0eWxlZCwgdmlzaWJsZSB8fCB0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRSb3dSYW5nZSwgXCJwcmludFwiKSxcblx0XHRoZWFkZXJDb250ZW50LCBmb290ZXJDb250ZW50O1xuXG5cdFx0dGhpcy5tYW51YWxCbG9jayA9IHRydWU7XG5cblx0XHR0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LWZ1bGxzY3JlZW5cIik7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRIZWFkZXIpe1xuXHRcdFx0aGVhZGVyRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wcmludC1oZWFkZXJcIik7XG5cblx0XHRcdGhlYWRlckNvbnRlbnQgPSB0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLnByaW50SGVhZGVyID09IFwiZnVuY3Rpb25cIiA/IHRoaXMudGFibGUub3B0aW9ucy5wcmludEhlYWRlci5jYWxsKHRoaXMudGFibGUpIDogdGhpcy50YWJsZS5vcHRpb25zLnByaW50SGVhZGVyO1xuXG5cdFx0XHRpZih0eXBlb2YgaGVhZGVyQ29udGVudCA9PSBcInN0cmluZ1wiKXtcblx0XHRcdFx0aGVhZGVyRWwuaW5uZXJIVE1MID0gaGVhZGVyQ29udGVudDtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aGVhZGVyRWwuYXBwZW5kQ2hpbGQoaGVhZGVyQ29udGVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChoZWFkZXJFbCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRhYmxlRWwpO1xuXG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnByaW50Rm9vdGVyKXtcblx0XHRcdGZvb3RlckVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcHJpbnQtZm9vdGVyXCIpO1xuXG5cdFx0XHRmb290ZXJDb250ZW50ID0gdHlwZW9mIHRoaXMudGFibGUub3B0aW9ucy5wcmludEZvb3RlciA9PSBcImZ1bmN0aW9uXCIgPyB0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRGb290ZXIuY2FsbCh0aGlzLnRhYmxlKSA6IHRoaXMudGFibGUub3B0aW9ucy5wcmludEZvb3RlcjtcblxuXG5cdFx0XHRpZih0eXBlb2YgZm9vdGVyQ29udGVudCA9PSBcInN0cmluZ1wiKXtcblx0XHRcdFx0Zm9vdGVyRWwuaW5uZXJIVE1MID0gZm9vdGVyQ29udGVudDtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Zm9vdGVyRWwuYXBwZW5kQ2hpbGQoZm9vdGVyQ29udGVudCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChmb290ZXJFbCk7XG5cdFx0fVxuXG5cdFx0ZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXByaW50LWZ1bGxzY3JlZW4taGlkZVwiKTtcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucHJpbnRGb3JtYXR0ZXIpe1xuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnByaW50Rm9ybWF0dGVyKHRoaXMuZWxlbWVudCwgdGFibGVFbCk7XG5cdFx0fVxuXG5cdFx0d2luZG93LnByaW50KCk7XG5cblx0XHR0aGlzLmNsZWFudXAoKTtcblxuXHRcdHdpbmRvdy5zY3JvbGxUbyhzY3JvbGxYLCBzY3JvbGxZKTtcblxuXHRcdHRoaXMubWFudWFsQmxvY2sgPSBmYWxzZTtcblx0fVxufVxuXG5jbGFzcyBSZWFjdGl2ZURhdGEgZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcInJlYWN0aXZlRGF0YVwiO1xuXHRcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLmRhdGEgPSBmYWxzZTtcblx0XHR0aGlzLmJsb2NrZWQgPSBmYWxzZTsgLy9ibG9jayByZWFjdGl2aXR5IHdoaWxlIHBlcmZvcm1pbmcgdXBkYXRlXG5cdFx0dGhpcy5vcmlnRnVuY3MgPSB7fTsgLy8gaG9sZCBvcmlnaW5hbCBkYXRhIGFycmF5IGZ1bmN0aW9ucyB0byBhbGxvdyByZXBsYWNlbWVudCBhZnRlciBkYXRhIGlzIGRvbmUgd2l0aFxuXHRcdHRoaXMuY3VycmVudFZlcnNpb24gPSAwO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInJlYWN0aXZlRGF0YVwiLCBmYWxzZSk7IC8vZW5hYmxlIGRhdGEgcmVhY3Rpdml0eVxuXHR9XG5cdFxuXHRpbml0aWFsaXplKCl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnJlYWN0aXZlRGF0YSl7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtdmFsdWUtc2F2ZS1iZWZvcmVcIiwgdGhpcy5ibG9jay5iaW5kKHRoaXMsIFwiY2VsbHNhdmVcIikpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLXZhbHVlLXNhdmUtYWZ0ZXJcIiwgdGhpcy51bmJsb2NrLmJpbmQodGhpcywgXCJjZWxsc2F2ZVwiKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1kYXRhLXNhdmUtYmVmb3JlXCIsIHRoaXMuYmxvY2suYmluZCh0aGlzLCBcInJvd3NhdmVcIikpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctZGF0YS1zYXZlLWFmdGVyXCIsIHRoaXMudW5ibG9jay5iaW5kKHRoaXMsIFwicm93c2F2ZVwiKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1kYXRhLWluaXQtYWZ0ZXJcIiwgdGhpcy53YXRjaFJvdy5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiZGF0YS1wcm9jZXNzaW5nXCIsIHRoaXMud2F0Y2hEYXRhLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJ0YWJsZS1kZXN0cm95XCIsIHRoaXMudW53YXRjaERhdGEuYmluZCh0aGlzKSk7XG5cdFx0fVxuXHR9XG5cdFxuXHR3YXRjaERhdGEoZGF0YSl7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdHZlcnNpb247XG5cdFx0XG5cdFx0dGhpcy5jdXJyZW50VmVyc2lvbiArKztcblx0XHRcblx0XHR2ZXJzaW9uID0gdGhpcy5jdXJyZW50VmVyc2lvbjtcblx0XHRcblx0XHR0aGlzLnVud2F0Y2hEYXRhKCk7XG5cdFx0XG5cdFx0dGhpcy5kYXRhID0gZGF0YTtcblx0XHRcblx0XHQvL292ZXJyaWRlIGFycmF5IHB1c2ggZnVuY3Rpb25cblx0XHR0aGlzLm9yaWdGdW5jcy5wdXNoID0gZGF0YS5wdXNoO1xuXHRcdFxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmRhdGEsIFwicHVzaFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbigpe1xuXHRcdFx0XHR2YXIgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzKSxcblx0XHRcdFx0cmVzdWx0O1xuXG5cdFx0XHRcdGlmKCFzZWxmLmJsb2NrZWQgJiYgdmVyc2lvbiA9PT0gc2VsZi5jdXJyZW50VmVyc2lvbil7XHRcblx0XHRcdFx0XHRzZWxmLmJsb2NrKFwiZGF0YS1wdXNoXCIpO1xuXG5cdFx0XHRcdFx0YXJncy5mb3JFYWNoKChhcmcpID0+IHtcblx0XHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5hZGRSb3dBY3R1YWwoYXJnLCBmYWxzZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cmVzdWx0ID0gc2VsZi5vcmlnRnVuY3MucHVzaC5hcHBseShkYXRhLCBhcmd1bWVudHMpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHNlbGYudW5ibG9jayhcImRhdGEtcHVzaFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHQvL292ZXJyaWRlIGFycmF5IHVuc2hpZnQgZnVuY3Rpb25cblx0XHR0aGlzLm9yaWdGdW5jcy51bnNoaWZ0ID0gZGF0YS51bnNoaWZ0O1xuXHRcdFxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmRhdGEsIFwidW5zaGlmdFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbigpe1xuXHRcdFx0XHR2YXIgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzKSxcblx0XHRcdFx0cmVzdWx0O1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKXtcblx0XHRcdFx0XHRzZWxmLmJsb2NrKFwiZGF0YS11bnNoaWZ0XCIpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGFyZ3MuZm9yRWFjaCgoYXJnKSA9PiB7XG5cdFx0XHRcdFx0XHRzZWxmLnRhYmxlLnJvd01hbmFnZXIuYWRkUm93QWN0dWFsKGFyZywgdHJ1ZSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cmVzdWx0ID0gc2VsZi5vcmlnRnVuY3MudW5zaGlmdC5hcHBseShkYXRhLCBhcmd1bWVudHMpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHNlbGYudW5ibG9jayhcImRhdGEtdW5zaGlmdFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRcblx0XHQvL292ZXJyaWRlIGFycmF5IHNoaWZ0IGZ1bmN0aW9uXG5cdFx0dGhpcy5vcmlnRnVuY3Muc2hpZnQgPSBkYXRhLnNoaWZ0O1xuXHRcdFxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmRhdGEsIFwic2hpZnRcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0XHRjb25maWd1cmFibGU6IHRydWUsXG5cdFx0XHR2YWx1ZTogZnVuY3Rpb24oKXtcblx0XHRcdFx0dmFyIHJvdywgcmVzdWx0O1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKXtcblx0XHRcdFx0XHRzZWxmLmJsb2NrKFwiZGF0YS1zaGlmdFwiKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZihzZWxmLmRhdGEubGVuZ3RoKXtcblx0XHRcdFx0XHRcdHJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXRSb3dGcm9tRGF0YU9iamVjdChzZWxmLmRhdGFbMF0pO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZihyb3cpe1xuXHRcdFx0XHRcdFx0XHRyb3cuZGVsZXRlQWN0dWFsKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmVzdWx0ID0gc2VsZi5vcmlnRnVuY3Muc2hpZnQuY2FsbChkYXRhKTtcblxuXHRcdFx0XHRcdHNlbGYudW5ibG9jayhcImRhdGEtc2hpZnRcIik7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0Ly9vdmVycmlkZSBhcnJheSBwb3AgZnVuY3Rpb25cblx0XHR0aGlzLm9yaWdGdW5jcy5wb3AgPSBkYXRhLnBvcDtcblx0XHRcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5kYXRhLCBcInBvcFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbigpe1xuXHRcdFx0XHR2YXIgcm93LCByZXN1bHQ7XG5cdFx0XHRcblx0XHRcdFx0aWYoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKXtcblx0XHRcdFx0XHRzZWxmLmJsb2NrKFwiZGF0YS1wb3BcIik7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYoc2VsZi5kYXRhLmxlbmd0aCl7XG5cdFx0XHRcdFx0XHRyb3cgPSBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93RnJvbURhdGFPYmplY3Qoc2VsZi5kYXRhW3NlbGYuZGF0YS5sZW5ndGggLSAxXSk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmKHJvdyl7XG5cdFx0XHRcdFx0XHRcdHJvdy5kZWxldGVBY3R1YWwoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXN1bHQgPSBzZWxmLm9yaWdGdW5jcy5wb3AuY2FsbChkYXRhKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRzZWxmLnVuYmxvY2soXCJkYXRhLXBvcFwiKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0XG5cdFx0Ly9vdmVycmlkZSBhcnJheSBzcGxpY2UgZnVuY3Rpb25cblx0XHR0aGlzLm9yaWdGdW5jcy5zcGxpY2UgPSBkYXRhLnNwbGljZTtcblx0XHRcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5kYXRhLCBcInNwbGljZVwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdHZhbHVlOiBmdW5jdGlvbigpe1xuXHRcdFx0XHR2YXIgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzKSxcblx0XHRcdFx0c3RhcnQgPSBhcmdzWzBdIDwgMCA/IGRhdGEubGVuZ3RoICsgYXJnc1swXSA6IGFyZ3NbMF0sXG5cdFx0XHRcdGVuZCA9IGFyZ3NbMV0sXG5cdFx0XHRcdG5ld1Jvd3MgPSBhcmdzWzJdID8gYXJncy5zbGljZSgyKSA6IGZhbHNlLFxuXHRcdFx0XHRzdGFydFJvdywgcmVzdWx0O1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKXtcblx0XHRcdFx0XHRzZWxmLmJsb2NrKFwiZGF0YS1zcGxpY2VcIik7XG5cdFx0XHRcdFx0Ly9hZGQgbmV3IHJvd3Ncblx0XHRcdFx0XHRpZihuZXdSb3dzKXtcblx0XHRcdFx0XHRcdHN0YXJ0Um93ID0gZGF0YVtzdGFydF0gPyBzZWxmLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93RnJvbURhdGFPYmplY3QoZGF0YVtzdGFydF0pIDogZmFsc2U7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmKHN0YXJ0Um93KXtcblx0XHRcdFx0XHRcdFx0bmV3Um93cy5mb3JFYWNoKChyb3dEYXRhKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLmFkZFJvd0FjdHVhbChyb3dEYXRhLCB0cnVlLCBzdGFydFJvdywgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0XHRuZXdSb3dzID0gbmV3Um93cy5zbGljZSgpLnJldmVyc2UoKTtcblx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdG5ld1Jvd3MuZm9yRWFjaCgocm93RGF0YSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYudGFibGUucm93TWFuYWdlci5hZGRSb3dBY3R1YWwocm93RGF0YSwgdHJ1ZSwgZmFsc2UsIHRydWUpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0Ly9kZWxldGUgcmVtb3ZlZCByb3dzXG5cdFx0XHRcdFx0aWYoZW5kICE9PSAwKXtcblx0XHRcdFx0XHRcdHZhciBvbGRSb3dzID0gZGF0YS5zbGljZShzdGFydCwgdHlwZW9mIGFyZ3NbMV0gPT09IFwidW5kZWZpbmVkXCIgPyBhcmdzWzFdIDogc3RhcnQgKyBlbmQpO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRvbGRSb3dzLmZvckVhY2goKHJvd0RhdGEsIGkpID0+IHtcblx0XHRcdFx0XHRcdFx0dmFyIHJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5nZXRSb3dGcm9tRGF0YU9iamVjdChyb3dEYXRhKTtcblx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdGlmKHJvdyl7XG5cdFx0XHRcdFx0XHRcdFx0cm93LmRlbGV0ZUFjdHVhbChpICE9PSBvbGRSb3dzLmxlbmd0aCAtIDEpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYobmV3Um93cyB8fCBlbmQgIT09IDApe1xuXHRcdFx0XHRcdFx0c2VsZi50YWJsZS5yb3dNYW5hZ2VyLnJlUmVuZGVySW5Qb3NpdGlvbigpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJlc3VsdCA9IHNlbGYub3JpZ0Z1bmNzLnNwbGljZS5hcHBseShkYXRhLCBhcmd1bWVudHMpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHNlbGYudW5ibG9jayhcImRhdGEtc3BsaWNlXCIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRyZXR1cm4gcmVzdWx0IDtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHRcblx0dW53YXRjaERhdGEoKXtcblx0XHRpZih0aGlzLmRhdGEgIT09IGZhbHNlKXtcblx0XHRcdGZvcih2YXIga2V5IGluIHRoaXMub3JpZ0Z1bmNzKXtcblx0XHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMuZGF0YSwga2V5LCB7XG5cdFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcblx0XHRcdFx0XHRjb25maWd1cmFibGU6dHJ1ZSxcblx0XHRcdFx0XHR3cml0YWJsZTp0cnVlLFxuXHRcdFx0XHRcdHZhbHVlOiB0aGlzLm9yaWdGdW5jcy5rZXksXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0d2F0Y2hSb3cocm93KXtcblx0XHR2YXIgZGF0YSA9IHJvdy5nZXREYXRhKCk7XG5cdFx0XG5cdFx0Zm9yKHZhciBrZXkgaW4gZGF0YSl7XG5cdFx0XHR0aGlzLndhdGNoS2V5KHJvdywgZGF0YSwga2V5KTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmRhdGFUcmVlKXtcblx0XHRcdHRoaXMud2F0Y2hUcmVlQ2hpbGRyZW4ocm93KTtcblx0XHR9XG5cdH1cblx0XG5cdHdhdGNoVHJlZUNoaWxkcmVuIChyb3cpe1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRjaGlsZEZpZWxkID0gcm93LmdldERhdGEoKVt0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWVDaGlsZEZpZWxkXSxcblx0XHRvcmlnRnVuY3MgPSB7fTtcblx0XHRcblx0XHRpZihjaGlsZEZpZWxkKXtcblx0XHRcdFxuXHRcdFx0b3JpZ0Z1bmNzLnB1c2ggPSBjaGlsZEZpZWxkLnB1c2g7XG5cdFx0XHRcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjaGlsZEZpZWxkLCBcInB1c2hcIiwge1xuXHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlLFxuXHRcdFx0XHR2YWx1ZTogKCkgPT4ge1xuXHRcdFx0XHRcdGlmKCFzZWxmLmJsb2NrZWQpe1xuXHRcdFx0XHRcdFx0c2VsZi5ibG9jayhcInRyZWUtcHVzaFwiKTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0dmFyIHJlc3VsdCA9IG9yaWdGdW5jcy5wdXNoLmFwcGx5KGNoaWxkRmllbGQsIGFyZ3VtZW50cyk7XG5cdFx0XHRcdFx0XHR0aGlzLnJlYnVpbGRUcmVlKHJvdyk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHNlbGYudW5ibG9jayhcInRyZWUtcHVzaFwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdG9yaWdGdW5jcy51bnNoaWZ0ID0gY2hpbGRGaWVsZC51bnNoaWZ0O1xuXHRcdFx0XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoY2hpbGRGaWVsZCwgXCJ1bnNoaWZ0XCIsIHtcblx0XHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdFx0dmFsdWU6ICgpID0+IHtcblx0XHRcdFx0XHRpZighc2VsZi5ibG9ja2VkKXtcblx0XHRcdFx0XHRcdHNlbGYuYmxvY2soXCJ0cmVlLXVuc2hpZnRcIik7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHZhciByZXN1bHQgPSAgb3JpZ0Z1bmNzLnVuc2hpZnQuYXBwbHkoY2hpbGRGaWVsZCwgYXJndW1lbnRzKTtcblx0XHRcdFx0XHRcdHRoaXMucmVidWlsZFRyZWUocm93KTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0c2VsZi51bmJsb2NrKFwidHJlZS11bnNoaWZ0XCIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0b3JpZ0Z1bmNzLnNoaWZ0ID0gY2hpbGRGaWVsZC5zaGlmdDtcblx0XHRcdFxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGNoaWxkRmllbGQsIFwic2hpZnRcIiwge1xuXHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcblx0XHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlLFxuXHRcdFx0XHR2YWx1ZTogKCkgPT4ge1xuXHRcdFx0XHRcdGlmKCFzZWxmLmJsb2NrZWQpe1xuXHRcdFx0XHRcdFx0c2VsZi5ibG9jayhcInRyZWUtc2hpZnRcIik7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHZhciByZXN1bHQgPSAgb3JpZ0Z1bmNzLnNoaWZ0LmNhbGwoY2hpbGRGaWVsZCk7XG5cdFx0XHRcdFx0XHR0aGlzLnJlYnVpbGRUcmVlKHJvdyk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHNlbGYudW5ibG9jayhcInRyZWUtc2hpZnRcIik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRvcmlnRnVuY3MucG9wID0gY2hpbGRGaWVsZC5wb3A7XG5cdFx0XHRcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjaGlsZEZpZWxkLCBcInBvcFwiLCB7XG5cdFx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxuXHRcdFx0XHRjb25maWd1cmFibGU6IHRydWUsXG5cdFx0XHRcdHZhbHVlOiAoKSA9PiB7XG5cdFx0XHRcdFx0aWYoIXNlbGYuYmxvY2tlZCl7XG5cdFx0XHRcdFx0XHRzZWxmLmJsb2NrKFwidHJlZS1wb3BcIik7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHZhciByZXN1bHQgPSAgb3JpZ0Z1bmNzLnBvcC5jYWxsKGNoaWxkRmllbGQpO1xuXHRcdFx0XHRcdFx0dGhpcy5yZWJ1aWxkVHJlZShyb3cpO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRzZWxmLnVuYmxvY2soXCJ0cmVlLXBvcFwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdG9yaWdGdW5jcy5zcGxpY2UgPSBjaGlsZEZpZWxkLnNwbGljZTtcblx0XHRcdFxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGNoaWxkRmllbGQsIFwic3BsaWNlXCIsIHtcblx0XHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0XHRcdGNvbmZpZ3VyYWJsZTogdHJ1ZSxcblx0XHRcdFx0dmFsdWU6ICgpID0+IHtcblx0XHRcdFx0XHRpZighc2VsZi5ibG9ja2VkKXtcblx0XHRcdFx0XHRcdHNlbGYuYmxvY2soXCJ0cmVlLXNwbGljZVwiKTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0dmFyIHJlc3VsdCA9ICBvcmlnRnVuY3Muc3BsaWNlLmFwcGx5KGNoaWxkRmllbGQsIGFyZ3VtZW50cyk7XG5cdFx0XHRcdFx0XHR0aGlzLnJlYnVpbGRUcmVlKHJvdyk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHNlbGYudW5ibG9jayhcInRyZWUtc3BsaWNlXCIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblx0XG5cdHJlYnVpbGRUcmVlKHJvdyl7XG5cdFx0dGhpcy50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmluaXRpYWxpemVSb3cocm93KTtcblx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZGF0YVRyZWUubGF5b3V0Um93KHJvdyk7XG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlZnJlc2hBY3RpdmVEYXRhKFwidHJlZVwiLCBmYWxzZSwgdHJ1ZSk7XG5cdH1cblx0XG5cdHdhdGNoS2V5KHJvdywgZGF0YSwga2V5KXtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0cHJvcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGRhdGEsIGtleSksXG5cdFx0dmFsdWUgPSBkYXRhW2tleV0sXG5cdFx0dmVyc2lvbiA9IHRoaXMuY3VycmVudFZlcnNpb247XG5cdFx0XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGRhdGEsIGtleSwge1xuXHRcdFx0c2V0OiAobmV3VmFsdWUpID0+IHtcblx0XHRcdFx0dmFsdWUgPSBuZXdWYWx1ZTtcblx0XHRcdFx0aWYoIXNlbGYuYmxvY2tlZCAmJiB2ZXJzaW9uID09PSBzZWxmLmN1cnJlbnRWZXJzaW9uKXtcblx0XHRcdFx0XHRzZWxmLmJsb2NrKFwia2V5XCIpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHZhciB1cGRhdGUgPSB7fTtcblx0XHRcdFx0XHR1cGRhdGVba2V5XSA9IG5ld1ZhbHVlO1xuXHRcdFx0XHRcdHJvdy51cGRhdGVEYXRhKHVwZGF0ZSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0c2VsZi51bmJsb2NrKFwia2V5XCIpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihwcm9wcy5zZXQpe1xuXHRcdFx0XHRcdHByb3BzLnNldChuZXdWYWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHRnZXQ6KCkgPT4ge1xuXHRcdFx0XHRcblx0XHRcdFx0aWYocHJvcHMuZ2V0KXtcblx0XHRcdFx0XHRwcm9wcy5nZXQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHR1bndhdGNoUm93KHJvdyl7XG5cdFx0dmFyIGRhdGEgPSByb3cuZ2V0RGF0YSgpO1xuXHRcdFxuXHRcdGZvcih2YXIga2V5IGluIGRhdGEpe1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGRhdGEsIGtleSwge1xuXHRcdFx0XHR2YWx1ZTpkYXRhW2tleV0sXG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblx0XG5cdGJsb2NrKGtleSl7XG5cdFx0aWYoIXRoaXMuYmxvY2tlZCl7XG5cdFx0XHR0aGlzLmJsb2NrZWQgPSBrZXk7XG5cdFx0fVxuXHR9XG5cdFxuXHR1bmJsb2NrKGtleSl7XG5cdFx0aWYodGhpcy5ibG9ja2VkID09PSBrZXkpe1xuXHRcdFx0dGhpcy5ibG9ja2VkID0gZmFsc2U7XG5cdFx0fVxuXHR9XG59XG5cbmNsYXNzIFJlc2l6ZUNvbHVtbnMgZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcInJlc2l6ZUNvbHVtbnNcIjtcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMuc3RhcnRDb2x1bW4gPSBmYWxzZTtcblx0XHR0aGlzLnN0YXJ0WCA9IGZhbHNlO1xuXHRcdHRoaXMuc3RhcnRXaWR0aCA9IGZhbHNlO1xuXHRcdHRoaXMubGF0ZXN0WCA9IGZhbHNlO1xuXHRcdHRoaXMuaGFuZGxlID0gbnVsbDtcblx0XHR0aGlzLmluaXRpYWxOZXh0Q29sdW1uID0gbnVsbDtcblx0XHR0aGlzLm5leHRDb2x1bW4gPSBudWxsO1xuXHRcdFxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwicmVzaXphYmxlXCIsIHRydWUpO1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInJlc2l6YWJsZUNvbHVtbkZpdFwiLCBmYWxzZSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicmVzaXphYmxlQ29sdW1uR3VpZGVcIiwgZmFsc2UpO1xuXHR9XG5cdFxuXHRpbml0aWFsaXplKCl7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tcmVuZGVyZWRcIiwgdGhpcy5sYXlvdXRDb2x1bW5IZWFkZXIuYmluZCh0aGlzKSk7XG5cdH1cblx0XG5cdGluaXRpYWxpemVFdmVudFdhdGNoZXJzKCl7XG5cdFx0aWYoIXRoaXMuaW5pdGlhbGl6ZWQpe1xuXHRcdFx0XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtcmVuZGVyZWRcIiwgdGhpcy5sYXlvdXRDZWxsSGFuZGxlcy5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1kZWxldGVcIiwgdGhpcy5kZUluaXRpYWxpemVDb21wb25lbnQuYmluZCh0aGlzKSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1oZWlnaHRcIiwgdGhpcy5yZXNpemVIYW5kbGUuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1tb3ZlZFwiLCB0aGlzLmNvbHVtbkxheW91dFVwZGF0ZWQuYmluZCh0aGlzKSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWhpZGVcIiwgdGhpcy5kZUluaXRpYWxpemVDb2x1bW4uYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1zaG93XCIsIHRoaXMuY29sdW1uTGF5b3V0VXBkYXRlZC5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLXdpZHRoXCIsIHRoaXMuY29sdW1uV2lkdGhVcGRhdGVkLmJpbmQodGhpcykpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1kZWxldGVcIiwgdGhpcy5kZUluaXRpYWxpemVDb21wb25lbnQuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1oZWlnaHRcIiwgdGhpcy5yZXNpemVIYW5kbGUuYmluZCh0aGlzKSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdH1cblx0fVxuXHRcblx0XG5cdGxheW91dENlbGxIYW5kbGVzKGNlbGwpe1xuXHRcdGlmKGNlbGwucm93LnR5cGUgPT09IFwicm93XCIpe1xuXHRcdFx0dGhpcy5kZUluaXRpYWxpemVDb21wb25lbnQoY2VsbCk7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVDb2x1bW4oXCJjZWxsXCIsIGNlbGwsIGNlbGwuY29sdW1uLCBjZWxsLmVsZW1lbnQpO1xuXHRcdH1cblx0fVxuXHRcblx0bGF5b3V0Q29sdW1uSGVhZGVyKGNvbHVtbil7XG5cdFx0aWYoY29sdW1uLmRlZmluaXRpb24ucmVzaXphYmxlKXtcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZUV2ZW50V2F0Y2hlcnMoKTtcblx0XHRcdHRoaXMuZGVJbml0aWFsaXplQ29tcG9uZW50KGNvbHVtbik7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVDb2x1bW4oXCJoZWFkZXJcIiwgY29sdW1uLCBjb2x1bW4sIGNvbHVtbi5lbGVtZW50KTtcblx0XHR9XG5cdH1cblx0XG5cdGNvbHVtbkxheW91dFVwZGF0ZWQoY29sdW1uKXtcblx0XHR2YXIgcHJldiA9IGNvbHVtbi5wcmV2Q29sdW1uKCk7XG5cdFx0XG5cdFx0dGhpcy5yZWluaXRpYWxpemVDb2x1bW4oY29sdW1uKTtcblx0XHRcblx0XHRpZihwcmV2KXtcblx0XHRcdHRoaXMucmVpbml0aWFsaXplQ29sdW1uKHByZXYpO1xuXHRcdH1cblx0fVxuXHRcblx0Y29sdW1uV2lkdGhVcGRhdGVkKGNvbHVtbil7XG5cdFx0aWYoY29sdW1uLm1vZHVsZXMuZnJvemVuKXtcblx0XHRcdGlmKHRoaXMudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLmxlZnRDb2x1bW5zLmluY2x1ZGVzKGNvbHVtbikpe1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZnJvemVuQ29sdW1ucy5sZWZ0Q29sdW1ucy5mb3JFYWNoKChjb2wpID0+IHtcblx0XHRcdFx0XHR0aGlzLnJlaW5pdGlhbGl6ZUNvbHVtbihjb2wpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1lbHNlIGlmKHRoaXMudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zLnJpZ2h0Q29sdW1ucy5pbmNsdWRlcyhjb2x1bW4pKXtcblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMucmlnaHRDb2x1bW5zLmZvckVhY2goKGNvbCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucmVpbml0aWFsaXplQ29sdW1uKGNvbCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGZyb3plbkNvbHVtbk9mZnNldChjb2x1bW4pe1xuXHRcdHZhciBvZmZzZXQgPSBmYWxzZTtcblxuXHRcdGlmKGNvbHVtbi5tb2R1bGVzLmZyb3plbil7XG5cdFx0XHRvZmZzZXQgPSBjb2x1bW4ubW9kdWxlcy5mcm96ZW4ubWFyZ2luVmFsdWU7IFxuXG5cdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5mcm96ZW4ucG9zaXRpb24gPT09IFwibGVmdFwiKXtcblx0XHRcdFx0b2Zmc2V0ICs9IGNvbHVtbi5nZXRXaWR0aCgpIC0gMztcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYob2Zmc2V0KXtcblx0XHRcdFx0XHRvZmZzZXQgLT0gMztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBvZmZzZXQgIT09IGZhbHNlID8gb2Zmc2V0ICsgXCJweFwiIDogZmFsc2U7XG5cdH1cblx0XG5cdHJlaW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdHZhciBmcm96ZW5PZmZzZXQgPSB0aGlzLmZyb3plbkNvbHVtbk9mZnNldChjb2x1bW4pO1xuXHRcdFxuXHRcdGNvbHVtbi5jZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG5cdFx0XHRpZihjZWxsLm1vZHVsZXMucmVzaXplICYmIGNlbGwubW9kdWxlcy5yZXNpemUuaGFuZGxlRWwpe1xuXHRcdFx0XHRpZihmcm96ZW5PZmZzZXQpe1xuXHRcdFx0XHRcdGNlbGwubW9kdWxlcy5yZXNpemUuaGFuZGxlRWwuc3R5bGVbY29sdW1uLm1vZHVsZXMuZnJvemVuLnBvc2l0aW9uXSA9IGZyb3plbk9mZnNldDtcblx0XHRcdFx0XHRjZWxsLm1vZHVsZXMucmVzaXplLmhhbmRsZUVsLnN0eWxlW1wiei1pbmRleFwiXSA9IDExO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRjZWxsLmVsZW1lbnQuYWZ0ZXIoY2VsbC5tb2R1bGVzLnJlc2l6ZS5oYW5kbGVFbCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0aWYoY29sdW1uLm1vZHVsZXMucmVzaXplICYmIGNvbHVtbi5tb2R1bGVzLnJlc2l6ZS5oYW5kbGVFbCl7XG5cdFx0XHRpZihmcm96ZW5PZmZzZXQpe1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy5yZXNpemUuaGFuZGxlRWwuc3R5bGVbY29sdW1uLm1vZHVsZXMuZnJvemVuLnBvc2l0aW9uXSA9IGZyb3plbk9mZnNldDtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Y29sdW1uLmVsZW1lbnQuYWZ0ZXIoY29sdW1uLm1vZHVsZXMucmVzaXplLmhhbmRsZUVsKTtcblx0XHR9XG5cdH1cblx0XG5cdGluaXRpYWxpemVDb2x1bW4odHlwZSwgY29tcG9uZW50LCBjb2x1bW4sIGVsZW1lbnQpe1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHR2YXJpYWJsZUhlaWdodCA9IGZhbHNlLFxuXHRcdG1vZGUgPSBjb2x1bW4uZGVmaW5pdGlvbi5yZXNpemFibGUsXG5cdFx0Y29uZmlnID0ge30sXG5cdFx0bmVhcmVzdENvbHVtbiA9IGNvbHVtbi5nZXRMYXN0Q29sdW1uKCk7XG5cdFx0XG5cdFx0Ly9zZXQgY29sdW1uIHJlc2l6ZSBtb2RlXG5cdFx0aWYodHlwZSA9PT0gXCJoZWFkZXJcIil7XG5cdFx0XHR2YXJpYWJsZUhlaWdodCA9IGNvbHVtbi5kZWZpbml0aW9uLmZvcm1hdHRlciA9PSBcInRleHRhcmVhXCIgfHwgY29sdW1uLmRlZmluaXRpb24udmFyaWFibGVIZWlnaHQ7XG5cdFx0XHRjb25maWcgPSB7dmFyaWFibGVIZWlnaHQ6dmFyaWFibGVIZWlnaHR9O1xuXHRcdH1cblx0XHRcblx0XHRpZigobW9kZSA9PT0gdHJ1ZSB8fCBtb2RlID09IHR5cGUpICYmIHRoaXMuX2NoZWNrUmVzaXphYmlsaXR5KG5lYXJlc3RDb2x1bW4pKXtcblx0XHRcdFxuXHRcdFx0dmFyIGhhbmRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcblx0XHRcdGhhbmRsZS5jbGFzc05hbWUgPSBcInRhYnVsYXRvci1jb2wtcmVzaXplLWhhbmRsZVwiO1xuXHRcdFx0XG5cdFx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHZhciBoYW5kbGVEb3duID0gZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYuc3RhcnRDb2x1bW4gPSBjb2x1bW47XG5cdFx0XHRcdHNlbGYuaW5pdGlhbE5leHRDb2x1bW4gPSBzZWxmLm5leHRDb2x1bW4gPSBuZWFyZXN0Q29sdW1uLm5leHRDb2x1bW4oKTtcblx0XHRcdFx0c2VsZi5fbW91c2VEb3duKGUsIG5lYXJlc3RDb2x1bW4sIGhhbmRsZSk7XG5cdFx0XHR9O1xuXHRcdFx0XG5cdFx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBoYW5kbGVEb3duKTtcblx0XHRcdGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBoYW5kbGVEb3duLCB7cGFzc2l2ZTogdHJ1ZX0pO1xuXHRcdFx0XG5cdFx0XHQvL3Jlc2l6ZSBjb2x1bW4gb24gIGRvdWJsZSBjbGlja1xuXHRcdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJkYmxjbGlja1wiLCAoZSkgPT4ge1xuXHRcdFx0XHR2YXIgb2xkV2lkdGggPSBuZWFyZXN0Q29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHRcdFxuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRuZWFyZXN0Q29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKHRydWUpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYob2xkV2lkdGggIT09IG5lYXJlc3RDb2x1bW4uZ2V0V2lkdGgoKSl7XG5cdFx0XHRcdFx0c2VsZi5kaXNwYXRjaChcImNvbHVtbi1yZXNpemVkXCIsIG5lYXJlc3RDb2x1bW4pO1xuXHRcdFx0XHRcdHNlbGYuZGlzcGF0Y2hFeHRlcm5hbChcImNvbHVtblJlc2l6ZWRcIiwgbmVhcmVzdENvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5mcm96ZW4pe1xuXHRcdFx0XHRoYW5kbGUuc3R5bGUucG9zaXRpb24gPSBcInN0aWNreVwiO1xuXHRcdFx0XHRoYW5kbGUuc3R5bGVbY29sdW1uLm1vZHVsZXMuZnJvemVuLnBvc2l0aW9uXSA9IHRoaXMuZnJvemVuQ29sdW1uT2Zmc2V0KGNvbHVtbik7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGNvbmZpZy5oYW5kbGVFbCA9IGhhbmRsZTtcblx0XHRcdFxuXHRcdFx0aWYoZWxlbWVudC5wYXJlbnROb2RlICYmIGNvbHVtbi52aXNpYmxlKXtcblx0XHRcdFx0ZWxlbWVudC5hZnRlcihoYW5kbGUpO1x0XHRcdFxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRjb21wb25lbnQubW9kdWxlcy5yZXNpemUgPSBjb25maWc7XG5cdH1cblx0XG5cdGRlSW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdHRoaXMuZGVJbml0aWFsaXplQ29tcG9uZW50KGNvbHVtbik7XG5cdFx0XG5cdFx0Y29sdW1uLmNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcblx0XHRcdHRoaXMuZGVJbml0aWFsaXplQ29tcG9uZW50KGNlbGwpO1xuXHRcdH0pO1xuXHR9XG5cdFxuXHRkZUluaXRpYWxpemVDb21wb25lbnQoY29tcG9uZW50KXtcblx0XHR2YXIgaGFuZGxlRWw7XG5cdFx0XG5cdFx0aWYoY29tcG9uZW50Lm1vZHVsZXMucmVzaXplKXtcblx0XHRcdGhhbmRsZUVsID0gY29tcG9uZW50Lm1vZHVsZXMucmVzaXplLmhhbmRsZUVsO1xuXHRcdFx0XG5cdFx0XHRpZihoYW5kbGVFbCAmJiBoYW5kbGVFbC5wYXJlbnRFbGVtZW50KXtcblx0XHRcdFx0aGFuZGxlRWwucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChoYW5kbGVFbCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRyZXNpemVIYW5kbGUoY29tcG9uZW50LCBoZWlnaHQpe1xuXHRcdGlmKGNvbXBvbmVudC5tb2R1bGVzLnJlc2l6ZSAmJiBjb21wb25lbnQubW9kdWxlcy5yZXNpemUuaGFuZGxlRWwpe1xuXHRcdFx0Y29tcG9uZW50Lm1vZHVsZXMucmVzaXplLmhhbmRsZUVsLnN0eWxlLmhlaWdodCA9IGhlaWdodDtcblx0XHR9XG5cdH1cblx0XG5cdHJlc2l6ZShlLCBjb2x1bW4pe1xuXHRcdHZhciB4ID0gdHlwZW9mIGUuY2xpZW50WCA9PT0gXCJ1bmRlZmluZWRcIiA/IGUudG91Y2hlc1swXS5jbGllbnRYIDogZS5jbGllbnRYLFxuXHRcdHN0YXJ0RGlmZiA9IHggLSB0aGlzLnN0YXJ0WCxcblx0XHRtb3ZlRGlmZiA9IHggLSB0aGlzLmxhdGVzdFgsXG5cdFx0YmxvY2tlZEJlZm9yZSwgYmxvY2tlZEFmdGVyO1xuXG5cdFx0dGhpcy5sYXRlc3RYID0geDtcblxuXHRcdGlmKHRoaXMudGFibGUucnRsKXtcblx0XHRcdHN0YXJ0RGlmZiA9IC1zdGFydERpZmY7XG5cdFx0XHRtb3ZlRGlmZiA9IC1tb3ZlRGlmZjtcblx0XHR9XG5cblx0XHRibG9ja2VkQmVmb3JlID0gY29sdW1uLndpZHRoID09IGNvbHVtbi5taW5XaWR0aCB8fCBjb2x1bW4ud2lkdGggPT0gY29sdW1uLm1heFdpZHRoO1xuXG5cdFx0Y29sdW1uLnNldFdpZHRoKHRoaXMuc3RhcnRXaWR0aCArIHN0YXJ0RGlmZik7XG5cblx0XHRibG9ja2VkQWZ0ZXIgPSBjb2x1bW4ud2lkdGggPT0gY29sdW1uLm1pbldpZHRoIHx8IGNvbHVtbi53aWR0aCA9PSBjb2x1bW4ubWF4V2lkdGg7XG5cblx0XHRpZihtb3ZlRGlmZiA8IDApe1xuXHRcdFx0dGhpcy5uZXh0Q29sdW1uID0gdGhpcy5pbml0aWFsTmV4dENvbHVtbjtcblx0XHR9XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucmVzaXphYmxlQ29sdW1uRml0ICYmIHRoaXMubmV4dENvbHVtbiAmJiAhKGJsb2NrZWRCZWZvcmUgJiYgYmxvY2tlZEFmdGVyKSl7XG5cdFx0XHRsZXQgY29sV2lkdGggPSB0aGlzLm5leHRDb2x1bW4uZ2V0V2lkdGgoKTtcblxuXHRcdFx0aWYobW92ZURpZmYgPiAwKXtcblx0XHRcdFx0aWYoY29sV2lkdGggPD0gdGhpcy5uZXh0Q29sdW1uLm1pbldpZHRoKXtcblx0XHRcdFx0XHR0aGlzLm5leHRDb2x1bW4gPSB0aGlzLm5leHRDb2x1bW4ubmV4dENvbHVtbigpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmKHRoaXMubmV4dENvbHVtbil7XG5cdFx0XHRcdHRoaXMubmV4dENvbHVtbi5zZXRXaWR0aCh0aGlzLm5leHRDb2x1bW4uZ2V0V2lkdGgoKSAtIG1vdmVEaWZmKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIucmVyZW5kZXJDb2x1bW5zKHRydWUpO1xuXG5cdFx0aWYoIXRoaXMudGFibGUuYnJvd3NlclNsb3cgJiYgY29sdW1uLm1vZHVsZXMucmVzaXplICYmIGNvbHVtbi5tb2R1bGVzLnJlc2l6ZS52YXJpYWJsZUhlaWdodCl7XG5cdFx0XHRjb2x1bW4uY2hlY2tDZWxsSGVpZ2h0cygpO1xuXHRcdH1cblx0fVxuXG5cdGNhbGNHdWlkZVBvc2l0aW9uKGUsIGNvbHVtbiwgaGFuZGxlKSB7XG5cdFx0dmFyIG1vdXNlWCA9IHR5cGVvZiBlLmNsaWVudFggPT09IFwidW5kZWZpbmVkXCIgPyBlLnRvdWNoZXNbMF0uY2xpZW50WCA6IGUuY2xpZW50WCxcblx0XHRoYW5kbGVYID0gaGFuZGxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnggLSB0aGlzLnRhYmxlLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueCxcblx0XHR0YWJsZVggPSB0aGlzLnRhYmxlLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueCxcblx0XHRjb2x1bW5YID0gY29sdW1uLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtIHRhYmxlWCxcblx0XHRtb3VzZURpZmYgPSBtb3VzZVggLSB0aGlzLnN0YXJ0WCxcblx0XHRwb3MgPSBNYXRoLm1heChoYW5kbGVYICsgbW91c2VEaWZmLCBjb2x1bW5YICsgY29sdW1uLm1pbldpZHRoKTtcblxuXHRcdGlmKGNvbHVtbi5tYXhXaWR0aCl7XG5cdFx0XHRwb3MgPSBNYXRoLm1pbihwb3MsIGNvbHVtblggKyBjb2x1bW4ubWF4V2lkdGgpO1xuXHRcdH1cblxuXHRcdHJldHVybiBwb3M7XG5cdH1cblxuXHRfY2hlY2tSZXNpemFiaWxpdHkoY29sdW1uKXtcblx0XHRyZXR1cm4gY29sdW1uLmRlZmluaXRpb24ucmVzaXphYmxlO1xuXHR9XG5cdFxuXHRfbW91c2VEb3duKGUsIGNvbHVtbiwgaGFuZGxlKXtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0Z3VpZGVFbDtcblxuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImNvbHVtblJlc2l6aW5nXCIsIGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cblx0XHRpZihzZWxmLnRhYmxlLm9wdGlvbnMucmVzaXphYmxlQ29sdW1uR3VpZGUpe1xuXHRcdFx0Z3VpZGVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuXHRcdFx0Z3VpZGVFbC5jbGFzc0xpc3QuYWRkKCd0YWJ1bGF0b3ItY29sLXJlc2l6ZS1ndWlkZScpO1xuXHRcdFx0c2VsZi50YWJsZS5lbGVtZW50LmFwcGVuZENoaWxkKGd1aWRlRWwpO1xuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdGd1aWRlRWwuc3R5bGUubGVmdCA9IHNlbGYuY2FsY0d1aWRlUG9zaXRpb24oZSwgY29sdW1uLCBoYW5kbGUpICsgXCJweFwiO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0c2VsZi50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXG5cdFx0ZnVuY3Rpb24gbW91c2VNb3ZlKGUpe1xuXHRcdFx0aWYoc2VsZi50YWJsZS5vcHRpb25zLnJlc2l6YWJsZUNvbHVtbkd1aWRlKXtcblx0XHRcdFx0Z3VpZGVFbC5zdHlsZS5sZWZ0ID0gc2VsZi5jYWxjR3VpZGVQb3NpdGlvbihlLCBjb2x1bW4sIGhhbmRsZSkgKyBcInB4XCI7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHNlbGYucmVzaXplKGUsIGNvbHVtbik7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGZ1bmN0aW9uIG1vdXNlVXAoZSl7XG5cdFx0XHRpZihzZWxmLnRhYmxlLm9wdGlvbnMucmVzaXphYmxlQ29sdW1uR3VpZGUpe1xuXHRcdFx0XHRzZWxmLnJlc2l6ZShlLCBjb2x1bW4pO1xuXHRcdFx0XHRndWlkZUVsLnJlbW92ZSgpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHQvL2Jsb2NrIGVkaXRvciBmcm9tIHRha2luZyBhY3Rpb24gd2hpbGUgcmVzaXppbmcgaXMgdGFraW5nIHBsYWNlXG5cdFx0XHRpZihzZWxmLnN0YXJ0Q29sdW1uLm1vZHVsZXMuZWRpdCl7XG5cdFx0XHRcdHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0LmJsb2NrZWQgPSBmYWxzZTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoc2VsZi50YWJsZS5icm93c2VyU2xvdyAmJiBjb2x1bW4ubW9kdWxlcy5yZXNpemUgJiYgY29sdW1uLm1vZHVsZXMucmVzaXplLnZhcmlhYmxlSGVpZ2h0KXtcblx0XHRcdFx0Y29sdW1uLmNoZWNrQ2VsbEhlaWdodHMoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBtb3VzZVVwKTtcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBtb3VzZU1vdmUpO1xuXHRcdFx0XG5cdFx0XHRoYW5kbGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBtb3VzZU1vdmUpO1xuXHRcdFx0aGFuZGxlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBtb3VzZVVwKTtcblx0XHRcdFxuXHRcdFx0c2VsZi50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXHRcdFx0XG5cdFx0XHRpZihzZWxmLnN0YXJ0V2lkdGggIT09IGNvbHVtbi5nZXRXaWR0aCgpKXtcblx0XHRcdFx0c2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLnZlcnRpY2FsQWxpZ25IZWFkZXJzKCk7XG5cblx0XHRcdFx0c2VsZi5kaXNwYXRjaChcImNvbHVtbi1yZXNpemVkXCIsIGNvbHVtbik7XG5cdFx0XHRcdHNlbGYuZGlzcGF0Y2hFeHRlcm5hbChcImNvbHVtblJlc2l6ZWRcIiwgY29sdW1uLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTsgLy9wcmV2ZW50IHJlc2l6ZSBmcm9tIGludGVyZmVyaW5nIHdpdGggbW92YWJsZSBjb2x1bW5zXG5cdFx0XG5cdFx0Ly9ibG9jayBlZGl0b3IgZnJvbSB0YWtpbmcgYWN0aW9uIHdoaWxlIHJlc2l6aW5nIGlzIHRha2luZyBwbGFjZVxuXHRcdGlmKHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0KXtcblx0XHRcdHNlbGYuc3RhcnRDb2x1bW4ubW9kdWxlcy5lZGl0LmJsb2NrZWQgPSB0cnVlO1xuXHRcdH1cblx0XHRcblx0XHRzZWxmLnN0YXJ0WCA9IHR5cGVvZiBlLmNsaWVudFggPT09IFwidW5kZWZpbmVkXCIgPyBlLnRvdWNoZXNbMF0uY2xpZW50WCA6IGUuY2xpZW50WDtcblx0XHRzZWxmLmxhdGVzdFggPSBzZWxmLnN0YXJ0WDtcblx0XHRzZWxmLnN0YXJ0V2lkdGggPSBjb2x1bW4uZ2V0V2lkdGgoKTtcblx0XHRcblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlKTtcblx0XHRkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIG1vdXNlVXApO1xuXHRcdGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIG1vdXNlTW92ZSwge3Bhc3NpdmU6IHRydWV9KTtcblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIG1vdXNlVXApO1xuXHR9XG59XG5cbmNsYXNzIFJlc2l6ZVJvd3MgZXh0ZW5kcyBNb2R1bGV7XG5cblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcInJlc2l6ZVJvd3NcIjtcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy5zdGFydENvbHVtbiA9IGZhbHNlO1xuXHRcdHRoaXMuc3RhcnRZID0gZmFsc2U7XG5cdFx0dGhpcy5zdGFydEhlaWdodCA9IGZhbHNlO1xuXHRcdHRoaXMuaGFuZGxlID0gbnVsbDtcblx0XHR0aGlzLnByZXZIYW5kbGUgPSBudWxsO1xuXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicmVzaXphYmxlUm93c1wiLCBmYWxzZSk7IC8vcmVzaXphYmxlIHJvd3Ncblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJyZXNpemFibGVSb3dHdWlkZVwiLCBmYWxzZSk7XG5cdH1cblxuXHRpbml0aWFsaXplKCl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnJlc2l6YWJsZVJvd3Mpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctbGF5b3V0LWFmdGVyXCIsIHRoaXMuaW5pdGlhbGl6ZVJvdy5iaW5kKHRoaXMpKTtcblx0XHR9XG5cdH1cblxuXHRpbml0aWFsaXplUm93KHJvdyl7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdHZhciBoYW5kbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRoYW5kbGUuY2xhc3NOYW1lID0gXCJ0YWJ1bGF0b3Itcm93LXJlc2l6ZS1oYW5kbGVcIjtcblxuXHRcdHZhciBwcmV2SGFuZGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0cHJldkhhbmRsZS5jbGFzc05hbWUgPSBcInRhYnVsYXRvci1yb3ctcmVzaXplLWhhbmRsZSBwcmV2XCI7XG5cblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHR9KTtcblxuXHRcdHZhciBoYW5kbGVEb3duID0gZnVuY3Rpb24oZSl7XG5cdFx0XHRzZWxmLnN0YXJ0Um93ID0gcm93O1xuXHRcdFx0c2VsZi5fbW91c2VEb3duKGUsIHJvdywgaGFuZGxlKTtcblx0XHR9O1xuXG5cdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgaGFuZGxlRG93bik7XG5cdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIGhhbmRsZURvd24sIHtwYXNzaXZlOiB0cnVlfSk7XG5cblx0XHRwcmV2SGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihlKXtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0fSk7XG5cblx0XHR2YXIgcHJldkhhbmRsZURvd24gPSAgZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgcHJldlJvdyA9IHNlbGYudGFibGUucm93TWFuYWdlci5wcmV2RGlzcGxheVJvdyhyb3cpO1xuXG5cdFx0XHRpZihwcmV2Um93KXtcblx0XHRcdFx0c2VsZi5zdGFydFJvdyA9IHByZXZSb3c7XG5cdFx0XHRcdHNlbGYuX21vdXNlRG93bihlLCBwcmV2Um93LCBwcmV2SGFuZGxlKTtcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0cHJldkhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIscHJldkhhbmRsZURvd24pO1xuXHRcdHByZXZIYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIixwcmV2SGFuZGxlRG93biwge3Bhc3NpdmU6IHRydWV9KTtcblxuXHRcdHJvd0VsLmFwcGVuZENoaWxkKGhhbmRsZSk7XG5cdFx0cm93RWwuYXBwZW5kQ2hpbGQocHJldkhhbmRsZSk7XG5cdH1cblxuXHRyZXNpemUoZSwgcm93KSB7XG5cdFx0cm93LnNldEhlaWdodCh0aGlzLnN0YXJ0SGVpZ2h0ICsgKCh0eXBlb2YgZS5zY3JlZW5ZID09PSBcInVuZGVmaW5lZFwiID8gZS50b3VjaGVzWzBdLnNjcmVlblkgOiBlLnNjcmVlblkpIC0gdGhpcy5zdGFydFkpKTtcblx0fVxuXG5cdGNhbGNHdWlkZVBvc2l0aW9uKGUsIHJvdywgaGFuZGxlKSB7XG5cdFx0dmFyIG1vdXNlWSA9IHR5cGVvZiBlLnNjcmVlblkgPT09IFwidW5kZWZpbmVkXCIgPyBlLnRvdWNoZXNbMF0uc2NyZWVuWSA6IGUuc2NyZWVuWSxcblx0XHRoYW5kbGVZID0gaGFuZGxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnkgLSB0aGlzLnRhYmxlLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueSxcblx0XHR0YWJsZVkgPSB0aGlzLnRhYmxlLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueSxcblx0XHRyb3dZID0gcm93LmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wIC0gdGFibGVZLFxuXHRcdG1vdXNlRGlmZiA9IG1vdXNlWSAtIHRoaXMuc3RhcnRZO1xuXG5cdFx0cmV0dXJuIE1hdGgubWF4KGhhbmRsZVkgKyBtb3VzZURpZmYsIHJvd1kpO1xuXHR9XG5cblx0X21vdXNlRG93bihlLCByb3csIGhhbmRsZSl7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdGd1aWRlRWw7XG5cblx0XHRzZWxmLmRpc3BhdGNoRXh0ZXJuYWwoXCJyb3dSZXNpemluZ1wiLCByb3cuZ2V0Q29tcG9uZW50KCkpO1xuXG5cdFx0aWYoc2VsZi50YWJsZS5vcHRpb25zLnJlc2l6YWJsZVJvd0d1aWRlKXtcblx0XHRcdGd1aWRlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcblx0XHRcdGd1aWRlRWwuY2xhc3NMaXN0LmFkZCgndGFidWxhdG9yLXJvdy1yZXNpemUtZ3VpZGUnKTtcblx0XHRcdHNlbGYudGFibGUuZWxlbWVudC5hcHBlbmRDaGlsZChndWlkZUVsKTtcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRndWlkZUVsLnN0eWxlLnRvcCA9IHNlbGYuY2FsY0d1aWRlUG9zaXRpb24oZSwgcm93LCBoYW5kbGUpICsgXCJweFwiO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0c2VsZi50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXG5cdFx0ZnVuY3Rpb24gbW91c2VNb3ZlKGUpe1xuXHRcdFx0aWYoc2VsZi50YWJsZS5vcHRpb25zLnJlc2l6YWJsZVJvd0d1aWRlKXtcblx0XHRcdFx0Z3VpZGVFbC5zdHlsZS50b3AgPSBzZWxmLmNhbGNHdWlkZVBvc2l0aW9uKGUsIHJvdywgaGFuZGxlKSArIFwicHhcIjtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0c2VsZi5yZXNpemUoZSwgcm93KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtb3VzZVVwKGUpe1xuXHRcdFx0aWYoc2VsZi50YWJsZS5vcHRpb25zLnJlc2l6YWJsZVJvd0d1aWRlKXtcblx0XHRcdFx0c2VsZi5yZXNpemUoZSwgcm93KTtcblx0XHRcdFx0Z3VpZGVFbC5yZW1vdmUoKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gLy9ibG9jayBlZGl0b3IgZnJvbSB0YWtpbmcgYWN0aW9uIHdoaWxlIHJlc2l6aW5nIGlzIHRha2luZyBwbGFjZVxuXHRcdFx0Ly8gaWYoc2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQpe1xuXHRcdFx0Ly8gXHRzZWxmLnN0YXJ0Q29sdW1uLm1vZHVsZXMuZWRpdC5ibG9ja2VkID0gZmFsc2U7XG5cdFx0XHQvLyB9XG5cblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgbW91c2VNb3ZlKTtcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBtb3VzZU1vdmUpO1xuXG5cdFx0XHRoYW5kbGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBtb3VzZU1vdmUpO1xuXHRcdFx0aGFuZGxlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBtb3VzZVVwKTtcblxuXHRcdFx0c2VsZi50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXG5cdFx0XHRzZWxmLmRpc3BhdGNoRXh0ZXJuYWwoXCJyb3dSZXNpemVkXCIsIHJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0fVxuXG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTsgLy9wcmV2ZW50IHJlc2l6ZSBmcm9tIGludGVyZmVyaW5nIHdpdGggbW92YWJsZSBjb2x1bW5zXG5cblx0XHQvL2Jsb2NrIGVkaXRvciBmcm9tIHRha2luZyBhY3Rpb24gd2hpbGUgcmVzaXppbmcgaXMgdGFraW5nIHBsYWNlXG5cdFx0Ly8gaWYoc2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQpe1xuXHRcdC8vIFx0c2VsZi5zdGFydENvbHVtbi5tb2R1bGVzLmVkaXQuYmxvY2tlZCA9IHRydWU7XG5cdFx0Ly8gfVxuXG5cdFx0c2VsZi5zdGFydFkgPSB0eXBlb2YgZS5zY3JlZW5ZID09PSBcInVuZGVmaW5lZFwiID8gZS50b3VjaGVzWzBdLnNjcmVlblkgOiBlLnNjcmVlblk7XG5cdFx0c2VsZi5zdGFydEhlaWdodCA9IHJvdy5nZXRIZWlnaHQoKTtcblxuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBtb3VzZU1vdmUpO1xuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgbW91c2VVcCk7XG5cblx0XHRoYW5kbGUuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBtb3VzZU1vdmUsIHtwYXNzaXZlOiB0cnVlfSk7XG5cdFx0aGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCBtb3VzZVVwKTtcblx0fVxufVxuXG5jbGFzcyBSZXNpemVUYWJsZSBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwicmVzaXplVGFibGVcIjtcblx0XG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5iaW5kaW5nID0gZmFsc2U7XG5cdFx0dGhpcy52aXNpYmlsaXR5T2JzZXJ2ZXIgPSBmYWxzZTtcblx0XHR0aGlzLnJlc2l6ZU9ic2VydmVyID0gZmFsc2U7XG5cdFx0dGhpcy5jb250YWluZXJPYnNlcnZlciA9IGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMudGFibGVIZWlnaHQgPSAwO1xuXHRcdHRoaXMudGFibGVXaWR0aCA9IDA7XG5cdFx0dGhpcy5jb250YWluZXJIZWlnaHQgPSAwO1xuXHRcdHRoaXMuY29udGFpbmVyV2lkdGggPSAwO1xuXHRcdFxuXHRcdHRoaXMuYXV0b1Jlc2l6ZSA9IGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHR0aGlzLmluaXRpYWxSZWRyYXcgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJhdXRvUmVzaXplXCIsIHRydWUpOyAvL2F1dG8gcmVzaXplIHRhYmxlXG5cdH1cblx0XG5cdGluaXRpYWxpemUoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuYXV0b1Jlc2l6ZSl7XG5cdFx0XHR2YXIgdGFibGUgPSB0aGlzLnRhYmxlLFxuXHRcdFx0dGFibGVTdHlsZTtcblx0XHRcdFxuXHRcdFx0dGhpcy50YWJsZUhlaWdodCA9IHRhYmxlLmVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuXHRcdFx0dGhpcy50YWJsZVdpZHRoID0gdGFibGUuZWxlbWVudC5jbGllbnRXaWR0aDtcblx0XHRcdFxuXHRcdFx0aWYodGFibGUuZWxlbWVudC5wYXJlbnROb2RlKXtcblx0XHRcdFx0dGhpcy5jb250YWluZXJIZWlnaHQgPSB0YWJsZS5lbGVtZW50LnBhcmVudE5vZGUuY2xpZW50SGVpZ2h0O1xuXHRcdFx0XHR0aGlzLmNvbnRhaW5lcldpZHRoID0gdGFibGUuZWxlbWVudC5wYXJlbnROb2RlLmNsaWVudFdpZHRoO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZih0eXBlb2YgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIFJlc2l6ZU9ic2VydmVyICE9PSBcInVuZGVmaW5lZFwiICYmIHRhYmxlLnJvd01hbmFnZXIuZ2V0UmVuZGVyTW9kZSgpID09PSBcInZpcnR1YWxcIil7XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLmluaXRpYWxpemVWaXNpYmlsaXR5T2JzZXJ2ZXIoKTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuYXV0b1Jlc2l6ZSA9IHRydWU7XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLnJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyeSkgPT4ge1xuXHRcdFx0XHRcdGlmKCF0YWJsZS5icm93c2VyTW9iaWxlIHx8ICh0YWJsZS5icm93c2VyTW9iaWxlICYmICghdGFibGUubW9kdWxlcy5lZGl0IHx8ICh0YWJsZS5tb2R1bGVzLmVkaXQgJiYgIXRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbCkpKSl7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHZhciBub2RlSGVpZ2h0ID0gTWF0aC5mbG9vcihlbnRyeVswXS5jb250ZW50UmVjdC5oZWlnaHQpO1xuXHRcdFx0XHRcdFx0dmFyIG5vZGVXaWR0aCA9IE1hdGguZmxvb3IoZW50cnlbMF0uY29udGVudFJlY3Qud2lkdGgpO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZih0aGlzLnRhYmxlSGVpZ2h0ICE9IG5vZGVIZWlnaHQgfHwgdGhpcy50YWJsZVdpZHRoICE9IG5vZGVXaWR0aCl7XG5cdFx0XHRcdFx0XHRcdHRoaXMudGFibGVIZWlnaHQgPSBub2RlSGVpZ2h0O1xuXHRcdFx0XHRcdFx0XHR0aGlzLnRhYmxlV2lkdGggPSBub2RlV2lkdGg7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRpZih0YWJsZS5lbGVtZW50LnBhcmVudE5vZGUpe1xuXHRcdFx0XHRcdFx0XHRcdHRoaXMuY29udGFpbmVySGVpZ2h0ID0gdGFibGUuZWxlbWVudC5wYXJlbnROb2RlLmNsaWVudEhlaWdodDtcblx0XHRcdFx0XHRcdFx0XHR0aGlzLmNvbnRhaW5lcldpZHRoID0gdGFibGUuZWxlbWVudC5wYXJlbnROb2RlLmNsaWVudFdpZHRoO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHR0aGlzLnJlZHJhd1RhYmxlKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMucmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZSh0YWJsZS5lbGVtZW50KTtcblx0XHRcdFx0XG5cdFx0XHRcdHRhYmxlU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0YWJsZS5lbGVtZW50KTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMudGFibGUuZWxlbWVudC5wYXJlbnROb2RlICYmICF0aGlzLnRhYmxlLnJvd01hbmFnZXIuZml4ZWRIZWlnaHQgJiYgKHRhYmxlU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShcIm1heC1oZWlnaHRcIikgfHwgdGFibGVTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFwibWluLWhlaWdodFwiKSkpe1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMuY29udGFpbmVyT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoKGVudHJ5KSA9PiB7XG5cdFx0XHRcdFx0XHRpZighdGFibGUuYnJvd3Nlck1vYmlsZSB8fCAodGFibGUuYnJvd3Nlck1vYmlsZSAmJiAoIXRhYmxlLm1vZHVsZXMuZWRpdCB8fCAodGFibGUubW9kdWxlcy5lZGl0ICYmICF0YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpKSkpe1xuXHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdFx0dmFyIG5vZGVIZWlnaHQgPSBNYXRoLmZsb29yKGVudHJ5WzBdLmNvbnRlbnRSZWN0LmhlaWdodCk7XG5cdFx0XHRcdFx0XHRcdHZhciBub2RlV2lkdGggPSBNYXRoLmZsb29yKGVudHJ5WzBdLmNvbnRlbnRSZWN0LndpZHRoKTtcblx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdGlmKHRoaXMuY29udGFpbmVySGVpZ2h0ICE9IG5vZGVIZWlnaHQgfHwgdGhpcy5jb250YWluZXJXaWR0aCAhPSBub2RlV2lkdGgpe1xuXHRcdFx0XHRcdFx0XHRcdHRoaXMuY29udGFpbmVySGVpZ2h0ID0gbm9kZUhlaWdodDtcblx0XHRcdFx0XHRcdFx0XHR0aGlzLmNvbnRhaW5lcldpZHRoID0gbm9kZVdpZHRoO1xuXHRcdFx0XHRcdFx0XHRcdHRoaXMudGFibGVIZWlnaHQgPSB0YWJsZS5lbGVtZW50LmNsaWVudEhlaWdodDtcblx0XHRcdFx0XHRcdFx0XHR0aGlzLnRhYmxlV2lkdGggPSB0YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHR0aGlzLnJlZHJhd1RhYmxlKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0dGhpcy5jb250YWluZXJPYnNlcnZlci5vYnNlcnZlKHRoaXMudGFibGUuZWxlbWVudC5wYXJlbnROb2RlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJ0YWJsZS1yZXNpemVcIiwgdGhpcy50YWJsZVJlc2l6ZWQuYmluZCh0aGlzKSk7XG5cdFx0XHRcdFxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmJpbmRpbmcgPSBmdW5jdGlvbigpe1xuXHRcdFx0XHRcdGlmKCF0YWJsZS5icm93c2VyTW9iaWxlIHx8ICh0YWJsZS5icm93c2VyTW9iaWxlICYmICghdGFibGUubW9kdWxlcy5lZGl0IHx8ICh0YWJsZS5tb2R1bGVzLmVkaXQgJiYgIXRhYmxlLm1vZHVsZXMuZWRpdC5jdXJyZW50Q2VsbCkpKSl7XG5cdFx0XHRcdFx0XHR0YWJsZS5jb2x1bW5NYW5hZ2VyLnJlcmVuZGVyQ29sdW1ucyh0cnVlKTtcblx0XHRcdFx0XHRcdHRhYmxlLnJlZHJhdygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblx0XHRcdFx0XG5cdFx0XHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIHRoaXMuYmluZGluZyk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtZGVzdHJveVwiLCB0aGlzLmNsZWFyQmluZGluZ3MuYmluZCh0aGlzKSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRpbml0aWFsaXplVmlzaWJpbGl0eU9ic2VydmVyKCl7XG5cdFx0dGhpcy52aXNpYmlsaXR5T2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoKGVudHJpZXMpID0+IHtcblx0XHRcdHRoaXMudmlzaWJsZSA9IGVudHJpZXNbMF0uaXNJbnRlcnNlY3Rpbmc7XG5cdFx0XHRcblx0XHRcdGlmKCF0aGlzLmluaXRpYWxpemVkKXtcblx0XHRcdFx0dGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG5cdFx0XHRcdHRoaXMuaW5pdGlhbFJlZHJhdyA9ICF0aGlzLnZpc2libGU7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGlmKHRoaXMudmlzaWJsZSl7XG5cdFx0XHRcdFx0dGhpcy5yZWRyYXdUYWJsZSh0aGlzLmluaXRpYWxSZWRyYXcpO1xuXHRcdFx0XHRcdHRoaXMuaW5pdGlhbFJlZHJhdyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy52aXNpYmlsaXR5T2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnRhYmxlLmVsZW1lbnQpO1xuXHR9XG5cdFxuXHRyZWRyYXdUYWJsZShmb3JjZSl7XG5cdFx0aWYodGhpcy5pbml0aWFsaXplZCAmJiB0aGlzLnZpc2libGUpe1xuXHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLnJlcmVuZGVyQ29sdW1ucyh0cnVlKTtcblx0XHRcdHRoaXMudGFibGUucmVkcmF3KGZvcmNlKTtcblx0XHR9XG5cdH1cblx0XG5cdHRhYmxlUmVzaXplZCgpe1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZWRyYXcoKTtcblx0fVxuXHRcblx0Y2xlYXJCaW5kaW5ncygpe1xuXHRcdGlmKHRoaXMuYmluZGluZyl7XG5cdFx0XHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLmJpbmRpbmcpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLnJlc2l6ZU9ic2VydmVyKXtcblx0XHRcdHRoaXMucmVzaXplT2JzZXJ2ZXIudW5vYnNlcnZlKHRoaXMudGFibGUuZWxlbWVudCk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMudmlzaWJpbGl0eU9ic2VydmVyKXtcblx0XHRcdHRoaXMudmlzaWJpbGl0eU9ic2VydmVyLnVub2JzZXJ2ZSh0aGlzLnRhYmxlLmVsZW1lbnQpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLmNvbnRhaW5lck9ic2VydmVyKXtcblx0XHRcdHRoaXMuY29udGFpbmVyT2JzZXJ2ZXIudW5vYnNlcnZlKHRoaXMudGFibGUuZWxlbWVudC5wYXJlbnROb2RlKTtcblx0XHR9XG5cdH1cbn1cblxuZnVuY3Rpb24gcmVzcG9uc2l2ZUNvbGxhcHNlKGNlbGwsIGZvcm1hdHRlclBhcmFtcywgb25SZW5kZXJlZCl7XG5cdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXG5cdGNvbmZpZyA9IGNlbGwuZ2V0Um93KCkuX3Jvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQ7XG5cblx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlLXRvZ2dsZVwiKTtcblx0XG5cdGVsLmlubmVySFRNTCA9IGA8c3ZnIGNsYXNzPSd0YWJ1bGF0b3ItcmVzcG9uc2l2ZS1jb2xsYXBzZS10b2dnbGUtb3Blbicgdmlld2JveD1cIjAgMCAyNCAyNFwiPlxuICA8bGluZSB4MT1cIjdcIiB5MT1cIjEyXCIgeDI9XCIxN1wiIHkyPVwiMTJcIiBmaWxsPVwibm9uZVwiIHN0cm9rZS13aWR0aD1cIjNcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgLz5cbiAgPGxpbmUgeTE9XCI3XCIgeDE9XCIxMlwiIHkyPVwiMTdcIiB4Mj1cIjEyXCIgZmlsbD1cIm5vbmVcIiBzdHJva2Utd2lkdGg9XCIzXCIgc3Ryb2tlLWxpbmVjYXA9XCJyb3VuZFwiIC8+XG48L3N2Zz5cblxuPHN2ZyBjbGFzcz0ndGFidWxhdG9yLXJlc3BvbnNpdmUtY29sbGFwc2UtdG9nZ2xlLWNsb3NlJyB2aWV3Ym94PVwiMCAwIDI0IDI0XCI+XG4gIDxsaW5lIHgxPVwiN1wiIHkxPVwiMTJcIiB4Mj1cIjE3XCIgeTI9XCIxMlwiICBmaWxsPVwibm9uZVwiIHN0cm9rZS13aWR0aD1cIjNcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgLz5cbjwvc3ZnPmA7XG5cblx0Y2VsbC5nZXRFbGVtZW50KCkuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3ctaGFuZGxlXCIpO1xuXG5cdGZ1bmN0aW9uIHRvZ2dsZUxpc3QoaXNPcGVuKXtcblx0XHR2YXIgY29sbGFwc2VFbCA9IGNvbmZpZy5lbGVtZW50O1xuXG5cdFx0Y29uZmlnLm9wZW4gPSBpc09wZW47XG5cblx0XHRpZihjb2xsYXBzZUVsKXtcblxuXHRcdFx0aWYoY29uZmlnLm9wZW4pe1xuXHRcdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwib3BlblwiKTtcblx0XHRcdFx0Y29sbGFwc2VFbC5zdHlsZS5kaXNwbGF5ID0gJyc7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGVsLmNsYXNzTGlzdC5yZW1vdmUoXCJvcGVuXCIpO1xuXHRcdFx0XHRjb2xsYXBzZUVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0ZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG5cdFx0dG9nZ2xlTGlzdCghY29uZmlnLm9wZW4pO1xuXHRcdGNlbGwuZ2V0VGFibGUoKS5yb3dNYW5hZ2VyLmFkanVzdFRhYmxlU2l6ZSgpO1xuXHR9KTtcblxuXHR0b2dnbGVMaXN0KGNvbmZpZy5vcGVuKTtcblxuXHRyZXR1cm4gZWw7XG59XG5cbnZhciBleHRlbnNpb25zJDIgPSB7XHJcblx0Zm9ybWF0OntcclxuXHRcdGZvcm1hdHRlcnM6e1xyXG5cdFx0XHRyZXNwb25zaXZlQ29sbGFwc2U6cmVzcG9uc2l2ZUNvbGxhcHNlLFxyXG5cdFx0fVxyXG5cdH1cclxufTtcblxuY2xhc3MgUmVzcG9uc2l2ZUxheW91dCBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwicmVzcG9uc2l2ZUxheW91dFwiO1xuXHRzdGF0aWMgbW9kdWxlRXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnMkMjtcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy5jb2x1bW5zID0gW107XG5cdFx0dGhpcy5oaWRkZW5Db2x1bW5zID0gW107XG5cdFx0dGhpcy5tb2RlID0gXCJcIjtcblx0XHR0aGlzLmluZGV4ID0gMDtcblx0XHR0aGlzLmNvbGxhcHNlRm9ybWF0dGVyID0gW107XG5cdFx0dGhpcy5jb2xsYXBzZVN0YXJ0T3BlbiA9IHRydWU7XG5cdFx0dGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbiA9IGZhbHNlO1xuXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicmVzcG9uc2l2ZUxheW91dFwiLCBmYWxzZSk7IC8vcmVzcG9uc2l2ZSBsYXlvdXQgZmxhZ3Ncblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJyZXNwb25zaXZlTGF5b3V0Q29sbGFwc2VTdGFydE9wZW5cIiwgdHJ1ZSk7IC8vc3RhcnQgc2hvd2luZyBjb2xsYXBzZWQgZGF0YVxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInJlc3BvbnNpdmVMYXlvdXRDb2xsYXBzZVVzZUZvcm1hdHRlcnNcIiwgdHJ1ZSk7IC8vcmVzcG9uc2l2ZSBsYXlvdXQgY29sbGFwc2UgZm9ybWF0dGVyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwicmVzcG9uc2l2ZUxheW91dENvbGxhcHNlRm9ybWF0dGVyXCIsIGZhbHNlKTsgLy9yZXNwb25zaXZlIGxheW91dCBjb2xsYXBzZSBmb3JtYXR0ZXJcblxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJyZXNwb25zaXZlXCIpO1xuXHR9XG5cblx0Ly9nZW5lcmF0ZSByZXNwb25zaXZlIGNvbHVtbnMgbGlzdFxuXHRpbml0aWFsaXplKCl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tbGF5b3V0XCIsIHRoaXMuaW5pdGlhbGl6ZUNvbHVtbi5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLXNob3dcIiwgdGhpcy51cGRhdGVDb2x1bW5WaXNpYmlsaXR5LmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4taGlkZVwiLCB0aGlzLnVwZGF0ZUNvbHVtblZpc2liaWxpdHkuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbnMtbG9hZGVkXCIsIHRoaXMuaW5pdGlhbGl6ZVJlc3BvbnNpdml0eS5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLW1vdmVkXCIsIHRoaXMuaW5pdGlhbGl6ZVJlc3BvbnNpdml0eS5iaW5kKHRoaXMpKTtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWFkZFwiLCB0aGlzLmluaXRpYWxpemVSZXNwb25zaXZpdHkuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1kZWxldGVcIiwgdGhpcy5pbml0aWFsaXplUmVzcG9uc2l2aXR5LmJpbmQodGhpcykpO1xuXG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLXJlZHJhd2luZ1wiLCB0aGlzLnRhYmxlUmVkcmF3LmJpbmQodGhpcykpO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCA9PT0gXCJjb2xsYXBzZVwiKXtcblx0XHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctZGF0YS1jaGFuZ2VkXCIsIHRoaXMuZ2VuZXJhdGVDb2xsYXBzZWRSb3dDb250ZW50LmJpbmQodGhpcykpO1xuXHRcdFx0XHR0aGlzLnN1YnNjcmliZShcInJvdy1pbml0XCIsIHRoaXMuaW5pdGlhbGl6ZVJvdy5iaW5kKHRoaXMpKTtcblx0XHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctbGF5b3V0XCIsIHRoaXMubGF5b3V0Um93LmJpbmQodGhpcykpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHRhYmxlUmVkcmF3KGZvcmNlKXtcblx0XHRpZihbXCJmaXRDb2x1bW5zXCIsIFwiZml0RGF0YVN0cmV0Y2hcIl0uaW5kZXhPZih0aGlzLmxheW91dE1vZGUoKSkgPT09IC0xKXtcblx0XHRcdGlmKCFmb3JjZSl7XG5cdFx0XHRcdHRoaXMudXBkYXRlKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aW5pdGlhbGl6ZVJlc3BvbnNpdml0eSgpe1xuXHRcdHZhciBjb2x1bW5zID0gW107XG5cblx0XHR0aGlzLm1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dDtcblx0XHR0aGlzLmNvbGxhcHNlRm9ybWF0dGVyID0gdGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXRDb2xsYXBzZUZvcm1hdHRlciB8fCB0aGlzLmZvcm1hdENvbGxhcHNlZERhdGE7XG5cdFx0dGhpcy5jb2xsYXBzZVN0YXJ0T3BlbiA9IHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0Q29sbGFwc2VTdGFydE9wZW47XG5cdFx0dGhpcy5oaWRkZW5Db2x1bW5zID0gW107XG5cblx0XHRpZih0aGlzLmNvbGxhcHNlRm9ybWF0dGVyKXtcblx0XHRcdHRoaXMuY29sbGFwc2VGb3JtYXR0ZXIgPSB0aGlzLmNvbGxhcHNlRm9ybWF0dGVyLmJpbmQodGhpcy50YWJsZSk7XG5cdFx0fVxuXG5cdFx0Ly9kZXRlcm1pbmUgbGV2ZWwgb2YgcmVzcG9uc2l2aXR5IGZvciBlYWNoIGNvbHVtblxuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5jb2x1bW5zQnlJbmRleC5mb3JFYWNoKChjb2x1bW4sIGkpID0+IHtcblx0XHRcdGlmKGNvbHVtbi5tb2R1bGVzLnJlc3BvbnNpdmUpe1xuXHRcdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5yZXNwb25zaXZlLm9yZGVyICYmIGNvbHVtbi5tb2R1bGVzLnJlc3BvbnNpdmUudmlzaWJsZSl7XG5cdFx0XHRcdFx0Y29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZS5pbmRleCA9IGk7XG5cdFx0XHRcdFx0Y29sdW1ucy5wdXNoKGNvbHVtbik7XG5cblx0XHRcdFx0XHRpZighY29sdW1uLnZpc2libGUgJiYgdGhpcy5tb2RlID09PSBcImNvbGxhcHNlXCIpe1xuXHRcdFx0XHRcdFx0dGhpcy5oaWRkZW5Db2x1bW5zLnB1c2goY29sdW1uKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vc29ydCBsaXN0IGJ5IHJlc3BvbnNpdml0eVxuXHRcdGNvbHVtbnMgPSBjb2x1bW5zLnJldmVyc2UoKTtcblx0XHRjb2x1bW5zID0gY29sdW1ucy5zb3J0KChhLCBiKSA9PiB7XG5cdFx0XHR2YXIgZGlmZiA9IGIubW9kdWxlcy5yZXNwb25zaXZlLm9yZGVyIC0gYS5tb2R1bGVzLnJlc3BvbnNpdmUub3JkZXI7XG5cdFx0XHRyZXR1cm4gZGlmZiB8fCAoYi5tb2R1bGVzLnJlc3BvbnNpdmUuaW5kZXggLSBhLm1vZHVsZXMucmVzcG9uc2l2ZS5pbmRleCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLmNvbHVtbnMgPSBjb2x1bW5zO1xuXG5cdFx0aWYodGhpcy5tb2RlID09PSBcImNvbGxhcHNlXCIpe1xuXHRcdFx0dGhpcy5nZW5lcmF0ZUNvbGxhcHNlZENvbnRlbnQoKTtcblx0XHR9XG5cblx0XHQvL2Fzc2lnbiBjb2xsYXBzZSBjb2x1bW5cblx0XHRmb3IgKGxldCBjb2wgb2YgdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnNCeUluZGV4KXtcblx0XHRcdGlmKGNvbC5kZWZpbml0aW9uLmZvcm1hdHRlciA9PSBcInJlc3BvbnNpdmVDb2xsYXBzZVwiKXtcblx0XHRcdFx0dGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbiA9IGNvbDtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYodGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbil7XG5cdFx0XHRpZih0aGlzLmhpZGRlbkNvbHVtbnMubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbi5zaG93KCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VIYW5kbGVDb2x1bW4uaGlkZSgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8vZGVmaW5lIGxheW91dCBpbmZvcm1hdGlvblxuXHRpbml0aWFsaXplQ29sdW1uKGNvbHVtbil7XG5cdFx0dmFyIGRlZiA9IGNvbHVtbi5nZXREZWZpbml0aW9uKCk7XG5cblx0XHRjb2x1bW4ubW9kdWxlcy5yZXNwb25zaXZlID0ge29yZGVyOiB0eXBlb2YgZGVmLnJlc3BvbnNpdmUgPT09IFwidW5kZWZpbmVkXCIgPyAxIDogZGVmLnJlc3BvbnNpdmUsIHZpc2libGU6ZGVmLnZpc2libGUgPT09IGZhbHNlID8gZmFsc2UgOiB0cnVlfTtcblx0fVxuXG5cdGluaXRpYWxpemVSb3cocm93KXtcblx0XHR2YXIgZWw7XG5cblx0XHRpZihyb3cudHlwZSAhPT0gXCJjYWxjXCIpe1xuXHRcdFx0ZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yZXNwb25zaXZlLWNvbGxhcHNlXCIpO1xuXG5cdFx0XHRyb3cubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0ID0ge1xuXHRcdFx0XHRlbGVtZW50OmVsLFxuXHRcdFx0XHRvcGVuOnRoaXMuY29sbGFwc2VTdGFydE9wZW4sXG5cdFx0XHR9O1xuXG5cdFx0XHRpZighdGhpcy5jb2xsYXBzZVN0YXJ0T3Blbil7XG5cdFx0XHRcdGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0bGF5b3V0Um93KHJvdyl7XG5cdFx0dmFyIHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdGlmKHJvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQpe1xuXHRcdFx0cm93RWwuYXBwZW5kQ2hpbGQocm93Lm1vZHVsZXMucmVzcG9uc2l2ZUxheW91dC5lbGVtZW50KTtcblx0XHRcdHRoaXMuZ2VuZXJhdGVDb2xsYXBzZWRSb3dDb250ZW50KHJvdyk7XG5cdFx0fVxuXHR9XG5cblx0Ly91cGRhdGUgY29sdW1uIHZpc2liaWxpdHlcblx0dXBkYXRlQ29sdW1uVmlzaWJpbGl0eShjb2x1bW4sIHJlc3BvbnNpdmVUb2dnbGUpe1xuXHRcdGlmKCFyZXNwb25zaXZlVG9nZ2xlICYmIGNvbHVtbi5tb2R1bGVzLnJlc3BvbnNpdmUpe1xuXHRcdFx0Y29sdW1uLm1vZHVsZXMucmVzcG9uc2l2ZS52aXNpYmxlID0gY29sdW1uLnZpc2libGU7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVSZXNwb25zaXZpdHkoKTtcblx0XHR9XG5cdH1cblxuXHRoaWRlQ29sdW1uKGNvbHVtbil7XG5cdFx0dmFyIGNvbENvdW50ID0gdGhpcy5oaWRkZW5Db2x1bW5zLmxlbmd0aDtcblxuXHRcdGNvbHVtbi5oaWRlKGZhbHNlLCB0cnVlKTtcblxuXHRcdGlmKHRoaXMubW9kZSA9PT0gXCJjb2xsYXBzZVwiKXtcblx0XHRcdHRoaXMuaGlkZGVuQ29sdW1ucy51bnNoaWZ0KGNvbHVtbik7XG5cdFx0XHR0aGlzLmdlbmVyYXRlQ29sbGFwc2VkQ29udGVudCgpO1xuXG5cdFx0XHRpZih0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uICYmICFjb2xDb3VudCl7XG5cdFx0XHRcdHRoaXMuY29sbGFwc2VIYW5kbGVDb2x1bW4uc2hvdygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHNob3dDb2x1bW4oY29sdW1uKXtcblx0XHR2YXIgaW5kZXg7XG5cblx0XHRjb2x1bW4uc2hvdyhmYWxzZSwgdHJ1ZSk7XG5cdFx0Ly9zZXQgY29sdW1uIHdpZHRoIHRvIHByZXZlbnQgY2FsY3VsYXRpb24gbG9vcHMgb24gdW5pbml0aWFsaXplZCBjb2x1bW5zXG5cdFx0Y29sdW1uLnNldFdpZHRoKGNvbHVtbi5nZXRXaWR0aCgpKTtcblxuXHRcdGlmKHRoaXMubW9kZSA9PT0gXCJjb2xsYXBzZVwiKXtcblx0XHRcdGluZGV4ID0gdGhpcy5oaWRkZW5Db2x1bW5zLmluZGV4T2YoY29sdW1uKTtcblxuXHRcdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHRcdHRoaXMuaGlkZGVuQ29sdW1ucy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmdlbmVyYXRlQ29sbGFwc2VkQ29udGVudCgpO1xuXG5cdFx0XHRpZih0aGlzLmNvbGxhcHNlSGFuZGxlQ29sdW1uICYmICF0aGlzLmhpZGRlbkNvbHVtbnMubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy5jb2xsYXBzZUhhbmRsZUNvbHVtbi5oaWRlKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly9yZWRyYXcgY29sdW1ucyB0byBmaXQgc3BhY2Vcblx0dXBkYXRlKCl7XG5cdFx0dmFyIHdvcmtpbmcgPSB0cnVlO1xuXG5cdFx0d2hpbGUod29ya2luZyl7XG5cblx0XHRcdGxldCB3aWR0aCA9IHRoaXMudGFibGUubW9kdWxlcy5sYXlvdXQuZ2V0TW9kZSgpID09IFwiZml0Q29sdW1uc1wiID8gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEZsZXhCYXNlV2lkdGgoKSA6IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpO1xuXG5cdFx0XHRsZXQgZGlmZiA9ICh0aGlzLnRhYmxlLm9wdGlvbnMuaGVhZGVyVmlzaWJsZSA/IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5lbGVtZW50LmNsaWVudFdpZHRoIDogdGhpcy50YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoKSAtIHdpZHRoO1xuXG5cdFx0XHRpZihkaWZmIDwgMCl7XG5cdFx0XHRcdC8vdGFibGUgaXMgdG9vIHdpZGVcblx0XHRcdFx0bGV0IGNvbHVtbiA9IHRoaXMuY29sdW1uc1t0aGlzLmluZGV4XTtcblxuXHRcdFx0XHRpZihjb2x1bW4pe1xuXHRcdFx0XHRcdHRoaXMuaGlkZUNvbHVtbihjb2x1bW4pO1xuXHRcdFx0XHRcdHRoaXMuaW5kZXggKys7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR3b3JraW5nID0gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0fWVsc2Uge1xuXG5cdFx0XHRcdC8vdGFibGUgaGFzIHNwYXJlIHNwYWNlXG5cdFx0XHRcdGxldCBjb2x1bW4gPSB0aGlzLmNvbHVtbnNbdGhpcy5pbmRleCAtMV07XG5cblx0XHRcdFx0aWYoY29sdW1uKXtcblx0XHRcdFx0XHRpZihkaWZmID4gMCl7XG5cdFx0XHRcdFx0XHRpZihkaWZmID49IGNvbHVtbi5nZXRXaWR0aCgpKXtcblx0XHRcdFx0XHRcdFx0dGhpcy5zaG93Q29sdW1uKGNvbHVtbik7XG5cdFx0XHRcdFx0XHRcdHRoaXMuaW5kZXggLS07XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHdvcmtpbmcgPSBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHR3b3JraW5nID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmKCF0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93c0NvdW50KXtcblx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlbmRlckVtcHR5U2Nyb2xsKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Z2VuZXJhdGVDb2xsYXBzZWRDb250ZW50KCl7XG5cdFx0dmFyIHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKTtcblxuXHRcdHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHR0aGlzLmdlbmVyYXRlQ29sbGFwc2VkUm93Q29udGVudChyb3cpO1xuXHRcdH0pO1xuXHR9XG5cblx0Z2VuZXJhdGVDb2xsYXBzZWRSb3dDb250ZW50KHJvdyl7XG5cdFx0dmFyIGVsLCBjb250ZW50cztcblxuXHRcdGlmKHJvdy5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQpe1xuXHRcdFx0ZWwgPSByb3cubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LmVsZW1lbnQ7XG5cblx0XHRcdHdoaWxlKGVsLmZpcnN0Q2hpbGQpIGVsLnJlbW92ZUNoaWxkKGVsLmZpcnN0Q2hpbGQpO1xuXG5cdFx0XHRjb250ZW50cyA9IHRoaXMuY29sbGFwc2VGb3JtYXR0ZXIodGhpcy5nZW5lcmF0ZUNvbGxhcHNlZFJvd0RhdGEocm93KSk7XG5cdFx0XHRpZihjb250ZW50cyl7XG5cdFx0XHRcdGVsLmFwcGVuZENoaWxkKGNvbnRlbnRzKTtcblx0XHRcdH1cblx0XHRcdHJvdy5jYWxjSGVpZ2h0KHRydWUpO1xuXHRcdH1cblx0fVxuXG5cdGdlbmVyYXRlQ29sbGFwc2VkUm93RGF0YShyb3cpe1xuXHRcdHZhciBkYXRhID0gcm93LmdldERhdGEoKSxcblx0XHRvdXRwdXQgPSBbXSxcblx0XHRtb2NrQ2VsbENvbXBvbmVudDtcblxuXHRcdHRoaXMuaGlkZGVuQ29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdHZhciB2YWx1ZSA9IGNvbHVtbi5nZXRGaWVsZFZhbHVlKGRhdGEpO1xuXG5cdFx0XHRpZihjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSAmJiBjb2x1bW4uZmllbGQpe1xuXHRcdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5mb3JtYXQgJiYgdGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXRDb2xsYXBzZVVzZUZvcm1hdHRlcnMpe1xuXG5cdFx0XHRcdFx0bW9ja0NlbGxDb21wb25lbnQgPSB7XG5cdFx0XHRcdFx0XHR2YWx1ZTpmYWxzZSxcblx0XHRcdFx0XHRcdGRhdGE6e30sXG5cdFx0XHRcdFx0XHRnZXRWYWx1ZTpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0Z2V0RGF0YTpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZGF0YTtcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRnZXRUeXBlOmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBcImNlbGxcIjtcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRnZXRFbGVtZW50OmZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldFJvdzpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcm93LmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldENvbHVtbjpmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdGdldFRhYmxlOigpID0+IHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHRoaXMudGFibGU7XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRmdW5jdGlvbiBvblJlbmRlcmVkKGNhbGxiYWNrKXtcblx0XHRcdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0b3V0cHV0LnB1c2goe1xuXHRcdFx0XHRcdFx0ZmllbGQ6IGNvbHVtbi5maWVsZCxcblx0XHRcdFx0XHRcdHRpdGxlOiBjb2x1bW4uZGVmaW5pdGlvbi50aXRsZSxcblx0XHRcdFx0XHRcdHZhbHVlOiBjb2x1bW4ubW9kdWxlcy5mb3JtYXQuZm9ybWF0dGVyLmNhbGwodGhpcy50YWJsZS5tb2R1bGVzLmZvcm1hdCwgbW9ja0NlbGxDb21wb25lbnQsIGNvbHVtbi5tb2R1bGVzLmZvcm1hdC5wYXJhbXMsIG9uUmVuZGVyZWQpXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRvdXRwdXQucHVzaCh7XG5cdFx0XHRcdFx0XHRmaWVsZDogY29sdW1uLmZpZWxkLFxuXHRcdFx0XHRcdFx0dGl0bGU6IGNvbHVtbi5kZWZpbml0aW9uLnRpdGxlLFxuXHRcdFx0XHRcdFx0dmFsdWU6IHZhbHVlXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBvdXRwdXQ7XG5cdH1cblxuXHRmb3JtYXRDb2xsYXBzZWREYXRhKGRhdGEpe1xuXHRcdHZhciBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO1xuXG5cdFx0ZGF0YS5mb3JFYWNoKChpdGVtKSA9PiB7XG5cdFx0XHR2YXIgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuXHRcdFx0dmFyIHRpdGxlRGF0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcblx0XHRcdHZhciB2YWx1ZURhdGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG5cdFx0XHR2YXIgbm9kZV9jb250ZW50O1xuXG5cdFx0XHR2YXIgdGl0bGVIaWdobGlnaHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3Ryb25nXCIpO1xuXHRcdFx0dGl0bGVEYXRhLmFwcGVuZENoaWxkKHRpdGxlSGlnaGxpZ2h0KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5tb2R1bGVzLmxvY2FsaXplLmJpbmQoXCJjb2x1bW5zfFwiICsgaXRlbS5maWVsZCwgZnVuY3Rpb24odGV4dCl7XG5cdFx0XHRcdHRpdGxlSGlnaGxpZ2h0LmlubmVySFRNTCA9IHRleHQgfHwgaXRlbS50aXRsZTtcblx0XHRcdH0pO1xuXG5cdFx0XHRpZihpdGVtLnZhbHVlIGluc3RhbmNlb2YgTm9kZSl7XG5cdFx0XHRcdG5vZGVfY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XHRcdG5vZGVfY29udGVudC5hcHBlbmRDaGlsZChpdGVtLnZhbHVlKTtcblx0XHRcdFx0dmFsdWVEYXRhLmFwcGVuZENoaWxkKG5vZGVfY29udGVudCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHZhbHVlRGF0YS5pbm5lckhUTUwgPSBpdGVtLnZhbHVlO1xuXHRcdFx0fVxuXG5cdFx0XHRyb3cuYXBwZW5kQ2hpbGQodGl0bGVEYXRhKTtcblx0XHRcdHJvdy5hcHBlbmRDaGlsZCh2YWx1ZURhdGEpO1xuXHRcdFx0bGlzdC5hcHBlbmRDaGlsZChyb3cpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA/IGxpc3QgOiBcIlwiO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJvd1NlbGVjdGlvbihjZWxsLCBmb3JtYXR0ZXJQYXJhbXMsIG9uUmVuZGVyZWQpe1xuXHR2YXIgY2hlY2tib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG5cdHZhciBibG9ja2VkID0gZmFsc2U7XG5cblx0Y2hlY2tib3gudHlwZSA9ICdjaGVja2JveCc7XG5cblx0Y2hlY2tib3guc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcIlNlbGVjdCBSb3dcIik7XG5cdFxuXHRpZih0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInNlbGVjdFJvd1wiLCB0cnVlKSl7XG5cblx0XHRjaGVja2JveC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0fSk7XG5cblx0XHRpZih0eXBlb2YgY2VsbC5nZXRSb3cgPT0gJ2Z1bmN0aW9uJyl7XG5cdFx0XHR2YXIgcm93ID0gY2VsbC5nZXRSb3coKTtcblxuXHRcdFx0aWYocm93IGluc3RhbmNlb2YgUm93Q29tcG9uZW50KXtcblxuXHRcdFx0XHRjaGVja2JveC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChlKSA9PiB7XG5cdFx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSb3dzUmFuZ2VNb2RlID09PSBcImNsaWNrXCIpe1xuXHRcdFx0XHRcdFx0aWYoIWJsb2NrZWQpe1xuXHRcdFx0XHRcdFx0XHRyb3cudG9nZ2xlU2VsZWN0KCk7XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGJsb2NrZWQgPSBmYWxzZTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRyb3cudG9nZ2xlU2VsZWN0KCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3NSYW5nZU1vZGUgPT09IFwiY2xpY2tcIil7XG5cdFx0XHRcdFx0Y2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG5cdFx0XHRcdFx0XHRibG9ja2VkID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSb3cuaGFuZGxlQ29tcGxleFJvd0NsaWNrKHJvdy5fcm93LCBlKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNoZWNrYm94LmNoZWNrZWQgPSByb3cuaXNTZWxlY3RlZCAmJiByb3cuaXNTZWxlY3RlZCgpO1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuc2VsZWN0Um93LnJlZ2lzdGVyUm93U2VsZWN0Q2hlY2tib3gocm93LCBjaGVja2JveCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNoZWNrYm94ID0gXCJcIjtcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRjaGVja2JveC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChlKSA9PiB7XG5cdFx0XHRcdGlmKHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSb3cuc2VsZWN0ZWRSb3dzLmxlbmd0aCl7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5kZXNlbGVjdFJvdygpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy50YWJsZS5zZWxlY3RSb3coZm9ybWF0dGVyUGFyYW1zLnJvd1JhbmdlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSb3cucmVnaXN0ZXJIZWFkZXJTZWxlY3RDaGVja2JveChjaGVja2JveCk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGNoZWNrYm94O1xufVxuXG52YXIgZXh0ZW5zaW9ucyQxID0ge1xyXG5cdGZvcm1hdDp7XHJcblx0XHRmb3JtYXR0ZXJzOntcclxuXHRcdFx0cm93U2VsZWN0aW9uOnJvd1NlbGVjdGlvbixcclxuXHRcdH1cclxuXHR9XHJcbn07XG5cbmNsYXNzIFNlbGVjdFJvdyBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwic2VsZWN0Um93XCI7XG5cdHN0YXRpYyBtb2R1bGVFeHRlbnNpb25zID0gZXh0ZW5zaW9ucyQxO1xuXHRcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLnNlbGVjdGluZyA9IGZhbHNlOyAvL2ZsYWcgc2VsZWN0aW5nIGluIHByb2dyZXNzXG5cdFx0dGhpcy5sYXN0Q2xpY2tlZFJvdyA9IGZhbHNlOyAvL2xhc3QgY2xpY2tlZCByb3dcblx0XHR0aGlzLnNlbGVjdFByZXYgPSBbXTsgLy9ob2xkIHByZXZpb3VzbHkgc2VsZWN0ZWQgZWxlbWVudCBmb3IgZHJhZyBkcm9wIHNlbGVjdGlvblxuXHRcdHRoaXMuc2VsZWN0ZWRSb3dzID0gW107IC8vaG9sZCBzZWxlY3RlZCByb3dzXG5cdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQgPSBudWxsOyAvLyBob2xkIGhlYWRlciBzZWxlY3QgZWxlbWVudFxuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInNlbGVjdGFibGVSb3dzXCIsIFwiaGlnaGxpZ2h0XCIpOyAvL2hpZ2hsaWdodCByb3dzIG9uIGhvdmVyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic2VsZWN0YWJsZVJvd3NSYW5nZU1vZGVcIiwgXCJkcmFnXCIpOyAgLy9oaWdobGlnaHQgcm93cyBvbiBob3ZlclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInNlbGVjdGFibGVSb3dzUm9sbGluZ1NlbGVjdGlvblwiLCB0cnVlKTsgLy9yb2xsIHNlbGVjdGlvbiBvbmNlIG1heGltdW0gbnVtYmVyIG9mIHNlbGVjdGFibGUgcm93cyBpcyByZWFjaGVkXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic2VsZWN0YWJsZVJvd3NQZXJzaXN0ZW5jZVwiLCB0cnVlKTsgLy8gbWFpbnRhaW4gc2VsZWN0aW9uIHdoZW4gdGFibGUgdmlldyBpcyB1cGRhdGVkXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic2VsZWN0YWJsZVJvd3NDaGVja1wiLCBmdW5jdGlvbihkYXRhLCByb3cpe3JldHVybiB0cnVlO30pOyAvL2NoZWNrIHdoZXRoZXIgcm93IGlzIHNlbGVjdGFibGVcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInNlbGVjdFJvd1wiLCB0aGlzLnNlbGVjdFJvd3MuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJkZXNlbGVjdFJvd1wiLCB0aGlzLmRlc2VsZWN0Um93cy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInRvZ2dsZVNlbGVjdFJvd1wiLCB0aGlzLnRvZ2dsZVJvdy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldFNlbGVjdGVkUm93c1wiLCB0aGlzLmdldFNlbGVjdGVkUm93cy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldFNlbGVjdGVkRGF0YVwiLCB0aGlzLmdldFNlbGVjdGVkRGF0YS5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHQvL3JlZ2lzdGVyIGNvbXBvbmVudCBmdW5jdGlvbnNcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJyb3dcIiwgXCJzZWxlY3RcIiwgdGhpcy5zZWxlY3RSb3dzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcInJvd1wiLCBcImRlc2VsZWN0XCIsIHRoaXMuZGVzZWxlY3RSb3dzLmJpbmQodGhpcykpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcInJvd1wiLCBcInRvZ2dsZVNlbGVjdFwiLCB0aGlzLnRvZ2dsZVJvdy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJyb3dcIiwgXCJpc1NlbGVjdGVkXCIsIHRoaXMuaXNSb3dTZWxlY3RlZC5iaW5kKHRoaXMpKTtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXG5cdFx0dGhpcy5kZXByZWNhdGVkT3B0aW9uc0NoZWNrKCk7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3MgPT09IFwiaGlnaGxpZ2h0XCIgJiYgdGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSYW5nZSl7XG5cdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3MgPSBmYWxzZTtcblx0XHR9XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3MgIT09IGZhbHNlKXtcblx0XHRcdHRoaXMuc3Vic2NyaWJlKFwicm93LWluaXRcIiwgdGhpcy5pbml0aWFsaXplUm93LmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3ctZGVsZXRpbmdcIiwgdGhpcy5yb3dEZWxldGVkLmJpbmQodGhpcykpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJyb3dzLXdpcGVcIiwgdGhpcy5jbGVhclNlbGVjdGlvbkRhdGEuYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInJvd3MtcmV0cmlldmVcIiwgdGhpcy5yb3dSZXRyaWV2ZS5iaW5kKHRoaXMpKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSb3dzICYmICF0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3NQZXJzaXN0ZW5jZSl7XG5cdFx0XHRcdHRoaXMuc3Vic2NyaWJlKFwiZGF0YS1yZWZyZXNoaW5nXCIsIHRoaXMuZGVzZWxlY3RSb3dzLmJpbmQodGhpcykpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGRlcHJlY2F0ZWRPcHRpb25zQ2hlY2soKXtcblx0XHQvLyB0aGlzLmRlcHJlY2F0aW9uQ2hlY2soXCJzZWxlY3RhYmxlXCIsIFwic2VsZWN0YWJsZVJvd3NcIiwgdHJ1ZSk7XG5cdFx0Ly8gdGhpcy5kZXByZWNhdGlvbkNoZWNrKFwic2VsZWN0YWJsZVJvbGxpbmdTZWxlY3Rpb25cIiwgXCJzZWxlY3RhYmxlUm93c1JvbGxpbmdTZWxlY3Rpb25cIiwgdHJ1ZSk7XG5cdFx0Ly8gdGhpcy5kZXByZWNhdGlvbkNoZWNrKFwic2VsZWN0YWJsZVJhbmdlTW9kZVwiLCBcInNlbGVjdGFibGVSb3dzUmFuZ2VNb2RlXCIsIHRydWUpO1xuXHRcdC8vIHRoaXMuZGVwcmVjYXRpb25DaGVjayhcInNlbGVjdGFibGVQZXJzaXN0ZW5jZVwiLCBcInNlbGVjdGFibGVSb3dzUGVyc2lzdGVuY2VcIiwgdHJ1ZSk7XG5cdFx0Ly8gdGhpcy5kZXByZWNhdGlvbkNoZWNrKFwic2VsZWN0YWJsZUNoZWNrXCIsIFwic2VsZWN0YWJsZVJvd3NDaGVja1wiLCB0cnVlKTtcblx0fVxuXHRcblx0cm93UmV0cmlldmUodHlwZSwgcHJldlZhbHVlKXtcblx0XHRyZXR1cm4gdHlwZSA9PT0gXCJzZWxlY3RlZFwiID8gdGhpcy5zZWxlY3RlZFJvd3MgOiBwcmV2VmFsdWU7XG5cdH1cblx0XG5cdHJvd0RlbGV0ZWQocm93KXtcblx0XHR0aGlzLl9kZXNlbGVjdFJvdyhyb3csIHRydWUpO1xuXHR9XG5cdFxuXHRjbGVhclNlbGVjdGlvbkRhdGEoc2lsZW50KXtcblx0XHR2YXIgcHJldlNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoO1xuXG5cdFx0dGhpcy5zZWxlY3RpbmcgPSBmYWxzZTtcblx0XHR0aGlzLmxhc3RDbGlja2VkUm93ID0gZmFsc2U7XG5cdFx0dGhpcy5zZWxlY3RQcmV2ID0gW107XG5cdFx0dGhpcy5zZWxlY3RlZFJvd3MgPSBbXTtcblx0XHRcblx0XHRpZihwcmV2U2VsZWN0ZWQgJiYgc2lsZW50ICE9PSB0cnVlKXtcblx0XHRcdHRoaXMuX3Jvd1NlbGVjdGlvbkNoYW5nZWQoKTtcblx0XHR9XG5cdH1cblx0XG5cdGluaXRpYWxpemVSb3cocm93KXtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0c2VsZWN0YWJsZSA9IHNlbGYuY2hlY2tSb3dTZWxlY3RhYmlsaXR5KHJvdyksXG5cdFx0ZWxlbWVudCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XG5cdFx0Ly8gdHJpZ2dlciBlbmQgb2Ygcm93IHNlbGVjdGlvblxuXHRcdHZhciBlbmRTZWxlY3QgPSBmdW5jdGlvbigpe1xuXHRcdFx0XG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cdFx0XHRcdHNlbGYuc2VsZWN0aW5nID0gZmFsc2U7XG5cdFx0XHR9LCA1MCk7XG5cdFx0XHRcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZW5kU2VsZWN0KTtcblx0XHR9O1xuXHRcdFxuXHRcdHJvdy5tb2R1bGVzLnNlbGVjdCA9IHtzZWxlY3RlZDpmYWxzZX07XG5cblx0XHRlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJ0YWJ1bGF0b3Itc2VsZWN0YWJsZVwiLCBzZWxlY3RhYmxlKTtcblx0XHRlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJ0YWJ1bGF0b3ItdW5zZWxlY3RhYmxlXCIsICFzZWxlY3RhYmxlKTtcblx0XHRcblx0XHQvL3NldCByb3cgc2VsZWN0aW9uIGNsYXNzXG5cdFx0aWYoc2VsZi5jaGVja1Jvd1NlbGVjdGFiaWxpdHkocm93KSl7XHRcdFx0XG5cdFx0XHRpZihzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3MgJiYgc2VsZi50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSb3dzICE9IFwiaGlnaGxpZ2h0XCIpe1xuXHRcdFx0XHRpZihzZWxmLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3NSYW5nZU1vZGUgPT09IFwiY2xpY2tcIil7XG5cdFx0XHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVDb21wbGV4Um93Q2xpY2suYmluZCh0aGlzLCByb3cpKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0aWYoIXNlbGYudGFibGUubW9kRXhpc3RzKFwiZWRpdFwiKSB8fCAhc2VsZi50YWJsZS5tb2R1bGVzLmVkaXQuZ2V0Q3VycmVudENlbGwoKSl7XG5cdFx0XHRcdFx0XHRcdHNlbGYudGFibGUuX2NsZWFyU2VsZWN0aW9uKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmKCFzZWxmLnNlbGVjdGluZyl7XG5cdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHJvdyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0aWYoZS5zaGlmdEtleSl7XG5cdFx0XHRcdFx0XHRcdHNlbGYudGFibGUuX2NsZWFyU2VsZWN0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRzZWxmLnNlbGVjdGluZyA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRzZWxmLnNlbGVjdFByZXYgPSBbXTtcblx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZW5kU2VsZWN0KTtcblx0XHRcdFx0XHRcdFx0ZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZW5kU2VsZWN0KTtcblx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHJvdyk7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdGlmKHNlbGYuc2VsZWN0aW5nKXtcblx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5fY2xlYXJTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRcdFx0c2VsZi50b2dnbGVSb3cocm93KTtcblx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdGlmKHNlbGYuc2VsZWN0UHJldlsxXSA9PSByb3cpe1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYudG9nZ2xlUm93KHNlbGYuc2VsZWN0UHJldlswXSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdGlmKHNlbGYuc2VsZWN0aW5nKXtcblx0XHRcdFx0XHRcdFx0c2VsZi50YWJsZS5fY2xlYXJTZWxlY3Rpb24oKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5zZWxlY3RQcmV2LnVuc2hpZnQocm93KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0aGFuZGxlQ29tcGxleFJvd0NsaWNrKHJvdywgZSl7XG5cdFx0aWYoZS5zaGlmdEtleSl7XG5cdFx0XHR0aGlzLnRhYmxlLl9jbGVhclNlbGVjdGlvbigpO1xuXHRcdFx0dGhpcy5sYXN0Q2xpY2tlZFJvdyA9IHRoaXMubGFzdENsaWNrZWRSb3cgfHwgcm93O1xuXHRcdFx0XG5cdFx0XHR2YXIgbGFzdENsaWNrZWRSb3dJZHggPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd0luZGV4KHRoaXMubGFzdENsaWNrZWRSb3cpO1xuXHRcdFx0dmFyIHJvd0lkeCA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93SW5kZXgocm93KTtcblx0XHRcdFxuXHRcdFx0dmFyIGZyb21Sb3dJZHggPSBsYXN0Q2xpY2tlZFJvd0lkeCA8PSByb3dJZHggPyBsYXN0Q2xpY2tlZFJvd0lkeCA6IHJvd0lkeDtcblx0XHRcdHZhciB0b1Jvd0lkeCA9IGxhc3RDbGlja2VkUm93SWR4ID49IHJvd0lkeCA/IGxhc3RDbGlja2VkUm93SWR4IDogcm93SWR4O1xuXHRcdFx0XG5cdFx0XHR2YXIgcm93cyA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLnNsaWNlKDApO1xuXHRcdFx0dmFyIHRvZ2dsZWRSb3dzID0gcm93cy5zcGxpY2UoZnJvbVJvd0lkeCwgdG9Sb3dJZHggLSBmcm9tUm93SWR4ICsgMSk7XG5cdFx0XHRcblx0XHRcdGlmKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpe1xuXHRcdFx0XHR0b2dnbGVkUm93cy5mb3JFYWNoKCh0b2dnbGVkUm93KT0+e1xuXHRcdFx0XHRcdGlmKHRvZ2dsZWRSb3cgIT09IHRoaXMubGFzdENsaWNrZWRSb3cpe1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3MgIT09IHRydWUgJiYgIXRoaXMuaXNSb3dTZWxlY3RlZChyb3cpKXtcblx0XHRcdFx0XHRcdFx0aWYodGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoIDwgdGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSb3dzKXtcblx0XHRcdFx0XHRcdFx0XHR0aGlzLnRvZ2dsZVJvdyh0b2dnbGVkUm93KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0XHR0aGlzLnRvZ2dsZVJvdyh0b2dnbGVkUm93KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHR0aGlzLmxhc3RDbGlja2VkUm93ID0gcm93O1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmRlc2VsZWN0Um93cyh1bmRlZmluZWQsIHRydWUpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSb3dzICE9PSB0cnVlKXtcblx0XHRcdFx0XHRpZih0b2dnbGVkUm93cy5sZW5ndGggPiB0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3Mpe1xuXHRcdFx0XHRcdFx0dG9nZ2xlZFJvd3MgPSB0b2dnbGVkUm93cy5zbGljZSgwLCB0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3MpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5zZWxlY3RSb3dzKHRvZ2dsZWRSb3dzKTtcblx0XHRcdH1cblx0XHRcdHRoaXMudGFibGUuX2NsZWFyU2VsZWN0aW9uKCk7XG5cdFx0fVxuXHRcdGVsc2UgaWYoZS5jdHJsS2V5IHx8IGUubWV0YUtleSl7XG5cdFx0XHR0aGlzLnRvZ2dsZVJvdyhyb3cpO1xuXHRcdFx0dGhpcy5sYXN0Q2xpY2tlZFJvdyA9IHJvdztcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmRlc2VsZWN0Um93cyh1bmRlZmluZWQsIHRydWUpO1xuXHRcdFx0dGhpcy5zZWxlY3RSb3dzKHJvdyk7XG5cdFx0XHR0aGlzLmxhc3RDbGlja2VkUm93ID0gcm93O1xuXHRcdH1cblx0fVxuXG5cdGNoZWNrUm93U2VsZWN0YWJpbGl0eShyb3cpe1xuXHRcdGlmKHJvdyAmJiByb3cudHlwZSA9PT0gXCJyb3dcIil7XG5cdFx0XHRyZXR1cm4gdGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSb3dzQ2hlY2suY2FsbCh0aGlzLnRhYmxlLCByb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRcblx0Ly90b2dnbGUgcm93IHNlbGVjdGlvblxuXHR0b2dnbGVSb3cocm93KXtcblx0XHRpZih0aGlzLmNoZWNrUm93U2VsZWN0YWJpbGl0eShyb3cpKXtcblx0XHRcdGlmKHJvdy5tb2R1bGVzLnNlbGVjdCAmJiByb3cubW9kdWxlcy5zZWxlY3Quc2VsZWN0ZWQpe1xuXHRcdFx0XHR0aGlzLl9kZXNlbGVjdFJvdyhyb3cpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLl9zZWxlY3RSb3cocm93KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdC8vc2VsZWN0IGEgbnVtYmVyIG9mIHJvd3Ncblx0c2VsZWN0Um93cyhyb3dzKXtcblx0XHR2YXIgY2hhbmdlcyA9IFtdLCBcblx0XHRyb3dNYXRjaCwgY2hhbmdlO1xuXHRcdFxuXHRcdHN3aXRjaCh0eXBlb2Ygcm93cyl7XG5cdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cdFx0XHRcdHJvd01hdGNoID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJvd3M7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwibnVtYmVyXCI6XG5cdFx0XHRcdHJvd01hdGNoID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmZpbmRSb3cocm93cyk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcblx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0cm93TWF0Y2ggPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyhyb3dzKTtcblx0XHRcdFxuXHRcdFx0XHRpZighcm93TWF0Y2gpe1xuXHRcdFx0XHRcdHJvd01hdGNoID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFJvd3Mocm93cyk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHJvd01hdGNoID0gcm93cztcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0aWYoQXJyYXkuaXNBcnJheShyb3dNYXRjaCkpe1xuXHRcdFx0aWYocm93TWF0Y2gubGVuZ3RoKXtcblx0XHRcdFx0cm93TWF0Y2guZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdFx0Y2hhbmdlID0gdGhpcy5fc2VsZWN0Um93KHJvdywgdHJ1ZSwgdHJ1ZSk7XG5cblx0XHRcdFx0XHRpZihjaGFuZ2Upe1xuXHRcdFx0XHRcdFx0Y2hhbmdlcy5wdXNoKGNoYW5nZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHR0aGlzLl9yb3dTZWxlY3Rpb25DaGFuZ2VkKGZhbHNlLCBjaGFuZ2VzKTtcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRpZihyb3dNYXRjaCl7XG5cdFx0XHRcdHRoaXMuX3NlbGVjdFJvdyhyb3dNYXRjaCwgZmFsc2UsIHRydWUpO1xuXHRcdFx0fVxuXHRcdH1cdFxuXHR9XG5cdFxuXHQvL3NlbGVjdCBhbiBpbmRpdmlkdWFsIHJvd1xuXHRfc2VsZWN0Um93KHJvd0luZm8sIHNpbGVudCwgZm9yY2Upe1xuXHRcdC8vaGFuZGxlIG1heCByb3cgY291bnRcblx0XHRpZighaXNOYU4odGhpcy50YWJsZS5vcHRpb25zLnNlbGVjdGFibGVSb3dzKSAmJiB0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3MgIT09IHRydWUgJiYgIWZvcmNlKXtcblx0XHRcdGlmKHRoaXMuc2VsZWN0ZWRSb3dzLmxlbmd0aCA+PSB0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3Mpe1xuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuc2VsZWN0YWJsZVJvd3NSb2xsaW5nU2VsZWN0aW9uKXtcblx0XHRcdFx0XHR0aGlzLl9kZXNlbGVjdFJvdyh0aGlzLnNlbGVjdGVkUm93c1swXSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0dmFyIHJvdyA9IHRoaXMudGFibGUucm93TWFuYWdlci5maW5kUm93KHJvd0luZm8pO1xuXHRcdFxuXHRcdGlmKHJvdyl7XG5cdFx0XHRpZih0aGlzLnNlbGVjdGVkUm93cy5pbmRleE9mKHJvdykgPT0gLTEpe1xuXHRcdFx0XHRyb3cuZ2V0RWxlbWVudCgpLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itc2VsZWN0ZWRcIik7XG5cdFx0XHRcdGlmKCFyb3cubW9kdWxlcy5zZWxlY3Qpe1xuXHRcdFx0XHRcdHJvdy5tb2R1bGVzLnNlbGVjdCA9IHt9O1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRyb3cubW9kdWxlcy5zZWxlY3Quc2VsZWN0ZWQgPSB0cnVlO1xuXHRcdFx0XHRpZihyb3cubW9kdWxlcy5zZWxlY3QuY2hlY2tib3hFbCl7XG5cdFx0XHRcdFx0cm93Lm1vZHVsZXMuc2VsZWN0LmNoZWNrYm94RWwuY2hlY2tlZCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuc2VsZWN0ZWRSb3dzLnB1c2gocm93KTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5kYXRhVHJlZVNlbGVjdFByb3BhZ2F0ZSl7XG5cdFx0XHRcdFx0dGhpcy5jaGlsZFJvd1NlbGVjdGlvbihyb3csIHRydWUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJyb3dTZWxlY3RlZFwiLCByb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5fcm93U2VsZWN0aW9uQ2hhbmdlZChzaWxlbnQsIHJvdyk7XG5cblx0XHRcdFx0cmV0dXJuIHJvdztcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRpZighc2lsZW50KXtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiU2VsZWN0aW9uIEVycm9yIC0gTm8gc3VjaCByb3cgZm91bmQsIGlnbm9yaW5nIHNlbGVjdGlvbjpcIiArIHJvd0luZm8pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0aXNSb3dTZWxlY3RlZChyb3cpe1xuXHRcdHJldHVybiB0aGlzLnNlbGVjdGVkUm93cy5pbmRleE9mKHJvdykgIT09IC0xO1xuXHR9XG5cdFxuXHQvL2Rlc2VsZWN0IGEgbnVtYmVyIG9mIHJvd3Ncblx0ZGVzZWxlY3RSb3dzKHJvd3MsIHNpbGVudCl7XG5cdFx0dmFyIGNoYW5nZXMgPSBbXSwgXG5cdFx0cm93TWF0Y2gsIGNoYW5nZTtcblx0XHRcblx0XHRzd2l0Y2godHlwZW9mIHJvd3Mpe1xuXHRcdFx0Y2FzZSBcInVuZGVmaW5lZFwiOlxuXHRcdFx0XHRyb3dNYXRjaCA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMuc2VsZWN0ZWRSb3dzKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJudW1iZXJcIjpcblx0XHRcdFx0cm93TWF0Y2ggPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyhyb3dzKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0cm93TWF0Y2ggPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZmluZFJvdyhyb3dzKTtcblx0XHRcdFxuXHRcdFx0XHRpZighcm93TWF0Y2gpe1xuXHRcdFx0XHRcdHJvd01hdGNoID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFJvd3Mocm93cyk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHJvd01hdGNoID0gcm93cztcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0aWYoQXJyYXkuaXNBcnJheShyb3dNYXRjaCkpe1xuXHRcdFx0aWYocm93TWF0Y2gubGVuZ3RoKXtcblx0XHRcdFx0cm93TWF0Y2guZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdFx0Y2hhbmdlID0gdGhpcy5fZGVzZWxlY3RSb3cocm93LCB0cnVlLCB0cnVlKTtcblxuXHRcdFx0XHRcdGlmKGNoYW5nZSl7XG5cdFx0XHRcdFx0XHRjaGFuZ2VzLnB1c2goY2hhbmdlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHRoaXMuX3Jvd1NlbGVjdGlvbkNoYW5nZWQoc2lsZW50LCBbXSwgY2hhbmdlcyk7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0aWYocm93TWF0Y2gpe1xuXHRcdFx0XHR0aGlzLl9kZXNlbGVjdFJvdyhyb3dNYXRjaCwgc2lsZW50LCB0cnVlKTtcblx0XHRcdH1cblx0XHR9XHRcblx0fVxuXHRcblx0Ly9kZXNlbGVjdCBhbiBpbmRpdmlkdWFsIHJvd1xuXHRfZGVzZWxlY3RSb3cocm93SW5mbywgc2lsZW50KXtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0cm93ID0gc2VsZi50YWJsZS5yb3dNYW5hZ2VyLmZpbmRSb3cocm93SW5mbyksXG5cdFx0aW5kZXgsIGVsZW1lbnQ7XG5cdFx0XG5cdFx0aWYocm93KXtcblx0XHRcdGluZGV4ID0gc2VsZi5zZWxlY3RlZFJvd3MuZmluZEluZGV4KGZ1bmN0aW9uKHNlbGVjdGVkUm93KXtcblx0XHRcdFx0cmV0dXJuIHNlbGVjdGVkUm93ID09IHJvdztcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRpZihpbmRleCA+IC0xKXtcblxuXHRcdFx0XHRlbGVtZW50ID0gcm93LmdldEVsZW1lbnQoKTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKGVsZW1lbnQpe1xuXHRcdFx0XHRcdGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1zZWxlY3RlZFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYoIXJvdy5tb2R1bGVzLnNlbGVjdCl7XG5cdFx0XHRcdFx0cm93Lm1vZHVsZXMuc2VsZWN0ID0ge307XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHJvdy5tb2R1bGVzLnNlbGVjdC5zZWxlY3RlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZihyb3cubW9kdWxlcy5zZWxlY3QuY2hlY2tib3hFbCl7XG5cdFx0XHRcdFx0cm93Lm1vZHVsZXMuc2VsZWN0LmNoZWNrYm94RWwuY2hlY2tlZCA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNlbGYuc2VsZWN0ZWRSb3dzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVRyZWVTZWxlY3RQcm9wYWdhdGUpe1xuXHRcdFx0XHRcdHRoaXMuY2hpbGRSb3dTZWxlY3Rpb24ocm93LCBmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInJvd0Rlc2VsZWN0ZWRcIiwgcm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XG5cdFx0XHRcdHNlbGYuX3Jvd1NlbGVjdGlvbkNoYW5nZWQoc2lsZW50LCB1bmRlZmluZWQsIHJvdyk7XG5cblx0XHRcdFx0cmV0dXJuIHJvdztcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRpZighc2lsZW50KXtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiRGVzZWxlY3Rpb24gRXJyb3IgLSBObyBzdWNoIHJvdyBmb3VuZCwgaWdub3Jpbmcgc2VsZWN0aW9uOlwiICsgcm93SW5mbyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRnZXRTZWxlY3RlZERhdGEoKXtcblx0XHR2YXIgZGF0YSA9IFtdO1xuXHRcdFxuXHRcdHRoaXMuc2VsZWN0ZWRSb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KXtcblx0XHRcdGRhdGEucHVzaChyb3cuZ2V0RGF0YSgpKTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gZGF0YTtcblx0fVxuXHRcblx0Z2V0U2VsZWN0ZWRSb3dzKCl7XG5cdFx0dmFyIHJvd3MgPSBbXTtcblx0XHRcblx0XHR0aGlzLnNlbGVjdGVkUm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHRyb3dzLnB1c2gocm93LmdldENvbXBvbmVudCgpKTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gcm93cztcblx0fVxuXHRcblx0X3Jvd1NlbGVjdGlvbkNoYW5nZWQoc2lsZW50LCBzZWxlY3RlZCA9IFtdLCBkZXNlbGVjdGVkID0gW10pe1xuXHRcdGlmKHRoaXMuaGVhZGVyQ2hlY2tib3hFbGVtZW50KXtcblx0XHRcdGlmKHRoaXMuc2VsZWN0ZWRSb3dzLmxlbmd0aCA9PT0gMCl7XG5cdFx0XHRcdHRoaXMuaGVhZGVyQ2hlY2tib3hFbGVtZW50LmNoZWNrZWQgPSBmYWxzZTtcblx0XHRcdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQuaW5kZXRlcm1pbmF0ZSA9IGZhbHNlO1xuXHRcdFx0fSBlbHNlIGlmKHRoaXMudGFibGUucm93TWFuYWdlci5yb3dzLmxlbmd0aCA9PT0gdGhpcy5zZWxlY3RlZFJvd3MubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQuY2hlY2tlZCA9IHRydWU7XG5cdFx0XHRcdHRoaXMuaGVhZGVyQ2hlY2tib3hFbGVtZW50LmluZGV0ZXJtaW5hdGUgPSBmYWxzZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuaGVhZGVyQ2hlY2tib3hFbGVtZW50LmluZGV0ZXJtaW5hdGUgPSB0cnVlO1xuXHRcdFx0XHR0aGlzLmhlYWRlckNoZWNrYm94RWxlbWVudC5jaGVja2VkID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCFzaWxlbnQpe1xuXHRcdFx0aWYoIUFycmF5LmlzQXJyYXkoc2VsZWN0ZWQpKXtcblx0XHRcdFx0c2VsZWN0ZWQgPSBbc2VsZWN0ZWRdO1xuXHRcdFx0fVxuXG5cdFx0XHRzZWxlY3RlZCA9IHNlbGVjdGVkLm1hcChyb3cgPT4gcm93LmdldENvbXBvbmVudCgpKTtcblxuXHRcdFx0aWYoIUFycmF5LmlzQXJyYXkoZGVzZWxlY3RlZCkpe1xuXHRcdFx0XHRkZXNlbGVjdGVkID0gW2Rlc2VsZWN0ZWRdO1xuXHRcdFx0fVxuXG5cdFx0XHRkZXNlbGVjdGVkID0gZGVzZWxlY3RlZC5tYXAocm93ID0+IHJvdy5nZXRDb21wb25lbnQoKSk7XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInJvd1NlbGVjdGlvbkNoYW5nZWRcIiwgdGhpcy5nZXRTZWxlY3RlZERhdGEoKSwgdGhpcy5nZXRTZWxlY3RlZFJvd3MoKSwgc2VsZWN0ZWQsIGRlc2VsZWN0ZWQpO1xuXHRcdH1cblx0fVxuXHRcblx0cmVnaXN0ZXJSb3dTZWxlY3RDaGVja2JveCAocm93LCBlbGVtZW50KSB7XG5cdFx0aWYoIXJvdy5fcm93Lm1vZHVsZXMuc2VsZWN0KXtcblx0XHRcdHJvdy5fcm93Lm1vZHVsZXMuc2VsZWN0ID0ge307XG5cdFx0fVxuXHRcdFxuXHRcdHJvdy5fcm93Lm1vZHVsZXMuc2VsZWN0LmNoZWNrYm94RWwgPSBlbGVtZW50O1xuXHR9XG5cdFxuXHRyZWdpc3RlckhlYWRlclNlbGVjdENoZWNrYm94IChlbGVtZW50KSB7XG5cdFx0dGhpcy5oZWFkZXJDaGVja2JveEVsZW1lbnQgPSBlbGVtZW50O1xuXHR9XG5cdFxuXHRjaGlsZFJvd1NlbGVjdGlvbihyb3csIHNlbGVjdCl7XG5cdFx0dmFyIGNoaWxkcmVuID0gdGhpcy50YWJsZS5tb2R1bGVzLmRhdGFUcmVlLmdldENoaWxkcmVuKHJvdywgdHJ1ZSwgdHJ1ZSk7XG5cdFx0XG5cdFx0aWYoc2VsZWN0KXtcblx0XHRcdGZvcihsZXQgY2hpbGQgb2YgY2hpbGRyZW4pe1xuXHRcdFx0XHR0aGlzLl9zZWxlY3RSb3coY2hpbGQsIHRydWUpO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGZvcihsZXQgY2hpbGQgb2YgY2hpbGRyZW4pe1xuXHRcdFx0XHR0aGlzLl9kZXNlbGVjdFJvdyhjaGlsZCwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59XG5cbmNsYXNzIFJhbmdlQ29tcG9uZW50IHtcblx0Y29uc3RydWN0b3IocmFuZ2UpIHtcblx0XHR0aGlzLl9yYW5nZSA9IHJhbmdlO1xuXG5cdFx0cmV0dXJuIG5ldyBQcm94eSh0aGlzLCB7XG5cdFx0XHRnZXQ6IGZ1bmN0aW9uICh0YXJnZXQsIG5hbWUsIHJlY2VpdmVyKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgdGFyZ2V0W25hbWVdICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRhcmdldFtuYW1lXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gdGFyZ2V0Ll9yYW5nZS50YWJsZS5jb21wb25lbnRGdW5jdGlvbkJpbmRlci5oYW5kbGUoXCJyYW5nZVwiLCB0YXJnZXQuX3JhbmdlLCBuYW1lKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHR9KTtcblx0fVxuXG5cdGdldEVsZW1lbnQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3JhbmdlLmVsZW1lbnQ7XG5cdH1cblxuXHRnZXREYXRhKCkge1xuXHRcdHJldHVybiB0aGlzLl9yYW5nZS5nZXREYXRhKCk7XG5cdH1cblxuXHRnZXRDZWxscygpIHtcblx0XHRyZXR1cm4gdGhpcy5fcmFuZ2UuZ2V0Q2VsbHModHJ1ZSwgdHJ1ZSk7XG5cdH1cblxuXHRnZXRTdHJ1Y3R1cmVkQ2VsbHMoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3JhbmdlLmdldFN0cnVjdHVyZWRDZWxscygpO1xuXHR9XG5cblx0Z2V0Um93cygpIHtcblx0XHRyZXR1cm4gdGhpcy5fcmFuZ2UuZ2V0Um93cygpLm1hcCgocm93KSA9PiByb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHR9XG5cblx0Z2V0Q29sdW1ucygpIHtcblx0XHRyZXR1cm4gdGhpcy5fcmFuZ2UuZ2V0Q29sdW1ucygpLm1hcCgoY29sdW1uKSA9PiBjb2x1bW4uZ2V0Q29tcG9uZW50KCkpO1xuXHR9XG5cdFxuXHRnZXRCb3VuZHMoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3JhbmdlLmdldEJvdW5kcygpO1xuXHR9XG5cblx0Z2V0VG9wRWRnZSgpIHtcblx0XHRyZXR1cm4gdGhpcy5fcmFuZ2UudG9wO1xuXHR9XG5cblx0Z2V0Qm90dG9tRWRnZSgpIHtcblx0XHRyZXR1cm4gdGhpcy5fcmFuZ2UuYm90dG9tO1xuXHR9XG5cblx0Z2V0TGVmdEVkZ2UoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3JhbmdlLmxlZnQ7XG5cdH1cblxuXHRnZXRSaWdodEVkZ2UoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3JhbmdlLnJpZ2h0O1xuXHR9XG5cblx0c2V0Qm91bmRzKHN0YXJ0LCBlbmQpe1xuXHRcdGlmKHRoaXMuX3JhbmdlLmRlc3Ryb3llZEd1YXJkKFwic2V0Qm91bmRzXCIpKXtcblx0XHRcdHRoaXMuX3JhbmdlLnNldEJvdW5kcyhzdGFydCA/IHN0YXJ0Ll9jZWxsIDogc3RhcnQsIGVuZCA/IGVuZC5fY2VsbCA6IGVuZCk7XG5cdFx0fVxuXHR9XG5cblx0c2V0U3RhcnRCb3VuZChzdGFydCl7XG5cdFx0aWYodGhpcy5fcmFuZ2UuZGVzdHJveWVkR3VhcmQoXCJzZXRTdGFydEJvdW5kXCIpKXtcblx0XHRcdHRoaXMuX3JhbmdlLnNldEVuZEJvdW5kKHN0YXJ0ID8gc3RhcnQuX2NlbGwgOiBzdGFydCk7XG5cdFx0XHR0aGlzLl9yYW5nZS5yYW5nZU1hbmFnZXIubGF5b3V0RWxlbWVudCgpO1xuXHRcdH1cblx0fVxuXG5cdHNldEVuZEJvdW5kKGVuZCl7XG5cdFx0aWYodGhpcy5fcmFuZ2UuZGVzdHJveWVkR3VhcmQoXCJzZXRFbmRCb3VuZFwiKSl7XG5cdFx0XHR0aGlzLl9yYW5nZS5zZXRFbmRCb3VuZChlbmQgPyBlbmQuX2NlbGwgOiBlbmQpO1xuXHRcdFx0dGhpcy5fcmFuZ2UucmFuZ2VNYW5hZ2VyLmxheW91dEVsZW1lbnQoKTtcblx0XHR9XG5cdH1cblxuXHRjbGVhclZhbHVlcygpe1xuXHRcdGlmKHRoaXMuX3JhbmdlLmRlc3Ryb3llZEd1YXJkKFwiY2xlYXJWYWx1ZXNcIikpe1xuXHRcdFx0dGhpcy5fcmFuZ2UuY2xlYXJWYWx1ZXMoKTtcblx0XHR9XG5cdH1cblxuXHRyZW1vdmUoKXtcblx0XHRpZih0aGlzLl9yYW5nZS5kZXN0cm95ZWRHdWFyZChcInJlbW92ZVwiKSl7XG5cdFx0XHR0aGlzLl9yYW5nZS5kZXN0cm95KHRydWUpO1xuXHRcdH1cblx0fVxufVxuXG5jbGFzcyBSYW5nZSBleHRlbmRzIENvcmVGZWF0dXJle1xuXHRjb25zdHJ1Y3Rvcih0YWJsZSwgcmFuZ2VNYW5hZ2VyLCBzdGFydCwgZW5kKSB7XG5cdFx0c3VwZXIodGFibGUpO1xuXHRcdFxuXHRcdHRoaXMucmFuZ2VNYW5hZ2VyID0gcmFuZ2VNYW5hZ2VyO1xuXHRcdHRoaXMuZWxlbWVudCA9IG51bGw7XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdHRoaXMuaW5pdGlhbGl6aW5nID0ge1xuXHRcdFx0c3RhcnQ6ZmFsc2UsXG5cdFx0XHRlbmQ6ZmFsc2UsXG5cdFx0fTtcblx0XHR0aGlzLmRlc3Ryb3llZCA9IGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMudG9wID0gMDtcblx0XHR0aGlzLmJvdHRvbSA9IDA7XG5cdFx0dGhpcy5sZWZ0ID0gMDtcblx0XHR0aGlzLnJpZ2h0ID0gMDtcblx0XHRcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7XG5cdFx0dGhpcy5zdGFydCA9IHtyb3c6MCwgY29sOjB9O1xuXHRcdHRoaXMuZW5kID0ge3JvdzowLCBjb2w6MH07XG5cblx0XHRpZih0aGlzLnJhbmdlTWFuYWdlci5yb3dIZWFkZXIpe1xuXHRcdFx0dGhpcy5sZWZ0ID0gMTtcblx0XHRcdHRoaXMucmlnaHQgPSAxO1xuXHRcdFx0dGhpcy5zdGFydC5jb2wgPSAxO1xuXHRcdFx0dGhpcy5lbmQuY29sID0gMTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5pbml0RWxlbWVudCgpO1xuXHRcdFxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0dGhpcy5pbml0Qm91bmRzKHN0YXJ0LCBlbmQpO1xuXHRcdH0pO1xuXHR9XG5cdFxuXHRpbml0RWxlbWVudCgpe1xuXHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcmFuZ2VcIik7XG5cdH1cblx0XG5cdGluaXRCb3VuZHMoc3RhcnQsIGVuZCl7XG5cdFx0dGhpcy5fdXBkYXRlTWluTWF4KCk7XG5cdFx0XG5cdFx0aWYoc3RhcnQpe1xuXHRcdFx0dGhpcy5zZXRCb3VuZHMoc3RhcnQsIGVuZCB8fCBzdGFydCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vICAgQm91bmRhcnkgU2V0dXAgICAgLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0c2V0U3RhcnQocm93LCBjb2wpIHtcblx0XHRpZih0aGlzLnN0YXJ0LnJvdyAhPT0gcm93IHx8IHRoaXMuc3RhcnQuY29sICE9PSBjb2wpe1xuXHRcdFx0dGhpcy5zdGFydC5yb3cgPSByb3c7XG5cdFx0XHR0aGlzLnN0YXJ0LmNvbCA9IGNvbDtcblx0XHRcdFxuXHRcdFx0dGhpcy5pbml0aWFsaXppbmcuc3RhcnQgPSB0cnVlO1xuXHRcdFx0dGhpcy5fdXBkYXRlTWluTWF4KCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRzZXRFbmQocm93LCBjb2wpIHtcblx0XHRpZih0aGlzLmVuZC5yb3cgIT09IHJvdyB8fCB0aGlzLmVuZC5jb2wgIT09IGNvbCl7XG5cdFx0XHR0aGlzLmVuZC5yb3cgPSByb3c7XG5cdFx0XHR0aGlzLmVuZC5jb2wgPSBjb2w7XG5cdFx0XHRcblx0XHRcdHRoaXMuaW5pdGlhbGl6aW5nLmVuZCA9IHRydWU7XG5cdFx0XHR0aGlzLl91cGRhdGVNaW5NYXgoKTtcblx0XHR9XG5cdH1cblx0XG5cdHNldEJvdW5kcyhzdGFydCwgZW5kLCB2aXNpYmxlUm93cyl7XG5cdFx0aWYoc3RhcnQpe1xuXHRcdFx0dGhpcy5zZXRTdGFydEJvdW5kKHN0YXJ0KTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5zZXRFbmRCb3VuZChlbmQgfHwgc3RhcnQpO1xuXHRcdHRoaXMucmFuZ2VNYW5hZ2VyLmxheW91dEVsZW1lbnQodmlzaWJsZVJvd3MpO1xuXHR9XG5cdFxuXHRzZXRTdGFydEJvdW5kKGVsZW1lbnQpe1xuXHRcdHZhciByb3csIGNvbDtcblx0XHRcblx0XHRpZiAoZWxlbWVudC50eXBlID09PSBcImNvbHVtblwiKSB7XG5cdFx0XHRpZih0aGlzLnJhbmdlTWFuYWdlci5jb2x1bW5TZWxlY3Rpb24pe1xuXHRcdFx0XHR0aGlzLnNldFN0YXJ0KDAsIGVsZW1lbnQuZ2V0UG9zaXRpb24oKSAtIDEpO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdHJvdyA9IGVsZW1lbnQucm93LnBvc2l0aW9uIC0gMTtcblx0XHRcdGNvbCA9IGVsZW1lbnQuY29sdW1uLmdldFBvc2l0aW9uKCkgLSAxO1xuXHRcdFx0XG5cdFx0XHRpZiAoZWxlbWVudC5jb2x1bW4gPT09IHRoaXMucmFuZ2VNYW5hZ2VyLnJvd0hlYWRlcikge1xuXHRcdFx0XHR0aGlzLnNldFN0YXJ0KHJvdywgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnNldFN0YXJ0KHJvdywgY29sKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdHNldEVuZEJvdW5kKGVsZW1lbnQpe1xuXHRcdHZhciByb3dzQ291bnQgPSB0aGlzLl9nZXRUYWJsZVJvd3MoKS5sZW5ndGgsXG5cdFx0cm93LCBjb2wsIGlzUm93SGVhZGVyO1xuXHRcdFxuXHRcdGlmIChlbGVtZW50LnR5cGUgPT09IFwiY29sdW1uXCIpIHtcblx0XHRcdGlmKHRoaXMucmFuZ2VNYW5hZ2VyLmNvbHVtblNlbGVjdGlvbil7XG5cdFx0XHRcdGlmICh0aGlzLnJhbmdlTWFuYWdlci5zZWxlY3RpbmcgPT09IFwiY29sdW1uXCIpIHtcblx0XHRcdFx0XHR0aGlzLnNldEVuZChyb3dzQ291bnQgLSAxLCBlbGVtZW50LmdldFBvc2l0aW9uKCkgLSAxKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0aGlzLnJhbmdlTWFuYWdlci5zZWxlY3RpbmcgPT09IFwiY2VsbFwiKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXRFbmQoMCwgZWxlbWVudC5nZXRQb3NpdGlvbigpIC0gMSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRyb3cgPSBlbGVtZW50LnJvdy5wb3NpdGlvbiAtIDE7XG5cdFx0XHRjb2wgPSBlbGVtZW50LmNvbHVtbi5nZXRQb3NpdGlvbigpIC0gMTtcblx0XHRcdGlzUm93SGVhZGVyID0gZWxlbWVudC5jb2x1bW4gPT09IHRoaXMucmFuZ2VNYW5hZ2VyLnJvd0hlYWRlcjtcblx0XHRcdFxuXHRcdFx0aWYgKHRoaXMucmFuZ2VNYW5hZ2VyLnNlbGVjdGluZyA9PT0gXCJyb3dcIikge1xuXHRcdFx0XHR0aGlzLnNldEVuZChyb3csIHRoaXMuX2dldFRhYmxlQ29sdW1ucygpLmxlbmd0aCAtIDEpO1xuXHRcdFx0fSBlbHNlIGlmICh0aGlzLnJhbmdlTWFuYWdlci5zZWxlY3RpbmcgIT09IFwicm93XCIgJiYgaXNSb3dIZWFkZXIpIHtcblx0XHRcdFx0dGhpcy5zZXRFbmQocm93LCAwKTtcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5yYW5nZU1hbmFnZXIuc2VsZWN0aW5nID09PSBcImNvbHVtblwiKSB7XG5cdFx0XHRcdHRoaXMuc2V0RW5kKHJvd3NDb3VudCAtIDEsIGNvbCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnNldEVuZChyb3csIGNvbCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRfdXBkYXRlTWluTWF4KCkge1xuXHRcdHRoaXMudG9wID0gTWF0aC5taW4odGhpcy5zdGFydC5yb3csIHRoaXMuZW5kLnJvdyk7XG5cdFx0dGhpcy5ib3R0b20gPSBNYXRoLm1heCh0aGlzLnN0YXJ0LnJvdywgdGhpcy5lbmQucm93KTtcblx0XHR0aGlzLmxlZnQgPSBNYXRoLm1pbih0aGlzLnN0YXJ0LmNvbCwgdGhpcy5lbmQuY29sKTtcblx0XHR0aGlzLnJpZ2h0ID0gTWF0aC5tYXgodGhpcy5zdGFydC5jb2wsIHRoaXMuZW5kLmNvbCk7XG5cdFx0XG5cdFx0aWYodGhpcy5pbml0aWFsaXplZCl7XG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJyYW5nZUNoYW5nZWRcIiwgdGhpcy5nZXRDb21wb25lbnQoKSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0aWYodGhpcy5pbml0aWFsaXppbmcuc3RhcnQgJiYgdGhpcy5pbml0aWFsaXppbmcuZW5kKXtcblx0XHRcdFx0dGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInJhbmdlQWRkZWRcIiwgdGhpcy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRfZ2V0VGFibGVDb2x1bW5zKCkge1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0VmlzaWJsZUNvbHVtbnNCeUluZGV4KCk7XG5cdH1cblx0XG5cdF9nZXRUYWJsZVJvd3MoKSB7XG5cdFx0cmV0dXJuIHRoaXMudGFibGUucm93TWFuYWdlci5nZXREaXNwbGF5Um93cygpLmZpbHRlcihyb3c9PiByb3cudHlwZSA9PT0gXCJyb3dcIik7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8gICAgICBSZW5kZXJpbmcgICAgICAvLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRsYXlvdXQoKSB7XG5cdFx0dmFyIF92RG9tVG9wID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJlbmRlcmVyLnZEb21Ub3AsXG5cdFx0X3ZEb21Cb3R0b20gPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVuZGVyZXIudkRvbUJvdHRvbSxcblx0XHRfdkRvbUxlZnQgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIucmVuZGVyZXIubGVmdENvbCxcblx0XHRfdkRvbVJpZ2h0ID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLnJlbmRlcmVyLnJpZ2h0Q29sLFx0XHRcblx0XHR0b3AsIGJvdHRvbSwgbGVmdCwgcmlnaHQsIHRvcExlZnRDZWxsLCBib3R0b21SaWdodENlbGwsIHRvcExlZnRDZWxsRWwsIGJvdHRvbVJpZ2h0Q2VsbEVsLCB0b3BMZWZ0Um93RWwsIGJvdHRvbVJpZ2h0Um93RWw7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucmVuZGVySG9yaXpvbnRhbCA9PT0gXCJ2aXJ0dWFsXCIgJiYgdGhpcy5yYW5nZU1hbmFnZXIucm93SGVhZGVyKSB7XG5cdFx0XHRfdkRvbVJpZ2h0ICs9IDE7XG5cdFx0fVxuXHRcdFxuXHRcdGlmIChfdkRvbVRvcCA9PSBudWxsKSB7XG5cdFx0XHRfdkRvbVRvcCA9IDA7XG5cdFx0fVxuXHRcdFxuXHRcdGlmIChfdkRvbUJvdHRvbSA9PSBudWxsKSB7XG5cdFx0XHRfdkRvbUJvdHRvbSA9IEluZmluaXR5O1xuXHRcdH1cblx0XHRcblx0XHRpZiAoX3ZEb21MZWZ0ID09IG51bGwpIHtcblx0XHRcdF92RG9tTGVmdCA9IDA7XG5cdFx0fVxuXHRcdFxuXHRcdGlmIChfdkRvbVJpZ2h0ID09IG51bGwpIHtcblx0XHRcdF92RG9tUmlnaHQgPSBJbmZpbml0eTtcblx0XHR9XG5cdFx0XG5cdFx0aWYgKHRoaXMub3ZlcmxhcHMoX3ZEb21MZWZ0LCBfdkRvbVRvcCwgX3ZEb21SaWdodCwgX3ZEb21Cb3R0b20pKSB7XG5cdFx0XHR0b3AgPSBNYXRoLm1heCh0aGlzLnRvcCwgX3ZEb21Ub3ApO1xuXHRcdFx0Ym90dG9tID0gTWF0aC5taW4odGhpcy5ib3R0b20sIF92RG9tQm90dG9tKTtcblx0XHRcdGxlZnQgPSBNYXRoLm1heCh0aGlzLmxlZnQsIF92RG9tTGVmdCk7XG5cdFx0XHRyaWdodCA9IE1hdGgubWluKHRoaXMucmlnaHQsIF92RG9tUmlnaHQpO1xuXHRcdFx0XG5cdFx0XHR0b3BMZWZ0Q2VsbCA9IHRoaXMucmFuZ2VNYW5hZ2VyLmdldENlbGwodG9wLCBsZWZ0KTtcblx0XHRcdGJvdHRvbVJpZ2h0Q2VsbCA9IHRoaXMucmFuZ2VNYW5hZ2VyLmdldENlbGwoYm90dG9tLCByaWdodCk7XG5cdFx0XHR0b3BMZWZ0Q2VsbEVsID0gdG9wTGVmdENlbGwuZ2V0RWxlbWVudCgpO1xuXHRcdFx0Ym90dG9tUmlnaHRDZWxsRWwgPSBib3R0b21SaWdodENlbGwuZ2V0RWxlbWVudCgpO1xuXHRcdFx0dG9wTGVmdFJvd0VsID0gdG9wTGVmdENlbGwucm93LmdldEVsZW1lbnQoKTtcblx0XHRcdGJvdHRvbVJpZ2h0Um93RWwgPSBib3R0b21SaWdodENlbGwucm93LmdldEVsZW1lbnQoKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcmFuZ2UtYWN0aXZlXCIpO1xuXHRcdFx0Ly8gdGhpcy5lbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJ0YWJ1bGF0b3ItcmFuZ2UtYWN0aXZlXCIsIHRoaXMgPT09IHRoaXMucmFuZ2VNYW5hZ2VyLmFjdGl2ZVJhbmdlKTtcblxuXHRcdFx0aWYodGhpcy50YWJsZS5ydGwpe1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUucmlnaHQgPSB0b3BMZWZ0Um93RWwub2Zmc2V0V2lkdGggLSB0b3BMZWZ0Q2VsbEVsLm9mZnNldExlZnQgLSB0b3BMZWZ0Q2VsbEVsLm9mZnNldFdpZHRoICsgXCJweFwiO1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSB0b3BMZWZ0Q2VsbEVsLm9mZnNldExlZnQgKyB0b3BMZWZ0Q2VsbEVsLm9mZnNldFdpZHRoIC0gYm90dG9tUmlnaHRDZWxsRWwub2Zmc2V0TGVmdCArIFwicHhcIjtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSB0b3BMZWZ0Um93RWwub2Zmc2V0TGVmdCArIHRvcExlZnRDZWxsRWwub2Zmc2V0TGVmdCArIFwicHhcIjtcblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gYm90dG9tUmlnaHRDZWxsRWwub2Zmc2V0TGVmdCArIGJvdHRvbVJpZ2h0Q2VsbEVsLm9mZnNldFdpZHRoIC0gdG9wTGVmdENlbGxFbC5vZmZzZXRMZWZ0ICsgXCJweFwiO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0gdG9wTGVmdFJvd0VsLm9mZnNldFRvcCArIFwicHhcIjtcblx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBib3R0b21SaWdodFJvd0VsLm9mZnNldFRvcCArIGJvdHRvbVJpZ2h0Um93RWwub2Zmc2V0SGVpZ2h0IC0gdG9wTGVmdFJvd0VsLm9mZnNldFRvcCArIFwicHhcIjtcblx0XHR9XG5cdH1cblx0XG5cdGF0VG9wTGVmdChjZWxsKSB7XG5cdFx0cmV0dXJuIGNlbGwucm93LnBvc2l0aW9uIC0gMSA9PT0gdGhpcy50b3AgJiYgY2VsbC5jb2x1bW4uZ2V0UG9zaXRpb24oKSAtIDEgPT09IHRoaXMubGVmdDtcblx0fVxuXHRcblx0YXRCb3R0b21SaWdodChjZWxsKSB7XG5cdFx0cmV0dXJuIGNlbGwucm93LnBvc2l0aW9uIC0gMSA9PT0gdGhpcy5ib3R0b20gJiYgY2VsbC5jb2x1bW4uZ2V0UG9zaXRpb24oKSAtIDEgPT09IHRoaXMucmlnaHQ7XG5cdH1cblx0XG5cdG9jY3VwaWVzKGNlbGwpIHtcblx0XHRyZXR1cm4gdGhpcy5vY2N1cGllc1JvdyhjZWxsLnJvdykgJiYgdGhpcy5vY2N1cGllc0NvbHVtbihjZWxsLmNvbHVtbik7XG5cdH1cblx0XG5cdG9jY3VwaWVzUm93KHJvdykge1xuXHRcdHJldHVybiB0aGlzLnRvcCA8PSByb3cucG9zaXRpb24gLSAxICYmIHJvdy5wb3NpdGlvbiAtIDEgPD0gdGhpcy5ib3R0b207XG5cdH1cblx0XG5cdG9jY3VwaWVzQ29sdW1uKGNvbCkge1xuXHRcdHJldHVybiB0aGlzLmxlZnQgPD0gY29sLmdldFBvc2l0aW9uKCkgLSAxICYmIGNvbC5nZXRQb3NpdGlvbigpIC0gMSA8PSB0aGlzLnJpZ2h0O1xuXHR9XG5cdFxuXHRvdmVybGFwcyhsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20pIHtcblx0XHRpZiAoKHRoaXMubGVmdCA+IHJpZ2h0IHx8IGxlZnQgPiB0aGlzLnJpZ2h0KSB8fCAodGhpcy50b3AgPiBib3R0b20gfHwgdG9wID4gdGhpcy5ib3R0b20pKXtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblx0XG5cdGdldERhdGEoKSB7XG5cdFx0dmFyIGRhdGEgPSBbXSxcblx0XHRyb3dzID0gdGhpcy5nZXRSb3dzKCksXG5cdFx0Y29sdW1ucyA9IHRoaXMuZ2V0Q29sdW1ucygpO1xuXHRcdFxuXHRcdHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHR2YXIgcm93RGF0YSA9IHJvdy5nZXREYXRhKCksXG5cdFx0XHRyZXN1bHQgPSB7fTtcblx0XHRcdFxuXHRcdFx0Y29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdFx0cmVzdWx0W2NvbHVtbi5maWVsZF0gPSByb3dEYXRhW2NvbHVtbi5maWVsZF07XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0ZGF0YS5wdXNoKHJlc3VsdCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIGRhdGE7XG5cdH1cblx0XG5cdGdldENlbGxzKHN0cnVjdHVyZWQsIGNvbXBvbmVudCkge1xuXHRcdHZhciBjZWxscyA9IFtdLFxuXHRcdHJvd3MgPSB0aGlzLmdldFJvd3MoKSxcblx0XHRjb2x1bW5zID0gdGhpcy5nZXRDb2x1bW5zKCk7XG5cdFx0XG5cdFx0aWYgKHN0cnVjdHVyZWQpIHtcblx0XHRcdGNlbGxzID0gcm93cy5tYXAoKHJvdykgPT4ge1xuXHRcdFx0XHR2YXIgYXJyID0gW107XG5cdFx0XHRcdFxuXHRcdFx0XHRyb3cuZ2V0Q2VsbHMoKS5mb3JFYWNoKChjZWxsKSA9PiB7XG5cdFx0XHRcdFx0aWYgKGNvbHVtbnMuaW5jbHVkZXMoY2VsbC5jb2x1bW4pKSB7XG5cdFx0XHRcdFx0XHRhcnIucHVzaChjb21wb25lbnQgPyBjZWxsLmdldENvbXBvbmVudCgpIDogY2VsbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdHJldHVybiBhcnI7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0cm93LmdldENlbGxzKCkuZm9yRWFjaCgoY2VsbCkgPT4ge1xuXHRcdFx0XHRcdGlmIChjb2x1bW5zLmluY2x1ZGVzKGNlbGwuY29sdW1uKSkge1xuXHRcdFx0XHRcdFx0Y2VsbHMucHVzaChjb21wb25lbnQgPyBjZWxsLmdldENvbXBvbmVudCgpIDogY2VsbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gY2VsbHM7XG5cdH1cblx0XG5cdGdldFN0cnVjdHVyZWRDZWxscygpIHtcblx0XHRyZXR1cm4gdGhpcy5nZXRDZWxscyh0cnVlLCB0cnVlKTtcblx0fVxuXHRcblx0Z2V0Um93cygpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ2V0VGFibGVSb3dzKCkuc2xpY2UodGhpcy50b3AsIHRoaXMuYm90dG9tICsgMSk7XG5cdH1cblx0XG5cdGdldENvbHVtbnMoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2dldFRhYmxlQ29sdW1ucygpLnNsaWNlKHRoaXMubGVmdCwgdGhpcy5yaWdodCArIDEpO1xuXHR9XG5cdFxuXHRjbGVhclZhbHVlcygpe1xuXHRcdHZhciBjZWxscyA9IHRoaXMuZ2V0Q2VsbHMoKTtcblx0XHR2YXIgY2xlYXJWYWx1ZSA9IHRoaXMudGFibGUub3B0aW9ucy5zZWxlY3RhYmxlUmFuZ2VDbGVhckNlbGxzVmFsdWU7XG5cdFx0XG5cdFx0dGhpcy50YWJsZS5ibG9ja1JlZHJhdygpO1xuXHRcdFxuXHRcdGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcblx0XHRcdGNlbGwuc2V0VmFsdWUoY2xlYXJWYWx1ZSk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy50YWJsZS5yZXN0b3JlUmVkcmF3KCk7XG5cdFx0XG5cdH1cblx0XG5cdGdldEJvdW5kcyhjb21wb25lbnQpe1xuXHRcdHZhciBjZWxscyA9IHRoaXMuZ2V0Q2VsbHMoZmFsc2UsIGNvbXBvbmVudCksXG5cdFx0b3V0cHV0ID0ge1xuXHRcdFx0c3RhcnQ6bnVsbCxcblx0XHRcdGVuZDpudWxsLFxuXHRcdH07XG5cdFx0XG5cdFx0aWYoY2VsbHMubGVuZ3RoKXtcblx0XHRcdG91dHB1dC5zdGFydCA9IGNlbGxzWzBdO1xuXHRcdFx0b3V0cHV0LmVuZCA9IGNlbGxzW2NlbGxzLmxlbmd0aCAtIDFdO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIk5vIGJvdW5kcyBkZWZpbmVkIG9uIHJhbmdlXCIpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHRnZXRDb21wb25lbnQoKSB7XG5cdFx0aWYgKCF0aGlzLmNvbXBvbmVudCkge1xuXHRcdFx0dGhpcy5jb21wb25lbnQgPSBuZXcgUmFuZ2VDb21wb25lbnQodGhpcyk7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLmNvbXBvbmVudDtcblx0fVxuXHRcblx0ZGVzdHJveShub3RpZnkpIHtcblx0XHR0aGlzLmRlc3Ryb3llZCA9IHRydWU7XG5cdFx0XG5cdFx0dGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuXHRcdFxuXHRcdGlmKG5vdGlmeSl7XG5cdFx0XHR0aGlzLnJhbmdlTWFuYWdlci5yYW5nZVJlbW92ZWQodGhpcyk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMuaW5pdGlhbGl6ZWQpe1xuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicmFuZ2VSZW1vdmVkXCIsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH1cblx0fVxuXHRcblx0ZGVzdHJveWVkR3VhcmQoZnVuYyl7XG5cdFx0aWYodGhpcy5kZXN0cm95ZWQpe1xuXHRcdFx0Y29uc29sZS53YXJuKFwiWW91IGNhbm5vdCBjYWxsIHRoZSBcIiAgKyBmdW5jICsgXCIgZnVuY3Rpb24gb24gYSBkZXN0cm95ZWQgcmFuZ2VcIik7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiAhdGhpcy5kZXN0cm95ZWQ7XG5cdH1cbn1cblxudmFyIGJpbmRpbmdzID0ge1xyXG5cdHJhbmdlSnVtcFVwOltcImN0cmwgKyAzOFwiLCBcIm1ldGEgKyAzOFwiXSxcclxuXHRyYW5nZUp1bXBEb3duOltcImN0cmwgKyA0MFwiLCBcIm1ldGEgKyA0MFwiXSxcclxuXHRyYW5nZUp1bXBMZWZ0OltcImN0cmwgKyAzN1wiLCBcIm1ldGEgKyAzN1wiXSxcclxuXHRyYW5nZUp1bXBSaWdodDpbXCJjdHJsICsgMzlcIiwgXCJtZXRhICsgMzlcIl0sXHJcblx0cmFuZ2VFeHBhbmRVcDpcInNoaWZ0ICsgMzhcIixcclxuXHRyYW5nZUV4cGFuZERvd246XCJzaGlmdCArIDQwXCIsXHJcblx0cmFuZ2VFeHBhbmRMZWZ0Olwic2hpZnQgKyAzN1wiLFxyXG5cdHJhbmdlRXhwYW5kUmlnaHQ6XCJzaGlmdCArIDM5XCIsXHJcblx0cmFuZ2VFeHBhbmRKdW1wVXA6W1wiY3RybCArIHNoaWZ0ICsgMzhcIiwgXCJtZXRhICsgc2hpZnQgKyAzOFwiXSxcclxuXHRyYW5nZUV4cGFuZEp1bXBEb3duOltcImN0cmwgKyBzaGlmdCArIDQwXCIsIFwibWV0YSArIHNoaWZ0ICsgNDBcIl0sXHJcblx0cmFuZ2VFeHBhbmRKdW1wTGVmdDpbXCJjdHJsICsgc2hpZnQgKyAzN1wiLCBcIm1ldGEgKyBzaGlmdCArIDM3XCJdLFxyXG5cdHJhbmdlRXhwYW5kSnVtcFJpZ2h0OltcImN0cmwgKyBzaGlmdCArIDM5XCIsIFwibWV0YSArIHNoaWZ0ICsgMzlcIl0sXHJcbn07XG5cbnZhciBhY3Rpb25zID0ge1xyXG5cdHJhbmdlSnVtcExlZnQ6IGZ1bmN0aW9uKGUpe1xyXG5cdFx0dGhpcy5kaXNwYXRjaChcImtleWJpbmRpbmctbmF2LXJhbmdlXCIsIGUsIFwibGVmdFwiLCB0cnVlLCBmYWxzZSk7XHJcblx0fSxcclxuXHRyYW5nZUp1bXBSaWdodDogZnVuY3Rpb24oZSl7XHJcblx0XHR0aGlzLmRpc3BhdGNoKFwia2V5YmluZGluZy1uYXYtcmFuZ2VcIiwgZSwgXCJyaWdodFwiLCB0cnVlLCBmYWxzZSk7XHJcblx0fSxcclxuXHRyYW5nZUp1bXBVcDogZnVuY3Rpb24oZSl7XHJcblx0XHR0aGlzLmRpc3BhdGNoKFwia2V5YmluZGluZy1uYXYtcmFuZ2VcIiwgZSwgXCJ1cFwiLCB0cnVlLCBmYWxzZSk7XHJcblx0fSxcclxuXHRyYW5nZUp1bXBEb3duOiBmdW5jdGlvbihlKXtcclxuXHRcdHRoaXMuZGlzcGF0Y2goXCJrZXliaW5kaW5nLW5hdi1yYW5nZVwiLCBlLCBcImRvd25cIiwgdHJ1ZSwgZmFsc2UpO1xyXG5cdH0sXHJcblx0cmFuZ2VFeHBhbmRMZWZ0OiBmdW5jdGlvbihlKXtcclxuXHRcdHRoaXMuZGlzcGF0Y2goXCJrZXliaW5kaW5nLW5hdi1yYW5nZVwiLCBlLCBcImxlZnRcIiwgZmFsc2UsIHRydWUpO1xyXG5cdH0sXHJcblx0cmFuZ2VFeHBhbmRSaWdodDogZnVuY3Rpb24oZSl7XHJcblx0XHR0aGlzLmRpc3BhdGNoKFwia2V5YmluZGluZy1uYXYtcmFuZ2VcIiwgZSwgXCJyaWdodFwiLCBmYWxzZSwgdHJ1ZSk7XHJcblx0fSxcclxuXHRyYW5nZUV4cGFuZFVwOiBmdW5jdGlvbihlKXtcclxuXHRcdHRoaXMuZGlzcGF0Y2goXCJrZXliaW5kaW5nLW5hdi1yYW5nZVwiLCBlLCBcInVwXCIsIGZhbHNlLCB0cnVlKTtcclxuXHR9LFxyXG5cdHJhbmdlRXhwYW5kRG93bjogZnVuY3Rpb24oZSl7XHJcblx0XHR0aGlzLmRpc3BhdGNoKFwia2V5YmluZGluZy1uYXYtcmFuZ2VcIiwgZSwgXCJkb3duXCIsIGZhbHNlLCB0cnVlKTtcclxuXHR9LFxyXG5cdHJhbmdlRXhwYW5kSnVtcExlZnQ6IGZ1bmN0aW9uKGUpe1xyXG5cdFx0dGhpcy5kaXNwYXRjaChcImtleWJpbmRpbmctbmF2LXJhbmdlXCIsIGUsIFwibGVmdFwiLCB0cnVlLCB0cnVlKTtcclxuXHR9LFxyXG5cdHJhbmdlRXhwYW5kSnVtcFJpZ2h0OiBmdW5jdGlvbihlKXtcclxuXHRcdHRoaXMuZGlzcGF0Y2goXCJrZXliaW5kaW5nLW5hdi1yYW5nZVwiLCBlLCBcInJpZ2h0XCIsIHRydWUsIHRydWUpO1xyXG5cdH0sXHJcblx0cmFuZ2VFeHBhbmRKdW1wVXA6IGZ1bmN0aW9uKGUpe1xyXG5cdFx0dGhpcy5kaXNwYXRjaChcImtleWJpbmRpbmctbmF2LXJhbmdlXCIsIGUsIFwidXBcIiwgdHJ1ZSwgdHJ1ZSk7XHJcblx0fSxcclxuXHRyYW5nZUV4cGFuZEp1bXBEb3duOiBmdW5jdGlvbihlKXtcclxuXHRcdHRoaXMuZGlzcGF0Y2goXCJrZXliaW5kaW5nLW5hdi1yYW5nZVwiLCBlLCBcImRvd25cIiwgdHJ1ZSwgdHJ1ZSk7XHJcblx0fSxcclxufTtcblxudmFyIHBhc3RlQWN0aW9ucyA9IHtcclxuXHRyYW5nZTpmdW5jdGlvbihkYXRhKXtcclxuXHRcdHZhciByb3dzID0gW10sXHJcblx0XHRyYW5nZSA9IHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSYW5nZS5hY3RpdmVSYW5nZSxcclxuXHRcdHNpbmdsZUNlbGwgPSBmYWxzZSxcclxuXHRcdGJvdW5kcywgc3RhcnRDZWxsLCBzdGFydFJvdywgcm93V2lkdGgsIGRhdGFMZW5ndGg7XHJcblxyXG5cdFx0ZGF0YUxlbmd0aCA9IGRhdGEubGVuZ3RoO1xyXG5cdFx0XHJcblx0XHRpZihyYW5nZSl7XHJcblx0XHRcdGJvdW5kcyA9IHJhbmdlLmdldEJvdW5kcygpO1xyXG5cdFx0XHRzdGFydENlbGwgPSBib3VuZHMuc3RhcnQ7XHJcblx0XHRcdFxyXG5cdFx0XHRpZihib3VuZHMuc3RhcnQgPT09IGJvdW5kcy5lbmQpe1xyXG5cdFx0XHRcdHNpbmdsZUNlbGwgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRpZihzdGFydENlbGwpe1xyXG5cdFx0XHRcdHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93cy5zbGljZSgpO1xyXG5cdFx0XHRcdHN0YXJ0Um93ID0gcm93cy5pbmRleE9mKHN0YXJ0Q2VsbC5yb3cpO1xyXG5cclxuXHRcdFx0XHRpZihzaW5nbGVDZWxsKXtcclxuXHRcdFx0XHRcdHJvd1dpZHRoID0gZGF0YS5sZW5ndGg7XHJcblx0XHRcdFx0fWVsc2Uge1xyXG5cdFx0XHRcdFx0cm93V2lkdGggPSAocm93cy5pbmRleE9mKGJvdW5kcy5lbmQucm93KSAtIHN0YXJ0Um93KSArIDE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmKHN0YXJ0Um93ID4tMSl7XHJcblx0XHRcdFx0XHR0aGlzLnRhYmxlLmJsb2NrUmVkcmF3KCk7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdHJvd3MgPSByb3dzLnNsaWNlKHN0YXJ0Um93LCBzdGFydFJvdyArIHJvd1dpZHRoKTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0cm93cy5mb3JFYWNoKChyb3csIGkpID0+IHtcclxuXHRcdFx0XHRcdFx0cm93LnVwZGF0ZURhdGEoZGF0YVtpICUgZGF0YUxlbmd0aF0pO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdHRoaXMudGFibGUucmVzdG9yZVJlZHJhdygpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRyZXR1cm4gcm93cztcclxuXHR9XHJcbn07XG5cbnZhciBwYXN0ZVBhcnNlcnMgPSB7XHJcblx0cmFuZ2U6ZnVuY3Rpb24oY2xpcGJvYXJkKXtcclxuXHRcdHZhciBkYXRhID0gW10sXHJcblx0XHRyb3dzID0gW10sXHJcblx0XHRyYW5nZSA9IHRoaXMudGFibGUubW9kdWxlcy5zZWxlY3RSYW5nZS5hY3RpdmVSYW5nZSxcclxuXHRcdHNpbmdsZUNlbGwgPSBmYWxzZSxcclxuXHRcdGJvdW5kcywgc3RhcnRDZWxsLCBjb2xXaWR0aCwgY29sdW1uTWFwLCBzdGFydENvbDtcclxuXHRcdFxyXG5cdFx0aWYocmFuZ2Upe1xyXG5cdFx0XHRib3VuZHMgPSByYW5nZS5nZXRCb3VuZHMoKTtcclxuXHRcdFx0c3RhcnRDZWxsID0gYm91bmRzLnN0YXJ0O1xyXG5cclxuXHRcdFx0aWYoYm91bmRzLnN0YXJ0ID09PSBib3VuZHMuZW5kKXtcclxuXHRcdFx0XHRzaW5nbGVDZWxsID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0aWYoc3RhcnRDZWxsKXtcclxuXHRcdFx0XHQvL2dldCBkYXRhIGZyb20gY2xpcGJvYXJkIGludG8gYXJyYXkgb2YgY29sdW1ucyBhbmQgcm93cy5cclxuXHRcdFx0XHRjbGlwYm9hcmQgPSBjbGlwYm9hcmQuc3BsaXQoXCJcXG5cIik7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Y2xpcGJvYXJkLmZvckVhY2goZnVuY3Rpb24ocm93KXtcclxuXHRcdFx0XHRcdGRhdGEucHVzaChyb3cuc3BsaXQoXCJcXHRcIikpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmKGRhdGEubGVuZ3RoKXtcclxuXHRcdFx0XHRcdGNvbHVtbk1hcCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRWaXNpYmxlQ29sdW1uc0J5SW5kZXgoKTtcclxuXHRcdFx0XHRcdHN0YXJ0Q29sID0gY29sdW1uTWFwLmluZGV4T2Yoc3RhcnRDZWxsLmNvbHVtbik7XHJcblxyXG5cdFx0XHRcdFx0aWYoc3RhcnRDb2wgPiAtMSl7XHJcblx0XHRcdFx0XHRcdGlmKHNpbmdsZUNlbGwpe1xyXG5cdFx0XHRcdFx0XHRcdGNvbFdpZHRoID0gZGF0YVswXS5sZW5ndGg7XHJcblx0XHRcdFx0XHRcdH1lbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRjb2xXaWR0aCA9IChjb2x1bW5NYXAuaW5kZXhPZihib3VuZHMuZW5kLmNvbHVtbikgLSBzdGFydENvbCkgKyAxO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHRjb2x1bW5NYXAgPSBjb2x1bW5NYXAuc2xpY2Uoc3RhcnRDb2wsIHN0YXJ0Q29sICsgY29sV2lkdGgpO1xyXG5cclxuXHRcdFx0XHRcdFx0ZGF0YS5mb3JFYWNoKChpdGVtKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIHJvdyA9IHt9O1xyXG5cdFx0XHRcdFx0XHRcdHZhciBpdGVtTGVuZ3RoID0gaXRlbS5sZW5ndGg7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGNvbHVtbk1hcC5mb3JFYWNoKGZ1bmN0aW9uKGNvbCwgaSl7XHJcblx0XHRcdFx0XHRcdFx0XHRyb3dbY29sLmZpZWxkXSA9IGl0ZW1baSAlIGl0ZW1MZW5ndGhdO1xyXG5cdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdHJvd3MucHVzaChyb3cpO1x0XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHRcdFx0cmV0dXJuIHJvd3M7XHJcblx0XHRcdFx0XHR9XHRcdFx0XHRcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cclxufTtcblxudmFyIGNvbHVtbkxvb2t1cHMgPSB7XHJcblx0cmFuZ2U6ZnVuY3Rpb24oKXtcclxuXHRcdHZhciBjb2x1bW5zID0gdGhpcy5tb2R1bGVzLnNlbGVjdFJhbmdlLnNlbGVjdGVkQ29sdW1ucygpO1xyXG5cclxuXHRcdGlmKHRoaXMuY29sdW1uTWFuYWdlci5yb3dIZWFkZXIpe1xyXG5cdFx0XHRjb2x1bW5zLnVuc2hpZnQodGhpcy5jb2x1bW5NYW5hZ2VyLnJvd0hlYWRlcik7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGNvbHVtbnM7XHJcblx0fSxcclxufTtcblxudmFyIHJvd0xvb2t1cHMgPSB7XHJcblx0cmFuZ2U6ZnVuY3Rpb24oKXtcclxuXHRcdHJldHVybiB0aGlzLm1vZHVsZXMuc2VsZWN0UmFuZ2Uuc2VsZWN0ZWRSb3dzKCk7XHJcblx0fSxcclxufTtcblxudmFyIGV4dGVuc2lvbnMgPSB7XHJcblx0a2V5YmluZGluZ3M6e1xyXG5cdFx0YmluZGluZ3M6YmluZGluZ3MsXHJcblx0XHRhY3Rpb25zOmFjdGlvbnNcclxuXHR9LFxyXG5cdGNsaXBib2FyZDp7XHJcblx0XHRwYXN0ZUFjdGlvbnM6cGFzdGVBY3Rpb25zLFxyXG5cdFx0cGFzdGVQYXJzZXJzOnBhc3RlUGFyc2Vyc1xyXG5cdH0sXHJcblx0ZXhwb3J0OntcclxuXHRcdGNvbHVtbkxvb2t1cHM6Y29sdW1uTG9va3VwcyxcclxuXHRcdHJvd0xvb2t1cHM6cm93TG9va3VwcyxcclxuXHR9XHJcbn07XG5cbmNsYXNzIFNlbGVjdFJhbmdlIGV4dGVuZHMgTW9kdWxlIHtcblx0XG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJzZWxlY3RSYW5nZVwiO1xuXHRzdGF0aWMgbW9kdWxlSW5pdE9yZGVyID0gMTtcblx0c3RhdGljIG1vZHVsZUV4dGVuc2lvbnMgPSBleHRlbnNpb25zO1xuXHRcblx0Y29uc3RydWN0b3IodGFibGUpIHtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5zZWxlY3RpbmcgPSBcImNlbGxcIjtcblx0XHR0aGlzLm1vdXNlZG93biA9IGZhbHNlO1xuXHRcdHRoaXMucmFuZ2VzID0gW107XG5cdFx0dGhpcy5vdmVybGF5ID0gbnVsbDtcblx0XHR0aGlzLnJvd0hlYWRlciA9IG51bGw7XG5cdFx0dGhpcy5sYXlvdXRDaGFuZ2VUaW1lb3V0ID0gbnVsbDtcblx0XHR0aGlzLmNvbHVtblNlbGVjdGlvbiA9IGZhbHNlO1xuXHRcdHRoaXMucm93U2VsZWN0aW9uID0gZmFsc2U7XG5cdFx0dGhpcy5tYXhSYW5nZXMgPSAwO1xuXHRcdHRoaXMuYWN0aXZlUmFuZ2UgPSBmYWxzZTtcblx0XHR0aGlzLmJsb2NrS2V5ZG93biA9IGZhbHNlO1xuXHRcdFxuXHRcdHRoaXMua2V5RG93bkV2ZW50ID0gdGhpcy5faGFuZGxlS2V5RG93bi5iaW5kKHRoaXMpO1xuXHRcdHRoaXMubW91c2VVcEV2ZW50ID0gdGhpcy5faGFuZGxlTW91c2VVcC5iaW5kKHRoaXMpO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInNlbGVjdGFibGVSYW5nZVwiLCBmYWxzZSk7IC8vZW5hYmxlIHNlbGVjdGFibGUgcmFuZ2Vcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJzZWxlY3RhYmxlUmFuZ2VDb2x1bW5zXCIsIGZhbHNlKTsgLy9lbmFibGUgc2VsZWN0YWJsZSByYW5nZVxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInNlbGVjdGFibGVSYW5nZVJvd3NcIiwgZmFsc2UpOyAvL2VuYWJsZSBzZWxlY3RhYmxlIHJhbmdlXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic2VsZWN0YWJsZVJhbmdlQ2xlYXJDZWxsc1wiLCBmYWxzZSk7IC8vYWxsb3cgY2xlYXJpbmcgb2YgYWN0aXZlIHJhbmdlXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic2VsZWN0YWJsZVJhbmdlQ2xlYXJDZWxsc1ZhbHVlXCIsIHVuZGVmaW5lZCk7IC8vdmFsdWUgZm9yIGNsZWFyZWQgYWN0aXZlIHJhbmdlXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic2VsZWN0YWJsZVJhbmdlQXV0b0ZvY3VzXCIsIHRydWUpOyAvL2ZvY3VzIG9uIGEgY2VsbCBhZnRlciByZXNldFJhbmdlc1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiZ2V0UmFuZ2VzRGF0YVwiLCB0aGlzLmdldFJhbmdlc0RhdGEuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRSYW5nZXNcIiwgdGhpcy5nZXRSYW5nZXMuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJhZGRSYW5nZVwiLCB0aGlzLmFkZFJhbmdlRnJvbUNvbXBvbmVudC5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJjZWxsXCIsIFwiZ2V0UmFuZ2VzXCIsIHRoaXMuY2VsbEdldFJhbmdlcy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJyb3dcIiwgXCJnZXRSYW5nZXNcIiwgdGhpcy5yb3dHZXRSYW5nZXMuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY29sdW1uXCIsIFwiZ2V0UmFuZ2VzXCIsIHRoaXMuY29sR2V0UmFuZ2VzLmJpbmQodGhpcykpO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vICAgIEluaXRpYWxpemF0aW9uICAgLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHRpZiAodGhpcy5vcHRpb25zKFwic2VsZWN0YWJsZVJhbmdlXCIpKSB7XHRcblx0XHRcdGlmKCF0aGlzLm9wdGlvbnMoXCJzZWxlY3RhYmxlUm93c1wiKSl7XG5cdFx0XHRcdHRoaXMubWF4UmFuZ2VzID0gdGhpcy5vcHRpb25zKFwic2VsZWN0YWJsZVJhbmdlXCIpO1xuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5pbml0aWFsaXplVGFibGUoKTtcblx0XHRcdFx0dGhpcy5pbml0aWFsaXplV2F0Y2hlcnMoKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiU2VsZWN0UmFuZ2UgZnVuY3Rpb25hbGl0eSBjYW5ub3QgYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIHJvdyBzZWxlY3Rpb25cIik7XG5cdFx0XHR9XG5cblx0XHRcdGlmKHRoaXMub3B0aW9ucygnY29sdW1ucycpLmZpbmRJbmRleCgoY29sdW1uKSA9PiBjb2x1bW4uZnJvemVuKSA+IDApIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiSGF2aW5nIGZyb3plbiBjb2x1bW4gaW4gYXJiaXRyYXJ5IHBvc2l0aW9uIHdpdGggc2VsZWN0UmFuZ2Ugb3B0aW9uIG1heSByZXN1bHQgaW4gdW5wcmVkaWN0YWJsZSBiZWhhdmlvci5cIik7XG5cdFx0XHR9XG5cblx0XHRcdGlmKHRoaXMub3B0aW9ucygnY29sdW1ucycpLmZpbHRlcigoY29sdW1uKSA9PiBjb2x1bW4uZnJvemVuKSA+IDEpIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiSGF2aW5nIG11bHRpcGxlIGZyb3plbiBjb2x1bW5zIHdpdGggc2VsZWN0UmFuZ2Ugb3B0aW9uIG1heSByZXN1bHQgaW4gdW5wcmVkaWN0YWJsZSBiZWhhdmlvci5cIik7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRcblx0aW5pdGlhbGl6ZVRhYmxlKCkge1x0XHRcblx0XHR0aGlzLm92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdHRoaXMub3ZlcmxheS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJhbmdlLW92ZXJsYXlcIik7XG5cdFx0XG5cdFx0dGhpcy5yYW5nZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0dGhpcy5yYW5nZUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJhbmdlLWNvbnRhaW5lclwiKTtcblx0XHRcblx0XHR0aGlzLmFjdGl2ZVJhbmdlQ2VsbEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdHRoaXMuYWN0aXZlUmFuZ2VDZWxsRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJhbmdlLWNlbGwtYWN0aXZlXCIpO1xuXHRcdFxuXHRcdHRoaXMub3ZlcmxheS5hcHBlbmRDaGlsZCh0aGlzLnJhbmdlQ29udGFpbmVyKTtcblx0XHR0aGlzLm92ZXJsYXkuYXBwZW5kQ2hpbGQodGhpcy5hY3RpdmVSYW5nZUNlbGxFbGVtZW50KTtcblx0XHRcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLmtleURvd25FdmVudCk7XG5cdFx0XG5cdFx0dGhpcy5yZXNldFJhbmdlcygpO1xuXHRcdFxuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMub3ZlcmxheSk7XG5cdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmVsZW1lbnQuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgMCk7XG5cdFx0dGhpcy50YWJsZS5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcmFuZ2VzXCIpO1xuXHR9XG5cdFxuXHRpbml0aWFsaXplV2F0Y2hlcnMoKSB7XG5cdFx0dGhpcy5jb2x1bW5TZWxlY3Rpb24gPSB0aGlzLm9wdGlvbnMoXCJzZWxlY3RhYmxlUmFuZ2VDb2x1bW5zXCIpO1xuXHRcdHRoaXMucm93U2VsZWN0aW9uID0gdGhpcy5vcHRpb25zKFwic2VsZWN0YWJsZVJhbmdlUm93c1wiKTtcblx0XHRcblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1pbml0XCIsIHRoaXMuaW5pdGlhbGl6ZUNvbHVtbi5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1tb3VzZWRvd25cIiwgdGhpcy5oYW5kbGVDb2x1bW5Nb3VzZURvd24uYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tbW91c2Vtb3ZlXCIsIHRoaXMuaGFuZGxlQ29sdW1uTW91c2VNb3ZlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLXJlc2l6ZWRcIiwgdGhpcy5oYW5kbGVDb2x1bW5SZXNpemVkLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLW1vdmluZ1wiLCB0aGlzLmhhbmRsZUNvbHVtbk1vdmluZy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1tb3ZlZFwiLCB0aGlzLmhhbmRsZUNvbHVtbk1vdmVkLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLXdpZHRoXCIsIHRoaXMubGF5b3V0Q2hhbmdlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWhlaWdodFwiLCB0aGlzLmxheW91dENoYW5nZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1yZXNpemVkXCIsIHRoaXMubGF5b3V0Q2hhbmdlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1ucy1sb2FkZWRcIiwgdGhpcy51cGRhdGVIZWFkZXJDb2x1bW4uYmluZCh0aGlzKSk7XG5cdFx0XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLWhlaWdodFwiLCB0aGlzLmxheW91dENoYW5nZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtcmVuZGVyZWRcIiwgdGhpcy5yZW5kZXJDZWxsLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1tb3VzZWRvd25cIiwgdGhpcy5oYW5kbGVDZWxsTW91c2VEb3duLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1tb3VzZW1vdmVcIiwgdGhpcy5oYW5kbGVDZWxsTW91c2VNb3ZlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1jbGlja1wiLCB0aGlzLmhhbmRsZUNlbGxDbGljay5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtZWRpdGluZ1wiLCB0aGlzLmhhbmRsZUVkaXRpbmdDZWxsLmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdHRoaXMuc3Vic2NyaWJlKFwicGFnZS1jaGFuZ2VkXCIsIHRoaXMucmVkcmF3LmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdHRoaXMuc3Vic2NyaWJlKFwic2Nyb2xsLXZlcnRpY2FsXCIsIHRoaXMubGF5b3V0Q2hhbmdlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwic2Nyb2xsLWhvcml6b250YWxcIiwgdGhpcy5sYXlvdXRDaGFuZ2UuYmluZCh0aGlzKSk7XG5cdFx0XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLWRlc3Ryb3lcIiwgdGhpcy50YWJsZURlc3Ryb3llZC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImRhdGEtcHJvY2Vzc2VkXCIsIHRoaXMucmVzZXRSYW5nZXMuYmluZCh0aGlzKSk7XG5cdFx0XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJ0YWJsZS1sYXlvdXRcIiwgdGhpcy5sYXlvdXRFbGVtZW50LmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtcmVkcmF3XCIsIHRoaXMucmVkcmF3LmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwidGFibGUtZGVzdHJveVwiLCB0aGlzLnRhYmxlRGVzdHJveWVkLmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdHRoaXMuc3Vic2NyaWJlKFwiZWRpdC1lZGl0b3ItY2xlYXJcIiwgdGhpcy5maW5pc2hFZGl0aW5nQ2VsbC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImVkaXQtYmx1clwiLCB0aGlzLnJlc3RvcmVGb2N1cy5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHR0aGlzLnN1YnNjcmliZShcImtleWJpbmRpbmctbmF2LXByZXZcIiwgdGhpcy5rZXlOYXZpZ2F0ZS5iaW5kKHRoaXMsIFwibGVmdFwiKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJrZXliaW5kaW5nLW5hdi1uZXh0XCIsIHRoaXMua2V5TmF2aWdhdGUuYmluZCh0aGlzLCBcInJpZ2h0XCIpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImtleWJpbmRpbmctbmF2LWxlZnRcIiwgdGhpcy5rZXlOYXZpZ2F0ZS5iaW5kKHRoaXMsIFwibGVmdFwiKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJrZXliaW5kaW5nLW5hdi1yaWdodFwiLCB0aGlzLmtleU5hdmlnYXRlLmJpbmQodGhpcywgXCJyaWdodFwiKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJrZXliaW5kaW5nLW5hdi11cFwiLCB0aGlzLmtleU5hdmlnYXRlLmJpbmQodGhpcywgXCJ1cFwiKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJrZXliaW5kaW5nLW5hdi1kb3duXCIsIHRoaXMua2V5TmF2aWdhdGUuYmluZCh0aGlzLCBcImRvd25cIikpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwia2V5YmluZGluZy1uYXYtcmFuZ2VcIiwgdGhpcy5rZXlOYXZpZ2F0ZVJhbmdlLmJpbmQodGhpcykpO1xuXHR9XG5cdFxuXHRcblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pIHtcblx0XHRpZih0aGlzLmNvbHVtblNlbGVjdGlvbiAmJiBjb2x1bW4uZGVmaW5pdGlvbi5oZWFkZXJTb3J0ICYmIHRoaXMub3B0aW9ucyhcImhlYWRlclNvcnRDbGlja0VsZW1lbnRcIikgIT09IFwiaWNvblwiKXtcblx0XHRcdGNvbnNvbGUud2FybihcIlVzaW5nIGNvbHVtbiBoZWFkZXJTb3J0IHdpdGggc2VsZWN0YWJsZVJhbmdlQ29sdW1ucyBvcHRpb24gbWF5IHJlc3VsdCBpbiB1bnByZWRpY3RhYmxlIGJlaGF2aW9yLiBDb25zaWRlciB1c2luZyBoZWFkZXJTb3J0Q2xpY2tFbGVtZW50OiAnaWNvbicuXCIpO1xuXHRcdH1cblx0XHRcblx0XHRpZiAoY29sdW1uLm1vZHVsZXMuZWRpdCkgO1xuXHR9XG5cdFxuXHR1cGRhdGVIZWFkZXJDb2x1bW4oKXtcblx0XHR2YXIgZnJvemVuQ29scztcblxuXHRcdGlmKHRoaXMucm93U2VsZWN0aW9uKXtcblx0XHRcdHRoaXMucm93SGVhZGVyID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldFZpc2libGVDb2x1bW5zQnlJbmRleCgpWzBdO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnJvd0hlYWRlcil7XG5cdFx0XHRcdHRoaXMucm93SGVhZGVyLmRlZmluaXRpb24uY3NzQ2xhc3MgPSB0aGlzLnJvd0hlYWRlci5kZWZpbml0aW9uLmNzc0NsYXNzICsgXCIgdGFidWxhdG9yLXJhbmdlLXJvdy1oZWFkZXJcIjtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMucm93SGVhZGVyLmRlZmluaXRpb24uaGVhZGVyU29ydCl7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiVXNpbmcgY29sdW1uIGhlYWRlclNvcnQgd2l0aCBzZWxlY3RhYmxlUmFuZ2VSb3dzIG9wdGlvbiBtYXkgcmVzdWx0IGluIHVucHJlZGljdGFibGUgYmVoYXZpb3JcIik7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKHRoaXMucm93SGVhZGVyLmRlZmluaXRpb24uZWRpdG9yKXtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJVc2luZyBjb2x1bW4gZWRpdG9yIHdpdGggc2VsZWN0YWJsZVJhbmdlUm93cyBvcHRpb24gbWF5IHJlc3VsdCBpbiB1bnByZWRpY3RhYmxlIGJlaGF2aW9yXCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly93YXJuIGlmIGludmFsaWQgZnJvemVuIGNvbHVtbiBjb25maWd1cmF0aW9uIGRldGVjdGVkXG5cdFx0aWYodGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMuYWN0aXZlKXtcblx0XHRcdGZyb3plbkNvbHMgPSB0aGlzLnRhYmxlLm1vZHVsZXMuZnJvemVuQ29sdW1ucy5nZXRGcm96ZW5Db2x1bW5zKCk7XG5cblx0XHRcdGlmKGZyb3plbkNvbHMubGVuZ3RoID4gMSB8fCAoZnJvemVuQ29scy5sZW5ndGggPT09IDEgJiYgZnJvemVuQ29sc1swXSAhPT0gdGhpcy5yb3dIZWFkZXIpKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiVXNpbmcgZnJvemVuIGNvbHVtbnMgdGhhdCBhcmUgbm90IHRoZSByYW5nZSBoZWFkZXIgaW4gY29tYmluYXRpb24gd2l0aCB0aGUgc2VsZWN0UmFuZ2Ugb3B0aW9uIG1heSByZXN1bHQgaW4gdW5wcmVkaWN0YWJsZSBiZWhhdmlvclwiKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8gICBUYWJsZSBGdW5jdGlvbnMgICAvLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRnZXRSYW5nZXMoKXtcblx0XHRyZXR1cm4gdGhpcy5yYW5nZXMubWFwKChyYW5nZSkgPT4gcmFuZ2UuZ2V0Q29tcG9uZW50KCkpO1xuXHR9XG5cdFxuXHRnZXRSYW5nZXNEYXRhKCkge1xuXHRcdHJldHVybiB0aGlzLnJhbmdlcy5tYXAoKHJhbmdlKSA9PiByYW5nZS5nZXREYXRhKCkpO1xuXHR9XG5cdFxuXHRhZGRSYW5nZUZyb21Db21wb25lbnQoc3RhcnQsIGVuZCl7XG5cdFx0c3RhcnQgPSBzdGFydCA/IHN0YXJ0Ll9jZWxsIDogbnVsbDtcblx0XHRlbmQgPSBlbmQgPyBlbmQuX2NlbGwgOiBudWxsO1xuXHRcdFxuXHRcdHJldHVybiB0aGlzLmFkZFJhbmdlKHN0YXJ0LCBlbmQpO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vIENvbXBvbmVudCBGdW5jdGlvbnMgLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0Y2VsbEdldFJhbmdlcyhjZWxsKXtcblx0XHR2YXIgcmFuZ2VzID0gW107XG5cdFx0XG5cdFx0aWYgKGNlbGwuY29sdW1uID09PSB0aGlzLnJvd0hlYWRlcikge1xuXHRcdFx0cmFuZ2VzID0gdGhpcy5yYW5nZXMuZmlsdGVyKChyYW5nZSkgPT4gcmFuZ2Uub2NjdXBpZXNSb3coY2VsbC5yb3cpKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmFuZ2VzID0gdGhpcy5yYW5nZXMuZmlsdGVyKChyYW5nZSkgPT4gcmFuZ2Uub2NjdXBpZXMoY2VsbCkpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gcmFuZ2VzLm1hcCgocmFuZ2UpID0+IHJhbmdlLmdldENvbXBvbmVudCgpKTtcblx0fVxuXHRcblx0cm93R2V0UmFuZ2VzKHJvdyl7XG5cdFx0dmFyIHJhbmdlcyA9IHRoaXMucmFuZ2VzLmZpbHRlcigocmFuZ2UpID0+IHJhbmdlLm9jY3VwaWVzUm93KHJvdykpO1xuXHRcdFxuXHRcdHJldHVybiByYW5nZXMubWFwKChyYW5nZSkgPT4gcmFuZ2UuZ2V0Q29tcG9uZW50KCkpO1xuXHR9XG5cdFxuXHRjb2xHZXRSYW5nZXMoY29sKXtcblx0XHR2YXIgcmFuZ2VzID0gdGhpcy5yYW5nZXMuZmlsdGVyKChyYW5nZSkgPT4gcmFuZ2Uub2NjdXBpZXNDb2x1bW4oY29sKSk7XG5cdFx0XG5cdFx0cmV0dXJuIHJhbmdlcy5tYXAoKHJhbmdlKSA9PiByYW5nZS5nZXRDb21wb25lbnQoKSk7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8gRXZlbnQgSGFuZGxlcnMgLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRfaGFuZGxlTW91c2VVcChlKXtcblx0XHR0aGlzLm1vdXNlZG93biA9IGZhbHNlO1xuXHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMubW91c2VVcEV2ZW50KTtcblx0fVxuXHRcblx0X2hhbmRsZUtleURvd24oZSkge1xuXHRcdGlmICghdGhpcy5ibG9ja0tleWRvd24gJiYgKCF0aGlzLnRhYmxlLm1vZHVsZXMuZWRpdCB8fCAodGhpcy50YWJsZS5tb2R1bGVzLmVkaXQgJiYgIXRoaXMudGFibGUubW9kdWxlcy5lZGl0LmN1cnJlbnRDZWxsKSkpIHtcblx0XHRcdGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG5cdFx0XHRcdC8vIGlzIGVkaXRpbmcgYSBjZWxsP1xuXHRcdFx0XHRpZiAodGhpcy50YWJsZS5tb2R1bGVzLmVkaXQgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5lZGl0LmVkaXRDZWxsKHRoaXMuZ2V0QWN0aXZlQ2VsbCgpKTtcblx0XHRcdFx0XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYgKChlLmtleSA9PT0gXCJCYWNrc3BhY2VcIiB8fCBlLmtleSA9PT0gXCJEZWxldGVcIikgJiYgdGhpcy5vcHRpb25zKFwic2VsZWN0YWJsZVJhbmdlQ2xlYXJDZWxsc1wiKSkge1xuXHRcdFx0XHRpZih0aGlzLmFjdGl2ZVJhbmdlKXtcblx0XHRcdFx0XHR0aGlzLmFjdGl2ZVJhbmdlLmNsZWFyVmFsdWVzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGluaXRpYWxpemVGb2N1cyhjZWxsKXtcblx0XHR2YXIgcmFuZ2U7XG5cblx0XHR0aGlzLnJlc3RvcmVGb2N1cygpO1xuXHRcdFxuXHRcdHRyeXtcblx0XHRcdGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHsgLy8gSUVcblx0XHRcdFx0cmFuZ2UgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuXHRcdFx0XHRyYW5nZS5tb3ZlVG9FbGVtZW50VGV4dChjZWxsLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdHJhbmdlLnNlbGVjdCgpO1xuXHRcdFx0fSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XG5cdFx0XHRcdHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcblx0XHRcdFx0cmFuZ2Uuc2VsZWN0Tm9kZShjZWxsLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcblx0XHRcdFx0d2luZG93LmdldFNlbGVjdGlvbigpLmFkZFJhbmdlKHJhbmdlKTtcblx0XHRcdH1cblx0XHR9Y2F0Y2goZSl7fVxuXHR9XG5cdFxuXHRyZXN0b3JlRm9jdXMoZWxlbWVudCl7XG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuZm9jdXMoKTtcblx0XHRcblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vIENvbHVtbiBGdW5jdGlvbmFsaXR5IC8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdGhhbmRsZUNvbHVtblJlc2l6ZWQoY29sdW1uKSB7XG5cdFx0dmFyIHNlbGVjdGVkO1xuXHRcdFxuXHRcdGlmICh0aGlzLnNlbGVjdGluZyAhPT0gXCJjb2x1bW5cIiAmJiB0aGlzLnNlbGVjdGluZyAhPT0gXCJhbGxcIikge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRcblx0XHRzZWxlY3RlZCA9IHRoaXMucmFuZ2VzLnNvbWUoKHJhbmdlKSA9PiByYW5nZS5vY2N1cGllc0NvbHVtbihjb2x1bW4pKTtcblx0XHRcblx0XHRpZiAoIXNlbGVjdGVkKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMucmFuZ2VzLmZvckVhY2goKHJhbmdlKSA9PiB7XG5cdFx0XHR2YXIgc2VsZWN0ZWRDb2x1bW5zID0gcmFuZ2UuZ2V0Q29sdW1ucyh0cnVlKTtcblx0XHRcdFxuXHRcdFx0c2VsZWN0ZWRDb2x1bW5zLmZvckVhY2goKHNlbGVjdGVkQ29sdW1uKSA9PiB7XG5cdFx0XHRcdGlmIChzZWxlY3RlZENvbHVtbiAhPT0gY29sdW1uKSB7XG5cdFx0XHRcdFx0c2VsZWN0ZWRDb2x1bW4uc2V0V2lkdGgoY29sdW1uLndpZHRoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdGhhbmRsZUNvbHVtbk1vdmluZyhfZXZlbnQsIGNvbHVtbikge1xuXHRcdHRoaXMucmVzZXRSYW5nZXMoKS5zZXRCb3VuZHMoY29sdW1uKTtcblx0XHR0aGlzLm92ZXJsYXkuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG5cdH1cblxuXHRoYW5kbGVDb2x1bW5Nb3ZlZChmcm9tLCBfdG8sIF9hZnRlcikge1xuXHRcdHRoaXMuYWN0aXZlUmFuZ2Uuc2V0Qm91bmRzKGZyb20pO1xuXHRcdHRoaXMubGF5b3V0RWxlbWVudCgpO1xuXHR9XG5cblx0aGFuZGxlQ29sdW1uTW91c2VEb3duKGV2ZW50LCBjb2x1bW4pIHtcblx0XHRpZiAoZXZlbnQuYnV0dG9uID09PSAyICYmICh0aGlzLnNlbGVjdGluZyA9PT0gXCJjb2x1bW5cIiB8fCB0aGlzLnNlbGVjdGluZyA9PT0gXCJhbGxcIikgJiYgdGhpcy5hY3RpdmVSYW5nZS5vY2N1cGllc0NvbHVtbihjb2x1bW4pKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Ly9JZiBjb2x1bW5zIGFyZSBtb3ZhYmxlLCBhbGxvdyBkcmFnZ2luZyBjb2x1bW5zIG9ubHkgaWYgdGhleSBhcmUgbm90XG5cdFx0Ly9zZWxlY3RlZC4gRHJhZ2dpbmcgc2VsZWN0ZWQgY29sdW1ucyBzaG91bGQgbW92ZSB0aGUgY29sdW1ucyBpbnN0ZWFkLlxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5tb3ZhYmxlQ29sdW1ucyAmJiB0aGlzLnNlbGVjdGluZyA9PT0gXCJjb2x1bW5cIiAmJiB0aGlzLmFjdGl2ZVJhbmdlLm9jY3VwaWVzQ29sdW1uKGNvbHVtbikpe1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLm1vdXNlZG93biA9IHRydWU7XG5cdFx0XG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5tb3VzZVVwRXZlbnQpO1xuXHRcdFxuXHRcdHRoaXMubmV3U2VsZWN0aW9uKGV2ZW50LCBjb2x1bW4pO1xuXHR9XG5cdFxuXHRoYW5kbGVDb2x1bW5Nb3VzZU1vdmUoZSwgY29sdW1uKSB7XG5cdFx0aWYgKGNvbHVtbiA9PT0gdGhpcy5yb3dIZWFkZXIgfHwgIXRoaXMubW91c2Vkb3duIHx8IHRoaXMuc2VsZWN0aW5nID09PSAnYWxsJykge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLmFjdGl2ZVJhbmdlLnNldEJvdW5kcyhmYWxzZSwgY29sdW1uLCB0cnVlKTtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8gQ2VsbCBGdW5jdGlvbmFsaXR5IC8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdHJlbmRlckNlbGwoY2VsbCkge1xuXHRcdHZhciBlbCA9IGNlbGwuZ2V0RWxlbWVudCgpLFxuXHRcdHJhbmdlSWR4ID0gdGhpcy5yYW5nZXMuZmluZEluZGV4KChyYW5nZSkgPT4gcmFuZ2Uub2NjdXBpZXMoY2VsbCkpO1xuXHRcdFxuXHRcdGVsLmNsYXNzTGlzdC50b2dnbGUoXCJ0YWJ1bGF0b3ItcmFuZ2Utc2VsZWN0ZWRcIiwgcmFuZ2VJZHggIT09IC0xKTtcblx0XHRlbC5jbGFzc0xpc3QudG9nZ2xlKFwidGFidWxhdG9yLXJhbmdlLW9ubHktY2VsbC1zZWxlY3RlZFwiLCB0aGlzLnJhbmdlcy5sZW5ndGggPT09IDEgJiYgdGhpcy5yYW5nZXNbMF0uYXRUb3BMZWZ0KGNlbGwpICYmXHR0aGlzLnJhbmdlc1swXS5hdEJvdHRvbVJpZ2h0KGNlbGwpKTtcblx0XHRcblx0XHRlbC5kYXRhc2V0LnJhbmdlID0gcmFuZ2VJZHg7XG5cdH1cblx0XG5cdGhhbmRsZUNlbGxNb3VzZURvd24oZXZlbnQsIGNlbGwpIHtcblx0XHRpZiAoZXZlbnQuYnV0dG9uID09PSAyICYmICh0aGlzLmFjdGl2ZVJhbmdlLm9jY3VwaWVzKGNlbGwpIHx8ICgodGhpcy5zZWxlY3RpbmcgPT09IFwicm93XCIgfHwgdGhpcy5zZWxlY3RpbmcgPT09IFwiYWxsXCIpICYmIHRoaXMuYWN0aXZlUmFuZ2Uub2NjdXBpZXNSb3coY2VsbC5yb3cpKSkpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5tb3VzZWRvd24gPSB0cnVlO1xuXHRcdFxuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMubW91c2VVcEV2ZW50KTtcblx0XHRcblx0XHR0aGlzLm5ld1NlbGVjdGlvbihldmVudCwgY2VsbCk7XG5cdH1cblx0XG5cdGhhbmRsZUNlbGxNb3VzZU1vdmUoZSwgY2VsbCkge1xuXHRcdGlmICghdGhpcy5tb3VzZWRvd24gfHwgdGhpcy5zZWxlY3RpbmcgPT09IFwiYWxsXCIpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5hY3RpdmVSYW5nZS5zZXRCb3VuZHMoZmFsc2UsIGNlbGwsIHRydWUpO1xuXHR9XG5cdFxuXHRoYW5kbGVDZWxsQ2xpY2soZSwgY2VsbCl7XG5cdFx0dGhpcy5pbml0aWFsaXplRm9jdXMoY2VsbCk7XG5cdH1cblx0XG5cdGhhbmRsZUVkaXRpbmdDZWxsKGNlbGwpIHtcblx0XHRpZih0aGlzLmFjdGl2ZVJhbmdlKXtcblx0XHRcdHRoaXMuYWN0aXZlUmFuZ2Uuc2V0Qm91bmRzKGNlbGwpO1xuXHRcdH1cblx0fVxuXHRcblx0ZmluaXNoRWRpdGluZ0NlbGwoKSB7XG5cdFx0dGhpcy5ibG9ja0tleWRvd24gPSB0cnVlO1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmZvY3VzKCk7XG5cdFx0XG5cdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHR0aGlzLmJsb2NrS2V5ZG93biA9IGZhbHNlO1xuXHRcdH0sIDEwKTtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLyAgICAgTmF2aWdhdGlvbiAgICAgIC8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdGtleU5hdmlnYXRlKGRpciwgZSl7XG5cdFx0aWYodGhpcy5uYXZpZ2F0ZShmYWxzZSwgZmFsc2UsIGRpcikpO1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0fVxuXHRcblx0a2V5TmF2aWdhdGVSYW5nZShlLCBkaXIsIGp1bXAsIGV4cGFuZCl7XG5cdFx0aWYodGhpcy5uYXZpZ2F0ZShqdW1wLCBleHBhbmQsIGRpcikpO1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0fVxuXHRcblx0bmF2aWdhdGUoanVtcCwgZXhwYW5kLCBkaXIpIHtcblx0XHR2YXIgbW92ZWQgPSBmYWxzZSxcblx0XHRyYW5nZSwgcmFuZ2VFZGdlLCBwcmV2UmVjdCwgbmV4dFJvdywgbmV4dENvbCwgcm93LCBjb2x1bW4sXG5cdFx0cm93UmVjdCwgcm93TWFuYWdlclJlY3QsIGNvbHVtblJlY3QsIGNvbHVtbk1hbmFnZXJSZWN0O1xuXHRcdFxuXHRcdC8vIERvbid0IG5hdmlnYXRlIHdoaWxlIGVkaXRpbmdcblx0XHRpZiAodGhpcy50YWJsZS5tb2R1bGVzLmVkaXQgJiYgdGhpcy50YWJsZS5tb2R1bGVzLmVkaXQuY3VycmVudENlbGwpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdFx0XG5cdFx0Ly8gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiAxIHJhbmdlLCB1c2UgdGhlIGFjdGl2ZSByYW5nZSBhbmQgZGVzdHJveSB0aGUgb3RoZXJzXG5cdFx0aWYgKHRoaXMucmFuZ2VzLmxlbmd0aCA+IDEpIHtcblx0XHRcdHRoaXMucmFuZ2VzID0gdGhpcy5yYW5nZXMuZmlsdGVyKChyYW5nZSkgPT4ge1xuXHRcdFx0XHRpZiAocmFuZ2UgPT09IHRoaXMuYWN0aXZlUmFuZ2UpIHtcblx0XHRcdFx0XHRyYW5nZS5zZXRFbmQocmFuZ2Uuc3RhcnQucm93LCByYW5nZS5zdGFydC5jb2wpO1xuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJhbmdlLmRlc3Ryb3koKTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdFxuXHRcdHJhbmdlID0gdGhpcy5hY3RpdmVSYW5nZTtcblx0XHRwcmV2UmVjdCA9IHtcblx0XHRcdHRvcDogcmFuZ2UudG9wLFxuXHRcdFx0Ym90dG9tOiByYW5nZS5ib3R0b20sXG5cdFx0XHRsZWZ0OiByYW5nZS5sZWZ0LFxuXHRcdFx0cmlnaHQ6IHJhbmdlLnJpZ2h0XG5cdFx0fTtcblx0XHRcblx0XHRyYW5nZUVkZ2UgPSBleHBhbmQgPyByYW5nZS5lbmQgOiByYW5nZS5zdGFydDtcblx0XHRuZXh0Um93ID0gcmFuZ2VFZGdlLnJvdztcblx0XHRuZXh0Q29sID0gcmFuZ2VFZGdlLmNvbDtcblx0XHRcblx0XHRpZihqdW1wKXtcblx0XHRcdHN3aXRjaChkaXIpe1xuXHRcdFx0XHRjYXNlIFwibGVmdFwiOlxuXHRcdFx0XHRcdG5leHRDb2wgPSB0aGlzLmZpbmRKdW1wQ2VsbExlZnQocmFuZ2Uuc3RhcnQucm93LCByYW5nZUVkZ2UuY29sKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcInJpZ2h0XCI6XG5cdFx0XHRcdFx0bmV4dENvbCA9IHRoaXMuZmluZEp1bXBDZWxsUmlnaHQocmFuZ2Uuc3RhcnQucm93LCByYW5nZUVkZ2UuY29sKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcInVwXCI6XG5cdFx0XHRcdFx0bmV4dFJvdyA9IHRoaXMuZmluZEp1bXBDZWxsVXAocmFuZ2VFZGdlLnJvdywgcmFuZ2Uuc3RhcnQuY29sKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcImRvd25cIjpcblx0XHRcdFx0XHRuZXh0Um93ID0gdGhpcy5maW5kSnVtcENlbGxEb3duKHJhbmdlRWRnZS5yb3csIHJhbmdlLnN0YXJ0LmNvbCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0aWYoZXhwYW5kKXtcblx0XHRcdFx0aWYgKCh0aGlzLnNlbGVjdGluZyA9PT0gJ3JvdycgJiYgKGRpciA9PT0gJ2xlZnQnIHx8IGRpciA9PT0gJ3JpZ2h0JykpIHx8ICh0aGlzLnNlbGVjdGluZyA9PT0gJ2NvbHVtbicgJiYgKGRpciA9PT0gJ3VwJyB8fCBkaXIgPT09ICdkb3duJykpKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHN3aXRjaChkaXIpe1xuXHRcdFx0XHRjYXNlIFwibGVmdFwiOlxuXHRcdFx0XHRcdG5leHRDb2wgPSBNYXRoLm1heChuZXh0Q29sIC0gMSwgMCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJyaWdodFwiOlxuXHRcdFx0XHRcdG5leHRDb2wgPSBNYXRoLm1pbihuZXh0Q29sICsgMSwgdGhpcy5nZXRUYWJsZUNvbHVtbnMoKS5sZW5ndGggLSAxKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcInVwXCI6XG5cdFx0XHRcdFx0bmV4dFJvdyA9IE1hdGgubWF4KG5leHRSb3cgLSAxLCAwKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcImRvd25cIjpcblx0XHRcdFx0XHRuZXh0Um93ID0gTWF0aC5taW4obmV4dFJvdyArIDEsIHRoaXMuZ2V0VGFibGVSb3dzKCkubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYodGhpcy5yb3dIZWFkZXIgJiYgbmV4dENvbCA9PT0gMCkge1xuXHRcdFx0bmV4dENvbCA9IDE7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCFleHBhbmQpe1xuXHRcdFx0cmFuZ2Uuc2V0U3RhcnQobmV4dFJvdywgbmV4dENvbCk7XG5cdFx0fVxuXHRcdFxuXHRcdHJhbmdlLnNldEVuZChuZXh0Um93LCBuZXh0Q29sKTtcblx0XHRcblx0XHRpZighZXhwYW5kKXtcblx0XHRcdHRoaXMuc2VsZWN0aW5nID0gXCJjZWxsXCI7XG5cdFx0fVxuXG5cdFx0bW92ZWQgPSBwcmV2UmVjdC50b3AgIT09IHJhbmdlLnRvcCB8fCBwcmV2UmVjdC5ib3R0b20gIT09IHJhbmdlLmJvdHRvbSB8fCBwcmV2UmVjdC5sZWZ0ICE9PSByYW5nZS5sZWZ0IHx8IHByZXZSZWN0LnJpZ2h0ICE9PSByYW5nZS5yaWdodDtcblxuXHRcdGlmIChtb3ZlZCkge1xuXHRcdFx0cm93ID0gdGhpcy5nZXRSb3dCeVJhbmdlUG9zKHJhbmdlLmVuZC5yb3cpO1xuXHRcdFx0Y29sdW1uID0gdGhpcy5nZXRDb2x1bW5CeVJhbmdlUG9zKHJhbmdlLmVuZC5jb2wpO1xuXHRcdFx0cm93UmVjdCA9IHJvdy5nZXRFbGVtZW50KCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cdFx0XHRjb2x1bW5SZWN0ID0gY29sdW1uLmdldEVsZW1lbnQoKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblx0XHRcdHJvd01hbmFnZXJSZWN0ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldEVsZW1lbnQoKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblx0XHRcdGNvbHVtbk1hbmFnZXJSZWN0ID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldEVsZW1lbnQoKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblx0XHRcdFxuXHRcdFx0aWYoIShyb3dSZWN0LnRvcCA+PSByb3dNYW5hZ2VyUmVjdC50b3AgJiYgcm93UmVjdC5ib3R0b20gPD0gcm93TWFuYWdlclJlY3QuYm90dG9tKSl7XG5cdFx0XHRcdGlmKHJvdy5nZXRFbGVtZW50KCkucGFyZW50Tm9kZSAmJiBjb2x1bW4uZ2V0RWxlbWVudCgpLnBhcmVudE5vZGUpe1xuXHRcdFx0XHRcdC8vIFVzZSBmYXN0ZXIgYXV0b1Njcm9sbCB3aGVuIHRoZSBlbGVtZW50cyBhcmUgb24gdGhlIERPTVxuXHRcdFx0XHRcdHRoaXMuYXV0b1Njcm9sbChyYW5nZSwgcm93LmdldEVsZW1lbnQoKSwgY29sdW1uLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRyb3cuZ2V0Q29tcG9uZW50KCkuc2Nyb2xsVG8odW5kZWZpbmVkLCBmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYoIShjb2x1bW5SZWN0LmxlZnQgPj0gY29sdW1uTWFuYWdlclJlY3QubGVmdCArIHRoaXMuZ2V0Um93SGVhZGVyV2lkdGgoKSAmJiBjb2x1bW5SZWN0LnJpZ2h0IDw9IGNvbHVtbk1hbmFnZXJSZWN0LnJpZ2h0KSl7XG5cdFx0XHRcdGlmKHJvdy5nZXRFbGVtZW50KCkucGFyZW50Tm9kZSAmJiBjb2x1bW4uZ2V0RWxlbWVudCgpLnBhcmVudE5vZGUpe1xuXHRcdFx0XHRcdC8vIFVzZSBmYXN0ZXIgYXV0b1Njcm9sbCB3aGVuIHRoZSBlbGVtZW50cyBhcmUgb24gdGhlIERPTVxuXHRcdFx0XHRcdHRoaXMuYXV0b1Njcm9sbChyYW5nZSwgcm93LmdldEVsZW1lbnQoKSwgY29sdW1uLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRjb2x1bW4uZ2V0Q29tcG9uZW50KCkuc2Nyb2xsVG8odW5kZWZpbmVkLCBmYWxzZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0dGhpcy5sYXlvdXRFbGVtZW50KCk7XG5cdFx0XHRcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0fVxuXHRcblx0cmFuZ2VSZW1vdmVkKHJlbW92ZWQpe1xuXHRcdHRoaXMucmFuZ2VzID0gdGhpcy5yYW5nZXMuZmlsdGVyKChyYW5nZSkgPT4gcmFuZ2UgIT09IHJlbW92ZWQpO1xuXHRcdFxuXHRcdGlmKHRoaXMuYWN0aXZlUmFuZ2UgPT09IHJlbW92ZWQpe1xuXHRcdFx0aWYodGhpcy5yYW5nZXMubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy5hY3RpdmVSYW5nZSA9IHRoaXMucmFuZ2VzW3RoaXMucmFuZ2VzLmxlbmd0aCAtIDFdO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmFkZFJhbmdlKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMubGF5b3V0RWxlbWVudCgpO1xuXHR9XG5cdFxuXHRmaW5kSnVtcFJvdyhjb2x1bW4sIHJvd3MsIHJldmVyc2UsIGVtcHR5U3RhcnQsIGVtcHR5U2lkZSl7XG5cdFx0aWYocmV2ZXJzZSl7XG5cdFx0XHRyb3dzID0gcm93cy5yZXZlcnNlKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuZmluZEp1bXBJdGVtKGVtcHR5U3RhcnQsIGVtcHR5U2lkZSwgcm93cywgZnVuY3Rpb24ocm93KXtyZXR1cm4gcm93LmdldERhdGEoKVtjb2x1bW4uZ2V0RmllbGQoKV07fSk7XG5cdH1cblx0XG5cdGZpbmRKdW1wQ29sKHJvdywgY29sdW1ucywgcmV2ZXJzZSwgZW1wdHlTdGFydCwgZW1wdHlTaWRlKXtcblx0XHRpZihyZXZlcnNlKXtcblx0XHRcdGNvbHVtbnMgPSBjb2x1bW5zLnJldmVyc2UoKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5maW5kSnVtcEl0ZW0oZW1wdHlTdGFydCwgZW1wdHlTaWRlLCBjb2x1bW5zLCBmdW5jdGlvbihjb2x1bW4pe3JldHVybiByb3cuZ2V0RGF0YSgpW2NvbHVtbi5nZXRGaWVsZCgpXTt9KTtcblx0fVxuXG5cdGZpbmRKdW1wSXRlbShlbXB0eVN0YXJ0LCBlbXB0eVNpZGUsIGl0ZW1zLCB2YWx1ZVJlc29sdmVyKXtcblx0XHR2YXIgbmV4dEl0ZW07XG5cblx0XHRmb3IobGV0IGN1cnJlbnRJdGVtIG9mIGl0ZW1zKXtcblx0XHRcdGxldCBjdXJyZW50VmFsdWUgPSB2YWx1ZVJlc29sdmVyKGN1cnJlbnRJdGVtKTtcblx0XHRcdFxuXHRcdFx0aWYoZW1wdHlTdGFydCl7XG5cdFx0XHRcdG5leHRJdGVtID0gY3VycmVudEl0ZW07XG5cdFx0XHRcdGlmKGN1cnJlbnRWYWx1ZSl7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYoZW1wdHlTaWRlKXtcblx0XHRcdFx0XHRuZXh0SXRlbSA9IGN1cnJlbnRJdGVtO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKGN1cnJlbnRWYWx1ZSl7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRpZihjdXJyZW50VmFsdWUpe1xuXHRcdFx0XHRcdFx0bmV4dEl0ZW0gPSBjdXJyZW50SXRlbTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbmV4dEl0ZW07XG5cdH1cblxuXHRmaW5kSnVtcENlbGxMZWZ0KHJvd1BvcywgY29sUG9zKXtcblx0XHR2YXIgcm93ID0gdGhpcy5nZXRSb3dCeVJhbmdlUG9zKHJvd1BvcyksXG5cdFx0Y29sdW1ucyA9IHRoaXMuZ2V0VGFibGVDb2x1bW5zKCksXG5cdFx0aXNTdGFydGluZ0NlbGxFbXB0eSA9IHRoaXMuaXNFbXB0eShyb3cuZ2V0RGF0YSgpW2NvbHVtbnNbY29sUG9zXS5nZXRGaWVsZCgpXSksXG5cdFx0aXNMZWZ0T2ZTdGFydGluZ0NlbGxFbXB0eSA9IGNvbHVtbnNbY29sUG9zIC0gMV0gPyB0aGlzLmlzRW1wdHkocm93LmdldERhdGEoKVtjb2x1bW5zW2NvbFBvcyAtIDFdLmdldEZpZWxkKCldKSA6IGZhbHNlLFxuXHRcdHRhcmdldENvbHMgPSB0aGlzLnJvd0hlYWRlciA/IGNvbHVtbnMuc2xpY2UoMSwgY29sUG9zKSA6IGNvbHVtbnMuc2xpY2UoMCwgY29sUG9zKSxcblx0XHRqdW1wQ29sID0gdGhpcy5maW5kSnVtcENvbChyb3csIHRhcmdldENvbHMsIHRydWUsIGlzU3RhcnRpbmdDZWxsRW1wdHksIGlzTGVmdE9mU3RhcnRpbmdDZWxsRW1wdHkpO1xuXHRcdFxuXHRcdGlmKGp1bXBDb2wpe1xuXHRcdFx0cmV0dXJuIGp1bXBDb2wuZ2V0UG9zaXRpb24oKSAtIDE7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBjb2xQb3M7XG5cdH1cblx0XG5cdGZpbmRKdW1wQ2VsbFJpZ2h0KHJvd1BvcywgY29sUG9zKXtcblx0XHR2YXIgcm93ID0gdGhpcy5nZXRSb3dCeVJhbmdlUG9zKHJvd1BvcyksXG5cdFx0Y29sdW1ucyA9IHRoaXMuZ2V0VGFibGVDb2x1bW5zKCksXG5cdFx0aXNTdGFydGluZ0NlbGxFbXB0eSA9IHRoaXMuaXNFbXB0eShyb3cuZ2V0RGF0YSgpW2NvbHVtbnNbY29sUG9zXS5nZXRGaWVsZCgpXSksXG5cdFx0aXNSaWdodE9mU3RhcnRpbmdDZWxsRW1wdHkgPSBjb2x1bW5zW2NvbFBvcyArIDFdID8gdGhpcy5pc0VtcHR5KHJvdy5nZXREYXRhKClbY29sdW1uc1tjb2xQb3MgKyAxXS5nZXRGaWVsZCgpXSkgOiBmYWxzZSxcblx0XHRqdW1wQ29sID0gdGhpcy5maW5kSnVtcENvbChyb3csIGNvbHVtbnMuc2xpY2UoY29sUG9zICsgMSwgY29sdW1ucy5sZW5ndGgpLCBmYWxzZSwgaXNTdGFydGluZ0NlbGxFbXB0eSwgaXNSaWdodE9mU3RhcnRpbmdDZWxsRW1wdHkpO1xuXHRcdFxuXHRcdGlmKGp1bXBDb2wpe1xuXHRcdFx0cmV0dXJuIGp1bXBDb2wuZ2V0UG9zaXRpb24oKSAtIDE7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBjb2xQb3M7XG5cdH1cblx0XG5cdGZpbmRKdW1wQ2VsbFVwKHJvd1BvcywgY29sUG9zKSB7XG5cdFx0dmFyIGNvbHVtbiA9IHRoaXMuZ2V0Q29sdW1uQnlSYW5nZVBvcyhjb2xQb3MpLFxuXHRcdHJvd3MgPSB0aGlzLmdldFRhYmxlUm93cygpLFxuXHRcdGlzU3RhcnRpbmdDZWxsRW1wdHkgPSB0aGlzLmlzRW1wdHkocm93c1tyb3dQb3NdLmdldERhdGEoKVtjb2x1bW4uZ2V0RmllbGQoKV0pLFxuXHRcdGlzVG9wT2ZTdGFydGluZ0NlbGxFbXB0eSA9IHJvd3Nbcm93UG9zIC0gMV0gPyB0aGlzLmlzRW1wdHkocm93c1tyb3dQb3MgLSAxXS5nZXREYXRhKClbY29sdW1uLmdldEZpZWxkKCldKSA6IGZhbHNlLFxuXHRcdGp1bXBSb3cgPSB0aGlzLmZpbmRKdW1wUm93KGNvbHVtbiwgcm93cy5zbGljZSgwLCByb3dQb3MpLCB0cnVlLCBpc1N0YXJ0aW5nQ2VsbEVtcHR5LCBpc1RvcE9mU3RhcnRpbmdDZWxsRW1wdHkpO1xuXHRcdFxuXHRcdGlmKGp1bXBSb3cpe1xuXHRcdFx0cmV0dXJuIGp1bXBSb3cucG9zaXRpb24gLSAxO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gcm93UG9zO1xuXHR9XG5cdFxuXHRmaW5kSnVtcENlbGxEb3duKHJvd1BvcywgY29sUG9zKSB7XG5cdFx0dmFyIGNvbHVtbiA9IHRoaXMuZ2V0Q29sdW1uQnlSYW5nZVBvcyhjb2xQb3MpLFxuXHRcdHJvd3MgPSB0aGlzLmdldFRhYmxlUm93cygpLFxuXHRcdGlzU3RhcnRpbmdDZWxsRW1wdHkgPSB0aGlzLmlzRW1wdHkocm93c1tyb3dQb3NdLmdldERhdGEoKVtjb2x1bW4uZ2V0RmllbGQoKV0pLFxuXHRcdGlzQm90dG9tT2ZTdGFydGluZ0NlbGxFbXB0eSA9IHJvd3Nbcm93UG9zICsgMV0gPyB0aGlzLmlzRW1wdHkocm93c1tyb3dQb3MgKyAxXS5nZXREYXRhKClbY29sdW1uLmdldEZpZWxkKCldKSA6IGZhbHNlLFxuXHRcdGp1bXBSb3cgPSB0aGlzLmZpbmRKdW1wUm93KGNvbHVtbiwgcm93cy5zbGljZShyb3dQb3MgKyAxLCByb3dzLmxlbmd0aCksIGZhbHNlLCBpc1N0YXJ0aW5nQ2VsbEVtcHR5LCBpc0JvdHRvbU9mU3RhcnRpbmdDZWxsRW1wdHkpO1xuXHRcdFxuXHRcdGlmKGp1bXBSb3cpe1xuXHRcdFx0cmV0dXJuIGp1bXBSb3cucG9zaXRpb24gLSAxO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gcm93UG9zO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vICAgICAgU2VsZWN0aW9uICAgICAgLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRuZXdTZWxlY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcblx0XHR2YXIgcmFuZ2U7XG5cdFx0XG5cdFx0aWYgKGVsZW1lbnQudHlwZSA9PT0gXCJjb2x1bW5cIikge1xuXHRcdFx0aWYoIXRoaXMuY29sdW1uU2VsZWN0aW9uKXtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZiAoZWxlbWVudCA9PT0gdGhpcy5yb3dIZWFkZXIpIHtcblx0XHRcdFx0cmFuZ2UgPSB0aGlzLnJlc2V0UmFuZ2VzKCk7XG5cdFx0XHRcdHRoaXMuc2VsZWN0aW5nID0gXCJhbGxcIjtcblx0XHRcdFx0XG5cdFx0XHRcdHZhciB0b3BMZWZ0Q2VsbCwgYm90dG9tUmlnaHRDZWxsID0gdGhpcy5nZXRDZWxsKC0xLCAtMSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih0aGlzLnJvd0hlYWRlcil7XG5cdFx0XHRcdFx0dG9wTGVmdENlbGwgPSB0aGlzLmdldENlbGwoMCwgMSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR0b3BMZWZ0Q2VsbCA9IHRoaXMuZ2V0Q2VsbCgwLCAwKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0cmFuZ2Uuc2V0Qm91bmRzKHRvcExlZnRDZWxsLCBib3R0b21SaWdodENlbGwpO1x0XHRcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5zZWxlY3RpbmcgPSBcImNvbHVtblwiO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZiAoZWxlbWVudC5jb2x1bW4gPT09IHRoaXMucm93SGVhZGVyKSB7XG5cdFx0XHR0aGlzLnNlbGVjdGluZyA9IFwicm93XCI7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuc2VsZWN0aW5nID0gXCJjZWxsXCI7XG5cdFx0fVxuXHRcdFxuXHRcdGlmIChldmVudC5zaGlmdEtleSkge1xuXHRcdFx0dGhpcy5hY3RpdmVSYW5nZS5zZXRCb3VuZHMoZmFsc2UsIGVsZW1lbnQpO1xuXHRcdH0gZWxzZSBpZiAoZXZlbnQuY3RybEtleSkge1xuXHRcdFx0dGhpcy5hZGRSYW5nZSgpLnNldEJvdW5kcyhlbGVtZW50KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5yZXNldFJhbmdlcygpLnNldEJvdW5kcyhlbGVtZW50KTtcblx0XHR9XG5cdH1cblx0XG5cdGF1dG9TY3JvbGwocmFuZ2UsIHJvdywgY29sdW1uKSB7XG5cdFx0dmFyIHRhYmxlSG9sZGVyID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQsXG5cdFx0cmVjdCwgdmlldywgd2l0aGluSG9yaXpvbnRhbFZpZXcsIHdpdGhpblZlcnRpY2FsVmlldztcblx0XHRcblx0XHRpZiAodHlwZW9mIHJvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdHJvdyA9IHRoaXMuZ2V0Um93QnlSYW5nZVBvcyhyYW5nZS5lbmQucm93KS5nZXRFbGVtZW50KCk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmICh0eXBlb2YgY29sdW1uID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0Y29sdW1uID0gdGhpcy5nZXRDb2x1bW5CeVJhbmdlUG9zKHJhbmdlLmVuZC5jb2wpLmdldEVsZW1lbnQoKTtcblx0XHR9XG5cdFx0XG5cdFx0cmVjdCA9IHtcblx0XHRcdGxlZnQ6IGNvbHVtbi5vZmZzZXRMZWZ0LFxuXHRcdFx0cmlnaHQ6IGNvbHVtbi5vZmZzZXRMZWZ0ICsgY29sdW1uLm9mZnNldFdpZHRoLFxuXHRcdFx0dG9wOiByb3cub2Zmc2V0VG9wLFxuXHRcdFx0Ym90dG9tOiByb3cub2Zmc2V0VG9wICsgcm93Lm9mZnNldEhlaWdodCxcblx0XHR9O1xuXHRcdFxuXHRcdHZpZXcgPSB7XG5cdFx0XHRsZWZ0OiB0YWJsZUhvbGRlci5zY3JvbGxMZWZ0ICsgdGhpcy5nZXRSb3dIZWFkZXJXaWR0aCgpLFxuXHRcdFx0cmlnaHQ6IE1hdGguY2VpbCh0YWJsZUhvbGRlci5zY3JvbGxMZWZ0ICsgdGFibGVIb2xkZXIuY2xpZW50V2lkdGgpLFxuXHRcdFx0dG9wOiB0YWJsZUhvbGRlci5zY3JvbGxUb3AsXG5cdFx0XHRib3R0b206XHR0YWJsZUhvbGRlci5zY3JvbGxUb3AgK1x0dGFibGVIb2xkZXIub2Zmc2V0SGVpZ2h0IC0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbGJhcldpZHRoLFxuXHRcdH07XG5cdFx0XG5cdFx0d2l0aGluSG9yaXpvbnRhbFZpZXcgPSB2aWV3LmxlZnQgPCByZWN0LmxlZnQgJiZcdHJlY3QubGVmdCA8IHZpZXcucmlnaHQgJiYgdmlldy5sZWZ0IDwgcmVjdC5yaWdodCAmJlx0cmVjdC5yaWdodCA8IHZpZXcucmlnaHQ7XG5cdFx0XG5cdFx0d2l0aGluVmVydGljYWxWaWV3ID0gdmlldy50b3AgPCByZWN0LnRvcCAmJlx0cmVjdC50b3AgPCB2aWV3LmJvdHRvbSAmJiB2aWV3LnRvcCA8IHJlY3QuYm90dG9tICYmXHRyZWN0LmJvdHRvbSA8IHZpZXcuYm90dG9tO1xuXHRcdFxuXHRcdGlmICghd2l0aGluSG9yaXpvbnRhbFZpZXcpIHtcblx0XHRcdGlmIChyZWN0LmxlZnQgPCB2aWV3LmxlZnQpIHtcblx0XHRcdFx0dGFibGVIb2xkZXIuc2Nyb2xsTGVmdCA9IHJlY3QubGVmdCAtIHRoaXMuZ2V0Um93SGVhZGVyV2lkdGgoKTtcblx0XHRcdH0gZWxzZSBpZiAocmVjdC5yaWdodCA+IHZpZXcucmlnaHQpIHtcblx0XHRcdFx0dGFibGVIb2xkZXIuc2Nyb2xsTGVmdCA9IE1hdGgubWluKHJlY3QucmlnaHQgLSB0YWJsZUhvbGRlci5jbGllbnRXaWR0aCwgcmVjdC5sZWZ0IC0gdGhpcy5nZXRSb3dIZWFkZXJXaWR0aCgpKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0aWYgKCF3aXRoaW5WZXJ0aWNhbFZpZXcpIHtcblx0XHRcdGlmIChyZWN0LnRvcCA8IHZpZXcudG9wKSB7XG5cdFx0XHRcdHRhYmxlSG9sZGVyLnNjcm9sbFRvcCA9IHJlY3QudG9wO1xuXHRcdFx0fSBlbHNlIGlmIChyZWN0LmJvdHRvbSA+IHZpZXcuYm90dG9tKSB7XG5cdFx0XHRcdHRhYmxlSG9sZGVyLnNjcm9sbFRvcCA9IHJlY3QuYm90dG9tIC0gdGFibGVIb2xkZXIuY2xpZW50SGVpZ2h0O1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8gICAgICAgTGF5b3V0ICAgICAgICAvLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRsYXlvdXRDaGFuZ2UoKXtcblx0XHR0aGlzLm92ZXJsYXkuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG5cdFx0Y2xlYXJUaW1lb3V0KHRoaXMubGF5b3V0Q2hhbmdlVGltZW91dCk7XG5cdFx0dGhpcy5sYXlvdXRDaGFuZ2VUaW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLmxheW91dFJhbmdlcy5iaW5kKHRoaXMpLCAyMDApO1xuXHR9XG5cdFxuXHRyZWRyYXcoZm9yY2UpIHtcblx0XHRpZiAoZm9yY2UpIHtcblx0XHRcdHRoaXMuc2VsZWN0aW5nID0gJ2NlbGwnO1xuXHRcdFx0dGhpcy5yZXNldFJhbmdlcygpO1xuXHRcdFx0dGhpcy5sYXlvdXRFbGVtZW50KCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRsYXlvdXRFbGVtZW50KHZpc2libGVSb3dzKSB7XG5cdFx0dmFyIHJvd3M7XG5cdFx0XG5cdFx0aWYgKHZpc2libGVSb3dzKSB7XG5cdFx0XHRyb3dzID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFZpc2libGVSb3dzKHRydWUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyb3dzID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldFJvd3MoKTtcblx0XHR9XG5cdFx0XG5cdFx0cm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdGlmIChyb3cudHlwZSA9PT0gXCJyb3dcIikge1xuXHRcdFx0XHR0aGlzLmxheW91dFJvdyhyb3cpO1xuXHRcdFx0XHRyb3cuY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4gdGhpcy5yZW5kZXJDZWxsKGNlbGwpKTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHR0aGlzLmdldFRhYmxlQ29sdW1ucygpLmZvckVhY2goKGNvbHVtbikgPT4ge1xuXHRcdFx0dGhpcy5sYXlvdXRDb2x1bW4oY29sdW1uKTtcblx0XHR9KTtcblx0XHRcblx0XHR0aGlzLmxheW91dFJhbmdlcygpO1xuXHR9XG5cdFxuXHRsYXlvdXRSb3cocm93KSB7XG5cdFx0dmFyIGVsID0gcm93LmdldEVsZW1lbnQoKSxcblx0XHRzZWxlY3RlZCA9IGZhbHNlLFxuXHRcdG9jY3VwaWVkID0gdGhpcy5yYW5nZXMuc29tZSgocmFuZ2UpID0+IHJhbmdlLm9jY3VwaWVzUm93KHJvdykpO1xuXHRcdFxuXHRcdGlmICh0aGlzLnNlbGVjdGluZyA9PT0gXCJyb3dcIikge1xuXHRcdFx0c2VsZWN0ZWQgPSBvY2N1cGllZDtcblx0XHR9IGVsc2UgaWYgKHRoaXMuc2VsZWN0aW5nID09PSBcImFsbFwiKSB7XG5cdFx0XHRzZWxlY3RlZCA9IHRydWU7XG5cdFx0fVxuXHRcdFxuXHRcdGVsLmNsYXNzTGlzdC50b2dnbGUoXCJ0YWJ1bGF0b3ItcmFuZ2Utc2VsZWN0ZWRcIiwgc2VsZWN0ZWQpO1xuXHRcdGVsLmNsYXNzTGlzdC50b2dnbGUoXCJ0YWJ1bGF0b3ItcmFuZ2UtaGlnaGxpZ2h0XCIsIG9jY3VwaWVkKTtcblx0fVxuXHRcblx0bGF5b3V0Q29sdW1uKGNvbHVtbikge1xuXHRcdHZhciBlbCA9IGNvbHVtbi5nZXRFbGVtZW50KCksXHRcdFxuXHRcdHNlbGVjdGVkID0gZmFsc2UsXG5cdFx0b2NjdXBpZWQgPSB0aGlzLnJhbmdlcy5zb21lKChyYW5nZSkgPT4gcmFuZ2Uub2NjdXBpZXNDb2x1bW4oY29sdW1uKSk7XG5cdFx0XG5cdFx0aWYgKHRoaXMuc2VsZWN0aW5nID09PSBcImNvbHVtblwiKSB7XG5cdFx0XHRzZWxlY3RlZCA9IG9jY3VwaWVkO1xuXHRcdH0gZWxzZSBpZiAodGhpcy5zZWxlY3RpbmcgPT09IFwiYWxsXCIpIHtcblx0XHRcdHNlbGVjdGVkID0gdHJ1ZTtcblx0XHR9XG5cdFx0XG5cdFx0ZWwuY2xhc3NMaXN0LnRvZ2dsZShcInRhYnVsYXRvci1yYW5nZS1zZWxlY3RlZFwiLCBzZWxlY3RlZCk7XG5cdFx0ZWwuY2xhc3NMaXN0LnRvZ2dsZShcInRhYnVsYXRvci1yYW5nZS1oaWdobGlnaHRcIiwgb2NjdXBpZWQpO1xuXHR9XG5cdFxuXHRsYXlvdXRSYW5nZXMoKSB7XG5cdFx0dmFyIGFjdGl2ZUNlbGwsIGFjdGl2ZUNlbGxFbCwgYWN0aXZlUm93RWw7XG5cdFx0XG5cdFx0aWYgKCF0aGlzLnRhYmxlLmluaXRpYWxpemVkKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdFxuXHRcdGFjdGl2ZUNlbGwgPSB0aGlzLmdldEFjdGl2ZUNlbGwoKTtcblx0XHRcblx0XHRpZiAoIWFjdGl2ZUNlbGwpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRhY3RpdmVDZWxsRWwgPSBhY3RpdmVDZWxsLmdldEVsZW1lbnQoKTtcblx0XHRhY3RpdmVSb3dFbCA9IGFjdGl2ZUNlbGwucm93LmdldEVsZW1lbnQoKTtcblxuXHRcdGlmKHRoaXMudGFibGUucnRsKXtcblx0XHRcdHRoaXMuYWN0aXZlUmFuZ2VDZWxsRWxlbWVudC5zdHlsZS5yaWdodCA9IGFjdGl2ZVJvd0VsLm9mZnNldFdpZHRoIC0gYWN0aXZlQ2VsbEVsLm9mZnNldExlZnQgLSBhY3RpdmVDZWxsRWwub2Zmc2V0V2lkdGggKyBcInB4XCI7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5hY3RpdmVSYW5nZUNlbGxFbGVtZW50LnN0eWxlLmxlZnQgPSBhY3RpdmVSb3dFbC5vZmZzZXRMZWZ0ICsgYWN0aXZlQ2VsbEVsLm9mZnNldExlZnQgKyBcInB4XCI7XG5cdFx0fVxuXG5cdFx0dGhpcy5hY3RpdmVSYW5nZUNlbGxFbGVtZW50LnN0eWxlLnRvcCA9XHRhY3RpdmVSb3dFbC5vZmZzZXRUb3AgKyBcInB4XCI7XG5cdFx0dGhpcy5hY3RpdmVSYW5nZUNlbGxFbGVtZW50LnN0eWxlLndpZHRoID0gYWN0aXZlQ2VsbEVsLm9mZnNldFdpZHRoICsgXCJweFwiO1xuXHRcdHRoaXMuYWN0aXZlUmFuZ2VDZWxsRWxlbWVudC5zdHlsZS5oZWlnaHQgPSAgYWN0aXZlUm93RWwub2Zmc2V0SGVpZ2h0ICArIFwicHhcIjtcblx0XHRcblx0XHR0aGlzLnJhbmdlcy5mb3JFYWNoKChyYW5nZSkgPT4gcmFuZ2UubGF5b3V0KCkpO1xuXHRcdFxuXHRcdHRoaXMub3ZlcmxheS5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG5cdH1cblx0XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vICBIZWxwZXIgRnVuY3Rpb25zICAgLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1x0XG5cdFxuXHRnZXRDZWxsKHJvd0lkeCwgY29sSWR4KSB7XG5cdFx0dmFyIHJvdztcblx0XHRcblx0XHRpZiAoY29sSWR4IDwgMCkge1xuXHRcdFx0Y29sSWR4ID0gdGhpcy5nZXRUYWJsZUNvbHVtbnMoKS5sZW5ndGggKyBjb2xJZHg7XG5cdFx0XHRpZiAoY29sSWR4IDwgMCkge1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0aWYgKHJvd0lkeCA8IDApIHtcblx0XHRcdHJvd0lkeCA9IHRoaXMuZ2V0VGFibGVSb3dzKCkubGVuZ3RoICsgcm93SWR4O1xuXHRcdH1cblx0XHRcblx0XHRyb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93RnJvbVBvc2l0aW9uKHJvd0lkeCArIDEpO1xuXHRcdFxuXHRcdHJldHVybiByb3cgPyByb3cuZ2V0Q2VsbHMoZmFsc2UsIHRydWUpLmZpbHRlcigoY2VsbCkgPT4gY2VsbC5jb2x1bW4udmlzaWJsZSlbY29sSWR4XSA6IG51bGw7XG5cdH1cblx0XG5cdFxuXHRnZXRBY3RpdmVDZWxsKCkge1xuXHRcdHJldHVybiB0aGlzLmdldENlbGwodGhpcy5hY3RpdmVSYW5nZS5zdGFydC5yb3csIHRoaXMuYWN0aXZlUmFuZ2Uuc3RhcnQuY29sKTtcblx0fVxuXHRcblx0Z2V0Um93QnlSYW5nZVBvcyhwb3MpIHtcblx0XHRyZXR1cm4gdGhpcy5nZXRUYWJsZVJvd3MoKVtwb3NdO1xuXHR9XG5cdFxuXHRnZXRDb2x1bW5CeVJhbmdlUG9zKHBvcykge1xuXHRcdHJldHVybiB0aGlzLmdldFRhYmxlQ29sdW1ucygpW3Bvc107XG5cdH1cblx0XG5cdGdldFRhYmxlUm93cygpIHtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCkuZmlsdGVyKHJvdz0+IHJvdy50eXBlID09PSBcInJvd1wiKTtcblx0fVxuXHRcblx0Z2V0VGFibGVDb2x1bW5zKCkge1xuXHRcdHJldHVybiB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuZ2V0VmlzaWJsZUNvbHVtbnNCeUluZGV4KCk7XG5cdH1cblx0XG5cdGFkZFJhbmdlKHN0YXJ0LCBlbmQpIHtcblx0XHR2YXIgIHJhbmdlO1xuXHRcdFxuXHRcdGlmKHRoaXMubWF4UmFuZ2VzICE9PSB0cnVlICYmIHRoaXMucmFuZ2VzLmxlbmd0aCA+PSB0aGlzLm1heFJhbmdlcyl7XG5cdFx0XHR0aGlzLnJhbmdlcy5zaGlmdCgpLmRlc3Ryb3koKTtcblx0XHR9XG5cdFx0XG5cdFx0cmFuZ2UgPSBuZXcgUmFuZ2UodGhpcy50YWJsZSwgdGhpcywgc3RhcnQsIGVuZCk7XG5cdFx0XG5cdFx0dGhpcy5hY3RpdmVSYW5nZSA9IHJhbmdlO1xuXHRcdHRoaXMucmFuZ2VzLnB1c2gocmFuZ2UpO1xuXHRcdHRoaXMucmFuZ2VDb250YWluZXIuYXBwZW5kQ2hpbGQocmFuZ2UuZWxlbWVudCk7XG5cdFx0XG5cdFx0cmV0dXJuIHJhbmdlO1xuXHR9XG5cdFxuXHRyZXNldFJhbmdlcygpIHtcblx0XHR2YXIgcmFuZ2UsIGNlbGwsIHZpc2libGVDZWxscztcblx0XHRcblx0XHR0aGlzLnJhbmdlcy5mb3JFYWNoKChyYW5nZSkgPT4gcmFuZ2UuZGVzdHJveSgpKTtcblx0XHR0aGlzLnJhbmdlcyA9IFtdO1xuXHRcdFxuXHRcdHJhbmdlID0gdGhpcy5hZGRSYW5nZSgpO1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUucm93TWFuYWdlci5hY3RpdmVSb3dzLmxlbmd0aCl7XG5cdFx0XHR2aXNpYmxlQ2VsbHMgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93c1swXS5jZWxscy5maWx0ZXIoKGNlbGwpID0+IGNlbGwuY29sdW1uLnZpc2libGUpO1xuXHRcdFx0Y2VsbCA9IHZpc2libGVDZWxsc1t0aGlzLnJvd0hlYWRlciA/IDEgOiAwXTtcblxuXHRcdFx0aWYoY2VsbCl7XG5cdFx0XHRcdHJhbmdlLnNldEJvdW5kcyhjZWxsKTtcblx0XHRcdFx0aWYodGhpcy5vcHRpb25zKFwic2VsZWN0YWJsZVJhbmdlQXV0b0ZvY3VzXCIpKXtcblx0XHRcdFx0XHR0aGlzLmluaXRpYWxpemVGb2N1cyhjZWxsKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gcmFuZ2U7XG5cdH1cblx0XG5cdHRhYmxlRGVzdHJveWVkKCl7XG5cdFx0ZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5tb3VzZVVwRXZlbnQpO1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMua2V5RG93bkV2ZW50KTtcblx0fVxuXHRcblx0c2VsZWN0ZWRSb3dzKGNvbXBvbmVudCkge1xuXHRcdHJldHVybiBjb21wb25lbnQgPyB0aGlzLmFjdGl2ZVJhbmdlLmdldFJvd3MoKS5tYXAoKHJvdykgPT4gcm93LmdldENvbXBvbmVudCgpKSA6IHRoaXMuYWN0aXZlUmFuZ2UuZ2V0Um93cygpO1xuXHR9XG5cdFxuXHRzZWxlY3RlZENvbHVtbnMoY29tcG9uZW50KSB7XG5cdFx0cmV0dXJuIGNvbXBvbmVudCA/IHRoaXMuYWN0aXZlUmFuZ2UuZ2V0Q29sdW1ucygpLm1hcCgoY29sKSA9PiBjb2wuZ2V0Q29tcG9uZW50KCkpIDogdGhpcy5hY3RpdmVSYW5nZS5nZXRDb2x1bW5zKCk7XG5cdH1cblxuXHRnZXRSb3dIZWFkZXJXaWR0aCgpe1xuXHRcdGlmKCF0aGlzLnJvd0hlYWRlcil7XG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMucm93SGVhZGVyLmdldEVsZW1lbnQoKS5vZmZzZXRXaWR0aDtcblx0fVxuXG5cdGlzRW1wdHkodmFsdWUpIHtcblx0XHRyZXR1cm4gdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gXCJcIjtcblx0fVxufVxuXG4vL3NvcnQgbnVtYmVyc1xuZnVuY3Rpb24gbnVtYmVyKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpe1xuXHR2YXIgYWxpZ25FbXB0eVZhbHVlcyA9IHBhcmFtcy5hbGlnbkVtcHR5VmFsdWVzO1xuXHR2YXIgZGVjaW1hbCA9IHBhcmFtcy5kZWNpbWFsU2VwYXJhdG9yO1xuXHR2YXIgdGhvdXNhbmQgPSBwYXJhbXMudGhvdXNhbmRTZXBhcmF0b3I7XG5cdHZhciBlbXB0eUFsaWduID0gMDtcblxuXHRhID0gU3RyaW5nKGEpO1xuXHRiID0gU3RyaW5nKGIpO1xuXG5cdGlmKHRob3VzYW5kKXtcblx0XHRhID0gYS5zcGxpdCh0aG91c2FuZCkuam9pbihcIlwiKTtcblx0XHRiID0gYi5zcGxpdCh0aG91c2FuZCkuam9pbihcIlwiKTtcblx0fVxuXG5cdGlmKGRlY2ltYWwpe1xuXHRcdGEgPSBhLnNwbGl0KGRlY2ltYWwpLmpvaW4oXCIuXCIpO1xuXHRcdGIgPSBiLnNwbGl0KGRlY2ltYWwpLmpvaW4oXCIuXCIpO1xuXHR9XG5cblx0YSA9IHBhcnNlRmxvYXQoYSk7XG5cdGIgPSBwYXJzZUZsb2F0KGIpO1xuXG5cdC8vaGFuZGxlIG5vbiBudW1lcmljIHZhbHVlc1xuXHRpZihpc05hTihhKSl7XG5cdFx0ZW1wdHlBbGlnbiA9ICBpc05hTihiKSA/IDAgOiAtMTtcblx0fWVsc2UgaWYoaXNOYU4oYikpe1xuXHRcdGVtcHR5QWxpZ24gPSAgMTtcblx0fWVsc2Uge1xuXHRcdC8vY29tcGFyZSB2YWxpZCB2YWx1ZXNcblx0XHRyZXR1cm4gYSAtIGI7XG5cdH1cblxuXHQvL2ZpeCBlbXB0eSB2YWx1ZXMgaW4gcG9zaXRpb25cblx0aWYoKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwidG9wXCIgJiYgZGlyID09PSBcImRlc2NcIikgfHwgKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwiYm90dG9tXCIgJiYgZGlyID09PSBcImFzY1wiKSl7XG5cdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0fVxuXG5cdHJldHVybiBlbXB0eUFsaWduO1xufVxuXG4vL3NvcnQgc3RyaW5nc1xuZnVuY3Rpb24gc3RyaW5nKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpe1xuXHR2YXIgYWxpZ25FbXB0eVZhbHVlcyA9IHBhcmFtcy5hbGlnbkVtcHR5VmFsdWVzO1xuXHR2YXIgZW1wdHlBbGlnbiA9IDA7XG5cdHZhciBsb2NhbGU7XG5cblx0Ly9oYW5kbGUgZW1wdHkgdmFsdWVzXG5cdGlmKCFhKXtcblx0XHRlbXB0eUFsaWduID0gICFiID8gMCA6IC0xO1xuXHR9ZWxzZSBpZighYil7XG5cdFx0ZW1wdHlBbGlnbiA9ICAxO1xuXHR9ZWxzZSB7XG5cdFx0Ly9jb21wYXJlIHZhbGlkIHZhbHVlc1xuXHRcdHN3aXRjaCh0eXBlb2YgcGFyYW1zLmxvY2FsZSl7XG5cdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxuXHRcdFx0XHRpZihwYXJhbXMubG9jYWxlKXtcblx0XHRcdFx0XHRsb2NhbGUgPSB0aGlzLmxhbmdMb2NhbGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0bG9jYWxlID0gcGFyYW1zLmxvY2FsZTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIFN0cmluZyhhKS50b0xvd2VyQ2FzZSgpLmxvY2FsZUNvbXBhcmUoU3RyaW5nKGIpLnRvTG93ZXJDYXNlKCksIGxvY2FsZSk7XG5cdH1cblxuXHQvL2ZpeCBlbXB0eSB2YWx1ZXMgaW4gcG9zaXRpb25cblx0aWYoKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwidG9wXCIgJiYgZGlyID09PSBcImRlc2NcIikgfHwgKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwiYm90dG9tXCIgJiYgZGlyID09PSBcImFzY1wiKSl7XG5cdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0fVxuXG5cdHJldHVybiBlbXB0eUFsaWduO1xufVxuXG4vL3NvcnQgZGF0ZXRpbWVcbmZ1bmN0aW9uIGRhdGV0aW1lKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpe1xuXHR2YXIgRFQgPSB0aGlzLnRhYmxlLmRlcGVuZGVuY3lSZWdpc3RyeS5sb29rdXAoW1wibHV4b25cIiwgXCJEYXRlVGltZVwiXSwgXCJEYXRlVGltZVwiKTtcblx0dmFyIGZvcm1hdCA9IHBhcmFtcy5mb3JtYXQgfHwgXCJkZC9NTS95eXl5IEhIOm1tOnNzXCIsXG5cdGFsaWduRW1wdHlWYWx1ZXMgPSBwYXJhbXMuYWxpZ25FbXB0eVZhbHVlcyxcblx0ZW1wdHlBbGlnbiA9IDA7XG5cblx0aWYodHlwZW9mIERUICE9IFwidW5kZWZpbmVkXCIpe1xuXHRcdGlmKCFEVC5pc0RhdGVUaW1lKGEpKXtcblx0XHRcdGlmKGZvcm1hdCA9PT0gXCJpc29cIil7XG5cdFx0XHRcdGEgPSBEVC5mcm9tSVNPKFN0cmluZyhhKSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGEgPSBEVC5mcm9tRm9ybWF0KFN0cmluZyhhKSwgZm9ybWF0KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZighRFQuaXNEYXRlVGltZShiKSl7XG5cdFx0XHRpZihmb3JtYXQgPT09IFwiaXNvXCIpe1xuXHRcdFx0XHRiID0gRFQuZnJvbUlTTyhTdHJpbmcoYikpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRiID0gRFQuZnJvbUZvcm1hdChTdHJpbmcoYiksIGZvcm1hdCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYoIWEuaXNWYWxpZCl7XG5cdFx0XHRlbXB0eUFsaWduID0gIWIuaXNWYWxpZCA/IDAgOiAtMTtcblx0XHR9ZWxzZSBpZighYi5pc1ZhbGlkKXtcblx0XHRcdGVtcHR5QWxpZ24gPSAgMTtcblx0XHR9ZWxzZSB7XG5cdFx0XHQvL2NvbXBhcmUgdmFsaWQgdmFsdWVzXG5cdFx0XHRyZXR1cm4gYSAtIGI7XG5cdFx0fVxuXG5cdFx0Ly9maXggZW1wdHkgdmFsdWVzIGluIHBvc2l0aW9uXG5cdFx0aWYoKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwidG9wXCIgJiYgZGlyID09PSBcImRlc2NcIikgfHwgKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwiYm90dG9tXCIgJiYgZGlyID09PSBcImFzY1wiKSl7XG5cdFx0XHRlbXB0eUFsaWduICo9IC0xO1xuXHRcdH1cblxuXHRcdHJldHVybiBlbXB0eUFsaWduO1xuXG5cdH1lbHNlIHtcblx0XHRjb25zb2xlLmVycm9yKFwiU29ydCBFcnJvciAtICdkYXRldGltZScgc29ydGVyIGlzIGRlcGVuZGFudCBvbiBsdXhvbi5qc1wiKTtcblx0fVxufVxuXG4vL3NvcnQgZGF0ZVxuZnVuY3Rpb24gZGF0ZShhLCBiLCBhUm93LCBiUm93LCBjb2x1bW4sIGRpciwgcGFyYW1zKXtcblx0aWYoIXBhcmFtcy5mb3JtYXQpe1xuXHRcdHBhcmFtcy5mb3JtYXQgPSBcImRkL01NL3l5eXlcIjtcblx0fVxuXG5cdHJldHVybiBkYXRldGltZS5jYWxsKHRoaXMsIGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpO1xufVxuXG4vL3NvcnQgdGltZXNcbmZ1bmN0aW9uIHRpbWUoYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcyl7XG5cdGlmKCFwYXJhbXMuZm9ybWF0KXtcblx0XHRwYXJhbXMuZm9ybWF0ID0gXCJISDptbVwiO1xuXHR9XG5cblx0cmV0dXJuIGRhdGV0aW1lLmNhbGwodGhpcywgYSwgYiwgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcyk7XG59XG5cbi8vc29ydCBib29sZWFuc1xuZnVuY3Rpb24gYm9vbGVhbihhLCBiLCBhUm93LCBiUm93LCBjb2x1bW4sIGRpciwgcGFyYW1zKXtcblx0dmFyIGVsMSA9IGEgPT09IHRydWUgfHwgYSA9PT0gXCJ0cnVlXCIgfHwgYSA9PT0gXCJUcnVlXCIgfHwgYSA9PT0gMSA/IDEgOiAwO1xuXHR2YXIgZWwyID0gYiA9PT0gdHJ1ZSB8fCBiID09PSBcInRydWVcIiB8fCBiID09PSBcIlRydWVcIiB8fCBiID09PSAxID8gMSA6IDA7XG5cblx0cmV0dXJuIGVsMSAtIGVsMjtcbn1cblxuLy9zb3J0IGlmIGVsZW1lbnQgY29udGFpbnMgYW55IGRhdGFcbmZ1bmN0aW9uIGFycmF5KGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpe1xuXHR2YXIgdHlwZSA9IHBhcmFtcy50eXBlIHx8IFwibGVuZ3RoXCIsXG5cdGFsaWduRW1wdHlWYWx1ZXMgPSBwYXJhbXMuYWxpZ25FbXB0eVZhbHVlcyxcblx0ZW1wdHlBbGlnbiA9IDAsXG5cdHRhYmxlID0gdGhpcy50YWJsZSxcblx0dmFsdWVNYXA7XG5cblx0aWYocGFyYW1zLnZhbHVlTWFwKXtcblx0XHRpZih0eXBlb2YgcGFyYW1zLnZhbHVlTWFwID09PSBcInN0cmluZ1wiKXtcblx0XHRcdHZhbHVlTWFwID0gZnVuY3Rpb24odmFsdWUpe1xuXHRcdFx0XHRyZXR1cm4gdmFsdWUubWFwKChpdGVtKSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIEhlbHBlcnMucmV0cmlldmVOZXN0ZWREYXRhKHRhYmxlLm9wdGlvbnMubmVzdGVkRmllbGRTZXBhcmF0b3IsIHBhcmFtcy52YWx1ZU1hcCwgaXRlbSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR2YWx1ZU1hcCA9IHBhcmFtcy52YWx1ZU1hcDtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBjYWxjKHZhbHVlKXtcblx0XHR2YXIgcmVzdWx0O1xuXHRcdFxuXHRcdGlmKHZhbHVlTWFwKXtcblx0XHRcdHZhbHVlID0gdmFsdWVNYXAodmFsdWUpO1xuXHRcdH1cblxuXHRcdHN3aXRjaCh0eXBlKXtcblx0XHRcdGNhc2UgXCJsZW5ndGhcIjpcblx0XHRcdFx0cmVzdWx0ID0gdmFsdWUubGVuZ3RoO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0Y2FzZSBcInN1bVwiOlxuXHRcdFx0XHRyZXN1bHQgPSB2YWx1ZS5yZWR1Y2UoZnVuY3Rpb24oYywgZCl7XG5cdFx0XHRcdFx0cmV0dXJuIGMgKyBkO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJtYXhcIjpcblx0XHRcdFx0cmVzdWx0ID0gTWF0aC5tYXguYXBwbHkobnVsbCwgdmFsdWUpIDtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJtaW5cIjpcblx0XHRcdFx0cmVzdWx0ID0gTWF0aC5taW4uYXBwbHkobnVsbCwgdmFsdWUpIDtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgXCJhdmdcIjpcblx0XHRcdFx0cmVzdWx0ID0gdmFsdWUucmVkdWNlKGZ1bmN0aW9uKGMsIGQpe1xuXHRcdFx0XHRcdHJldHVybiBjICsgZDtcblx0XHRcdFx0fSkgLyB2YWx1ZS5sZW5ndGg7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdHJlc3VsdCA9IHZhbHVlLmpvaW4oXCJcIik7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH1cblxuXHQvL2hhbmRsZSBub24gYXJyYXkgdmFsdWVzXG5cdGlmKCFBcnJheS5pc0FycmF5KGEpKXtcblx0XHRlbXB0eUFsaWduID0gIUFycmF5LmlzQXJyYXkoYikgPyAwIDogLTE7XG5cdH1lbHNlIGlmKCFBcnJheS5pc0FycmF5KGIpKXtcblx0XHRlbXB0eUFsaWduID0gMTtcblx0fWVsc2Uge1xuXHRcdGlmKHR5cGUgPT09IFwic3RyaW5nXCIpe1xuXHRcdFx0cmV0dXJuIFN0cmluZyhjYWxjKGEpKS50b0xvd2VyQ2FzZSgpLmxvY2FsZUNvbXBhcmUoU3RyaW5nKGNhbGMoYikpLnRvTG93ZXJDYXNlKCkpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiBjYWxjKGIpIC0gY2FsYyhhKTtcblx0XHR9XG5cdH1cblxuXHQvL2ZpeCBlbXB0eSB2YWx1ZXMgaW4gcG9zaXRpb25cblx0aWYoKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwidG9wXCIgJiYgZGlyID09PSBcImRlc2NcIikgfHwgKGFsaWduRW1wdHlWYWx1ZXMgPT09IFwiYm90dG9tXCIgJiYgZGlyID09PSBcImFzY1wiKSl7XG5cdFx0ZW1wdHlBbGlnbiAqPSAtMTtcblx0fVxuXG5cdHJldHVybiBlbXB0eUFsaWduO1xufVxuXG4vL3NvcnQgaWYgZWxlbWVudCBjb250YWlucyBhbnkgZGF0YVxuZnVuY3Rpb24gZXhpc3RzKGEsIGIsIGFSb3csIGJSb3csIGNvbHVtbiwgZGlyLCBwYXJhbXMpe1xuXHR2YXIgZWwxID0gdHlwZW9mIGEgPT0gXCJ1bmRlZmluZWRcIiA/IDAgOiAxO1xuXHR2YXIgZWwyID0gdHlwZW9mIGIgPT0gXCJ1bmRlZmluZWRcIiA/IDAgOiAxO1xuXG5cdHJldHVybiBlbDEgLSBlbDI7XG59XG5cbi8vc29ydCBhbHBoYSBudW1lcmljIHN0cmluZ3NcbmZ1bmN0aW9uIGFscGhhbnVtKGFzLCBicywgYVJvdywgYlJvdywgY29sdW1uLCBkaXIsIHBhcmFtcyl7XG5cdHZhciBhLCBiLCBhMSwgYjEsIGk9IDAsIEwsIHJ4ID0gLyhcXGQrKXwoXFxEKykvZywgcmQgPSAvXFxkLztcblx0dmFyIGFsaWduRW1wdHlWYWx1ZXMgPSBwYXJhbXMuYWxpZ25FbXB0eVZhbHVlcztcblx0dmFyIGVtcHR5QWxpZ24gPSAwO1xuXG5cdC8vaGFuZGxlIGVtcHR5IHZhbHVlc1xuXHRpZighYXMgJiYgYXMhPT0gMCl7XG5cdFx0ZW1wdHlBbGlnbiA9ICAhYnMgJiYgYnMhPT0gMCA/IDAgOiAtMTtcblx0fWVsc2UgaWYoIWJzICYmIGJzIT09IDApe1xuXHRcdGVtcHR5QWxpZ24gPSAgMTtcblx0fWVsc2Uge1xuXG5cdFx0aWYoaXNGaW5pdGUoYXMpICYmIGlzRmluaXRlKGJzKSkgcmV0dXJuIGFzIC0gYnM7XG5cdFx0YSA9IFN0cmluZyhhcykudG9Mb3dlckNhc2UoKTtcblx0XHRiID0gU3RyaW5nKGJzKS50b0xvd2VyQ2FzZSgpO1xuXHRcdGlmKGEgPT09IGIpIHJldHVybiAwO1xuXHRcdGlmKCEocmQudGVzdChhKSAmJiByZC50ZXN0KGIpKSkgcmV0dXJuIGEgPiBiID8gMSA6IC0xO1xuXHRcdGEgPSBhLm1hdGNoKHJ4KTtcblx0XHRiID0gYi5tYXRjaChyeCk7XG5cdFx0TCA9IGEubGVuZ3RoID4gYi5sZW5ndGggPyBiLmxlbmd0aCA6IGEubGVuZ3RoO1xuXHRcdHdoaWxlKGkgPCBMKXtcblx0XHRcdGExPSBhW2ldO1xuXHRcdFx0YjE9IGJbaSsrXTtcblx0XHRcdGlmKGExICE9PSBiMSl7XG5cdFx0XHRcdGlmKGlzRmluaXRlKGExKSAmJiBpc0Zpbml0ZShiMSkpe1xuXHRcdFx0XHRcdGlmKGExLmNoYXJBdCgwKSA9PT0gXCIwXCIpIGExID0gXCIuXCIgKyBhMTtcblx0XHRcdFx0XHRpZihiMS5jaGFyQXQoMCkgPT09IFwiMFwiKSBiMSA9IFwiLlwiICsgYjE7XG5cdFx0XHRcdFx0cmV0dXJuIGExIC0gYjE7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZSByZXR1cm4gYTEgPiBiMSA/IDEgOiAtMTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gYS5sZW5ndGggPiBiLmxlbmd0aDtcblx0fVxuXG5cdC8vZml4IGVtcHR5IHZhbHVlcyBpbiBwb3NpdGlvblxuXHRpZigoYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJ0b3BcIiAmJiBkaXIgPT09IFwiZGVzY1wiKSB8fCAoYWxpZ25FbXB0eVZhbHVlcyA9PT0gXCJib3R0b21cIiAmJiBkaXIgPT09IFwiYXNjXCIpKXtcblx0XHRlbXB0eUFsaWduICo9IC0xO1xuXHR9XG5cblx0cmV0dXJuIGVtcHR5QWxpZ247XG59XG5cbnZhciBkZWZhdWx0U29ydGVycyA9IHtcblx0bnVtYmVyOm51bWJlcixcblx0c3RyaW5nOnN0cmluZyxcblx0ZGF0ZTpkYXRlLFxuXHR0aW1lOnRpbWUsXG5cdGRhdGV0aW1lOmRhdGV0aW1lLFxuXHRib29sZWFuOmJvb2xlYW4sXG5cdGFycmF5OmFycmF5LFxuXHRleGlzdHM6ZXhpc3RzLFxuXHRhbHBoYW51bTphbHBoYW51bVxufTtcblxuY2xhc3MgU29ydCBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwic29ydFwiO1xuXG5cdC8vbG9hZCBkZWZhdWx0c1xuXHRzdGF0aWMgc29ydGVycyA9IGRlZmF1bHRTb3J0ZXJzO1xuXHRcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLnNvcnRMaXN0ID0gW107IC8vaG9sZGVyIGN1cnJlbnQgc29ydFxuXHRcdHRoaXMuY2hhbmdlZCA9IGZhbHNlOyAvL2hhcyB0aGUgc29ydCBjaGFuZ2VkIHNpbmNlIGxhc3QgcmVuZGVyXG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic29ydE1vZGVcIiwgXCJsb2NhbFwiKTsgLy9sb2NhbCBvciByZW1vdGUgc29ydGluZ1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImluaXRpYWxTb3J0XCIsIGZhbHNlKTsgLy9pbml0aWFsIHNvcnRpbmcgY3JpdGVyaWFcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJjb2x1bW5IZWFkZXJTb3J0TXVsdGlcIiwgdHJ1ZSk7IC8vbXVsdGlwbGUgb3Igc2luZ2xlIGNvbHVtbiBzb3J0aW5nXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic29ydE9yZGVyUmV2ZXJzZVwiLCBmYWxzZSk7IC8vcmV2ZXJzZSBpbnRlcm5hbCBzb3J0IG9yZGVyaW5nXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiaGVhZGVyU29ydEVsZW1lbnRcIiwgXCI8ZGl2IGNsYXNzPSd0YWJ1bGF0b3ItYXJyb3cnPjwvZGl2PlwiKTsgLy9oZWFkZXIgc29ydCBlbGVtZW50XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwiaGVhZGVyU29ydENsaWNrRWxlbWVudFwiLCBcImhlYWRlclwiKTsgLy9lbGVtZW50IHdoaWNoIHRyaWdnZXJzIHNvcnQgd2hlbiBjbGlja2VkXG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcInNvcnRlclwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwic29ydGVyUGFyYW1zXCIpO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJTb3J0XCIsIHRydWUpO1xuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJoZWFkZXJTb3J0U3RhcnRpbmdEaXJcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcImhlYWRlclNvcnRUcmlzdGF0ZVwiKTtcblx0XHRcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWxheW91dFwiLCB0aGlzLmluaXRpYWxpemVDb2x1bW4uYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJ0YWJsZS1idWlsdFwiLCB0aGlzLnRhYmxlQnVpbHQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckRhdGFIYW5kbGVyKHRoaXMuc29ydC5iaW5kKHRoaXMpLCAyMCk7XG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJzZXRTb3J0XCIsIHRoaXMudXNlclNldFNvcnQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRTb3J0ZXJzXCIsIHRoaXMuZ2V0U29ydC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImNsZWFyU29ydFwiLCB0aGlzLmNsZWFyU29ydC5iaW5kKHRoaXMpKTtcblx0XHRcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuc29ydE1vZGUgPT09IFwicmVtb3RlXCIpe1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLXBhcmFtc1wiLCB0aGlzLnJlbW90ZVNvcnRQYXJhbXMuYmluZCh0aGlzKSk7XG5cdFx0fVxuXHR9XG5cdFxuXHR0YWJsZUJ1aWx0KCl7XG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmluaXRpYWxTb3J0KXtcblx0XHRcdHRoaXMuc2V0U29ydCh0aGlzLnRhYmxlLm9wdGlvbnMuaW5pdGlhbFNvcnQpO1xuXHRcdH1cblx0fVxuXHRcblx0cmVtb3RlU29ydFBhcmFtcyhkYXRhLCBjb25maWcsIHNpbGVudCwgcGFyYW1zKXtcblx0XHR2YXIgc29ydGVycyA9IHRoaXMuZ2V0U29ydCgpO1xuXHRcdFxuXHRcdHNvcnRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuXHRcdFx0ZGVsZXRlIGl0ZW0uY29sdW1uO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHBhcmFtcy5zb3J0ID0gc29ydGVycztcblx0XHRcblx0XHRyZXR1cm4gcGFyYW1zO1xuXHR9XG5cdFxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIFRhYmxlIEZ1bmN0aW9ucyAvLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdHVzZXJTZXRTb3J0KHNvcnRMaXN0LCBkaXIpe1xuXHRcdHRoaXMuc2V0U29ydChzb3J0TGlzdCwgZGlyKTtcblx0XHQvLyB0aGlzLnRhYmxlLnJvd01hbmFnZXIuc29ydGVyUmVmcmVzaCgpO1xuXHRcdHRoaXMucmVmcmVzaFNvcnQoKTtcblx0fVxuXHRcblx0Y2xlYXJTb3J0KCl7XG5cdFx0dGhpcy5jbGVhcigpO1xuXHRcdC8vIHRoaXMudGFibGUucm93TWFuYWdlci5zb3J0ZXJSZWZyZXNoKCk7XG5cdFx0dGhpcy5yZWZyZXNoU29ydCgpO1xuXHR9XG5cdFxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIEludGVybmFsIExvZ2ljIC8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdC8vaW5pdGlhbGl6ZSBjb2x1bW4gaGVhZGVyIGZvciBzb3J0aW5nXG5cdGluaXRpYWxpemVDb2x1bW4oY29sdW1uKXtcblx0XHR2YXIgc29ydGVyID0gZmFsc2UsXG5cdFx0Y29sRWwsXG5cdFx0YXJyb3dFbDtcblx0XHRcblx0XHRzd2l0Y2godHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLnNvcnRlcil7XG5cdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdGlmKFNvcnQuc29ydGVyc1tjb2x1bW4uZGVmaW5pdGlvbi5zb3J0ZXJdKXtcblx0XHRcdFx0XHRzb3J0ZXIgPSBTb3J0LnNvcnRlcnNbY29sdW1uLmRlZmluaXRpb24uc29ydGVyXTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIlNvcnQgRXJyb3IgLSBObyBzdWNoIHNvcnRlciBmb3VuZDogXCIsIGNvbHVtbi5kZWZpbml0aW9uLnNvcnRlcik7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHRzb3J0ZXIgPSBjb2x1bW4uZGVmaW5pdGlvbi5zb3J0ZXI7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0XHRcblx0XHRjb2x1bW4ubW9kdWxlcy5zb3J0ID0ge1xuXHRcdFx0c29ydGVyOnNvcnRlciwgZGlyOlwibm9uZVwiLFxuXHRcdFx0cGFyYW1zOmNvbHVtbi5kZWZpbml0aW9uLnNvcnRlclBhcmFtcyB8fCB7fSxcblx0XHRcdHN0YXJ0aW5nRGlyOmNvbHVtbi5kZWZpbml0aW9uLmhlYWRlclNvcnRTdGFydGluZ0RpciB8fCBcImFzY1wiLFxuXHRcdFx0dHJpc3RhdGU6IGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlclNvcnRUcmlzdGF0ZSxcblx0XHR9O1xuXHRcdFxuXHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlclNvcnQgIT09IGZhbHNlKXtcblx0XHRcdFxuXHRcdFx0Y29sRWwgPSBjb2x1bW4uZ2V0RWxlbWVudCgpO1xuXHRcdFx0XG5cdFx0XHRjb2xFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXNvcnRhYmxlXCIpO1xuXHRcdFx0XG5cdFx0XHRhcnJvd0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdGFycm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1jb2wtc29ydGVyXCIpO1xuXHRcdFx0XG5cdFx0XHRzd2l0Y2godGhpcy50YWJsZS5vcHRpb25zLmhlYWRlclNvcnRDbGlja0VsZW1lbnQpe1xuXHRcdFx0XHRjYXNlIFwiaWNvblwiOlxuXHRcdFx0XHRcdGFycm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1jb2wtc29ydGVyLWVsZW1lbnRcIik7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJoZWFkZXJcIjpcblx0XHRcdFx0XHRjb2xFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC1zb3J0ZXItZWxlbWVudFwiKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRjb2xFbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWNvbC1zb3J0ZXItZWxlbWVudFwiKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0c3dpdGNoKHRoaXMudGFibGUub3B0aW9ucy5oZWFkZXJTb3J0RWxlbWVudCl7XG5cdFx0XHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0XHQvL2RvIG5vdGhpbmdcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XG5cdFx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0XHRhcnJvd0VsLmFwcGVuZENoaWxkKHRoaXMudGFibGUub3B0aW9ucy5oZWFkZXJTb3J0RWxlbWVudCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFxuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdGFycm93RWwuaW5uZXJIVE1MID0gdGhpcy50YWJsZS5vcHRpb25zLmhlYWRlclNvcnRFbGVtZW50O1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHQvL2NyZWF0ZSBzb3J0ZXIgYXJyb3dcblx0XHRcdGNvbHVtbi50aXRsZUhvbGRlckVsZW1lbnQuYXBwZW5kQ2hpbGQoYXJyb3dFbCk7XG5cdFx0XHRcblx0XHRcdGNvbHVtbi5tb2R1bGVzLnNvcnQuZWxlbWVudCA9IGFycm93RWw7XG5cdFx0XHRcblx0XHRcdHRoaXMuc2V0Q29sdW1uSGVhZGVyU29ydEljb24oY29sdW1uLCBcIm5vbmVcIik7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5oZWFkZXJTb3J0Q2xpY2tFbGVtZW50ID09PSBcImljb25cIil7XG5cdFx0XHRcdGFycm93RWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHQvL3NvcnQgb24gY2xpY2tcblx0XHRcdCh0aGlzLnRhYmxlLm9wdGlvbnMuaGVhZGVyU29ydENsaWNrRWxlbWVudCA9PT0gXCJpY29uXCIgPyBhcnJvd0VsIDogY29sRWwpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuXHRcdFx0XHR2YXIgZGlyID0gXCJcIixcblx0XHRcdFx0c29ydGVycz1bXSxcblx0XHRcdFx0bWF0Y2ggPSBmYWxzZTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKGNvbHVtbi5tb2R1bGVzLnNvcnQpe1xuXHRcdFx0XHRcdGlmKGNvbHVtbi5tb2R1bGVzLnNvcnQudHJpc3RhdGUpe1xuXHRcdFx0XHRcdFx0aWYoY29sdW1uLm1vZHVsZXMuc29ydC5kaXIgPT0gXCJub25lXCIpe1xuXHRcdFx0XHRcdFx0XHRkaXIgPSBjb2x1bW4ubW9kdWxlcy5zb3J0LnN0YXJ0aW5nRGlyO1xuXHRcdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0XHRpZihjb2x1bW4ubW9kdWxlcy5zb3J0LmRpciA9PSBjb2x1bW4ubW9kdWxlcy5zb3J0LnN0YXJ0aW5nRGlyKXtcblx0XHRcdFx0XHRcdFx0XHRkaXIgPSBjb2x1bW4ubW9kdWxlcy5zb3J0LmRpciA9PSBcImFzY1wiID8gXCJkZXNjXCIgOiBcImFzY1wiO1xuXHRcdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0ZGlyID0gXCJub25lXCI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRzd2l0Y2goY29sdW1uLm1vZHVsZXMuc29ydC5kaXIpe1xuXHRcdFx0XHRcdFx0XHRjYXNlIFwiYXNjXCI6XG5cdFx0XHRcdFx0XHRcdFx0ZGlyID0gXCJkZXNjXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRjYXNlIFwiZGVzY1wiOlxuXHRcdFx0XHRcdFx0XHRcdGRpciA9IFwiYXNjXCI7XG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRcdGRpciA9IGNvbHVtbi5tb2R1bGVzLnNvcnQuc3RhcnRpbmdEaXI7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmICh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1uSGVhZGVyU29ydE11bHRpICYmIChlLnNoaWZ0S2V5IHx8IGUuY3RybEtleSkpIHtcblx0XHRcdFx0XHRcdHNvcnRlcnMgPSB0aGlzLmdldFNvcnQoKTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0bWF0Y2ggPSBzb3J0ZXJzLmZpbmRJbmRleCgoc29ydGVyKSA9PiB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBzb3J0ZXIuZmllbGQgPT09IGNvbHVtbi5nZXRGaWVsZCgpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmKG1hdGNoID4gLTEpe1xuXHRcdFx0XHRcdFx0XHRzb3J0ZXJzW21hdGNoXS5kaXIgPSBkaXI7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRtYXRjaCA9IHNvcnRlcnMuc3BsaWNlKG1hdGNoLCAxKVswXTtcblx0XHRcdFx0XHRcdFx0aWYoZGlyICE9IFwibm9uZVwiKXtcblx0XHRcdFx0XHRcdFx0XHRzb3J0ZXJzLnB1c2gobWF0Y2gpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGlmKGRpciAhPSBcIm5vbmVcIil7XG5cdFx0XHRcdFx0XHRcdFx0c29ydGVycy5wdXNoKHtjb2x1bW46Y29sdW1uLCBkaXI6ZGlyfSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0Ly9hZGQgdG8gZXhpc3Rpbmcgc29ydFxuXHRcdFx0XHRcdFx0dGhpcy5zZXRTb3J0KHNvcnRlcnMpO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGlmKGRpciA9PSBcIm5vbmVcIil7XG5cdFx0XHRcdFx0XHRcdHRoaXMuY2xlYXIoKTtcblx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly9zb3J0IGJ5IGNvbHVtbiBvbmx5XG5cdFx0XHRcdFx0XHRcdHRoaXMuc2V0U29ydChjb2x1bW4sIGRpcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0Ly8gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNvcnRlclJlZnJlc2goIXRoaXMuc29ydExpc3QubGVuZ3RoKTtcblx0XHRcdFx0XHR0aGlzLnJlZnJlc2hTb3J0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXHRcblx0cmVmcmVzaFNvcnQoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuc29ydE1vZGUgPT09IFwicmVtb3RlXCIpe1xuXHRcdFx0dGhpcy5yZWxvYWREYXRhKG51bGwsIGZhbHNlLCBmYWxzZSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5yZWZyZXNoRGF0YSh0cnVlKTtcblx0XHR9XG5cdFx0XG5cdFx0Ly9UT0RPIC0gUGVyc2lzdCBsZWZ0IHBvc2l0aW9uIG9mIHJvdyBtYW5hZ2VyXG5cdFx0Ly8gbGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcblx0XHQvLyB0aGlzLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdH1cblx0XG5cdC8vY2hlY2sgaWYgdGhlIHNvcnRlcnMgaGF2ZSBjaGFuZ2VkIHNpbmNlIGxhc3QgdXNlXG5cdGhhc0NoYW5nZWQoKXtcblx0XHR2YXIgY2hhbmdlZCA9IHRoaXMuY2hhbmdlZDtcblx0XHR0aGlzLmNoYW5nZWQgPSBmYWxzZTtcblx0XHRyZXR1cm4gY2hhbmdlZDtcblx0fVxuXHRcblx0Ly9yZXR1cm4gY3VycmVudCBzb3J0ZXJzXG5cdGdldFNvcnQoKXtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0c29ydGVycyA9IFtdO1xuXHRcdFxuXHRcdHNlbGYuc29ydExpc3QuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcblx0XHRcdGlmKGl0ZW0uY29sdW1uKXtcblx0XHRcdFx0c29ydGVycy5wdXNoKHtjb2x1bW46aXRlbS5jb2x1bW4uZ2V0Q29tcG9uZW50KCksIGZpZWxkOml0ZW0uY29sdW1uLmdldEZpZWxkKCksIGRpcjppdGVtLmRpcn0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBzb3J0ZXJzO1xuXHR9XG5cdFxuXHQvL2NoYW5nZSBzb3J0IGxpc3QgYW5kIHRyaWdnZXIgc29ydFxuXHRzZXRTb3J0KHNvcnRMaXN0LCBkaXIpe1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRuZXdTb3J0TGlzdCA9IFtdO1xuXHRcdFxuXHRcdGlmKCFBcnJheS5pc0FycmF5KHNvcnRMaXN0KSl7XG5cdFx0XHRzb3J0TGlzdCA9IFt7Y29sdW1uOiBzb3J0TGlzdCwgZGlyOmRpcn1dO1xuXHRcdH1cblx0XHRcblx0XHRzb3J0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuXHRcdFx0dmFyIGNvbHVtbjtcblx0XHRcdFxuXHRcdFx0Y29sdW1uID0gc2VsZi50YWJsZS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oaXRlbS5jb2x1bW4pO1xuXHRcdFx0XG5cdFx0XHRpZihjb2x1bW4pe1xuXHRcdFx0XHRpdGVtLmNvbHVtbiA9IGNvbHVtbjtcblx0XHRcdFx0bmV3U29ydExpc3QucHVzaChpdGVtKTtcblx0XHRcdFx0c2VsZi5jaGFuZ2VkID0gdHJ1ZTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiU29ydCBXYXJuaW5nIC0gU29ydCBmaWVsZCBkb2VzIG5vdCBleGlzdCBhbmQgaXMgYmVpbmcgaWdub3JlZDogXCIsIGl0ZW0uY29sdW1uKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdH0pO1xuXHRcdFxuXHRcdHNlbGYuc29ydExpc3QgPSBuZXdTb3J0TGlzdDtcblx0XHRcblx0XHR0aGlzLmRpc3BhdGNoKFwic29ydC1jaGFuZ2VkXCIpO1xuXHR9XG5cdFxuXHQvL2NsZWFyIHNvcnRlcnNcblx0Y2xlYXIoKXtcblx0XHR0aGlzLnNldFNvcnQoW10pO1xuXHR9XG5cdFxuXHQvL2ZpbmQgYXBwcm9wcmlhdGUgc29ydGVyIGZvciBjb2x1bW5cblx0ZmluZFNvcnRlcihjb2x1bW4pe1xuXHRcdHZhciByb3cgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWN0aXZlUm93c1swXSxcblx0XHRzb3J0ZXIgPSBcInN0cmluZ1wiLFxuXHRcdGZpZWxkLCB2YWx1ZTtcblx0XHRcblx0XHRpZihyb3cpe1xuXHRcdFx0cm93ID0gcm93LmdldERhdGEoKTtcblx0XHRcdGZpZWxkID0gY29sdW1uLmdldEZpZWxkKCk7XG5cdFx0XHRcblx0XHRcdGlmKGZpZWxkKXtcblx0XHRcdFx0XG5cdFx0XHRcdHZhbHVlID0gY29sdW1uLmdldEZpZWxkVmFsdWUocm93KTtcblx0XHRcdFx0XG5cdFx0XHRcdHN3aXRjaCh0eXBlb2YgdmFsdWUpe1xuXHRcdFx0XHRcdGNhc2UgXCJ1bmRlZmluZWRcIjpcblx0XHRcdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxuXHRcdFx0XHRcdFx0c29ydGVyID0gXCJib29sZWFuXCI7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0aWYoIWlzTmFOKHZhbHVlKSAmJiB2YWx1ZSAhPT0gXCJcIil7XG5cdFx0XHRcdFx0XHRcdHNvcnRlciA9IFwibnVtYmVyXCI7XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGlmKHZhbHVlLm1hdGNoKC8oKF5bMC05XStbYS16XSspfCheW2Etel0rWzAtOV0rKSkrJC9pKSl7XG5cdFx0XHRcdFx0XHRcdFx0c29ydGVyID0gXCJhbHBoYW51bVwiO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gU29ydC5zb3J0ZXJzW3NvcnRlcl07XG5cdH1cblx0XG5cdC8vd29yayB0aHJvdWdoIHNvcnQgbGlzdCBzb3J0aW5nIGRhdGFcblx0c29ydChkYXRhLCBzb3J0T25seSl7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdHNvcnRMaXN0ID0gdGhpcy50YWJsZS5vcHRpb25zLnNvcnRPcmRlclJldmVyc2UgPyBzZWxmLnNvcnRMaXN0LnNsaWNlKCkucmV2ZXJzZSgpIDogc2VsZi5zb3J0TGlzdCxcblx0XHRzb3J0TGlzdEFjdHVhbCA9IFtdLFxuXHRcdHJvd0NvbXBvbmVudHMgPSBbXTtcblx0XHRcblx0XHRpZih0aGlzLnN1YnNjcmliZWRFeHRlcm5hbChcImRhdGFTb3J0aW5nXCIpKXtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFTb3J0aW5nXCIsIHNlbGYuZ2V0U29ydCgpKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoIXNvcnRPbmx5KSB7XG5cdFx0XHRzZWxmLmNsZWFyQ29sdW1uSGVhZGVycygpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuc29ydE1vZGUgIT09IFwicmVtb3RlXCIpe1xuXHRcdFx0XG5cdFx0XHQvL2J1aWxkIGxpc3Qgb2YgdmFsaWQgc29ydGVycyBhbmQgdHJpZ2dlciBjb2x1bW4gc3BlY2lmaWMgY2FsbGJhY2tzIGJlZm9yZSBzb3J0IGJlZ2luc1xuXHRcdFx0c29ydExpc3QuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpKXtcblx0XHRcdFx0dmFyIHNvcnRPYmo7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihpdGVtLmNvbHVtbil7XG5cdFx0XHRcdFx0c29ydE9iaiA9IGl0ZW0uY29sdW1uLm1vZHVsZXMuc29ydDtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZihzb3J0T2JqKXtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0Ly9pZiBubyBzb3J0ZXIgaGFzIGJlZW4gZGVmaW5lZCwgdGFrZSBhIGd1ZXNzXG5cdFx0XHRcdFx0XHRpZighc29ydE9iai5zb3J0ZXIpe1xuXHRcdFx0XHRcdFx0XHRzb3J0T2JqLnNvcnRlciA9IHNlbGYuZmluZFNvcnRlcihpdGVtLmNvbHVtbik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGl0ZW0ucGFyYW1zID0gdHlwZW9mIHNvcnRPYmoucGFyYW1zID09PSBcImZ1bmN0aW9uXCIgPyBzb3J0T2JqLnBhcmFtcyhpdGVtLmNvbHVtbi5nZXRDb21wb25lbnQoKSwgaXRlbS5kaXIpIDogc29ydE9iai5wYXJhbXM7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHNvcnRMaXN0QWN0dWFsLnB1c2goaXRlbSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKCFzb3J0T25seSkge1xuXHRcdFx0XHRcdFx0c2VsZi5zZXRDb2x1bW5IZWFkZXIoaXRlbS5jb2x1bW4sIGl0ZW0uZGlyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHQvL3NvcnQgZGF0YVxuXHRcdFx0aWYgKHNvcnRMaXN0QWN0dWFsLmxlbmd0aCkge1xuXHRcdFx0XHRzZWxmLl9zb3J0SXRlbXMoZGF0YSwgc29ydExpc3RBY3R1YWwpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0fWVsc2UgaWYoIXNvcnRPbmx5KSB7XG5cdFx0XHRzb3J0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0sIGkpe1xuXHRcdFx0XHRzZWxmLnNldENvbHVtbkhlYWRlcihpdGVtLmNvbHVtbiwgaXRlbS5kaXIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0XG5cdFx0aWYodGhpcy5zdWJzY3JpYmVkRXh0ZXJuYWwoXCJkYXRhU29ydGVkXCIpKXtcblx0XHRcdGRhdGEuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdHJvd0NvbXBvbmVudHMucHVzaChyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFTb3J0ZWRcIiwgc2VsZi5nZXRTb3J0KCksIHJvd0NvbXBvbmVudHMpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gZGF0YTtcblx0fVxuXHRcblx0Ly9jbGVhciBzb3J0IGFycm93cyBvbiBjb2x1bW5zXG5cdGNsZWFyQ29sdW1uSGVhZGVycygpe1xuXHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRSZWFsQ29sdW1ucygpLmZvckVhY2goKGNvbHVtbikgPT4ge1xuXHRcdFx0aWYoY29sdW1uLm1vZHVsZXMuc29ydCl7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLnNvcnQuZGlyID0gXCJub25lXCI7XG5cdFx0XHRcdGNvbHVtbi5nZXRFbGVtZW50KCkuc2V0QXR0cmlidXRlKFwiYXJpYS1zb3J0XCIsIFwibm9uZVwiKTtcblx0XHRcdFx0dGhpcy5zZXRDb2x1bW5IZWFkZXJTb3J0SWNvbihjb2x1bW4sIFwibm9uZVwiKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHRcblx0Ly9zZXQgdGhlIGNvbHVtbiBoZWFkZXIgc29ydCBkaXJlY3Rpb25cblx0c2V0Q29sdW1uSGVhZGVyKGNvbHVtbiwgZGlyKXtcblx0XHRjb2x1bW4ubW9kdWxlcy5zb3J0LmRpciA9IGRpcjtcblx0XHRjb2x1bW4uZ2V0RWxlbWVudCgpLnNldEF0dHJpYnV0ZShcImFyaWEtc29ydFwiLCBkaXIgPT09IFwiYXNjXCIgPyBcImFzY2VuZGluZ1wiIDogXCJkZXNjZW5kaW5nXCIpO1xuXHRcdHRoaXMuc2V0Q29sdW1uSGVhZGVyU29ydEljb24oY29sdW1uLCBkaXIpO1xuXHR9XG5cdFxuXHRzZXRDb2x1bW5IZWFkZXJTb3J0SWNvbihjb2x1bW4sIGRpcil7XG5cdFx0dmFyIHNvcnRFbCA9IGNvbHVtbi5tb2R1bGVzLnNvcnQuZWxlbWVudCxcblx0XHRhcnJvd0VsO1xuXHRcdFxuXHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlclNvcnQgJiYgdHlwZW9mIHRoaXMudGFibGUub3B0aW9ucy5oZWFkZXJTb3J0RWxlbWVudCA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdHdoaWxlKHNvcnRFbC5maXJzdENoaWxkKSBzb3J0RWwucmVtb3ZlQ2hpbGQoc29ydEVsLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XG5cdFx0XHRhcnJvd0VsID0gdGhpcy50YWJsZS5vcHRpb25zLmhlYWRlclNvcnRFbGVtZW50LmNhbGwodGhpcy50YWJsZSwgY29sdW1uLmdldENvbXBvbmVudCgpLCBkaXIpO1xuXHRcdFx0XG5cdFx0XHRpZih0eXBlb2YgYXJyb3dFbCA9PT0gXCJvYmplY3RcIil7XG5cdFx0XHRcdHNvcnRFbC5hcHBlbmRDaGlsZChhcnJvd0VsKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0c29ydEVsLmlubmVySFRNTCA9IGFycm93RWw7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3NvcnQgZWFjaCBpdGVtIGluIHNvcnQgbGlzdFxuXHRfc29ydEl0ZW1zKGRhdGEsIHNvcnRMaXN0KXtcblx0XHR2YXIgc29ydGVyQ291bnQgPSBzb3J0TGlzdC5sZW5ndGggLSAxO1xuXHRcdFxuXHRcdGRhdGEuc29ydCgoYSwgYikgPT4ge1xuXHRcdFx0dmFyIHJlc3VsdDtcblx0XHRcdFxuXHRcdFx0Zm9yKHZhciBpID0gc29ydGVyQ291bnQ7IGk+PSAwOyBpLS0pe1xuXHRcdFx0XHRsZXQgc29ydEl0ZW0gPSBzb3J0TGlzdFtpXTtcblx0XHRcdFx0XG5cdFx0XHRcdHJlc3VsdCA9IHRoaXMuX3NvcnRSb3coYSwgYiwgc29ydEl0ZW0uY29sdW1uLCBzb3J0SXRlbS5kaXIsIHNvcnRJdGVtLnBhcmFtcyk7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihyZXN1bHQgIT09IDApe1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fSk7XG5cdH1cblx0XG5cdC8vcHJvY2VzcyBpbmRpdmlkdWFsIHJvd3MgZm9yIGEgc29ydCBmdW5jdGlvbiBvbiBhY3RpdmUgZGF0YVxuXHRfc29ydFJvdyhhLCBiLCBjb2x1bW4sIGRpciwgcGFyYW1zKXtcblx0XHR2YXIgZWwxQ29tcCwgZWwyQ29tcDtcblx0XHRcblx0XHQvL3N3aXRjaCBlbGVtZW50cyBkZXBlbmRpbmcgb24gc2VhcmNoIGRpcmVjdGlvblxuXHRcdHZhciBlbDEgPSBkaXIgPT0gXCJhc2NcIiA/IGEgOiBiO1xuXHRcdHZhciBlbDIgPSBkaXIgPT0gXCJhc2NcIiA/IGIgOiBhO1xuXHRcdFxuXHRcdGEgPSBjb2x1bW4uZ2V0RmllbGRWYWx1ZShlbDEuZ2V0RGF0YSgpKTtcblx0XHRiID0gY29sdW1uLmdldEZpZWxkVmFsdWUoZWwyLmdldERhdGEoKSk7XG5cdFx0XG5cdFx0YSA9IHR5cGVvZiBhICE9PSBcInVuZGVmaW5lZFwiID8gYSA6IFwiXCI7XG5cdFx0YiA9IHR5cGVvZiBiICE9PSBcInVuZGVmaW5lZFwiID8gYiA6IFwiXCI7XG5cdFx0XG5cdFx0ZWwxQ29tcCA9IGVsMS5nZXRDb21wb25lbnQoKTtcblx0XHRlbDJDb21wID0gZWwyLmdldENvbXBvbmVudCgpO1xuXHRcdFxuXHRcdHJldHVybiBjb2x1bW4ubW9kdWxlcy5zb3J0LnNvcnRlci5jYWxsKHRoaXMsIGEsIGIsIGVsMUNvbXAsIGVsMkNvbXAsIGNvbHVtbi5nZXRDb21wb25lbnQoKSwgZGlyLCBwYXJhbXMpO1xuXHR9XG59XG5cbmNsYXNzIEdyaWRDYWxjdWxhdG9ye1xyXG5cdGNvbnN0cnVjdG9yKGNvbHVtbnMsIHJvd3Mpe1xyXG5cdFx0dGhpcy5jb2x1bW5Db3VudCA9IGNvbHVtbnM7XHJcblx0XHR0aGlzLnJvd0NvdW50ID0gcm93cztcclxuXHJcblx0XHR0aGlzLmNvbHVtblN0cmluZyA9IFtdO1xyXG5cdFx0dGhpcy5jb2x1bW5zID0gW107XHJcblx0XHR0aGlzLnJvd3MgPSBbXTtcclxuXHR9XHJcblxyXG5cdGdlbkNvbHVtbnMoZGF0YSl7XHJcblx0XHR2YXIgY29sQ291bnQgPSBNYXRoLm1heCh0aGlzLmNvbHVtbkNvdW50LCBNYXRoLm1heCguLi5kYXRhLm1hcChpdGVtID0+IGl0ZW0ubGVuZ3RoKSkpO1xyXG5cclxuXHRcdHRoaXMuY29sdW1uU3RyaW5nID0gW107XHJcblx0XHR0aGlzLmNvbHVtbnMgPSBbXTtcclxuXHJcblx0XHRmb3IobGV0IGkgPSAxOyBpIDw9IGNvbENvdW50OyBpKyspe1xyXG5cdFx0XHR0aGlzLmluY3JlbWVudENoYXIodGhpcy5jb2x1bW5TdHJpbmcubGVuZ3RoIC0gMSk7XHJcblx0XHRcdHRoaXMuY29sdW1ucy5wdXNoKHRoaXMuY29sdW1uU3RyaW5nLmpvaW4oXCJcIikpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0aGlzLmNvbHVtbnM7XHJcblx0fVxyXG5cclxuXHRnZW5Sb3dzKGRhdGEpe1xyXG5cdFx0dmFyIHJvd0NvdW50ID0gTWF0aC5tYXgodGhpcy5yb3dDb3VudCwgZGF0YS5sZW5ndGgpO1xyXG5cclxuXHRcdHRoaXMucm93cyA9IFtdO1xyXG5cclxuXHRcdGZvcihsZXQgaSA9IDE7IGkgPD0gcm93Q291bnQ7IGkrKyl7XHJcblx0XHRcdHRoaXMucm93cy5wdXNoKGkpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRyZXR1cm4gdGhpcy5yb3dzO1xyXG5cdH1cclxuXHJcblx0aW5jcmVtZW50Q2hhcihpKXtcclxuXHRcdGxldCBjaGFyID0gdGhpcy5jb2x1bW5TdHJpbmdbaV07XHJcblxyXG5cdFx0aWYoY2hhcil7XHJcblx0XHRcdGlmKGNoYXIgIT09IFwiWlwiKXtcclxuXHRcdFx0XHR0aGlzLmNvbHVtblN0cmluZ1tpXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5jb2x1bW5TdHJpbmdbaV0uY2hhckNvZGVBdCgwKSArIDEpO1xyXG5cdFx0XHR9ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5jb2x1bW5TdHJpbmdbaV0gPSBcIkFcIjtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRpZihpKXtcclxuXHRcdFx0XHRcdHRoaXMuaW5jcmVtZW50Q2hhcihpLTEpO1xyXG5cdFx0XHRcdH1lbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuY29sdW1uU3RyaW5nLnB1c2goXCJBXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fWVsc2Uge1xyXG5cdFx0XHR0aGlzLmNvbHVtblN0cmluZy5wdXNoKFwiQVwiKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHNldFJvd0NvdW50KGNvdW50KXtcclxuXHRcdHRoaXMucm93Q291bnQgPSBjb3VudDtcclxuXHR9XHJcblxyXG5cdHNldENvbHVtbkNvdW50KGNvdW50KXtcclxuXHRcdHRoaXMuY29sdW1uQ291bnQgPSBjb3VudDtcclxuXHR9XHJcbn1cblxuY2xhc3MgU2hlZXRDb21wb25lbnQge1xyXG5cdGNvbnN0cnVjdG9yKHNoZWV0KSB7XHJcblx0XHR0aGlzLl9zaGVldCA9IHNoZWV0O1xyXG5cclxuXHRcdHJldHVybiBuZXcgUHJveHkodGhpcywge1xyXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uICh0YXJnZXQsIG5hbWUsIHJlY2VpdmVyKSB7XHJcblx0XHRcdFx0aWYgKHR5cGVvZiB0YXJnZXRbbmFtZV0gIT09IFwidW5kZWZpbmVkXCIpIHtcclxuXHRcdFx0XHRcdHJldHVybiB0YXJnZXRbbmFtZV07XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybiB0YXJnZXQuX3NoZWV0LnRhYmxlLmNvbXBvbmVudEZ1bmN0aW9uQmluZGVyLmhhbmRsZShcInNoZWV0XCIsIHRhcmdldC5fc2hlZXQsIG5hbWUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSxcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0Z2V0VGl0bGUoKXtcclxuXHRcdHJldHVybiB0aGlzLl9zaGVldC50aXRsZTtcclxuXHR9XHJcblxyXG5cdGdldEtleSgpe1xyXG5cdFx0cmV0dXJuIHRoaXMuX3NoZWV0LmtleTtcclxuXHR9XHJcblxyXG5cdGdldERlZmluaXRpb24oKXtcclxuXHRcdHJldHVybiB0aGlzLl9zaGVldC5nZXREZWZpbml0aW9uKCk7XHJcblx0fVxyXG5cclxuXHRnZXREYXRhKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3NoZWV0LmdldERhdGEoKTtcclxuXHR9XHJcblxyXG5cdHNldERhdGEoZGF0YSkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3NoZWV0LnNldERhdGEoZGF0YSk7XHJcblx0fVxyXG5cclxuXHRjbGVhcigpe1xyXG5cdFx0cmV0dXJuIHRoaXMuX3NoZWV0LmNsZWFyKCk7XHJcblx0fVxyXG5cclxuXHRyZW1vdmUoKXtcclxuXHRcdHJldHVybiB0aGlzLl9zaGVldC5yZW1vdmUoKTtcclxuXHR9XHJcblx0XHJcblx0YWN0aXZlKCl7XHJcblx0XHRyZXR1cm4gdGhpcy5fc2hlZXQuYWN0aXZlKCk7XHJcblx0fVxyXG5cclxuXHRzZXRUaXRsZSh0aXRsZSl7XHJcblx0XHRyZXR1cm4gdGhpcy5fc2hlZXQuc2V0VGl0bGUodGl0bGUpO1xyXG5cdH1cclxuXHJcblx0c2V0Um93cyhyb3dzKXtcclxuXHRcdHJldHVybiB0aGlzLl9zaGVldC5zZXRSb3dzKHJvd3MpO1xyXG5cdH1cclxuXHJcblx0c2V0Q29sdW1ucyhjb2x1bW5zKXtcclxuXHRcdHJldHVybiB0aGlzLl9zaGVldC5zZXRDb2x1bW5zKGNvbHVtbnMpO1xyXG5cdH1cclxufVxuXG5jbGFzcyBTaGVldCBleHRlbmRzIENvcmVGZWF0dXJle1xyXG5cdGNvbnN0cnVjdG9yKHNwcmVhZHNoZWV0TWFuYWdlciwgZGVmaW5pdGlvbikge1xyXG5cdFx0c3VwZXIoc3ByZWFkc2hlZXRNYW5hZ2VyLnRhYmxlKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5zcHJlYWRzaGVldE1hbmFnZXIgPSBzcHJlYWRzaGVldE1hbmFnZXI7XHJcblx0XHR0aGlzLmRlZmluaXRpb24gPSBkZWZpbml0aW9uO1xyXG5cdFx0XHJcblx0XHR0aGlzLnRpdGxlID0gdGhpcy5kZWZpbml0aW9uLnRpdGxlIHx8IFwiXCI7XHJcblx0XHR0aGlzLmtleSA9IHRoaXMuZGVmaW5pdGlvbi5rZXkgfHwgdGhpcy5kZWZpbml0aW9uLnRpdGxlO1xyXG5cdFx0dGhpcy5yb3dDb3VudCA9IHRoaXMuZGVmaW5pdGlvbi5yb3dzO1xyXG5cdFx0dGhpcy5jb2x1bW5Db3VudCA9IHRoaXMuZGVmaW5pdGlvbi5jb2x1bW5zO1xyXG5cdFx0dGhpcy5kYXRhID0gdGhpcy5kZWZpbml0aW9uLmRhdGEgfHwgW107XHJcblx0XHR0aGlzLmVsZW1lbnQgPSBudWxsO1xyXG5cdFx0dGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xyXG5cdFx0XHJcblx0XHR0aGlzLmdyaWQgPSBuZXcgR3JpZENhbGN1bGF0b3IodGhpcy5jb2x1bW5Db3VudCwgdGhpcy5yb3dDb3VudCk7XHJcblx0XHRcclxuXHRcdHRoaXMuZGVmYXVsdENvbHVtbkRlZmluaXRpb24gPSB7d2lkdGg6MTAwLCBoZWFkZXJIb3pBbGlnbjpcImNlbnRlclwiLCBoZWFkZXJTb3J0OmZhbHNlfTtcclxuXHRcdHRoaXMuY29sdW1uRGVmaW5pdGlvbiA9IE9iamVjdC5hc3NpZ24odGhpcy5kZWZhdWx0Q29sdW1uRGVmaW5pdGlvbiwgdGhpcy5vcHRpb25zKFwic3ByZWFkc2hlZXRDb2x1bW5EZWZpbml0aW9uXCIpKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5jb2x1bW5EZWZzID0gW107XHJcblx0XHR0aGlzLnJvd0RlZnMgPSBbXTtcclxuXHRcdHRoaXMuY29sdW1uRmllbGRzID0gW107XHJcblx0XHR0aGlzLmNvbHVtbnMgPSBbXTtcclxuXHRcdHRoaXMucm93cyA9IFtdO1xyXG5cdFx0XHJcblx0XHR0aGlzLnNjcm9sbFRvcCA9IG51bGw7XHJcblx0XHR0aGlzLnNjcm9sbExlZnQgPSBudWxsO1xyXG5cdFx0XHJcblx0XHR0aGlzLmluaXRpYWxpemUoKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwic2hlZXRBZGRlZFwiLCB0aGlzLmdldENvbXBvbmVudCgpKTtcclxuXHR9XHJcblx0XHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHQvLy8vLy8vLy8gSW5pdGlhbGl6YXRpb24gLy8vLy8vLy8vL1xyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0XHJcblx0aW5pdGlhbGl6ZSgpe1xyXG5cdFx0dGhpcy5pbml0aWFsaXplRWxlbWVudCgpO1xyXG5cdFx0dGhpcy5pbml0aWFsaXplQ29sdW1ucygpO1xyXG5cdFx0dGhpcy5pbml0aWFsaXplUm93cygpO1xyXG5cdH1cclxuXHRcclxuXHRyZWluaXRpYWxpemUoKXtcclxuXHRcdHRoaXMuaW5pdGlhbGl6ZUNvbHVtbnMoKTtcclxuXHRcdHRoaXMuaW5pdGlhbGl6ZVJvd3MoKTtcclxuXHR9XHJcblx0XHJcblx0aW5pdGlhbGl6ZUVsZW1lbnQoKXtcclxuXHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcblx0XHR0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1zcHJlYWRzaGVldC10YWJcIik7XHJcblx0XHR0aGlzLmVsZW1lbnQuaW5uZXJUZXh0ID0gdGhpcy50aXRsZTtcclxuXHRcdFxyXG5cdFx0dGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcblx0XHRcdHRoaXMuc3ByZWFkc2hlZXRNYW5hZ2VyLmxvYWRTaGVldCh0aGlzKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHRcclxuXHRpbml0aWFsaXplQ29sdW1ucygpe1xyXG5cdFx0dGhpcy5ncmlkLnNldENvbHVtbkNvdW50KHRoaXMuY29sdW1uQ291bnQpO1xyXG5cdFx0dGhpcy5jb2x1bW5GaWVsZHMgPSB0aGlzLmdyaWQuZ2VuQ29sdW1ucyh0aGlzLmRhdGEpO1xyXG5cdFx0XHJcblx0XHR0aGlzLmNvbHVtbkRlZnMgPSBbXTtcclxuXHRcdFxyXG5cdFx0dGhpcy5jb2x1bW5GaWVsZHMuZm9yRWFjaCgocmVmKSA9PiB7XHJcblx0XHRcdHZhciBkZWYgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbHVtbkRlZmluaXRpb24pO1xyXG5cdFx0XHRkZWYuZmllbGQgPSByZWY7XHJcblx0XHRcdGRlZi50aXRsZSA9IHJlZjtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuY29sdW1uRGVmcy5wdXNoKGRlZik7XHJcblx0XHR9KTtcclxuXHR9XHJcblx0XHJcblx0aW5pdGlhbGl6ZVJvd3MoKXtcclxuXHRcdHZhciByZWZzO1xyXG5cdFx0XHJcblx0XHR0aGlzLmdyaWQuc2V0Um93Q291bnQodGhpcy5yb3dDb3VudCk7XHJcblx0XHRcclxuXHRcdHJlZnMgPSB0aGlzLmdyaWQuZ2VuUm93cyh0aGlzLmRhdGEpO1xyXG5cdFx0XHJcblx0XHR0aGlzLnJvd0RlZnMgPSBbXTtcclxuXHRcdFxyXG5cdFx0cmVmcy5mb3JFYWNoKChyZWYsIGkpID0+IHtcclxuXHRcdFx0dmFyIGRlZiA9IHtcIl9pZFwiOnJlZn07XHJcblx0XHRcdHZhciBkYXRhID0gdGhpcy5kYXRhW2ldO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYoZGF0YSl7XHJcblx0XHRcdFx0ZGF0YS5mb3JFYWNoKCh2YWwsIGopID0+IHtcclxuXHRcdFx0XHRcdHZhciBmaWVsZCA9IHRoaXMuY29sdW1uRmllbGRzW2pdO1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRpZihmaWVsZCl7XHJcblx0XHRcdFx0XHRcdGRlZltmaWVsZF0gPSB2YWw7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdHRoaXMucm93RGVmcy5wdXNoKGRlZik7XHJcblx0XHR9KTtcclxuXHR9XHJcblx0XHJcblx0dW5sb2FkKCl7XHJcblx0XHR0aGlzLmlzQWN0aXZlID0gZmFsc2U7XHJcblx0XHR0aGlzLnNjcm9sbFRvcCA9IHRoaXMudGFibGUucm93TWFuYWdlci5zY3JvbGxUb3A7XHJcblx0XHR0aGlzLnNjcm9sbExlZnQgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsTGVmdDtcclxuXHRcdHRoaXMuZGF0YSA9IHRoaXMuZ2V0RGF0YSh0cnVlKTtcclxuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXNwcmVhZHNoZWV0LXRhYi1hY3RpdmVcIik7XHJcblx0fVxyXG5cdFxyXG5cdGxvYWQoKXtcclxuXHRcdFxyXG5cdFx0dmFyIHdhc0luYWN0aXZlID0gIXRoaXMuaXNBY3RpdmU7XHJcblx0XHRcclxuXHRcdHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xyXG5cdFx0dGhpcy50YWJsZS5ibG9ja1JlZHJhdygpO1xyXG5cdFx0dGhpcy50YWJsZS5zZXREYXRhKFtdKTtcclxuXHRcdHRoaXMudGFibGUuc2V0Q29sdW1ucyh0aGlzLmNvbHVtbkRlZnMpO1xyXG5cdFx0dGhpcy50YWJsZS5zZXREYXRhKHRoaXMucm93RGVmcyk7XHJcblx0XHR0aGlzLnRhYmxlLnJlc3RvcmVSZWRyYXcoKTtcclxuXHRcdFxyXG5cdFx0aWYod2FzSW5hY3RpdmUgJiYgdGhpcy5zY3JvbGxUb3AgIT09IG51bGwpe1xyXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0O1xyXG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLnNjcm9sbFRvcDtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itc3ByZWFkc2hlZXQtdGFiLWFjdGl2ZVwiKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwic2hlZXRMb2FkZWRcIiwgdGhpcy5nZXRDb21wb25lbnQoKSk7XHJcblx0fVxyXG5cdFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0Ly8vLy8vLy8gSGVscGVyIEZ1bmN0aW9ucyAvLy8vLy8vLy9cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFxyXG5cdGdldENvbXBvbmVudCgpe1xyXG5cdFx0cmV0dXJuIG5ldyBTaGVldENvbXBvbmVudCh0aGlzKTtcclxuXHR9XHJcblx0XHJcblx0Z2V0RGVmaW5pdGlvbigpe1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0dGl0bGU6dGhpcy50aXRsZSxcclxuXHRcdFx0a2V5OnRoaXMua2V5LFxyXG5cdFx0XHRyb3dzOnRoaXMucm93Q291bnQsXHJcblx0XHRcdGNvbHVtbnM6dGhpcy5jb2x1bW5Db3VudCxcclxuXHRcdFx0ZGF0YTp0aGlzLmdldERhdGEoKSxcclxuXHRcdH07XHJcblx0fVxyXG5cdFxyXG5cdGdldERhdGEoZnVsbCl7XHJcblx0XHR2YXIgb3V0cHV0ID0gW10sIFxyXG5cdFx0cm93V2lkdGhzLFxyXG5cdFx0b3V0cHV0V2lkdGgsIG91dHB1dEhlaWdodDtcclxuXHRcdFxyXG5cdFx0Ly9tYXAgZGF0YSB0byBhcnJheSBmb3JtYXRcclxuXHRcdHRoaXMucm93RGVmcy5mb3JFYWNoKChyb3dEYXRhKSA9PiB7XHJcblx0XHRcdHZhciByb3cgPSBbXTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuY29sdW1uRmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XHJcblx0XHRcdFx0cm93LnB1c2gocm93RGF0YVtmaWVsZF0pO1xyXG5cdFx0XHR9KTtcclxuXHRcdFx0XHJcblx0XHRcdG91dHB1dC5wdXNoKHJvdyk7XHJcblx0XHR9KTtcclxuXHRcdFxyXG5cdFx0Ly90cmltIG91dHB1dFxyXG5cdFx0aWYoIWZ1bGwgJiYgIXRoaXMub3B0aW9ucyhcInNwcmVhZHNoZWV0T3V0cHV0RnVsbFwiKSl7XHJcblx0XHRcdFxyXG5cdFx0XHQvL2NhbGN1bGF0ZSB1c2VkIGFyZWEgb2YgZGF0YVxyXG5cdFx0XHRyb3dXaWR0aHMgPSBvdXRwdXQubWFwKHJvdyA9PiByb3cuZmluZExhc3RJbmRleCh2YWwgPT4gdHlwZW9mIHZhbCAhPT0gJ3VuZGVmaW5lZCcpICsgMSk7XHJcblx0XHRcdG91dHB1dFdpZHRoID0gTWF0aC5tYXgoLi4ucm93V2lkdGhzKTtcclxuXHRcdFx0b3V0cHV0SGVpZ2h0ID0gcm93V2lkdGhzLmZpbmRMYXN0SW5kZXgod2lkdGggPT4gd2lkdGggPiAwKSArIDE7XHJcblx0XHRcdFxyXG5cdFx0XHRvdXRwdXQgPSBvdXRwdXQuc2xpY2UoMCwgb3V0cHV0SGVpZ2h0KTtcclxuXHRcdFx0b3V0cHV0ID0gb3V0cHV0Lm1hcChyb3cgPT4gcm93LnNsaWNlKDAsIG91dHB1dFdpZHRoKSk7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHJldHVybiBvdXRwdXQ7XHJcblx0fVxyXG5cdFxyXG5cdHNldERhdGEoZGF0YSl7XHJcblx0XHR0aGlzLmRhdGEgPSBkYXRhO1xyXG5cdFx0dGhpcy5yZWluaXRpYWxpemUoKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwic2hlZXRVcGRhdGVkXCIsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xyXG5cdFx0XHJcblx0XHRpZih0aGlzLmlzQWN0aXZlKXtcclxuXHRcdFx0dGhpcy5sb2FkKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGNsZWFyKCl7XHJcblx0XHR0aGlzLnNldERhdGEoW10pO1xyXG5cdH1cclxuXHRcclxuXHRzZXRUaXRsZSh0aXRsZSl7XHJcblx0XHR0aGlzLnRpdGxlID0gdGl0bGU7XHJcblx0XHR0aGlzLmVsZW1lbnQuaW5uZXJUZXh0ID0gdGl0bGU7XHJcblx0XHRcclxuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInNoZWV0VXBkYXRlZFwiLCB0aGlzLmdldENvbXBvbmVudCgpKTtcclxuXHR9XHJcblx0XHJcblx0c2V0Um93cyhyb3dzKXtcclxuXHRcdHRoaXMucm93Q291bnQgPSByb3dzO1xyXG5cdFx0dGhpcy5pbml0aWFsaXplUm93cygpO1xyXG5cdFx0XHJcblx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJzaGVldFVwZGF0ZWRcIiwgdGhpcy5nZXRDb21wb25lbnQoKSk7XHJcblx0XHRcclxuXHRcdGlmKHRoaXMuaXNBY3RpdmUpe1xyXG5cdFx0XHR0aGlzLmxvYWQoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0c2V0Q29sdW1ucyhjb2x1bW5zKXtcclxuXHRcdHRoaXMuY29sdW1uQ291bnQgPSBjb2x1bW5zO1xyXG5cdFx0dGhpcy5yZWluaXRpYWxpemUoKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwic2hlZXRVcGRhdGVkXCIsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xyXG5cdFx0XHJcblx0XHRpZih0aGlzLmlzQWN0aXZlKXtcclxuXHRcdFx0dGhpcy5sb2FkKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdHJlbW92ZSgpe1xyXG5cdFx0dGhpcy5zcHJlYWRzaGVldE1hbmFnZXIucmVtb3ZlU2hlZXQodGhpcyk7XHJcblx0fVxyXG5cdFxyXG5cdGRlc3Ryb3koKXtcclxuXHRcdGlmKHRoaXMuZWxlbWVudC5wYXJlbnROb2RlKXtcclxuXHRcdFx0dGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwic2hlZXRSZW1vdmVkXCIsIHRoaXMuZ2V0Q29tcG9uZW50KCkpO1xyXG5cdH1cclxuXHRcclxuXHRhY3RpdmUoKXtcclxuXHRcdHRoaXMuc3ByZWFkc2hlZXRNYW5hZ2VyLmxvYWRTaGVldCh0aGlzKTtcclxuXHR9XHJcbn1cblxuY2xhc3MgU3ByZWFkc2hlZXQgZXh0ZW5kcyBNb2R1bGV7XHJcblx0XHJcblx0c3RhdGljIG1vZHVsZU5hbWUgPSBcInNwcmVhZHNoZWV0XCI7XHJcblx0XHJcblx0Y29uc3RydWN0b3IodGFibGUpe1xyXG5cdFx0c3VwZXIodGFibGUpO1xyXG5cdFx0XHJcblx0XHR0aGlzLnNoZWV0cyA9IFtdO1xyXG5cdFx0dGhpcy5lbGVtZW50ID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic3ByZWFkc2hlZXRcIiwgZmFsc2UpOyBcclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInNwcmVhZHNoZWV0Um93c1wiLCA1MCk7IFxyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic3ByZWFkc2hlZXRDb2x1bW5zXCIsIDUwKTsgXHJcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJzcHJlYWRzaGVldENvbHVtbkRlZmluaXRpb25cIiwge30pOyBcclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInNwcmVhZHNoZWV0T3V0cHV0RnVsbFwiLCBmYWxzZSk7IFxyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic3ByZWFkc2hlZXREYXRhXCIsIGZhbHNlKTsgXHJcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJzcHJlYWRzaGVldFNoZWV0c1wiLCBmYWxzZSk7IFxyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwic3ByZWFkc2hlZXRTaGVldFRhYnNcIiwgZmFsc2UpOyBcclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInNwcmVhZHNoZWV0U2hlZXRUYWJzRWxlbWVudFwiLCBmYWxzZSk7IFxyXG5cdFx0XHJcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInNldFNoZWV0c1wiLCB0aGlzLnNldFNoZWV0cy5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiYWRkU2hlZXRcIiwgdGhpcy5hZGRTaGVldC5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiZ2V0U2hlZXRzXCIsIHRoaXMuZ2V0U2hlZXRzLmJpbmQodGhpcykpO1xyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRTaGVldERlZmluaXRpb25zXCIsIHRoaXMuZ2V0U2hlZXREZWZpbml0aW9ucy5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwic2V0U2hlZXREYXRhXCIsIHRoaXMuc2V0U2hlZXREYXRhLmJpbmQodGhpcykpO1xyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRTaGVldFwiLCB0aGlzLmdldFNoZWV0LmJpbmQodGhpcykpO1xyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJnZXRTaGVldERhdGFcIiwgdGhpcy5nZXRTaGVldERhdGEuYmluZCh0aGlzKSk7XHJcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImNsZWFyU2hlZXRcIiwgdGhpcy5jbGVhclNoZWV0LmJpbmQodGhpcykpO1xyXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlRnVuY3Rpb24oXCJyZW1vdmVTaGVldFwiLCB0aGlzLnJlbW92ZVNoZWV0RnVuYy5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwiYWN0aXZlU2hlZXRcIiwgdGhpcy5hY3RpdmVTaGVldEZ1bmMuYmluZCh0aGlzKSk7XHJcblx0fVxyXG5cdFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0Ly8vLy8vIE1vZHVsZSBJbml0aWFsaXphdGlvbiAvLy8vLy9cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFxyXG5cdFxyXG5cdGluaXRpYWxpemUoKXtcclxuXHRcdGlmKHRoaXMub3B0aW9ucyhcInNwcmVhZHNoZWV0XCIpKXtcdFxyXG5cdFx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLWluaXRpYWxpemVkXCIsIHRoaXMudGFibGVJbml0aWFsaXplZC5iaW5kKHRoaXMpKTtcclxuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJkYXRhLWxvYWRlZFwiLCB0aGlzLmxvYWRSZW1vdGVEYXRhLmJpbmQodGhpcykpO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLmluZGV4ID0gXCJfaWRcIjtcclxuXHRcdFx0XHJcblx0XHRcdGlmKHRoaXMub3B0aW9ucyhcInNwcmVhZHNoZWV0RGF0YVwiKSAmJiB0aGlzLm9wdGlvbnMoXCJzcHJlYWRzaGVldFNoZWV0c1wiKSl7XHJcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiWW91IGNhbm5vdCB1c2Ugc3ByZWFkc2hlZXREYXRhIGFuZCBzcHJlYWRzaGVldFNoZWV0cyBhdCB0aGUgc2FtZSB0aW1lLCBpZ25vcmluZyBzcHJlYWRzaGVldERhdGFcIik7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0dGhpcy50YWJsZS5vcHRpb25zLnNwcmVhZHNoZWV0RGF0YSA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHR0aGlzLmNvbXBhdGliaWxpdHlDaGVjaygpO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYodGhpcy5vcHRpb25zKFwic3ByZWFkc2hlZXRTaGVldFRhYnNcIikpe1xyXG5cdFx0XHRcdHRoaXMuaW5pdGlhbGl6ZVRhYnNldCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGNvbXBhdGliaWxpdHlDaGVjaygpe1xyXG5cdFx0aWYodGhpcy5vcHRpb25zKFwiZGF0YVwiKSl7XHJcblx0XHRcdGNvbnNvbGUud2FybihcIkRvIG5vdCB1c2UgdGhlIGRhdGEgb3B0aW9uIHdoZW4gd29ya2luZyB3aXRoIHNwcmVhZHNoZWV0cywgdXNlIGVpdGhlciBzcHJlYWRzaGVldERhdGEgb3Igc3ByZWFkc2hlZXRTaGVldHMgdG8gcGFzcyBkYXRhIGludG8gdGhlIHRhYmxlXCIpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRpZih0aGlzLm9wdGlvbnMoXCJwYWdpbmF0aW9uXCIpKXtcclxuXHRcdFx0Y29uc29sZS53YXJuKFwiVGhlIHNwcmVhZHNoZWV0IG1vZHVsZSBpcyBub3QgY29tcGF0aWJsZSB3aXRoIHRoZSBwYWdpbmF0aW9uIG1vZHVsZVwiKTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0aWYodGhpcy5vcHRpb25zKFwiZ3JvdXBCeVwiKSl7XHJcblx0XHRcdGNvbnNvbGUud2FybihcIlRoZSBzcHJlYWRzaGVldCBtb2R1bGUgaXMgbm90IGNvbXBhdGlibGUgd2l0aCB0aGUgcm93IGdyb3VwaW5nIG1vZHVsZVwiKTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0aWYodGhpcy5vcHRpb25zKFwicmVzcG9uc2l2ZUNvbGxhcHNlXCIpKXtcclxuXHRcdFx0Y29uc29sZS53YXJuKFwiVGhlIHNwcmVhZHNoZWV0IG1vZHVsZSBpcyBub3QgY29tcGF0aWJsZSB3aXRoIHRoZSByZXNwb25zaXZlIGNvbGxhcHNlIG1vZHVsZVwiKTtcclxuXHRcdH1cclxuXHR9XHJcblx0aW5pdGlhbGl6ZVRhYnNldCgpe1xyXG5cdFx0dGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXNwcmVhZHNoZWV0LXRhYnNcIik7XHJcblx0XHR2YXIgYWx0Q29udGFpbmVyID0gdGhpcy5vcHRpb25zKFwic3ByZWFkc2hlZXRTaGVldFRhYnNFbGVtZW50XCIpO1xyXG5cdFx0XHJcblx0XHRpZihhbHRDb250YWluZXIgJiYgIShhbHRDb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpe1xyXG5cdFx0XHRhbHRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGFsdENvbnRhaW5lcik7XHJcblx0XHRcdFxyXG5cdFx0XHRpZighYWx0Q29udGFpbmVyKXtcclxuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVbmFibGUgdG8gZmluZCBlbGVtZW50IG1hdGNoaW5nIHNwcmVhZHNoZWV0U2hlZXRUYWJzRWxlbWVudCBzZWxlY3RvcjpcIiwgdGhpcy5vcHRpb25zKFwic3ByZWFkc2hlZXRTaGVldFRhYnNFbGVtZW50XCIpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRpZihhbHRDb250YWluZXIpe1xyXG5cdFx0XHRhbHRDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTtcclxuXHRcdH1lbHNlIHtcclxuXHRcdFx0dGhpcy5mb290ZXJBcHBlbmQodGhpcy5lbGVtZW50KTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0dGFibGVJbml0aWFsaXplZCgpe1xyXG5cdFx0aWYodGhpcy5zaGVldHMubGVuZ3RoKXtcclxuXHRcdFx0dGhpcy5sb2FkU2hlZXQodGhpcy5zaGVldHNbMF0pO1xyXG5cdFx0fWVsc2Uge1xyXG5cdFx0XHRcclxuXHRcdFx0aWYodGhpcy5vcHRpb25zKFwic3ByZWFkc2hlZXRTaGVldHNcIikpe1xyXG5cdFx0XHRcdHRoaXMubG9hZFNoZWV0cyh0aGlzLm9wdGlvbnMoXCJzcHJlYWRzaGVldFNoZWV0c1wiKSk7XHJcblx0XHRcdH1lbHNlIGlmKHRoaXMub3B0aW9ucyhcInNwcmVhZHNoZWV0RGF0YVwiKSl7XHJcblx0XHRcdFx0dGhpcy5sb2FkRGF0YSh0aGlzLm9wdGlvbnMoXCJzcHJlYWRzaGVldERhdGFcIikpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdC8vLy8vLy8vLy8vIEFqYXggUGFyc2luZyAvLy8vLy8vLy8vXHJcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcblx0bG9hZFJlbW90ZURhdGEoZGF0YSwgZGF0YTEsIGRhdGEyKXtcclxuXHRcdGNvbnNvbGUubG9nKFwiZGF0YVwiLCBkYXRhLCBkYXRhMSwgZGF0YTIpO1xyXG5cclxuXHRcdGlmKEFycmF5LmlzQXJyYXkoZGF0YSkpe1xyXG5cclxuXHRcdFx0dGhpcy50YWJsZS5kYXRhTG9hZGVyLmNsZWFyQWxlcnQoKTtcclxuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiZGF0YUxvYWRlZFwiLCBkYXRhKTtcclxuXHJcblx0XHRcdGlmKCFkYXRhLmxlbmd0aCB8fCBBcnJheS5pc0FycmF5KGRhdGFbMF0pKXtcclxuXHRcdFx0XHR0aGlzLmxvYWREYXRhKGRhdGEpO1xyXG5cdFx0XHR9ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5sb2FkU2hlZXRzKGRhdGEpO1xyXG5cdFx0XHR9XHJcblx0XHR9ZWxzZSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJTcHJlYWRzaGVldCBMb2FkaW5nIEVycm9yIC0gVW5hYmxlIHRvIHByb2Nlc3MgcmVtb3RlIGRhdGEgZHVlIHRvIGludmFsaWQgZGF0YSB0eXBlIFxcbkV4cGVjdGluZzogYXJyYXkgXFxuUmVjZWl2ZWQ6IFwiLCB0eXBlb2YgZGF0YSwgXCJcXG5EYXRhOiAgICAgXCIsIGRhdGEpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0Ly8vLy8vLy8vIFNoZWV0IE1hbmFnZW1lbnQgLy8vLy8vLy9cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFxyXG5cdFxyXG5cdGxvYWREYXRhKGRhdGEpe1xyXG5cdFx0dmFyIGRlZiA9IHtcclxuXHRcdFx0ZGF0YTpkYXRhLFxyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0dGhpcy5sb2FkU2hlZXQodGhpcy5uZXdTaGVldChkZWYpKTtcclxuXHR9XHJcblx0XHJcblx0ZGVzdHJveVNoZWV0cygpe1xyXG5cdFx0dGhpcy5zaGVldHMuZm9yRWFjaCgoc2hlZXQpID0+IHtcclxuXHRcdFx0c2hlZXQuZGVzdHJveSgpO1xyXG5cdFx0fSk7XHJcblx0XHRcclxuXHRcdHRoaXMuc2hlZXRzID0gW107XHJcblx0XHR0aGlzLmFjdGl2ZVNoZWV0ID0gbnVsbDtcclxuXHR9XHJcblx0XHJcblx0bG9hZFNoZWV0cyhzaGVldHMpe1x0XHJcblx0XHRpZighQXJyYXkuaXNBcnJheShzaGVldHMpKXtcclxuXHRcdFx0c2hlZXRzID0gW107XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHRoaXMuZGVzdHJveVNoZWV0cygpO1xyXG5cdFx0XHJcblx0XHRzaGVldHMuZm9yRWFjaCgoZGVmKSA9PiB7XHJcblx0XHRcdHRoaXMubmV3U2hlZXQoZGVmKTtcclxuXHRcdH0pO1xyXG5cdFx0XHJcblx0XHR0aGlzLmxvYWRTaGVldCh0aGlzLnNoZWV0c1swXSk7XHJcblx0fVxyXG5cdFxyXG5cdGxvYWRTaGVldChzaGVldCl7XHJcblx0XHRpZih0aGlzLmFjdGl2ZVNoZWV0ICE9PSBzaGVldCl7XHJcblx0XHRcdGlmKHRoaXMuYWN0aXZlU2hlZXQpe1xyXG5cdFx0XHRcdHRoaXMuYWN0aXZlU2hlZXQudW5sb2FkKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuYWN0aXZlU2hlZXQgPSBzaGVldDtcclxuXHRcdFx0XHJcblx0XHRcdHNoZWV0LmxvYWQoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0bmV3U2hlZXQoZGVmaW5pdGlvbiA9IHt9KXtcclxuXHRcdHZhciBzaGVldDtcclxuXHRcdFxyXG5cdFx0aWYoIWRlZmluaXRpb24ucm93cyl7XHJcblx0XHRcdGRlZmluaXRpb24ucm93cyA9IHRoaXMub3B0aW9ucyhcInNwcmVhZHNoZWV0Um93c1wiKTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0aWYoIWRlZmluaXRpb24uY29sdW1ucyl7XHJcblx0XHRcdGRlZmluaXRpb24uY29sdW1ucyA9IHRoaXMub3B0aW9ucyhcInNwcmVhZHNoZWV0Q29sdW1uc1wiKTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0c2hlZXQgPSBuZXcgU2hlZXQodGhpcywgZGVmaW5pdGlvbik7XHJcblx0XHRcclxuXHRcdHRoaXMuc2hlZXRzLnB1c2goc2hlZXQpO1xyXG5cdFx0XHJcblx0XHRpZih0aGlzLmVsZW1lbnQpe1xyXG5cdFx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQoc2hlZXQuZWxlbWVudCk7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHJldHVybiBzaGVldDtcclxuXHR9XHJcblx0XHJcblx0cmVtb3ZlU2hlZXQoc2hlZXQpe1xyXG5cdFx0dmFyIGluZGV4ID0gdGhpcy5zaGVldHMuaW5kZXhPZihzaGVldCksXHJcblx0XHRwcmV2U2hlZXQ7XHJcblx0XHRcclxuXHRcdGlmKHRoaXMuc2hlZXRzLmxlbmd0aCA+IDEpe1xyXG5cdFx0XHRpZihpbmRleCA+IC0xKXtcclxuXHRcdFx0XHR0aGlzLnNoZWV0cy5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cdFx0XHRcdHNoZWV0LmRlc3Ryb3koKTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRpZih0aGlzLmFjdGl2ZVNoZWV0ID09PSBzaGVldCl7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdHByZXZTaGVldCA9IHRoaXMuc2hlZXRzW2luZGV4IC0gMV0gfHwgdGhpcy5zaGVldHNbMF07XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdGlmKHByZXZTaGVldCl7XHJcblx0XHRcdFx0XHRcdHRoaXMubG9hZFNoZWV0KHByZXZTaGVldCk7XHJcblx0XHRcdFx0XHR9ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlU2hlZXQgPSBudWxsO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fWVsc2Uge1xyXG5cdFx0XHRjb25zb2xlLndhcm4oXCJVbmFibGUgdG8gcmVtb3ZlIHNoZWV0LCBhdCBsZWFzdCBvbmUgc2hlZXQgbXVzdCBiZSBhY3RpdmVcIik7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGxvb2t1cFNoZWV0KGtleSl7XHJcblx0XHRpZigha2V5KXtcclxuXHRcdFx0cmV0dXJuIHRoaXMuYWN0aXZlU2hlZXQ7XHJcblx0XHR9ZWxzZSBpZihrZXkgaW5zdGFuY2VvZiBTaGVldCl7XHJcblx0XHRcdHJldHVybiBrZXk7XHJcblx0XHR9ZWxzZSBpZihrZXkgaW5zdGFuY2VvZiBTaGVldENvbXBvbmVudCl7XHJcblx0XHRcdHJldHVybiBrZXkuX3NoZWV0O1xyXG5cdFx0fWVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5zaGVldHMuZmluZChzaGVldCA9PiBzaGVldC5rZXkgPT09IGtleSkgfHwgZmFsc2U7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdFxyXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblx0Ly8vLy8vLy8gUHVibGljIEZ1bmN0aW9ucyAvLy8vLy8vLy9cclxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cdFxyXG5cdHNldFNoZWV0cyhzaGVldHMpe1xyXG5cdFx0dGhpcy5sb2FkU2hlZXRzKHNoZWV0cyk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuZ2V0U2hlZXRzKCk7XHJcblx0fVxyXG5cclxuXHRhZGRTaGVldChzaGVldCl7XHJcblx0XHRyZXR1cm4gdGhpcy5uZXdTaGVldChzaGVldCkuZ2V0Q29tcG9uZW50KCk7XHJcblx0fVxyXG5cdFxyXG5cdGdldFNoZWV0RGVmaW5pdGlvbnMoKXtcclxuXHRcdHJldHVybiB0aGlzLnNoZWV0cy5tYXAoc2hlZXQgPT4gc2hlZXQuZ2V0RGVmaW5pdGlvbigpKTtcclxuXHR9XHJcblx0XHJcblx0Z2V0U2hlZXRzKCl7XHJcblx0XHRyZXR1cm4gdGhpcy5zaGVldHMubWFwKHNoZWV0ID0+IHNoZWV0LmdldENvbXBvbmVudCgpKTtcclxuXHR9XHJcblx0XHJcblx0Z2V0U2hlZXQoa2V5KXtcclxuXHRcdHZhciBzaGVldCA9IHRoaXMubG9va3VwU2hlZXQoa2V5KTtcclxuXHRcdFxyXG5cdFx0cmV0dXJuIHNoZWV0ID8gc2hlZXQuZ2V0Q29tcG9uZW50KCkgOiBmYWxzZTtcclxuXHR9XHJcblx0XHJcblx0c2V0U2hlZXREYXRhKGtleSwgZGF0YSl7XHJcblx0XHRpZiAoa2V5ICYmICFkYXRhKXtcclxuXHRcdFx0ZGF0YSA9IGtleTtcclxuXHRcdFx0a2V5ID0gZmFsc2U7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHZhciBzaGVldCA9IHRoaXMubG9va3VwU2hlZXQoa2V5KTtcclxuXHRcdFxyXG5cdFx0cmV0dXJuIHNoZWV0ID8gc2hlZXQuc2V0RGF0YShkYXRhKSA6IGZhbHNlO1x0XHJcblx0fVxyXG5cdFxyXG5cdGdldFNoZWV0RGF0YShrZXkpe1xyXG5cdFx0dmFyIHNoZWV0ID0gdGhpcy5sb29rdXBTaGVldChrZXkpO1xyXG5cdFx0XHJcblx0XHRyZXR1cm4gc2hlZXQgPyBzaGVldC5nZXREYXRhKCkgOiBmYWxzZTtcdFxyXG5cdH1cclxuXHRcclxuXHRjbGVhclNoZWV0KGtleSl7XHJcblx0XHR2YXIgc2hlZXQgPSB0aGlzLmxvb2t1cFNoZWV0KGtleSk7XHJcblx0XHRcclxuXHRcdHJldHVybiBzaGVldCA/IHNoZWV0LmNsZWFyKCkgOiBmYWxzZTtcclxuXHR9XHJcblx0XHJcblx0cmVtb3ZlU2hlZXRGdW5jKGtleSl7XHJcblx0XHR2YXIgc2hlZXQgPSB0aGlzLmxvb2t1cFNoZWV0KGtleSk7XHJcblx0XHRcclxuXHRcdGlmKHNoZWV0KXtcclxuXHRcdFx0dGhpcy5yZW1vdmVTaGVldChzaGVldCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGFjdGl2ZVNoZWV0RnVuYyhrZXkpe1xyXG5cdFx0dmFyIHNoZWV0ID0gdGhpcy5sb29rdXBTaGVldChrZXkpO1xyXG5cdFx0XHJcblx0XHRyZXR1cm4gc2hlZXQgPyB0aGlzLmxvYWRTaGVldChzaGVldCkgOiBmYWxzZTtcclxuXHR9XHJcbn1cblxuY2xhc3MgVG9vbHRpcCBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwidG9vbHRpcFwiO1xuXHRcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLnRvb2x0aXBTdWJzY3JpYmVyID0gbnVsbCxcblx0XHR0aGlzLmhlYWRlclN1YnNjcmliZXIgPSBudWxsLFxuXHRcdFxuXHRcdHRoaXMudGltZW91dCA9IG51bGw7XG5cdFx0dGhpcy5wb3B1cEluc3RhbmNlID0gbnVsbDtcblx0XHRcblx0XHQvLyB0aGlzLnJlZ2lzdGVyVGFibGVPcHRpb24oXCJ0b29sdGlwR2VuZXJhdGlvbk1vZGVcIiwgdW5kZWZpbmVkKTsgIC8vZGVwcmVjYXRlZFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInRvb2x0aXBEZWxheVwiLCAzMDApOyBcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwidG9vbHRpcFwiKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29sdW1uT3B0aW9uKFwiaGVhZGVyVG9vbHRpcFwiKTtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuZGVwcmVjYXRlZE9wdGlvbnNDaGVjaygpO1xuXHRcdFxuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY29sdW1uLWluaXRcIiwgdGhpcy5pbml0aWFsaXplQ29sdW1uLmJpbmQodGhpcykpO1xuXHR9XG5cdFxuXHRkZXByZWNhdGVkT3B0aW9uc0NoZWNrKCl7XG5cdFx0Ly8gdGhpcy5kZXByZWNhdGlvbkNoZWNrTXNnKFwidG9vbHRpcEdlbmVyYXRpb25Nb2RlXCIsIFwiVGhpcyBvcHRpb24gaXMgbm8gbG9uZ2VyIG5lZWRlZCBhcyB0b29sdGlwcyBhcmUgYWx3YXlzIGdlbmVyYXRlZCBvbiBob3ZlciBub3dcIik7XG5cdH1cdFxuXHRcblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdGlmKGNvbHVtbi5kZWZpbml0aW9uLmhlYWRlclRvb2x0aXAgJiYgIXRoaXMuaGVhZGVyU3Vic2NyaWJlcil7XG5cdFx0XHR0aGlzLmhlYWRlclN1YnNjcmliZXIgPSB0cnVlO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1tb3VzZW1vdmVcIiwgdGhpcy5tb3VzZW1vdmVDaGVjay5iaW5kKHRoaXMsIFwiaGVhZGVyVG9vbHRpcFwiKSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNvbHVtbi1tb3VzZW91dFwiLCB0aGlzLm1vdXNlb3V0Q2hlY2suYmluZCh0aGlzLCBcImhlYWRlclRvb2x0aXBcIikpO1xuXHRcdH1cblx0XHRcblx0XHRpZihjb2x1bW4uZGVmaW5pdGlvbi50b29sdGlwICYmICF0aGlzLnRvb2x0aXBTdWJzY3JpYmVyKXtcblx0XHRcdHRoaXMudG9vbHRpcFN1YnNjcmliZXIgPSB0cnVlO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnN1YnNjcmliZShcImNlbGwtbW91c2Vtb3ZlXCIsIHRoaXMubW91c2Vtb3ZlQ2hlY2suYmluZCh0aGlzLCBcInRvb2x0aXBcIikpO1xuXHRcdFx0dGhpcy5zdWJzY3JpYmUoXCJjZWxsLW1vdXNlb3V0XCIsIHRoaXMubW91c2VvdXRDaGVjay5iaW5kKHRoaXMsIFwidG9vbHRpcFwiKSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRtb3VzZW1vdmVDaGVjayhhY3Rpb24sIGUsIGNvbXBvbmVudCl7XG5cdFx0dmFyIHRvb2x0aXAgPSBhY3Rpb24gPT09IFwidG9vbHRpcFwiID8gY29tcG9uZW50LmNvbHVtbi5kZWZpbml0aW9uLnRvb2x0aXAgOiBjb21wb25lbnQuZGVmaW5pdGlvbi5oZWFkZXJUb29sdGlwO1xuXHRcdFxuXHRcdGlmKHRvb2x0aXApe1xuXHRcdFx0dGhpcy5jbGVhclBvcHVwKCk7XG5cdFx0XHR0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMubG9hZFRvb2x0aXAuYmluZCh0aGlzLCBlLCBjb21wb25lbnQsIHRvb2x0aXApLCB0aGlzLnRhYmxlLm9wdGlvbnMudG9vbHRpcERlbGF5KTtcblx0XHR9XG5cdH1cblxuXHRtb3VzZW91dENoZWNrKGFjdGlvbiwgZSwgY29tcG9uZW50KXtcblx0XHRpZighdGhpcy5wb3B1cEluc3RhbmNlKXtcblx0XHRcdHRoaXMuY2xlYXJQb3B1cCgpO1xuXHRcdH1cblx0fVxuXHRcblx0Y2xlYXJQb3B1cChhY3Rpb24sIGUsIGNvbXBvbmVudCl7XG5cdFx0Y2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XG5cdFx0dGhpcy50aW1lb3V0ID0gbnVsbDtcblx0XHRcblx0XHRpZih0aGlzLnBvcHVwSW5zdGFuY2Upe1xuXHRcdFx0dGhpcy5wb3B1cEluc3RhbmNlLmhpZGUoKTtcblx0XHR9XG5cdH1cblx0XG5cdGxvYWRUb29sdGlwKGUsIGNvbXBvbmVudCwgdG9vbHRpcCl7XG5cdFx0dmFyIGNvbnRlbnRzRWwsIHJlbmRlcmVkQ2FsbGJhY2ssIGNvb3JkcztcblxuXHRcdGZ1bmN0aW9uIG9uUmVuZGVyZWQoY2FsbGJhY2spe1xuXHRcdFx0cmVuZGVyZWRDYWxsYmFjayA9IGNhbGxiYWNrO1xuXHRcdH1cblx0XHRcblx0XHRpZih0eXBlb2YgdG9vbHRpcCA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdHRvb2x0aXAgPSB0b29sdGlwKGUsIGNvbXBvbmVudC5nZXRDb21wb25lbnQoKSwgb25SZW5kZXJlZCk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRvb2x0aXAgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCl7XG5cdFx0XHRjb250ZW50c0VsID0gdG9vbHRpcDtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb250ZW50c0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFxuXHRcdFx0aWYodG9vbHRpcCA9PT0gdHJ1ZSl7XG5cdFx0XHRcdGlmKGNvbXBvbmVudCBpbnN0YW5jZW9mIENlbGwpe1xuXHRcdFx0XHRcdHRvb2x0aXAgPSBjb21wb25lbnQudmFsdWU7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRpZihjb21wb25lbnQuZGVmaW5pdGlvbi5maWVsZCl7XG5cdFx0XHRcdFx0XHR0aGlzLmxhbmdCaW5kKFwiY29sdW1uc3xcIiArIGNvbXBvbmVudC5kZWZpbml0aW9uLmZpZWxkLCAodmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdFx0Y29udGVudHNFbC5pbm5lckhUTUwgPSB0b29sdGlwID0gdmFsdWUgfHwgY29tcG9uZW50LmRlZmluaXRpb24udGl0bGU7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHR0b29sdGlwID0gY29tcG9uZW50LmRlZmluaXRpb24udGl0bGU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGNvbnRlbnRzRWwuaW5uZXJIVE1MID0gdG9vbHRpcDtcblx0XHR9XG5cdFx0XG5cdFx0aWYodG9vbHRpcCB8fCB0b29sdGlwID09PSAwIHx8IHRvb2x0aXAgPT09IGZhbHNlKXtcblx0XHRcdGNvbnRlbnRzRWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci10b29sdGlwXCIpO1xuXG5cdFx0XHRjb250ZW50c0VsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgZSA9PiBlLnByZXZlbnREZWZhdWx0KCkpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnBvcHVwSW5zdGFuY2UgPSB0aGlzLnBvcHVwKGNvbnRlbnRzRWwpO1xuXHRcdFx0XG5cdFx0XHRpZih0eXBlb2YgcmVuZGVyZWRDYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0dGhpcy5wb3B1cEluc3RhbmNlLnJlbmRlckNhbGxiYWNrKHJlbmRlcmVkQ2FsbGJhY2spO1xuXHRcdFx0fVxuXG5cdFx0XHRjb29yZHMgPSB0aGlzLnBvcHVwSW5zdGFuY2UuY29udGFpbmVyRXZlbnRDb29yZHMoZSk7XG5cdFx0XHRcblx0XHRcdHRoaXMucG9wdXBJbnN0YW5jZS5zaG93KGNvb3Jkcy54ICsgMTUsIGNvb3Jkcy55ICsgMTUpLmhpZGVPbkJsdXIoKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJUb29sdGlwQ2xvc2VkXCIsIGNvbXBvbmVudC5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdHRoaXMucG9wdXBJbnN0YW5jZSA9IG51bGw7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiVG9vbHRpcE9wZW5lZFwiLCBjb21wb25lbnQuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdH1cblx0fVxufVxuXG52YXIgZGVmYXVsdFZhbGlkYXRvcnMgPSB7XG5cdC8vaXMgaW50ZWdlclxuXHRpbnRlZ2VyOiBmdW5jdGlvbihjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycyl7XG5cdFx0aWYodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblxuXHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcblxuXHRcdHJldHVybiAhaXNOYU4odmFsdWUpICYmIGlzRmluaXRlKHZhbHVlKSAmJiBNYXRoLmZsb29yKHZhbHVlKSA9PT0gdmFsdWU7XG5cdH0sXG5cblx0Ly9pcyBmbG9hdFxuXHRmbG9hdDogZnVuY3Rpb24oY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpe1xuXHRcdGlmKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0XG5cdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuXG5cdFx0cmV0dXJuICFpc05hTih2YWx1ZSkgJiYgaXNGaW5pdGUodmFsdWUpICYmIHZhbHVlICUgMSAhPT0gMDtcblx0fSxcblxuXHQvL211c3QgYmUgYSBudW1iZXJcblx0bnVtZXJpYzogZnVuY3Rpb24oY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpe1xuXHRcdGlmKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0cmV0dXJuICFpc05hTih2YWx1ZSk7XG5cdH0sXG5cblx0Ly9tdXN0IGJlIGEgc3RyaW5nXG5cdHN0cmluZzogZnVuY3Rpb24oY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpe1xuXHRcdGlmKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0cmV0dXJuIGlzTmFOKHZhbHVlKTtcblx0fSxcblxuXHQvL211c3QgYmUgYWxwaGFudW1lcmljXG5cdGFscGhhbnVtZXJpYzogZnVuY3Rpb24oY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpe1xuXHRcdGlmKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cblx0XHR2YXIgcmVnID0gbmV3IFJlZ0V4cCgvXlthLXowLTldKyQvaSk7XG5cblx0XHRyZXR1cm4gcmVnLnRlc3QodmFsdWUpO1xuXHR9LFxuXG5cdC8vbWF4aW11bSB2YWx1ZVxuXHRtYXg6IGZ1bmN0aW9uKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKXtcblx0XHRpZih2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSA8PSBwYXJhbWV0ZXJzO1xuXHR9LFxuXG5cdC8vbWluaW11bSB2YWx1ZVxuXHRtaW46IGZ1bmN0aW9uKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKXtcblx0XHRpZih2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBwYXJzZUZsb2F0KHZhbHVlKSA+PSBwYXJhbWV0ZXJzO1xuXHR9LFxuXG5cdC8vc3RhcnRzIHdpdGggIHZhbHVlXG5cdHN0YXJ0czogZnVuY3Rpb24oY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpe1xuXHRcdGlmKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0cmV0dXJuIFN0cmluZyh2YWx1ZSkudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKFN0cmluZyhwYXJhbWV0ZXJzKS50b0xvd2VyQ2FzZSgpKTtcblx0fSxcblxuXHQvL2VuZHMgd2l0aCAgdmFsdWVcblx0ZW5kczogZnVuY3Rpb24oY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpe1xuXHRcdGlmKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0cmV0dXJuIFN0cmluZyh2YWx1ZSkudG9Mb3dlckNhc2UoKS5lbmRzV2l0aChTdHJpbmcocGFyYW1ldGVycykudG9Mb3dlckNhc2UoKSk7XG5cdH0sXG5cblxuXHQvL21pbmltdW0gc3RyaW5nIGxlbmd0aFxuXHRtaW5MZW5ndGg6IGZ1bmN0aW9uKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKXtcblx0XHRpZih2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBTdHJpbmcodmFsdWUpLmxlbmd0aCA+PSBwYXJhbWV0ZXJzO1xuXHR9LFxuXG5cdC8vbWF4aW11bSBzdHJpbmcgbGVuZ3RoXG5cdG1heExlbmd0aDogZnVuY3Rpb24oY2VsbCwgdmFsdWUsIHBhcmFtZXRlcnMpe1xuXHRcdGlmKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0cmV0dXJuIFN0cmluZyh2YWx1ZSkubGVuZ3RoIDw9IHBhcmFtZXRlcnM7XG5cdH0sXG5cblx0Ly9pbiBwcm92aWRlZCB2YWx1ZSBsaXN0XG5cdGluOiBmdW5jdGlvbihjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycyl7XG5cdFx0aWYodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblxuXHRcdGlmKHR5cGVvZiBwYXJhbWV0ZXJzID09IFwic3RyaW5nXCIpe1xuXHRcdFx0cGFyYW1ldGVycyA9IHBhcmFtZXRlcnMuc3BsaXQoXCJ8XCIpO1xuXHRcdH1cblxuXHRcdHJldHVybiBwYXJhbWV0ZXJzLmluZGV4T2YodmFsdWUpID4gLTE7XG5cdH0sXG5cblx0Ly9tdXN0IG1hdGNoIHByb3ZpZGVkIHJlZ2V4XG5cdHJlZ2V4OiBmdW5jdGlvbihjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycyl7XG5cdFx0aWYodmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0XHR2YXIgcmVnID0gbmV3IFJlZ0V4cChwYXJhbWV0ZXJzKTtcblxuXHRcdHJldHVybiByZWcudGVzdCh2YWx1ZSk7XG5cdH0sXG5cblx0Ly92YWx1ZSBtdXN0IGJlIHVuaXF1ZSBpbiB0aGlzIGNvbHVtblxuXHR1bmlxdWU6IGZ1bmN0aW9uKGNlbGwsIHZhbHVlLCBwYXJhbWV0ZXJzKXtcblx0XHRpZih2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHZhciB1bmlxdWUgPSB0cnVlO1xuXG5cdFx0dmFyIGNlbGxEYXRhID0gY2VsbC5nZXREYXRhKCk7XG5cdFx0dmFyIGNvbHVtbiA9IGNlbGwuZ2V0Q29sdW1uKCkuX2dldFNlbGYoKTtcblxuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KXtcblx0XHRcdHZhciBkYXRhID0gcm93LmdldERhdGEoKTtcblxuXHRcdFx0aWYoZGF0YSAhPT0gY2VsbERhdGEpe1xuXHRcdFx0XHRpZih2YWx1ZSA9PSBjb2x1bW4uZ2V0RmllbGRWYWx1ZShkYXRhKSl7XG5cdFx0XHRcdFx0dW5pcXVlID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiB1bmlxdWU7XG5cdH0sXG5cblx0Ly9tdXN0IGhhdmUgYSB2YWx1ZVxuXHRyZXF1aXJlZDpmdW5jdGlvbihjZWxsLCB2YWx1ZSwgcGFyYW1ldGVycyl7XG5cdFx0cmV0dXJuIHZhbHVlICE9PSBcIlwiICYmIHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIjtcblx0fSxcbn07XG5cbmNsYXNzIFZhbGlkYXRlIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJ2YWxpZGF0ZVwiO1xuXG5cdC8vbG9hZCBkZWZhdWx0c1xuXHRzdGF0aWMgdmFsaWRhdG9ycyA9IGRlZmF1bHRWYWxpZGF0b3JzO1xuXHRcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLmludmFsaWRDZWxscyA9IFtdO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcInZhbGlkYXRpb25Nb2RlXCIsIFwiYmxvY2tpbmdcIik7XG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcInZhbGlkYXRvclwiKTtcblx0XHRcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldEludmFsaWRDZWxsc1wiLCB0aGlzLmdldEludmFsaWRDZWxscy5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImNsZWFyQ2VsbFZhbGlkYXRpb25cIiwgdGhpcy51c2VyQ2xlYXJDZWxsVmFsaWRhdGlvbi5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInZhbGlkYXRlXCIsIHRoaXMudXNlclZhbGlkYXRlLmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdHRoaXMucmVnaXN0ZXJDb21wb25lbnRGdW5jdGlvbihcImNlbGxcIiwgXCJpc1ZhbGlkXCIsIHRoaXMuY2VsbElzVmFsaWQuYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY2VsbFwiLCBcImNsZWFyVmFsaWRhdGlvblwiLCB0aGlzLmNsZWFyVmFsaWRhdGlvbi5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJjZWxsXCIsIFwidmFsaWRhdGVcIiwgdGhpcy5jZWxsVmFsaWRhdGUuYmluZCh0aGlzKSk7XG5cdFx0XG5cdFx0dGhpcy5yZWdpc3RlckNvbXBvbmVudEZ1bmN0aW9uKFwiY29sdW1uXCIsIFwidmFsaWRhdGVcIiwgdGhpcy5jb2x1bW5WYWxpZGF0ZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyQ29tcG9uZW50RnVuY3Rpb24oXCJyb3dcIiwgXCJ2YWxpZGF0ZVwiLCB0aGlzLnJvd1ZhbGlkYXRlLmJpbmQodGhpcykpO1xuXHR9XG5cdFxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiY2VsbC1kZWxldGVcIiwgdGhpcy5jbGVhclZhbGlkYXRpb24uYmluZCh0aGlzKSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4tbGF5b3V0XCIsIHRoaXMuaW5pdGlhbGl6ZUNvbHVtbkNoZWNrLmJpbmQodGhpcykpO1xuXHRcdFxuXHRcdHRoaXMuc3Vic2NyaWJlKFwiZWRpdC1zdWNjZXNzXCIsIHRoaXMuZWRpdFZhbGlkYXRlLmJpbmQodGhpcykpO1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwiZWRpdC1lZGl0b3ItY2xlYXJcIiwgdGhpcy5lZGl0b3JDbGVhci5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImVkaXQtZWRpdGVkLWNsZWFyXCIsIHRoaXMuZWRpdGVkQ2xlYXIuYmluZCh0aGlzKSk7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBFdmVudCBIYW5kbGluZyAvLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRlZGl0VmFsaWRhdGUoY2VsbCwgdmFsdWUsIHByZXZpb3VzVmFsdWUpe1xuXHRcdHZhciB2YWxpZCA9IHRoaXMudGFibGUub3B0aW9ucy52YWxpZGF0aW9uTW9kZSAhPT0gXCJtYW51YWxcIiA/IHRoaXMudmFsaWRhdGUoY2VsbC5jb2x1bW4ubW9kdWxlcy52YWxpZGF0ZSwgY2VsbCwgdmFsdWUpIDogdHJ1ZTtcblx0XHRcblx0XHQvLyBhbGxvdyB0aW1lIGZvciBlZGl0b3IgdG8gbWFrZSByZW5kZXIgY2hhbmdlcyB0aGVuIHN0eWxlIGNlbGxcblx0XHRpZih2YWxpZCAhPT0gdHJ1ZSl7XG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0Y2VsbC5nZXRFbGVtZW50KCkuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci12YWxpZGF0aW9uLWZhaWxcIik7XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInZhbGlkYXRpb25GYWlsZWRcIiwgY2VsbC5nZXRDb21wb25lbnQoKSwgdmFsdWUsIHZhbGlkKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gdmFsaWQ7XG5cdH1cblx0XG5cdGVkaXRvckNsZWFyKGNlbGwsIGNhbmNlbGxlZCl7XG5cdFx0aWYoY2FuY2VsbGVkKXtcblx0XHRcdGlmKGNlbGwuY29sdW1uLm1vZHVsZXMudmFsaWRhdGUpe1xuXHRcdFx0XHR0aGlzLmNlbGxWYWxpZGF0ZShjZWxsKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRjZWxsLmdldEVsZW1lbnQoKS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXZhbGlkYXRpb24tZmFpbFwiKTtcblx0fVxuXHRcblx0ZWRpdGVkQ2xlYXIoY2VsbCl7XG5cdFx0aWYoY2VsbC5tb2R1bGVzLnZhbGlkYXRlKXtcblx0XHRcdGNlbGwubW9kdWxlcy52YWxpZGF0ZS5pbnZhbGlkID0gZmFsc2U7XG5cdFx0fVxuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vIENlbGwgRnVuY3Rpb25zIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0Y2VsbElzVmFsaWQoY2VsbCl7XG5cdFx0cmV0dXJuIGNlbGwubW9kdWxlcy52YWxpZGF0ZSA/IChjZWxsLm1vZHVsZXMudmFsaWRhdGUuaW52YWxpZCB8fCB0cnVlKSA6IHRydWU7XG5cdH1cblx0XG5cdGNlbGxWYWxpZGF0ZShjZWxsKXtcblx0XHRyZXR1cm4gdGhpcy52YWxpZGF0ZShjZWxsLmNvbHVtbi5tb2R1bGVzLnZhbGlkYXRlLCBjZWxsLCBjZWxsLmdldFZhbHVlKCkpO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gQ29sdW1uIEZ1bmN0aW9ucyAvLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0Y29sdW1uVmFsaWRhdGUoY29sdW1uKXtcblx0XHR2YXIgaW52YWxpZCA9IFtdO1xuXHRcdFxuXHRcdGNvbHVtbi5jZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG5cdFx0XHRpZih0aGlzLmNlbGxWYWxpZGF0ZShjZWxsKSAhPT0gdHJ1ZSl7XG5cdFx0XHRcdGludmFsaWQucHVzaChjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gaW52YWxpZC5sZW5ndGggPyBpbnZhbGlkIDogdHJ1ZTtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLyBSb3cgRnVuY3Rpb25zIC8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdHJvd1ZhbGlkYXRlKHJvdyl7XG5cdFx0dmFyIGludmFsaWQgPSBbXTtcblx0XHRcblx0XHRyb3cuY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuXHRcdFx0aWYodGhpcy5jZWxsVmFsaWRhdGUoY2VsbCkgIT09IHRydWUpe1xuXHRcdFx0XHRpbnZhbGlkLnB1c2goY2VsbC5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIGludmFsaWQubGVuZ3RoID8gaW52YWxpZCA6IHRydWU7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8vLyBUYWJsZSBGdW5jdGlvbnMgLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRcblx0dXNlckNsZWFyQ2VsbFZhbGlkYXRpb24oY2VsbHMpe1xuXHRcdGlmKCFjZWxscyl7XG5cdFx0XHRjZWxscyA9IHRoaXMuZ2V0SW52YWxpZENlbGxzKCk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCFBcnJheS5pc0FycmF5KGNlbGxzKSl7XG5cdFx0XHRjZWxscyA9IFtjZWxsc107XG5cdFx0fVxuXHRcdFxuXHRcdGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcblx0XHRcdHRoaXMuY2xlYXJWYWxpZGF0aW9uKGNlbGwuX2dldFNlbGYoKSk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdHVzZXJWYWxpZGF0ZShjZWxscyl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXHRcdFxuXHRcdC8vY2xlYXIgcm93IGRhdGFcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdHJvdyA9IHJvdy5nZXRDb21wb25lbnQoKTtcblx0XHRcdFxuXHRcdFx0dmFyIHZhbGlkID0gcm93LnZhbGlkYXRlKCk7XG5cdFx0XHRcblx0XHRcdGlmKHZhbGlkICE9PSB0cnVlKXtcblx0XHRcdFx0b3V0cHV0ID0gb3V0cHV0LmNvbmNhdCh2YWxpZCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dC5sZW5ndGggPyBvdXRwdXQgOiB0cnVlO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gSW50ZXJuYWwgTG9naWMgLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0aW5pdGlhbGl6ZUNvbHVtbkNoZWNrKGNvbHVtbil7XG5cdFx0aWYodHlwZW9mIGNvbHVtbi5kZWZpbml0aW9uLnZhbGlkYXRvciAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHR0aGlzLmluaXRpYWxpemVDb2x1bW4oY29sdW1uKTtcblx0XHR9XG5cdH1cblx0XG5cdC8vdmFsaWRhdGVcblx0aW5pdGlhbGl6ZUNvbHVtbihjb2x1bW4pe1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRjb25maWcgPSBbXSxcblx0XHR2YWxpZGF0b3I7XG5cdFx0XG5cdFx0aWYoY29sdW1uLmRlZmluaXRpb24udmFsaWRhdG9yKXtcblx0XHRcdFxuXHRcdFx0aWYoQXJyYXkuaXNBcnJheShjb2x1bW4uZGVmaW5pdGlvbi52YWxpZGF0b3IpKXtcblx0XHRcdFx0Y29sdW1uLmRlZmluaXRpb24udmFsaWRhdG9yLmZvckVhY2goKGl0ZW0pID0+IHtcblx0XHRcdFx0XHR2YWxpZGF0b3IgPSBzZWxmLl9leHRyYWN0VmFsaWRhdG9yKGl0ZW0pO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKHZhbGlkYXRvcil7XG5cdFx0XHRcdFx0XHRjb25maWcucHVzaCh2YWxpZGF0b3IpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdFxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR2YWxpZGF0b3IgPSB0aGlzLl9leHRyYWN0VmFsaWRhdG9yKGNvbHVtbi5kZWZpbml0aW9uLnZhbGlkYXRvcik7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZih2YWxpZGF0b3Ipe1xuXHRcdFx0XHRcdGNvbmZpZy5wdXNoKHZhbGlkYXRvcik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Y29sdW1uLm1vZHVsZXMudmFsaWRhdGUgPSBjb25maWcubGVuZ3RoID8gY29uZmlnIDogZmFsc2U7XG5cdFx0fVxuXHR9XG5cdFxuXHRfZXh0cmFjdFZhbGlkYXRvcih2YWx1ZSl7XG5cdFx0dmFyIHR5cGUsIHBhcmFtcywgcG9zO1xuXHRcdFxuXHRcdHN3aXRjaCh0eXBlb2YgdmFsdWUpe1xuXHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRwb3MgPSB2YWx1ZS5pbmRleE9mKCc6Jyk7XG5cdFx0XHRcblx0XHRcdFx0aWYocG9zID4gLTEpe1xuXHRcdFx0XHRcdHR5cGUgPSB2YWx1ZS5zdWJzdHJpbmcoMCxwb3MpO1xuXHRcdFx0XHRcdHBhcmFtcyA9IHZhbHVlLnN1YnN0cmluZyhwb3MrMSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR0eXBlID0gdmFsdWU7XG5cdFx0XHRcdH1cblx0XHRcdFxuXHRcdFx0XHRyZXR1cm4gdGhpcy5fYnVpbGRWYWxpZGF0b3IodHlwZSwgcGFyYW1zKTtcblx0XHRcdFxuXHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdHJldHVybiB0aGlzLl9idWlsZFZhbGlkYXRvcih2YWx1ZSk7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2J1aWxkVmFsaWRhdG9yKHZhbHVlLnR5cGUsIHZhbHVlLnBhcmFtZXRlcnMpO1xuXHRcdH1cblx0fVxuXHRcblx0X2J1aWxkVmFsaWRhdG9yKHR5cGUsIHBhcmFtcyl7XG5cdFx0XG5cdFx0dmFyIGZ1bmMgPSB0eXBlb2YgdHlwZSA9PSBcImZ1bmN0aW9uXCIgPyB0eXBlIDogVmFsaWRhdGUudmFsaWRhdG9yc1t0eXBlXTtcblx0XHRcblx0XHRpZighZnVuYyl7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJWYWxpZGF0b3IgU2V0dXAgRXJyb3IgLSBObyBtYXRjaGluZyB2YWxpZGF0b3IgZm91bmQ6XCIsIHR5cGUpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHR5cGU6dHlwZW9mIHR5cGUgPT0gXCJmdW5jdGlvblwiID8gXCJmdW5jdGlvblwiIDogdHlwZSxcblx0XHRcdFx0ZnVuYzpmdW5jLFxuXHRcdFx0XHRwYXJhbXM6cGFyYW1zLFxuXHRcdFx0fTtcblx0XHR9XG5cdH1cblx0XG5cdHZhbGlkYXRlKHZhbGlkYXRvcnMsIGNlbGwsIHZhbHVlKXtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0ZmFpbGVkVmFsaWRhdG9ycyA9IFtdLFxuXHRcdGludmFsaWRJbmRleCA9IHRoaXMuaW52YWxpZENlbGxzLmluZGV4T2YoY2VsbCk7XG5cdFx0XG5cdFx0aWYodmFsaWRhdG9ycyl7XG5cdFx0XHR2YWxpZGF0b3JzLmZvckVhY2goKGl0ZW0pID0+IHtcblx0XHRcdFx0aWYoIWl0ZW0uZnVuYy5jYWxsKHNlbGYsIGNlbGwuZ2V0Q29tcG9uZW50KCksIHZhbHVlLCBpdGVtLnBhcmFtcykpe1xuXHRcdFx0XHRcdGZhaWxlZFZhbGlkYXRvcnMucHVzaCh7XG5cdFx0XHRcdFx0XHR0eXBlOml0ZW0udHlwZSxcblx0XHRcdFx0XHRcdHBhcmFtZXRlcnM6aXRlbS5wYXJhbXNcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCFjZWxsLm1vZHVsZXMudmFsaWRhdGUpe1xuXHRcdFx0Y2VsbC5tb2R1bGVzLnZhbGlkYXRlID0ge307XG5cdFx0fVxuXHRcdFxuXHRcdGlmKCFmYWlsZWRWYWxpZGF0b3JzLmxlbmd0aCl7XG5cdFx0XHRjZWxsLm1vZHVsZXMudmFsaWRhdGUuaW52YWxpZCA9IGZhbHNlO1xuXHRcdFx0Y2VsbC5nZXRFbGVtZW50KCkuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci12YWxpZGF0aW9uLWZhaWxcIik7XG5cdFx0XHRcblx0XHRcdGlmKGludmFsaWRJbmRleCA+IC0xKXtcblx0XHRcdFx0dGhpcy5pbnZhbGlkQ2VsbHMuc3BsaWNlKGludmFsaWRJbmRleCwgMSk7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y2VsbC5tb2R1bGVzLnZhbGlkYXRlLmludmFsaWQgPSBmYWlsZWRWYWxpZGF0b3JzO1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMudmFsaWRhdGlvbk1vZGUgIT09IFwibWFudWFsXCIpe1xuXHRcdFx0XHRjZWxsLmdldEVsZW1lbnQoKS5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXZhbGlkYXRpb24tZmFpbFwiKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoaW52YWxpZEluZGV4ID09IC0xKXtcblx0XHRcdFx0dGhpcy5pbnZhbGlkQ2VsbHMucHVzaChjZWxsKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIGZhaWxlZFZhbGlkYXRvcnMubGVuZ3RoID8gZmFpbGVkVmFsaWRhdG9ycyA6IHRydWU7XG5cdH1cblx0XG5cdGdldEludmFsaWRDZWxscygpe1xuXHRcdHZhciBvdXRwdXQgPSBbXTtcblx0XHRcblx0XHR0aGlzLmludmFsaWRDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG5cdFx0XHRvdXRwdXQucHVzaChjZWxsLmdldENvbXBvbmVudCgpKTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHRjbGVhclZhbGlkYXRpb24oY2VsbCl7XG5cdFx0dmFyIGludmFsaWRJbmRleDtcblx0XHRcblx0XHRpZihjZWxsLm1vZHVsZXMudmFsaWRhdGUgJiYgY2VsbC5tb2R1bGVzLnZhbGlkYXRlLmludmFsaWQpe1xuXHRcdFx0XG5cdFx0XHRjZWxsLmdldEVsZW1lbnQoKS5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXZhbGlkYXRpb24tZmFpbFwiKTtcblx0XHRcdGNlbGwubW9kdWxlcy52YWxpZGF0ZS5pbnZhbGlkID0gZmFsc2U7XG5cdFx0XHRcblx0XHRcdGludmFsaWRJbmRleCA9IHRoaXMuaW52YWxpZENlbGxzLmluZGV4T2YoY2VsbCk7XG5cdFx0XHRcblx0XHRcdGlmKGludmFsaWRJbmRleCA+IC0xKXtcblx0XHRcdFx0dGhpcy5pbnZhbGlkQ2VsbHMuc3BsaWNlKGludmFsaWRJbmRleCwgMSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59XG5cbnZhciBhbGxNb2R1bGVzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuXHRfX3Byb3RvX186IG51bGwsXG5cdEFjY2Vzc29yTW9kdWxlOiBBY2Nlc3Nvcixcblx0QWpheE1vZHVsZTogQWpheCxcblx0Q2xpcGJvYXJkTW9kdWxlOiBDbGlwYm9hcmQsXG5cdENvbHVtbkNhbGNzTW9kdWxlOiBDb2x1bW5DYWxjcyxcblx0RGF0YVRyZWVNb2R1bGU6IERhdGFUcmVlLFxuXHREb3dubG9hZE1vZHVsZTogRG93bmxvYWQsXG5cdEVkaXRNb2R1bGU6IEVkaXQsXG5cdEV4cG9ydE1vZHVsZTogRXhwb3J0LFxuXHRGaWx0ZXJNb2R1bGU6IEZpbHRlcixcblx0Rm9ybWF0TW9kdWxlOiBGb3JtYXQsXG5cdEZyb3plbkNvbHVtbnNNb2R1bGU6IEZyb3plbkNvbHVtbnMsXG5cdEZyb3plblJvd3NNb2R1bGU6IEZyb3plblJvd3MsXG5cdEdyb3VwUm93c01vZHVsZTogR3JvdXBSb3dzLFxuXHRIaXN0b3J5TW9kdWxlOiBIaXN0b3J5LFxuXHRIdG1sVGFibGVJbXBvcnRNb2R1bGU6IEh0bWxUYWJsZUltcG9ydCxcblx0SW1wb3J0TW9kdWxlOiBJbXBvcnQsXG5cdEludGVyYWN0aW9uTW9kdWxlOiBJbnRlcmFjdGlvbixcblx0S2V5YmluZGluZ3NNb2R1bGU6IEtleWJpbmRpbmdzLFxuXHRNZW51TW9kdWxlOiBNZW51LFxuXHRNb3ZlQ29sdW1uc01vZHVsZTogTW92ZUNvbHVtbnMsXG5cdE1vdmVSb3dzTW9kdWxlOiBNb3ZlUm93cyxcblx0TXV0YXRvck1vZHVsZTogTXV0YXRvcixcblx0UGFnZU1vZHVsZTogUGFnZSxcblx0UGVyc2lzdGVuY2VNb2R1bGU6IFBlcnNpc3RlbmNlLFxuXHRQb3B1cE1vZHVsZTogUG9wdXAsXG5cdFByaW50TW9kdWxlOiBQcmludCxcblx0UmVhY3RpdmVEYXRhTW9kdWxlOiBSZWFjdGl2ZURhdGEsXG5cdFJlc2l6ZUNvbHVtbnNNb2R1bGU6IFJlc2l6ZUNvbHVtbnMsXG5cdFJlc2l6ZVJvd3NNb2R1bGU6IFJlc2l6ZVJvd3MsXG5cdFJlc2l6ZVRhYmxlTW9kdWxlOiBSZXNpemVUYWJsZSxcblx0UmVzcG9uc2l2ZUxheW91dE1vZHVsZTogUmVzcG9uc2l2ZUxheW91dCxcblx0U2VsZWN0UmFuZ2VNb2R1bGU6IFNlbGVjdFJhbmdlLFxuXHRTZWxlY3RSb3dNb2R1bGU6IFNlbGVjdFJvdyxcblx0U29ydE1vZHVsZTogU29ydCxcblx0U3ByZWFkc2hlZXRNb2R1bGU6IFNwcmVhZHNoZWV0LFxuXHRUb29sdGlwTW9kdWxlOiBUb29sdGlwLFxuXHRWYWxpZGF0ZU1vZHVsZTogVmFsaWRhdGVcbn0pO1xuXG52YXIgZGVmYXVsdE9wdGlvbnMgPSB7XG5cblx0ZGVidWdFdmVudHNFeHRlcm5hbDpmYWxzZSwgLy9mbGFnIHRvIGNvbnNvbGUgbG9nIGV2ZW50c1xuXHRkZWJ1Z0V2ZW50c0ludGVybmFsOmZhbHNlLCAvL2ZsYWcgdG8gY29uc29sZSBsb2cgZXZlbnRzXG5cdGRlYnVnSW52YWxpZE9wdGlvbnM6dHJ1ZSwgLy9hbGxvdyB0b2dnbGluZyBvZiBpbnZhbGlkIG9wdGlvbiB3YXJuaW5nc1xuXHRkZWJ1Z0ludmFsaWRDb21wb25lbnRGdW5jczp0cnVlLCAvL2FsbG93IHRvZ2dsaW5nIG9mIGludmFsaWQgY29tcG9uZW50IHdhcm5pbmdzXG5cdGRlYnVnSW5pdGlhbGl6YXRpb246dHJ1ZSwgLy9hbGxvdyB0b2dnbGluZyBvZiBwcmUgaW5pdGlhbGl6YXRpb24gZnVuY3Rpb24gY2FsbCB3YXJuaW5nc1xuXHRkZWJ1Z0RlcHJlY2F0aW9uOnRydWUsIC8vYWxsb3cgdG9nZ2xpbmcgb2YgZGVwcmVjYXRpb24gd2FybmluZ3NcblxuXHRoZWlnaHQ6ZmFsc2UsIC8vaGVpZ2h0IG9mIHRhYnVsYXRvclxuXHRtaW5IZWlnaHQ6ZmFsc2UsIC8vbWluaW11bSBoZWlnaHQgb2YgdGFidWxhdG9yXG5cdG1heEhlaWdodDpmYWxzZSwgLy9tYXhpbXVtIGhlaWdodCBvZiB0YWJ1bGF0b3JcblxuXHRjb2x1bW5IZWFkZXJWZXJ0QWxpZ246XCJ0b3BcIiwgLy92ZXJ0aWNhbCBhbGlnbm1lbnQgb2YgY29sdW1uIGhlYWRlcnNcblxuXHRwb3B1cENvbnRhaW5lcjpmYWxzZSxcblxuXHRjb2x1bW5zOltdLC8vc3RvcmUgZm9yIGNvbHVtIGhlYWRlciBpbmZvXG5cdGNvbHVtbkRlZmF1bHRzOnt9LCAvL3N0b3JlIGNvbHVtbiBkZWZhdWx0IHByb3BzXG5cdHJvd0hlYWRlcjpmYWxzZSxcblxuXHRkYXRhOmZhbHNlLCAvL2RlZmF1bHQgc3RhcnRpbmcgZGF0YVxuXG5cdGF1dG9Db2x1bW5zOmZhbHNlLCAvL2J1aWxkIGNvbHVtbnMgZnJvbSBkYXRhIHJvdyBzdHJ1Y3R1cmVcblx0YXV0b0NvbHVtbnNEZWZpbml0aW9uczpmYWxzZSxcblxuXHRuZXN0ZWRGaWVsZFNlcGFyYXRvcjpcIi5cIiwgLy9zZXBhcmF0b3IgZm9yIG5lc3RlZCBkYXRhXG5cblx0Zm9vdGVyRWxlbWVudDpmYWxzZSwgLy9ob2xkIGZvb3RlciBlbGVtZW50XG5cblx0aW5kZXg6XCJpZFwiLCAvL2ZpbGVkIGZvciByb3cgaW5kZXhcblxuXHR0ZXh0RGlyZWN0aW9uOlwiYXV0b1wiLFxuXG5cdGFkZFJvd1BvczpcImJvdHRvbVwiLCAvL3Bvc2l0aW9uIHRvIGluc2VydCBibGFuayByb3dzLCB0b3B8Ym90dG9tXG5cblx0aGVhZGVyVmlzaWJsZTp0cnVlLCAvL2hpZGUgaGVhZGVyXG5cblx0cmVuZGVyVmVydGljYWw6XCJ2aXJ0dWFsXCIsXG5cdHJlbmRlckhvcml6b250YWw6XCJiYXNpY1wiLFxuXHRyZW5kZXJWZXJ0aWNhbEJ1ZmZlcjowLCAvLyBzZXQgdmlydHVhbCBET00gYnVmZmVyIHNpemVcblxuXHRzY3JvbGxUb1Jvd1Bvc2l0aW9uOlwidG9wXCIsXG5cdHNjcm9sbFRvUm93SWZWaXNpYmxlOnRydWUsXG5cblx0c2Nyb2xsVG9Db2x1bW5Qb3NpdGlvbjpcImxlZnRcIixcblx0c2Nyb2xsVG9Db2x1bW5JZlZpc2libGU6dHJ1ZSxcblxuXHRyb3dGb3JtYXR0ZXI6ZmFsc2UsXG5cdHJvd0Zvcm1hdHRlclByaW50Om51bGwsXG5cdHJvd0Zvcm1hdHRlckNsaXBib2FyZDpudWxsLFxuXHRyb3dGb3JtYXR0ZXJIdG1sT3V0cHV0Om51bGwsXG5cblx0cm93SGVpZ2h0Om51bGwsXG5cblx0cGxhY2Vob2xkZXI6ZmFsc2UsXG5cblx0ZGF0YUxvYWRlcjp0cnVlLFxuXHRkYXRhTG9hZGVyTG9hZGluZzpmYWxzZSxcblx0ZGF0YUxvYWRlckVycm9yOmZhbHNlLFxuXHRkYXRhTG9hZGVyRXJyb3JUaW1lb3V0OjMwMDAsXG5cdGRhdGFTZW5kUGFyYW1zOnt9LFxuXHRkYXRhUmVjZWl2ZVBhcmFtczp7fSxcblxuXHRkZXBlbmRlbmNpZXM6e30sXG59O1xuXG5jbGFzcyBPcHRpb25zTGlzdCB7XG5cdGNvbnN0cnVjdG9yKHRhYmxlLCBtc2dUeXBlLCBkZWZhdWx0cyA9IHt9KXtcblx0XHR0aGlzLnRhYmxlID0gdGFibGU7XG5cdFx0dGhpcy5tc2dUeXBlID0gbXNnVHlwZTtcblx0XHR0aGlzLnJlZ2lzdGVyZWREZWZhdWx0cyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRzKTtcblx0fVxuXHRcblx0cmVnaXN0ZXIob3B0aW9uLCB2YWx1ZSl7XG5cdFx0dGhpcy5yZWdpc3RlcmVkRGVmYXVsdHNbb3B0aW9uXSA9IHZhbHVlO1xuXHR9XG5cdFxuXHRnZW5lcmF0ZShkZWZhdWx0T3B0aW9ucywgdXNlck9wdGlvbnMgPSB7fSl7XG5cdFx0dmFyIG91dHB1dCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucmVnaXN0ZXJlZERlZmF1bHRzKSxcblx0XHR3YXJuID0gdGhpcy50YWJsZS5vcHRpb25zLmRlYnVnSW52YWxpZE9wdGlvbnMgfHwgdXNlck9wdGlvbnMuZGVidWdJbnZhbGlkT3B0aW9ucyA9PT0gdHJ1ZTtcblx0XHRcblx0XHRPYmplY3QuYXNzaWduKG91dHB1dCwgZGVmYXVsdE9wdGlvbnMpO1xuXHRcdFxuXHRcdGZvciAobGV0IGtleSBpbiB1c2VyT3B0aW9ucyl7XG5cdFx0XHRpZighb3V0cHV0Lmhhc093blByb3BlcnR5KGtleSkpe1xuXHRcdFx0XHRpZih3YXJuKXtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJJbnZhbGlkIFwiICsgdGhpcy5tc2dUeXBlICsgXCIgb3B0aW9uOlwiLCBrZXkpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0b3V0cHV0W2tleV0gPSB1c2VyT3B0aW9ucy5rZXk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcblx0XHRcblx0XHRmb3IgKGxldCBrZXkgaW4gb3V0cHV0KXtcblx0XHRcdGlmKGtleSBpbiB1c2VyT3B0aW9ucyl7XG5cdFx0XHRcdG91dHB1dFtrZXldID0gdXNlck9wdGlvbnNba2V5XTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYoQXJyYXkuaXNBcnJheShvdXRwdXRba2V5XSkpe1xuXHRcdFx0XHRcdG91dHB1dFtrZXldID0gT2JqZWN0LmFzc2lnbihbXSwgb3V0cHV0W2tleV0pO1xuXHRcdFx0XHR9ZWxzZSBpZih0eXBlb2Ygb3V0cHV0W2tleV0gPT09IFwib2JqZWN0XCIgJiYgb3V0cHV0W2tleV0gIT09IG51bGwpe1xuXHRcdFx0XHRcdG91dHB1dFtrZXldID0gT2JqZWN0LmFzc2lnbih7fSwgb3V0cHV0W2tleV0pO1xuXHRcdFx0XHR9ZWxzZSBpZiAodHlwZW9mIG91dHB1dFtrZXldID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRkZWxldGUgb3V0cHV0W2tleV07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxufVxuXG5jbGFzcyBSZW5kZXJlciBleHRlbmRzIENvcmVGZWF0dXJle1xuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy5lbGVtZW50VmVydGljYWwgPSB0YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQ7XG5cdFx0dGhpcy5lbGVtZW50SG9yaXpvbnRhbCA9IHRhYmxlLmNvbHVtbk1hbmFnZXIuZWxlbWVudDtcblx0XHR0aGlzLnRhYmxlRWxlbWVudCA9ICB0YWJsZS5yb3dNYW5hZ2VyLnRhYmxlRWxlbWVudDtcblxuXHRcdHRoaXMudmVydGljYWxGaWxsTW9kZSA9IFwiZml0XCI7IC8vIHVzZWQgYnkgcm93IG1hbmFnZXIgdG8gZGV0ZXJtaW5lIGhvdyB0byBzaXplIHRoZSByZW5kZXIgYXJlYSAoXCJmaXRcIiAtIGZpdHMgY29udGFpbmVyIHRvIHRoZSBjb250ZW50cywgXCJmaWxsXCIgLSBmaWxscyB0aGUgY29udGFpbmVyIHdpdGhvdXQgcmVzaXppbmcgaXQpXG5cdH1cblxuXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vLy8vLy8gSW50ZXJuYWwgQmluZGluZ3MgLy8vLy8vLy8vXG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdC8vaW5pdGlhbGl6ZSBjb3JlIGZ1bmN0aW9uYWxpdHlcblx0fVxuXG5cdGNsZWFyUm93cygpe1xuXHRcdC8vY2xlYXIgZG93biBleGlzdGluZyByb3dzIGxheW91dFxuXHR9XG5cblx0Y2xlYXJDb2x1bW5zKCl7XG5cdFx0Ly9jbGVhciBkb3duIGV4aXN0aW5nIGNvbHVtbnMgbGF5b3V0XG5cdH1cblxuXG5cdHJlaW5pdGlhbGl6ZUNvbHVtbldpZHRocyhjb2x1bW5zKXtcblx0XHQvL3Jlc2l6ZSBjb2x1bW5zIHRvIGZpdCBkYXRhXG5cdH1cblxuXG5cdHJlbmRlclJvd3MoKXtcblx0XHQvL3JlbmRlciByb3dzIGZyb20gYSBjbGVhbiBzbGF0ZVxuXHR9XG5cblx0cmVuZGVyQ29sdW1ucygpe1xuXHRcdC8vcmVuZGVyIGNvbHVtbnMgZnJvbSBhIGNsZWFuIHNsYXRlXG5cdH1cblxuXHRyZXJlbmRlclJvd3MoY2FsbGJhY2spe1xuXHRcdC8vIHJlcmVuZGVyIHJvd3MgYW5kIGtlZXAgcG9zaXRpb25cblx0XHRpZihjYWxsYmFjayl7XG5cdFx0XHRjYWxsYmFjaygpO1xuXHRcdH1cblx0fVxuXG5cdHJlcmVuZGVyQ29sdW1ucyh1cGRhdGUsIGJsb2NrUmVkcmF3KXtcblx0XHQvL3JlcmVuZGVyIGNvbHVtbnNcblx0fVxuXG5cdHJlbmRlclJvd0NlbGxzKHJvdyl7XG5cdFx0Ly9yZW5kZXIgdGhlIGNlbGxzIGluIGEgcm93XG5cdH1cblxuXHRyZXJlbmRlclJvd0NlbGxzKHJvdywgZm9yY2Upe1xuXHRcdC8vcmVyZW5kZXIgdGhlIGNlbGxzIGluIGEgcm93XG5cdH1cblxuXHRzY3JvbGxDb2x1bW5zKGxlZnQsIGRpcil7XG5cdFx0Ly9oYW5kbGUgaG9yaXpvbnRhbCBzY3JvbGxpbmdcblx0fVxuXG5cdHNjcm9sbFJvd3ModG9wLCBkaXIpe1xuXHRcdC8vaGFuZGxlIHZlcnRpY2FsIHNjcm9sbGluZ1xuXHR9XG5cblx0cmVzaXplKCl7XG5cdFx0Ly9jb250YWluZXIgaGFzIHJlc2l6ZWQsIGNhcnJ5IG91dCBhbnkgbmVlZGVkIHJlY2FsY3VsYXRpb25zIChETyBOT1QgUkVSRU5ERVIgSU4gVEhJUyBGVU5DVElPTilcblx0fVxuXG5cdHNjcm9sbFRvUm93KHJvdyl7XG5cdFx0Ly9zY3JvbGwgdG8gYSBzcGVjaWZpYyByb3dcblx0fVxuXG5cdHNjcm9sbFRvUm93TmVhcmVzdFRvcChyb3cpe1xuXHRcdC8vZGV0ZXJtaW5lIHdlYXRoZXIgdGhlIHJvdyBpcyBuZWFyZXN0IHRoZSB0b3Agb3IgYm90dG9tIG9mIHRoZSB0YWJsZSwgcmV0dXJuIHRydWUgZm9yIHRvcCBvciBmYWxzZSBmb3IgYm90dG9tXG5cdH1cblxuXHR2aXNpYmxlUm93cyhpbmNsdWRpbmdCdWZmZXIpe1xuXHRcdC8vcmV0dXJuIHRoZSB2aXNpYmxlIHJvd3Ncblx0XHRyZXR1cm4gW107XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLyBIZWxwZXIgRnVuY3Rpb25zIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdHJvd3MoKXtcblx0XHRyZXR1cm4gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCk7XG5cdH1cblxuXHRzdHlsZVJvdyhyb3csIGluZGV4KXtcblx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXG5cdFx0aWYoaW5kZXggJSAyKXtcblx0XHRcdHJvd0VsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LWV2ZW5cIik7XG5cdFx0XHRyb3dFbC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXJvdy1vZGRcIik7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3ctb2RkXCIpO1xuXHRcdFx0cm93RWwuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1yb3ctZXZlblwiKTtcblx0XHR9XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vIEV4dGVybmFsIFRyaWdnZXJzIC8vLy8vLy8vL1xuXHQvLy8vLy8vIChETyBOT1QgT1ZFUlJJREUpIC8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdGNsZWFyKCl7XG5cdFx0Ly9jbGVhciBkb3duIGV4aXN0aW5nIGxheW91dFxuXHRcdHRoaXMuY2xlYXJSb3dzKCk7XG5cdFx0dGhpcy5jbGVhckNvbHVtbnMoKTtcblx0fVxuXG5cdHJlbmRlcigpe1xuXHRcdC8vcmVuZGVyIGZyb20gYSBjbGVhbiBzbGF0ZVxuXHRcdHRoaXMucmVuZGVyUm93cygpO1xuXHRcdHRoaXMucmVuZGVyQ29sdW1ucygpO1xuXHR9XG5cblx0cmVyZW5kZXIoY2FsbGJhY2spe1xuXHRcdC8vIHJlcmVuZGVyIGFuZCBrZWVwIHBvc2l0aW9uXG5cdFx0dGhpcy5yZXJlbmRlclJvd3MoKTtcblx0XHR0aGlzLnJlcmVuZGVyQ29sdW1ucygpO1xuXHR9XG5cblx0c2Nyb2xsVG9Sb3dQb3NpdGlvbihyb3csIHBvc2l0aW9uLCBpZlZpc2libGUpe1xuXHRcdHZhciByb3dJbmRleCA9IHRoaXMucm93cygpLmluZGV4T2Yocm93KSxcblx0XHRyb3dFbCA9IHJvdy5nZXRFbGVtZW50KCksXG5cdFx0b2Zmc2V0ID0gMDtcblxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRpZihyb3dJbmRleCA+IC0xKXtcblxuXHRcdFx0XHRpZih0eXBlb2YgaWZWaXNpYmxlID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRpZlZpc2libGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMuc2Nyb2xsVG9Sb3dJZlZpc2libGU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvL2NoZWNrIHJvdyB2aXNpYmlsaXR5XG5cdFx0XHRcdGlmKCFpZlZpc2libGUpe1xuXHRcdFx0XHRcdGlmKEhlbHBlcnMuZWxWaXNpYmxlKHJvd0VsKSl7XG5cdFx0XHRcdFx0XHRvZmZzZXQgPSBIZWxwZXJzLmVsT2Zmc2V0KHJvd0VsKS50b3AgLSBIZWxwZXJzLmVsT2Zmc2V0KHRoaXMuZWxlbWVudFZlcnRpY2FsKS50b3A7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmKG9mZnNldCA+IDAgJiYgb2Zmc2V0IDwgdGhpcy5lbGVtZW50VmVydGljYWwuY2xpZW50SGVpZ2h0IC0gcm93RWwub2Zmc2V0SGVpZ2h0KXtcblx0XHRcdFx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYodHlwZW9mIHBvc2l0aW9uID09PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdFx0XHRwb3NpdGlvbiA9IHRoaXMudGFibGUub3B0aW9ucy5zY3JvbGxUb1Jvd1Bvc2l0aW9uO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYocG9zaXRpb24gPT09IFwibmVhcmVzdFwiKXtcblx0XHRcdFx0XHRwb3NpdGlvbiA9IHRoaXMuc2Nyb2xsVG9Sb3dOZWFyZXN0VG9wKHJvdykgPyBcInRvcFwiIDogXCJib3R0b21cIjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vc2Nyb2xsIHRvIHJvd1xuXHRcdFx0XHR0aGlzLnNjcm9sbFRvUm93KHJvdyk7XG5cblx0XHRcdFx0Ly9hbGlnbiB0byBjb3JyZWN0IHBvc2l0aW9uXG5cdFx0XHRcdHN3aXRjaChwb3NpdGlvbil7XG5cdFx0XHRcdFx0Y2FzZSBcIm1pZGRsZVwiOlxuXHRcdFx0XHRcdGNhc2UgXCJjZW50ZXJcIjpcblxuXHRcdFx0XHRcdFx0aWYodGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsSGVpZ2h0IC0gdGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsVG9wID09IHRoaXMuZWxlbWVudFZlcnRpY2FsLmNsaWVudEhlaWdodCl7XG5cdFx0XHRcdFx0XHRcdHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCA9IHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCArIChyb3dFbC5vZmZzZXRUb3AgLSB0aGlzLmVsZW1lbnRWZXJ0aWNhbC5zY3JvbGxUb3ApIC0gKCh0aGlzLmVsZW1lbnRWZXJ0aWNhbC5zY3JvbGxIZWlnaHQgLSByb3dFbC5vZmZzZXRUb3ApIC8gMik7XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCA9IHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCAtICh0aGlzLmVsZW1lbnRWZXJ0aWNhbC5jbGllbnRIZWlnaHQgLyAyKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlIFwiYm90dG9tXCI6XG5cblx0XHRcdFx0XHRcdGlmKHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbEhlaWdodCAtIHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCA9PSB0aGlzLmVsZW1lbnRWZXJ0aWNhbC5jbGllbnRIZWlnaHQpe1xuXHRcdFx0XHRcdFx0XHR0aGlzLmVsZW1lbnRWZXJ0aWNhbC5zY3JvbGxUb3AgPSB0aGlzLmVsZW1lbnRWZXJ0aWNhbC5zY3JvbGxUb3AgLSAodGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsSGVpZ2h0IC0gcm93RWwub2Zmc2V0VG9wKSArIHJvd0VsLm9mZnNldEhlaWdodDtcblx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsVG9wID0gdGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsVG9wIC0gdGhpcy5lbGVtZW50VmVydGljYWwuY2xpZW50SGVpZ2h0ICsgcm93RWwub2Zmc2V0SGVpZ2h0O1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdGNhc2UgXCJ0b3BcIjpcblx0XHRcdFx0XHRcdHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCA9IHJvd0VsLm9mZnNldFRvcDtcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJlc29sdmUoKTtcblxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJTY3JvbGwgRXJyb3IgLSBSb3cgbm90IHZpc2libGVcIik7XG5cdFx0XHRcdHJlamVjdChcIlNjcm9sbCBFcnJvciAtIFJvdyBub3QgdmlzaWJsZVwiKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxufVxuXG5jbGFzcyBCYXNpY0hvcml6b250YWwgZXh0ZW5kcyBSZW5kZXJlcntcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0fVxuXHRcblx0cmVuZGVyUm93Q2VsbHMocm93LCBpbkZyYWdtZW50KSB7XG5cdFx0Y29uc3Qgcm93RnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblx0XHRyb3cuY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuXHRcdFx0cm93RnJhZy5hcHBlbmRDaGlsZChjZWxsLmdldEVsZW1lbnQoKSk7XG5cdFx0fSk7XG5cdFx0cm93LmVsZW1lbnQuYXBwZW5kQ2hpbGQocm93RnJhZyk7XG5cdFx0XG5cdFx0aWYoIWluRnJhZ21lbnQpe1xuXHRcdFx0cm93LmNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcblx0XHRcdFx0Y2VsbC5jZWxsUmVuZGVyZWQoKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXHRcblx0cmVpbml0aWFsaXplQ29sdW1uV2lkdGhzKGNvbHVtbnMpe1xuXHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pe1xuXHRcdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0fSk7XG5cdH1cbn1cblxuY2xhc3MgVmlydHVhbERvbUhvcml6b250YWwgZXh0ZW5kcyBSZW5kZXJlcntcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLmxlZnRDb2wgPSAwO1xuXHRcdHRoaXMucmlnaHRDb2wgPSAwO1xuXHRcdHRoaXMuc2Nyb2xsTGVmdCA9IDA7XG5cdFx0XG5cdFx0dGhpcy52RG9tU2Nyb2xsUG9zTGVmdCA9IDA7XG5cdFx0dGhpcy52RG9tU2Nyb2xsUG9zUmlnaHQgPSAwO1xuXHRcdFxuXHRcdHRoaXMudkRvbVBhZExlZnQgPSAwO1xuXHRcdHRoaXMudkRvbVBhZFJpZ2h0ID0gMDtcblx0XHRcblx0XHR0aGlzLmZpdERhdGFDb2xBdmcgPSAwO1xuXHRcdFxuXHRcdHRoaXMud2luZG93QnVmZmVyID0gMjAwOyAvL3BpeGVsIG1hcmdpbiB0byBtYWtlIGNvbHVtbiB2aXNpYmxlIGJlZm9yZSBpdCBpcyBzaG93biBvbiBzY3JlZW5cblx0XHRcblx0XHR0aGlzLnZpc2libGVSb3dzID0gbnVsbDtcblx0XHRcblx0XHR0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG5cdFx0dGhpcy5pc0ZpdERhdGEgPSBmYWxzZTtcblx0XHRcblx0XHR0aGlzLmNvbHVtbnMgPSBbXTtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuY29tcGF0aWJpbGl0eUNoZWNrKCk7XG5cdFx0dGhpcy5sYXlvdXRDaGVjaygpO1xuXHRcdHRoaXMudmVydFNjcm9sbExpc3RlbigpO1xuXHR9XG5cdFxuXHRjb21wYXRpYmlsaXR5Q2hlY2soKXtcdFx0XG5cdFx0aWYodGhpcy5vcHRpb25zKFwibGF5b3V0XCIpID09IFwiZml0RGF0YVRhYmxlXCIpe1xuXHRcdFx0Y29uc29sZS53YXJuKFwiSG9yaXpvbnRhbCBWaXJ0dWFsIERPTSBpcyBub3QgY29tcGF0aWJsZSB3aXRoIGZpdERhdGFUYWJsZSBsYXlvdXQgbW9kZVwiKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy5vcHRpb25zKFwicmVzcG9uc2l2ZUxheW91dFwiKSl7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJIb3Jpem9udGFsIFZpcnR1YWwgRE9NIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggcmVzcG9uc2l2ZSBjb2x1bW5zXCIpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLm9wdGlvbnMoXCJydGxcIikpe1xuXHRcdFx0Y29uc29sZS53YXJuKFwiSG9yaXpvbnRhbCBWaXJ0dWFsIERPTSBpcyBub3QgY3VycmVudGx5IGNvbXBhdGlibGUgd2l0aCBSVEwgdGV4dCBkaXJlY3Rpb25cIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRsYXlvdXRDaGVjaygpe1xuXHRcdHRoaXMuaXNGaXREYXRhID0gdGhpcy5vcHRpb25zKFwibGF5b3V0XCIpLnN0YXJ0c1dpdGgoJ2ZpdERhdGEnKTtcblx0fVxuXHRcblx0dmVydFNjcm9sbExpc3Rlbigpe1xuXHRcdHRoaXMuc3Vic2NyaWJlKFwic2Nyb2xsLXZlcnRpY2FsXCIsIHRoaXMuY2xlYXJWaXNSb3dDYWNoZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcImRhdGEtcmVmcmVzaGVkXCIsIHRoaXMuY2xlYXJWaXNSb3dDYWNoZS5iaW5kKHRoaXMpKTtcblx0fVxuXHRcblx0Y2xlYXJWaXNSb3dDYWNoZSgpe1xuXHRcdHRoaXMudmlzaWJsZVJvd3MgPSBudWxsO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8gUHVibGljIEZ1bmN0aW9ucyAvLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0cmVuZGVyQ29sdW1ucyhyb3csIGZvcmNlKXtcblx0XHR0aGlzLmRhdGFDaGFuZ2UoKTtcblx0fVxuXHRcblx0XG5cdHNjcm9sbENvbHVtbnMobGVmdCwgZGlyKXtcblx0XHRpZih0aGlzLnNjcm9sbExlZnQgIT0gbGVmdCl7XG5cdFx0XHR0aGlzLnNjcm9sbExlZnQgPSBsZWZ0O1xuXHRcdFx0XG5cdFx0XHR0aGlzLnNjcm9sbChsZWZ0IC0gKHRoaXMudkRvbVNjcm9sbFBvc0xlZnQgKyB0aGlzLndpbmRvd0J1ZmZlcikpO1xuXHRcdH1cblx0fVxuXHRcblx0Y2FsY1dpbmRvd0J1ZmZlcigpe1xuXHRcdHZhciBidWZmZXIgPSB0aGlzLmVsZW1lbnRWZXJ0aWNhbC5jbGllbnRXaWR0aDtcblx0XHRcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaCgoY29sdW1uKSA9PiB7XG5cdFx0XHRpZihjb2x1bW4udmlzaWJsZSl7XG5cdFx0XHRcdHZhciB3aWR0aCA9IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYod2lkdGggPiBidWZmZXIpe1xuXHRcdFx0XHRcdGJ1ZmZlciA9IHdpZHRoO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy53aW5kb3dCdWZmZXIgPSBidWZmZXIgKiAyO1xuXHR9XG5cdFxuXHRyZXJlbmRlckNvbHVtbnModXBkYXRlLCBibG9ja1JlZHJhdyl7XHRcdFxuXHRcdHZhciBvbGQgPSB7XG5cdFx0XHRjb2xzOnRoaXMuY29sdW1ucyxcblx0XHRcdGxlZnRDb2w6dGhpcy5sZWZ0Q29sLFxuXHRcdFx0cmlnaHRDb2w6dGhpcy5yaWdodENvbCxcblx0XHR9LFxuXHRcdGNvbFBvcyA9IDA7XG5cdFx0XG5cdFx0aWYodXBkYXRlICYmICF0aGlzLmluaXRpYWxpemVkKXtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5jbGVhcigpO1xuXHRcdFxuXHRcdHRoaXMuY2FsY1dpbmRvd0J1ZmZlcigpO1xuXHRcdFxuXHRcdHRoaXMuc2Nyb2xsTGVmdCA9IHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbExlZnQ7XG5cdFx0XG5cdFx0dGhpcy52RG9tU2Nyb2xsUG9zTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdCAtIHRoaXMud2luZG93QnVmZmVyO1xuXHRcdHRoaXMudkRvbVNjcm9sbFBvc1JpZ2h0ID0gdGhpcy5zY3JvbGxMZWZ0ICsgdGhpcy5lbGVtZW50VmVydGljYWwuY2xpZW50V2lkdGggKyB0aGlzLndpbmRvd0J1ZmZlcjtcblx0XHRcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZm9yRWFjaCgoY29sdW1uKSA9PiB7XG5cdFx0XHR2YXIgY29uZmlnID0ge30sXG5cdFx0XHR3aWR0aDtcblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uLnZpc2libGUpe1xuXHRcdFx0XHRpZighY29sdW1uLm1vZHVsZXMuZnJvemVuKXtcdFx0XHRcblx0XHRcdFx0XHR3aWR0aCA9IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGNvbmZpZy5sZWZ0UG9zID0gY29sUG9zO1xuXHRcdFx0XHRcdGNvbmZpZy5yaWdodFBvcyA9IGNvbFBvcyArIHdpZHRoO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGNvbmZpZy53aWR0aCA9IHdpZHRoO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmICh0aGlzLmlzRml0RGF0YSkge1xuXHRcdFx0XHRcdFx0Y29uZmlnLmZpdERhdGFDaGVjayA9IGNvbHVtbi5tb2R1bGVzLnZkb21Ib3ogPyBjb2x1bW4ubW9kdWxlcy52ZG9tSG96LmZpdERhdGFDaGVjayA6IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKChjb2xQb3MgKyB3aWR0aCA+IHRoaXMudkRvbVNjcm9sbFBvc0xlZnQpICYmIChjb2xQb3MgPCB0aGlzLnZEb21TY3JvbGxQb3NSaWdodCkpe1xuXHRcdFx0XHRcdFx0Ly9jb2x1bW4gaXMgdmlzaWJsZVxuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZih0aGlzLmxlZnRDb2wgPT0gLTEpe1xuXHRcdFx0XHRcdFx0XHR0aGlzLmxlZnRDb2wgPSB0aGlzLmNvbHVtbnMubGVuZ3RoO1xuXHRcdFx0XHRcdFx0XHR0aGlzLnZEb21QYWRMZWZ0ID0gY29sUG9zO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHR0aGlzLnJpZ2h0Q29sID0gdGhpcy5jb2x1bW5zLmxlbmd0aDtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHQvLyBjb2x1bW4gaXMgaGlkZGVuXG5cdFx0XHRcdFx0XHRpZih0aGlzLmxlZnRDb2wgIT09IC0xKXtcblx0XHRcdFx0XHRcdFx0dGhpcy52RG9tUGFkUmlnaHQgKz0gd2lkdGg7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMuY29sdW1ucy5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0Y29sdW1uLm1vZHVsZXMudmRvbUhveiA9IGNvbmZpZztcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRjb2xQb3MgKz0gd2lkdGg7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHR0aGlzLnRhYmxlRWxlbWVudC5zdHlsZS5wYWRkaW5nTGVmdCA9IHRoaXMudkRvbVBhZExlZnQgKyBcInB4XCI7XG5cdFx0dGhpcy50YWJsZUVsZW1lbnQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gdGhpcy52RG9tUGFkUmlnaHQgKyBcInB4XCI7XG5cdFx0XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG5cdFx0XG5cdFx0aWYoIWJsb2NrUmVkcmF3KXtcblx0XHRcdGlmKCF1cGRhdGUgfHwgdGhpcy5yZWluaXRDaGFuZ2VkKG9sZCkpe1xuXHRcdFx0XHR0aGlzLnJlaW5pdGlhbGl6ZVJvd3MoKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcblx0fVxuXHRcblx0cmVuZGVyUm93Q2VsbHMocm93KXtcblx0XHRpZih0aGlzLmluaXRpYWxpemVkKXtcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZVJvdyhyb3cpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnN0IHJvd0ZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cdFx0XHRyb3cuY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuXHRcdFx0XHRyb3dGcmFnLmFwcGVuZENoaWxkKGNlbGwuZ2V0RWxlbWVudCgpKTtcblx0XHRcdH0pO1xuXHRcdFx0cm93LmVsZW1lbnQuYXBwZW5kQ2hpbGQocm93RnJhZyk7XG5cdFx0XHRcblx0XHRcdHJvdy5jZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG5cdFx0XHRcdGNlbGwuY2VsbFJlbmRlcmVkKCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblx0XG5cdHJlcmVuZGVyUm93Q2VsbHMocm93LCBmb3JjZSl7XG5cdFx0dGhpcy5yZWluaXRpYWxpemVSb3cocm93LCBmb3JjZSk7XG5cdH1cblx0XG5cdHJlaW5pdGlhbGl6ZUNvbHVtbldpZHRocyhjb2x1bW5zKXtcblx0XHRmb3IobGV0IGkgPSB0aGlzLmxlZnRDb2w7IGkgPD0gdGhpcy5yaWdodENvbDsgaSsrKXtcblx0XHRcdGxldCBjb2wgPSB0aGlzLmNvbHVtbnNbaV07XG5cdFx0XHRcblx0XHRcdGlmKGNvbCl7XG5cdFx0XHRcdGNvbC5yZWluaXRpYWxpemVXaWR0aCgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8gSW50ZXJuYWwgUmVuZGVyaW5nIC8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdGRlaW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0fVxuXHRcblx0Y2xlYXIoKXtcblx0XHR0aGlzLmNvbHVtbnMgPSBbXTtcblx0XHRcblx0XHR0aGlzLmxlZnRDb2wgPSAtMTtcblx0XHR0aGlzLnJpZ2h0Q29sID0gMDtcblx0XHRcblx0XHR0aGlzLnZEb21TY3JvbGxQb3NMZWZ0ID0gMDtcblx0XHR0aGlzLnZEb21TY3JvbGxQb3NSaWdodCA9IDA7XG5cdFx0dGhpcy52RG9tUGFkTGVmdCA9IDA7XG5cdFx0dGhpcy52RG9tUGFkUmlnaHQgPSAwO1xuXHR9XG5cdFxuXHRkYXRhQ2hhbmdlKCl7XG5cdFx0dmFyIGNoYW5nZSA9IGZhbHNlLFxuXHRcdHJvdywgcm93RWw7XG5cdFx0XG5cdFx0aWYodGhpcy5pc0ZpdERhdGEpe1xuXHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnNCeUluZGV4LmZvckVhY2goKGNvbHVtbikgPT4ge1xuXHRcdFx0XHRpZighY29sdW1uLmRlZmluaXRpb24ud2lkdGggJiYgY29sdW1uLnZpc2libGUpe1xuXHRcdFx0XHRcdGNoYW5nZSA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHRpZihjaGFuZ2UgJiYgdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCkubGVuZ3RoKXtcblx0XHRcdFx0dGhpcy52RG9tU2Nyb2xsUG9zUmlnaHQgPSB0aGlzLnNjcm9sbExlZnQgKyB0aGlzLmVsZW1lbnRWZXJ0aWNhbC5jbGllbnRXaWR0aCArIHRoaXMud2luZG93QnVmZmVyO1xuXHRcdFx0XHRcblx0XHRcdFx0cm93ID0gdGhpcy5jaGFpbihcInJvd3Mtc2FtcGxlXCIsIFsxXSwgW10sICgpID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmdldERpc3BsYXlSb3dzKCk7XG5cdFx0XHRcdH0pWzBdO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYocm93KXtcblx0XHRcdFx0XHRyb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0cm93LmdlbmVyYXRlQ2VsbHMoKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR0aGlzLnRhYmxlRWxlbWVudC5hcHBlbmRDaGlsZChyb3dFbCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0Zm9yKGxldCBjb2xFbmQgPSAwOyBjb2xFbmQgPCByb3cuY2VsbHMubGVuZ3RoOyBjb2xFbmQrKyl7XG5cdFx0XHRcdFx0XHRsZXQgY2VsbCA9IHJvdy5jZWxsc1tjb2xFbmRdO1xuXHRcdFx0XHRcdFx0cm93RWwuYXBwZW5kQ2hpbGQoY2VsbC5nZXRFbGVtZW50KCkpO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRjZWxsLmNvbHVtbi5yZWluaXRpYWxpemVXaWR0aCgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0XHRyb3dFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd0VsKTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR0aGlzLnJlcmVuZGVyQ29sdW1ucyhmYWxzZSwgdHJ1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRpZih0aGlzLm9wdGlvbnMoXCJsYXlvdXRcIikgPT09IFwiZml0Q29sdW1uc1wiKXtcblx0XHRcdFx0dGhpcy5sYXlvdXRSZWZyZXNoKCk7XG5cdFx0XHRcdHRoaXMucmVyZW5kZXJDb2x1bW5zKGZhbHNlLCB0cnVlKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdHJlaW5pdENoYW5nZWQob2xkKXtcblx0XHR2YXIgbWF0Y2ggPSB0cnVlO1xuXHRcdFxuXHRcdGlmKG9sZC5jb2xzLmxlbmd0aCAhPT0gdGhpcy5jb2x1bW5zLmxlbmd0aCB8fCBvbGQubGVmdENvbCAhPT0gdGhpcy5sZWZ0Q29sIHx8IG9sZC5yaWdodENvbCAhPT0gdGhpcy5yaWdodENvbCl7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0XG5cdFx0b2xkLmNvbHMuZm9yRWFjaCgoY29sLCBpKSA9PiB7XG5cdFx0XHRpZihjb2wgIT09IHRoaXMuY29sdW1uc1tpXSl7XG5cdFx0XHRcdG1hdGNoID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuICFtYXRjaDtcblx0fVxuXHRcblx0cmVpbml0aWFsaXplUm93cygpe1xuXHRcdHZhciB2aXNpYmxlUm93cyA9IHRoaXMuZ2V0VmlzaWJsZVJvd3MoKSxcblx0XHRvdGhlclJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0Um93cygpLmZpbHRlcihyb3cgPT4gIXZpc2libGVSb3dzLmluY2x1ZGVzKHJvdykpO1xuXHRcdFxuXHRcdHZpc2libGVSb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0dGhpcy5yZWluaXRpYWxpemVSb3cocm93LCB0cnVlKTtcblx0XHR9KTtcblx0XHRcblx0XHRvdGhlclJvd3MuZm9yRWFjaCgocm93KSA9Pntcblx0XHRcdHJvdy5kZWluaXRpYWxpemUoKTtcblx0XHR9KTtcblx0fVxuXHRcblx0Z2V0VmlzaWJsZVJvd3MoKXtcblx0XHRpZiAoIXRoaXMudmlzaWJsZVJvd3Mpe1xuXHRcdFx0dGhpcy52aXNpYmxlUm93cyA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXRWaXNpYmxlUm93cygpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gdGhpcy52aXNpYmxlUm93cztcdFxuXHR9XG5cdFxuXHRzY3JvbGwoZGlmZil7XG5cdFx0dGhpcy52RG9tU2Nyb2xsUG9zTGVmdCArPSBkaWZmO1xuXHRcdHRoaXMudkRvbVNjcm9sbFBvc1JpZ2h0ICs9IGRpZmY7XG5cdFx0XG5cdFx0aWYoTWF0aC5hYnMoZGlmZikgPiAodGhpcy53aW5kb3dCdWZmZXIgLyAyKSl7XG5cdFx0XHR0aGlzLnJlcmVuZGVyQ29sdW1ucygpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKGRpZmYgPiAwKXtcblx0XHRcdFx0Ly9zY3JvbGwgcmlnaHRcblx0XHRcdFx0dGhpcy5hZGRDb2xSaWdodCgpO1xuXHRcdFx0XHR0aGlzLnJlbW92ZUNvbExlZnQoKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Ly9zY3JvbGwgbGVmdFxuXHRcdFx0XHR0aGlzLmFkZENvbExlZnQoKTtcblx0XHRcdFx0dGhpcy5yZW1vdmVDb2xSaWdodCgpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Y29sUG9zaXRpb25BZGp1c3QgKHN0YXJ0LCBlbmQsIGRpZmYpe1xuXHRcdGZvcihsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspe1xuXHRcdFx0bGV0IGNvbHVtbiA9IHRoaXMuY29sdW1uc1tpXTtcblx0XHRcdFxuXHRcdFx0Y29sdW1uLm1vZHVsZXMudmRvbUhvei5sZWZ0UG9zICs9IGRpZmY7XG5cdFx0XHRjb2x1bW4ubW9kdWxlcy52ZG9tSG96LnJpZ2h0UG9zICs9IGRpZmY7XG5cdFx0fVxuXHR9XG5cdFxuXHRhZGRDb2xSaWdodCgpe1xuXHRcdHZhciBjaGFuZ2VzID0gZmFsc2UsXG5cdFx0d29ya2luZyA9IHRydWU7XG5cdFx0XG5cdFx0d2hpbGUod29ya2luZyl7XG5cdFx0XHRcblx0XHRcdGxldCBjb2x1bW4gPSB0aGlzLmNvbHVtbnNbdGhpcy5yaWdodENvbCArIDFdO1xuXHRcdFx0XG5cdFx0XHRpZihjb2x1bW4pe1xuXHRcdFx0XHRpZihjb2x1bW4ubW9kdWxlcy52ZG9tSG96LmxlZnRQb3MgPD0gdGhpcy52RG9tU2Nyb2xsUG9zUmlnaHQpe1xuXHRcdFx0XHRcdGNoYW5nZXMgPSB0cnVlO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMuZ2V0VmlzaWJsZVJvd3MoKS5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0XHRcdGlmKHJvdy50eXBlICE9PSBcImdyb3VwXCIpe1xuXHRcdFx0XHRcdFx0XHR2YXIgY2VsbCA9IHJvdy5nZXRDZWxsKGNvbHVtbik7XG5cdFx0XHRcdFx0XHRcdHJvdy5nZXRFbGVtZW50KCkuaW5zZXJ0QmVmb3JlKGNlbGwuZ2V0RWxlbWVudCgpLCByb3cuZ2V0Q2VsbCh0aGlzLmNvbHVtbnNbdGhpcy5yaWdodENvbF0pLmdldEVsZW1lbnQoKS5uZXh0U2libGluZyk7XG5cdFx0XHRcdFx0XHRcdGNlbGwuY2VsbFJlbmRlcmVkKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0dGhpcy5maXREYXRhQ29sQWN0dWFsV2lkdGhDaGVjayhjb2x1bW4pO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMucmlnaHRDb2wrKzsgLy8gRG9uJ3QgbW92ZSB0aGlzIGJlbG93IHRoZSA+PSBjaGVjayBiZWxvd1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMuZ2V0VmlzaWJsZVJvd3MoKS5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0XHRcdGlmKHJvdy50eXBlICE9PSBcImdyb3VwXCIpe1xuXHRcdFx0XHRcdFx0XHRyb3cubW9kdWxlcy52ZG9tSG96LnJpZ2h0Q29sID0gdGhpcy5yaWdodENvbDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZih0aGlzLnJpZ2h0Q29sID49ICh0aGlzLmNvbHVtbnMubGVuZ3RoIC0gMSkpe1xuXHRcdFx0XHRcdFx0dGhpcy52RG9tUGFkUmlnaHQgPSAwO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdHRoaXMudkRvbVBhZFJpZ2h0IC09IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0XHRcdH1cdFxuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHdvcmtpbmcgPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0aWYoY2hhbmdlcyl7XG5cdFx0XHR0aGlzLnRhYmxlRWxlbWVudC5zdHlsZS5wYWRkaW5nUmlnaHQgPSB0aGlzLnZEb21QYWRSaWdodCArIFwicHhcIjtcblx0XHR9XG5cdH1cblx0XG5cdGFkZENvbExlZnQoKXtcblx0XHR2YXIgY2hhbmdlcyA9IGZhbHNlLFxuXHRcdHdvcmtpbmcgPSB0cnVlO1xuXHRcdFxuXHRcdHdoaWxlKHdvcmtpbmcpe1xuXHRcdFx0bGV0IGNvbHVtbiA9IHRoaXMuY29sdW1uc1t0aGlzLmxlZnRDb2wgLSAxXTtcblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uKXtcblx0XHRcdFx0aWYoY29sdW1uLm1vZHVsZXMudmRvbUhvei5yaWdodFBvcyA+PSB0aGlzLnZEb21TY3JvbGxQb3NMZWZ0KXtcblx0XHRcdFx0XHRjaGFuZ2VzID0gdHJ1ZTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR0aGlzLmdldFZpc2libGVSb3dzKCkuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdFx0XHRpZihyb3cudHlwZSAhPT0gXCJncm91cFwiKXtcblx0XHRcdFx0XHRcdFx0dmFyIGNlbGwgPSByb3cuZ2V0Q2VsbChjb2x1bW4pO1xuXHRcdFx0XHRcdFx0XHRyb3cuZ2V0RWxlbWVudCgpLmluc2VydEJlZm9yZShjZWxsLmdldEVsZW1lbnQoKSwgcm93LmdldENlbGwodGhpcy5jb2x1bW5zW3RoaXMubGVmdENvbF0pLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdFx0XHRcdGNlbGwuY2VsbFJlbmRlcmVkKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0dGhpcy5sZWZ0Q29sLS07IC8vIGRvbid0IG1vdmUgdGhpcyBiZWxvdyB0aGUgPD0gY2hlY2sgYmVsb3dcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR0aGlzLmdldFZpc2libGVSb3dzKCkuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdFx0XHRpZihyb3cudHlwZSAhPT0gXCJncm91cFwiKXtcblx0XHRcdFx0XHRcdFx0cm93Lm1vZHVsZXMudmRvbUhvei5sZWZ0Q29sID0gdGhpcy5sZWZ0Q29sO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKHRoaXMubGVmdENvbCA8PSAwKXsgLy8gcmVwbGljYXRpbmcgbG9naWMgaW4gYWRkQ29sUmlnaHRcblx0XHRcdFx0XHRcdHRoaXMudkRvbVBhZExlZnQgPSAwO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdHRoaXMudkRvbVBhZExlZnQgLT0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGxldCBkaWZmID0gdGhpcy5maXREYXRhQ29sQWN0dWFsV2lkdGhDaGVjayhjb2x1bW4pO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKGRpZmYpe1xuXHRcdFx0XHRcdFx0dGhpcy5zY3JvbGxMZWZ0ID0gdGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsTGVmdCA9IHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbExlZnQgKyBkaWZmO1xuXHRcdFx0XHRcdFx0dGhpcy52RG9tUGFkUmlnaHQgLT0gZGlmZjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR3b3JraW5nID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRpZihjaGFuZ2VzKXtcblx0XHRcdHRoaXMudGFibGVFbGVtZW50LnN0eWxlLnBhZGRpbmdMZWZ0ID0gdGhpcy52RG9tUGFkTGVmdCArIFwicHhcIjtcblx0XHR9XG5cdH1cblx0XG5cdHJlbW92ZUNvbFJpZ2h0KCl7XG5cdFx0dmFyIGNoYW5nZXMgPSBmYWxzZSxcblx0XHR3b3JraW5nID0gdHJ1ZTtcblx0XHRcblx0XHR3aGlsZSh3b3JraW5nKXtcblx0XHRcdGxldCBjb2x1bW4gPSB0aGlzLmNvbHVtbnNbdGhpcy5yaWdodENvbF07XG5cdFx0XHRcblx0XHRcdGlmKGNvbHVtbil7XG5cdFx0XHRcdGlmKGNvbHVtbi5tb2R1bGVzLnZkb21Ib3oubGVmdFBvcyA+IHRoaXMudkRvbVNjcm9sbFBvc1JpZ2h0KXtcblx0XHRcdFx0XHRjaGFuZ2VzID0gdHJ1ZTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR0aGlzLmdldFZpc2libGVSb3dzKCkuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdFx0XHRpZihyb3cudHlwZSAhPT0gXCJncm91cFwiKXtcblx0XHRcdFx0XHRcdFx0dmFyIGNlbGwgPSByb3cuZ2V0Q2VsbChjb2x1bW4pO1xuXHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdFx0XHRyb3cuZ2V0RWxlbWVudCgpLnJlbW92ZUNoaWxkKGNlbGwuZ2V0RWxlbWVudCgpKTtcblx0XHRcdFx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb3VsZCBub3QgcmVtb3ZlQ29sUmlnaHRcIiwgZXgubWVzc2FnZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR0aGlzLnZEb21QYWRSaWdodCArPSBjb2x1bW4uZ2V0V2lkdGgoKTtcblx0XHRcdFx0XHR0aGlzLnJpZ2h0Q29sIC0tO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMuZ2V0VmlzaWJsZVJvd3MoKS5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0XHRcdGlmKHJvdy50eXBlICE9PSBcImdyb3VwXCIpe1xuXHRcdFx0XHRcdFx0XHRyb3cubW9kdWxlcy52ZG9tSG96LnJpZ2h0Q29sID0gdGhpcy5yaWdodENvbDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHdvcmtpbmcgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR3b3JraW5nID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGlmKGNoYW5nZXMpe1xuXHRcdFx0dGhpcy50YWJsZUVsZW1lbnQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gdGhpcy52RG9tUGFkUmlnaHQgKyBcInB4XCI7XG5cdFx0fVxuXHR9XG5cdFxuXHRyZW1vdmVDb2xMZWZ0KCl7XG5cdFx0dmFyIGNoYW5nZXMgPSBmYWxzZSxcblx0XHR3b3JraW5nID0gdHJ1ZTtcblx0XHRcblx0XHR3aGlsZSh3b3JraW5nKXtcblx0XHRcdGxldCBjb2x1bW4gPSB0aGlzLmNvbHVtbnNbdGhpcy5sZWZ0Q29sXTtcblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uKXtcblx0XHRcdFx0aWYoY29sdW1uLm1vZHVsZXMudmRvbUhvei5yaWdodFBvcyA8IHRoaXMudkRvbVNjcm9sbFBvc0xlZnQpe1xuXHRcdFx0XHRcdGNoYW5nZXMgPSB0cnVlO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMuZ2V0VmlzaWJsZVJvd3MoKS5mb3JFYWNoKChyb3cpID0+IHtcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZihyb3cudHlwZSAhPT0gXCJncm91cFwiKXtcblx0XHRcdFx0XHRcdFx0dmFyIGNlbGwgPSByb3cuZ2V0Q2VsbChjb2x1bW4pO1xuXHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdFx0XHRyb3cuZ2V0RWxlbWVudCgpLnJlbW92ZUNoaWxkKGNlbGwuZ2V0RWxlbWVudCgpKTtcblx0XHRcdFx0XHRcdFx0fSBjYXRjaCAoZXgpIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJDb3VsZCBub3QgcmVtb3ZlQ29sTGVmdFwiLCBleC5tZXNzYWdlKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMudkRvbVBhZExlZnQgKz0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHRcdFx0dGhpcy5sZWZ0Q29sICsrO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHRoaXMuZ2V0VmlzaWJsZVJvd3MoKS5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0XHRcdGlmKHJvdy50eXBlICE9PSBcImdyb3VwXCIpe1xuXHRcdFx0XHRcdFx0XHRyb3cubW9kdWxlcy52ZG9tSG96LmxlZnRDb2wgPSB0aGlzLmxlZnRDb2w7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR3b3JraW5nID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRpZihjaGFuZ2VzKXtcblx0XHRcdHRoaXMudGFibGVFbGVtZW50LnN0eWxlLnBhZGRpbmdMZWZ0ID0gdGhpcy52RG9tUGFkTGVmdCArIFwicHhcIjtcblx0XHR9XG5cdH1cblx0XG5cdGZpdERhdGFDb2xBY3R1YWxXaWR0aENoZWNrKGNvbHVtbil7XG5cdFx0dmFyIG5ld1dpZHRoLCB3aWR0aERpZmY7XG5cdFx0XG5cdFx0aWYoY29sdW1uLm1vZHVsZXMudmRvbUhvei5maXREYXRhQ2hlY2spe1xuXHRcdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0XHRcblx0XHRcdG5ld1dpZHRoID0gY29sdW1uLmdldFdpZHRoKCk7XG5cdFx0XHR3aWR0aERpZmYgPSBuZXdXaWR0aCAtIGNvbHVtbi5tb2R1bGVzLnZkb21Ib3oud2lkdGg7XG5cdFx0XHRcblx0XHRcdGlmKHdpZHRoRGlmZil7XG5cdFx0XHRcdGNvbHVtbi5tb2R1bGVzLnZkb21Ib3oucmlnaHRQb3MgKz0gd2lkdGhEaWZmO1xuXHRcdFx0XHRjb2x1bW4ubW9kdWxlcy52ZG9tSG96LndpZHRoID0gbmV3V2lkdGg7XG5cdFx0XHRcdHRoaXMuY29sUG9zaXRpb25BZGp1c3QodGhpcy5jb2x1bW5zLmluZGV4T2YoY29sdW1uKSArIDEsIHRoaXMuY29sdW1ucy5sZW5ndGgsIHdpZHRoRGlmZik7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGNvbHVtbi5tb2R1bGVzLnZkb21Ib3ouZml0RGF0YUNoZWNrID0gZmFsc2U7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiB3aWR0aERpZmY7XG5cdH1cblx0XG5cdGluaXRpYWxpemVSb3cocm93KXtcblx0XHRpZihyb3cudHlwZSAhPT0gXCJncm91cFwiKXtcblx0XHRcdHJvdy5tb2R1bGVzLnZkb21Ib3ogPSB7XG5cdFx0XHRcdGxlZnRDb2w6dGhpcy5sZWZ0Q29sLFxuXHRcdFx0XHRyaWdodENvbDp0aGlzLnJpZ2h0Q29sLFxuXHRcdFx0fTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMpe1xuXHRcdFx0XHR0aGlzLnRhYmxlLm1vZHVsZXMuZnJvemVuQ29sdW1ucy5sZWZ0Q29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdFx0XHR0aGlzLmFwcGVuZENlbGwocm93LCBjb2x1bW4pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Zm9yKGxldCBpID0gdGhpcy5sZWZ0Q29sOyBpIDw9IHRoaXMucmlnaHRDb2w7IGkrKyl7XG5cdFx0XHRcdHRoaXMuYXBwZW5kQ2VsbChyb3csIHRoaXMuY29sdW1uc1tpXSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMudGFibGUubW9kdWxlcy5mcm96ZW5Db2x1bW5zKXtcblx0XHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLmZyb3plbkNvbHVtbnMucmlnaHRDb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuXHRcdFx0XHRcdHRoaXMuYXBwZW5kQ2VsbChyb3csIGNvbHVtbik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0YXBwZW5kQ2VsbChyb3csIGNvbHVtbil7XG5cdFx0aWYoY29sdW1uICYmIGNvbHVtbi52aXNpYmxlKXtcblx0XHRcdGxldCBjZWxsID0gcm93LmdldENlbGwoY29sdW1uKTtcblx0XHRcdFxuXHRcdFx0cm93LmdldEVsZW1lbnQoKS5hcHBlbmRDaGlsZChjZWxsLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRjZWxsLmNlbGxSZW5kZXJlZCgpO1xuXHRcdH1cblx0fVxuXHRcblx0cmVpbml0aWFsaXplUm93KHJvdywgZm9yY2Upe1xuXHRcdGlmKHJvdy50eXBlICE9PSBcImdyb3VwXCIpe1xuXHRcdFx0aWYoZm9yY2UgfHwgIXJvdy5tb2R1bGVzLnZkb21Ib3ogfHwgcm93Lm1vZHVsZXMudmRvbUhvei5sZWZ0Q29sICE9PSB0aGlzLmxlZnRDb2wgfHwgcm93Lm1vZHVsZXMudmRvbUhvei5yaWdodENvbCAhPT0gdGhpcy5yaWdodENvbCl7XG5cdFx0XHRcdFxuXHRcdFx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXHRcdFx0XHR3aGlsZShyb3dFbC5maXJzdENoaWxkKSByb3dFbC5yZW1vdmVDaGlsZChyb3dFbC5maXJzdENoaWxkKTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuaW5pdGlhbGl6ZVJvdyhyb3cpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG5jbGFzcyBDb2x1bW5NYW5hZ2VyIGV4dGVuZHMgQ29yZUZlYXR1cmUge1xuXHRcblx0Y29uc3RydWN0b3IgKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5ibG9ja0hvelNjcm9sbEV2ZW50ID0gZmFsc2U7XG5cdFx0dGhpcy5oZWFkZXJzRWxlbWVudCA9IG51bGw7XG5cdFx0dGhpcy5jb250ZW50c0VsZW1lbnQgPSBudWxsO1xuXHRcdHRoaXMucm93SGVhZGVyID0gbnVsbDtcblx0XHR0aGlzLmVsZW1lbnQgPSBudWxsIDsgLy9jb250YWluaW5nIGVsZW1lbnRcblx0XHR0aGlzLmNvbHVtbnMgPSBbXTsgLy8gY29sdW1uIGRlZmluaXRpb24gb2JqZWN0XG5cdFx0dGhpcy5jb2x1bW5zQnlJbmRleCA9IFtdOyAvL2NvbHVtbnMgYnkgaW5kZXhcblx0XHR0aGlzLmNvbHVtbnNCeUZpZWxkID0ge307IC8vY29sdW1ucyBieSBmaWVsZFxuXHRcdHRoaXMuc2Nyb2xsTGVmdCA9IDA7XG5cdFx0dGhpcy5vcHRpb25zTGlzdCA9IG5ldyBPcHRpb25zTGlzdCh0aGlzLnRhYmxlLCBcImNvbHVtbiBkZWZpbml0aW9uXCIsIGRlZmF1bHRDb2x1bW5PcHRpb25zKTtcblx0XHRcblx0XHR0aGlzLnJlZHJhd0Jsb2NrID0gZmFsc2U7IC8vcHJldmVudCByZWRyYXdzIHRvIGFsbG93IG11bHRpcGxlIGRhdGEgbWFuaXB1bGF0aW9ucyBiZWZvcmUgY29udGludWluZ1xuXHRcdHRoaXMucmVkcmF3QmxvY2tVcGRhdGUgPSBudWxsOyAvL3N0b3JlIGxhdGVzdCByZWRyYXcgdXBkYXRlIG9ubHkgc3RhdHVzXG5cdFx0XG5cdFx0dGhpcy5yZW5kZXJlciA9IG51bGw7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vIFNldHVwIEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy8vLy8vL1xuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuaW5pdGlhbGl6ZVJlbmRlcmVyKCk7XG5cdFx0XG5cdFx0dGhpcy5oZWFkZXJzRWxlbWVudCA9IHRoaXMuY3JlYXRlSGVhZGVyc0VsZW1lbnQoKTtcblx0XHR0aGlzLmNvbnRlbnRzRWxlbWVudCA9IHRoaXMuY3JlYXRlSGVhZGVyQ29udGVudHNFbGVtZW50KCk7XG5cdFx0dGhpcy5lbGVtZW50ID0gdGhpcy5jcmVhdGVIZWFkZXJFbGVtZW50KCk7XG5cdFx0XG5cdFx0dGhpcy5jb250ZW50c0VsZW1lbnQuaW5zZXJ0QmVmb3JlKHRoaXMuaGVhZGVyc0VsZW1lbnQsIHRoaXMuY29udGVudHNFbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdHRoaXMuZWxlbWVudC5pbnNlcnRCZWZvcmUodGhpcy5jb250ZW50c0VsZW1lbnQsIHRoaXMuZWxlbWVudC5maXJzdENoaWxkKTtcblx0XHRcblx0XHR0aGlzLmluaXRpYWxpemVTY3JvbGxXaGVlbFdhdGNoZXIoKTtcblx0XHRcblx0XHR0aGlzLnN1YnNjcmliZShcInNjcm9sbC1ob3Jpem9udGFsXCIsIHRoaXMuc2Nyb2xsSG9yaXpvbnRhbC5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnN1YnNjcmliZShcInNjcm9sbGJhci12ZXJ0aWNhbFwiLCB0aGlzLnBhZFZlcnRpY2FsU2Nyb2xsYmFyLmJpbmQodGhpcykpO1xuXHR9XG5cdFxuXHRwYWRWZXJ0aWNhbFNjcm9sbGJhcih3aWR0aCl7XG5cdFx0aWYodGhpcy50YWJsZS5ydGwpe1xuXHRcdFx0dGhpcy5oZWFkZXJzRWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gd2lkdGggKyBcInB4XCI7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5oZWFkZXJzRWxlbWVudC5zdHlsZS5tYXJnaW5SaWdodCA9IHdpZHRoICsgXCJweFwiO1xuXHRcdH1cblx0fVxuXHRcblx0aW5pdGlhbGl6ZVJlbmRlcmVyKCl7XG5cdFx0dmFyIHJlbmRlckNsYXNzO1xuXHRcdFxuXHRcdHZhciByZW5kZXJlcnMgPSB7XG5cdFx0XHRcInZpcnR1YWxcIjogVmlydHVhbERvbUhvcml6b250YWwsXG5cdFx0XHRcImJhc2ljXCI6IEJhc2ljSG9yaXpvbnRhbCxcblx0XHR9O1xuXHRcdFxuXHRcdGlmKHR5cGVvZiB0aGlzLnRhYmxlLm9wdGlvbnMucmVuZGVySG9yaXpvbnRhbCA9PT0gXCJzdHJpbmdcIil7XG5cdFx0XHRyZW5kZXJDbGFzcyA9IHJlbmRlcmVyc1t0aGlzLnRhYmxlLm9wdGlvbnMucmVuZGVySG9yaXpvbnRhbF07XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmVuZGVyQ2xhc3MgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVuZGVySG9yaXpvbnRhbDtcblx0XHR9XG5cdFx0XG5cdFx0aWYocmVuZGVyQ2xhc3Mpe1xuXHRcdFx0dGhpcy5yZW5kZXJlciA9IG5ldyByZW5kZXJDbGFzcyh0aGlzLnRhYmxlLCB0aGlzLmVsZW1lbnQsIHRoaXMudGFibGVFbGVtZW50KTtcblx0XHRcdHRoaXMucmVuZGVyZXIuaW5pdGlhbGl6ZSgpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gZmluZCBtYXRjaGluZyByZW5kZXJlcjpcIiwgdGhpcy50YWJsZS5vcHRpb25zLnJlbmRlckhvcml6b250YWwpO1xuXHRcdH1cblx0fVxuXHRcblx0XG5cdGNyZWF0ZUhlYWRlcnNFbGVtZW50ICgpe1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1oZWFkZXJzXCIpO1xuXHRcdGVsLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJyb3dcIik7XG5cdFx0XG5cdFx0cmV0dXJuIGVsO1xuXHR9XG5cdFxuXHRjcmVhdGVIZWFkZXJDb250ZW50c0VsZW1lbnQgKCl7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWhlYWRlci1jb250ZW50c1wiKTtcblx0XHRlbC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwicm93Z3JvdXBcIik7XG5cdFx0XG5cdFx0cmV0dXJuIGVsO1xuXHR9XG5cdFxuXHRjcmVhdGVIZWFkZXJFbGVtZW50ICgpe1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0XG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1oZWFkZXJcIik7XG5cdFx0ZWwuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcInJvd2dyb3VwXCIpO1xuXHRcdFxuXHRcdGlmKCF0aGlzLnRhYmxlLm9wdGlvbnMuaGVhZGVyVmlzaWJsZSl7XG5cdFx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWhlYWRlci1oaWRkZW5cIik7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiBlbDtcblx0fVxuXHRcblx0Ly9yZXR1cm4gY29udGFpbmluZyBlbGVtZW50XG5cdGdldEVsZW1lbnQoKXtcblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9XG5cdFxuXHQvL3JldHVybiBjb250YWluaW5nIGNvbnRlbnRzIGVsZW1lbnRcblx0Z2V0Q29udGVudHNFbGVtZW50KCl7XG5cdFx0cmV0dXJuIHRoaXMuY29udGVudHNFbGVtZW50O1xuXHR9XG5cdFxuXHRcblx0Ly9yZXR1cm4gaGVhZGVyIGNvbnRhaW5pbmcgZWxlbWVudFxuXHRnZXRIZWFkZXJzRWxlbWVudCgpe1xuXHRcdHJldHVybiB0aGlzLmhlYWRlcnNFbGVtZW50O1xuXHR9XG5cdFxuXHQvL3Njcm9sbCBob3Jpem9udGFsbHkgdG8gbWF0Y2ggdGFibGUgYm9keVxuXHRzY3JvbGxIb3Jpem9udGFsKGxlZnQpe1xuXHRcdHRoaXMuY29udGVudHNFbGVtZW50LnNjcm9sbExlZnQgPSBsZWZ0O1xuXHRcdFxuXHRcdHRoaXMuc2Nyb2xsTGVmdCA9IGxlZnQ7XG5cdFx0XG5cdFx0dGhpcy5yZW5kZXJlci5zY3JvbGxDb2x1bW5zKGxlZnQpO1xuXHR9XG5cdFxuXHRpbml0aWFsaXplU2Nyb2xsV2hlZWxXYXRjaGVyKCl7XG5cdFx0dGhpcy5jb250ZW50c0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIndoZWVsXCIsIChlKSA9PiB7XG5cdFx0XHR2YXIgbGVmdDtcblx0XHRcdFxuXHRcdFx0aWYoZS5kZWx0YVgpe1xuXHRcdFx0XHRsZWZ0ID0gdGhpcy5jb250ZW50c0VsZW1lbnQuc2Nyb2xsTGVmdCArIGUuZGVsdGFYO1xuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdFx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vIENvbHVtbiBTZXR1cCBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vL1xuXHRnZW5lcmF0ZUNvbHVtbnNGcm9tUm93RGF0YShkYXRhKXtcblx0XHR2YXIgY29scyA9IFtdLFxuXHRcdGNvbGxQcm9ncmVzcyA9IHt9LFxuXHRcdHJvd1NhbXBsZSA9IHRoaXMudGFibGUub3B0aW9ucy5hdXRvQ29sdW1ucyA9PT0gXCJmdWxsXCIgPyBkYXRhIDogW2RhdGFbMF1dLFxuXHRcdGRlZmluaXRpb25zID0gdGhpcy50YWJsZS5vcHRpb25zLmF1dG9Db2x1bW5zRGVmaW5pdGlvbnM7XG5cdFx0XG5cdFx0aWYoZGF0YSAmJiBkYXRhLmxlbmd0aCl7XG5cdFx0XHRcblx0XHRcdHJvd1NhbXBsZS5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0XG5cdFx0XHRcdE9iamVjdC5rZXlzKHJvdykuZm9yRWFjaCgoa2V5LCBpbmRleCkgPT4ge1xuXHRcdFx0XHRcdGxldCB2YWx1ZSA9IHJvd1trZXldLFxuXHRcdFx0XHRcdGNvbDtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZighY29sbFByb2dyZXNzW2tleV0pe1xuXHRcdFx0XHRcdFx0Y29sID0ge1xuXHRcdFx0XHRcdFx0XHRmaWVsZDprZXksXG5cdFx0XHRcdFx0XHRcdHRpdGxlOmtleSxcblx0XHRcdFx0XHRcdFx0c29ydGVyOnRoaXMuY2FsY3VsYXRlU29ydGVyRnJvbVZhbHVlKHZhbHVlKSxcblx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdGNvbHMuc3BsaWNlKGluZGV4LCAwLCBjb2wpO1xuXHRcdFx0XHRcdFx0Y29sbFByb2dyZXNzW2tleV0gPSB0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIgPyBjb2wgOiB0cnVlO1xuXHRcdFx0XHRcdH1lbHNlIGlmKGNvbGxQcm9ncmVzc1trZXldICE9PSB0cnVlKXtcblx0XHRcdFx0XHRcdGlmKHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRcdFx0XHRcdGNvbGxQcm9ncmVzc1trZXldLnNvcnRlciA9IHRoaXMuY2FsY3VsYXRlU29ydGVyRnJvbVZhbHVlKHZhbHVlKTtcblx0XHRcdFx0XHRcdFx0Y29sbFByb2dyZXNzW2tleV0gPSB0cnVlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0aWYoZGVmaW5pdGlvbnMpe1xuXHRcdFx0XHRcblx0XHRcdFx0c3dpdGNoKHR5cGVvZiBkZWZpbml0aW9ucyl7XG5cdFx0XHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucyA9IGRlZmluaXRpb25zLmNhbGwodGhpcy50YWJsZSwgY29scyk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRjYXNlIFwib2JqZWN0XCI6XG5cdFx0XHRcdFx0XHRpZihBcnJheS5pc0FycmF5KGRlZmluaXRpb25zKSl7XG5cdFx0XHRcdFx0XHRcdGNvbHMuZm9yRWFjaCgoY29sKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIG1hdGNoID0gZGVmaW5pdGlvbnMuZmluZCgoZGVmKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZGVmLmZpZWxkID09PSBjb2wuZmllbGQ7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdFx0aWYobWF0Y2gpe1xuXHRcdFx0XHRcdFx0XHRcdFx0T2JqZWN0LmFzc2lnbihjb2wsIG1hdGNoKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0Y29scy5mb3JFYWNoKChjb2wpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRpZihkZWZpbml0aW9uc1tjb2wuZmllbGRdKXtcblx0XHRcdFx0XHRcdFx0XHRcdE9iamVjdC5hc3NpZ24oY29sLCBkZWZpbml0aW9uc1tjb2wuZmllbGRdKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucyA9IGNvbHM7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucyA9IGNvbHM7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuc2V0Q29sdW1ucyh0aGlzLnRhYmxlLm9wdGlvbnMuY29sdW1ucyk7XG5cdFx0fVxuXHR9XG5cdFxuXHRjYWxjdWxhdGVTb3J0ZXJGcm9tVmFsdWUodmFsdWUpe1xuXHRcdHZhciBzb3J0ZXI7XG5cdFx0XG5cdFx0c3dpdGNoKHR5cGVvZiB2YWx1ZSl7XG5cdFx0XHRjYXNlIFwidW5kZWZpbmVkXCI6XG5cdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwiYm9vbGVhblwiOlxuXHRcdFx0XHRzb3J0ZXIgPSBcImJvb2xlYW5cIjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJudW1iZXJcIjpcblx0XHRcdFx0c29ydGVyID0gXCJudW1iZXJcIjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJvYmplY3RcIjpcblx0XHRcdFx0aWYoQXJyYXkuaXNBcnJheSh2YWx1ZSkpe1xuXHRcdFx0XHRcdHNvcnRlciA9IFwiYXJyYXlcIjtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGlmKCFpc05hTih2YWx1ZSkgJiYgdmFsdWUgIT09IFwiXCIpe1xuXHRcdFx0XHRcdHNvcnRlciA9IFwibnVtYmVyXCI7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRpZih2YWx1ZS5tYXRjaCgvKCheWzAtOV0rW2Etel0rKXwoXlthLXpdK1swLTldKykpKyQvaSkpe1xuXHRcdFx0XHRcdFx0c29ydGVyID0gXCJhbHBoYW51bVwiO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdHNvcnRlciA9IFwic3RyaW5nXCI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gc29ydGVyO1xuXHR9XG5cdFxuXHRzZXRDb2x1bW5zKGNvbHMsIHJvdyl7XG5cdFx0d2hpbGUodGhpcy5oZWFkZXJzRWxlbWVudC5maXJzdENoaWxkKSB0aGlzLmhlYWRlcnNFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuaGVhZGVyc0VsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XG5cdFx0dGhpcy5jb2x1bW5zID0gW107XG5cdFx0dGhpcy5jb2x1bW5zQnlJbmRleCA9IFtdO1xuXHRcdHRoaXMuY29sdW1uc0J5RmllbGQgPSB7fTtcblx0XHRcblx0XHR0aGlzLmRpc3BhdGNoKFwiY29sdW1ucy1sb2FkaW5nXCIpO1xuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImNvbHVtbnNMb2FkaW5nXCIpO1xuXHRcdFxuXHRcdGlmKHRoaXMudGFibGUub3B0aW9ucy5yb3dIZWFkZXIpe1xuXHRcdFx0dGhpcy5yb3dIZWFkZXIgPSBuZXcgQ29sdW1uKHRoaXMudGFibGUub3B0aW9ucy5yb3dIZWFkZXIgPT09IHRydWUgPyB7fSA6IHRoaXMudGFibGUub3B0aW9ucy5yb3dIZWFkZXIsIHRoaXMsIHRydWUpO1xuXHRcdFx0dGhpcy5jb2x1bW5zLnB1c2godGhpcy5yb3dIZWFkZXIpO1xuXHRcdFx0dGhpcy5oZWFkZXJzRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnJvd0hlYWRlci5nZXRFbGVtZW50KCkpO1xuXHRcdFx0dGhpcy5yb3dIZWFkZXIuY29sdW1uUmVuZGVyZWQoKTtcblx0XHR9XG5cdFx0XG5cdFx0Y29scy5mb3JFYWNoKChkZWYsIGkpID0+IHtcblx0XHRcdHRoaXMuX2FkZENvbHVtbihkZWYpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHRoaXMuX3JlSW5kZXhDb2x1bW5zKCk7XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaChcImNvbHVtbnMtbG9hZGVkXCIpO1xuXG5cdFx0aWYodGhpcy5zdWJzY3JpYmVkRXh0ZXJuYWwoXCJjb2x1bW5zTG9hZGVkXCIpKXtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImNvbHVtbnNMb2FkZWRcIiwgdGhpcy5nZXRDb21wb25lbnRzKCkpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLnJlcmVuZGVyQ29sdW1ucyhmYWxzZSwgdHJ1ZSk7XG5cdFx0XG5cdFx0dGhpcy5yZWRyYXcodHJ1ZSk7XG5cdH1cblx0XG5cdF9hZGRDb2x1bW4oZGVmaW5pdGlvbiwgYmVmb3JlLCBuZXh0VG9Db2x1bW4pe1xuXHRcdHZhciBjb2x1bW4gPSBuZXcgQ29sdW1uKGRlZmluaXRpb24sIHRoaXMpLFxuXHRcdGNvbEVsID0gY29sdW1uLmdldEVsZW1lbnQoKSxcblx0XHRpbmRleCA9IG5leHRUb0NvbHVtbiA/IHRoaXMuZmluZENvbHVtbkluZGV4KG5leHRUb0NvbHVtbikgOiBuZXh0VG9Db2x1bW47XG5cdFx0XG5cdFx0Ly9wcmV2ZW50IGFkZGluZyBvZiByb3dzIGluIGZyb250IG9mIHJvdyBoZWFkZXJcblx0XHRpZihiZWZvcmUgJiYgdGhpcy5yb3dIZWFkZXIgJiYgKCFuZXh0VG9Db2x1bW4gfHwgbmV4dFRvQ29sdW1uID09PSB0aGlzLnJvd0hlYWRlcikpe1xuXHRcdFx0YmVmb3JlID0gZmFsc2U7XG5cdFx0XHRuZXh0VG9Db2x1bW4gPSB0aGlzLnJvd0hlYWRlcjtcblx0XHRcdGluZGV4ID0gMDtcblx0XHR9XG5cdFx0XG5cdFx0aWYobmV4dFRvQ29sdW1uICYmIGluZGV4ID4gLTEpe1xuXHRcdFx0dmFyIHRvcENvbHVtbiA9IG5leHRUb0NvbHVtbi5nZXRUb3BDb2x1bW4oKTtcblx0XHRcdHZhciBwYXJlbnRJbmRleCA9IHRoaXMuY29sdW1ucy5pbmRleE9mKHRvcENvbHVtbik7XG5cdFx0XHR2YXIgbmV4dEVsID0gdG9wQ29sdW1uLmdldEVsZW1lbnQoKTtcblx0XHRcdFxuXHRcdFx0aWYoYmVmb3JlKXtcblx0XHRcdFx0dGhpcy5jb2x1bW5zLnNwbGljZShwYXJlbnRJbmRleCwgMCwgY29sdW1uKTtcblx0XHRcdFx0bmV4dEVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNvbEVsLCBuZXh0RWwpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLmNvbHVtbnMuc3BsaWNlKHBhcmVudEluZGV4ICsgMSwgMCwgY29sdW1uKTtcblx0XHRcdFx0bmV4dEVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNvbEVsLCBuZXh0RWwubmV4dFNpYmxpbmcpO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGlmKGJlZm9yZSl7XG5cdFx0XHRcdHRoaXMuY29sdW1ucy51bnNoaWZ0KGNvbHVtbik7XG5cdFx0XHRcdHRoaXMuaGVhZGVyc0VsZW1lbnQuaW5zZXJ0QmVmb3JlKGNvbHVtbi5nZXRFbGVtZW50KCksIHRoaXMuaGVhZGVyc0VsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuY29sdW1ucy5wdXNoKGNvbHVtbik7XG5cdFx0XHRcdHRoaXMuaGVhZGVyc0VsZW1lbnQuYXBwZW5kQ2hpbGQoY29sdW1uLmdldEVsZW1lbnQoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdGNvbHVtbi5jb2x1bW5SZW5kZXJlZCgpO1xuXHRcdFxuXHRcdHJldHVybiBjb2x1bW47XG5cdH1cblx0XG5cdHJlZ2lzdGVyQ29sdW1uRmllbGQoY29sKXtcblx0XHRpZihjb2wuZGVmaW5pdGlvbi5maWVsZCl7XG5cdFx0XHR0aGlzLmNvbHVtbnNCeUZpZWxkW2NvbC5kZWZpbml0aW9uLmZpZWxkXSA9IGNvbDtcblx0XHR9XG5cdH1cblx0XG5cdHJlZ2lzdGVyQ29sdW1uUG9zaXRpb24oY29sKXtcblx0XHR0aGlzLmNvbHVtbnNCeUluZGV4LnB1c2goY29sKTtcblx0fVxuXHRcblx0X3JlSW5kZXhDb2x1bW5zKCl7XG5cdFx0dGhpcy5jb2x1bW5zQnlJbmRleCA9IFtdO1xuXHRcdFxuXHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0XHRjb2x1bW4ucmVSZWdpc3RlclBvc2l0aW9uKCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdC8vZW5zdXJlIGNvbHVtbiBoZWFkZXJzIHRha2UgdXAgdGhlIGNvcnJlY3QgYW1vdW50IG9mIHNwYWNlIGluIGNvbHVtbiBncm91cHNcblx0dmVydGljYWxBbGlnbkhlYWRlcnMoKXtcblx0XHR2YXIgbWluSGVpZ2h0ID0gMDtcblx0XHRcblx0XHRpZighdGhpcy5yZWRyYXdCbG9jayl7XG5cdFx0XHRcblx0XHRcdHRoaXMuaGVhZGVyc0VsZW1lbnQuc3R5bGUuaGVpZ2h0PVwiXCI7XG5cdFx0XHRcblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdFx0Y29sdW1uLmNsZWFyVmVydGljYWxBbGlnbigpO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdFx0dmFyIGhlaWdodCA9IGNvbHVtbi5nZXRIZWlnaHQoKTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKGhlaWdodCA+IG1pbkhlaWdodCl7XG5cdFx0XHRcdFx0bWluSGVpZ2h0ID0gaGVpZ2h0O1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5oZWFkZXJzRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBtaW5IZWlnaHQgKyBcInB4XCI7XG5cdFx0XHRcblx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdFx0Y29sdW1uLnZlcnRpY2FsQWxpZ24odGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkhlYWRlclZlcnRBbGlnbiwgbWluSGVpZ2h0KTtcblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vIENvbHVtbiBEZXRhaWxzIC8vLy8vLy8vLy8vLy8vLy8vXG5cdGZpbmRDb2x1bW4oc3ViamVjdCl7XG5cdFx0dmFyIGNvbHVtbnM7XG5cdFx0XG5cdFx0aWYodHlwZW9mIHN1YmplY3QgPT0gXCJvYmplY3RcIil7XG5cdFx0XHRcblx0XHRcdGlmKHN1YmplY3QgaW5zdGFuY2VvZiBDb2x1bW4pe1xuXHRcdFx0XHQvL3N1YmplY3QgaXMgY29sdW1uIGVsZW1lbnRcblx0XHRcdFx0cmV0dXJuIHN1YmplY3Q7XG5cdFx0XHR9ZWxzZSBpZihzdWJqZWN0IGluc3RhbmNlb2YgQ29sdW1uQ29tcG9uZW50KXtcblx0XHRcdFx0Ly9zdWJqZWN0IGlzIHB1YmxpYyBjb2x1bW4gY29tcG9uZW50XG5cdFx0XHRcdHJldHVybiBzdWJqZWN0Ll9nZXRTZWxmKCkgfHwgZmFsc2U7XG5cdFx0XHR9ZWxzZSBpZih0eXBlb2YgSFRNTEVsZW1lbnQgIT09IFwidW5kZWZpbmVkXCIgJiYgc3ViamVjdCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KXtcblx0XHRcdFx0XG5cdFx0XHRcdGNvbHVtbnMgPSBbXTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdFx0XHRjb2x1bW5zLnB1c2goY29sdW1uKTtcblx0XHRcdFx0XHRjb2x1bW5zID0gY29sdW1ucy5jb25jYXQoY29sdW1uLmdldENvbHVtbnModHJ1ZSkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdC8vc3ViamVjdCBpcyBhIEhUTUwgZWxlbWVudCBvZiB0aGUgY29sdW1uIGhlYWRlclxuXHRcdFx0XHRsZXQgbWF0Y2ggPSBjb2x1bW5zLmZpbmQoKGNvbHVtbikgPT4ge1xuXHRcdFx0XHRcdHJldHVybiBjb2x1bW4uZWxlbWVudCA9PT0gc3ViamVjdDtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRyZXR1cm4gbWF0Y2ggfHwgZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHR9ZWxzZSB7XG5cdFx0XHQvL3N1YmplY3Qgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgdGhlIGZpZWxkIG5hbWUgb2YgdGhlIGNvbHVtblxuXHRcdFx0cmV0dXJuIHRoaXMuY29sdW1uc0J5RmllbGRbc3ViamVjdF0gfHwgZmFsc2U7XG5cdFx0fVxuXHRcdFxuXHRcdC8vY2F0Y2ggYWxsIGZvciBhbnkgb3RoZXIgdHlwZSBvZiBpbnB1dFxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRcblx0Z2V0Q29sdW1uQnlGaWVsZChmaWVsZCl7XG5cdFx0cmV0dXJuIHRoaXMuY29sdW1uc0J5RmllbGRbZmllbGRdO1xuXHR9XG5cdFxuXHRnZXRDb2x1bW5zQnlGaWVsZFJvb3Qocm9vdCl7XG5cdFx0dmFyIG1hdGNoZXMgPSBbXTtcblx0XHRcblx0XHRPYmplY3Qua2V5cyh0aGlzLmNvbHVtbnNCeUZpZWxkKS5mb3JFYWNoKChmaWVsZCkgPT4ge1xuXHRcdFx0dmFyIGZpZWxkUm9vdCA9IHRoaXMudGFibGUub3B0aW9ucy5uZXN0ZWRGaWVsZFNlcGFyYXRvciA/IGZpZWxkLnNwbGl0KHRoaXMudGFibGUub3B0aW9ucy5uZXN0ZWRGaWVsZFNlcGFyYXRvcilbMF0gOiBmaWVsZDtcblx0XHRcdGlmKGZpZWxkUm9vdCA9PT0gcm9vdCl7XG5cdFx0XHRcdG1hdGNoZXMucHVzaCh0aGlzLmNvbHVtbnNCeUZpZWxkW2ZpZWxkXSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIG1hdGNoZXM7XG5cdH1cblx0XG5cdGdldENvbHVtbkJ5SW5kZXgoaW5kZXgpe1xuXHRcdHJldHVybiB0aGlzLmNvbHVtbnNCeUluZGV4W2luZGV4XTtcblx0fVxuXHRcblx0Z2V0Rmlyc3RWaXNpYmxlQ29sdW1uKCl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy5jb2x1bW5zQnlJbmRleC5maW5kSW5kZXgoKGNvbCkgPT4ge1xuXHRcdFx0cmV0dXJuIGNvbC52aXNpYmxlO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBpbmRleCA+IC0xID8gdGhpcy5jb2x1bW5zQnlJbmRleFtpbmRleF0gOiBmYWxzZTtcblx0fVxuXHRcblx0Z2V0VmlzaWJsZUNvbHVtbnNCeUluZGV4KCkge1xuXHRcdHJldHVybiB0aGlzLmNvbHVtbnNCeUluZGV4LmZpbHRlcigoY29sKSA9PiBjb2wudmlzaWJsZSk7XG5cdH1cblx0XG5cdGdldENvbHVtbnMoKXtcblx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zO1xuXHR9XG5cdFxuXHRmaW5kQ29sdW1uSW5kZXgoY29sdW1uKXtcblx0XHRyZXR1cm4gdGhpcy5jb2x1bW5zQnlJbmRleC5maW5kSW5kZXgoKGNvbCkgPT4ge1xuXHRcdFx0cmV0dXJuIGNvbHVtbiA9PT0gY29sO1xuXHRcdH0pO1xuXHR9XG5cdFxuXHQvL3JldHVybiBhbGwgY29sdW1ucyB0aGF0IGFyZSBub3QgZ3JvdXBzXG5cdGdldFJlYWxDb2x1bW5zKCl7XG5cdFx0cmV0dXJuIHRoaXMuY29sdW1uc0J5SW5kZXg7XG5cdH1cblx0XG5cdC8vdHJhdmVyc2UgYWNyb3NzIGNvbHVtbnMgYW5kIGNhbGwgYWN0aW9uXG5cdHRyYXZlcnNlKGNhbGxiYWNrKXtcblx0XHR0aGlzLmNvbHVtbnNCeUluZGV4LmZvckVhY2goKGNvbHVtbixpKSA9Pntcblx0XHRcdGNhbGxiYWNrKGNvbHVtbiwgaSk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdC8vZ2V0IGRlZmluaXRpb25zIG9mIGFjdHVhbCBjb2x1bW5zXG5cdGdldERlZmluaXRpb25zKGFjdGl2ZSl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXHRcdFxuXHRcdHRoaXMuY29sdW1uc0J5SW5kZXguZm9yRWFjaCgoY29sdW1uKSA9PiB7XG5cdFx0XHRpZighYWN0aXZlIHx8IChhY3RpdmUgJiYgY29sdW1uLnZpc2libGUpKXtcblx0XHRcdFx0b3V0cHV0LnB1c2goY29sdW1uLmdldERlZmluaXRpb24oKSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXHRcblx0Ly9nZXQgZnVsbCBuZXN0ZWQgZGVmaW5pdGlvbiB0cmVlXG5cdGdldERlZmluaXRpb25UcmVlKCl7XG5cdFx0dmFyIG91dHB1dCA9IFtdO1xuXHRcdFxuXHRcdHRoaXMuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdG91dHB1dC5wdXNoKGNvbHVtbi5nZXREZWZpbml0aW9uKHRydWUpKTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHRnZXRDb21wb25lbnRzKHN0cnVjdHVyZWQpe1xuXHRcdHZhciBvdXRwdXQgPSBbXSxcblx0XHRjb2x1bW5zID0gc3RydWN0dXJlZCA/IHRoaXMuY29sdW1ucyA6IHRoaXMuY29sdW1uc0J5SW5kZXg7XG5cdFx0XG5cdFx0Y29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcblx0XHRcdG91dHB1dC5wdXNoKGNvbHVtbi5nZXRDb21wb25lbnQoKSk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXHRcblx0Z2V0V2lkdGgoKXtcblx0XHR2YXIgd2lkdGggPSAwO1xuXHRcdFxuXHRcdHRoaXMuY29sdW1uc0J5SW5kZXguZm9yRWFjaCgoY29sdW1uKSA9PiB7XG5cdFx0XHRpZihjb2x1bW4udmlzaWJsZSl7XG5cdFx0XHRcdHdpZHRoICs9IGNvbHVtbi5nZXRXaWR0aCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiB3aWR0aDtcblx0fVxuXHRcblx0bW92ZUNvbHVtbihmcm9tLCB0bywgYWZ0ZXIpe1xuXHRcdHRvLmVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZnJvbS5lbGVtZW50LCB0by5lbGVtZW50KTtcblx0XHRcblx0XHRpZihhZnRlcil7XG5cdFx0XHR0by5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRvLmVsZW1lbnQsIGZyb20uZWxlbWVudCk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMubW92ZUNvbHVtbkFjdHVhbChmcm9tLCB0bywgYWZ0ZXIpO1xuXHRcdFxuXHRcdHRoaXMudmVydGljYWxBbGlnbkhlYWRlcnMoKTtcblx0XHRcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVpbml0aWFsaXplKCk7XG5cdH1cblx0XG5cdG1vdmVDb2x1bW5BY3R1YWwoZnJvbSwgdG8sIGFmdGVyKXtcblx0XHRpZihmcm9tLnBhcmVudC5pc0dyb3VwKXtcblx0XHRcdHRoaXMuX21vdmVDb2x1bW5JbkFycmF5KGZyb20ucGFyZW50LmNvbHVtbnMsIGZyb20sIHRvLCBhZnRlcik7XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5fbW92ZUNvbHVtbkluQXJyYXkodGhpcy5jb2x1bW5zLCBmcm9tLCB0bywgYWZ0ZXIpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLl9tb3ZlQ29sdW1uSW5BcnJheSh0aGlzLmNvbHVtbnNCeUluZGV4LCBmcm9tLCB0bywgYWZ0ZXIsIHRydWUpO1xuXHRcdFxuXHRcdHRoaXMucmVyZW5kZXJDb2x1bW5zKHRydWUpO1xuXHRcdFxuXHRcdHRoaXMuZGlzcGF0Y2goXCJjb2x1bW4tbW92ZWRcIiwgZnJvbSwgdG8sIGFmdGVyKTtcblx0XHRcblx0XHRpZih0aGlzLnN1YnNjcmliZWRFeHRlcm5hbChcImNvbHVtbk1vdmVkXCIpKXtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImNvbHVtbk1vdmVkXCIsIGZyb20uZ2V0Q29tcG9uZW50KCksIHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRDb21wb25lbnRzKCkpO1xuXHRcdH1cblx0fVxuXHRcblx0X21vdmVDb2x1bW5JbkFycmF5KGNvbHVtbnMsIGZyb20sIHRvLCBhZnRlciwgdXBkYXRlUm93cyl7XG5cdFx0dmFyXHRmcm9tSW5kZXggPSBjb2x1bW5zLmluZGV4T2YoZnJvbSksXG5cdFx0dG9JbmRleCwgcm93cyA9IFtdO1xuXHRcdFxuXHRcdGlmIChmcm9tSW5kZXggPiAtMSkge1xuXHRcdFx0XG5cdFx0XHRjb2x1bW5zLnNwbGljZShmcm9tSW5kZXgsIDEpO1xuXHRcdFx0XG5cdFx0XHR0b0luZGV4ID0gY29sdW1ucy5pbmRleE9mKHRvKTtcblx0XHRcdFxuXHRcdFx0aWYgKHRvSW5kZXggPiAtMSkge1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoYWZ0ZXIpe1xuXHRcdFx0XHRcdHRvSW5kZXggPSB0b0luZGV4KzE7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRvSW5kZXggPSBmcm9tSW5kZXg7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGNvbHVtbnMuc3BsaWNlKHRvSW5kZXgsIDAsIGZyb20pO1xuXHRcdFx0XG5cdFx0XHRpZih1cGRhdGVSb3dzKXtcblx0XHRcdFx0XG5cdFx0XHRcdHJvd3MgPSB0aGlzLmNoYWluKFwiY29sdW1uLW1vdmluZy1yb3dzXCIsIFtmcm9tLCB0bywgYWZ0ZXJdLCBudWxsLCBbXSkgfHwgW107XG5cdFx0XHRcdFxuXHRcdFx0XHRyb3dzID0gcm93cy5jb25jYXQodGhpcy50YWJsZS5yb3dNYW5hZ2VyLnJvd3MpO1xuXHRcdFx0XHRcblx0XHRcdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHRcdFx0aWYocm93LmNlbGxzLmxlbmd0aCl7XG5cdFx0XHRcdFx0XHR2YXIgY2VsbCA9IHJvdy5jZWxscy5zcGxpY2UoZnJvbUluZGV4LCAxKVswXTtcblx0XHRcdFx0XHRcdHJvdy5jZWxscy5zcGxpY2UodG9JbmRleCwgMCwgY2VsbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRzY3JvbGxUb0NvbHVtbihjb2x1bW4sIHBvc2l0aW9uLCBpZlZpc2libGUpe1xuXHRcdHZhciBsZWZ0ID0gMCxcblx0XHRvZmZzZXQgPSBjb2x1bW4uZ2V0TGVmdE9mZnNldCgpLFxuXHRcdGFkanVzdCA9IDAsXG5cdFx0Y29sRWwgPSBjb2x1bW4uZ2V0RWxlbWVudCgpO1xuXHRcdFxuXHRcdFxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcblx0XHRcdGlmKHR5cGVvZiBwb3NpdGlvbiA9PT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRcdHBvc2l0aW9uID0gdGhpcy50YWJsZS5vcHRpb25zLnNjcm9sbFRvQ29sdW1uUG9zaXRpb247XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHR5cGVvZiBpZlZpc2libGUgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0XHRpZlZpc2libGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMuc2Nyb2xsVG9Db2x1bW5JZlZpc2libGU7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKGNvbHVtbi52aXNpYmxlKXtcblx0XHRcdFx0XG5cdFx0XHRcdC8vYWxpZ24gdG8gY29ycmVjdCBwb3NpdGlvblxuXHRcdFx0XHRzd2l0Y2gocG9zaXRpb24pe1xuXHRcdFx0XHRcdGNhc2UgXCJtaWRkbGVcIjpcblx0XHRcdFx0XHRjYXNlIFwiY2VudGVyXCI6XG5cdFx0XHRcdFx0XHRhZGp1c3QgPSAtdGhpcy5lbGVtZW50LmNsaWVudFdpZHRoIC8gMjtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGNhc2UgXCJyaWdodFwiOlxuXHRcdFx0XHRcdFx0YWRqdXN0ID0gY29sRWwuY2xpZW50V2lkdGggLSB0aGlzLmhlYWRlcnNFbGVtZW50LmNsaWVudFdpZHRoO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdC8vY2hlY2sgY29sdW1uIHZpc2liaWxpdHlcblx0XHRcdFx0aWYoIWlmVmlzaWJsZSl7XG5cdFx0XHRcdFx0aWYob2Zmc2V0ID4gMCAmJiBvZmZzZXQgKyBjb2xFbC5vZmZzZXRXaWR0aCA8IHRoaXMuZWxlbWVudC5jbGllbnRXaWR0aCl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHQvL2NhbGN1bGF0ZSBzY3JvbGwgcG9zaXRpb25cblx0XHRcdFx0bGVmdCA9IG9mZnNldCArIGFkanVzdDtcblx0XHRcdFx0XG5cdFx0XHRcdGxlZnQgPSBNYXRoLm1heChNYXRoLm1pbihsZWZ0LCB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5zY3JvbGxXaWR0aCAtIHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudFdpZHRoKSwwKTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5zY3JvbGxIb3Jpem9udGFsKGxlZnQpO1xuXHRcdFx0XHR0aGlzLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdFx0XHRcdFxuXHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIlNjcm9sbCBFcnJvciAtIENvbHVtbiBub3QgdmlzaWJsZVwiKTtcblx0XHRcdFx0cmVqZWN0KFwiU2Nyb2xsIEVycm9yIC0gQ29sdW1uIG5vdCB2aXNpYmxlXCIpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0fSk7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8gQ2VsbCBNYW5hZ2VtZW50IC8vLy8vLy8vLy8vLy8vLy8vXG5cdGdlbmVyYXRlQ2VsbHMocm93KXtcblx0XHR2YXIgY2VsbHMgPSBbXTtcblx0XHRcblx0XHR0aGlzLmNvbHVtbnNCeUluZGV4LmZvckVhY2goKGNvbHVtbikgPT4ge1xuXHRcdFx0Y2VsbHMucHVzaChjb2x1bW4uZ2VuZXJhdGVDZWxsKHJvdykpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHJldHVybiBjZWxscztcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLyBDb2x1bW4gTWFuYWdlbWVudCAvLy8vLy8vLy8vLy8vLy8vL1xuXHRnZXRGbGV4QmFzZVdpZHRoKCl7XG5cdFx0dmFyIHRvdGFsV2lkdGggPSB0aGlzLnRhYmxlLmVsZW1lbnQuY2xpZW50V2lkdGgsIC8vdGFibGUgZWxlbWVudCB3aWR0aFxuXHRcdGZpeGVkV2lkdGggPSAwO1xuXHRcdFxuXHRcdC8vYWRqdXN0IGZvciB2ZXJ0aWNhbCBzY3JvbGxiYXIgaWYgcHJlc2VudFxuXHRcdGlmKHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbEhlaWdodCA+IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudEhlaWdodCl7XG5cdFx0XHR0b3RhbFdpZHRoIC09IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50Lm9mZnNldFdpZHRoIC0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50V2lkdGg7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuY29sdW1uc0J5SW5kZXguZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pe1xuXHRcdFx0dmFyIHdpZHRoLCBtaW5XaWR0aCwgY29sV2lkdGg7XG5cdFx0XHRcblx0XHRcdGlmKGNvbHVtbi52aXNpYmxlKXtcblx0XHRcdFx0XG5cdFx0XHRcdHdpZHRoID0gY29sdW1uLmRlZmluaXRpb24ud2lkdGggfHwgMDtcblx0XHRcdFx0XG5cdFx0XHRcdG1pbldpZHRoID0gcGFyc2VJbnQoY29sdW1uLm1pbldpZHRoKTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKHR5cGVvZih3aWR0aCkgPT0gXCJzdHJpbmdcIil7XG5cdFx0XHRcdFx0aWYod2lkdGguaW5kZXhPZihcIiVcIikgPiAtMSl7XG5cdFx0XHRcdFx0XHRjb2xXaWR0aCA9ICh0b3RhbFdpZHRoIC8gMTAwKSAqIHBhcnNlSW50KHdpZHRoKSA7XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0Y29sV2lkdGggPSBwYXJzZUludCh3aWR0aCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29sV2lkdGggPSB3aWR0aDtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0Zml4ZWRXaWR0aCArPSBjb2xXaWR0aCA+IG1pbldpZHRoID8gY29sV2lkdGggOiBtaW5XaWR0aDtcblx0XHRcdFx0XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIGZpeGVkV2lkdGg7XG5cdH1cblx0XG5cdGFkZENvbHVtbihkZWZpbml0aW9uLCBiZWZvcmUsIG5leHRUb0NvbHVtbil7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdHZhciBjb2x1bW4gPSB0aGlzLl9hZGRDb2x1bW4oZGVmaW5pdGlvbiwgYmVmb3JlLCBuZXh0VG9Db2x1bW4pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLl9yZUluZGV4Q29sdW1ucygpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmRpc3BhdGNoKFwiY29sdW1uLWFkZFwiLCBkZWZpbml0aW9uLCBiZWZvcmUsIG5leHRUb0NvbHVtbik7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMubGF5b3V0TW9kZSgpICE9IFwiZml0Q29sdW1uc1wiKXtcblx0XHRcdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMucmVkcmF3KHRydWUpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVpbml0aWFsaXplKCk7XG5cdFx0XHRcblx0XHRcdHRoaXMucmVyZW5kZXJDb2x1bW5zKCk7XG5cdFx0XHRcblx0XHRcdHJlc29sdmUoY29sdW1uKTtcblx0XHR9KTtcblx0fVxuXHRcblx0Ly9yZW1vdmUgY29sdW1uIGZyb20gc3lzdGVtXG5cdGRlcmVnaXN0ZXJDb2x1bW4oY29sdW1uKXtcblx0XHR2YXIgZmllbGQgPSBjb2x1bW4uZ2V0RmllbGQoKSxcblx0XHRpbmRleDtcblx0XHRcblx0XHQvL3JlbW92ZSBmcm9tIGZpZWxkIGxpc3Rcblx0XHRpZihmaWVsZCl7XG5cdFx0XHRkZWxldGUgdGhpcy5jb2x1bW5zQnlGaWVsZFtmaWVsZF07XG5cdFx0fVxuXHRcdFxuXHRcdC8vcmVtb3ZlIGZyb20gaW5kZXggbGlzdFxuXHRcdGluZGV4ID0gdGhpcy5jb2x1bW5zQnlJbmRleC5pbmRleE9mKGNvbHVtbik7XG5cdFx0XG5cdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHR0aGlzLmNvbHVtbnNCeUluZGV4LnNwbGljZShpbmRleCwgMSk7XG5cdFx0fVxuXHRcdFxuXHRcdC8vcmVtb3ZlIGZyb20gY29sdW1uIGxpc3Rcblx0XHRpbmRleCA9IHRoaXMuY29sdW1ucy5pbmRleE9mKGNvbHVtbik7XG5cdFx0XG5cdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHR0aGlzLmNvbHVtbnMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy52ZXJ0aWNhbEFsaWduSGVhZGVycygpO1xuXHRcdFxuXHRcdHRoaXMucmVkcmF3KCk7XG5cdH1cblx0XG5cdHJlcmVuZGVyQ29sdW1ucyh1cGRhdGUsIHNpbGVudCl7XG5cdFx0aWYoIXRoaXMucmVkcmF3QmxvY2spe1xuXHRcdFx0dGhpcy5yZW5kZXJlci5yZXJlbmRlckNvbHVtbnModXBkYXRlLCBzaWxlbnQpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHVwZGF0ZSA9PT0gZmFsc2UgfHwgKHVwZGF0ZSA9PT0gdHJ1ZSAmJiB0aGlzLnJlZHJhd0Jsb2NrVXBkYXRlID09PSBudWxsKSl7XG5cdFx0XHRcdHRoaXMucmVkcmF3QmxvY2tVcGRhdGUgPSB1cGRhdGU7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRibG9ja1JlZHJhdygpe1xuXHRcdHRoaXMucmVkcmF3QmxvY2sgPSB0cnVlO1xuXHRcdHRoaXMucmVkcmF3QmxvY2tVcGRhdGUgPSBudWxsO1xuXHR9XG5cdFxuXHRyZXN0b3JlUmVkcmF3KCl7XG5cdFx0dGhpcy5yZWRyYXdCbG9jayA9IGZhbHNlO1xuXHRcdHRoaXMudmVydGljYWxBbGlnbkhlYWRlcnMoKTtcblx0XHR0aGlzLnJlbmRlcmVyLnJlcmVuZGVyQ29sdW1ucyh0aGlzLnJlZHJhd0Jsb2NrVXBkYXRlKTtcblx0XHRcblx0fVxuXHRcblx0Ly9yZWRyYXcgY29sdW1uc1xuXHRyZWRyYXcoZm9yY2Upe1xuXHRcdGlmKEhlbHBlcnMuZWxWaXNpYmxlKHRoaXMuZWxlbWVudCkpe1xuXHRcdFx0dGhpcy52ZXJ0aWNhbEFsaWduSGVhZGVycygpO1xuXHRcdH1cblx0XHRcblx0XHRpZihmb3JjZSl7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIucmVzZXRTY3JvbGwoKTtcblx0XHRcdHRoaXMudGFibGUucm93TWFuYWdlci5yZWluaXRpYWxpemUoKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoIXRoaXMuY29uZmlybShcInRhYmxlLXJlZHJhd2luZ1wiLCBmb3JjZSkpe1xuXHRcdFx0dGhpcy5sYXlvdXRSZWZyZXNoKGZvcmNlKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaChcInRhYmxlLXJlZHJhd1wiLCBmb3JjZSk7XG5cdFx0XG5cdFx0dGhpcy50YWJsZS5mb290ZXJNYW5hZ2VyLnJlZHJhdygpO1xuXHR9XG59XG5cbmNsYXNzIEJhc2ljVmVydGljYWwgZXh0ZW5kcyBSZW5kZXJlcntcblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblx0XHRcblx0XHR0aGlzLnZlcnRpY2FsRmlsbE1vZGUgPSBcImZpbGxcIjtcblx0XHRcblx0XHR0aGlzLnNjcm9sbFRvcCA9IDA7XG5cdFx0dGhpcy5zY3JvbGxMZWZ0ID0gMDtcblx0XHRcblx0XHR0aGlzLnNjcm9sbFRvcCA9IDA7XG5cdFx0dGhpcy5zY3JvbGxMZWZ0ID0gMDtcblx0fVxuXHRcblx0Y2xlYXJSb3dzKCl7XG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLnRhYmxlRWxlbWVudDtcblx0XHRcblx0XHQvLyBlbGVtZW50LmNoaWxkcmVuLmRldGFjaCgpO1xuXHRcdHdoaWxlKGVsZW1lbnQuZmlyc3RDaGlsZCkgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdFxuXHRcdGVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcblx0XHRlbGVtZW50LnNjcm9sbExlZnQgPSAwO1xuXHRcdFxuXHRcdGVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBcIlwiO1xuXHRcdGVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gXCJcIjtcblx0XHRlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuXHRcdGVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9IFwiXCI7XG5cdH1cblx0XG5cdHJlbmRlclJvd3MoKSB7XG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLnRhYmxlRWxlbWVudCxcblx0XHRvbmx5R3JvdXBIZWFkZXJzID0gdHJ1ZSxcblx0XHR0YWJsZUZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksXG5cdFx0cm93cyA9IHRoaXMucm93cygpO1xuXHRcdFxuXHRcdHJvd3MuZm9yRWFjaCgocm93LCBpbmRleCkgPT4ge1xuXHRcdFx0dGhpcy5zdHlsZVJvdyhyb3csIGluZGV4KTtcblx0XHRcdHJvdy5pbml0aWFsaXplKGZhbHNlLCB0cnVlKTtcblx0XHRcdFxuXHRcdFx0aWYgKHJvdy50eXBlICE9PSBcImdyb3VwXCIpIHtcblx0XHRcdFx0b25seUdyb3VwSGVhZGVycyA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0YWJsZUZyYWcuYXBwZW5kQ2hpbGQocm93LmdldEVsZW1lbnQoKSk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0ZWxlbWVudC5hcHBlbmRDaGlsZCh0YWJsZUZyYWcpO1xuXHRcdFxuXHRcdHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRyb3cucmVuZGVyZWQoKTtcblx0XHRcdFxuXHRcdFx0aWYoIXJvdy5oZWlnaHRJbml0aWFsaXplZCkge1xuXHRcdFx0XHRyb3cuY2FsY0hlaWdodCh0cnVlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRcblx0XHRyb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0aWYoIXJvdy5oZWlnaHRJbml0aWFsaXplZCkge1xuXHRcdFx0XHRyb3cuc2V0Q2VsbEhlaWdodCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdFxuXHRcdGlmKG9ubHlHcm91cEhlYWRlcnMpe1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpICsgXCJweFwiO1xuXHRcdH1lbHNlIHtcblx0XHRcdGVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBcIlwiO1xuXHRcdH1cblx0fVxuXHRcblx0XG5cdHJlcmVuZGVyUm93cyhjYWxsYmFjayl7XHRcblx0XHR0aGlzLmNsZWFyUm93cygpO1xuXHRcdFxuXHRcdGlmKGNhbGxiYWNrKXtcblx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMucmVuZGVyUm93cygpO1xuXG5cdFx0aWYoIXRoaXMucm93cygpLmxlbmd0aCl7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIudGFibGVFbXB0eSgpO1xuXHRcdH1cblx0fVxuXHRcblx0c2Nyb2xsVG9Sb3dOZWFyZXN0VG9wKHJvdyl7XG5cdFx0dmFyIHJvd1RvcCA9IEhlbHBlcnMuZWxPZmZzZXQocm93LmdldEVsZW1lbnQoKSkudG9wO1xuXHRcdFxuXHRcdHJldHVybiAhKE1hdGguYWJzKHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCAtIHJvd1RvcCkgPiBNYXRoLmFicyh0aGlzLmVsZW1lbnRWZXJ0aWNhbC5zY3JvbGxUb3AgKyB0aGlzLmVsZW1lbnRWZXJ0aWNhbC5jbGllbnRIZWlnaHQgLSByb3dUb3ApKTtcblx0fVxuXHRcblx0c2Nyb2xsVG9Sb3cocm93KXtcblx0XHR2YXIgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXHRcdFxuXHRcdHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCA9IEhlbHBlcnMuZWxPZmZzZXQocm93RWwpLnRvcCAtIEhlbHBlcnMuZWxPZmZzZXQodGhpcy5lbGVtZW50VmVydGljYWwpLnRvcCArIHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcDtcblx0fVxuXHRcblx0dmlzaWJsZVJvd3MoaW5jbHVkaW5nQnVmZmVyKXtcblx0XHRyZXR1cm4gdGhpcy5yb3dzKCk7XG5cdH1cblx0XG59XG5cbmNsYXNzIFZpcnR1YWxEb21WZXJ0aWNhbCBleHRlbmRzIFJlbmRlcmVye1xuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXG5cdFx0dGhpcy52ZXJ0aWNhbEZpbGxNb2RlID0gXCJmaWxsXCI7XG5cblx0XHR0aGlzLnNjcm9sbFRvcCA9IDA7XG5cdFx0dGhpcy5zY3JvbGxMZWZ0ID0gMDtcblxuXHRcdHRoaXMudkRvbVJvd0hlaWdodCA9IDIwOyAvL2FwcHJveGltYXRpb24gb2Ygcm93IGhlaWdodHMgZm9yIHBhZGRpbmdcblxuXHRcdHRoaXMudkRvbVRvcCA9IDA7IC8vaG9sZCBwb3NpdGlvbiBmb3IgZmlyc3QgcmVuZGVyZWQgcm93IGluIHRoZSB2aXJ0dWFsIERPTVxuXHRcdHRoaXMudkRvbUJvdHRvbSA9IDA7IC8vaG9sZCBwb3NpdGlvbiBmb3IgbGFzdCByZW5kZXJlZCByb3cgaW4gdGhlIHZpcnR1YWwgRE9NXG5cblx0XHR0aGlzLnZEb21TY3JvbGxQb3NUb3AgPSAwOyAvL2xhc3Qgc2Nyb2xsIHBvc2l0aW9uIG9mIHRoZSB2RG9tIHRvcDtcblx0XHR0aGlzLnZEb21TY3JvbGxQb3NCb3R0b20gPSAwOyAvL2xhc3Qgc2Nyb2xsIHBvc2l0aW9uIG9mIHRoZSB2RG9tIGJvdHRvbTtcblxuXHRcdHRoaXMudkRvbVRvcFBhZCA9IDA7IC8vaG9sZCB2YWx1ZSBvZiBwYWRkaW5nIGZvciB0b3Agb2YgdmlydHVhbCBET01cblx0XHR0aGlzLnZEb21Cb3R0b21QYWQgPSAwOyAvL2hvbGQgdmFsdWUgb2YgcGFkZGluZyBmb3IgYm90dG9tIG9mIHZpcnR1YWwgRE9NXG5cblx0XHR0aGlzLnZEb21NYXhSZW5kZXJDaGFpbiA9IDkwOyAvL3RoZSBtYXhpbXVtIG51bWJlciBvZiBkb20gZWxlbWVudHMgdGhhdCBjYW4gYmUgcmVuZGVyZWQgaW4gMSBnb1xuXG5cdFx0dGhpcy52RG9tV2luZG93QnVmZmVyID0gMDsgLy93aW5kb3cgcm93IGJ1ZmZlciBiZWZvcmUgcmVtb3ZpbmcgZWxlbWVudHMsIHRvIHNtb290aCBzY3JvbGxpbmdcblxuXHRcdHRoaXMudkRvbVdpbmRvd01pblRvdGFsUm93cyA9IDIwOyAvL21pbmltdW0gbnVtYmVyIG9mIHJvd3MgdG8gYmUgZ2VuZXJhdGVkIGluIHZpcnR1YWwgZG9tIChwcmV2ZW50IGJ1ZmZlcmluZyBpc3N1ZXMgb24gdGFibGVzIHdpdGggdGFsbCByb3dzKVxuXHRcdHRoaXMudkRvbVdpbmRvd01pbk1hcmdpblJvd3MgPSA1OyAvL21pbmltdW0gbnVtYmVyIG9mIHJvd3MgdG8gYmUgZ2VuZXJhdGVkIGluIHZpcnR1YWwgZG9tIG1hcmdpblxuXG5cdFx0dGhpcy52RG9tVG9wTmV3Um93cyA9IFtdOyAvL3Jvd3MgdG8gbm9ybWFsaXplIGFmdGVyIGFwcGVuZGluZyB0byBvcHRpbWl6ZSByZW5kZXIgc3BlZWRcblx0XHR0aGlzLnZEb21Cb3R0b21OZXdSb3dzID0gW107IC8vcm93cyB0byBub3JtYWxpemUgYWZ0ZXIgYXBwZW5kaW5nIHRvIG9wdGltaXplIHJlbmRlciBzcGVlZFxuXHR9XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vIFB1YmxpYyBGdW5jdGlvbnMgLy8vLy8vLy8vLy9cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRjbGVhclJvd3MoKXtcblx0XHR2YXIgZWxlbWVudCA9IHRoaXMudGFibGVFbGVtZW50O1xuXG5cdFx0Ly8gZWxlbWVudC5jaGlsZHJlbi5kZXRhY2goKTtcblx0XHR3aGlsZShlbGVtZW50LmZpcnN0Q2hpbGQpIGVsZW1lbnQucmVtb3ZlQ2hpbGQoZWxlbWVudC5maXJzdENoaWxkKTtcblxuXHRcdGVsZW1lbnQuc3R5bGUucGFkZGluZ1RvcCA9IFwiXCI7XG5cdFx0ZWxlbWVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gXCJcIjtcblx0XHRlbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IFwiXCI7XG5cdFx0ZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcblx0XHRlbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSBcIlwiO1xuXG5cdFx0dGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsVG9wID0gMDtcblx0XHR0aGlzLmVsZW1lbnRWZXJ0aWNhbC5zY3JvbGxMZWZ0ID0gMDtcblxuXHRcdHRoaXMuc2Nyb2xsVG9wID0gMDtcblx0XHR0aGlzLnNjcm9sbExlZnQgPSAwO1xuXG5cdFx0dGhpcy52RG9tVG9wID0gMDtcblx0XHR0aGlzLnZEb21Cb3R0b20gPSAwO1xuXHRcdHRoaXMudkRvbVRvcFBhZCA9IDA7XG5cdFx0dGhpcy52RG9tQm90dG9tUGFkID0gMDtcblx0XHR0aGlzLnZEb21TY3JvbGxQb3NUb3AgPSAwO1xuXHRcdHRoaXMudkRvbVNjcm9sbFBvc0JvdHRvbSA9IDA7XG5cdH1cblxuXHRyZW5kZXJSb3dzKCl7XG5cdFx0dGhpcy5fdmlydHVhbFJlbmRlckZpbGwoKTtcblx0fVxuXG5cdHJlcmVuZGVyUm93cyhjYWxsYmFjayl7XG5cdFx0dmFyIHNjcm9sbFRvcCA9IHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcDtcblx0XHR2YXIgdG9wUm93ID0gZmFsc2U7XG5cdFx0dmFyIHRvcE9mZnNldCA9IGZhbHNlO1xuXG5cdFx0dmFyIGxlZnQgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2Nyb2xsTGVmdDtcblxuXHRcdHZhciByb3dzID0gdGhpcy5yb3dzKCk7XG5cblx0XHRmb3IodmFyIGkgPSB0aGlzLnZEb21Ub3A7IGkgPD0gdGhpcy52RG9tQm90dG9tOyBpKyspe1xuXG5cdFx0XHRpZihyb3dzW2ldKXtcblx0XHRcdFx0dmFyIGRpZmYgPSBzY3JvbGxUb3AgLSByb3dzW2ldLmdldEVsZW1lbnQoKS5vZmZzZXRUb3A7XG5cblx0XHRcdFx0aWYodG9wT2Zmc2V0ID09PSBmYWxzZSB8fCBNYXRoLmFicyhkaWZmKSA8IHRvcE9mZnNldCl7XG5cdFx0XHRcdFx0dG9wT2Zmc2V0ID0gZGlmZjtcblx0XHRcdFx0XHR0b3BSb3cgPSBpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0cm93LmRlaW5pdGlhbGl6ZUhlaWdodCgpO1xuXHRcdH0pO1xuXG5cdFx0aWYoY2FsbGJhY2spe1xuXHRcdFx0Y2FsbGJhY2soKTtcblx0XHR9XG5cblx0XHRpZih0aGlzLnJvd3MoKS5sZW5ndGgpe1xuXHRcdFx0dGhpcy5fdmlydHVhbFJlbmRlckZpbGwoKHRvcFJvdyA9PT0gZmFsc2UgPyB0aGlzLnJvd3MubGVuZ3RoIC0gMSA6IHRvcFJvdyksIHRydWUsIHRvcE9mZnNldCB8fCAwKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmNsZWFyKCk7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIudGFibGVFbXB0eSgpO1xuXHRcdH1cblxuXHRcdHRoaXMuc2Nyb2xsQ29sdW1ucyhsZWZ0KTtcblx0fVxuXG5cdHNjcm9sbENvbHVtbnMobGVmdCl7XG5cdFx0dGhpcy50YWJsZS5yb3dNYW5hZ2VyLnNjcm9sbEhvcml6b250YWwobGVmdCk7XG5cdH1cblxuXHRzY3JvbGxSb3dzKHRvcCwgZGlyKXtcblx0XHR2YXIgdG9wRGlmZiA9IHRvcCAtIHRoaXMudkRvbVNjcm9sbFBvc1RvcDtcblx0XHR2YXIgYm90dG9tRGlmZiA9IHRvcCAtIHRoaXMudkRvbVNjcm9sbFBvc0JvdHRvbTtcblx0XHR2YXIgbWFyZ2luID0gdGhpcy52RG9tV2luZG93QnVmZmVyICogMjtcblx0XHR2YXIgcm93cyA9IHRoaXMucm93cygpO1xuXG5cdFx0dGhpcy5zY3JvbGxUb3AgPSB0b3A7XG5cblx0XHRpZigtdG9wRGlmZiA+IG1hcmdpbiB8fCBib3R0b21EaWZmID4gbWFyZ2luKXtcblx0XHRcdC8vaWYgYmlnIHNjcm9sbCByZWRyYXcgdGFibGU7XG5cdFx0XHR2YXIgbGVmdCA9IHRoaXMudGFibGUucm93TWFuYWdlci5zY3JvbGxMZWZ0O1xuXHRcdFx0dGhpcy5fdmlydHVhbFJlbmRlckZpbGwoTWF0aC5mbG9vcigodGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsVG9wIC8gdGhpcy5lbGVtZW50VmVydGljYWwuc2Nyb2xsSGVpZ2h0KSAqIHJvd3MubGVuZ3RoKSk7XG5cdFx0XHR0aGlzLnNjcm9sbENvbHVtbnMobGVmdCk7XG5cdFx0fWVsc2Uge1xuXG5cdFx0XHRpZihkaXIpe1xuXHRcdFx0XHQvL3Njcm9sbGluZyB1cFxuXHRcdFx0XHRpZih0b3BEaWZmIDwgMCl7XG5cdFx0XHRcdFx0dGhpcy5fYWRkVG9wUm93KHJvd3MsIC10b3BEaWZmKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmKGJvdHRvbURpZmYgPCAwKXtcblx0XHRcdFx0XHQvL2hpZGUgYm90dG9tIHJvdyBpZiBuZWVkZWRcblx0XHRcdFx0XHRpZih0aGlzLnZEb21TY3JvbGxIZWlnaHQgLSB0aGlzLnNjcm9sbFRvcCA+IHRoaXMudkRvbVdpbmRvd0J1ZmZlcil7XG5cdFx0XHRcdFx0XHR0aGlzLl9yZW1vdmVCb3R0b21Sb3cocm93cywgLWJvdHRvbURpZmYpO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdHRoaXMudkRvbVNjcm9sbFBvc0JvdHRvbSA9IHRoaXMuc2Nyb2xsVG9wO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXG5cdFx0XHRcdGlmKGJvdHRvbURpZmYgPj0gMCl7XG5cdFx0XHRcdFx0dGhpcy5fYWRkQm90dG9tUm93KHJvd3MsIGJvdHRvbURpZmYpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9zY3JvbGxpbmcgZG93blxuXHRcdFx0XHRpZih0b3BEaWZmID49IDApe1xuXHRcdFx0XHRcdC8vaGlkZSB0b3Agcm93IGlmIG5lZWRlZFxuXHRcdFx0XHRcdGlmKHRoaXMuc2Nyb2xsVG9wID4gdGhpcy52RG9tV2luZG93QnVmZmVyKXtcblx0XHRcdFx0XHRcdHRoaXMuX3JlbW92ZVRvcFJvdyhyb3dzLCB0b3BEaWZmKTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHR0aGlzLnZEb21TY3JvbGxQb3NUb3AgPSB0aGlzLnNjcm9sbFRvcDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXNpemUoKXtcblx0XHR0aGlzLnZEb21XaW5kb3dCdWZmZXIgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVuZGVyVmVydGljYWxCdWZmZXIgfHwgdGhpcy5lbGVtZW50VmVydGljYWwuY2xpZW50SGVpZ2h0O1xuXHR9XG5cblx0c2Nyb2xsVG9Sb3dOZWFyZXN0VG9wKHJvdyl7XG5cdFx0dmFyIHJvd0luZGV4ID0gdGhpcy5yb3dzKCkuaW5kZXhPZihyb3cpO1xuXG5cdFx0cmV0dXJuICEoTWF0aC5hYnModGhpcy52RG9tVG9wIC0gcm93SW5kZXgpID4gTWF0aC5hYnModGhpcy52RG9tQm90dG9tIC0gcm93SW5kZXgpKTtcblx0fVxuXG5cdHNjcm9sbFRvUm93KHJvdyl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy5yb3dzKCkuaW5kZXhPZihyb3cpO1xuXG5cdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHR0aGlzLl92aXJ0dWFsUmVuZGVyRmlsbChpbmRleCwgdHJ1ZSk7XG5cdFx0fVxuXHR9XG5cblx0dmlzaWJsZVJvd3MoaW5jbHVkaW5nQnVmZmVyKXtcblx0XHR2YXIgdG9wRWRnZSA9IHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFRvcCxcblx0XHRib3R0b21FZGdlID0gdGhpcy5lbGVtZW50VmVydGljYWwuY2xpZW50SGVpZ2h0ICsgdG9wRWRnZSxcblx0XHR0b3BGb3VuZCA9IGZhbHNlLFxuXHRcdHRvcFJvdyA9IDAsXG5cdFx0Ym90dG9tUm93ID0gMCxcblx0XHRyb3dzID0gdGhpcy5yb3dzKCk7XG5cblx0XHRpZihpbmNsdWRpbmdCdWZmZXIpe1xuXHRcdFx0dG9wUm93ID0gdGhpcy52RG9tVG9wO1xuXHRcdFx0Ym90dG9tUm93ID0gdGhpcy52RG9tQm90dG9tO1xuXHRcdH1lbHNlIHtcblx0XHRcdGZvcih2YXIgaSA9IHRoaXMudkRvbVRvcDsgaSA8PSB0aGlzLnZEb21Cb3R0b207IGkrKyl7XG5cdFx0XHRcdGlmKHJvd3NbaV0pe1xuXHRcdFx0XHRcdGlmKCF0b3BGb3VuZCl7XG5cdFx0XHRcdFx0XHRpZigodG9wRWRnZSAtIHJvd3NbaV0uZ2V0RWxlbWVudCgpLm9mZnNldFRvcCkgPj0gMCl7XG5cdFx0XHRcdFx0XHRcdHRvcFJvdyA9IGk7XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRvcEZvdW5kID0gdHJ1ZTtcblxuXHRcdFx0XHRcdFx0XHRpZihib3R0b21FZGdlIC0gcm93c1tpXS5nZXRFbGVtZW50KCkub2Zmc2V0VG9wID49IDApe1xuXHRcdFx0XHRcdFx0XHRcdGJvdHRvbVJvdyA9IGk7XG5cdFx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGlmKGJvdHRvbUVkZ2UgLSByb3dzW2ldLmdldEVsZW1lbnQoKS5vZmZzZXRUb3AgPj0gMCl7XG5cdFx0XHRcdFx0XHRcdGJvdHRvbVJvdyA9IGk7XG5cdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiByb3dzLnNsaWNlKHRvcFJvdywgYm90dG9tUm93ICsgMSk7XG5cdH1cblxuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXHQvLy8vLy8vLyBJbnRlcm5hbCBSZW5kZXJpbmcgLy8vLy8vLy8vL1xuXHQvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cdC8vZnVsbCB2aXJ0dWFsIHJlbmRlclxuXHRfdmlydHVhbFJlbmRlckZpbGwocG9zaXRpb24sIGZvcmNlTW92ZSwgb2Zmc2V0KSB7XG5cdFx0dmFyXHRlbGVtZW50ID0gdGhpcy50YWJsZUVsZW1lbnQsXG5cdFx0aG9sZGVyID0gdGhpcy5lbGVtZW50VmVydGljYWwsXG5cdFx0dG9wUGFkID0gMCxcblx0XHRyb3dzSGVpZ2h0ID0gMCxcblx0XHRyb3dIZWlnaHQgPSAwLFxuXHRcdGhlaWdodE9jY3VwaWVkID0gMCxcblx0XHR0b3BQYWRIZWlnaHQgPSAwLFxuXHRcdGkgPSAwLFxuXHRcdHJvd3MgPSB0aGlzLnJvd3MoKSxcblx0XHRyb3dzQ291bnQgPSByb3dzLmxlbmd0aCxcblx0XHRpbmRleCA9IDAsXG5cdFx0cm93LFxuXHRcdHJvd0ZyYWdtZW50LFxuXHRcdHJlbmRlcmVkUm93cyA9IFtdLFxuXHRcdHRvdGFsUm93c1JlbmRlcmVkID0gMCxcblx0XHRyb3dzVG9SZW5kZXIgPSAwLFxuXHRcdGZpeGVkSGVpZ2h0ID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmZpeGVkSGVpZ2h0LFxuXHRcdGNvbnRhaW5lckhlaWdodCA9IHRoaXMuZWxlbWVudFZlcnRpY2FsLmNsaWVudEhlaWdodCwgXG5cdFx0YXZnUm93SGVpZ2h0ID0gdGhpcy50YWJsZS5vcHRpb25zLnJvd0hlaWdodCwgXG5cdFx0cmVzaXplZCA9IHRydWU7XG5cblx0XHRwb3NpdGlvbiA9IHBvc2l0aW9uIHx8IDA7XG5cblx0XHRvZmZzZXQgPSBvZmZzZXQgfHwgMDtcblxuXHRcdGlmKCFwb3NpdGlvbil7XG5cdFx0XHR0aGlzLmNsZWFyKCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0d2hpbGUoZWxlbWVudC5maXJzdENoaWxkKSBlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cblx0XHRcdC8vY2hlY2sgaWYgcG9zaXRpb24gaXMgdG9vIGNsb3NlIHRvIGJvdHRvbSBvZiB0YWJsZVxuXHRcdFx0aGVpZ2h0T2NjdXBpZWQgPSAocm93c0NvdW50IC0gcG9zaXRpb24gKyAxKSAqIHRoaXMudkRvbVJvd0hlaWdodDtcblxuXHRcdFx0aWYoaGVpZ2h0T2NjdXBpZWQgPCBjb250YWluZXJIZWlnaHQpe1xuXHRcdFx0XHRwb3NpdGlvbiAtPSBNYXRoLmNlaWwoKGNvbnRhaW5lckhlaWdodCAtIGhlaWdodE9jY3VwaWVkKSAvIHRoaXMudkRvbVJvd0hlaWdodCk7XG5cdFx0XHRcdGlmKHBvc2l0aW9uIDwgMCl7XG5cdFx0XHRcdFx0cG9zaXRpb24gPSAwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vY2FsY3VsYXRlIGluaXRpYWwgcGFkXG5cdFx0XHR0b3BQYWQgPSBNYXRoLm1pbihNYXRoLm1heChNYXRoLmZsb29yKHRoaXMudkRvbVdpbmRvd0J1ZmZlciAvIHRoaXMudkRvbVJvd0hlaWdodCksICB0aGlzLnZEb21XaW5kb3dNaW5NYXJnaW5Sb3dzKSwgcG9zaXRpb24pO1xuXHRcdFx0cG9zaXRpb24gLT0gdG9wUGFkO1xuXHRcdH1cblxuXHRcdGlmKHJvd3NDb3VudCAmJiBIZWxwZXJzLmVsVmlzaWJsZSh0aGlzLmVsZW1lbnRWZXJ0aWNhbCkpe1xuXHRcdFx0dGhpcy52RG9tVG9wID0gcG9zaXRpb247XG5cdFx0XHR0aGlzLnZEb21Cb3R0b20gPSBwb3NpdGlvbiAtMTtcblxuXHRcdFx0aWYoZml4ZWRIZWlnaHQgfHwgdGhpcy50YWJsZS5vcHRpb25zLm1heEhlaWdodCkge1xuXHRcdFx0XHRpZihhdmdSb3dIZWlnaHQpIHtcblx0XHRcdFx0XHRyb3dzVG9SZW5kZXIgPSAoY29udGFpbmVySGVpZ2h0IC8gYXZnUm93SGVpZ2h0KSArICh0aGlzLnZEb21XaW5kb3dCdWZmZXIgLyBhdmdSb3dIZWlnaHQpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJvd3NUb1JlbmRlciA9IE1hdGgubWF4KHRoaXMudkRvbVdpbmRvd01pblRvdGFsUm93cywgTWF0aC5jZWlsKHJvd3NUb1JlbmRlcikpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHJvd3NUb1JlbmRlciA9IHJvd3NDb3VudDtcblx0XHRcdH1cblxuXHRcdFx0d2hpbGUoKChyb3dzVG9SZW5kZXIgPT0gcm93c0NvdW50IHx8IHJvd3NIZWlnaHQgPD0gY29udGFpbmVySGVpZ2h0ICsgdGhpcy52RG9tV2luZG93QnVmZmVyKSB8fCB0b3RhbFJvd3NSZW5kZXJlZCA8IHRoaXMudkRvbVdpbmRvd01pblRvdGFsUm93cykgJiYgdGhpcy52RG9tQm90dG9tIDwgcm93c0NvdW50IC0xKSB7XG5cdFx0XHRcdHJlbmRlcmVkUm93cyA9IFtdO1xuXHRcdFx0XHRyb3dGcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuXHRcdFx0XHRpID0gMDtcblxuXHRcdFx0XHR3aGlsZSAoKGkgPCByb3dzVG9SZW5kZXIpICYmIHRoaXMudkRvbUJvdHRvbSA8IHJvd3NDb3VudCAtMSkge1x0XG5cdFx0XHRcdFx0aW5kZXggPSB0aGlzLnZEb21Cb3R0b20gKyAxLFxuXHRcdFx0XHRcdHJvdyA9IHJvd3NbaW5kZXhdO1xuXG5cdFx0XHRcdFx0dGhpcy5zdHlsZVJvdyhyb3csIGluZGV4KTtcblxuXHRcdFx0XHRcdHJvdy5pbml0aWFsaXplKGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0XHRpZighcm93LmhlaWdodEluaXRpYWxpemVkICYmICF0aGlzLnRhYmxlLm9wdGlvbnMucm93SGVpZ2h0KXtcblx0XHRcdFx0XHRcdHJvdy5jbGVhckNlbGxIZWlnaHQoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyb3dGcmFnbWVudC5hcHBlbmRDaGlsZChyb3cuZ2V0RWxlbWVudCgpKTtcblx0XHRcdFx0XHRyZW5kZXJlZFJvd3MucHVzaChyb3cpO1xuXHRcdFx0XHRcdHRoaXMudkRvbUJvdHRvbSArKztcblx0XHRcdFx0XHRpKys7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZighcmVuZGVyZWRSb3dzLmxlbmd0aCl7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRlbGVtZW50LmFwcGVuZENoaWxkKHJvd0ZyYWdtZW50KTtcblx0XHRcdFx0XG5cdFx0XHRcdC8vIE5PVEU6IFRoZSBuZXh0IDMgbG9vcHMgYXJlIHNlcGFyYXRlIG9uIHB1cnBvc2Vcblx0XHRcdFx0Ly8gVGhpcyBpcyB0byBiYXRjaCB1cCB0aGUgZG9tIHdyaXRlcyBhbmQgcmVhZHMgd2hpY2ggZHJhc3RpY2FsbHkgaW1wcm92ZXMgcGVyZm9ybWFuY2UgXG5cblx0XHRcdFx0cmVuZGVyZWRSb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0XHRcdHJvdy5yZW5kZXJlZCgpO1xuXG5cdFx0XHRcdFx0aWYoIXJvdy5oZWlnaHRJbml0aWFsaXplZCkge1xuXHRcdFx0XHRcdFx0cm93LmNhbGNIZWlnaHQodHJ1ZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRyZW5kZXJlZFJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG5cdFx0XHRcdFx0aWYoIXJvdy5oZWlnaHRJbml0aWFsaXplZCkge1xuXHRcdFx0XHRcdFx0cm93LnNldENlbGxIZWlnaHQoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHJlbmRlcmVkUm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdFx0XHRyb3dIZWlnaHQgPSByb3cuZ2V0SGVpZ2h0KCk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYodG90YWxSb3dzUmVuZGVyZWQgPCB0b3BQYWQpe1xuXHRcdFx0XHRcdFx0dG9wUGFkSGVpZ2h0ICs9IHJvd0hlaWdodDtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRyb3dzSGVpZ2h0ICs9IHJvd0hlaWdodDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZihyb3dIZWlnaHQgPiB0aGlzLnZEb21XaW5kb3dCdWZmZXIpe1xuXHRcdFx0XHRcdFx0dGhpcy52RG9tV2luZG93QnVmZmVyID0gcm93SGVpZ2h0ICogMjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dG90YWxSb3dzUmVuZGVyZWQrKztcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmVzaXplZCA9IHRoaXMudGFibGUucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblx0XHRcdFx0Y29udGFpbmVySGVpZ2h0ID0gdGhpcy5lbGVtZW50VmVydGljYWwuY2xpZW50SGVpZ2h0O1xuXHRcdFx0XHRpZihyZXNpemVkICYmIChmaXhlZEhlaWdodCB8fCB0aGlzLnRhYmxlLm9wdGlvbnMubWF4SGVpZ2h0KSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGF2Z1Jvd0hlaWdodCA9IHJvd3NIZWlnaHQgLyB0b3RhbFJvd3NSZW5kZXJlZDtcblx0XHRcdFx0XHRyb3dzVG9SZW5kZXIgPSBNYXRoLm1heCh0aGlzLnZEb21XaW5kb3dNaW5Ub3RhbFJvd3MsIE1hdGguY2VpbCgoY29udGFpbmVySGVpZ2h0IC8gYXZnUm93SGVpZ2h0KSArICh0aGlzLnZEb21XaW5kb3dCdWZmZXIgLyBhdmdSb3dIZWlnaHQpKSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYoIXBvc2l0aW9uKXtcblx0XHRcdFx0dGhpcy52RG9tVG9wUGFkID0gMDtcblx0XHRcdFx0Ly9hZGp1c3Qgcm93IGhlaWdodCB0byBtYXRjaCBhdmVyYWdlIG9mIHJlbmRlcmVkIGVsZW1lbnRzXG5cdFx0XHRcdHRoaXMudkRvbVJvd0hlaWdodCA9IE1hdGguZmxvb3IoKHJvd3NIZWlnaHQgKyB0b3BQYWRIZWlnaHQpIC8gdG90YWxSb3dzUmVuZGVyZWQpO1xuXHRcdFx0XHR0aGlzLnZEb21Cb3R0b21QYWQgPSB0aGlzLnZEb21Sb3dIZWlnaHQgKiAocm93c0NvdW50IC0gdGhpcy52RG9tQm90dG9tIC0xKTtcblxuXHRcdFx0XHR0aGlzLnZEb21TY3JvbGxIZWlnaHQgPSB0b3BQYWRIZWlnaHQgKyByb3dzSGVpZ2h0ICsgdGhpcy52RG9tQm90dG9tUGFkIC0gY29udGFpbmVySGVpZ2h0O1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLnZEb21Ub3BQYWQgPSAhZm9yY2VNb3ZlID8gdGhpcy5zY3JvbGxUb3AgLSB0b3BQYWRIZWlnaHQgOiAodGhpcy52RG9tUm93SGVpZ2h0ICogdGhpcy52RG9tVG9wKSArIG9mZnNldDtcblx0XHRcdFx0dGhpcy52RG9tQm90dG9tUGFkID0gdGhpcy52RG9tQm90dG9tID09IHJvd3NDb3VudC0xID8gMCA6IE1hdGgubWF4KHRoaXMudkRvbVNjcm9sbEhlaWdodCAtIHRoaXMudkRvbVRvcFBhZCAtIHJvd3NIZWlnaHQgLSB0b3BQYWRIZWlnaHQsIDApO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRlbGVtZW50LnN0eWxlLnBhZGRpbmdUb3AgPSB0aGlzLnZEb21Ub3BQYWQrXCJweFwiO1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gdGhpcy52RG9tQm90dG9tUGFkK1wicHhcIjtcblxuXHRcdFx0aWYoZm9yY2VNb3ZlKXtcblx0XHRcdFx0dGhpcy5zY3JvbGxUb3AgPSB0aGlzLnZEb21Ub3BQYWQgKyAodG9wUGFkSGVpZ2h0KSArIG9mZnNldCAtICh0aGlzLmVsZW1lbnRWZXJ0aWNhbC5zY3JvbGxXaWR0aCA+IHRoaXMuZWxlbWVudFZlcnRpY2FsLmNsaWVudFdpZHRoID8gdGhpcy5lbGVtZW50VmVydGljYWwub2Zmc2V0SGVpZ2h0IC0gY29udGFpbmVySGVpZ2h0IDogMCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuc2Nyb2xsVG9wID0gTWF0aC5taW4odGhpcy5zY3JvbGxUb3AsIHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbEhlaWdodCAtIGNvbnRhaW5lckhlaWdodCk7XG5cblx0XHRcdC8vYWRqdXN0IGZvciBob3Jpem9udGFsIHNjcm9sbGJhciBpZiBwcmVzZW50IChhbmQgbm90IGF0IHRvcCBvZiB0YWJsZSlcblx0XHRcdGlmKHRoaXMuZWxlbWVudFZlcnRpY2FsLnNjcm9sbFdpZHRoID4gdGhpcy5lbGVtZW50VmVydGljYWwuY2xpZW50V2lkdGggJiYgZm9yY2VNb3ZlKXtcblx0XHRcdFx0dGhpcy5zY3JvbGxUb3AgKz0gdGhpcy5lbGVtZW50VmVydGljYWwub2Zmc2V0SGVpZ2h0IC0gY29udGFpbmVySGVpZ2h0O1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnZEb21TY3JvbGxQb3NUb3AgPSB0aGlzLnNjcm9sbFRvcDtcblx0XHRcdHRoaXMudkRvbVNjcm9sbFBvc0JvdHRvbSA9IHRoaXMuc2Nyb2xsVG9wO1xuXG5cdFx0XHRob2xkZXIuc2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxUb3A7XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJyZW5kZXItdmlydHVhbC1maWxsXCIpO1xuXHRcdH1cblx0fVxuXG5cdF9hZGRUb3BSb3cocm93cywgZmlsbGFibGVTcGFjZSl7XG5cdFx0dmFyIHRhYmxlID0gdGhpcy50YWJsZUVsZW1lbnQsXG5cdFx0YWRkZWRSb3dzID0gW10sXG5cdFx0cGFkZGluZ0FkanVzdCA9IDAsXG5cdFx0aW5kZXggPSB0aGlzLnZEb21Ub3AgLTEsXG5cdFx0aSA9IDAsXG5cdFx0d29ya2luZyA9IHRydWU7XG5cblx0XHR3aGlsZSh3b3JraW5nKXtcblx0XHRcdGlmKHRoaXMudkRvbVRvcCl7XG5cdFx0XHRcdGxldCByb3cgPSByb3dzW2luZGV4XSxcblx0XHRcdFx0cm93SGVpZ2h0LCBpbml0aWFsaXplZDtcblxuXHRcdFx0XHRpZihyb3cgJiYgaSA8IHRoaXMudkRvbU1heFJlbmRlckNoYWluKXtcblx0XHRcdFx0XHRyb3dIZWlnaHQgPSByb3cuZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0O1xuXHRcdFx0XHRcdGluaXRpYWxpemVkID0gcm93LmluaXRpYWxpemVkO1xuXG5cdFx0XHRcdFx0aWYoZmlsbGFibGVTcGFjZSA+PSByb3dIZWlnaHQpe1xuXG5cdFx0XHRcdFx0XHR0aGlzLnN0eWxlUm93KHJvdywgaW5kZXgpO1xuXHRcdFx0XHRcdFx0dGFibGUuaW5zZXJ0QmVmb3JlKHJvdy5nZXRFbGVtZW50KCksIHRhYmxlLmZpcnN0Q2hpbGQpO1xuXG5cdFx0XHRcdFx0XHRpZighcm93LmluaXRpYWxpemVkIHx8ICFyb3cuaGVpZ2h0SW5pdGlhbGl6ZWQpe1xuXHRcdFx0XHRcdFx0XHRhZGRlZFJvd3MucHVzaChyb3cpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRyb3cuaW5pdGlhbGl6ZSgpO1xuXG5cdFx0XHRcdFx0XHRpZighaW5pdGlhbGl6ZWQpe1xuXHRcdFx0XHRcdFx0XHRyb3dIZWlnaHQgPSByb3cuZ2V0RWxlbWVudCgpLm9mZnNldEhlaWdodDtcblxuXHRcdFx0XHRcdFx0XHRpZihyb3dIZWlnaHQgPiB0aGlzLnZEb21XaW5kb3dCdWZmZXIpe1xuXHRcdFx0XHRcdFx0XHRcdHRoaXMudkRvbVdpbmRvd0J1ZmZlciA9IHJvd0hlaWdodCAqIDI7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0ZmlsbGFibGVTcGFjZSAtPSByb3dIZWlnaHQ7XG5cdFx0XHRcdFx0XHRwYWRkaW5nQWRqdXN0ICs9IHJvd0hlaWdodDtcblxuXHRcdFx0XHRcdFx0dGhpcy52RG9tVG9wLS07XG5cdFx0XHRcdFx0XHRpbmRleC0tO1xuXHRcdFx0XHRcdFx0aSsrO1xuXG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZvciAobGV0IHJvdyBvZiBhZGRlZFJvd3Mpe1xuXHRcdFx0cm93LmNsZWFyQ2VsbEhlaWdodCgpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3F1aWNrTm9ybWFsaXplUm93SGVpZ2h0KGFkZGVkUm93cyk7XG5cblx0XHRpZihwYWRkaW5nQWRqdXN0KXtcblx0XHRcdHRoaXMudkRvbVRvcFBhZCAtPSBwYWRkaW5nQWRqdXN0O1xuXG5cdFx0XHRpZih0aGlzLnZEb21Ub3BQYWQgPCAwKXtcblx0XHRcdFx0dGhpcy52RG9tVG9wUGFkID0gaW5kZXggKiB0aGlzLnZEb21Sb3dIZWlnaHQ7XG5cdFx0XHR9XG5cblx0XHRcdGlmKGluZGV4IDwgMSl7XG5cdFx0XHRcdHRoaXMudkRvbVRvcFBhZCA9IDA7XG5cdFx0XHR9XG5cblx0XHRcdHRhYmxlLnN0eWxlLnBhZGRpbmdUb3AgPSB0aGlzLnZEb21Ub3BQYWQgKyBcInB4XCI7XG5cdFx0XHR0aGlzLnZEb21TY3JvbGxQb3NUb3AgLT0gcGFkZGluZ0FkanVzdDtcblx0XHR9XG5cdH1cblxuXHRfcmVtb3ZlVG9wUm93KHJvd3MsIGZpbGxhYmxlU3BhY2Upe1xuXHRcdHZhciByZW1vdmFibGVSb3dzID0gW10sXG5cdFx0cGFkZGluZ0FkanVzdCA9IDAsXG5cdFx0aSA9IDAsXG5cdFx0d29ya2luZyA9IHRydWU7XG5cblx0XHR3aGlsZSh3b3JraW5nKXtcblx0XHRcdGxldCByb3cgPSByb3dzW3RoaXMudkRvbVRvcF0sXG5cdFx0XHRyb3dIZWlnaHQ7XG5cblx0XHRcdGlmKHJvdyAmJiBpIDwgdGhpcy52RG9tTWF4UmVuZGVyQ2hhaW4pe1xuXHRcdFx0XHRyb3dIZWlnaHQgPSByb3cuZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0O1xuXG5cdFx0XHRcdGlmKGZpbGxhYmxlU3BhY2UgPj0gcm93SGVpZ2h0KXtcblx0XHRcdFx0XHR0aGlzLnZEb21Ub3ArKztcblxuXHRcdFx0XHRcdGZpbGxhYmxlU3BhY2UgLT0gcm93SGVpZ2h0O1xuXHRcdFx0XHRcdHBhZGRpbmdBZGp1c3QgKz0gcm93SGVpZ2h0O1xuXG5cdFx0XHRcdFx0cmVtb3ZhYmxlUm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdFx0aSsrO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHdvcmtpbmcgPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmb3IgKGxldCByb3cgb2YgcmVtb3ZhYmxlUm93cyl7XG5cdFx0XHRsZXQgcm93RWwgPSByb3cuZ2V0RWxlbWVudCgpO1xuXG5cdFx0XHRpZihyb3dFbC5wYXJlbnROb2RlKXtcblx0XHRcdFx0cm93RWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3dFbCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYocGFkZGluZ0FkanVzdCl7XG5cdFx0XHR0aGlzLnZEb21Ub3BQYWQgKz0gcGFkZGluZ0FkanVzdDtcblx0XHRcdHRoaXMudGFibGVFbGVtZW50LnN0eWxlLnBhZGRpbmdUb3AgPSB0aGlzLnZEb21Ub3BQYWQgKyBcInB4XCI7XG5cdFx0XHR0aGlzLnZEb21TY3JvbGxQb3NUb3AgKz0gdGhpcy52RG9tVG9wID8gcGFkZGluZ0FkanVzdCA6IHBhZGRpbmdBZGp1c3QgKyB0aGlzLnZEb21XaW5kb3dCdWZmZXI7XG5cdFx0fVxuXHR9XG5cblx0X2FkZEJvdHRvbVJvdyhyb3dzLCBmaWxsYWJsZVNwYWNlKXtcblx0XHR2YXIgdGFibGUgPSB0aGlzLnRhYmxlRWxlbWVudCxcblx0XHRhZGRlZFJvd3MgPSBbXSxcblx0XHRwYWRkaW5nQWRqdXN0ID0gMCxcblx0XHRpbmRleCA9IHRoaXMudkRvbUJvdHRvbSArIDEsXG5cdFx0aSA9IDAsXG5cdFx0d29ya2luZyA9IHRydWU7XG5cblx0XHR3aGlsZSh3b3JraW5nKXtcblx0XHRcdGxldCByb3cgPSByb3dzW2luZGV4XSxcblx0XHRcdHJvd0hlaWdodCwgaW5pdGlhbGl6ZWQ7XG5cblx0XHRcdGlmKHJvdyAmJiBpIDwgdGhpcy52RG9tTWF4UmVuZGVyQ2hhaW4pe1xuXHRcdFx0XHRyb3dIZWlnaHQgPSByb3cuZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0O1xuXHRcdFx0XHRpbml0aWFsaXplZCA9IHJvdy5pbml0aWFsaXplZDtcblxuXHRcdFx0XHRpZihmaWxsYWJsZVNwYWNlID49IHJvd0hlaWdodCl7XG5cblx0XHRcdFx0XHR0aGlzLnN0eWxlUm93KHJvdywgaW5kZXgpO1xuXHRcdFx0XHRcdHRhYmxlLmFwcGVuZENoaWxkKHJvdy5nZXRFbGVtZW50KCkpO1xuXG5cdFx0XHRcdFx0aWYoIXJvdy5pbml0aWFsaXplZCB8fCAhcm93LmhlaWdodEluaXRpYWxpemVkKXtcblx0XHRcdFx0XHRcdGFkZGVkUm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cm93LmluaXRpYWxpemUoKTtcblxuXHRcdFx0XHRcdGlmKCFpbml0aWFsaXplZCl7XG5cdFx0XHRcdFx0XHRyb3dIZWlnaHQgPSByb3cuZ2V0RWxlbWVudCgpLm9mZnNldEhlaWdodDtcblxuXHRcdFx0XHRcdFx0aWYocm93SGVpZ2h0ID4gdGhpcy52RG9tV2luZG93QnVmZmVyKXtcblx0XHRcdFx0XHRcdFx0dGhpcy52RG9tV2luZG93QnVmZmVyID0gcm93SGVpZ2h0ICogMjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRmaWxsYWJsZVNwYWNlIC09IHJvd0hlaWdodDtcblx0XHRcdFx0XHRwYWRkaW5nQWRqdXN0ICs9IHJvd0hlaWdodDtcblxuXHRcdFx0XHRcdHRoaXMudkRvbUJvdHRvbSsrO1xuXHRcdFx0XHRcdGluZGV4Kys7XG5cdFx0XHRcdFx0aSsrO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0d29ya2luZyA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHdvcmtpbmcgPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmb3IgKGxldCByb3cgb2YgYWRkZWRSb3dzKXtcblx0XHRcdHJvdy5jbGVhckNlbGxIZWlnaHQoKTtcblx0XHR9XG5cblx0XHR0aGlzLl9xdWlja05vcm1hbGl6ZVJvd0hlaWdodChhZGRlZFJvd3MpO1xuXG5cdFx0aWYocGFkZGluZ0FkanVzdCl7XG5cdFx0XHR0aGlzLnZEb21Cb3R0b21QYWQgLT0gcGFkZGluZ0FkanVzdDtcblxuXHRcdFx0aWYodGhpcy52RG9tQm90dG9tUGFkIDwgMCB8fCBpbmRleCA9PSByb3dzLmxlbmd0aCAtMSl7XG5cdFx0XHRcdHRoaXMudkRvbUJvdHRvbVBhZCA9IDA7XG5cdFx0XHR9XG5cblx0XHRcdHRhYmxlLnN0eWxlLnBhZGRpbmdCb3R0b20gPSB0aGlzLnZEb21Cb3R0b21QYWQgKyBcInB4XCI7XG5cdFx0XHR0aGlzLnZEb21TY3JvbGxQb3NCb3R0b20gKz0gcGFkZGluZ0FkanVzdDtcblx0XHR9XG5cdH1cblxuXHRfcmVtb3ZlQm90dG9tUm93KHJvd3MsIGZpbGxhYmxlU3BhY2Upe1xuXHRcdHZhciByZW1vdmFibGVSb3dzID0gW10sXG5cdFx0cGFkZGluZ0FkanVzdCA9IDAsXG5cdFx0aSA9IDAsXG5cdFx0d29ya2luZyA9IHRydWU7XG5cblx0XHR3aGlsZSh3b3JraW5nKXtcblx0XHRcdGxldCByb3cgPSByb3dzW3RoaXMudkRvbUJvdHRvbV0sXG5cdFx0XHRyb3dIZWlnaHQ7XG5cblx0XHRcdGlmKHJvdyAmJiBpIDwgdGhpcy52RG9tTWF4UmVuZGVyQ2hhaW4pe1xuXHRcdFx0XHRyb3dIZWlnaHQgPSByb3cuZ2V0SGVpZ2h0KCkgfHwgdGhpcy52RG9tUm93SGVpZ2h0O1xuXG5cdFx0XHRcdGlmKGZpbGxhYmxlU3BhY2UgPj0gcm93SGVpZ2h0KXtcblx0XHRcdFx0XHR0aGlzLnZEb21Cb3R0b20gLS07XG5cblx0XHRcdFx0XHRmaWxsYWJsZVNwYWNlIC09IHJvd0hlaWdodDtcblx0XHRcdFx0XHRwYWRkaW5nQWRqdXN0ICs9IHJvd0hlaWdodDtcblxuXHRcdFx0XHRcdHJlbW92YWJsZVJvd3MucHVzaChyb3cpO1xuXHRcdFx0XHRcdGkrKztcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHdvcmtpbmcgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR3b3JraW5nID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Zm9yIChsZXQgcm93IG9mIHJlbW92YWJsZVJvd3Mpe1xuXHRcdFx0bGV0IHJvd0VsID0gcm93LmdldEVsZW1lbnQoKTtcblxuXHRcdFx0aWYocm93RWwucGFyZW50Tm9kZSl7XG5cdFx0XHRcdHJvd0VsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocm93RWwpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmKHBhZGRpbmdBZGp1c3Qpe1xuXHRcdFx0dGhpcy52RG9tQm90dG9tUGFkICs9IHBhZGRpbmdBZGp1c3Q7XG5cblx0XHRcdGlmKHRoaXMudkRvbUJvdHRvbVBhZCA8IDApe1xuXHRcdFx0XHR0aGlzLnZEb21Cb3R0b21QYWQgPSAwO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYmxlRWxlbWVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gdGhpcy52RG9tQm90dG9tUGFkICsgXCJweFwiO1xuXHRcdFx0dGhpcy52RG9tU2Nyb2xsUG9zQm90dG9tIC09IHBhZGRpbmdBZGp1c3Q7XG5cdFx0fVxuXHR9XG5cblx0X3F1aWNrTm9ybWFsaXplUm93SGVpZ2h0KHJvd3Mpe1xuXHRcdGZvcihsZXQgcm93IG9mIHJvd3Mpe1xuXHRcdFx0cm93LmNhbGNIZWlnaHQoKTtcblx0XHR9XG5cblx0XHRmb3IobGV0IHJvdyBvZiByb3dzKXtcblx0XHRcdHJvdy5zZXRDZWxsSGVpZ2h0KCk7XG5cdFx0fVxuXHR9XG59XG5cbmNsYXNzIFJvd01hbmFnZXIgZXh0ZW5kcyBDb3JlRmVhdHVyZXtcblx0XG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5lbGVtZW50ID0gdGhpcy5jcmVhdGVIb2xkZXJFbGVtZW50KCk7IC8vY29udGFpbmluZyBlbGVtZW50XG5cdFx0dGhpcy50YWJsZUVsZW1lbnQgPSB0aGlzLmNyZWF0ZVRhYmxlRWxlbWVudCgpOyAvL3RhYmxlIGVsZW1lbnRcblx0XHR0aGlzLmhlaWdodEZpeGVyID0gdGhpcy5jcmVhdGVUYWJsZUVsZW1lbnQoKTsgLy90YWJsZSBlbGVtZW50XG5cdFx0dGhpcy5wbGFjZWhvbGRlciA9IG51bGw7IC8vcGxhY2Vob2xkZXIgZWxlbWVudFxuXHRcdHRoaXMucGxhY2Vob2xkZXJDb250ZW50cyA9IG51bGw7IC8vcGxhY2Vob2xkZXIgZWxlbWVudFxuXHRcdFxuXHRcdHRoaXMuZmlyc3RSZW5kZXIgPSBmYWxzZTsgLy9oYW5kbGUgZmlyc3QgcmVuZGVyXG5cdFx0dGhpcy5yZW5kZXJNb2RlID0gXCJ2aXJ0dWFsXCI7IC8vY3VycmVudCByZW5kZXJpbmcgbW9kZVxuXHRcdHRoaXMuZml4ZWRIZWlnaHQgPSBmYWxzZTsgLy9jdXJyZW50IHJlbmRlcmluZyBtb2RlXG5cdFx0XG5cdFx0dGhpcy5yb3dzID0gW107IC8vaG9sZCByb3cgZGF0YSBvYmplY3RzXG5cdFx0dGhpcy5hY3RpdmVSb3dzUGlwZWxpbmUgPSBbXTsgLy9ob2xkIGNhbGN1bGF0aW9uIG9mIGFjdGl2ZSByb3dzXG5cdFx0dGhpcy5hY3RpdmVSb3dzID0gW107IC8vcm93cyBjdXJyZW50bHkgYXZhaWxhYmxlIHRvIG9uIGRpc3BsYXkgaW4gdGhlIHRhYmxlXG5cdFx0dGhpcy5hY3RpdmVSb3dzQ291bnQgPSAwOyAvL2NvdW50IG9mIGFjdGl2ZSByb3dzXG5cdFx0XG5cdFx0dGhpcy5kaXNwbGF5Um93cyA9IFtdOyAvL3Jvd3MgY3VycmVudGx5IG9uIGRpc3BsYXkgaW4gdGhlIHRhYmxlXG5cdFx0dGhpcy5kaXNwbGF5Um93c0NvdW50ID0gMDsgLy9jb3VudCBvZiBkaXNwbGF5IHJvd3Ncblx0XHRcblx0XHR0aGlzLnNjcm9sbFRvcCA9IDA7XG5cdFx0dGhpcy5zY3JvbGxMZWZ0ID0gMDtcblx0XHRcblx0XHR0aGlzLnJlZHJhd0Jsb2NrID0gZmFsc2U7IC8vcHJldmVudCByZWRyYXdzIHRvIGFsbG93IG11bHRpcGxlIGRhdGEgbWFuaXB1bGF0aW9ucyBiZWZvcmUgY29udGludWluZ1xuXHRcdHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnID0gZmFsc2U7IC8vc3RvcmUgbGF0ZXN0IHJlZHJhdyBmdW5jdGlvbiBjYWxscyBmb3Igd2hlbiByZWRyYXcgaXMgbmVlZGVkXG5cdFx0dGhpcy5yZWRyYXdCbG9ja1JlbmRlckluUG9zaXRpb24gPSBmYWxzZTsgLy9zdG9yZSBsYXRlc3QgcmVkcmF3IGZ1bmN0aW9uIGNhbGxzIGZvciB3aGVuIHJlZHJhdyBpcyBuZWVkZWRcblx0XHRcblx0XHR0aGlzLmRhdGFQaXBlbGluZSA9IFtdOyAvL2hvbGQgZGF0YSBwaXBlbGluZSB0YXNrc1xuXHRcdHRoaXMuZGlzcGxheVBpcGVsaW5lID0gW107IC8vaG9sZCBkYXRhIGRpc3BsYXkgcGlwZWxpbmUgdGFza3Ncblx0XHRcblx0XHR0aGlzLnNjcm9sbGJhcldpZHRoID0gMDtcblx0XHRcblx0XHR0aGlzLnJlbmRlcmVyID0gbnVsbDtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLyBTZXR1cCBGdW5jdGlvbnMgLy8vLy8vLy8vLy8vLy8vLy9cblx0XG5cdGNyZWF0ZUhvbGRlckVsZW1lbnQgKCl7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXRhYmxlaG9sZGVyXCIpO1xuXHRcdGVsLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIDApO1xuXHRcdC8vIGVsLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJyb3dncm91cFwiKTtcblx0XHRcblx0XHRyZXR1cm4gZWw7XG5cdH1cblx0XG5cdGNyZWF0ZVRhYmxlRWxlbWVudCAoKXtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItdGFibGVcIik7XG5cdFx0ZWwuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcInJvd2dyb3VwXCIpO1xuXHRcdFxuXHRcdHJldHVybiBlbDtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZVBsYWNlaG9sZGVyKCl7XG5cdFx0dmFyIHBsYWNlaG9sZGVyID0gdGhpcy50YWJsZS5vcHRpb25zLnBsYWNlaG9sZGVyO1xuXHRcdFxuXHRcdGlmKHR5cGVvZiBwbGFjZWhvbGRlciA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdHBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXIuY2FsbCh0aGlzLnRhYmxlKTtcblx0XHR9XG5cdFx0XG5cdFx0cGxhY2Vob2xkZXIgPSB0aGlzLmNoYWluKFwicGxhY2Vob2xkZXJcIiwgW3BsYWNlaG9sZGVyXSwgcGxhY2Vob2xkZXIsIHBsYWNlaG9sZGVyKSB8fCBwbGFjZWhvbGRlcjtcblx0XHRcblx0XHQvL2NvbmZpZ3VyZSBwbGFjZWhvbGRlciBlbGVtZW50XG5cdFx0aWYocGxhY2Vob2xkZXIpe1x0XG5cdFx0XHRsZXQgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1wbGFjZWhvbGRlclwiKTtcblx0XHRcdFxuXHRcdFx0aWYodHlwZW9mIHBsYWNlaG9sZGVyID09IFwic3RyaW5nXCIpe1xuXHRcdFx0XHRsZXQgY29udGVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdFx0XHRjb250ZW50cy5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXBsYWNlaG9sZGVyLWNvbnRlbnRzXCIpO1xuXHRcdFx0XHRjb250ZW50cy5pbm5lckhUTUwgPSBwbGFjZWhvbGRlcjtcblx0XHRcdFx0XG5cdFx0XHRcdGVsLmFwcGVuZENoaWxkKGNvbnRlbnRzKTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMucGxhY2Vob2xkZXJDb250ZW50cyA9IGNvbnRlbnRzO1xuXHRcdFx0XHRcblx0XHRcdH1lbHNlIGlmKHR5cGVvZiBIVE1MRWxlbWVudCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwbGFjZWhvbGRlciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KXtcblx0XHRcdFx0XG5cdFx0XHRcdGVsLmFwcGVuZENoaWxkKHBsYWNlaG9sZGVyKTtcblx0XHRcdFx0dGhpcy5wbGFjZWhvbGRlckNvbnRlbnRzID0gcGxhY2Vob2xkZXI7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIkludmFsaWQgcGxhY2Vob2xkZXIgcHJvdmlkZWQsIG11c3QgYmUgc3RyaW5nIG9yIEhUTUwgRWxlbWVudFwiLCBwbGFjZWhvbGRlcik7XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLmVsID0gbnVsbDtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0dGhpcy5wbGFjZWhvbGRlciA9IGVsO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9yZXR1cm4gY29udGFpbmluZyBlbGVtZW50XG5cdGdldEVsZW1lbnQoKXtcblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9XG5cdFxuXHQvL3JldHVybiB0YWJsZSBlbGVtZW50XG5cdGdldFRhYmxlRWxlbWVudCgpe1xuXHRcdHJldHVybiB0aGlzLnRhYmxlRWxlbWVudDtcblx0fVxuXHRcblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMuaW5pdGlhbGl6ZVBsYWNlaG9sZGVyKCk7XG5cdFx0dGhpcy5pbml0aWFsaXplUmVuZGVyZXIoKTtcblx0XHRcblx0XHQvL2luaXRpYWxpemUgbWFuYWdlclxuXHRcdHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnRhYmxlRWxlbWVudCk7XG5cdFx0XG5cdFx0dGhpcy5maXJzdFJlbmRlciA9IHRydWU7XG5cdFx0XG5cdFx0Ly9zY3JvbGwgaGVhZGVyIGFsb25nIHdpdGggdGFibGUgYm9keVxuXHRcdHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsICgpID0+IHtcblx0XHRcdHZhciBsZWZ0ID0gdGhpcy5lbGVtZW50LnNjcm9sbExlZnQsXG5cdFx0XHRsZWZ0RGlyID0gdGhpcy5zY3JvbGxMZWZ0ID4gbGVmdCxcblx0XHRcdHRvcCA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3AsXG5cdFx0XHR0b3BEaXIgPSB0aGlzLnNjcm9sbFRvcCA+IHRvcDtcblx0XHRcdFxuXHRcdFx0Ly9oYW5kbGUgaG9yaXpvbnRhbCBzY3JvbGxpbmdcblx0XHRcdGlmKHRoaXMuc2Nyb2xsTGVmdCAhPSBsZWZ0KXtcblx0XHRcdFx0dGhpcy5zY3JvbGxMZWZ0ID0gbGVmdDtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2goXCJzY3JvbGwtaG9yaXpvbnRhbFwiLCBsZWZ0LCBsZWZ0RGlyKTtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwic2Nyb2xsSG9yaXpvbnRhbFwiLCBsZWZ0LCBsZWZ0RGlyKTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuX3Bvc2l0aW9uUGxhY2Vob2xkZXIoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Ly9oYW5kbGUgdmVydGljYWwgc2Nyb2xsaW5nXG5cdFx0XHRpZih0aGlzLnNjcm9sbFRvcCAhPSB0b3Ape1xuXHRcdFx0XHR0aGlzLnNjcm9sbFRvcCA9IHRvcDtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMucmVuZGVyZXIuc2Nyb2xsUm93cyh0b3AsIHRvcERpcik7XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLmRpc3BhdGNoKFwic2Nyb2xsLXZlcnRpY2FsXCIsIHRvcCwgdG9wRGlyKTtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwic2Nyb2xsVmVydGljYWxcIiwgdG9wLCB0b3BEaXIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8gUm93IE1hbmlwdWxhdGlvbiAvLy8vLy8vLy8vLy8vLy8vLy9cblx0ZmluZFJvdyhzdWJqZWN0KXtcblx0XHRpZih0eXBlb2Ygc3ViamVjdCA9PSBcIm9iamVjdFwiKXtcblx0XHRcdGlmKHN1YmplY3QgaW5zdGFuY2VvZiBSb3cpe1xuXHRcdFx0XHQvL3N1YmplY3QgaXMgcm93IGVsZW1lbnRcblx0XHRcdFx0cmV0dXJuIHN1YmplY3Q7XG5cdFx0XHR9ZWxzZSBpZihzdWJqZWN0IGluc3RhbmNlb2YgUm93Q29tcG9uZW50KXtcblx0XHRcdFx0Ly9zdWJqZWN0IGlzIHB1YmxpYyByb3cgY29tcG9uZW50XG5cdFx0XHRcdHJldHVybiBzdWJqZWN0Ll9nZXRTZWxmKCkgfHwgZmFsc2U7XG5cdFx0XHR9ZWxzZSBpZih0eXBlb2YgSFRNTEVsZW1lbnQgIT09IFwidW5kZWZpbmVkXCIgJiYgc3ViamVjdCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KXtcblx0XHRcdFx0Ly9zdWJqZWN0IGlzIGEgSFRNTCBlbGVtZW50IG9mIHRoZSByb3dcblx0XHRcdFx0bGV0IG1hdGNoID0gdGhpcy5yb3dzLmZpbmQoKHJvdykgPT4ge1xuXHRcdFx0XHRcdHJldHVybiByb3cuZ2V0RWxlbWVudCgpID09PSBzdWJqZWN0O1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdHJldHVybiBtYXRjaCB8fCBmYWxzZTtcblx0XHRcdH1lbHNlIGlmKHN1YmplY3QgPT09IG51bGwpe1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fWVsc2UgaWYodHlwZW9mIHN1YmplY3QgPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Ly9zdWJqZWN0IHNob3VsZCBiZSB0cmVhdGVkIGFzIHRoZSBpbmRleCBvZiB0aGUgcm93XG5cdFx0XHRsZXQgbWF0Y2ggPSB0aGlzLnJvd3MuZmluZCgocm93KSA9PiB7XG5cdFx0XHRcdHJldHVybiByb3cuZGF0YVt0aGlzLnRhYmxlLm9wdGlvbnMuaW5kZXhdID09IHN1YmplY3Q7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0cmV0dXJuIG1hdGNoIHx8IGZhbHNlO1xuXHRcdH1cblx0XHRcblx0XHQvL2NhdGNoIGFsbCBmb3IgYW55IG90aGVyIHR5cGUgb2YgaW5wdXRcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0XG5cdGdldFJvd0Zyb21EYXRhT2JqZWN0KGRhdGEpe1xuXHRcdHZhciBtYXRjaCA9IHRoaXMucm93cy5maW5kKChyb3cpID0+IHtcblx0XHRcdHJldHVybiByb3cuZGF0YSA9PT0gZGF0YTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gbWF0Y2ggfHwgZmFsc2U7XG5cdH1cblx0XG5cdGdldFJvd0Zyb21Qb3NpdGlvbihwb3NpdGlvbil7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0RGlzcGxheVJvd3MoKS5maW5kKChyb3cpID0+IHtcblx0XHRcdHJldHVybiByb3cudHlwZSA9PT0gXCJyb3dcIiAmJiByb3cuZ2V0UG9zaXRpb24oKSA9PT0gcG9zaXRpb24gJiYgcm93LmlzRGlzcGxheWVkKCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdHNjcm9sbFRvUm93KHJvdywgcG9zaXRpb24sIGlmVmlzaWJsZSl7XG5cdFx0cmV0dXJuIHRoaXMucmVuZGVyZXIuc2Nyb2xsVG9Sb3dQb3NpdGlvbihyb3csIHBvc2l0aW9uLCBpZlZpc2libGUpO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8vLy8gRGF0YSBIYW5kbGluZyAvLy8vLy8vLy8vLy8vLy8vLy9cblx0c2V0RGF0YShkYXRhLCByZW5kZXJJblBvc2l0aW9uLCBjb2x1bW5zQ2hhbmdlZCl7XG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpPT57XG5cdFx0XHRpZihyZW5kZXJJblBvc2l0aW9uICYmIHRoaXMuZ2V0RGlzcGxheVJvd3MoKS5sZW5ndGgpe1xuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucGFnaW5hdGlvbil7XG5cdFx0XHRcdFx0dGhpcy5fc2V0RGF0YUFjdHVhbChkYXRhLCB0cnVlKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHRoaXMucmVSZW5kZXJJblBvc2l0aW9uKCgpID0+IHtcblx0XHRcdFx0XHRcdHRoaXMuX3NldERhdGFBY3R1YWwoZGF0YSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmF1dG9Db2x1bW5zICYmIGNvbHVtbnNDaGFuZ2VkICYmIHRoaXMudGFibGUuaW5pdGlhbGl6ZWQpe1xuXHRcdFx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZW5lcmF0ZUNvbHVtbnNGcm9tUm93RGF0YShkYXRhKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLnJlc2V0U2Nyb2xsKCk7XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLl9zZXREYXRhQWN0dWFsKGRhdGEpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRyZXNvbHZlKCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdF9zZXREYXRhQWN0dWFsKGRhdGEsIHJlbmRlckluUG9zaXRpb24pe1xuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFQcm9jZXNzaW5nXCIsIGRhdGEpO1xuXHRcdFxuXHRcdHRoaXMuX3dpcGVFbGVtZW50cygpO1xuXHRcdFxuXHRcdGlmKEFycmF5LmlzQXJyYXkoZGF0YSkpe1xuXHRcdFx0dGhpcy5kaXNwYXRjaChcImRhdGEtcHJvY2Vzc2luZ1wiLCBkYXRhKTtcblx0XHRcdFxuXHRcdFx0ZGF0YS5mb3JFYWNoKChkZWYsIGkpID0+IHtcblx0XHRcdFx0aWYoZGVmICYmIHR5cGVvZiBkZWYgPT09IFwib2JqZWN0XCIpe1xuXHRcdFx0XHRcdHZhciByb3cgPSBuZXcgUm93KGRlZiwgdGhpcyk7XG5cdFx0XHRcdFx0dGhpcy5yb3dzLnB1c2gocm93KTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkRhdGEgTG9hZGluZyBXYXJuaW5nIC0gSW52YWxpZCByb3cgZGF0YSBkZXRlY3RlZCBhbmQgaWdub3JlZCwgZXhwZWN0aW5nIG9iamVjdCBidXQgcmVjZWl2ZWQ6XCIsIGRlZik7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnJlZnJlc2hBY3RpdmVEYXRhKGZhbHNlLCBmYWxzZSwgcmVuZGVySW5Qb3NpdGlvbik7XG5cdFx0XHRcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJkYXRhLXByb2Nlc3NlZFwiLCBkYXRhKTtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFQcm9jZXNzZWRcIiwgZGF0YSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcIkRhdGEgTG9hZGluZyBFcnJvciAtIFVuYWJsZSB0byBwcm9jZXNzIGRhdGEgZHVlIHRvIGludmFsaWQgZGF0YSB0eXBlIFxcbkV4cGVjdGluZzogYXJyYXkgXFxuUmVjZWl2ZWQ6IFwiLCB0eXBlb2YgZGF0YSwgXCJcXG5EYXRhOiAgICAgXCIsIGRhdGEpO1xuXHRcdH1cblx0fVxuXHRcblx0X3dpcGVFbGVtZW50cygpe1xuXHRcdHRoaXMuZGlzcGF0Y2goXCJyb3dzLXdpcGVcIik7XG5cdFx0XG5cdFx0dGhpcy5kZXN0cm95KCk7XG5cdFx0XG5cdFx0dGhpcy5hZGp1c3RUYWJsZVNpemUoKTtcblx0XHRcblx0XHR0aGlzLmRpc3BhdGNoKFwicm93cy13aXBlZFwiKTtcblx0fVxuXHRcblx0ZGVzdHJveSgpe1xuXHRcdHRoaXMucm93cy5mb3JFYWNoKChyb3cpID0+IHtcblx0XHRcdHJvdy53aXBlKCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy5yb3dzID0gW107XG5cdFx0dGhpcy5hY3RpdmVSb3dzID0gW107XG5cdFx0dGhpcy5hY3RpdmVSb3dzUGlwZWxpbmUgPSBbXTtcblx0XHR0aGlzLmFjdGl2ZVJvd3NDb3VudCA9IDA7XG5cdFx0dGhpcy5kaXNwbGF5Um93cyA9IFtdO1xuXHRcdHRoaXMuZGlzcGxheVJvd3NDb3VudCA9IDA7XG5cdH1cblx0XG5cdGRlbGV0ZVJvdyhyb3csIGJsb2NrUmVkcmF3KXtcblx0XHR2YXIgYWxsSW5kZXggPSB0aGlzLnJvd3MuaW5kZXhPZihyb3cpLFxuXHRcdGFjdGl2ZUluZGV4ID0gdGhpcy5hY3RpdmVSb3dzLmluZGV4T2Yocm93KTtcblx0XHRcblx0XHRpZihhY3RpdmVJbmRleCA+IC0xKXtcblx0XHRcdHRoaXMuYWN0aXZlUm93cy5zcGxpY2UoYWN0aXZlSW5kZXgsIDEpO1xuXHRcdH1cblx0XHRcblx0XHRpZihhbGxJbmRleCA+IC0xKXtcblx0XHRcdHRoaXMucm93cy5zcGxpY2UoYWxsSW5kZXgsIDEpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLnNldEFjdGl2ZVJvd3ModGhpcy5hY3RpdmVSb3dzKTtcblx0XHRcblx0XHR0aGlzLmRpc3BsYXlSb3dJdGVyYXRvcigocm93cykgPT4ge1xuXHRcdFx0dmFyIGRpc3BsYXlJbmRleCA9IHJvd3MuaW5kZXhPZihyb3cpO1xuXHRcdFx0XG5cdFx0XHRpZihkaXNwbGF5SW5kZXggPiAtMSl7XG5cdFx0XHRcdHJvd3Muc3BsaWNlKGRpc3BsYXlJbmRleCwgMSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0aWYoIWJsb2NrUmVkcmF3KXtcblx0XHRcdHRoaXMucmVSZW5kZXJJblBvc2l0aW9uKCk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMucmVnZW5lcmF0ZVJvd1Bvc2l0aW9ucygpO1xuXHRcdFxuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInJvd0RlbGV0ZWRcIiwgcm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcblx0XHRpZighdGhpcy5kaXNwbGF5Um93c0NvdW50KXtcblx0XHRcdHRoaXMudGFibGVFbXB0eSgpO1xuXHRcdH1cblx0XHRcblx0XHRpZih0aGlzLnN1YnNjcmliZWRFeHRlcm5hbChcImRhdGFDaGFuZ2VkXCIpKXtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFDaGFuZ2VkXCIsIHRoaXMuZ2V0RGF0YSgpKTtcblx0XHR9XG5cdH1cblx0XG5cdGFkZFJvdyhkYXRhLCBwb3MsIGluZGV4LCBibG9ja1JlZHJhdyl7XG5cdFx0dmFyIHJvdyA9IHRoaXMuYWRkUm93QWN0dWFsKGRhdGEsIHBvcywgaW5kZXgsIGJsb2NrUmVkcmF3KTtcblx0XHRyZXR1cm4gcm93O1xuXHR9XG5cdFxuXHQvL2FkZCBtdWx0aXBsZSByb3dzXG5cdGFkZFJvd3MoZGF0YSwgcG9zLCBpbmRleCwgcmVmcmVzaERpc3BsYXlPbmx5KXtcblx0XHR2YXIgcm93cyA9IFtdO1xuXHRcdFxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRwb3MgPSB0aGlzLmZpbmRBZGRSb3dQb3MocG9zKTtcblx0XHRcdFxuXHRcdFx0aWYoIUFycmF5LmlzQXJyYXkoZGF0YSkpe1xuXHRcdFx0XHRkYXRhID0gW2RhdGFdO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZigodHlwZW9mIGluZGV4ID09IFwidW5kZWZpbmVkXCIgJiYgcG9zKSB8fCAodHlwZW9mIGluZGV4ICE9PSBcInVuZGVmaW5lZFwiICYmICFwb3MpKXtcblx0XHRcdFx0ZGF0YS5yZXZlcnNlKCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGRhdGEuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xuXHRcdFx0XHR2YXIgcm93ID0gdGhpcy5hZGRSb3coaXRlbSwgcG9zLCBpbmRleCwgdHJ1ZSk7XG5cdFx0XHRcdHJvd3MucHVzaChyb3cpO1xuXHRcdFx0XHR0aGlzLmRpc3BhdGNoKFwicm93LWFkZGVkXCIsIHJvdywgaXRlbSwgcG9zLCBpbmRleCk7XG5cdFx0XHR9KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5yZWZyZXNoQWN0aXZlRGF0YShyZWZyZXNoRGlzcGxheU9ubHkgPyBcImRpc3BsYXlQaXBlbGluZVwiIDogZmFsc2UsIGZhbHNlLCB0cnVlKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5yZWdlbmVyYXRlUm93UG9zaXRpb25zKCk7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuZGlzcGxheVJvd3NDb3VudCl7XG5cdFx0XHRcdHRoaXMuX2NsZWFyUGxhY2Vob2xkZXIoKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0cmVzb2x2ZShyb3dzKTtcblx0XHR9KTtcblx0fVxuXHRcblx0ZmluZEFkZFJvd1Bvcyhwb3Mpe1xuXHRcdGlmKHR5cGVvZiBwb3MgPT09IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0cG9zID0gdGhpcy50YWJsZS5vcHRpb25zLmFkZFJvd1Bvcztcblx0XHR9XG5cdFx0XG5cdFx0aWYocG9zID09PSBcInBvc1wiKXtcblx0XHRcdHBvcyA9IHRydWU7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHBvcyA9PT0gXCJib3R0b21cIil7XG5cdFx0XHRwb3MgPSBmYWxzZTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHBvcztcblx0fVxuXHRcblx0YWRkUm93QWN0dWFsKGRhdGEsIHBvcywgaW5kZXgsIGJsb2NrUmVkcmF3KXtcblx0XHR2YXIgcm93ID0gZGF0YSBpbnN0YW5jZW9mIFJvdyA/IGRhdGEgOiBuZXcgUm93KGRhdGEgfHwge30sIHRoaXMpLFxuXHRcdHRvcCA9IHRoaXMuZmluZEFkZFJvd1Bvcyhwb3MpLFxuXHRcdGFsbEluZGV4ID0gLTEsXG5cdFx0YWN0aXZlSW5kZXgsIGNoYWluUmVzdWx0O1xuXHRcdFxuXHRcdGlmKCFpbmRleCl7XG5cdFx0XHRjaGFpblJlc3VsdCA9IHRoaXMuY2hhaW4oXCJyb3ctYWRkaW5nLXBvc2l0aW9uXCIsIFtyb3csIHRvcF0sIG51bGwsIHtpbmRleCwgdG9wfSk7XG5cdFx0XHRcblx0XHRcdGluZGV4ID0gY2hhaW5SZXN1bHQuaW5kZXg7XG5cdFx0XHR0b3AgPSBjaGFpblJlc3VsdC50b3A7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHR5cGVvZiBpbmRleCAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRpbmRleCA9IHRoaXMuZmluZFJvdyhpbmRleCk7XG5cdFx0fVxuXHRcdFxuXHRcdGluZGV4ID0gdGhpcy5jaGFpbihcInJvdy1hZGRpbmctaW5kZXhcIiwgW3JvdywgaW5kZXgsIHRvcF0sIG51bGwsIGluZGV4KTtcblx0XHRcblx0XHRpZihpbmRleCl7XG5cdFx0XHRhbGxJbmRleCA9IHRoaXMucm93cy5pbmRleE9mKGluZGV4KTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoaW5kZXggJiYgYWxsSW5kZXggPiAtMSl7XG5cdFx0XHRhY3RpdmVJbmRleCA9IHRoaXMuYWN0aXZlUm93cy5pbmRleE9mKGluZGV4KTtcblx0XHRcdFxuXHRcdFx0dGhpcy5kaXNwbGF5Um93SXRlcmF0b3IoZnVuY3Rpb24ocm93cyl7XG5cdFx0XHRcdHZhciBkaXNwbGF5SW5kZXggPSByb3dzLmluZGV4T2YoaW5kZXgpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoZGlzcGxheUluZGV4ID4gLTEpe1xuXHRcdFx0XHRcdHJvd3Muc3BsaWNlKCh0b3AgPyBkaXNwbGF5SW5kZXggOiBkaXNwbGF5SW5kZXggKyAxKSwgMCwgcm93KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdGlmKGFjdGl2ZUluZGV4ID4gLTEpe1xuXHRcdFx0XHR0aGlzLmFjdGl2ZVJvd3Muc3BsaWNlKCh0b3AgPyBhY3RpdmVJbmRleCA6IGFjdGl2ZUluZGV4ICsgMSksIDAsIHJvdyk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMucm93cy5zcGxpY2UoKHRvcCA/IGFsbEluZGV4IDogYWxsSW5kZXggKyAxKSwgMCwgcm93KTtcblx0XHRcdFxuXHRcdH1lbHNlIHtcblx0XHRcdFxuXHRcdFx0aWYodG9wKXtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuZGlzcGxheVJvd0l0ZXJhdG9yKGZ1bmN0aW9uKHJvd3Mpe1xuXHRcdFx0XHRcdHJvd3MudW5zaGlmdChyb3cpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuYWN0aXZlUm93cy51bnNoaWZ0KHJvdyk7XG5cdFx0XHRcdHRoaXMucm93cy51bnNoaWZ0KHJvdyk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuZGlzcGxheVJvd0l0ZXJhdG9yKGZ1bmN0aW9uKHJvd3Mpe1xuXHRcdFx0XHRcdHJvd3MucHVzaChyb3cpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHRcdHRoaXMuYWN0aXZlUm93cy5wdXNoKHJvdyk7XG5cdFx0XHRcdHRoaXMucm93cy5wdXNoKHJvdyk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuc2V0QWN0aXZlUm93cyh0aGlzLmFjdGl2ZVJvd3MpO1xuXHRcdFxuXHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcInJvd0FkZGVkXCIsIHJvdy5nZXRDb21wb25lbnQoKSk7XG5cdFx0XG5cdFx0aWYodGhpcy5zdWJzY3JpYmVkRXh0ZXJuYWwoXCJkYXRhQ2hhbmdlZFwiKSl7XG5cdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJkYXRhQ2hhbmdlZFwiLCB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGF0YSgpKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoIWJsb2NrUmVkcmF3KXtcblx0XHRcdHRoaXMucmVSZW5kZXJJblBvc2l0aW9uKCk7XG5cdFx0fVxuXHRcdFxuXHRcdHJldHVybiByb3c7XG5cdH1cblx0XG5cdG1vdmVSb3coZnJvbSwgdG8sIGFmdGVyKXtcblx0XHR0aGlzLmRpc3BhdGNoKFwicm93LW1vdmVcIiwgZnJvbSwgdG8sIGFmdGVyKTtcblx0XHRcblx0XHR0aGlzLm1vdmVSb3dBY3R1YWwoZnJvbSwgdG8sIGFmdGVyKTtcblx0XHRcblx0XHR0aGlzLnJlZ2VuZXJhdGVSb3dQb3NpdGlvbnMoKTtcblx0XHRcblx0XHR0aGlzLmRpc3BhdGNoKFwicm93LW1vdmVkXCIsIGZyb20sIHRvLCBhZnRlcik7XG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicm93TW92ZWRcIiwgZnJvbS5nZXRDb21wb25lbnQoKSk7XG5cdH1cblx0XG5cdG1vdmVSb3dBY3R1YWwoZnJvbSwgdG8sIGFmdGVyKXtcblx0XHR0aGlzLm1vdmVSb3dJbkFycmF5KHRoaXMucm93cywgZnJvbSwgdG8sIGFmdGVyKTtcblx0XHR0aGlzLm1vdmVSb3dJbkFycmF5KHRoaXMuYWN0aXZlUm93cywgZnJvbSwgdG8sIGFmdGVyKTtcblx0XHRcblx0XHR0aGlzLmRpc3BsYXlSb3dJdGVyYXRvcigocm93cykgPT4ge1xuXHRcdFx0dGhpcy5tb3ZlUm93SW5BcnJheShyb3dzLCBmcm9tLCB0bywgYWZ0ZXIpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHRoaXMuZGlzcGF0Y2goXCJyb3ctbW92aW5nXCIsIGZyb20sIHRvLCBhZnRlcik7XG5cdH1cblx0XG5cdG1vdmVSb3dJbkFycmF5KHJvd3MsIGZyb20sIHRvLCBhZnRlcil7XG5cdFx0dmFyXHRmcm9tSW5kZXgsIHRvSW5kZXgsIHN0YXJ0LCBlbmQ7XG5cdFx0XG5cdFx0aWYoZnJvbSAhPT0gdG8pe1xuXHRcdFx0XG5cdFx0XHRmcm9tSW5kZXggPSByb3dzLmluZGV4T2YoZnJvbSk7XG5cdFx0XHRcblx0XHRcdGlmIChmcm9tSW5kZXggPiAtMSkge1xuXHRcdFx0XHRcblx0XHRcdFx0cm93cy5zcGxpY2UoZnJvbUluZGV4LCAxKTtcblx0XHRcdFx0XG5cdFx0XHRcdHRvSW5kZXggPSByb3dzLmluZGV4T2YodG8pO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYgKHRvSW5kZXggPiAtMSkge1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKGFmdGVyKXtcblx0XHRcdFx0XHRcdHJvd3Muc3BsaWNlKHRvSW5kZXgrMSwgMCwgZnJvbSk7XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0cm93cy5zcGxpY2UodG9JbmRleCwgMCwgZnJvbSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0cm93cy5zcGxpY2UoZnJvbUluZGV4LCAwLCBmcm9tKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHQvL3Jlc3R5bGUgcm93c1xuXHRcdFx0aWYocm93cyA9PT0gdGhpcy5nZXREaXNwbGF5Um93cygpKXtcblx0XHRcdFx0XG5cdFx0XHRcdHN0YXJ0ID0gZnJvbUluZGV4IDwgdG9JbmRleCA/IGZyb21JbmRleCA6IHRvSW5kZXg7XG5cdFx0XHRcdGVuZCA9IHRvSW5kZXggPiBmcm9tSW5kZXggPyB0b0luZGV4IDogZnJvbUluZGV4ICsxO1xuXHRcdFx0XHRcblx0XHRcdFx0Zm9yKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpKyspe1xuXHRcdFx0XHRcdGlmKHJvd3NbaV0pe1xuXHRcdFx0XHRcdFx0dGhpcy5zdHlsZVJvdyhyb3dzW2ldLCBpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdGNsZWFyRGF0YSgpe1xuXHRcdHRoaXMuc2V0RGF0YShbXSk7XG5cdH1cblx0XG5cdGdldFJvd0luZGV4KHJvdyl7XG5cdFx0cmV0dXJuIHRoaXMuZmluZFJvd0luZGV4KHJvdywgdGhpcy5yb3dzKTtcblx0fVxuXHRcblx0Z2V0RGlzcGxheVJvd0luZGV4KHJvdyl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy5nZXREaXNwbGF5Um93cygpLmluZGV4T2Yocm93KTtcblx0XHRyZXR1cm4gaW5kZXggPiAtMSA/IGluZGV4IDogZmFsc2U7XG5cdH1cblx0XG5cdG5leHREaXNwbGF5Um93KHJvdywgcm93T25seSl7XG5cdFx0dmFyIGluZGV4ID0gdGhpcy5nZXREaXNwbGF5Um93SW5kZXgocm93KSxcblx0XHRuZXh0Um93ID0gZmFsc2U7XG5cdFx0XG5cdFx0XG5cdFx0aWYoaW5kZXggIT09IGZhbHNlICYmIGluZGV4IDwgdGhpcy5kaXNwbGF5Um93c0NvdW50IC0xKXtcblx0XHRcdG5leHRSb3cgPSB0aGlzLmdldERpc3BsYXlSb3dzKClbaW5kZXgrMV07XG5cdFx0fVxuXHRcdFxuXHRcdGlmKG5leHRSb3cgJiYgKCEobmV4dFJvdyBpbnN0YW5jZW9mIFJvdykgfHwgbmV4dFJvdy50eXBlICE9IFwicm93XCIpKXtcblx0XHRcdHJldHVybiB0aGlzLm5leHREaXNwbGF5Um93KG5leHRSb3csIHJvd09ubHkpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gbmV4dFJvdztcblx0fVxuXHRcblx0cHJldkRpc3BsYXlSb3cocm93LCByb3dPbmx5KXtcblx0XHR2YXIgaW5kZXggPSB0aGlzLmdldERpc3BsYXlSb3dJbmRleChyb3cpLFxuXHRcdHByZXZSb3cgPSBmYWxzZTtcblx0XHRcblx0XHRpZihpbmRleCl7XG5cdFx0XHRwcmV2Um93ID0gdGhpcy5nZXREaXNwbGF5Um93cygpW2luZGV4LTFdO1xuXHRcdH1cblx0XHRcblx0XHRpZihyb3dPbmx5ICYmIHByZXZSb3cgJiYgKCEocHJldlJvdyBpbnN0YW5jZW9mIFJvdykgfHwgcHJldlJvdy50eXBlICE9IFwicm93XCIpKXtcblx0XHRcdHJldHVybiB0aGlzLnByZXZEaXNwbGF5Um93KHByZXZSb3csIHJvd09ubHkpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gcHJldlJvdztcblx0fVxuXHRcblx0ZmluZFJvd0luZGV4KHJvdywgbGlzdCl7XG5cdFx0dmFyIHJvd0luZGV4O1xuXHRcdFxuXHRcdHJvdyA9IHRoaXMuZmluZFJvdyhyb3cpO1xuXHRcdFxuXHRcdGlmKHJvdyl7XG5cdFx0XHRyb3dJbmRleCA9IGxpc3QuaW5kZXhPZihyb3cpO1xuXHRcdFx0XG5cdFx0XHRpZihyb3dJbmRleCA+IC0xKXtcblx0XHRcdFx0cmV0dXJuIHJvd0luZGV4O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0XG5cdGdldERhdGEoYWN0aXZlLCB0cmFuc2Zvcm0pe1xuXHRcdHZhciBvdXRwdXQgPSBbXSxcblx0XHRyb3dzID0gdGhpcy5nZXRSb3dzKGFjdGl2ZSk7XG5cdFx0XG5cdFx0cm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHRpZihyb3cudHlwZSA9PSBcInJvd1wiKXtcblx0XHRcdFx0b3V0cHV0LnB1c2gocm93LmdldERhdGEodHJhbnNmb3JtIHx8IFwiZGF0YVwiKSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXHRcblx0Z2V0Q29tcG9uZW50cyhhY3RpdmUpe1xuXHRcdHZhclx0b3V0cHV0ID0gW10sXG5cdFx0cm93cyA9IHRoaXMuZ2V0Um93cyhhY3RpdmUpO1xuXHRcdFxuXHRcdHJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpe1xuXHRcdFx0b3V0cHV0LnB1c2gocm93LmdldENvbXBvbmVudCgpKTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHRnZXREYXRhQ291bnQoYWN0aXZlKXtcblx0XHR2YXIgcm93cyA9IHRoaXMuZ2V0Um93cyhhY3RpdmUpO1xuXHRcdFxuXHRcdHJldHVybiByb3dzLmxlbmd0aDtcblx0fVxuXHRcblx0c2Nyb2xsSG9yaXpvbnRhbChsZWZ0KXtcblx0XHR0aGlzLnNjcm9sbExlZnQgPSBsZWZ0O1xuXHRcdHRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0ID0gbGVmdDtcblx0XHRcblx0XHR0aGlzLmRpc3BhdGNoKFwic2Nyb2xsLWhvcml6b250YWxcIiwgbGVmdCk7XG5cdH1cblx0XG5cdHJlZ2lzdGVyRGF0YVBpcGVsaW5lSGFuZGxlcihoYW5kbGVyLCBwcmlvcml0eSl7XG5cdFx0aWYodHlwZW9mIHByaW9yaXR5ICE9PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdHRoaXMuZGF0YVBpcGVsaW5lLnB1c2goe2hhbmRsZXIsIHByaW9yaXR5fSk7XG5cdFx0XHR0aGlzLmRhdGFQaXBlbGluZS5zb3J0KChhLCBiKSA9PiB7XG5cdFx0XHRcdHJldHVybiBhLnByaW9yaXR5IC0gYi5wcmlvcml0eTtcblx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJEYXRhIHBpcGVsaW5lIGhhbmRsZXJzIG11c3QgaGF2ZSBhIHByaW9yaXR5IGluIG9yZGVyIHRvIGJlIHJlZ2lzdGVyZWRcIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRyZWdpc3RlckRpc3BsYXlQaXBlbGluZUhhbmRsZXIoaGFuZGxlciwgcHJpb3JpdHkpe1xuXHRcdGlmKHR5cGVvZiBwcmlvcml0eSAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHR0aGlzLmRpc3BsYXlQaXBlbGluZS5wdXNoKHtoYW5kbGVyLCBwcmlvcml0eX0pO1xuXHRcdFx0dGhpcy5kaXNwbGF5UGlwZWxpbmUuc29ydCgoYSwgYikgPT4ge1xuXHRcdFx0XHRyZXR1cm4gYS5wcmlvcml0eSAtIGIucHJpb3JpdHk7XG5cdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiRGlzcGxheSBwaXBlbGluZSBoYW5kbGVycyBtdXN0IGhhdmUgYSBwcmlvcml0eSBpbiBvcmRlciB0byBiZSByZWdpc3RlcmVkXCIpO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9zZXQgYWN0aXZlIGRhdGEgc2V0XG5cdHJlZnJlc2hBY3RpdmVEYXRhKGhhbmRsZXIsIHNraXBTdGFnZSwgcmVuZGVySW5Qb3NpdGlvbil7XG5cdFx0dmFyIHRhYmxlID0gdGhpcy50YWJsZSxcblx0XHRzdGFnZSA9IFwiXCIsXG5cdFx0aW5kZXggPSAwLFxuXHRcdGNhc2NhZGVPcmRlciA9IFtcImFsbFwiLCBcImRhdGFQaXBlbGluZVwiLCBcImRpc3BsYXlcIiwgXCJkaXNwbGF5UGlwZWxpbmVcIiwgXCJlbmRcIl07XG5cdFx0XG5cdFx0aWYoIXRoaXMudGFibGUuZGVzdHJveWVkKXtcblx0XHRcdGlmKHR5cGVvZiBoYW5kbGVyID09PSBcImZ1bmN0aW9uXCIpe1xuXHRcdFx0XHRpbmRleCA9IHRoaXMuZGF0YVBpcGVsaW5lLmZpbmRJbmRleCgoaXRlbSkgPT4ge1xuXHRcdFx0XHRcdHJldHVybiBpdGVtLmhhbmRsZXIgPT09IGhhbmRsZXI7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHRcdFx0c3RhZ2UgPSBcImRhdGFQaXBlbGluZVwiO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKHNraXBTdGFnZSl7XG5cdFx0XHRcdFx0XHRpZihpbmRleCA9PSB0aGlzLmRhdGFQaXBlbGluZS5sZW5ndGggLSAxKXtcblx0XHRcdFx0XHRcdFx0c3RhZ2UgPSBcImRpc3BsYXlcIjtcblx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0aW5kZXgrKztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRpbmRleCA9IHRoaXMuZGlzcGxheVBpcGVsaW5lLmZpbmRJbmRleCgoaXRlbSkgPT4ge1xuXHRcdFx0XHRcdFx0cmV0dXJuIGl0ZW0uaGFuZGxlciA9PT0gaGFuZGxlcjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZihpbmRleCA+IC0xKXtcblx0XHRcdFx0XHRcdHN0YWdlID0gXCJkaXNwbGF5UGlwZWxpbmVcIjtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0aWYoc2tpcFN0YWdlKXtcblx0XHRcdFx0XHRcdFx0aWYoaW5kZXggPT0gdGhpcy5kaXNwbGF5UGlwZWxpbmUubGVuZ3RoIC0gMSl7XG5cdFx0XHRcdFx0XHRcdFx0c3RhZ2UgPSBcImVuZFwiO1xuXHRcdFx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0aW5kZXgrKztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gcmVmcmVzaCBkYXRhLCBpbnZhbGlkIGhhbmRsZXIgcHJvdmlkZWRcIiwgaGFuZGxlcik7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHN0YWdlID0gaGFuZGxlciB8fCBcImFsbFwiO1xuXHRcdFx0XHRpbmRleCA9IDA7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMucmVkcmF3QmxvY2spe1xuXHRcdFx0XHRpZighdGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcgfHwgKHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnICYmICgodGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcuc3RhZ2UgPT09IHN0YWdlICYmIGluZGV4IDwgdGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcuaW5kZXgpIHx8IChjYXNjYWRlT3JkZXIuaW5kZXhPZihzdGFnZSkgPCBjYXNjYWRlT3JkZXIuaW5kZXhPZih0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZy5zdGFnZSkpKSkpe1xuXHRcdFx0XHRcdHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnID0ge1xuXHRcdFx0XHRcdFx0aGFuZGxlcjogaGFuZGxlcixcblx0XHRcdFx0XHRcdHNraXBTdGFnZTogc2tpcFN0YWdlLFxuXHRcdFx0XHRcdFx0cmVuZGVySW5Qb3NpdGlvbjogcmVuZGVySW5Qb3NpdGlvbixcblx0XHRcdFx0XHRcdHN0YWdlOnN0YWdlLFxuXHRcdFx0XHRcdFx0aW5kZXg6aW5kZXgsXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZihIZWxwZXJzLmVsVmlzaWJsZSh0aGlzLmVsZW1lbnQpKXtcblx0XHRcdFx0XHRpZihyZW5kZXJJblBvc2l0aW9uKXtcblx0XHRcdFx0XHRcdHRoaXMucmVSZW5kZXJJblBvc2l0aW9uKHRoaXMucmVmcmVzaFBpcGVsaW5lcy5iaW5kKHRoaXMsIGhhbmRsZXIsIHN0YWdlLCBpbmRleCwgcmVuZGVySW5Qb3NpdGlvbikpO1xuXHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdHRoaXMucmVmcmVzaFBpcGVsaW5lcyhoYW5kbGVyLCBzdGFnZSwgaW5kZXgsIHJlbmRlckluUG9zaXRpb24pO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRpZighaGFuZGxlcil7XG5cdFx0XHRcdFx0XHRcdHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5yZW5kZXJlci5yZW5kZXJDb2x1bW5zKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdHRoaXMucmVuZGVyVGFibGUoKTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0aWYodGFibGUub3B0aW9ucy5sYXlvdXRDb2x1bW5zT25OZXdEYXRhKXtcblx0XHRcdFx0XHRcdFx0dGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLnJlZHJhdyh0cnVlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR0aGlzLnJlZnJlc2hQaXBlbGluZXMoaGFuZGxlciwgc3RhZ2UsIGluZGV4LCByZW5kZXJJblBvc2l0aW9uKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5kaXNwYXRjaChcImRhdGEtcmVmcmVzaGVkXCIpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0cmVmcmVzaFBpcGVsaW5lcyhoYW5kbGVyLCBzdGFnZSwgaW5kZXgsIHJlbmRlckluUG9zaXRpb24pe1xuXHRcdHRoaXMuZGlzcGF0Y2goXCJkYXRhLXJlZnJlc2hpbmdcIik7XG5cdFx0XG5cdFx0aWYoIWhhbmRsZXIgfHwgIXRoaXMuYWN0aXZlUm93c1BpcGVsaW5lWzBdKXtcblx0XHRcdHRoaXMuYWN0aXZlUm93c1BpcGVsaW5lWzBdID0gdGhpcy5yb3dzLnNsaWNlKDApO1xuXHRcdH1cblx0XHRcblx0XHQvL2Nhc2NhZGUgdGhyb3VnaCBkYXRhIHJlZnJlc2ggc3RhZ2VzXG5cdFx0c3dpdGNoKHN0YWdlKXtcblx0XHRcdGNhc2UgXCJhbGxcIjpcblx0XHRcdC8vaGFuZGxlIGNhc2Ugd2hlcmUgYWxsIGRhdGEgbmVlZHMgcmVmcmVzaGluZ1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwiZGF0YVBpcGVsaW5lXCI6XG5cdFx0XHRcdGZvcihsZXQgaSA9IGluZGV4OyBpIDwgdGhpcy5kYXRhUGlwZWxpbmUubGVuZ3RoOyBpKyspe1xuXHRcdFx0XHRcdGxldCByZXN1bHQgPSB0aGlzLmRhdGFQaXBlbGluZVtpXS5oYW5kbGVyKHRoaXMuYWN0aXZlUm93c1BpcGVsaW5lW2ldLnNsaWNlKDApKTtcblx0XHRcdFx0XG5cdFx0XHRcdFx0dGhpcy5hY3RpdmVSb3dzUGlwZWxpbmVbaSArIDFdID0gcmVzdWx0IHx8IHRoaXMuYWN0aXZlUm93c1BpcGVsaW5lW2ldLnNsaWNlKDApO1xuXHRcdFx0XHR9XG5cdFx0XHRcblx0XHRcdFx0dGhpcy5zZXRBY3RpdmVSb3dzKHRoaXMuYWN0aXZlUm93c1BpcGVsaW5lW3RoaXMuZGF0YVBpcGVsaW5lLmxlbmd0aF0pO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwiZGlzcGxheVwiOlxuXHRcdFx0XHRpbmRleCA9IDA7XG5cdFx0XHRcdHRoaXMucmVzZXREaXNwbGF5Um93cygpO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwiZGlzcGxheVBpcGVsaW5lXCI6XG5cdFx0XHRcdGZvcihsZXQgaSA9IGluZGV4OyBpIDwgdGhpcy5kaXNwbGF5UGlwZWxpbmUubGVuZ3RoOyBpKyspe1xuXHRcdFx0XHRcdGxldCByZXN1bHQgPSB0aGlzLmRpc3BsYXlQaXBlbGluZVtpXS5oYW5kbGVyKChpID8gdGhpcy5nZXREaXNwbGF5Um93cyhpIC0gMSkgOiB0aGlzLmFjdGl2ZVJvd3MpLnNsaWNlKDApLCByZW5kZXJJblBvc2l0aW9uKTtcblx0XHRcdFx0XG5cdFx0XHRcdFx0dGhpcy5zZXREaXNwbGF5Um93cyhyZXN1bHQgfHwgdGhpcy5nZXREaXNwbGF5Um93cyhpIC0gMSkuc2xpY2UoMCksIGkpO1xuXHRcdFx0XHR9XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJlbmRcIjpcblx0XHRcdC8vY2FzZSB0byBoYW5kbGUgc2NlbmFyaW8gd2hlbiB0cnlpbmcgdG8gc2tpcCBwYXN0IGVuZCBzdGFnZVxuXHRcdFx0XHR0aGlzLnJlZ2VuZXJhdGVSb3dQb3NpdGlvbnMoKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYodGhpcy5nZXREaXNwbGF5Um93cygpLmxlbmd0aCl7XG5cdFx0XHR0aGlzLl9jbGVhclBsYWNlaG9sZGVyKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3JlZ2VuZXJhdGUgcm93IHBvc2l0aW9uc1xuXHRyZWdlbmVyYXRlUm93UG9zaXRpb25zKCl7XG5cdFx0dmFyIHJvd3MgPSB0aGlzLmdldERpc3BsYXlSb3dzKCk7XG5cdFx0dmFyIGluZGV4ID0gMTtcblx0XHRcblx0XHRyb3dzLmZvckVhY2goKHJvdykgPT4ge1xuXHRcdFx0aWYgKHJvdy50eXBlID09PSBcInJvd1wiKXtcblx0XHRcdFx0cm93LnNldFBvc2l0aW9uKGluZGV4KTtcblx0XHRcdFx0aW5kZXgrKztcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHRcblx0c2V0QWN0aXZlUm93cyhhY3RpdmVSb3dzKXtcblx0XHR0aGlzLmFjdGl2ZVJvd3MgPSB0aGlzLmFjdGl2ZVJvd3MgPSBPYmplY3QuYXNzaWduKFtdLCBhY3RpdmVSb3dzKTtcblx0XHR0aGlzLmFjdGl2ZVJvd3NDb3VudCA9IHRoaXMuYWN0aXZlUm93cy5sZW5ndGg7XG5cdH1cblx0XG5cdC8vcmVzZXQgZGlzcGxheSByb3dzIGFycmF5XG5cdHJlc2V0RGlzcGxheVJvd3MoKXtcblx0XHR0aGlzLmRpc3BsYXlSb3dzID0gW107XG5cdFx0XG5cdFx0dGhpcy5kaXNwbGF5Um93cy5wdXNoKHRoaXMuYWN0aXZlUm93cy5zbGljZSgwKSk7XG5cdFx0XG5cdFx0dGhpcy5kaXNwbGF5Um93c0NvdW50ID0gdGhpcy5kaXNwbGF5Um93c1swXS5sZW5ndGg7XG5cdH1cblx0XG5cdC8vc2V0IGRpc3BsYXkgcm93IHBpcGVsaW5lIGRhdGFcblx0c2V0RGlzcGxheVJvd3MoZGlzcGxheVJvd3MsIGluZGV4KXtcblx0XHR0aGlzLmRpc3BsYXlSb3dzW2luZGV4XSA9IGRpc3BsYXlSb3dzO1xuXHRcdFxuXHRcdGlmKGluZGV4ID09IHRoaXMuZGlzcGxheVJvd3MubGVuZ3RoIC0xKXtcblx0XHRcdHRoaXMuZGlzcGxheVJvd3NDb3VudCA9IHRoaXMuZGlzcGxheVJvd3NbdGhpcy5kaXNwbGF5Um93cy5sZW5ndGggLTFdLmxlbmd0aDtcblx0XHR9XG5cdH1cblx0XG5cdGdldERpc3BsYXlSb3dzKGluZGV4KXtcblx0XHRpZih0eXBlb2YgaW5kZXggPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5Um93cy5sZW5ndGggPyB0aGlzLmRpc3BsYXlSb3dzW3RoaXMuZGlzcGxheVJvd3MubGVuZ3RoIC0xXSA6IFtdO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiB0aGlzLmRpc3BsYXlSb3dzW2luZGV4XSB8fCBbXTtcblx0XHR9XG5cdH1cblx0XG5cdGdldFZpc2libGVSb3dzKGNoYWluLCB2aWV3YWJsZSl7XG5cdFx0dmFyIHJvd3MgPSAgT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5yZW5kZXJlci52aXNpYmxlUm93cyghdmlld2FibGUpKTtcblx0XHRcblx0XHRpZihjaGFpbil7XG5cdFx0XHRyb3dzID0gdGhpcy5jaGFpbihcInJvd3MtdmlzaWJsZVwiLCBbdmlld2FibGVdLCByb3dzLCByb3dzKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHJvd3M7XG5cdH1cblx0XG5cdC8vcmVwZWF0IGFjdGlvbiBhY3Jvc3MgZGlzcGxheSByb3dzXG5cdGRpc3BsYXlSb3dJdGVyYXRvcihjYWxsYmFjayl7XG5cdFx0dGhpcy5hY3RpdmVSb3dzUGlwZWxpbmUuZm9yRWFjaChjYWxsYmFjayk7XG5cdFx0dGhpcy5kaXNwbGF5Um93cy5mb3JFYWNoKGNhbGxiYWNrKTtcblx0XHRcblx0XHR0aGlzLmRpc3BsYXlSb3dzQ291bnQgPSB0aGlzLmRpc3BsYXlSb3dzW3RoaXMuZGlzcGxheVJvd3MubGVuZ3RoIC0xXS5sZW5ndGg7XG5cdH1cblx0XG5cdC8vcmV0dXJuIG9ubHkgYWN0dWFsIHJvd3MgKG5vdCBncm91cCBoZWFkZXJzIGV0Yylcblx0Z2V0Um93cyh0eXBlKXtcblx0XHR2YXIgcm93cyA9IFtdO1xuXHRcdFxuXHRcdHN3aXRjaCh0eXBlKXtcblx0XHRcdGNhc2UgXCJhY3RpdmVcIjpcblx0XHRcdFx0cm93cyA9IHRoaXMuYWN0aXZlUm93cztcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJkaXNwbGF5XCI6XG5cdFx0XHRcdHJvd3MgPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZ2V0RGlzcGxheVJvd3MoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJ2aXNpYmxlXCI6XG5cdFx0XHRcdHJvd3MgPSB0aGlzLmdldFZpc2libGVSb3dzKGZhbHNlLCB0cnVlKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHJvd3MgPSB0aGlzLmNoYWluKFwicm93cy1yZXRyaWV2ZVwiLCB0eXBlLCBudWxsLCB0aGlzLnJvd3MpIHx8IHRoaXMucm93cztcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIHJvd3M7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vIFRhYmxlIFJlbmRlcmluZyAvLy8vLy8vLy8vLy8vLy8vL1xuXHQvL3RyaWdnZXIgcmVyZW5kZXIgb2YgdGFibGUgaW4gY3VycmVudCBwb3NpdGlvblxuXHRyZVJlbmRlckluUG9zaXRpb24oY2FsbGJhY2spe1xuXHRcdGlmKHRoaXMucmVkcmF3QmxvY2spe1xuXHRcdFx0aWYoY2FsbGJhY2spe1xuXHRcdFx0XHRjYWxsYmFjaygpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLnJlZHJhd0Jsb2NrUmVuZGVySW5Qb3NpdGlvbiA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicmVuZGVyU3RhcnRlZFwiKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5yZW5kZXJlci5yZXJlbmRlclJvd3MoY2FsbGJhY2spO1xuXHRcdFx0XG5cdFx0XHRpZighdGhpcy5maXhlZEhlaWdodCl7XG5cdFx0XHRcdHRoaXMuYWRqdXN0VGFibGVTaXplKCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuc2Nyb2xsQmFyQ2hlY2soKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicmVuZGVyQ29tcGxldGVcIik7XG5cdFx0fVxuXHR9XG5cdFxuXHRzY3JvbGxCYXJDaGVjaygpe1xuXHRcdHZhciBzY3JvbGxiYXJXaWR0aCA9IDA7XG5cdFx0XG5cdFx0Ly9hZGp1c3QgZm9yIHZlcnRpY2FsIHNjcm9sbGJhciBtb3ZpbmcgdGFibGUgd2hlbiBwcmVzZW50XG5cdFx0aWYodGhpcy5lbGVtZW50LnNjcm9sbEhlaWdodCA+IHRoaXMuZWxlbWVudC5jbGllbnRIZWlnaHQpe1xuXHRcdFx0c2Nyb2xsYmFyV2lkdGggPSB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGggLSB0aGlzLmVsZW1lbnQuY2xpZW50V2lkdGg7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHNjcm9sbGJhcldpZHRoICE9PSB0aGlzLnNjcm9sbGJhcldpZHRoKXtcblx0XHRcdHRoaXMuc2Nyb2xsYmFyV2lkdGggPSBzY3JvbGxiYXJXaWR0aDtcblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJzY3JvbGxiYXItdmVydGljYWxcIiwgc2Nyb2xsYmFyV2lkdGgpO1xuXHRcdH1cblx0fVxuXHRcblx0aW5pdGlhbGl6ZVJlbmRlcmVyKCl7XG5cdFx0dmFyIHJlbmRlckNsYXNzO1xuXHRcdFxuXHRcdHZhciByZW5kZXJlcnMgPSB7XG5cdFx0XHRcInZpcnR1YWxcIjogVmlydHVhbERvbVZlcnRpY2FsLFxuXHRcdFx0XCJiYXNpY1wiOiBCYXNpY1ZlcnRpY2FsLFxuXHRcdH07XG5cdFx0XG5cdFx0aWYodHlwZW9mIHRoaXMudGFibGUub3B0aW9ucy5yZW5kZXJWZXJ0aWNhbCA9PT0gXCJzdHJpbmdcIil7XG5cdFx0XHRyZW5kZXJDbGFzcyA9IHJlbmRlcmVyc1t0aGlzLnRhYmxlLm9wdGlvbnMucmVuZGVyVmVydGljYWxdO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJlbmRlckNsYXNzID0gdGhpcy50YWJsZS5vcHRpb25zLnJlbmRlclZlcnRpY2FsO1xuXHRcdH1cblx0XHRcblx0XHRpZihyZW5kZXJDbGFzcyl7XG5cdFx0XHR0aGlzLnJlbmRlck1vZGUgPSB0aGlzLnRhYmxlLm9wdGlvbnMucmVuZGVyVmVydGljYWw7XG5cdFx0XHRcblx0XHRcdHRoaXMucmVuZGVyZXIgPSBuZXcgcmVuZGVyQ2xhc3ModGhpcy50YWJsZSwgdGhpcy5lbGVtZW50LCB0aGlzLnRhYmxlRWxlbWVudCk7XG5cdFx0XHR0aGlzLnJlbmRlcmVyLmluaXRpYWxpemUoKTtcblx0XHRcdFxuXHRcdFx0aWYoKHRoaXMudGFibGUuZWxlbWVudC5jbGllbnRIZWlnaHQgfHwgdGhpcy50YWJsZS5vcHRpb25zLmhlaWdodCkgJiYgISh0aGlzLnRhYmxlLm9wdGlvbnMubWluSGVpZ2h0ICYmIHRoaXMudGFibGUub3B0aW9ucy5tYXhIZWlnaHQpKXtcblx0XHRcdFx0dGhpcy5maXhlZEhlaWdodCA9IHRydWU7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuZml4ZWRIZWlnaHQgPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiVW5hYmxlIHRvIGZpbmQgbWF0Y2hpbmcgcmVuZGVyZXI6XCIsIHRoaXMudGFibGUub3B0aW9ucy5yZW5kZXJWZXJ0aWNhbCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRnZXRSZW5kZXJNb2RlKCl7XG5cdFx0cmV0dXJuIHRoaXMucmVuZGVyTW9kZTtcblx0fVxuXHRcblx0cmVuZGVyVGFibGUoKXtcblx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJyZW5kZXJTdGFydGVkXCIpO1xuXHRcdFxuXHRcdHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgPSAwO1xuXHRcdFxuXHRcdHRoaXMuX2NsZWFyVGFibGUoKTtcblx0XHRcblx0XHRpZih0aGlzLmRpc3BsYXlSb3dzQ291bnQpe1xuXHRcdFx0dGhpcy5yZW5kZXJlci5yZW5kZXJSb3dzKCk7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuZmlyc3RSZW5kZXIpe1xuXHRcdFx0XHR0aGlzLmZpcnN0UmVuZGVyID0gZmFsc2U7XG5cdFx0XHRcdFxuXHRcdFx0XHRpZighdGhpcy5maXhlZEhlaWdodCl7XG5cdFx0XHRcdFx0dGhpcy5hZGp1c3RUYWJsZVNpemUoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5sYXlvdXRSZWZyZXNoKHRydWUpO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMucmVuZGVyRW1wdHlTY3JvbGwoKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoIXRoaXMuZml4ZWRIZWlnaHQpe1xuXHRcdFx0dGhpcy5hZGp1c3RUYWJsZVNpemUoKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaChcInRhYmxlLWxheW91dFwiKTtcblx0XHRcblx0XHRpZighdGhpcy5kaXNwbGF5Um93c0NvdW50KXtcblx0XHRcdHRoaXMuX3Nob3dQbGFjZWhvbGRlcigpO1xuXHRcdH1cblx0XHRcblx0XHR0aGlzLnNjcm9sbEJhckNoZWNrKCk7XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwicmVuZGVyQ29tcGxldGVcIik7XG5cdH1cblx0XG5cdC8vc2hvdyBzY3JvbGxiYXJzIG9uIGVtcHR5IHRhYmxlIGRpdlxuXHRyZW5kZXJFbXB0eVNjcm9sbCgpe1xuXHRcdGlmKHRoaXMucGxhY2Vob2xkZXIpe1xuXHRcdFx0dGhpcy50YWJsZUVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMudGFibGVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmdldFdpZHRoKCkgKyBcInB4XCI7XG5cdFx0XHQvLyB0aGlzLnRhYmxlRWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBcIjFweFwiO1xuXHRcdFx0Ly8gdGhpcy50YWJsZUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG5cdFx0fVxuXHR9XG5cdFxuXHRfY2xlYXJUYWJsZSgpe1x0XG5cdFx0dGhpcy5fY2xlYXJQbGFjZWhvbGRlcigpO1xuXHRcdFxuXHRcdHRoaXMuc2Nyb2xsVG9wID0gMDtcblx0XHR0aGlzLnNjcm9sbExlZnQgPSAwO1xuXHRcdFxuXHRcdHRoaXMucmVuZGVyZXIuY2xlYXJSb3dzKCk7XG5cdH1cblx0XG5cdHRhYmxlRW1wdHkoKXtcblx0XHR0aGlzLnJlbmRlckVtcHR5U2Nyb2xsKCk7XG5cdFx0dGhpcy5fc2hvd1BsYWNlaG9sZGVyKCk7XG5cdH1cblxuXHRjaGVja1BsYWNlaG9sZGVyKCl7XG5cdFx0aWYodGhpcy5kaXNwbGF5Um93c0NvdW50KXtcblx0XHRcdHRoaXMuX2NsZWFyUGxhY2Vob2xkZXIoKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLnRhYmxlRW1wdHkoKTtcblx0XHR9XG5cdH1cblx0XG5cdF9zaG93UGxhY2Vob2xkZXIoKXtcblx0XHRpZih0aGlzLnBsYWNlaG9sZGVyKXtcblx0XHRcdGlmKHRoaXMucGxhY2Vob2xkZXIgJiYgdGhpcy5wbGFjZWhvbGRlci5wYXJlbnROb2RlKXtcblx0XHRcdFx0dGhpcy5wbGFjZWhvbGRlci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXIpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLmluaXRpYWxpemVQbGFjZWhvbGRlcigpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLnBsYWNlaG9sZGVyLnNldEF0dHJpYnV0ZShcInRhYnVsYXRvci1yZW5kZXItbW9kZVwiLCB0aGlzLnJlbmRlck1vZGUpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmdldEVsZW1lbnQoKS5hcHBlbmRDaGlsZCh0aGlzLnBsYWNlaG9sZGVyKTtcblx0XHRcdHRoaXMuX3Bvc2l0aW9uUGxhY2Vob2xkZXIoKTtcblxuXHRcdFx0dGhpcy5hZGp1c3RUYWJsZVNpemUoKTtcblx0XHR9XG5cdH1cblx0XG5cdF9jbGVhclBsYWNlaG9sZGVyKCl7XG5cdFx0aWYodGhpcy5wbGFjZWhvbGRlciAmJiB0aGlzLnBsYWNlaG9sZGVyLnBhcmVudE5vZGUpe1xuXHRcdFx0dGhpcy5wbGFjZWhvbGRlci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXIpO1xuXHRcdH1cblx0XHRcblx0XHQvLyBjbGVhciBlbXB0eSB0YWJsZSBwbGFjZWhvbGRlciBtaW5cblx0XHR0aGlzLnRhYmxlRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IFwiXCI7XG5cdFx0dGhpcy50YWJsZUVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG5cdH1cblx0XG5cdF9wb3NpdGlvblBsYWNlaG9sZGVyKCl7XG5cdFx0aWYodGhpcy5wbGFjZWhvbGRlciAmJiB0aGlzLnBsYWNlaG9sZGVyLnBhcmVudE5vZGUpe1xuXHRcdFx0dGhpcy5wbGFjZWhvbGRlci5zdHlsZS53aWR0aCA9IHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRXaWR0aCgpICsgXCJweFwiO1xuXHRcdFx0dGhpcy5wbGFjZWhvbGRlckNvbnRlbnRzLnN0eWxlLndpZHRoID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuY2xpZW50V2lkdGggKyBcInB4XCI7XG5cdFx0XHR0aGlzLnBsYWNlaG9sZGVyQ29udGVudHMuc3R5bGUubWFyZ2luTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdCArIFwicHhcIjtcblx0XHR9XG5cdH1cblx0XG5cdHN0eWxlUm93KHJvdywgaW5kZXgpe1xuXHRcdHZhciByb3dFbCA9IHJvdy5nZXRFbGVtZW50KCk7XG5cdFx0XG5cdFx0aWYoaW5kZXggJSAyKXtcblx0XHRcdHJvd0VsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3Itcm93LWV2ZW5cIik7XG5cdFx0XHRyb3dFbC5jbGFzc0xpc3QucmVtb3ZlKFwidGFidWxhdG9yLXJvdy1vZGRcIik7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cm93RWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1yb3ctb2RkXCIpO1xuXHRcdFx0cm93RWwuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvci1yb3ctZXZlblwiKTtcblx0XHR9XG5cdH1cblx0XG5cdC8vbm9ybWFsaXplIGhlaWdodCBvZiBhY3RpdmUgcm93c1xuXHRub3JtYWxpemVIZWlnaHQoZm9yY2Upe1xuXHRcdHRoaXMuYWN0aXZlUm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdyl7XG5cdFx0XHRyb3cubm9ybWFsaXplSGVpZ2h0KGZvcmNlKTtcblx0XHR9KTtcblx0fVxuXHRcblx0Ly9hZGp1c3QgdGhlIGhlaWdodCBvZiB0aGUgdGFibGUgaG9sZGVyIHRvIGZpdCBpbiB0aGUgVGFidWxhdG9yIGVsZW1lbnRcblx0YWRqdXN0VGFibGVTaXplKCl7XG5cdFx0bGV0IGluaXRpYWxIZWlnaHQgPSB0aGlzLmVsZW1lbnQuY2xpZW50SGVpZ2h0LCBtaW5IZWlnaHQ7XG5cdFx0bGV0IHJlc2l6ZWQgPSBmYWxzZTtcblx0XHRcblx0XHRpZih0aGlzLnJlbmRlcmVyLnZlcnRpY2FsRmlsbE1vZGUgPT09IFwiZmlsbFwiKXtcblx0XHRcdGxldCBvdGhlckhlaWdodCA9ICBNYXRoLmZsb29yKHRoaXMudGFibGUuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0ICsgKHRoaXMudGFibGUuZm9vdGVyTWFuYWdlciAmJiB0aGlzLnRhYmxlLmZvb3Rlck1hbmFnZXIuYWN0aXZlICYmICF0aGlzLnRhYmxlLmZvb3Rlck1hbmFnZXIuZXh0ZXJuYWwgPyB0aGlzLnRhYmxlLmZvb3Rlck1hbmFnZXIuZ2V0RWxlbWVudCgpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCA6IDApKTtcblx0XHRcdFxuXHRcdFx0aWYodGhpcy5maXhlZEhlaWdodCl7XG5cdFx0XHRcdG1pbkhlaWdodCA9IGlzTmFOKHRoaXMudGFibGUub3B0aW9ucy5taW5IZWlnaHQpID8gdGhpcy50YWJsZS5vcHRpb25zLm1pbkhlaWdodCA6IHRoaXMudGFibGUub3B0aW9ucy5taW5IZWlnaHQgKyBcInB4XCI7XG5cdFx0XHRcdFxuXHRcdFx0XHRjb25zdCBoZWlnaHQgPSBcImNhbGMoMTAwJSAtIFwiICsgb3RoZXJIZWlnaHQgKyBcInB4KVwiO1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gbWluSGVpZ2h0IHx8IFwiY2FsYygxMDAlIC0gXCIgKyBvdGhlckhlaWdodCArIFwicHgpXCI7XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBoZWlnaHQ7XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSBoZWlnaHQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gXCJcIjtcblx0XHRcdFx0dGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCA9XG5cdFx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5jbGllbnRIZWlnaHQgLSBvdGhlckhlaWdodCArIFwicHhcIjtcblx0XHRcdFx0dGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnJlbmRlcmVyLnJlc2l6ZSgpO1xuXHRcdFx0XG5cdFx0XHQvL2NoZWNrIGlmIHRoZSB0YWJsZSBoYXMgY2hhbmdlZCBzaXplIHdoZW4gZGVhbGluZyB3aXRoIHZhcmlhYmxlIGhlaWdodCB0YWJsZXNcblx0XHRcdGlmKCF0aGlzLmZpeGVkSGVpZ2h0ICYmIGluaXRpYWxIZWlnaHQgIT0gdGhpcy5lbGVtZW50LmNsaWVudEhlaWdodCl7XG5cdFx0XHRcdHJlc2l6ZWQgPSB0cnVlO1xuXHRcdFx0XHRpZih0aGlzLnN1YnNjcmliZWQoXCJ0YWJsZS1yZXNpemVcIikpe1xuXHRcdFx0XHRcdHRoaXMuZGlzcGF0Y2goXCJ0YWJsZS1yZXNpemVcIik7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHR0aGlzLnJlZHJhdygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdHRoaXMuc2Nyb2xsQmFyQ2hlY2soKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5fcG9zaXRpb25QbGFjZWhvbGRlcigpO1xuXHRcdHJldHVybiByZXNpemVkO1xuXHR9XG5cdFxuXHQvL3JlaW5pdGlhbGl6ZSBhbGwgcm93c1xuXHRyZWluaXRpYWxpemUoKXtcblx0XHR0aGlzLnJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpe1xuXHRcdFx0cm93LnJlaW5pdGlhbGl6ZSh0cnVlKTtcblx0XHR9KTtcblx0fVxuXHRcblx0Ly9wcmV2ZW50IHRhYmxlIGZyb20gYmVpbmcgcmVkcmF3blxuXHRibG9ja1JlZHJhdyAoKXtcblx0XHR0aGlzLnJlZHJhd0Jsb2NrID0gdHJ1ZTtcblx0XHR0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZyA9IGZhbHNlO1xuXHR9XG5cdFxuXHQvL3Jlc3RvcmUgdGFibGUgcmVkcmF3aW5nXG5cdHJlc3RvcmVSZWRyYXcgKCl7XG5cdFx0dGhpcy5yZWRyYXdCbG9jayA9IGZhbHNlO1xuXHRcdFxuXHRcdGlmKHRoaXMucmVkcmF3QmxvY2tSZXN0b3JlQ29uZmlnKXtcblx0XHRcdHRoaXMucmVmcmVzaEFjdGl2ZURhdGEodGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcuaGFuZGxlciwgdGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcuc2tpcFN0YWdlLCB0aGlzLnJlZHJhd0Jsb2NrUmVzdG9yZUNvbmZpZy5yZW5kZXJJblBvc2l0aW9uKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5yZWRyYXdCbG9ja1Jlc3RvcmVDb25maWcgPSBmYWxzZTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRpZih0aGlzLnJlZHJhd0Jsb2NrUmVuZGVySW5Qb3NpdGlvbil7XG5cdFx0XHRcdHRoaXMucmVSZW5kZXJJblBvc2l0aW9uKCk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMucmVkcmF3QmxvY2tSZW5kZXJJblBvc2l0aW9uID0gZmFsc2U7XG5cdH1cblx0XG5cdC8vcmVkcmF3IHRhYmxlXG5cdHJlZHJhdyAoZm9yY2Upe1xuXHRcdHRoaXMuYWRqdXN0VGFibGVTaXplKCk7XG5cdFx0dGhpcy50YWJsZS50YWJsZVdpZHRoID0gdGhpcy50YWJsZS5lbGVtZW50LmNsaWVudFdpZHRoO1xuXHRcdFxuXHRcdGlmKCFmb3JjZSl7XHRcblx0XHRcdHRoaXMucmVSZW5kZXJJblBvc2l0aW9uKCk7XG5cdFx0XHR0aGlzLnNjcm9sbEhvcml6b250YWwodGhpcy5zY3JvbGxMZWZ0KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLnJlbmRlclRhYmxlKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRyZXNldFNjcm9sbCgpe1xuXHRcdHRoaXMuZWxlbWVudC5zY3JvbGxMZWZ0ID0gMDtcblx0XHR0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcblx0XHRcblx0XHRpZih0aGlzLnRhYmxlLmJyb3dzZXIgPT09IFwiaWVcIil7XG5cdFx0XHR2YXIgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudChcIkV2ZW50XCIpO1xuXHRcdFx0ZXZlbnQuaW5pdEV2ZW50KFwic2Nyb2xsXCIsIGZhbHNlLCB0cnVlKTtcblx0XHRcdHRoaXMuZWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3Njcm9sbCcpKTtcblx0XHR9XG5cdH1cbn1cblxuY2xhc3MgRm9vdGVyTWFuYWdlciBleHRlbmRzIENvcmVGZWF0dXJle1xuXG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cblx0XHR0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuXHRcdHRoaXMuZWxlbWVudCA9IHRoaXMuY3JlYXRlRWxlbWVudCgpOyAvL2NvbnRhaW5pbmcgZWxlbWVudFxuXHRcdHRoaXMuY29udGFpbmVyRWxlbWVudCA9IHRoaXMuY3JlYXRlQ29udGFpbmVyRWxlbWVudCgpOyAvL2NvbnRhaW5pbmcgZWxlbWVudFxuXHRcdHRoaXMuZXh0ZXJuYWwgPSBmYWxzZTtcblx0fVxuXG5cdGluaXRpYWxpemUoKXtcblx0XHR0aGlzLmluaXRpYWxpemVFbGVtZW50KCk7XG5cdH1cblxuXHRjcmVhdGVFbGVtZW50KCl7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItZm9vdGVyXCIpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9XG5cblx0XG5cdGNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoKXtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1mb290ZXItY29udGVudHNcIik7XG5cblx0XHR0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQoZWwpO1xuXG5cdFx0cmV0dXJuIGVsO1xuXHR9XG5cblx0aW5pdGlhbGl6ZUVsZW1lbnQoKXtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZm9vdGVyRWxlbWVudCl7XG5cblx0XHRcdHN3aXRjaCh0eXBlb2YgdGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnQpe1xuXHRcdFx0XHRjYXNlIFwic3RyaW5nXCI6XG5cdFx0XHRcdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnRbMF0gPT09IFwiPFwiKXtcblx0XHRcdFx0XHRcdHRoaXMuY29udGFpbmVyRWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLnRhYmxlLm9wdGlvbnMuZm9vdGVyRWxlbWVudDtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHR0aGlzLmV4dGVybmFsID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHRoaXMuY29udGFpbmVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy50YWJsZS5vcHRpb25zLmZvb3RlckVsZW1lbnQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdHRoaXMuZWxlbWVudCA9IHRoaXMudGFibGUub3B0aW9ucy5mb290ZXJFbGVtZW50O1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGdldEVsZW1lbnQoKXtcblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50O1xuXHR9XG5cblx0YXBwZW5kKGVsZW1lbnQpe1xuXHRcdHRoaXMuYWN0aXZhdGUoKTtcblxuXHRcdHRoaXMuY29udGFpbmVyRWxlbWVudC5hcHBlbmRDaGlsZChlbGVtZW50KTtcblx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuYWRqdXN0VGFibGVTaXplKCk7XG5cdH1cblxuXHRwcmVwZW5kKGVsZW1lbnQpe1xuXHRcdHRoaXMuYWN0aXZhdGUoKTtcblxuXHRcdHRoaXMuZWxlbWVudC5pbnNlcnRCZWZvcmUoZWxlbWVudCwgdGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdHRoaXMudGFibGUucm93TWFuYWdlci5hZGp1c3RUYWJsZVNpemUoKTtcblx0fVxuXG5cdHJlbW92ZShlbGVtZW50KXtcblx0XHRlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XG5cdFx0dGhpcy5kZWFjdGl2YXRlKCk7XG5cdH1cblxuXHRkZWFjdGl2YXRlKGZvcmNlKXtcblx0XHRpZighdGhpcy5lbGVtZW50LmZpcnN0Q2hpbGQgfHwgZm9yY2Upe1xuXHRcdFx0aWYoIXRoaXMuZXh0ZXJuYWwpe1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5hY3RpdmUgPSBmYWxzZTtcblx0XHR9XG5cdH1cblxuXHRhY3RpdmF0ZSgpe1xuXHRcdGlmKCF0aGlzLmFjdGl2ZSl7XG5cdFx0XHR0aGlzLmFjdGl2ZSA9IHRydWU7XG5cdFx0XHRpZighdGhpcy5leHRlcm5hbCl7XG5cdFx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmdldEVsZW1lbnQoKSk7XG5cdFx0XHRcdHRoaXMudGFibGUuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmVkcmF3KCl7XG5cdFx0dGhpcy5kaXNwYXRjaChcImZvb3Rlci1yZWRyYXdcIik7XG5cdH1cbn1cblxuY2xhc3MgSW50ZXJhY3Rpb25NYW5hZ2VyIGV4dGVuZHMgQ29yZUZlYXR1cmUge1xuXHRcblx0Y29uc3RydWN0b3IgKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5lbCA9IG51bGw7XG5cdFx0XG5cdFx0dGhpcy5hYm9ydENsYXNzZXMgPSBbXCJ0YWJ1bGF0b3ItaGVhZGVyc1wiLCBcInRhYnVsYXRvci10YWJsZVwiXTtcblx0XHRcblx0XHR0aGlzLnByZXZpb3VzVGFyZ2V0cyA9IHt9O1xuXHRcdFxuXHRcdHRoaXMubGlzdGVuZXJzID0gW1xuXHRcdFx0XCJjbGlja1wiLFxuXHRcdFx0XCJkYmxjbGlja1wiLFxuXHRcdFx0XCJjb250ZXh0bWVudVwiLFxuXHRcdFx0XCJtb3VzZWVudGVyXCIsXG5cdFx0XHRcIm1vdXNlbGVhdmVcIixcblx0XHRcdFwibW91c2VvdmVyXCIsXG5cdFx0XHRcIm1vdXNlb3V0XCIsXG5cdFx0XHRcIm1vdXNlbW92ZVwiLFxuXHRcdFx0XCJtb3VzZXVwXCIsXG5cdFx0XHRcIm1vdXNlZG93blwiLFxuXHRcdFx0XCJ0b3VjaHN0YXJ0XCIsXG5cdFx0XHRcInRvdWNoZW5kXCIsXG5cdFx0XTtcblx0XHRcblx0XHR0aGlzLmNvbXBvbmVudE1hcCA9IHtcblx0XHRcdFwidGFidWxhdG9yLWNlbGxcIjpcImNlbGxcIixcblx0XHRcdFwidGFidWxhdG9yLXJvd1wiOlwicm93XCIsXG5cdFx0XHRcInRhYnVsYXRvci1ncm91cFwiOlwiZ3JvdXBcIixcblx0XHRcdFwidGFidWxhdG9yLWNvbFwiOlwiY29sdW1uXCIsXG5cdFx0fTtcblx0XHRcblx0XHR0aGlzLnBzZXVkb1RyYWNrZXJzID0ge1xuXHRcdFx0XCJyb3dcIjp7XG5cdFx0XHRcdHN1YnNjcmliZXI6bnVsbCxcblx0XHRcdFx0dGFyZ2V0Om51bGwsXG5cdFx0XHR9LFxuXHRcdFx0XCJjZWxsXCI6e1xuXHRcdFx0XHRzdWJzY3JpYmVyOm51bGwsXG5cdFx0XHRcdHRhcmdldDpudWxsLFxuXHRcdFx0fSxcblx0XHRcdFwiZ3JvdXBcIjp7XG5cdFx0XHRcdHN1YnNjcmliZXI6bnVsbCxcblx0XHRcdFx0dGFyZ2V0Om51bGwsXG5cdFx0XHR9LFxuXHRcdFx0XCJjb2x1bW5cIjp7XG5cdFx0XHRcdHN1YnNjcmliZXI6bnVsbCxcblx0XHRcdFx0dGFyZ2V0Om51bGwsXG5cdFx0XHR9LFxuXHRcdH07XG5cdFx0XG5cdFx0dGhpcy5wc2V1ZG9UcmFja2luZyA9IGZhbHNlO1xuXHR9XG5cdFxuXHRpbml0aWFsaXplKCl7XG5cdFx0dGhpcy5lbCA9IHRoaXMudGFibGUuZWxlbWVudDtcblx0XHRcblx0XHR0aGlzLmJ1aWxkTGlzdGVuZXJNYXAoKTtcblx0XHR0aGlzLmJpbmRTdWJzY3JpcHRpb25XYXRjaGVycygpO1xuXHR9XG5cdFxuXHRidWlsZExpc3RlbmVyTWFwKCl7XG5cdFx0dmFyIGxpc3RlbmVyTWFwID0ge307XG5cdFx0XG5cdFx0dGhpcy5saXN0ZW5lcnMuZm9yRWFjaCgobGlzdGVuZXIpID0+IHtcblx0XHRcdGxpc3RlbmVyTWFwW2xpc3RlbmVyXSA9IHtcblx0XHRcdFx0aGFuZGxlcjpudWxsLFxuXHRcdFx0XHRjb21wb25lbnRzOltdLFxuXHRcdFx0fTtcblx0XHR9KTtcblx0XHRcblx0XHR0aGlzLmxpc3RlbmVycyA9IGxpc3RlbmVyTWFwO1xuXHR9XG5cdFxuXHRiaW5kUHNldWRvRXZlbnRzKCl7XG5cdFx0T2JqZWN0LmtleXModGhpcy5wc2V1ZG9UcmFja2VycykuZm9yRWFjaCgoa2V5KSA9PiB7XG5cdFx0XHR0aGlzLnBzZXVkb1RyYWNrZXJzW2tleV0uc3Vic2NyaWJlciA9IHRoaXMucHNldWRvTW91c2VFbnRlci5iaW5kKHRoaXMsIGtleSk7XG5cdFx0XHR0aGlzLnN1YnNjcmliZShrZXkgKyBcIi1tb3VzZW92ZXJcIiwgdGhpcy5wc2V1ZG9UcmFja2Vyc1trZXldLnN1YnNjcmliZXIpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHRoaXMucHNldWRvVHJhY2tpbmcgPSB0cnVlO1xuXHR9XG5cdFxuXHRwc2V1ZG9Nb3VzZUVudGVyKGtleSwgZSwgdGFyZ2V0KXtcblx0XHRpZih0aGlzLnBzZXVkb1RyYWNrZXJzW2tleV0udGFyZ2V0ICE9PSB0YXJnZXQpe1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnBzZXVkb1RyYWNrZXJzW2tleV0udGFyZ2V0KXtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaChrZXkgKyBcIi1tb3VzZWxlYXZlXCIsIGUsIHRoaXMucHNldWRvVHJhY2tlcnNba2V5XS50YXJnZXQpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnBzZXVkb01vdXNlTGVhdmUoa2V5LCBlKTtcblx0XHRcdFxuXHRcdFx0dGhpcy5wc2V1ZG9UcmFja2Vyc1trZXldLnRhcmdldCA9IHRhcmdldDtcblx0XHRcdFxuXHRcdFx0dGhpcy5kaXNwYXRjaChrZXkgKyBcIi1tb3VzZWVudGVyXCIsIGUsIHRhcmdldCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRwc2V1ZG9Nb3VzZUxlYXZlKGtleSwgZSl7XG5cdFx0dmFyIGxlYXZlTGlzdCA9IE9iamVjdC5rZXlzKHRoaXMucHNldWRvVHJhY2tlcnMpLFxuXHRcdGxpbmtlZEtleXMgPSB7XG5cdFx0XHRcInJvd1wiOltcImNlbGxcIl0sXG5cdFx0XHRcImNlbGxcIjpbXCJyb3dcIl0sXG5cdFx0fTtcblx0XHRcblx0XHRsZWF2ZUxpc3QgPSBsZWF2ZUxpc3QuZmlsdGVyKChpdGVtKSA9PiB7XG5cdFx0XHR2YXIgbGlua3MgPSBsaW5rZWRLZXlzW2tleV07XG5cdFx0XHRyZXR1cm4gaXRlbSAhPT0ga2V5ICYmICghbGlua3MgfHwgKGxpbmtzICYmICFsaW5rcy5pbmNsdWRlcyhpdGVtKSkpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdFxuXHRcdGxlYXZlTGlzdC5mb3JFYWNoKChrZXkpID0+IHtcblx0XHRcdHZhciB0YXJnZXQgPSB0aGlzLnBzZXVkb1RyYWNrZXJzW2tleV0udGFyZ2V0O1xuXHRcdFx0XG5cdFx0XHRpZih0aGlzLnBzZXVkb1RyYWNrZXJzW2tleV0udGFyZ2V0KXtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaChrZXkgKyBcIi1tb3VzZWxlYXZlXCIsIGUsIHRhcmdldCk7XG5cdFx0XHRcdFxuXHRcdFx0XHR0aGlzLnBzZXVkb1RyYWNrZXJzW2tleV0udGFyZ2V0ID0gbnVsbDtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHRcblx0XG5cdGJpbmRTdWJzY3JpcHRpb25XYXRjaGVycygpe1xuXHRcdHZhciBsaXN0ZW5lcnMgPSBPYmplY3Qua2V5cyh0aGlzLmxpc3RlbmVycyksXG5cdFx0Y29tcG9uZW50cyA9IE9iamVjdC52YWx1ZXModGhpcy5jb21wb25lbnRNYXApO1xuXHRcdFxuXHRcdGZvcihsZXQgY29tcCBvZiBjb21wb25lbnRzKXtcblx0XHRcdGZvcihsZXQgbGlzdGVuZXIgb2YgbGlzdGVuZXJzKXtcblx0XHRcdFx0bGV0IGtleSA9IGNvbXAgKyBcIi1cIiArIGxpc3RlbmVyO1xuXHRcdFx0XHRcblx0XHRcdFx0dGhpcy5zdWJzY3JpcHRpb25DaGFuZ2Uoa2V5LCB0aGlzLnN1YnNjcmlwdGlvbkNoYW5nZWQuYmluZCh0aGlzLCBjb21wLCBsaXN0ZW5lcikpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHR0aGlzLnN1YnNjcmliZShcInRhYmxlLWRlc3Ryb3lcIiwgdGhpcy5jbGVhcldhdGNoZXJzLmJpbmQodGhpcykpO1xuXHR9XG5cdFxuXHRzdWJzY3JpcHRpb25DaGFuZ2VkKGNvbXBvbmVudCwga2V5LCBhZGRlZCl7XG5cdFx0dmFyIGxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcnNba2V5XS5jb21wb25lbnRzLFxuXHRcdGluZGV4ID0gbGlzdGVuZXIuaW5kZXhPZihjb21wb25lbnQpLFxuXHRcdGNoYW5nZWQgPSBmYWxzZTtcblx0XHRcblx0XHRpZihhZGRlZCl7XG5cdFx0XHRpZihpbmRleCA9PT0gLTEpe1xuXHRcdFx0XHRsaXN0ZW5lci5wdXNoKGNvbXBvbmVudCk7XG5cdFx0XHRcdGNoYW5nZWQgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGlmKCF0aGlzLnN1YnNjcmliZWQoY29tcG9uZW50ICsgXCItXCIgKyBrZXkpKXtcblx0XHRcdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHRcdFx0bGlzdGVuZXIuc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdFx0XHRjaGFuZ2VkID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRpZigoa2V5ID09PSBcIm1vdXNlZW50ZXJcIiB8fCBrZXkgPT09IFwibW91c2VsZWF2ZVwiKSAmJiAhdGhpcy5wc2V1ZG9UcmFja2luZyl7XG5cdFx0XHR0aGlzLmJpbmRQc2V1ZG9FdmVudHMoKTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoY2hhbmdlZCl7XG5cdFx0XHR0aGlzLnVwZGF0ZUV2ZW50TGlzdGVuZXJzKCk7XG5cdFx0fVxuXHR9XG5cdFxuXHR1cGRhdGVFdmVudExpc3RlbmVycygpe1xuXHRcdGZvcihsZXQga2V5IGluIHRoaXMubGlzdGVuZXJzKXtcblx0XHRcdGxldCBsaXN0ZW5lciA9IHRoaXMubGlzdGVuZXJzW2tleV07XG5cdFx0XHRcblx0XHRcdGlmKGxpc3RlbmVyLmNvbXBvbmVudHMubGVuZ3RoKXtcblx0XHRcdFx0aWYoIWxpc3RlbmVyLmhhbmRsZXIpe1xuXHRcdFx0XHRcdGxpc3RlbmVyLmhhbmRsZXIgPSB0aGlzLnRyYWNrLmJpbmQodGhpcywga2V5KTtcblx0XHRcdFx0XHR0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoa2V5LCBsaXN0ZW5lci5oYW5kbGVyKTtcblx0XHRcdFx0XHQvLyB0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoa2V5LCBsaXN0ZW5lci5oYW5kbGVyLCB7cGFzc2l2ZTogdHJ1ZX0pXG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYobGlzdGVuZXIuaGFuZGxlcil7XG5cdFx0XHRcdFx0dGhpcy5lbC5yZW1vdmVFdmVudExpc3RlbmVyKGtleSwgbGlzdGVuZXIuaGFuZGxlcik7XG5cdFx0XHRcdFx0bGlzdGVuZXIuaGFuZGxlciA9IG51bGw7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdHRyYWNrKHR5cGUsIGUpe1xuXHRcdHZhciBwYXRoID0gKGUuY29tcG9zZWRQYXRoICYmIGUuY29tcG9zZWRQYXRoKCkpIHx8IGUucGF0aDtcblx0XHRcblx0XHR2YXIgdGFyZ2V0cyA9IHRoaXMuZmluZFRhcmdldHMocGF0aCk7XG5cdFx0dGFyZ2V0cyA9IHRoaXMuYmluZENvbXBvbmVudHModHlwZSwgdGFyZ2V0cyk7XG5cdFx0XG5cdFx0dGhpcy50cmlnZ2VyRXZlbnRzKHR5cGUsIGUsIHRhcmdldHMpO1xuXHRcdFxuXHRcdGlmKHRoaXMucHNldWRvVHJhY2tpbmcgJiYgKHR5cGUgPT0gXCJtb3VzZW92ZXJcIiB8fCB0eXBlID09IFwibW91c2VsZWF2ZVwiKSAmJiAhT2JqZWN0LmtleXModGFyZ2V0cykubGVuZ3RoKXtcblx0XHRcdHRoaXMucHNldWRvTW91c2VMZWF2ZShcIm5vbmVcIiwgZSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRmaW5kVGFyZ2V0cyhwYXRoKXtcblx0XHR2YXIgdGFyZ2V0cyA9IHt9O1xuXHRcdFxuXHRcdGxldCBjb21wb25lbnRNYXAgPSBPYmplY3Qua2V5cyh0aGlzLmNvbXBvbmVudE1hcCk7XG5cdFx0XG5cdFx0Zm9yIChsZXQgZWwgb2YgcGF0aCkge1xuXHRcdFx0bGV0IGNsYXNzTGlzdCA9IGVsLmNsYXNzTGlzdCA/IFsuLi5lbC5jbGFzc0xpc3RdIDogW107XG5cdFx0XHRcblx0XHRcdGxldCBhYm9ydCA9IGNsYXNzTGlzdC5maWx0ZXIoKGl0ZW0pID0+IHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuYWJvcnRDbGFzc2VzLmluY2x1ZGVzKGl0ZW0pO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdGlmKGFib3J0Lmxlbmd0aCl7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRsZXQgZWxUYXJnZXRzID0gY2xhc3NMaXN0LmZpbHRlcigoaXRlbSkgPT4ge1xuXHRcdFx0XHRyZXR1cm4gY29tcG9uZW50TWFwLmluY2x1ZGVzKGl0ZW0pO1xuXHRcdFx0fSk7XG5cdFx0XHRcblx0XHRcdGZvciAobGV0IHRhcmdldCBvZiBlbFRhcmdldHMpIHtcblx0XHRcdFx0aWYoIXRhcmdldHNbdGhpcy5jb21wb25lbnRNYXBbdGFyZ2V0XV0pe1xuXHRcdFx0XHRcdHRhcmdldHNbdGhpcy5jb21wb25lbnRNYXBbdGFyZ2V0XV0gPSBlbDtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmKHRhcmdldHMuZ3JvdXAgJiYgdGFyZ2V0cy5ncm91cCA9PT0gdGFyZ2V0cy5yb3cpe1xuXHRcdFx0ZGVsZXRlIHRhcmdldHMucm93O1xuXHRcdH1cblxuXHRcdHJldHVybiB0YXJnZXRzO1xuXHR9XG5cdFxuXHRiaW5kQ29tcG9uZW50cyh0eXBlLCB0YXJnZXRzKXtcblx0XHQvL2Vuc3VyZSByb3cgY29tcG9uZW50IGlzIGxvb2tlZCB1cCBiZWZvcmUgY2VsbFxuXHRcdHZhciBrZXlzID0gT2JqZWN0LmtleXModGFyZ2V0cykucmV2ZXJzZSgpLFxuXHRcdGxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcnNbdHlwZV0sXG5cdFx0bWF0Y2hlcyA9IHt9LFxuXHRcdG91dHB1dCA9IHt9LFxuXHRcdHRhcmdldE1hdGNoZXMgPSB7fTtcblx0XG5cdFx0Zm9yKGxldCBrZXkgb2Yga2V5cyl7XG5cdFx0XHRsZXQgY29tcG9uZW50LFxuXHRcdFx0dGFyZ2V0ID0gdGFyZ2V0c1trZXldLFxuXHRcdFx0cHJldmlvdXNUYXJnZXQgPSB0aGlzLnByZXZpb3VzVGFyZ2V0c1trZXldO1xuXHRcdFx0XG5cdFx0XHRpZihwcmV2aW91c1RhcmdldCAmJiBwcmV2aW91c1RhcmdldC50YXJnZXQgPT09IHRhcmdldCl7XG5cdFx0XHRcdGNvbXBvbmVudCA9IHByZXZpb3VzVGFyZ2V0LmNvbXBvbmVudDtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0c3dpdGNoKGtleSl7XG5cdFx0XHRcdFx0Y2FzZSBcInJvd1wiOlxuXHRcdFx0XHRcdGNhc2UgXCJncm91cFwiOlxuXHRcdFx0XHRcdFx0aWYobGlzdGVuZXIuY29tcG9uZW50cy5pbmNsdWRlcyhcInJvd1wiKSB8fCBsaXN0ZW5lci5jb21wb25lbnRzLmluY2x1ZGVzKFwiY2VsbFwiKSB8fCBsaXN0ZW5lci5jb21wb25lbnRzLmluY2x1ZGVzKFwiZ3JvdXBcIikpe1xuXHRcdFx0XHRcdFx0XHRsZXQgcm93cyA9IHRoaXMudGFibGUucm93TWFuYWdlci5nZXRWaXNpYmxlUm93cyh0cnVlKTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRjb21wb25lbnQgPSByb3dzLmZpbmQoKHJvdykgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiByb3cuZ2V0RWxlbWVudCgpID09PSB0YXJnZXQ7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRcdGlmKHRhcmdldHNbXCJyb3dcIl0gJiYgdGFyZ2V0c1tcInJvd1wiXS5wYXJlbnROb2RlICYmIHRhcmdldHNbXCJyb3dcIl0ucGFyZW50Tm9kZS5jbG9zZXN0KFwiLnRhYnVsYXRvci1yb3dcIikpe1xuXHRcdFx0XHRcdFx0XHRcdHRhcmdldHNba2V5XSA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRjYXNlIFwiY29sdW1uXCI6XG5cdFx0XHRcdFx0XHRpZihsaXN0ZW5lci5jb21wb25lbnRzLmluY2x1ZGVzKFwiY29sdW1uXCIpKXtcblx0XHRcdFx0XHRcdFx0Y29tcG9uZW50ID0gdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4odGFyZ2V0KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGNhc2UgXCJjZWxsXCI6XG5cdFx0XHRcdFx0XHRpZihsaXN0ZW5lci5jb21wb25lbnRzLmluY2x1ZGVzKFwiY2VsbFwiKSl7XG5cdFx0XHRcdFx0XHRcdGlmKG1hdGNoZXNbXCJyb3dcIl0gaW5zdGFuY2VvZiBSb3cpe1xuXHRcdFx0XHRcdFx0XHRcdGNvbXBvbmVudCA9IG1hdGNoZXNbXCJyb3dcIl0uZmluZENlbGwodGFyZ2V0KTtcblx0XHRcdFx0XHRcdFx0fWVsc2Uge1x0XG5cdFx0XHRcdFx0XHRcdFx0aWYodGFyZ2V0c1tcInJvd1wiXSl7XG5cdFx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJFdmVudCBUYXJnZXQgTG9va3VwIEVycm9yIC0gVGhlIHJvdyB0aGlzIGNlbGwgaXMgYXR0YWNoZWQgdG8gY2Fubm90IGJlIGZvdW5kLCBoYXMgdGhlIHRhYmxlIGJlZW4gcmVpbml0aWFsaXplZCB3aXRob3V0IGJlaW5nIGRlc3Ryb3llZCBmaXJzdD9cIik7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihjb21wb25lbnQpe1xuXHRcdFx0XHRtYXRjaGVzW2tleV0gPSBjb21wb25lbnQ7XG5cdFx0XHRcdHRhcmdldE1hdGNoZXNba2V5XSA9IHtcblx0XHRcdFx0XHR0YXJnZXQ6dGFyZ2V0LFxuXHRcdFx0XHRcdGNvbXBvbmVudDpjb21wb25lbnQsXG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMucHJldmlvdXNUYXJnZXRzID0gdGFyZ2V0TWF0Y2hlcztcblxuXHRcdC8vcmV2ZXJzZSBvcmRlciBrZXlzIGFyZSBzZXQgaW4gc28gZXZlbnRzIHRyaWdnZXIgaW4gY29ycmVjdCBzZXF1ZW5jZVxuXHRcdE9iamVjdC5rZXlzKHRhcmdldHMpLmZvckVhY2goKGtleSkgPT4ge1xuXHRcdFx0bGV0IHZhbHVlID0gbWF0Y2hlc1trZXldO1xuXHRcdFx0b3V0cHV0W2tleV0gPSB2YWx1ZTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHR0cmlnZ2VyRXZlbnRzKHR5cGUsIGUsIHRhcmdldHMpe1xuXHRcdHZhciBsaXN0ZW5lciA9IHRoaXMubGlzdGVuZXJzW3R5cGVdO1xuXG5cdFx0Zm9yKGxldCBrZXkgaW4gdGFyZ2V0cyl7XG5cdFx0XHRpZih0YXJnZXRzW2tleV0gJiYgbGlzdGVuZXIuY29tcG9uZW50cy5pbmNsdWRlcyhrZXkpKXtcblx0XHRcdFx0dGhpcy5kaXNwYXRjaChrZXkgKyBcIi1cIiArIHR5cGUsIGUsIHRhcmdldHNba2V5XSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdFxuXHRjbGVhcldhdGNoZXJzKCl7XG5cdFx0Zm9yKGxldCBrZXkgaW4gdGhpcy5saXN0ZW5lcnMpe1xuXHRcdFx0bGV0IGxpc3RlbmVyID0gdGhpcy5saXN0ZW5lcnNba2V5XTtcblx0XHRcdFxuXHRcdFx0aWYobGlzdGVuZXIuaGFuZGxlcil7XG5cdFx0XHRcdHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihrZXksIGxpc3RlbmVyLmhhbmRsZXIpO1xuXHRcdFx0XHRsaXN0ZW5lci5oYW5kbGVyID0gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdH1cbn1cblxuY2xhc3MgQ29tcG9uZW50RnVuY3Rpb25CaW5kZXJ7XG5cblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHRoaXMudGFibGUgPSB0YWJsZTtcblxuXHRcdHRoaXMuYmluZGluZ3MgPSB7fTtcblx0fVxuXG5cdGJpbmQodHlwZSwgZnVuY05hbWUsIGhhbmRsZXIpe1xuXHRcdGlmKCF0aGlzLmJpbmRpbmdzW3R5cGVdKXtcblx0XHRcdHRoaXMuYmluZGluZ3NbdHlwZV0gPSB7fTtcblx0XHR9XG5cblx0XHRpZih0aGlzLmJpbmRpbmdzW3R5cGVdW2Z1bmNOYW1lXSl7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJVbmFibGUgdG8gYmluZCBjb21wb25lbnQgaGFuZGxlciwgYSBtYXRjaGluZyBmdW5jdGlvbiBuYW1lIGlzIGFscmVhZHkgYm91bmRcIiwgdHlwZSwgZnVuY05hbWUsIGhhbmRsZXIpO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuYmluZGluZ3NbdHlwZV1bZnVuY05hbWVdID0gaGFuZGxlcjtcblx0XHR9XG5cdH1cblxuXHRoYW5kbGUodHlwZSwgY29tcG9uZW50LCBuYW1lKXtcblx0XHRpZih0aGlzLmJpbmRpbmdzW3R5cGVdICYmIHRoaXMuYmluZGluZ3NbdHlwZV1bbmFtZV0gJiYgdHlwZW9mIHRoaXMuYmluZGluZ3NbdHlwZV1bbmFtZV0uYmluZCA9PT0gJ2Z1bmN0aW9uJyl7XG5cdFx0XHRyZXR1cm4gdGhpcy5iaW5kaW5nc1t0eXBlXVtuYW1lXS5iaW5kKG51bGwsIGNvbXBvbmVudCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0aWYobmFtZSAhPT0gXCJ0aGVuXCIgJiYgdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIgJiYgIW5hbWUuc3RhcnRzV2l0aChcIl9cIikpe1xuXHRcdFx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMuZGVidWdJbnZhbGlkQ29tcG9uZW50RnVuY3Mpe1xuXHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJUaGUgXCIgKyB0eXBlICsgXCIgY29tcG9uZW50IGRvZXMgbm90IGhhdmUgYSBcIiArIG5hbWUgKyBcIiBmdW5jdGlvbiwgaGF2ZSB5b3UgY2hlY2tlZCB0aGF0IHlvdSBoYXZlIHRoZSBjb3JyZWN0IFRhYnVsYXRvciBtb2R1bGUgaW5zdGFsbGVkP1wiKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG5jbGFzcyBEYXRhTG9hZGVyIGV4dGVuZHMgQ29yZUZlYXR1cmV7XG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSk7XG5cdFx0XG5cdFx0dGhpcy5yZXF1ZXN0T3JkZXIgPSAwOyAvL3ByZXZlbnQgcmVxdWVzdHMgY29taW5nIG91dCBvZiBzZXF1ZW5jZSBpZiBvdmVycmlkZGVuIGJ5IGFub3RoZXIgbG9hZCByZXF1ZXN0XG5cdFx0dGhpcy5sb2FkaW5nID0gZmFsc2U7XG5cdH1cblx0XG5cdGluaXRpYWxpemUoKXt9XG5cdFxuXHRsb2FkKGRhdGEsIHBhcmFtcywgY29uZmlnLCByZXBsYWNlLCBzaWxlbnQsIGNvbHVtbnNDaGFuZ2VkKXtcblx0XHR2YXIgcmVxdWVzdE5vID0gKyt0aGlzLnJlcXVlc3RPcmRlcjtcblxuXHRcdGlmKHRoaXMudGFibGUuZGVzdHJveWVkKXtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaEV4dGVybmFsKFwiZGF0YUxvYWRpbmdcIiwgZGF0YSk7XG5cdFx0XG5cdFx0Ly9wYXJzZSBqc29uIGRhdGEgdG8gYXJyYXlcblx0XHRpZiAoZGF0YSAmJiAoZGF0YS5pbmRleE9mKFwie1wiKSA9PSAwIHx8IGRhdGEuaW5kZXhPZihcIltcIikgPT0gMCkpe1xuXHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0fVxuXHRcdFxuXHRcdGlmKHRoaXMuY29uZmlybShcImRhdGEtbG9hZGluZ1wiLCBbZGF0YSwgcGFyYW1zLCBjb25maWcsIHNpbGVudF0pKXtcblx0XHRcdHRoaXMubG9hZGluZyA9IHRydWU7XG5cdFx0XHRcblx0XHRcdGlmKCFzaWxlbnQpe1xuXHRcdFx0XHR0aGlzLmFsZXJ0TG9hZGVyKCk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdC8vZ2V0IHBhcmFtcyBmb3IgcmVxdWVzdFxuXHRcdFx0cGFyYW1zID0gdGhpcy5jaGFpbihcImRhdGEtcGFyYW1zXCIsIFtkYXRhLCBjb25maWcsIHNpbGVudF0sIHBhcmFtcyB8fCB7fSwgcGFyYW1zIHx8IHt9KTtcblx0XHRcdFxuXHRcdFx0cGFyYW1zID0gdGhpcy5tYXBQYXJhbXMocGFyYW1zLCB0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVNlbmRQYXJhbXMpO1xuXHRcdFx0XG5cdFx0XHR2YXIgcmVzdWx0ID0gdGhpcy5jaGFpbihcImRhdGEtbG9hZFwiLCBbZGF0YSwgcGFyYW1zLCBjb25maWcsIHNpbGVudF0sIGZhbHNlLCBQcm9taXNlLnJlc29sdmUoW10pKTtcblx0XHRcdFxuXHRcdFx0cmV0dXJuIHJlc3VsdC50aGVuKChyZXNwb25zZSkgPT4ge1xuXHRcdFx0XHRpZighdGhpcy50YWJsZS5kZXN0cm95ZWQpe1xuXHRcdFx0XHRcdGlmKCFBcnJheS5pc0FycmF5KHJlc3BvbnNlKSAmJiB0eXBlb2YgcmVzcG9uc2UgPT0gXCJvYmplY3RcIil7XG5cdFx0XHRcdFx0XHRyZXNwb25zZSA9IHRoaXMubWFwUGFyYW1zKHJlc3BvbnNlLCB0aGlzLm9iamVjdEludmVydCh0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YVJlY2VpdmVQYXJhbXMpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0dmFyIHJvd0RhdGEgPSB0aGlzLmNoYWluKFwiZGF0YS1sb2FkZWRcIiwgW3Jlc3BvbnNlXSwgbnVsbCwgcmVzcG9uc2UpO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKHJlcXVlc3RObyA9PSB0aGlzLnJlcXVlc3RPcmRlcil7XG5cdFx0XHRcdFx0XHR0aGlzLmNsZWFyQWxlcnQoKTtcblx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0aWYocm93RGF0YSAhPT0gZmFsc2Upe1xuXHRcdFx0XHRcdFx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJkYXRhTG9hZGVkXCIsIHJvd0RhdGEpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2V0RGF0YShyb3dEYXRhLCAgcmVwbGFjZSwgdHlwZW9mIGNvbHVtbnNDaGFuZ2VkID09PSBcInVuZGVmaW5lZFwiID8gIXJlcGxhY2UgOiBjb2x1bW5zQ2hhbmdlZCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiRGF0YSBMb2FkIFJlc3BvbnNlIEJsb2NrZWQgLSBBbiBhY3RpdmUgZGF0YSBsb2FkIHJlcXVlc3Qgd2FzIGJsb2NrZWQgYnkgYW4gYXR0ZW1wdCB0byBjaGFuZ2UgdGFibGUgZGF0YSB3aGlsZSB0aGUgcmVxdWVzdCB3YXMgYmVpbmcgbWFkZVwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJEYXRhIExvYWQgUmVzcG9uc2UgQmxvY2tlZCAtIFRhYmxlIGhhcyBiZWVuIGRlc3Ryb3llZFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fSkuY2F0Y2goKGVycm9yKSA9PiB7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJEYXRhIExvYWQgRXJyb3I6IFwiLCBlcnJvcik7XG5cdFx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFMb2FkRXJyb3JcIiwgZXJyb3IpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYoIXNpbGVudCl7XG5cdFx0XHRcdFx0dGhpcy5hbGVydEVycm9yKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMuY2xlYXJBbGVydCgpO1xuXHRcdFx0XHR9LCB0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YUxvYWRlckVycm9yVGltZW91dCk7XG5cdFx0XHR9KVxuXHRcdFx0XHQuZmluYWxseSgoKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5sb2FkaW5nID0gZmFsc2U7XG5cdFx0XHRcdH0pO1xuXHRcdH1lbHNlIHtcblx0XHRcdHRoaXMuZGlzcGF0Y2hFeHRlcm5hbChcImRhdGFMb2FkZWRcIiwgZGF0YSk7XG5cdFx0XHRcblx0XHRcdGlmKCFkYXRhKXtcblx0XHRcdFx0ZGF0YSA9IFtdO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIuc2V0RGF0YShkYXRhLCByZXBsYWNlLCB0eXBlb2YgY29sdW1uc0NoYW5nZWQgPT09IFwidW5kZWZpbmVkXCIgPyAhcmVwbGFjZSA6IGNvbHVtbnNDaGFuZ2VkKTtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblx0XHR9XG5cdH1cblx0XG5cdG1hcFBhcmFtcyhwYXJhbXMsIG1hcCl7XG5cdFx0dmFyIG91dHB1dCA9IHt9O1xuXHRcdFxuXHRcdGZvcihsZXQga2V5IGluIHBhcmFtcyl7XG5cdFx0XHRvdXRwdXRbbWFwLmhhc093blByb3BlcnR5KGtleSkgPyBtYXBba2V5XSA6IGtleV0gPSBwYXJhbXNba2V5XTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIG91dHB1dDtcblx0fVxuXHRcblx0b2JqZWN0SW52ZXJ0KG9iail7XG5cdFx0dmFyIG91dHB1dCA9IHt9O1xuXHRcdFxuXHRcdGZvcihsZXQga2V5IGluIG9iail7XG5cdFx0XHRvdXRwdXRbb2JqW2tleV1dID0ga2V5O1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gb3V0cHV0O1xuXHR9XG5cdFxuXHRibG9ja0FjdGl2ZUxvYWQoKXtcblx0XHR0aGlzLnJlcXVlc3RPcmRlcisrO1xuXHR9XG5cdFxuXHRhbGVydExvYWRlcigpe1xuXHRcdHZhciBzaG91bGRMb2FkID0gdHlwZW9mIHRoaXMudGFibGUub3B0aW9ucy5kYXRhTG9hZGVyID09PSBcImZ1bmN0aW9uXCIgPyB0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YUxvYWRlcigpIDogdGhpcy50YWJsZS5vcHRpb25zLmRhdGFMb2FkZXI7XG5cdFx0XG5cdFx0aWYoc2hvdWxkTG9hZCl7XG5cdFx0XHR0aGlzLnRhYmxlLmFsZXJ0TWFuYWdlci5hbGVydCh0aGlzLnRhYmxlLm9wdGlvbnMuZGF0YUxvYWRlckxvYWRpbmcgfHwgdGhpcy5sYW5nVGV4dChcImRhdGF8bG9hZGluZ1wiKSk7XG5cdFx0fVxuXHR9XG5cdFxuXHRhbGVydEVycm9yKCl7XG5cdFx0dGhpcy50YWJsZS5hbGVydE1hbmFnZXIuYWxlcnQodGhpcy50YWJsZS5vcHRpb25zLmRhdGFMb2FkZXJFcnJvciB8fCB0aGlzLmxhbmdUZXh0KFwiZGF0YXxlcnJvclwiKSwgXCJlcnJvclwiKTtcblx0fVxuXHRcblx0Y2xlYXJBbGVydCgpe1xuXHRcdHRoaXMudGFibGUuYWxlcnRNYW5hZ2VyLmNsZWFyKCk7XG5cdH1cbn1cblxuY2xhc3MgRXh0ZXJuYWxFdmVudEJ1cyB7XG5cblx0Y29uc3RydWN0b3IodGFibGUsIG9wdGlvbnNMaXN0LCBkZWJ1Zyl7XG5cdFx0dGhpcy50YWJsZSA9IHRhYmxlO1xuXHRcdHRoaXMuZXZlbnRzID0ge307XG5cdFx0dGhpcy5vcHRpb25zTGlzdCA9IG9wdGlvbnNMaXN0IHx8IHt9O1xuXHRcdHRoaXMuc3Vic2NyaXB0aW9uTm90aWZpZXJzID0ge307XG5cblx0XHR0aGlzLmRpc3BhdGNoID0gZGVidWcgPyB0aGlzLl9kZWJ1Z0Rpc3BhdGNoLmJpbmQodGhpcykgOiB0aGlzLl9kaXNwYXRjaC5iaW5kKHRoaXMpO1xuXHRcdHRoaXMuZGVidWcgPSBkZWJ1Zztcblx0fVxuXG5cdHN1YnNjcmlwdGlvbkNoYW5nZShrZXksIGNhbGxiYWNrKXtcblx0XHRpZighdGhpcy5zdWJzY3JpcHRpb25Ob3RpZmllcnNba2V5XSl7XG5cdFx0XHR0aGlzLnN1YnNjcmlwdGlvbk5vdGlmaWVyc1trZXldID0gW107XG5cdFx0fVxuXG5cdFx0dGhpcy5zdWJzY3JpcHRpb25Ob3RpZmllcnNba2V5XS5wdXNoKGNhbGxiYWNrKTtcblxuXHRcdGlmKHRoaXMuc3Vic2NyaWJlZChrZXkpKXtcblx0XHRcdHRoaXMuX25vdGlmeVN1YnNjcmlwdGlvbkNoYW5nZShrZXksIHRydWUpO1xuXHRcdH1cblx0fVxuXG5cdHN1YnNjcmliZShrZXksIGNhbGxiYWNrKXtcblx0XHRpZighdGhpcy5ldmVudHNba2V5XSl7XG5cdFx0XHR0aGlzLmV2ZW50c1trZXldID0gW107XG5cdFx0fVxuXG5cdFx0dGhpcy5ldmVudHNba2V5XS5wdXNoKGNhbGxiYWNrKTtcblxuXHRcdHRoaXMuX25vdGlmeVN1YnNjcmlwdGlvbkNoYW5nZShrZXksIHRydWUpO1xuXHR9XG5cblx0dW5zdWJzY3JpYmUoa2V5LCBjYWxsYmFjayl7XG5cdFx0dmFyIGluZGV4O1xuXG5cdFx0aWYodGhpcy5ldmVudHNba2V5XSl7XG5cdFx0XHRpZihjYWxsYmFjayl7XG5cdFx0XHRcdGluZGV4ID0gdGhpcy5ldmVudHNba2V5XS5maW5kSW5kZXgoKGl0ZW0pID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gaXRlbSA9PT0gY2FsbGJhY2s7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGlmKGluZGV4ID4gLTEpe1xuXHRcdFx0XHRcdHRoaXMuZXZlbnRzW2tleV0uc3BsaWNlKGluZGV4LCAxKTtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIkNhbm5vdCByZW1vdmUgZXZlbnQsIG5vIG1hdGNoaW5nIGV2ZW50IGZvdW5kOlwiLCBrZXksIGNhbGxiYWNrKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0ZGVsZXRlIHRoaXMuZXZlbnRzW2tleV07XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiQ2Fubm90IHJlbW92ZSBldmVudCwgbm8gZXZlbnRzIHNldCBvbjpcIiwga2V5KTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLl9ub3RpZnlTdWJzY3JpcHRpb25DaGFuZ2Uoa2V5LCBmYWxzZSk7XG5cdH1cblxuXHRzdWJzY3JpYmVkKGtleSl7XG5cdFx0cmV0dXJuIHRoaXMuZXZlbnRzW2tleV0gJiYgdGhpcy5ldmVudHNba2V5XS5sZW5ndGg7XG5cdH1cblxuXHRfbm90aWZ5U3Vic2NyaXB0aW9uQ2hhbmdlKGtleSwgc3Vic2NyaWJlZCl7XG5cdFx0dmFyIG5vdGlmaWVycyA9IHRoaXMuc3Vic2NyaXB0aW9uTm90aWZpZXJzW2tleV07XG5cblx0XHRpZihub3RpZmllcnMpe1xuXHRcdFx0bm90aWZpZXJzLmZvckVhY2goKGNhbGxiYWNrKT0+e1xuXHRcdFx0XHRjYWxsYmFjayhzdWJzY3JpYmVkKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdF9kaXNwYXRjaCgpe1xuXHRcdHZhciBhcmdzID0gQXJyYXkuZnJvbShhcmd1bWVudHMpLFxuXHRcdGtleSA9IGFyZ3Muc2hpZnQoKSxcblx0XHRyZXN1bHQ7XG5cblx0XHRpZih0aGlzLmV2ZW50c1trZXldKXtcblx0XHRcdHRoaXMuZXZlbnRzW2tleV0uZm9yRWFjaCgoY2FsbGJhY2ssIGkpID0+IHtcblx0XHRcdFx0bGV0IGNhbGxSZXN1bHQgPSBjYWxsYmFjay5hcHBseSh0aGlzLnRhYmxlLCBhcmdzKTtcblxuXHRcdFx0XHRpZighaSl7XG5cdFx0XHRcdFx0cmVzdWx0ID0gY2FsbFJlc3VsdDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdF9kZWJ1Z0Rpc3BhdGNoKCl7XG5cdFx0dmFyIGFyZ3MgPSBBcnJheS5mcm9tKGFyZ3VtZW50cyksXG5cdFx0a2V5ID0gYXJnc1swXTtcblxuXHRcdGFyZ3NbMF0gPSBcIkV4dGVybmFsRXZlbnQ6XCIgKyBhcmdzWzBdO1xuXG5cdFx0aWYodGhpcy5kZWJ1ZyA9PT0gdHJ1ZSB8fCB0aGlzLmRlYnVnLmluY2x1ZGVzKGtleSkpe1xuXHRcdFx0Y29uc29sZS5sb2coLi4uYXJncyk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX2Rpc3BhdGNoKC4uLmFyZ3VtZW50cyk7XG5cdH1cbn1cblxuY2xhc3MgSW50ZXJuYWxFdmVudEJ1cyB7XG5cblx0Y29uc3RydWN0b3IoZGVidWcpe1xuXHRcdHRoaXMuZXZlbnRzID0ge307XG5cdFx0dGhpcy5zdWJzY3JpcHRpb25Ob3RpZmllcnMgPSB7fTtcblxuXHRcdHRoaXMuZGlzcGF0Y2ggPSBkZWJ1ZyA/IHRoaXMuX2RlYnVnRGlzcGF0Y2guYmluZCh0aGlzKSA6IHRoaXMuX2Rpc3BhdGNoLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5jaGFpbiA9IGRlYnVnID8gdGhpcy5fZGVidWdDaGFpbi5iaW5kKHRoaXMpIDogdGhpcy5fY2hhaW4uYmluZCh0aGlzKTtcblx0XHR0aGlzLmNvbmZpcm0gPSBkZWJ1ZyA/IHRoaXMuX2RlYnVnQ29uZmlybS5iaW5kKHRoaXMpIDogdGhpcy5fY29uZmlybS5iaW5kKHRoaXMpO1xuXHRcdHRoaXMuZGVidWcgPSBkZWJ1Zztcblx0fVxuXG5cdHN1YnNjcmlwdGlvbkNoYW5nZShrZXksIGNhbGxiYWNrKXtcblx0XHRpZighdGhpcy5zdWJzY3JpcHRpb25Ob3RpZmllcnNba2V5XSl7XG5cdFx0XHR0aGlzLnN1YnNjcmlwdGlvbk5vdGlmaWVyc1trZXldID0gW107XG5cdFx0fVxuXG5cdFx0dGhpcy5zdWJzY3JpcHRpb25Ob3RpZmllcnNba2V5XS5wdXNoKGNhbGxiYWNrKTtcblxuXHRcdGlmKHRoaXMuc3Vic2NyaWJlZChrZXkpKXtcblx0XHRcdHRoaXMuX25vdGlmeVN1YnNjcmlwdGlvbkNoYW5nZShrZXksIHRydWUpO1xuXHRcdH1cblx0fVxuXG5cdHN1YnNjcmliZShrZXksIGNhbGxiYWNrLCBwcmlvcml0eSA9IDEwMDAwKXtcblx0XHRpZighdGhpcy5ldmVudHNba2V5XSl7XG5cdFx0XHR0aGlzLmV2ZW50c1trZXldID0gW107XG5cdFx0fVxuXG5cdFx0dGhpcy5ldmVudHNba2V5XS5wdXNoKHtjYWxsYmFjaywgcHJpb3JpdHl9KTtcblxuXHRcdHRoaXMuZXZlbnRzW2tleV0uc29ydCgoYSwgYikgPT4ge1xuXHRcdFx0cmV0dXJuIGEucHJpb3JpdHkgLSBiLnByaW9yaXR5O1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5fbm90aWZ5U3Vic2NyaXB0aW9uQ2hhbmdlKGtleSwgdHJ1ZSk7XG5cdH1cblxuXHR1bnN1YnNjcmliZShrZXksIGNhbGxiYWNrKXtcblx0XHR2YXIgaW5kZXg7XG5cblx0XHRpZih0aGlzLmV2ZW50c1trZXldKXtcblx0XHRcdGlmKGNhbGxiYWNrKXtcblx0XHRcdFx0aW5kZXggPSB0aGlzLmV2ZW50c1trZXldLmZpbmRJbmRleCgoaXRlbSkgPT4ge1xuXHRcdFx0XHRcdHJldHVybiBpdGVtLmNhbGxiYWNrID09PSBjYWxsYmFjaztcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHRcdFx0dGhpcy5ldmVudHNba2V5XS5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiQ2Fubm90IHJlbW92ZSBldmVudCwgbm8gbWF0Y2hpbmcgZXZlbnQgZm91bmQ6XCIsIGtleSwgY2FsbGJhY2spO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkNhbm5vdCByZW1vdmUgZXZlbnQsIG5vIGV2ZW50cyBzZXQgb246XCIsIGtleSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0dGhpcy5fbm90aWZ5U3Vic2NyaXB0aW9uQ2hhbmdlKGtleSwgZmFsc2UpO1xuXHR9XG5cblx0c3Vic2NyaWJlZChrZXkpe1xuXHRcdHJldHVybiB0aGlzLmV2ZW50c1trZXldICYmIHRoaXMuZXZlbnRzW2tleV0ubGVuZ3RoO1xuXHR9XG5cblx0X2NoYWluKGtleSwgYXJncywgaW5pdGlhbFZhbHVlLCBmYWxsYmFjayl7XG5cdFx0dmFyIHZhbHVlID0gaW5pdGlhbFZhbHVlO1xuXG5cdFx0aWYoIUFycmF5LmlzQXJyYXkoYXJncykpe1xuXHRcdFx0YXJncyA9IFthcmdzXTtcblx0XHR9XG5cblx0XHRpZih0aGlzLnN1YnNjcmliZWQoa2V5KSl7XG5cdFx0XHR0aGlzLmV2ZW50c1trZXldLmZvckVhY2goKHN1YnNjcmliZXIsIGkpID0+IHtcblx0XHRcdFx0dmFsdWUgPSBzdWJzY3JpYmVyLmNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MuY29uY2F0KFt2YWx1ZV0pKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmV0dXJuIHR5cGVvZiBmYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiID8gZmFsbGJhY2soKSA6IGZhbGxiYWNrO1xuXHRcdH1cblx0fVxuXG5cdF9jb25maXJtKGtleSwgYXJncyl7XG5cdFx0dmFyIGNvbmZpcm1lZCA9IGZhbHNlO1xuXG5cdFx0aWYoIUFycmF5LmlzQXJyYXkoYXJncykpe1xuXHRcdFx0YXJncyA9IFthcmdzXTtcblx0XHR9XG5cblx0XHRpZih0aGlzLnN1YnNjcmliZWQoa2V5KSl7XG5cdFx0XHR0aGlzLmV2ZW50c1trZXldLmZvckVhY2goKHN1YnNjcmliZXIsIGkpID0+IHtcblx0XHRcdFx0aWYoc3Vic2NyaWJlci5jYWxsYmFjay5hcHBseSh0aGlzLCBhcmdzKSl7XG5cdFx0XHRcdFx0Y29uZmlybWVkID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNvbmZpcm1lZDtcblx0fVxuXG5cdF9ub3RpZnlTdWJzY3JpcHRpb25DaGFuZ2Uoa2V5LCBzdWJzY3JpYmVkKXtcblx0XHR2YXIgbm90aWZpZXJzID0gdGhpcy5zdWJzY3JpcHRpb25Ob3RpZmllcnNba2V5XTtcblxuXHRcdGlmKG5vdGlmaWVycyl7XG5cdFx0XHRub3RpZmllcnMuZm9yRWFjaCgoY2FsbGJhY2spPT57XG5cdFx0XHRcdGNhbGxiYWNrKHN1YnNjcmliZWQpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0X2Rpc3BhdGNoKCl7XG5cdFx0dmFyIGFyZ3MgPSBBcnJheS5mcm9tKGFyZ3VtZW50cyksXG5cdFx0a2V5ID0gYXJncy5zaGlmdCgpO1xuXG5cdFx0aWYodGhpcy5ldmVudHNba2V5XSl7XG5cdFx0XHR0aGlzLmV2ZW50c1trZXldLmZvckVhY2goKHN1YnNjcmliZXIpID0+IHtcblx0XHRcdFx0c3Vic2NyaWJlci5jYWxsYmFjay5hcHBseSh0aGlzLCBhcmdzKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdF9kZWJ1Z0Rpc3BhdGNoKCl7XG5cdFx0dmFyIGFyZ3MgPSBBcnJheS5mcm9tKGFyZ3VtZW50cyksXG5cdFx0a2V5ID0gYXJnc1swXTtcblxuXHRcdGFyZ3NbMF0gPSBcIkludGVybmFsRXZlbnQ6XCIgKyBrZXk7XG5cblx0XHRpZih0aGlzLmRlYnVnID09PSB0cnVlIHx8IHRoaXMuZGVidWcuaW5jbHVkZXMoa2V5KSl7XG5cdFx0XHRjb25zb2xlLmxvZyguLi5hcmdzKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5fZGlzcGF0Y2goLi4uYXJndW1lbnRzKTtcblx0fVxuXG5cdF9kZWJ1Z0NoYWluKCl7XG5cdFx0dmFyIGFyZ3MgPSBBcnJheS5mcm9tKGFyZ3VtZW50cyksXG5cdFx0a2V5ID0gYXJnc1swXTtcblxuXHRcdGFyZ3NbMF0gPSBcIkludGVybmFsRXZlbnQ6XCIgKyBrZXk7XG5cblx0XHRpZih0aGlzLmRlYnVnID09PSB0cnVlIHx8IHRoaXMuZGVidWcuaW5jbHVkZXMoa2V5KSl7XG5cdFx0XHRjb25zb2xlLmxvZyguLi5hcmdzKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5fY2hhaW4oLi4uYXJndW1lbnRzKTtcblx0fVxuXG5cdF9kZWJ1Z0NvbmZpcm0oKXtcblx0XHR2YXIgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzKSxcblx0XHRrZXkgPSBhcmdzWzBdO1xuXG5cdFx0YXJnc1swXSA9IFwiSW50ZXJuYWxFdmVudDpcIiArIGtleTtcblxuXHRcdGlmKHRoaXMuZGVidWcgPT09IHRydWUgfHwgdGhpcy5kZWJ1Zy5pbmNsdWRlcyhrZXkpKXtcblx0XHRcdGNvbnNvbGUubG9nKC4uLmFyZ3MpO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLl9jb25maXJtKC4uLmFyZ3VtZW50cyk7XG5cdH1cbn1cblxuY2xhc3MgRGVwcmVjYXRpb25BZHZpc29yIGV4dGVuZHMgQ29yZUZlYXR1cmV7XG5cdFxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHR9XG5cdFxuXHRfd2FyblVzZXIoKXtcblx0XHRpZih0aGlzLm9wdGlvbnMoXCJkZWJ1Z0RlcHJlY2F0aW9uXCIpKXtcblx0XHRcdGNvbnNvbGUud2FybiguLi5hcmd1bWVudHMpO1xuXHRcdH1cblx0fVxuXHRcblx0Y2hlY2sob2xkT3B0aW9uLCBuZXdPcHRpb24sIGNvbnZlcnQpe1xuXHRcdHZhciBtc2cgPSBcIlwiO1xuXHRcdFxuXHRcdGlmKHR5cGVvZiB0aGlzLm9wdGlvbnMob2xkT3B0aW9uKSAhPT0gXCJ1bmRlZmluZWRcIil7XG5cdFx0XHRtc2cgPSBcIkRlcHJlY2F0ZWQgU2V0dXAgT3B0aW9uIC0gVXNlIG9mIHRoZSAlY1wiICsgb2xkT3B0aW9uICsgXCIlYyBvcHRpb24gaXMgbm93IGRlcHJlY2F0ZWRcIjtcblx0XHRcdFxuXHRcdFx0aWYobmV3T3B0aW9uKXtcblx0XHRcdFx0bXNnID0gbXNnICsgXCIsIFBsZWFzZSB1c2UgdGhlICVjXCIgKyBuZXdPcHRpb24gKyBcIiVjIG9wdGlvbiBpbnN0ZWFkXCI7XG5cdFx0XHRcdHRoaXMuX3dhcm5Vc2VyKG1zZywgJ2ZvbnQtd2VpZ2h0OiBib2xkOycsICdmb250LXdlaWdodDogbm9ybWFsOycsICdmb250LXdlaWdodDogYm9sZDsnLCAnZm9udC13ZWlnaHQ6IG5vcm1hbDsnKTtcblxuXHRcdFx0XHRpZihjb252ZXJ0KXtcblx0XHRcdFx0XHR0aGlzLnRhYmxlLm9wdGlvbnNbbmV3T3B0aW9uXSA9IHRoaXMudGFibGUub3B0aW9uc1tvbGRPcHRpb25dO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRoaXMuX3dhcm5Vc2VyKG1zZywgJ2ZvbnQtd2VpZ2h0OiBib2xkOycsICdmb250LXdlaWdodDogbm9ybWFsOycpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHR9XG5cdFxuXHRjaGVja01zZyhvbGRPcHRpb24sIG1zZyl7XG5cdFx0aWYodHlwZW9mIHRoaXMub3B0aW9ucyhvbGRPcHRpb24pICE9PSBcInVuZGVmaW5lZFwiKXtcblx0XHRcdHRoaXMuX3dhcm5Vc2VyKFwiJWNEZXByZWNhdGVkIFNldHVwIE9wdGlvbiAtIFVzZSBvZiB0aGUgJWNcIiArIG9sZE9wdGlvbiArIFwiICVjIG9wdGlvbiBpcyBub3cgZGVwcmVjYXRlZCwgXCIgKyBtc2csICdmb250LXdlaWdodDogbm9ybWFsOycsICdmb250LXdlaWdodDogYm9sZDsnLCAnZm9udC13ZWlnaHQ6IG5vcm1hbDsnKTtcblx0XHRcdFxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1lbHNlIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0fVxuXHRcblx0bXNnKG1zZyl7XG5cdFx0dGhpcy5fd2FyblVzZXIobXNnKTtcblx0fVxufVxuXG5jbGFzcyBEZXBlbmRlbmN5UmVnaXN0cnkgZXh0ZW5kcyBDb3JlRmVhdHVyZXtcclxuXHRcclxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XHJcblx0XHRzdXBlcih0YWJsZSk7XHJcblx0XHRcclxuXHRcdHRoaXMuZGVwcyA9IHt9O1xyXG5cdFx0XHJcblx0XHR0aGlzLnByb3BzID0ge1xyXG5cdFx0XHRcclxuXHRcdH07XHJcblx0fVxyXG5cdFxyXG5cdGluaXRpYWxpemUoKXtcclxuXHRcdHRoaXMuZGVwcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3B0aW9ucyhcImRlcGVuZGVuY2llc1wiKSk7XHJcblx0fVxyXG5cdFxyXG5cdGxvb2t1cChrZXksIHByb3AsIHNpbGVudCl7XHJcblx0XHRpZihBcnJheS5pc0FycmF5KGtleSkpe1xyXG5cdFx0XHRmb3IgKGNvbnN0IGl0ZW0gb2Yga2V5KSB7XHJcblx0XHRcdFx0dmFyIG1hdGNoID0gdGhpcy5sb29rdXAoaXRlbSwgcHJvcCwgdHJ1ZSk7XHJcblxyXG5cdFx0XHRcdGlmKG1hdGNoKXtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYobWF0Y2gpe1xyXG5cdFx0XHRcdHJldHVybiBtYXRjaDtcclxuXHRcdFx0fWVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuZXJyb3Ioa2V5KTtcclxuXHRcdFx0fVxyXG5cdFx0fWVsc2Uge1xyXG5cdFx0XHRpZihwcm9wKXtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5sb29rdXBQcm9wKGtleSwgcHJvcCwgc2lsZW50KTtcclxuXHRcdFx0fWVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLmxvb2t1cEtleShrZXksIHNpbGVudCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0bG9va3VwUHJvcChrZXksIHByb3AsIHNpbGVudCl7XHJcblx0XHR2YXIgZGVwZW5kZW5jeTtcclxuXHRcdFxyXG5cdFx0aWYodGhpcy5wcm9wc1trZXldICYmIHRoaXMucHJvcHNba2V5XVtwcm9wXSl7XHJcblx0XHRcdHJldHVybiB0aGlzLnByb3BzW2tleV1bcHJvcF07XHJcblx0XHR9ZWxzZSB7XHJcblx0XHRcdGRlcGVuZGVuY3kgPSB0aGlzLmxvb2t1cEtleShrZXksIHNpbGVudCk7XHJcblx0XHRcdFxyXG5cdFx0XHRpZihkZXBlbmRlbmN5KXtcclxuXHRcdFx0XHRpZighdGhpcy5wcm9wc1trZXldKXtcclxuXHRcdFx0XHRcdHRoaXMucHJvcHNba2V5XSA9IHt9O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRcclxuXHRcdFx0XHR0aGlzLnByb3BzW2tleV1bcHJvcF0gPSBkZXBlbmRlbmN5W3Byb3BdIHx8IGRlcGVuZGVuY3k7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMucHJvcHNba2V5XVtwcm9wXTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRsb29rdXBLZXkoa2V5LCBzaWxlbnQpe1xyXG5cdFx0dmFyIGRlcGVuZGVuY3k7XHJcblx0XHRcclxuXHRcdGlmKHRoaXMuZGVwc1trZXldKXtcclxuXHRcdFx0ZGVwZW5kZW5jeSA9IHRoaXMuZGVwc1trZXldO1xyXG5cdFx0fWVsc2UgaWYod2luZG93W2tleV0pe1xyXG5cdFx0XHR0aGlzLmRlcHNba2V5XSA9IHdpbmRvd1trZXldO1xyXG5cdFx0XHRkZXBlbmRlbmN5ID0gdGhpcy5kZXBzW2tleV07XHJcblx0XHR9ZWxzZSB7XHJcblx0XHRcdGlmKCFzaWxlbnQpe1xyXG5cdFx0XHRcdHRoaXMuZXJyb3Ioa2V5KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRyZXR1cm4gZGVwZW5kZW5jeTtcclxuXHR9XHJcblxyXG5cdGVycm9yKGtleSl7XHJcblx0XHRjb25zb2xlLmVycm9yKFwiVW5hYmxlIHRvIGZpbmQgZGVwZW5kZW5jeVwiLCBrZXksIFwiUGxlYXNlIGNoZWNrIGRvY3VtZW50YXRpb24gYW5kIGVuc3VyZSB5b3UgaGF2ZSBpbXBvcnRlZCB0aGUgcmVxdWlyZWQgbGlicmFyeSBpbnRvIHlvdXIgcHJvamVjdFwiKTtcclxuXHR9XHJcbn1cblxuLy9yZXNpemUgY29sdW1ucyB0byBmaXQgZGF0YSB0aGV5IGNvbnRhaW5cbmZ1bmN0aW9uIGZpdERhdGEoY29sdW1ucywgZm9yY2VkKXtcblx0aWYoZm9yY2VkKXtcblx0XHR0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIucmVuZGVyZXIucmVpbml0aWFsaXplQ29sdW1uV2lkdGhzKGNvbHVtbnMpO1xuXHR9XG5cdFxuXHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpe1xuXHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZSgpO1xuXHR9XG59XG5cbi8vcmVzaXplIGNvbHVtbnMgdG8gZml0IGRhdGEgdGhleSBjb250YWluIGFuZCBzdHJldGNoIHJvdyB0byBmaWxsIHRhYmxlLCBhbHNvIHVzZWQgZm9yIGZpdERhdGFUYWJsZVxuZnVuY3Rpb24gZml0RGF0YUdlbmVyYWwoY29sdW1ucywgZm9yY2VkKXtcblx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdH0pO1xuXG5cdGlmKHRoaXMudGFibGUub3B0aW9ucy5yZXNwb25zaXZlTGF5b3V0ICYmIHRoaXMudGFibGUubW9kRXhpc3RzKFwicmVzcG9uc2l2ZUxheW91dFwiLCB0cnVlKSl7XG5cdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdH1cbn1cblxuLy9yZXNpemUgY29sdW1ucyB0byBmaXQgZGF0YSB0aGUgY29udGFpbiBhbmQgc3RyZXRjaCBsYXN0IGNvbHVtbiB0byBmaWxsIHRhYmxlXG5mdW5jdGlvbiBmaXREYXRhU3RyZXRjaChjb2x1bW5zLCBmb3JjZWQpe1xuXHR2YXIgY29sc1dpZHRoID0gMCxcblx0dGFibGVXaWR0aCA9IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudFdpZHRoLFxuXHRnYXAgPSAwLFxuXHRsYXN0Q29sID0gZmFsc2U7XG5cblx0Y29sdW1ucy5mb3JFYWNoKChjb2x1bW4sIGkpID0+IHtcblx0XHRpZighY29sdW1uLndpZHRoRml4ZWQpe1xuXHRcdFx0Y29sdW1uLnJlaW5pdGlhbGl6ZVdpZHRoKCk7XG5cdFx0fVxuXG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLnJlc3BvbnNpdmVMYXlvdXQgPyBjb2x1bW4ubW9kdWxlcy5yZXNwb25zaXZlLnZpc2libGUgOiBjb2x1bW4udmlzaWJsZSl7XG5cdFx0XHRsYXN0Q29sID0gY29sdW1uO1xuXHRcdH1cblxuXHRcdGlmKGNvbHVtbi52aXNpYmxlKXtcblx0XHRcdGNvbHNXaWR0aCArPSBjb2x1bW4uZ2V0V2lkdGgoKTtcblx0XHR9XG5cdH0pO1xuXG5cdGlmKGxhc3RDb2wpe1xuXHRcdGdhcCA9IHRhYmxlV2lkdGggLSBjb2xzV2lkdGggKyBsYXN0Q29sLmdldFdpZHRoKCk7XG5cblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpe1xuXHRcdFx0bGFzdENvbC5zZXRXaWR0aCgwKTtcblx0XHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZSgpO1xuXHRcdH1cblxuXHRcdGlmKGdhcCA+IDApe1xuXHRcdFx0bGFzdENvbC5zZXRXaWR0aChnYXApO1xuXHRcdH1lbHNlIHtcblx0XHRcdGxhc3RDb2wucmVpbml0aWFsaXplV2lkdGgoKTtcblx0XHR9XG5cdH1lbHNlIHtcblx0XHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpe1xuXHRcdFx0dGhpcy50YWJsZS5tb2R1bGVzLnJlc3BvbnNpdmVMYXlvdXQudXBkYXRlKCk7XG5cdFx0fVxuXHR9XG59XG5cbi8vcmVzaXplIGNvbHVtbnMgdG8gZml0XG5mdW5jdGlvbiBmaXRDb2x1bW5zKGNvbHVtbnMsIGZvcmNlZCl7XG5cdHZhciB0b3RhbFdpZHRoID0gdGhpcy50YWJsZS5yb3dNYW5hZ2VyLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7IC8vdGFibGUgZWxlbWVudCB3aWR0aFxuXHR2YXIgZml4ZWRXaWR0aCA9IDA7IC8vdG90YWwgd2lkdGggb2YgY29sdW1ucyB3aXRoIGEgZGVmaW5lZCB3aWR0aFxuXHR2YXIgZmxleFdpZHRoID0gMDsgLy90b3RhbCB3aWR0aCBhdmFpbGFibGUgdG8gZmxleGlibGUgY29sdW1uc1xuXHR2YXIgZmxleEdyb3dVbml0cyA9IDA7IC8vdG90YWwgbnVtYmVyIG9mIHdpZHRoR3JvdyBibG9ja3MgYWNyb3NzIGFsbCBjb2x1bW5zXG5cdHZhciBmbGV4Q29sV2lkdGggPSAwOyAvL2Rlc2lyZWQgd2lkdGggb2YgZmxleGlibGUgY29sdW1uc1xuXHR2YXIgZmxleENvbHVtbnMgPSBbXTsgLy9hcnJheSBvZiBmbGV4aWJsZSB3aWR0aCBjb2x1bW5zXG5cdHZhciBmaXhlZFNocmlua0NvbHVtbnMgPSBbXTsgLy9hcnJheSBvZiBmaXhlZCB3aWR0aCBjb2x1bW5zIHRoYXQgY2FuIHNocmlua1xuXHR2YXIgZmxleFNocmlua1VuaXRzID0gMDsgLy90b3RhbCBudW1iZXIgb2Ygd2lkdGhTaHJpbmsgYmxvY2tzIGFjcm9zcyBhbGwgY29sdW1uc1xuXHR2YXIgb3ZlcmZsb3dXaWR0aCA9IDA7IC8vaG9yaXpvbnRhbCBvdmVyZmxvdyB3aWR0aFxuXHR2YXIgZ2FwRmlsbCA9IDA7IC8vbnVtYmVyIG9mIHBpeGVscyB0byBiZSBhZGRlZCB0byBmaW5hbCBjb2x1bW4gdG8gY2xvc2UgYW5kIGhhbGYgcGl4ZWwgZ2Fwc1xuXG5cdGZ1bmN0aW9uIGNhbGNXaWR0aCh3aWR0aCl7XG5cdFx0dmFyIGNvbFdpZHRoO1xuXG5cdFx0aWYodHlwZW9mKHdpZHRoKSA9PSBcInN0cmluZ1wiKXtcblx0XHRcdGlmKHdpZHRoLmluZGV4T2YoXCIlXCIpID4gLTEpe1xuXHRcdFx0XHRjb2xXaWR0aCA9ICh0b3RhbFdpZHRoIC8gMTAwKSAqIHBhcnNlSW50KHdpZHRoKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Y29sV2lkdGggPSBwYXJzZUludCh3aWR0aCk7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29sV2lkdGggPSB3aWR0aDtcblx0XHR9XG5cblx0XHRyZXR1cm4gY29sV2lkdGg7XG5cdH1cblxuXHQvL2Vuc3VyZSBjb2x1bW5zIHJlc2l6ZSB0byB0YWtlIHVwIHRoZSBjb3JyZWN0IGFtb3VudCBvZiBzcGFjZVxuXHRmdW5jdGlvbiBzY2FsZUNvbHVtbnMoY29sdW1ucywgZnJlZVNwYWNlLCBjb2xXaWR0aCwgc2hyaW5rQ29scyl7XG5cdFx0dmFyIG92ZXJzaXplQ29scyA9IFtdLFxuXHRcdG92ZXJzaXplU3BhY2UgPSAwLFxuXHRcdHJlbWFpbmluZ1NwYWNlID0gMCxcblx0XHRuZXh0Q29sV2lkdGggPSAwLFxuXHRcdHJlbWFpbmluZ0ZsZXhHcm93VW5pdHMgPSBmbGV4R3Jvd1VuaXRzLFxuXHRcdGdhcCA9IDAsXG5cdFx0Y2hhbmdlVW5pdHMgPSAwLFxuXHRcdHVuZGVyc2l6ZUNvbHMgPSBbXTtcblxuXHRcdGZ1bmN0aW9uIGNhbGNHcm93KGNvbCl7XG5cdFx0XHRyZXR1cm4gKGNvbFdpZHRoICogKGNvbC5jb2x1bW4uZGVmaW5pdGlvbi53aWR0aEdyb3cgfHwgMSkpO1xuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGNhbGNTaHJpbmsoY29sKXtcblx0XHRcdHJldHVybiAgKGNhbGNXaWR0aChjb2wud2lkdGgpIC0gKGNvbFdpZHRoICogKGNvbC5jb2x1bW4uZGVmaW5pdGlvbi53aWR0aFNocmluayB8fCAwKSkpO1xuXHRcdH1cblxuXHRcdGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2wsIGkpe1xuXHRcdFx0dmFyIHdpZHRoID0gc2hyaW5rQ29scyA/IGNhbGNTaHJpbmsoY29sKSA6IGNhbGNHcm93KGNvbCk7XG5cdFx0XHRpZihjb2wuY29sdW1uLm1pbldpZHRoID49IHdpZHRoKXtcblx0XHRcdFx0b3ZlcnNpemVDb2xzLnB1c2goY29sKTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0aWYoY29sLmNvbHVtbi5tYXhXaWR0aCAmJiBjb2wuY29sdW1uLm1heFdpZHRoIDwgd2lkdGgpe1xuXHRcdFx0XHRcdGNvbC53aWR0aCA9IGNvbC5jb2x1bW4ubWF4V2lkdGg7XG5cdFx0XHRcdFx0ZnJlZVNwYWNlIC09IGNvbC5jb2x1bW4ubWF4V2lkdGg7XG5cblx0XHRcdFx0XHRyZW1haW5pbmdGbGV4R3Jvd1VuaXRzIC09IHNocmlua0NvbHMgPyAoY29sLmNvbHVtbi5kZWZpbml0aW9uLndpZHRoU2hyaW5rIHx8IDEpIDogKGNvbC5jb2x1bW4uZGVmaW5pdGlvbi53aWR0aEdyb3cgfHwgMSk7XG5cblx0XHRcdFx0XHRpZihyZW1haW5pbmdGbGV4R3Jvd1VuaXRzKXtcblx0XHRcdFx0XHRcdGNvbFdpZHRoID0gTWF0aC5mbG9vcihmcmVlU3BhY2UvcmVtYWluaW5nRmxleEdyb3dVbml0cyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dW5kZXJzaXplQ29scy5wdXNoKGNvbCk7XG5cdFx0XHRcdFx0Y2hhbmdlVW5pdHMgKz0gc2hyaW5rQ29scyA/IChjb2wuY29sdW1uLmRlZmluaXRpb24ud2lkdGhTaHJpbmsgfHwgMSkgOiAoY29sLmNvbHVtbi5kZWZpbml0aW9uLndpZHRoR3JvdyB8fCAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYob3ZlcnNpemVDb2xzLmxlbmd0aCl7XG5cdFx0XHRvdmVyc2l6ZUNvbHMuZm9yRWFjaChmdW5jdGlvbihjb2wpe1xuXHRcdFx0XHRvdmVyc2l6ZVNwYWNlICs9IHNocmlua0NvbHMgPyAgY29sLndpZHRoIC0gY29sLmNvbHVtbi5taW5XaWR0aCA6IGNvbC5jb2x1bW4ubWluV2lkdGg7XG5cdFx0XHRcdGNvbC53aWR0aCA9IGNvbC5jb2x1bW4ubWluV2lkdGg7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmVtYWluaW5nU3BhY2UgPSBmcmVlU3BhY2UgLSBvdmVyc2l6ZVNwYWNlO1xuXG5cdFx0XHRuZXh0Q29sV2lkdGggPSBjaGFuZ2VVbml0cyA/IE1hdGguZmxvb3IocmVtYWluaW5nU3BhY2UvY2hhbmdlVW5pdHMpIDogcmVtYWluaW5nU3BhY2U7XG5cblx0XHRcdGdhcCA9IHNjYWxlQ29sdW1ucyh1bmRlcnNpemVDb2xzLCByZW1haW5pbmdTcGFjZSwgbmV4dENvbFdpZHRoLCBzaHJpbmtDb2xzKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRnYXAgPSBjaGFuZ2VVbml0cyA/IGZyZWVTcGFjZSAtIChNYXRoLmZsb29yKGZyZWVTcGFjZS9jaGFuZ2VVbml0cykgKiBjaGFuZ2VVbml0cykgOiBmcmVlU3BhY2U7XG5cblx0XHRcdHVuZGVyc2l6ZUNvbHMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pe1xuXHRcdFx0XHRjb2x1bW4ud2lkdGggPSBzaHJpbmtDb2xzID8gY2FsY1Nocmluayhjb2x1bW4pIDogY2FsY0dyb3coY29sdW1uKTtcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBnYXA7XG5cdH1cblxuXHRpZih0aGlzLnRhYmxlLm9wdGlvbnMucmVzcG9uc2l2ZUxheW91dCAmJiB0aGlzLnRhYmxlLm1vZEV4aXN0cyhcInJlc3BvbnNpdmVMYXlvdXRcIiwgdHJ1ZSkpe1xuXHRcdHRoaXMudGFibGUubW9kdWxlcy5yZXNwb25zaXZlTGF5b3V0LnVwZGF0ZSgpO1xuXHR9XG5cblx0Ly9hZGp1c3QgZm9yIHZlcnRpY2FsIHNjcm9sbGJhciBpZiBwcmVzZW50XG5cdGlmKHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LnNjcm9sbEhlaWdodCA+IHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudEhlaWdodCl7XG5cdFx0dG90YWxXaWR0aCAtPSB0aGlzLnRhYmxlLnJvd01hbmFnZXIuZWxlbWVudC5vZmZzZXRXaWR0aCAtIHRoaXMudGFibGUucm93TWFuYWdlci5lbGVtZW50LmNsaWVudFdpZHRoO1xuXHR9XG5cblx0Y29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG5cdFx0dmFyIHdpZHRoLCBtaW5XaWR0aCwgY29sV2lkdGg7XG5cblx0XHRpZihjb2x1bW4udmlzaWJsZSl7XG5cblx0XHRcdHdpZHRoID0gY29sdW1uLmRlZmluaXRpb24ud2lkdGg7XG5cdFx0XHRtaW5XaWR0aCA9ICBwYXJzZUludChjb2x1bW4ubWluV2lkdGgpO1xuXG5cdFx0XHRpZih3aWR0aCl7XG5cblx0XHRcdFx0Y29sV2lkdGggPSBjYWxjV2lkdGgod2lkdGgpO1xuXG5cdFx0XHRcdGZpeGVkV2lkdGggKz0gY29sV2lkdGggPiBtaW5XaWR0aCA/IGNvbFdpZHRoIDogbWluV2lkdGg7XG5cblx0XHRcdFx0aWYoY29sdW1uLmRlZmluaXRpb24ud2lkdGhTaHJpbmspe1xuXHRcdFx0XHRcdGZpeGVkU2hyaW5rQ29sdW1ucy5wdXNoKHtcblx0XHRcdFx0XHRcdGNvbHVtbjpjb2x1bW4sXG5cdFx0XHRcdFx0XHR3aWR0aDpjb2xXaWR0aCA+IG1pbldpZHRoID8gY29sV2lkdGggOiBtaW5XaWR0aFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGZsZXhTaHJpbmtVbml0cyArPSBjb2x1bW4uZGVmaW5pdGlvbi53aWR0aFNocmluaztcblx0XHRcdFx0fVxuXG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGZsZXhDb2x1bW5zLnB1c2goe1xuXHRcdFx0XHRcdGNvbHVtbjpjb2x1bW4sXG5cdFx0XHRcdFx0d2lkdGg6MCxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGZsZXhHcm93VW5pdHMgKz0gY29sdW1uLmRlZmluaXRpb24ud2lkdGhHcm93IHx8IDE7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXHQvL2NhbGN1bGF0ZSBhdmFpbGFibGUgc3BhY2Vcblx0ZmxleFdpZHRoID0gdG90YWxXaWR0aCAtIGZpeGVkV2lkdGg7XG5cblx0Ly9jYWxjdWxhdGUgY29ycmVjdCBjb2x1bW4gc2l6ZVxuXHRmbGV4Q29sV2lkdGggPSBNYXRoLmZsb29yKGZsZXhXaWR0aCAvIGZsZXhHcm93VW5pdHMpO1xuXG5cdC8vZ2VuZXJhdGUgY29sdW1uIHdpZHRoc1xuXHRnYXBGaWxsID0gc2NhbGVDb2x1bW5zKGZsZXhDb2x1bW5zLCBmbGV4V2lkdGgsIGZsZXhDb2xXaWR0aCwgZmFsc2UpO1xuXG5cdC8vaW5jcmVhc2Ugd2lkdGggb2YgbGFzdCBjb2x1bW4gdG8gYWNjb3VudCBmb3Igcm91bmRpbmcgZXJyb3JzXG5cdGlmKGZsZXhDb2x1bW5zLmxlbmd0aCAmJiBnYXBGaWxsID4gMCl7XG5cdFx0ZmxleENvbHVtbnNbZmxleENvbHVtbnMubGVuZ3RoLTFdLndpZHRoICs9IGdhcEZpbGw7XG5cdH1cblxuXHQvL2NhbGN1bGF0ZSBzcGFjZSBmb3IgY29sdW1ucyB0byBiZSBzaHJ1bmsgaW50b1xuXHRmbGV4Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbCl7XG5cdFx0ZmxleFdpZHRoIC09IGNvbC53aWR0aDtcblx0fSk7XG5cblx0b3ZlcmZsb3dXaWR0aCA9IE1hdGguYWJzKGdhcEZpbGwpICsgZmxleFdpZHRoO1xuXG5cdC8vc2hyaW5rIG92ZXJzaXplIGNvbHVtbnMgaWYgdGhlcmUgaXMgbm8gYXZhaWxhYmxlIHNwYWNlXG5cdGlmKG92ZXJmbG93V2lkdGggPiAwICYmIGZsZXhTaHJpbmtVbml0cyl7XG5cdFx0Z2FwRmlsbCA9IHNjYWxlQ29sdW1ucyhmaXhlZFNocmlua0NvbHVtbnMsIG92ZXJmbG93V2lkdGgsIE1hdGguZmxvb3Iob3ZlcmZsb3dXaWR0aCAvIGZsZXhTaHJpbmtVbml0cyksIHRydWUpO1xuXHR9XG5cblx0Ly9kZWNyZWFzZSB3aWR0aCBvZiBsYXN0IGNvbHVtbiB0byBhY2NvdW50IGZvciByb3VuZGluZyBlcnJvcnNcblx0aWYoZ2FwRmlsbCAmJiBmaXhlZFNocmlua0NvbHVtbnMubGVuZ3RoKXtcblx0XHRmaXhlZFNocmlua0NvbHVtbnNbZml4ZWRTaHJpbmtDb2x1bW5zLmxlbmd0aC0xXS53aWR0aCAtPSBnYXBGaWxsO1xuXHR9XG5cblx0ZmxleENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2wpe1xuXHRcdGNvbC5jb2x1bW4uc2V0V2lkdGgoY29sLndpZHRoKTtcblx0fSk7XG5cblx0Zml4ZWRTaHJpbmtDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sKXtcblx0XHRjb2wuY29sdW1uLnNldFdpZHRoKGNvbC53aWR0aCk7XG5cdH0pO1xufVxuXG52YXIgZGVmYXVsdE1vZGVzID0ge1xuXHRmaXREYXRhOmZpdERhdGEsXG5cdGZpdERhdGFGaWxsOmZpdERhdGFHZW5lcmFsLFxuXHRmaXREYXRhVGFibGU6Zml0RGF0YUdlbmVyYWwsXG5cdGZpdERhdGFTdHJldGNoOmZpdERhdGFTdHJldGNoLFxuXHRmaXRDb2x1bW5zOmZpdENvbHVtbnMgLFxufTtcblxuY2xhc3MgTGF5b3V0IGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJsYXlvdXRcIjtcblxuXHQvL2xvYWQgZGVmYXVsdHNcblx0c3RhdGljIG1vZGVzID0gZGVmYXVsdE1vZGVzO1xuXG5cdGNvbnN0cnVjdG9yKHRhYmxlKXtcblx0XHRzdXBlcih0YWJsZSwgXCJsYXlvdXRcIik7XG5cblx0XHR0aGlzLm1vZGUgPSBudWxsO1xuXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwibGF5b3V0XCIsIFwiZml0RGF0YVwiKTsgLy9sYXlvdXQgdHlwZVxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImxheW91dENvbHVtbnNPbk5ld0RhdGFcIiwgZmFsc2UpOyAvL3VwZGF0ZSBjb2x1bW4gd2lkdGhzIG9uIHNldERhdGFcblxuXHRcdHRoaXMucmVnaXN0ZXJDb2x1bW5PcHRpb24oXCJ3aWR0aEdyb3dcIik7XG5cdFx0dGhpcy5yZWdpc3RlckNvbHVtbk9wdGlvbihcIndpZHRoU2hyaW5rXCIpO1xuXHR9XG5cblx0Ly9pbml0aWFsaXplIGxheW91dCBzeXN0ZW1cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHZhciBsYXlvdXQgPSB0aGlzLnRhYmxlLm9wdGlvbnMubGF5b3V0O1xuXG5cdFx0aWYoTGF5b3V0Lm1vZGVzW2xheW91dF0pe1xuXHRcdFx0dGhpcy5tb2RlID0gbGF5b3V0O1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkxheW91dCBFcnJvciAtIGludmFsaWQgbW9kZSBzZXQsIGRlZmF1bHRpbmcgdG8gJ2ZpdERhdGEnIDogXCIgKyBsYXlvdXQpO1xuXHRcdFx0dGhpcy5tb2RlID0gJ2ZpdERhdGEnO1xuXHRcdH1cblxuXHRcdHRoaXMudGFibGUuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0YWJ1bGF0b3ItbGF5b3V0XCIsIHRoaXMubW9kZSk7XG5cdFx0dGhpcy5zdWJzY3JpYmUoXCJjb2x1bW4taW5pdFwiLCB0aGlzLmluaXRpYWxpemVDb2x1bW4uYmluZCh0aGlzKSk7XG5cdH1cblxuXHRpbml0aWFsaXplQ29sdW1uKGNvbHVtbil7XG5cdFx0aWYoY29sdW1uLmRlZmluaXRpb24ud2lkdGhHcm93KXtcblx0XHRcdGNvbHVtbi5kZWZpbml0aW9uLndpZHRoR3JvdyA9IE51bWJlcihjb2x1bW4uZGVmaW5pdGlvbi53aWR0aEdyb3cpO1xuXHRcdH1cblx0XHRpZihjb2x1bW4uZGVmaW5pdGlvbi53aWR0aFNocmluayl7XG5cdFx0XHRjb2x1bW4uZGVmaW5pdGlvbi53aWR0aFNocmluayA9IE51bWJlcihjb2x1bW4uZGVmaW5pdGlvbi53aWR0aFNocmluayk7XG5cdFx0fVxuXHR9XG5cblx0Z2V0TW9kZSgpe1xuXHRcdHJldHVybiB0aGlzLm1vZGU7XG5cdH1cblxuXHQvL3RyaWdnZXIgdGFibGUgbGF5b3V0XG5cdGxheW91dChkYXRhQ2hhbmdlZCl7XG5cblx0XHR2YXIgdmFyaWFibGVIZWlnaHQgPSB0aGlzLnRhYmxlLmNvbHVtbk1hbmFnZXIuY29sdW1uc0J5SW5kZXguZmluZCgoY29sdW1uKSA9PiBjb2x1bW4uZGVmaW5pdGlvbi52YXJpYWJsZUhlaWdodCB8fCBjb2x1bW4uZGVmaW5pdGlvbi5mb3JtYXR0ZXIgPT09IFwidGV4dGFyZWFcIik7XG5cdFx0XG5cdFx0dGhpcy5kaXNwYXRjaChcImxheW91dC1yZWZyZXNoaW5nXCIpO1xuXHRcdExheW91dC5tb2Rlc1t0aGlzLm1vZGVdLmNhbGwodGhpcywgdGhpcy50YWJsZS5jb2x1bW5NYW5hZ2VyLmNvbHVtbnNCeUluZGV4LCBkYXRhQ2hhbmdlZCk7XG5cblx0XHRpZih2YXJpYWJsZUhlaWdodCl7XG5cdFx0XHR0aGlzLnRhYmxlLnJvd01hbmFnZXIubm9ybWFsaXplSGVpZ2h0KHRydWUpO1xuXHRcdH1cblxuXHRcdHRoaXMuZGlzcGF0Y2goXCJsYXlvdXQtcmVmcmVzaGVkXCIpO1xuXHR9XG59XG5cbnZhciBkZWZhdWx0TGFuZ3MgPSB7XG5cdFwiZGVmYXVsdFwiOnsgLy9ob2xkIGRlZmF1bHQgbG9jYWxlIHRleHRcblx0XHRcImdyb3Vwc1wiOntcblx0XHRcdFwiaXRlbVwiOlwiaXRlbVwiLFxuXHRcdFx0XCJpdGVtc1wiOlwiaXRlbXNcIixcblx0XHR9LFxuXHRcdFwiY29sdW1uc1wiOntcblx0XHR9LFxuXHRcdFwiZGF0YVwiOntcblx0XHRcdFwibG9hZGluZ1wiOlwiTG9hZGluZ1wiLFxuXHRcdFx0XCJlcnJvclwiOlwiRXJyb3JcIixcblx0XHR9LFxuXHRcdFwicGFnaW5hdGlvblwiOntcblx0XHRcdFwicGFnZV9zaXplXCI6XCJQYWdlIFNpemVcIixcblx0XHRcdFwicGFnZV90aXRsZVwiOlwiU2hvdyBQYWdlXCIsXG5cdFx0XHRcImZpcnN0XCI6XCJGaXJzdFwiLFxuXHRcdFx0XCJmaXJzdF90aXRsZVwiOlwiRmlyc3QgUGFnZVwiLFxuXHRcdFx0XCJsYXN0XCI6XCJMYXN0XCIsXG5cdFx0XHRcImxhc3RfdGl0bGVcIjpcIkxhc3QgUGFnZVwiLFxuXHRcdFx0XCJwcmV2XCI6XCJQcmV2XCIsXG5cdFx0XHRcInByZXZfdGl0bGVcIjpcIlByZXYgUGFnZVwiLFxuXHRcdFx0XCJuZXh0XCI6XCJOZXh0XCIsXG5cdFx0XHRcIm5leHRfdGl0bGVcIjpcIk5leHQgUGFnZVwiLFxuXHRcdFx0XCJhbGxcIjpcIkFsbFwiLFxuXHRcdFx0XCJjb3VudGVyXCI6e1xuXHRcdFx0XHRcInNob3dpbmdcIjogXCJTaG93aW5nXCIsXG5cdFx0XHRcdFwib2ZcIjogXCJvZlwiLFxuXHRcdFx0XHRcInJvd3NcIjogXCJyb3dzXCIsXG5cdFx0XHRcdFwicGFnZXNcIjogXCJwYWdlc1wiLFxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0XCJoZWFkZXJGaWx0ZXJzXCI6e1xuXHRcdFx0XCJkZWZhdWx0XCI6XCJmaWx0ZXIgY29sdW1uLi4uXCIsXG5cdFx0XHRcImNvbHVtbnNcIjp7fVxuXHRcdH1cblx0fSxcbn07XG5cbmNsYXNzIExvY2FsaXplIGV4dGVuZHMgTW9kdWxle1xuXG5cdHN0YXRpYyBtb2R1bGVOYW1lID0gXCJsb2NhbGl6ZVwiO1xuXG5cdC8vbG9hZCBkZWZhdWx0c1xuXHRzdGF0aWMgbGFuZ3MgPSBkZWZhdWx0TGFuZ3M7XG5cblx0Y29uc3RydWN0b3IodGFibGUpe1xuXHRcdHN1cGVyKHRhYmxlKTtcblxuXHRcdHRoaXMubG9jYWxlID0gXCJkZWZhdWx0XCI7IC8vY3VycmVudCBsb2NhbGVcblx0XHR0aGlzLmxhbmcgPSBmYWxzZTsgLy9jdXJyZW50IGxhbmd1YWdlXG5cdFx0dGhpcy5iaW5kaW5ncyA9IHt9OyAvL3VwZGF0ZSBldmVudHMgdG8gY2FsbCB3aGVuIGxvY2FsZSBpcyBjaGFuZ2VkXG5cdFx0dGhpcy5sYW5nTGlzdCA9IHt9O1xuXG5cdFx0dGhpcy5yZWdpc3RlclRhYmxlT3B0aW9uKFwibG9jYWxlXCIsIGZhbHNlKTsgLy9jdXJyZW50IHN5c3RlbSBsYW5ndWFnZVxuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZU9wdGlvbihcImxhbmdzXCIsIHt9KTtcblx0fVxuXG5cdGluaXRpYWxpemUoKXtcblx0XHR0aGlzLmxhbmdMaXN0ID0gSGVscGVycy5kZWVwQ2xvbmUoTG9jYWxpemUubGFuZ3MpO1xuXG5cdFx0aWYodGhpcy50YWJsZS5vcHRpb25zLmNvbHVtbkRlZmF1bHRzLmhlYWRlckZpbHRlclBsYWNlaG9sZGVyICE9PSBmYWxzZSl7XG5cdFx0XHR0aGlzLnNldEhlYWRlckZpbHRlclBsYWNlaG9sZGVyKHRoaXMudGFibGUub3B0aW9ucy5jb2x1bW5EZWZhdWx0cy5oZWFkZXJGaWx0ZXJQbGFjZWhvbGRlcik7XG5cdFx0fVxuXG5cdFx0Zm9yKGxldCBsb2NhbGUgaW4gdGhpcy50YWJsZS5vcHRpb25zLmxhbmdzKXtcblx0XHRcdHRoaXMuaW5zdGFsbExhbmcobG9jYWxlLCB0aGlzLnRhYmxlLm9wdGlvbnMubGFuZ3NbbG9jYWxlXSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5zZXRMb2NhbGUodGhpcy50YWJsZS5vcHRpb25zLmxvY2FsZSk7XG5cblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcInNldExvY2FsZVwiLCB0aGlzLnNldExvY2FsZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldExvY2FsZVwiLCB0aGlzLmdldExvY2FsZS5iaW5kKHRoaXMpKTtcblx0XHR0aGlzLnJlZ2lzdGVyVGFibGVGdW5jdGlvbihcImdldExhbmdcIiwgdGhpcy5nZXRMYW5nLmJpbmQodGhpcykpO1xuXHR9XG5cblx0Ly9zZXQgaGVhZGVyIHBsYWNlaG9sZGVyXG5cdHNldEhlYWRlckZpbHRlclBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyKXtcblx0XHR0aGlzLmxhbmdMaXN0LmRlZmF1bHQuaGVhZGVyRmlsdGVycy5kZWZhdWx0ID0gcGxhY2Vob2xkZXI7XG5cdH1cblxuXHQvL3NldHVwIGEgbGFuZyBkZXNjcmlwdGlvbiBvYmplY3Rcblx0aW5zdGFsbExhbmcobG9jYWxlLCBsYW5nKXtcblx0XHRpZih0aGlzLmxhbmdMaXN0W2xvY2FsZV0pe1xuXHRcdFx0dGhpcy5fc2V0TGFuZ1Byb3AodGhpcy5sYW5nTGlzdFtsb2NhbGVdLCBsYW5nKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmxhbmdMaXN0W2xvY2FsZV0gPSBsYW5nO1xuXHRcdH1cblx0fVxuXG5cdF9zZXRMYW5nUHJvcChsYW5nLCB2YWx1ZXMpe1xuXHRcdGZvcihsZXQga2V5IGluIHZhbHVlcyl7XG5cdFx0XHRpZihsYW5nW2tleV0gJiYgdHlwZW9mIGxhbmdba2V5XSA9PSBcIm9iamVjdFwiKXtcblx0XHRcdFx0dGhpcy5fc2V0TGFuZ1Byb3AobGFuZ1trZXldLCB2YWx1ZXNba2V5XSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGxhbmdba2V5XSA9IHZhbHVlc1trZXldO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8vc2V0IGN1cnJlbnQgbG9jYWxlXG5cdHNldExvY2FsZShkZXNpcmVkTG9jYWxlKXtcblx0XHRkZXNpcmVkTG9jYWxlID0gZGVzaXJlZExvY2FsZSB8fCBcImRlZmF1bHRcIjtcblxuXHRcdC8vZmlsbCBpbiBhbnkgbWF0Y2hpbmcgbGFuZ3VhZ2UgdmFsdWVzXG5cdFx0ZnVuY3Rpb24gdHJhdmVyc2VMYW5nKHRyYW5zLCBwYXRoKXtcblx0XHRcdGZvcih2YXIgcHJvcCBpbiB0cmFucyl7XG5cdFx0XHRcdGlmKHR5cGVvZiB0cmFuc1twcm9wXSA9PSBcIm9iamVjdFwiKXtcblx0XHRcdFx0XHRpZighcGF0aFtwcm9wXSl7XG5cdFx0XHRcdFx0XHRwYXRoW3Byb3BdID0ge307XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHRyYXZlcnNlTGFuZyh0cmFuc1twcm9wXSwgcGF0aFtwcm9wXSk7XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRwYXRoW3Byb3BdID0gdHJhbnNbcHJvcF07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvL2RldGVybWluaW5nIGNvcnJlY3QgbG9jYWxlIHRvIGxvYWRcblx0XHRpZihkZXNpcmVkTG9jYWxlID09PSB0cnVlICYmIG5hdmlnYXRvci5sYW5ndWFnZSl7XG5cdFx0XHQvL2dldCBsb2NhbCBmcm9tIHN5c3RlbVxuXHRcdFx0ZGVzaXJlZExvY2FsZSA9IG5hdmlnYXRvci5sYW5ndWFnZS50b0xvd2VyQ2FzZSgpO1xuXHRcdH1cblxuXHRcdGlmKGRlc2lyZWRMb2NhbGUpe1xuXHRcdFx0Ly9pZiBsb2NhbGUgaXMgbm90IHNldCwgY2hlY2sgZm9yIG1hdGNoaW5nIHRvcCBsZXZlbCBsb2NhbGUgZWxzZSB1c2UgZGVmYXVsdFxuXHRcdFx0aWYoIXRoaXMubGFuZ0xpc3RbZGVzaXJlZExvY2FsZV0pe1xuXHRcdFx0XHRsZXQgcHJlZml4ID0gZGVzaXJlZExvY2FsZS5zcGxpdChcIi1cIilbMF07XG5cblx0XHRcdFx0aWYodGhpcy5sYW5nTGlzdFtwcmVmaXhdKXtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJMb2NhbGl6YXRpb24gRXJyb3IgLSBFeGFjdCBtYXRjaGluZyBsb2NhbGUgbm90IGZvdW5kLCB1c2luZyBjbG9zZXN0IG1hdGNoOiBcIiwgZGVzaXJlZExvY2FsZSwgcHJlZml4KTtcblx0XHRcdFx0XHRkZXNpcmVkTG9jYWxlID0gcHJlZml4O1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKFwiTG9jYWxpemF0aW9uIEVycm9yIC0gTWF0Y2hpbmcgbG9jYWxlIG5vdCBmb3VuZCwgdXNpbmcgZGVmYXVsdDogXCIsIGRlc2lyZWRMb2NhbGUpO1xuXHRcdFx0XHRcdGRlc2lyZWRMb2NhbGUgPSBcImRlZmF1bHRcIjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMubG9jYWxlID0gZGVzaXJlZExvY2FsZTtcblxuXHRcdC8vbG9hZCBkZWZhdWx0IGxhbmcgdGVtcGxhdGVcblx0XHR0aGlzLmxhbmcgPSBIZWxwZXJzLmRlZXBDbG9uZSh0aGlzLmxhbmdMaXN0LmRlZmF1bHQgfHwge30pO1xuXG5cdFx0aWYoZGVzaXJlZExvY2FsZSAhPSBcImRlZmF1bHRcIil7XG5cdFx0XHR0cmF2ZXJzZUxhbmcodGhpcy5sYW5nTGlzdFtkZXNpcmVkTG9jYWxlXSwgdGhpcy5sYW5nKTtcblx0XHR9XG5cblx0XHR0aGlzLmRpc3BhdGNoRXh0ZXJuYWwoXCJsb2NhbGl6ZWRcIiwgdGhpcy5sb2NhbGUsIHRoaXMubGFuZyk7XG5cblx0XHR0aGlzLl9leGVjdXRlQmluZGluZ3MoKTtcblx0fVxuXG5cdC8vZ2V0IGN1cnJlbnQgbG9jYWxlXG5cdGdldExvY2FsZShsb2NhbGUpe1xuXHRcdHJldHVybiB0aGlzLmxvY2FsZTtcblx0fVxuXG5cdC8vZ2V0IGxhbmcgb2JqZWN0IGZvciBnaXZlbiBsb2NhbCBvciBjdXJyZW50IGlmIG5vbmUgcHJvdmlkZWRcblx0Z2V0TGFuZyhsb2NhbGUpe1xuXHRcdHJldHVybiBsb2NhbGUgPyB0aGlzLmxhbmdMaXN0W2xvY2FsZV0gOiB0aGlzLmxhbmc7XG5cdH1cblxuXHQvL2dldCB0ZXh0IGZvciBjdXJyZW50IGxvY2FsZVxuXHRnZXRUZXh0KHBhdGgsIHZhbHVlKXtcblx0XHR2YXIgZmlsbFBhdGggPSB2YWx1ZSA/IHBhdGggKyBcInxcIiArIHZhbHVlIDogcGF0aCxcblx0XHRwYXRoQXJyYXkgPSBmaWxsUGF0aC5zcGxpdChcInxcIiksXG5cdFx0dGV4dCA9IHRoaXMuX2dldExhbmdFbGVtZW50KHBhdGhBcnJheSwgdGhpcy5sb2NhbGUpO1xuXG5cdFx0Ly8gaWYodGV4dCA9PT0gZmFsc2Upe1xuXHRcdC8vIFx0Y29uc29sZS53YXJuKFwiTG9jYWxpemF0aW9uIEVycm9yIC0gTWF0Y2hpbmcgbG9jYWxpemVkIHRleHQgbm90IGZvdW5kIGZvciBnaXZlbiBwYXRoOiBcIiwgcGF0aCk7XG5cdFx0Ly8gfVxuXG5cdFx0cmV0dXJuIHRleHQgfHwgXCJcIjtcblx0fVxuXG5cdC8vdHJhdmVyc2UgbGFuZ3Mgb2JqZWN0IGFuZCBmaW5kIGxvY2FsaXplZCBjb3B5XG5cdF9nZXRMYW5nRWxlbWVudChwYXRoLCBsb2NhbGUpe1xuXHRcdHZhciByb290ID0gdGhpcy5sYW5nO1xuXG5cdFx0cGF0aC5mb3JFYWNoKGZ1bmN0aW9uKGxldmVsKXtcblx0XHRcdHZhciByb290UGF0aDtcblxuXHRcdFx0aWYocm9vdCl7XG5cdFx0XHRcdHJvb3RQYXRoID0gcm9vdFtsZXZlbF07XG5cblx0XHRcdFx0aWYodHlwZW9mIHJvb3RQYXRoICE9IFwidW5kZWZpbmVkXCIpe1xuXHRcdFx0XHRcdHJvb3QgPSByb290UGF0aDtcblx0XHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRcdHJvb3QgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHJvb3Q7XG5cdH1cblxuXHQvL3NldCB1cGRhdGUgYmluZGluZ1xuXHRiaW5kKHBhdGgsIGNhbGxiYWNrKXtcblx0XHRpZighdGhpcy5iaW5kaW5nc1twYXRoXSl7XG5cdFx0XHR0aGlzLmJpbmRpbmdzW3BhdGhdID0gW107XG5cdFx0fVxuXG5cdFx0dGhpcy5iaW5kaW5nc1twYXRoXS5wdXNoKGNhbGxiYWNrKTtcblxuXHRcdGNhbGxiYWNrKHRoaXMuZ2V0VGV4dChwYXRoKSwgdGhpcy5sYW5nKTtcblx0fVxuXG5cdC8vaXRlcmF0ZSB0aHJvdWdoIGJpbmRpbmdzIGFuZCB0cmlnZ2VyIHVwZGF0ZXNcblx0X2V4ZWN1dGVCaW5kaW5ncygpe1xuXHRcdGZvcihsZXQgcGF0aCBpbiB0aGlzLmJpbmRpbmdzKXtcblx0XHRcdHRoaXMuYmluZGluZ3NbcGF0aF0uZm9yRWFjaCgoYmluZGluZykgPT4ge1xuXHRcdFx0XHRiaW5kaW5nKHRoaXMuZ2V0VGV4dChwYXRoKSwgdGhpcy5sYW5nKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxufVxuXG5jbGFzcyBDb21tcyBleHRlbmRzIE1vZHVsZXtcblxuXHRzdGF0aWMgbW9kdWxlTmFtZSA9IFwiY29tbXNcIjtcblxuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuXHR9XG5cblx0aW5pdGlhbGl6ZSgpe1xuXHRcdHRoaXMucmVnaXN0ZXJUYWJsZUZ1bmN0aW9uKFwidGFibGVDb21tc1wiLCB0aGlzLnJlY2VpdmUuYmluZCh0aGlzKSk7XG5cdH1cblxuXHRnZXRDb25uZWN0aW9ucyhzZWxlY3RvcnMpe1xuXHRcdHZhciBjb25uZWN0aW9ucyA9IFtdLFxuXHRcdGNvbm5lY3Rpb247XG5cblx0XHRjb25uZWN0aW9uID0gdGhpcy50YWJsZS5jb25zdHJ1Y3Rvci5yZWdpc3RyeS5sb29rdXBUYWJsZShzZWxlY3RvcnMpO1xuXG5cdFx0Y29ubmVjdGlvbi5mb3JFYWNoKChjb24pID0+e1xuXHRcdFx0aWYodGhpcy50YWJsZSAhPT0gY29uKXtcblx0XHRcdFx0Y29ubmVjdGlvbnMucHVzaChjb24pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGNvbm5lY3Rpb25zO1xuXHR9XG5cblx0c2VuZChzZWxlY3RvcnMsIG1vZHVsZSwgYWN0aW9uLCBkYXRhKXtcblx0XHR2YXIgY29ubmVjdGlvbnMgPSB0aGlzLmdldENvbm5lY3Rpb25zKHNlbGVjdG9ycyk7XG5cblx0XHRjb25uZWN0aW9ucy5mb3JFYWNoKChjb25uZWN0aW9uKSA9PiB7XG5cdFx0XHRjb25uZWN0aW9uLnRhYmxlQ29tbXModGhpcy50YWJsZS5lbGVtZW50LCBtb2R1bGUsIGFjdGlvbiwgZGF0YSk7XG5cdFx0fSk7XG5cblx0XHRpZighY29ubmVjdGlvbnMubGVuZ3RoICYmIHNlbGVjdG9ycyl7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJUYWJsZSBDb25uZWN0aW9uIEVycm9yIC0gTm8gdGFibGVzIG1hdGNoaW5nIHNlbGVjdG9yIGZvdW5kXCIsIHNlbGVjdG9ycyk7XG5cdFx0fVxuXHR9XG5cblx0cmVjZWl2ZSh0YWJsZSwgbW9kdWxlLCBhY3Rpb24sIGRhdGEpe1xuXHRcdGlmKHRoaXMudGFibGUubW9kRXhpc3RzKG1vZHVsZSkpe1xuXHRcdFx0cmV0dXJuIHRoaXMudGFibGUubW9kdWxlc1ttb2R1bGVdLmNvbW1zUmVjZWl2ZWQodGFibGUsIGFjdGlvbiwgZGF0YSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiSW50ZXItdGFibGUgQ29tbXMgRXJyb3IgLSBubyBzdWNoIG1vZHVsZTpcIiwgbW9kdWxlKTtcblx0XHR9XG5cdH1cbn1cblxudmFyIGNvcmVNb2R1bGVzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoe1xuXHRfX3Byb3RvX186IG51bGwsXG5cdENvbW1zTW9kdWxlOiBDb21tcyxcblx0TGF5b3V0TW9kdWxlOiBMYXlvdXQsXG5cdExvY2FsaXplTW9kdWxlOiBMb2NhbGl6ZVxufSk7XG5cbmNsYXNzIFRhYmxlUmVnaXN0cnkge1xuXHRzdGF0aWMgcmVnaXN0cnkgPSB7XG5cdFx0dGFibGVzOltdLFxuXHRcdFxuXHRcdHJlZ2lzdGVyKHRhYmxlKXtcblx0XHRcdFRhYmxlUmVnaXN0cnkucmVnaXN0cnkudGFibGVzLnB1c2godGFibGUpO1xuXHRcdH0sXG5cdFx0XG5cdFx0ZGVyZWdpc3Rlcih0YWJsZSl7XG5cdFx0XHR2YXIgaW5kZXggPSBUYWJsZVJlZ2lzdHJ5LnJlZ2lzdHJ5LnRhYmxlcy5pbmRleE9mKHRhYmxlKTtcblx0XHRcdFxuXHRcdFx0aWYoaW5kZXggPiAtMSl7XG5cdFx0XHRcdFRhYmxlUmVnaXN0cnkucmVnaXN0cnkudGFibGVzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRcblx0XHRsb29rdXBUYWJsZShxdWVyeSwgc2lsZW50KXtcblx0XHRcdHZhciByZXN1bHRzID0gW10sXG5cdFx0XHRtYXRjaGVzLCBtYXRjaDtcblx0XHRcdFxuXHRcdFx0aWYodHlwZW9mIHF1ZXJ5ID09PSBcInN0cmluZ1wiKXtcblx0XHRcdFx0bWF0Y2hlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXVlcnkpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYobWF0Y2hlcy5sZW5ndGgpe1xuXHRcdFx0XHRcdGZvcih2YXIgaSA9IDA7IGkgPCBtYXRjaGVzLmxlbmd0aDsgaSsrKXtcblx0XHRcdFx0XHRcdG1hdGNoID0gVGFibGVSZWdpc3RyeS5yZWdpc3RyeS5tYXRjaEVsZW1lbnQobWF0Y2hlc1tpXSk7XG5cdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdGlmKG1hdGNoKXtcblx0XHRcdFx0XHRcdFx0cmVzdWx0cy5wdXNoKG1hdGNoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHR9ZWxzZSBpZigodHlwZW9mIEhUTUxFbGVtZW50ICE9PSBcInVuZGVmaW5lZFwiICYmIHF1ZXJ5IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHx8IHF1ZXJ5IGluc3RhbmNlb2YgVGFibGVSZWdpc3RyeSl7XG5cdFx0XHRcdG1hdGNoID0gVGFibGVSZWdpc3RyeS5yZWdpc3RyeS5tYXRjaEVsZW1lbnQocXVlcnkpO1xuXHRcdFx0XHRcblx0XHRcdFx0aWYobWF0Y2gpe1xuXHRcdFx0XHRcdHJlc3VsdHMucHVzaChtYXRjaCk7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIGlmKEFycmF5LmlzQXJyYXkocXVlcnkpKXtcblx0XHRcdFx0cXVlcnkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcblx0XHRcdFx0XHRyZXN1bHRzID0gcmVzdWx0cy5jb25jYXQoVGFibGVSZWdpc3RyeS5yZWdpc3RyeS5sb29rdXBUYWJsZShpdGVtKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZighc2lsZW50KXtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJUYWJsZSBDb25uZWN0aW9uIEVycm9yIC0gSW52YWxpZCBTZWxlY3RvclwiLCBxdWVyeSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0cmV0dXJuIHJlc3VsdHM7XG5cdFx0fSxcblx0XHRcblx0XHRtYXRjaEVsZW1lbnQoZWxlbWVudCl7XG5cdFx0XHRyZXR1cm4gVGFibGVSZWdpc3RyeS5yZWdpc3RyeS50YWJsZXMuZmluZChmdW5jdGlvbih0YWJsZSl7XG5cdFx0XHRcdHJldHVybiBlbGVtZW50IGluc3RhbmNlb2YgVGFibGVSZWdpc3RyeSA/IHRhYmxlID09PSBlbGVtZW50IDogdGFibGUuZWxlbWVudCA9PT0gZWxlbWVudDtcblx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxuXHRcdFxuXHRzdGF0aWMgZmluZFRhYmxlKHF1ZXJ5KXtcblx0XHR2YXIgcmVzdWx0cyA9IFRhYmxlUmVnaXN0cnkucmVnaXN0cnkubG9va3VwVGFibGUocXVlcnksIHRydWUpO1xuXHRcdHJldHVybiBBcnJheS5pc0FycmF5KHJlc3VsdHMpICYmICFyZXN1bHRzLmxlbmd0aCA/IGZhbHNlIDogcmVzdWx0cztcblx0fVxufVxuXG5jbGFzcyBNb2R1bGVCaW5kZXIgZXh0ZW5kcyBUYWJsZVJlZ2lzdHJ5IHtcblx0XG5cdHN0YXRpYyBtb2R1bGVCaW5kaW5ncyA9IHt9O1xuXHRzdGF0aWMgbW9kdWxlRXh0ZW5zaW9ucyA9IHt9O1xuXHRzdGF0aWMgbW9kdWxlc1JlZ2lzdGVyZWQgPSBmYWxzZTtcblx0XG5cdHN0YXRpYyBkZWZhdWx0TW9kdWxlcyA9IGZhbHNlO1xuXHRcblx0Y29uc3RydWN0b3IoKXtcblx0XHRzdXBlcigpO1xuXHR9XG5cdFxuXHRzdGF0aWMgaW5pdGlhbGl6ZU1vZHVsZUJpbmRlcihkZWZhdWx0TW9kdWxlcyl7XG5cdFx0aWYoIU1vZHVsZUJpbmRlci5tb2R1bGVzUmVnaXN0ZXJlZCl7XG5cdFx0XHRNb2R1bGVCaW5kZXIubW9kdWxlc1JlZ2lzdGVyZWQgPSB0cnVlO1xuXHRcdFx0TW9kdWxlQmluZGVyLl9yZWdpc3Rlck1vZHVsZXMoY29yZU1vZHVsZXMsIHRydWUpO1xuXHRcdFx0XG5cdFx0XHRpZihkZWZhdWx0TW9kdWxlcyl7XG5cdFx0XHRcdE1vZHVsZUJpbmRlci5fcmVnaXN0ZXJNb2R1bGVzKGRlZmF1bHRNb2R1bGVzKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdHN0YXRpYyBfZXh0ZW5kTW9kdWxlKG5hbWUsIHByb3BlcnR5LCB2YWx1ZXMpe1xuXHRcdGlmKE1vZHVsZUJpbmRlci5tb2R1bGVCaW5kaW5nc1tuYW1lXSl7XG5cdFx0XHR2YXIgc291cmNlID0gTW9kdWxlQmluZGVyLm1vZHVsZUJpbmRpbmdzW25hbWVdW3Byb3BlcnR5XTtcblx0XHRcdFxuXHRcdFx0aWYoc291cmNlKXtcblx0XHRcdFx0aWYodHlwZW9mIHZhbHVlcyA9PSBcIm9iamVjdFwiKXtcblx0XHRcdFx0XHRmb3IobGV0IGtleSBpbiB2YWx1ZXMpe1xuXHRcdFx0XHRcdFx0c291cmNlW2tleV0gPSB2YWx1ZXNba2V5XTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oXCJNb2R1bGUgRXJyb3IgLSBJbnZhbGlkIHZhbHVlIHR5cGUsIGl0IG11c3QgYmUgYW4gb2JqZWN0XCIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIk1vZHVsZSBFcnJvciAtIHByb3BlcnR5IGRvZXMgbm90IGV4aXN0OlwiLCBwcm9wZXJ0eSk7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiTW9kdWxlIEVycm9yIC0gbW9kdWxlIGRvZXMgbm90IGV4aXN0OlwiLCBuYW1lKTtcblx0XHR9XG5cdH1cblx0XG5cdHN0YXRpYyBfcmVnaXN0ZXJNb2R1bGVzKG1vZHVsZXMsIGNvcmUpe1xuXHRcdHZhciBtb2RzID0gT2JqZWN0LnZhbHVlcyhtb2R1bGVzKTtcblx0XHRcblx0XHRpZihjb3JlKXtcblx0XHRcdG1vZHMuZm9yRWFjaCgobW9kKSA9PiB7XG5cdFx0XHRcdG1vZC5wcm90b3R5cGUubW9kdWxlQ29yZSA9IHRydWU7XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0XG5cdFx0TW9kdWxlQmluZGVyLl9yZWdpc3Rlck1vZHVsZShtb2RzKTtcblx0fVxuXHRcblx0c3RhdGljIF9yZWdpc3Rlck1vZHVsZShtb2R1bGVzKXtcblx0XHRpZighQXJyYXkuaXNBcnJheShtb2R1bGVzKSl7XG5cdFx0XHRtb2R1bGVzID0gW21vZHVsZXNdO1xuXHRcdH1cblx0XHRcblx0XHRtb2R1bGVzLmZvckVhY2goKG1vZCkgPT4ge1xuXHRcdFx0TW9kdWxlQmluZGVyLl9yZWdpc3Rlck1vZHVsZUJpbmRpbmcobW9kKTtcblx0XHRcdE1vZHVsZUJpbmRlci5fcmVnaXN0ZXJNb2R1bGVFeHRlbnNpb25zKG1vZCk7XG5cdFx0fSk7XG5cdH1cblx0XG5cdHN0YXRpYyBfcmVnaXN0ZXJNb2R1bGVCaW5kaW5nKG1vZCl7XG5cdFx0aWYobW9kLm1vZHVsZU5hbWUpe1xuXHRcdFx0TW9kdWxlQmluZGVyLm1vZHVsZUJpbmRpbmdzW21vZC5tb2R1bGVOYW1lXSA9IG1vZDtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwiVW5hYmxlIHRvIGJpbmQgbW9kdWxlLCBubyBtb2R1bGVOYW1lIGRlZmluZWRcIiwgbW9kLm1vZHVsZU5hbWUpO1xuXHRcdH1cblx0fVxuXHRcblx0c3RhdGljIF9yZWdpc3Rlck1vZHVsZUV4dGVuc2lvbnMobW9kKXtcblx0XHR2YXIgZXh0ZW5zaW9ucyA9IG1vZC5tb2R1bGVFeHRlbnNpb25zO1xuXHRcdFxuXHRcdGlmKG1vZC5tb2R1bGVFeHRlbnNpb25zKXtcblx0XHRcdGZvciAobGV0IG1vZEtleSBpbiBleHRlbnNpb25zKSB7XG5cdFx0XHRcdGxldCBleHQgPSBleHRlbnNpb25zW21vZEtleV07XG5cdFx0XHRcdFxuXHRcdFx0XHRpZihNb2R1bGVCaW5kZXIubW9kdWxlQmluZGluZ3NbbW9kS2V5XSl7XG5cdFx0XHRcdFx0Zm9yIChsZXQgcHJvcEtleSBpbiBleHQpIHtcblx0XHRcdFx0XHRcdE1vZHVsZUJpbmRlci5fZXh0ZW5kTW9kdWxlKG1vZEtleSwgcHJvcEtleSwgZXh0W3Byb3BLZXldKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRpZighTW9kdWxlQmluZGVyLm1vZHVsZUV4dGVuc2lvbnNbbW9kS2V5XSl7XG5cdFx0XHRcdFx0XHRNb2R1bGVCaW5kZXIubW9kdWxlRXh0ZW5zaW9uc1ttb2RLZXldID0ge307XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGZvciAobGV0IHByb3BLZXkgaW4gZXh0KSB7XG5cdFx0XHRcdFx0XHRpZighTW9kdWxlQmluZGVyLm1vZHVsZUV4dGVuc2lvbnNbbW9kS2V5XVtwcm9wS2V5XSl7XG5cdFx0XHRcdFx0XHRcdE1vZHVsZUJpbmRlci5tb2R1bGVFeHRlbnNpb25zW21vZEtleV1bcHJvcEtleV0gPSB7fTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0T2JqZWN0LmFzc2lnbihNb2R1bGVCaW5kZXIubW9kdWxlRXh0ZW5zaW9uc1ttb2RLZXldW3Byb3BLZXldLCBleHRbcHJvcEtleV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdE1vZHVsZUJpbmRlci5fZXh0ZW5kTW9kdWxlRnJvbVF1ZXVlKG1vZCk7XG5cdH1cblx0XG5cdHN0YXRpYyBfZXh0ZW5kTW9kdWxlRnJvbVF1ZXVlKG1vZCl7XG5cdFx0dmFyIGV4dGVuc2lvbnMgPSBNb2R1bGVCaW5kZXIubW9kdWxlRXh0ZW5zaW9uc1ttb2QubW9kdWxlTmFtZV07XG5cdFx0XG5cdFx0aWYoZXh0ZW5zaW9ucyl7XG5cdFx0XHRmb3IgKGxldCBwcm9wS2V5IGluIGV4dGVuc2lvbnMpIHtcblx0XHRcdFx0TW9kdWxlQmluZGVyLl9leHRlbmRNb2R1bGUobW9kLm1vZHVsZU5hbWUsIHByb3BLZXksIGV4dGVuc2lvbnNbcHJvcEtleV0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRcblx0Ly9lbnN1cmUgdGhhdCBtb2R1bGUgYXJlIGJvdW5kIHRvIGluc3RhbnRpYXRlZCBmdW5jdGlvblxuXHRfYmluZE1vZHVsZXMoKXtcblx0XHR2YXIgb3JkZXJlZFN0YXJ0TW9kcyA9IFtdLFxuXHRcdG9yZGVyZWRFbmRNb2RzID0gW10sXG5cdFx0dW5PcmRlcmVkTW9kcyA9IFtdO1xuXHRcdFxuXHRcdHRoaXMubW9kdWxlcyA9IHt9O1xuXHRcdFxuXHRcdGZvcih2YXIgbmFtZSBpbiBNb2R1bGVCaW5kZXIubW9kdWxlQmluZGluZ3Mpe1xuXHRcdFx0bGV0IG1vZCA9IE1vZHVsZUJpbmRlci5tb2R1bGVCaW5kaW5nc1tuYW1lXTtcblx0XHRcdGxldCBtb2R1bGUgPSBuZXcgbW9kKHRoaXMpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLm1vZHVsZXNbbmFtZV0gPSBtb2R1bGU7XG5cdFx0XHRcblx0XHRcdGlmKG1vZC5wcm90b3R5cGUubW9kdWxlQ29yZSl7XG5cdFx0XHRcdHRoaXMubW9kdWxlc0NvcmUucHVzaChtb2R1bGUpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRpZihtb2QubW9kdWxlSW5pdE9yZGVyKXtcblx0XHRcdFx0XHRpZihtb2QubW9kdWxlSW5pdE9yZGVyIDwgMCl7XG5cdFx0XHRcdFx0XHRvcmRlcmVkU3RhcnRNb2RzLnB1c2gobW9kdWxlKTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRvcmRlcmVkRW5kTW9kcy5wdXNoKG1vZHVsZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0dW5PcmRlcmVkTW9kcy5wdXNoKG1vZHVsZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0XG5cdFx0b3JkZXJlZFN0YXJ0TW9kcy5zb3J0KChhLCBiKSA9PiBhLm1vZHVsZUluaXRPcmRlciA+IGIubW9kdWxlSW5pdE9yZGVyID8gMSA6IC0xKTtcblx0XHRvcmRlcmVkRW5kTW9kcy5zb3J0KChhLCBiKSA9PiBhLm1vZHVsZUluaXRPcmRlciA+IGIubW9kdWxlSW5pdE9yZGVyID8gMSA6IC0xKTtcblx0XHRcblx0XHR0aGlzLm1vZHVsZXNSZWd1bGFyID0gb3JkZXJlZFN0YXJ0TW9kcy5jb25jYXQodW5PcmRlcmVkTW9kcy5jb25jYXQob3JkZXJlZEVuZE1vZHMpKTtcblx0fVxufVxuXG5jbGFzcyBBbGVydCBleHRlbmRzIENvcmVGZWF0dXJle1xuXHRjb25zdHJ1Y3Rvcih0YWJsZSl7XG5cdFx0c3VwZXIodGFibGUpO1xuICAgICAgICBcblx0XHR0aGlzLmVsZW1lbnQgPSB0aGlzLl9jcmVhdGVBbGVydEVsZW1lbnQoKTtcblx0XHR0aGlzLm1zZ0VsZW1lbnQgPSB0aGlzLl9jcmVhdGVNc2dFbGVtZW50KCk7XG5cdFx0dGhpcy50eXBlID0gbnVsbDtcbiAgICAgICAgXG5cdFx0dGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMubXNnRWxlbWVudCk7XG5cdH1cbiAgICBcblx0X2NyZWF0ZUFsZXJ0RWxlbWVudCgpe1xuXHRcdHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdFx0ZWwuY2xhc3NMaXN0LmFkZChcInRhYnVsYXRvci1hbGVydFwiKTtcblx0XHRyZXR1cm4gZWw7XG5cdH1cbiAgICBcblx0X2NyZWF0ZU1zZ0VsZW1lbnQoKXtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXHRcdGVsLmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItYWxlcnQtbXNnXCIpO1xuXHRcdGVsLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJhbGVydFwiKTtcblx0XHRyZXR1cm4gZWw7XG5cdH1cbiAgICBcblx0X3R5cGVDbGFzcygpe1xuXHRcdHJldHVybiBcInRhYnVsYXRvci1hbGVydC1zdGF0ZS1cIiArIHRoaXMudHlwZTtcblx0fVxuICAgIFxuXHRhbGVydChjb250ZW50LCB0eXBlID0gXCJtc2dcIil7XG5cdFx0aWYoY29udGVudCl7XG5cdFx0XHR0aGlzLmNsZWFyKCk7XG5cblx0XHRcdHRoaXMuZGlzcGF0Y2goXCJhbGVydC1zaG93XCIsIHR5cGUpO1xuICAgICAgICAgICAgXG5cdFx0XHR0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgXG5cdFx0XHR3aGlsZSh0aGlzLm1zZ0VsZW1lbnQuZmlyc3RDaGlsZCkgdGhpcy5tc2dFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMubXNnRWxlbWVudC5maXJzdENoaWxkKTtcbiAgICAgICAgICAgIFxuXHRcdFx0dGhpcy5tc2dFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fdHlwZUNsYXNzKCkpO1xuICAgICAgICAgICAgXG5cdFx0XHRpZih0eXBlb2YgY29udGVudCA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdFx0Y29udGVudCA9IGNvbnRlbnQoKTtcblx0XHRcdH1cbiAgICAgICAgICAgIFxuXHRcdFx0aWYoY29udGVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KXtcblx0XHRcdFx0dGhpcy5tc2dFbGVtZW50LmFwcGVuZENoaWxkKGNvbnRlbnQpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHR0aGlzLm1zZ0VsZW1lbnQuaW5uZXJIVE1MID0gY29udGVudDtcblx0XHRcdH1cbiAgICAgICAgICAgIFxuXHRcdFx0dGhpcy50YWJsZS5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0fVxuXHR9XG4gICAgXG5cdGNsZWFyKCl7XG5cdFx0dGhpcy5kaXNwYXRjaChcImFsZXJ0LWhpZGVcIiwgdGhpcy50eXBlKTtcblxuXHRcdGlmKHRoaXMuZWxlbWVudC5wYXJlbnROb2RlKXtcblx0XHRcdHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG5cdFx0fVxuICAgICAgICBcblx0XHR0aGlzLm1zZ0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl90eXBlQ2xhc3MoKSk7XG5cdH1cbn1cblxuY2xhc3MgVGFidWxhdG9yIGV4dGVuZHMgTW9kdWxlQmluZGVye1xuXG5cdC8vZGVmYXVsdCBzZXR1cCBvcHRpb25zXG5cdHN0YXRpYyBkZWZhdWx0T3B0aW9ucyA9IGRlZmF1bHRPcHRpb25zO1xuXG5cdHN0YXRpYyBleHRlbmRNb2R1bGUoKXtcblx0XHRUYWJ1bGF0b3IuaW5pdGlhbGl6ZU1vZHVsZUJpbmRlcigpO1xuXHRcdFRhYnVsYXRvci5fZXh0ZW5kTW9kdWxlKC4uLmFyZ3VtZW50cyk7XG5cdH1cblxuXHRzdGF0aWMgcmVnaXN0ZXJNb2R1bGUoKXtcblx0XHRUYWJ1bGF0b3IuaW5pdGlhbGl6ZU1vZHVsZUJpbmRlcigpO1xuXHRcdFRhYnVsYXRvci5fcmVnaXN0ZXJNb2R1bGUoLi4uYXJndW1lbnRzKTtcblx0fVxuXG5cdGNvbnN0cnVjdG9yKGVsZW1lbnQsIG9wdGlvbnMsIG1vZHVsZXMpe1xuXHRcdHN1cGVyKCk7XG5cblx0XHRUYWJ1bGF0b3IuaW5pdGlhbGl6ZU1vZHVsZUJpbmRlcihtb2R1bGVzKTtcblxuXHRcdHRoaXMub3B0aW9ucyA9IHt9O1xuXHRcdFxuXHRcdHRoaXMuY29sdW1uTWFuYWdlciA9IG51bGw7IC8vIGhvbGQgQ29sdW1uIE1hbmFnZXJcblx0XHR0aGlzLnJvd01hbmFnZXIgPSBudWxsOyAvL2hvbGQgUm93IE1hbmFnZXJcblx0XHR0aGlzLmZvb3Rlck1hbmFnZXIgPSBudWxsOyAvL2hvbGRlciBGb290ZXIgTWFuYWdlclxuXHRcdHRoaXMuYWxlcnRNYW5hZ2VyID0gbnVsbDsgLy9ob2xkIEFsZXJ0IE1hbmFnZXJcblx0XHR0aGlzLnZkb21Ib3ogID0gbnVsbDsgLy9ob2xkZXIgaG9yaXpvbnRhbCB2aXJ0dWFsIGRvbVxuXHRcdHRoaXMuZXh0ZXJuYWxFdmVudHMgPSBudWxsOyAvL2hhbmRsZSBleHRlcm5hbCBldmVudCBtZXNzYWdpbmdcblx0XHR0aGlzLmV2ZW50QnVzID0gbnVsbDsgLy9oYW5kbGUgaW50ZXJuYWwgZXZlbnQgbWVzc2FnaW5nXG5cdFx0dGhpcy5pbnRlcmFjdGlvbk1vbml0b3IgPSBmYWxzZTsgLy90cmFjayB1c2VyIGludGVyYWN0aW9uXG5cdFx0dGhpcy5icm93c2VyID0gXCJcIjsgLy9ob2xkIGN1cnJlbnQgYnJvd3NlciB0eXBlXG5cdFx0dGhpcy5icm93c2VyU2xvdyA9IGZhbHNlOyAvL2hhbmRsZSByZWR1Y2VkIGZ1bmN0aW9uYWxpdHkgZm9yIHNsb3dlciBicm93c2Vyc1xuXHRcdHRoaXMuYnJvd3Nlck1vYmlsZSA9IGZhbHNlOyAvL2NoZWNrIGlmIHJ1bm5pbmcgb24gbW9iaWxlLCBwcmV2ZW50IHJlc2l6ZSBjYW5jZWxsaW5nIGVkaXQgb24ga2V5Ym9hcmQgYXBwZWFyYW5jZVxuXHRcdHRoaXMucnRsID0gZmFsc2U7IC8vY2hlY2sgaWYgdGhlIHRhYmxlIGlzIGluIFJUTCBtb2RlXG5cdFx0dGhpcy5vcmlnaW5hbEVsZW1lbnQgPSBudWxsOyAvL2hvbGQgb3JpZ2luYWwgdGFibGUgZWxlbWVudCBpZiBpdCBoYXMgYmVlbiByZXBsYWNlZFxuXHRcdFxuXHRcdHRoaXMuY29tcG9uZW50RnVuY3Rpb25CaW5kZXIgPSBuZXcgQ29tcG9uZW50RnVuY3Rpb25CaW5kZXIodGhpcyk7IC8vYmluZCBjb21wb25lbnQgZnVuY3Rpb25zXG5cdFx0dGhpcy5kYXRhTG9hZGVyID0gZmFsc2U7IC8vYmluZCBjb21wb25lbnQgZnVuY3Rpb25zXG5cdFx0XG5cdFx0dGhpcy5tb2R1bGVzID0ge307IC8vaG9sZCBhbGwgbW9kdWxlcyBib3VuZCB0byB0aGlzIHRhYmxlXG5cdFx0dGhpcy5tb2R1bGVzQ29yZSA9IFtdOyAvL2hvbGQgY29yZSBtb2R1bGVzIGJvdW5kIHRvIHRoaXMgdGFibGUgKGZvciBpbml0aWFsaXphdGlvbiBwdXJwb3Nlcylcblx0XHR0aGlzLm1vZHVsZXNSZWd1bGFyID0gW107IC8vaG9sZCByZWd1bGFyIG1vZHVsZXMgYm91bmQgdG8gdGhpcyB0YWJsZSAoZm9yIGluaXRpYWxpemF0aW9uIHB1cnBvc2VzKVxuXHRcdFxuXHRcdHRoaXMuZGVwcmVjYXRpb25BZHZpc29yID0gbmV3IERlcHJlY2F0aW9uQWR2aXNvcih0aGlzKTtcblx0XHR0aGlzLm9wdGlvbnNMaXN0ID0gbmV3IE9wdGlvbnNMaXN0KHRoaXMsIFwidGFibGUgY29uc3RydWN0b3JcIik7XG5cblx0XHR0aGlzLmRlcGVuZGVuY3lSZWdpc3RyeSA9IG5ldyBEZXBlbmRlbmN5UmVnaXN0cnkodGhpcyk7XG5cdFx0XG5cdFx0dGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdHRoaXMuZGVzdHJveWVkID0gZmFsc2U7XG5cdFx0XG5cdFx0aWYodGhpcy5pbml0aWFsaXplRWxlbWVudChlbGVtZW50KSl7XG5cdFx0XHRcblx0XHRcdHRoaXMuaW5pdGlhbGl6ZUNvcmVTeXN0ZW1zKG9wdGlvbnMpO1xuXHRcdFx0XG5cdFx0XHQvL2RlbGF5IHRhYmxlIGNyZWF0aW9uIHRvIGFsbG93IGV2ZW50IGJpbmRpbmdzIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSBjb25zdHJ1Y3RvclxuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdHRoaXMuX2NyZWF0ZSgpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuY29uc3RydWN0b3IucmVnaXN0cnkucmVnaXN0ZXIodGhpcyk7IC8vcmVnaXN0ZXIgdGFibGUgZm9yIGludGVyLWRldmljZSBjb21tdW5pY2F0aW9uXG5cdH1cblx0XG5cdGluaXRpYWxpemVFbGVtZW50KGVsZW1lbnQpe1xuXHRcdGlmKHR5cGVvZiBIVE1MRWxlbWVudCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBlbGVtZW50IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpe1xuXHRcdFx0dGhpcy5lbGVtZW50ID0gZWxlbWVudDtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1lbHNlIGlmKHR5cGVvZiBlbGVtZW50ID09PSBcInN0cmluZ1wiKXtcblx0XHRcdHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudCk7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuZWxlbWVudCl7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKFwiVGFidWxhdG9yIENyZWF0aW9uIEVycm9yIC0gbm8gZWxlbWVudCBmb3VuZCBtYXRjaGluZyBzZWxlY3RvcjogXCIsIGVsZW1lbnQpO1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcIlRhYnVsYXRvciBDcmVhdGlvbiBFcnJvciAtIEludmFsaWQgZWxlbWVudCBwcm92aWRlZDpcIiwgZWxlbWVudCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cdFxuXHRpbml0aWFsaXplQ29yZVN5c3RlbXMob3B0aW9ucyl7XG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyID0gbmV3IENvbHVtbk1hbmFnZXIodGhpcyk7XG5cdFx0dGhpcy5yb3dNYW5hZ2VyID0gbmV3IFJvd01hbmFnZXIodGhpcyk7XG5cdFx0dGhpcy5mb290ZXJNYW5hZ2VyID0gbmV3IEZvb3Rlck1hbmFnZXIodGhpcyk7XG5cdFx0dGhpcy5kYXRhTG9hZGVyID0gbmV3IERhdGFMb2FkZXIodGhpcyk7XG5cdFx0dGhpcy5hbGVydE1hbmFnZXIgPSBuZXcgQWxlcnQodGhpcyk7XG5cdFx0XG5cdFx0dGhpcy5fYmluZE1vZHVsZXMoKTtcblx0XHRcblx0XHR0aGlzLm9wdGlvbnMgPSB0aGlzLm9wdGlvbnNMaXN0LmdlbmVyYXRlKFRhYnVsYXRvci5kZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cdFx0XG5cdFx0dGhpcy5fY2xlYXJPYmplY3RQb2ludGVycygpO1xuXHRcdFxuXHRcdHRoaXMuX21hcERlcHJlY2F0ZWRGdW5jdGlvbmFsaXR5KCk7XG5cdFx0XG5cdFx0dGhpcy5leHRlcm5hbEV2ZW50cyA9IG5ldyBFeHRlcm5hbEV2ZW50QnVzKHRoaXMsIHRoaXMub3B0aW9ucywgdGhpcy5vcHRpb25zLmRlYnVnRXZlbnRzRXh0ZXJuYWwpO1xuXHRcdHRoaXMuZXZlbnRCdXMgPSBuZXcgSW50ZXJuYWxFdmVudEJ1cyh0aGlzLm9wdGlvbnMuZGVidWdFdmVudHNJbnRlcm5hbCk7XG5cdFx0XG5cdFx0dGhpcy5pbnRlcmFjdGlvbk1vbml0b3IgPSBuZXcgSW50ZXJhY3Rpb25NYW5hZ2VyKHRoaXMpO1xuXHRcdFxuXHRcdHRoaXMuZGF0YUxvYWRlci5pbml0aWFsaXplKCk7XG5cdFx0dGhpcy5mb290ZXJNYW5hZ2VyLmluaXRpYWxpemUoKTtcblxuXHRcdHRoaXMuZGVwZW5kZW5jeVJlZ2lzdHJ5LmluaXRpYWxpemUoKTtcblx0fVxuXHRcblx0Ly9jb252ZXJ0IGRlcHJlY2F0ZWQgZnVuY3Rpb25hbGl0eSB0byBuZXcgZnVuY3Rpb25zXG5cdF9tYXBEZXByZWNhdGVkRnVuY3Rpb25hbGl0eSgpe1xuXHRcdC8vYWxsIHByZXZpb3VzbHkgZGVwcmVjYXRlZCBmdW5jdGlvbmFsaXR5IHJlbW92ZWQgaW4gdGhlIDYuMCByZWxlYXNlXG5cdH1cblx0XG5cdF9jbGVhclNlbGVjdGlvbigpe1xuXHRcdFxuXHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWJsb2NrLXNlbGVjdFwiKTtcblx0XHRcblx0XHRpZiAod2luZG93LmdldFNlbGVjdGlvbikge1xuXHRcdFx0aWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSkgeyAgLy8gQ2hyb21lXG5cdFx0XHRcdHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpO1xuXHRcdFx0fSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKSB7ICAvLyBGaXJlZm94XG5cdFx0XHRcdHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgeyAgLy8gSUU/XG5cdFx0XHRkb2N1bWVudC5zZWxlY3Rpb24uZW1wdHkoKTtcblx0XHR9XG5cdFx0XG5cdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJ0YWJ1bGF0b3ItYmxvY2stc2VsZWN0XCIpO1xuXHR9XG5cdFxuXHQvL2NyZWF0ZSB0YWJsZVxuXHRfY3JlYXRlKCl7XG5cdFx0dGhpcy5leHRlcm5hbEV2ZW50cy5kaXNwYXRjaChcInRhYmxlQnVpbGRpbmdcIik7XG5cdFx0dGhpcy5ldmVudEJ1cy5kaXNwYXRjaChcInRhYmxlLWJ1aWxkaW5nXCIpO1xuXHRcdFxuXHRcdHRoaXMuX3J0bENoZWNrKCk7XG5cdFx0XG5cdFx0dGhpcy5fYnVpbGRFbGVtZW50KCk7XG5cdFx0XG5cdFx0dGhpcy5faW5pdGlhbGl6ZVRhYmxlKCk7XG5cblx0XHR0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcblx0XHRcblx0XHR0aGlzLl9sb2FkSW5pdGlhbERhdGEoKVxuXHRcdFx0LmZpbmFsbHkoKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKFwidGFibGUtaW5pdGlhbGl6ZWRcIik7XG5cdFx0XHRcdHRoaXMuZXh0ZXJuYWxFdmVudHMuZGlzcGF0Y2goXCJ0YWJsZUJ1aWx0XCIpO1xuXHRcdFx0fSk7XHRcblx0fVxuXHRcblx0X3J0bENoZWNrKCl7XG5cdFx0dmFyIHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtZW50KTtcblx0XHRcblx0XHRzd2l0Y2godGhpcy5vcHRpb25zLnRleHREaXJlY3Rpb24pe1xuXHRcdFx0Y2FzZVwiYXV0b1wiOlxuXHRcdFx0XHRpZihzdHlsZS5kaXJlY3Rpb24gIT09IFwicnRsXCIpe1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHRcblx0XHRcdGNhc2UgXCJydGxcIjpcblx0XHRcdFx0dGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ0YWJ1bGF0b3ItcnRsXCIpO1xuXHRcdFx0XHR0aGlzLnJ0bCA9IHRydWU7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0XG5cdFx0XHRjYXNlIFwibHRyXCI6XG5cdFx0XHRcdHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLWx0clwiKTtcblx0XHRcdFxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0dGhpcy5ydGwgPSBmYWxzZTtcblx0XHR9XG5cdH1cblx0XG5cdC8vY2xlYXIgcG9pbnRlcnMgdG8gb2JqZWN0cyBpbiBkZWZhdWx0IGNvbmZpZyBvYmplY3Rcblx0X2NsZWFyT2JqZWN0UG9pbnRlcnMoKXtcblx0XHR0aGlzLm9wdGlvbnMuY29sdW1ucyA9IHRoaXMub3B0aW9ucy5jb2x1bW5zLnNsaWNlKDApO1xuXHRcdFxuXHRcdGlmKEFycmF5LmlzQXJyYXkodGhpcy5vcHRpb25zLmRhdGEpICYmICF0aGlzLm9wdGlvbnMucmVhY3RpdmVEYXRhKXtcblx0XHRcdHRoaXMub3B0aW9ucy5kYXRhID0gdGhpcy5vcHRpb25zLmRhdGEuc2xpY2UoMCk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL2J1aWxkIHRhYnVsYXRvciBlbGVtZW50XG5cdF9idWlsZEVsZW1lbnQoKXtcblx0XHR2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudCxcblx0XHRvcHRpb25zID0gdGhpcy5vcHRpb25zLFxuXHRcdG5ld0VsZW1lbnQ7XG5cdFx0XG5cdFx0aWYoZWxlbWVudC50YWdOYW1lID09PSBcIlRBQkxFXCIpe1xuXHRcdFx0dGhpcy5vcmlnaW5hbEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cdFx0XHRuZXdFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRcdFxuXHRcdFx0Ly90cmFuc2ZlciBhdHRyaWJ1dGVzIHRvIG5ldyBlbGVtZW50XG5cdFx0XHR2YXIgYXR0cmlidXRlcyA9IGVsZW1lbnQuYXR0cmlidXRlcztcblx0XHRcdFxuXHRcdFx0Ly8gbG9vcCB0aHJvdWdoIGF0dHJpYnV0ZXMgYW5kIGFwcGx5IHRoZW0gb24gZGl2XG5cdFx0XHRmb3IodmFyIGkgaW4gYXR0cmlidXRlcyl7XG5cdFx0XHRcdGlmKHR5cGVvZiBhdHRyaWJ1dGVzW2ldID09IFwib2JqZWN0XCIpe1xuXHRcdFx0XHRcdG5ld0VsZW1lbnQuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZXNbaV0ubmFtZSwgYXR0cmlidXRlc1tpXS52YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0Ly8gcmVwbGFjZSB0YWJsZSB3aXRoIGRpdiBlbGVtZW50XG5cdFx0XHRlbGVtZW50LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld0VsZW1lbnQsIGVsZW1lbnQpO1xuXHRcdFx0XG5cdFx0XHR0aGlzLmVsZW1lbnQgPSBlbGVtZW50ID0gbmV3RWxlbWVudDtcblx0XHR9XG5cdFx0XG5cdFx0ZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yXCIpO1xuXHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcImdyaWRcIik7XG5cdFx0XG5cdFx0Ly9lbXB0eSBlbGVtZW50XG5cdFx0d2hpbGUoZWxlbWVudC5maXJzdENoaWxkKSBlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQuZmlyc3RDaGlsZCk7XG5cdFx0XG5cdFx0Ly9zZXQgdGFibGUgaGVpZ2h0XG5cdFx0aWYob3B0aW9ucy5oZWlnaHQpe1xuXHRcdFx0b3B0aW9ucy5oZWlnaHQgPSBpc05hTihvcHRpb25zLmhlaWdodCkgPyBvcHRpb25zLmhlaWdodCA6IG9wdGlvbnMuaGVpZ2h0ICsgXCJweFwiO1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcblx0XHR9XG5cdFx0XG5cdFx0Ly9zZXQgdGFibGUgbWluIGhlaWdodFxuXHRcdGlmKG9wdGlvbnMubWluSGVpZ2h0ICE9PSBmYWxzZSl7XG5cdFx0XHRvcHRpb25zLm1pbkhlaWdodCA9IGlzTmFOKG9wdGlvbnMubWluSGVpZ2h0KSA/IG9wdGlvbnMubWluSGVpZ2h0IDogb3B0aW9ucy5taW5IZWlnaHQgKyBcInB4XCI7XG5cdFx0XHRlbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IG9wdGlvbnMubWluSGVpZ2h0O1xuXHRcdH1cblx0XHRcblx0XHQvL3NldCB0YWJsZSBtYXhIZWlnaHRcblx0XHRpZihvcHRpb25zLm1heEhlaWdodCAhPT0gZmFsc2Upe1xuXHRcdFx0b3B0aW9ucy5tYXhIZWlnaHQgPSBpc05hTihvcHRpb25zLm1heEhlaWdodCkgPyBvcHRpb25zLm1heEhlaWdodCA6IG9wdGlvbnMubWF4SGVpZ2h0ICsgXCJweFwiO1xuXHRcdFx0ZWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSBvcHRpb25zLm1heEhlaWdodDtcblx0XHR9XG5cdH1cblx0XG5cdC8vaW5pdGlhbGl6ZSBjb3JlIHN5c3RlbXMgYW5kIG1vZHVsZXNcblx0X2luaXRpYWxpemVUYWJsZSgpe1xuXHRcdHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50LFxuXHRcdG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG5cdFx0XG5cdFx0dGhpcy5pbnRlcmFjdGlvbk1vbml0b3IuaW5pdGlhbGl6ZSgpO1xuXHRcdFxuXHRcdHRoaXMuY29sdW1uTWFuYWdlci5pbml0aWFsaXplKCk7XG5cdFx0dGhpcy5yb3dNYW5hZ2VyLmluaXRpYWxpemUoKTtcblx0XHRcblx0XHR0aGlzLl9kZXRlY3RCcm93c2VyKCk7XG5cdFx0XG5cdFx0Ly9pbml0aWFsaXplIGNvcmUgbW9kdWxlc1xuXHRcdHRoaXMubW9kdWxlc0NvcmUuZm9yRWFjaCgobW9kKSA9PiB7XG5cdFx0XHRtb2QuaW5pdGlhbGl6ZSgpO1xuXHRcdH0pO1xuXHRcdFxuXHRcdC8vYnVpbGQgdGFibGUgZWxlbWVudHNcblx0XHRlbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY29sdW1uTWFuYWdlci5nZXRFbGVtZW50KCkpO1xuXHRcdGVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5yb3dNYW5hZ2VyLmdldEVsZW1lbnQoKSk7XG5cdFx0XG5cdFx0aWYob3B0aW9ucy5mb290ZXJFbGVtZW50KXtcblx0XHRcdHRoaXMuZm9vdGVyTWFuYWdlci5hY3RpdmF0ZSgpO1xuXHRcdH1cblx0XHRcblx0XHRpZihvcHRpb25zLmF1dG9Db2x1bW5zICYmIG9wdGlvbnMuZGF0YSl7XG5cdFx0XHRcblx0XHRcdHRoaXMuY29sdW1uTWFuYWdlci5nZW5lcmF0ZUNvbHVtbnNGcm9tUm93RGF0YSh0aGlzLm9wdGlvbnMuZGF0YSk7XG5cdFx0fVxuXHRcdFxuXHRcdC8vaW5pdGlhbGl6ZSByZWd1bGFyIG1vZHVsZXNcblx0XHR0aGlzLm1vZHVsZXNSZWd1bGFyLmZvckVhY2goKG1vZCkgPT4ge1xuXHRcdFx0bW9kLmluaXRpYWxpemUoKTtcblx0XHR9KTtcblx0XHRcblx0XHR0aGlzLmNvbHVtbk1hbmFnZXIuc2V0Q29sdW1ucyhvcHRpb25zLmNvbHVtbnMpO1xuXHRcdFxuXHRcdHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goXCJ0YWJsZS1idWlsdFwiKTtcblx0fVxuXHRcblx0X2xvYWRJbml0aWFsRGF0YSgpe1xuXHRcdHJldHVybiB0aGlzLmRhdGFMb2FkZXIubG9hZCh0aGlzLm9wdGlvbnMuZGF0YSlcblx0XHRcdC5maW5hbGx5KCgpID0+IHtcblx0XHRcdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLnZlcnRpY2FsQWxpZ25IZWFkZXJzKCk7XG5cdFx0XHR9KTtcdFx0XG5cdH1cblx0XG5cdC8vZGVjb25zdHJ1Y3RvclxuXHRkZXN0cm95KCl7XG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG5cdFx0XG5cdFx0dGhpcy5kZXN0cm95ZWQgPSB0cnVlO1xuXHRcdFxuXHRcdHRoaXMuY29uc3RydWN0b3IucmVnaXN0cnkuZGVyZWdpc3Rlcih0aGlzKTsgLy9kZXJlZ2lzdGVyIHRhYmxlIGZyb20gaW50ZXItZGV2aWNlIGNvbW11bmljYXRpb25cblx0XHRcblx0XHR0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKFwidGFibGUtZGVzdHJveVwiKTtcblx0XHRcblx0XHQvL2NsZWFyIHJvdyBkYXRhXG5cdFx0dGhpcy5yb3dNYW5hZ2VyLmRlc3Ryb3koKTtcblx0XHRcblx0XHQvL2NsZWFyIERPTVxuXHRcdHdoaWxlKGVsZW1lbnQuZmlyc3RDaGlsZCkgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpO1xuXHRcdGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInRhYnVsYXRvclwiKTtcblxuXHRcdHRoaXMuZXh0ZXJuYWxFdmVudHMuZGlzcGF0Y2goXCJ0YWJsZURlc3Ryb3llZFwiKTtcblx0fVxuXHRcblx0X2RldGVjdEJyb3dzZXIoKXtcblx0XHR2YXIgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50fHxuYXZpZ2F0b3IudmVuZG9yfHx3aW5kb3cub3BlcmE7XG5cdFx0XG5cdFx0aWYodWEuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAtMSl7XG5cdFx0XHR0aGlzLmJyb3dzZXIgPSBcImllXCI7XG5cdFx0XHR0aGlzLmJyb3dzZXJTbG93ID0gdHJ1ZTtcblx0XHR9ZWxzZSBpZih1YS5pbmRleE9mKFwiRWRnZVwiKSA+IC0xKXtcblx0XHRcdHRoaXMuYnJvd3NlciA9IFwiZWRnZVwiO1xuXHRcdFx0dGhpcy5icm93c2VyU2xvdyA9IHRydWU7XG5cdFx0fWVsc2UgaWYodWEuaW5kZXhPZihcIkZpcmVmb3hcIikgPiAtMSl7XG5cdFx0XHR0aGlzLmJyb3dzZXIgPSBcImZpcmVmb3hcIjtcblx0XHRcdHRoaXMuYnJvd3NlclNsb3cgPSBmYWxzZTtcblx0XHR9ZWxzZSBpZih1YS5pbmRleE9mKFwiTWFjIE9TXCIpID4gLTEpe1xuXHRcdFx0dGhpcy5icm93c2VyID0gXCJzYWZhcmlcIjtcblx0XHRcdHRoaXMuYnJvd3NlclNsb3cgPSBmYWxzZTtcblx0XHR9ZWxzZSB7XG5cdFx0XHR0aGlzLmJyb3dzZXIgPSBcIm90aGVyXCI7XG5cdFx0XHR0aGlzLmJyb3dzZXJTbG93ID0gZmFsc2U7XG5cdFx0fVxuXHRcdFxuXHRcdHRoaXMuYnJvd3Nlck1vYmlsZSA9IC8oYW5kcm9pZHxiYlxcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXFwvfGJsYWNrYmVycnl8YmxhemVyfGNvbXBhbHxlbGFpbmV8ZmVubmVjfGhpcHRvcHxpZW1vYmlsZXxpcChob25lfG9kKXxpcmlzfGtpbmRsZXxsZ2UgfG1hZW1vfG1pZHB8bW1wfG1vYmlsZS4rZmlyZWZveHxuZXRmcm9udHxvcGVyYSBtKG9ifGluKWl8cGFsbSggb3MpP3xwaG9uZXxwKGl4aXxyZSlcXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm98YW5kcm9pZHxpcGFkfHBsYXlib29rfHNpbGsvaS50ZXN0KHVhKXx8LzEyMDd8NjMxMHw2NTkwfDNnc298NHRocHw1MFsxLTZdaXw3NzBzfDgwMnN8YSB3YXxhYmFjfGFjKGVyfG9vfHMtKXxhaShrb3xybil8YWwoYXZ8Y2F8Y28pfGFtb2l8YW4oZXh8bnl8eXcpfGFwdHV8YXIoY2h8Z28pfGFzKHRlfHVzKXxhdHR3fGF1KGRpfC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YnctKG58dSl8YzU1XFwvfGNhcGl8Y2N3YXxjZG0tfGNlbGx8Y2h0bXxjbGRjfGNtZC18Y28obXB8bmQpfGNyYXd8ZGEoaXR8bGx8bmcpfGRidGV8ZGMtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KC18Xyl8ZzEgdXxnNTYwfGdlbmV8Z2YtNXxnLW1vfGdvKFxcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGQtKG18cHx0KXxoZWktfGhpKHB0fHRhKXxocCggaXxpcCl8aHMtY3xodChjKC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpLSgyMHxnb3xtYSl8aTIzMHxpYWMoIHwtfFxcLyl8aWJyb3xpZGVhfGlnMDF8aWtvbXxpbTFrfGlubm98aXBhcXxpcmlzfGphKHR8dilhfGpicm98amVtdXxqaWdzfGtkZGl8a2VqaXxrZ3QoIHxcXC8pfGtsb258a3B0IHxrd2MtfGt5byhjfGspfGxlKG5vfHhpKXxsZyggZ3xcXC8oa3xsfHUpfDUwfDU0fC1bYS13XSl8bGlid3xseW54fG0xLXd8bTNnYXxtNTBcXC98bWEodGV8dWl8eG8pfG1jKDAxfDIxfGNhKXxtLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KC18IHxvfHYpfHp6KXxtdCg1MHxwMXx2ICl8bXdicHxteXdhfG4xMFswLTJdfG4yMFsyLTNdfG4zMCgwfDIpfG41MCgwfDJ8NSl8bjcoMCgwfDEpfDEwKXxuZSgoY3xtKS18b258dGZ8d2Z8d2d8d3QpfG5vayg2fGkpfG56cGh8bzJpbXxvcCh0aXx3dil8b3Jhbnxvd2cxfHA4MDB8cGFuKGF8ZHx0KXxwZHhnfHBnKDEzfC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG4tMnxwbyhja3xydHxzZSl8cHJveHxwc2lvfHB0LWd8cWEtYXxxYygwN3wxMnwyMXwzMnw2MHwtWzItN118aS0pfHF0ZWt8cjM4MHxyNjAwfHJha3N8cmltOXxybyh2ZXx6byl8czU1XFwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoLXxvb3xwLSl8c2RrXFwvfHNlKGMoLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2gtfHNoYXJ8c2llKC18bSl8c2stMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoLXx2LXx2ICl8c3koMDF8bWIpfHQyKDE4fDUwKXx0NigwMHwxMHwxOCl8dGEoZ3R8bGspfHRjbC18dGRnLXx0ZWwoaXxtKXx0aW0tfHQtbW98dG8ocGx8c2gpfHRzKDcwfG0tfG0zfG01KXx0eC05fHVwKFxcLmJ8ZzF8c2kpfHV0c3R8djQwMHx2NzUwfHZlcml8dmkocmd8dGUpfHZrKDQwfDVbMC0zXXwtdil8dm00MHx2b2RhfHZ1bGN8dngoNTJ8NTN8NjB8NjF8NzB8ODB8ODF8ODN8ODV8OTgpfHczYygtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzLXx5b3VyfHpldG98enRlLS9pLnRlc3QodWEuc2xpY2UoMCw0KSk7XG5cdH1cblx0XG5cdGluaXRHdWFyZChmdW5jLCBtc2cpe1xuXHRcdHZhciBzdGFjaywgbGluZTtcblx0XHRcblx0XHRpZih0aGlzLm9wdGlvbnMuZGVidWdJbml0aWFsaXphdGlvbiAmJiAhdGhpcy5pbml0aWFsaXplZCl7XG5cdFx0XHRpZighZnVuYyl7XG5cdFx0XHRcdHN0YWNrID0gbmV3IEVycm9yKCkuc3RhY2suc3BsaXQoXCJcXG5cIik7XG5cdFx0XHRcdFxuXHRcdFx0XHRsaW5lID0gc3RhY2tbMF0gPT0gXCJFcnJvclwiID8gc3RhY2tbMl0gOiBzdGFja1sxXTtcblx0XHRcdFx0XG5cdFx0XHRcdGlmKGxpbmVbMF0gPT0gXCIgXCIpe1xuXHRcdFx0XHRcdGZ1bmMgPSBsaW5lLnRyaW0oKS5zcGxpdChcIiBcIilbMV0uc3BsaXQoXCIuXCIpWzFdO1xuXHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0ZnVuYyA9IGxpbmUudHJpbSgpLnNwbGl0KFwiQFwiKVswXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRjb25zb2xlLndhcm4oXCJUYWJsZSBOb3QgSW5pdGlhbGl6ZWQgLSBDYWxsaW5nIHRoZSBcIiArIGZ1bmMgKyBcIiBmdW5jdGlvbiBiZWZvcmUgdGhlIHRhYmxlIGlzIGluaXRpYWxpemVkIG1heSByZXN1bHQgaW4gaW5jb25zaXN0ZW50IGJlaGF2aW9yLCBQbGVhc2Ugd2FpdCBmb3IgdGhlIGB0YWJsZUJ1aWx0YCBldmVudCBiZWZvcmUgY2FsbGluZyB0aGlzIGZ1bmN0aW9uLlwiICsgKG1zZyA/IFwiIFwiICsgbXNnIDogXCJcIikpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gdGhpcy5pbml0aWFsaXplZDtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8vLy8vIERhdGEgSGFuZGxpbmcgLy8vLy8vLy8vLy8vLy8vLy8vXG5cdC8vYmxvY2sgdGFibGUgcmVkcmF3aW5nXG5cdGJsb2NrUmVkcmF3KCl7XG5cdFx0dGhpcy5pbml0R3VhcmQoKTtcblxuXHRcdHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goXCJyZWRyYXctYmxvY2tpbmdcIik7XG5cdFx0XG5cdFx0dGhpcy5yb3dNYW5hZ2VyLmJsb2NrUmVkcmF3KCk7XG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLmJsb2NrUmVkcmF3KCk7XG5cblx0XHR0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKFwicmVkcmF3LWJsb2NrZWRcIik7XG5cdH1cblx0XG5cdC8vcmVzdG9yZSB0YWJsZSByZWRyYXdpbmdcblx0cmVzdG9yZVJlZHJhdygpe1xuXHRcdHRoaXMuaW5pdEd1YXJkKCk7XG5cblx0XHR0aGlzLmV2ZW50QnVzLmRpc3BhdGNoKFwicmVkcmF3LXJlc3RvcmluZ1wiKTtcblxuXHRcdHRoaXMucm93TWFuYWdlci5yZXN0b3JlUmVkcmF3KCk7XG5cdFx0dGhpcy5jb2x1bW5NYW5hZ2VyLnJlc3RvcmVSZWRyYXcoKTtcblxuXHRcdHRoaXMuZXZlbnRCdXMuZGlzcGF0Y2goXCJyZWRyYXctcmVzdG9yZWRcIik7XG5cdH1cblx0XG5cdC8vbG9hZCBkYXRhXG5cdHNldERhdGEoZGF0YSwgcGFyYW1zLCBjb25maWcpe1xuXHRcdHRoaXMuaW5pdEd1YXJkKGZhbHNlLCBcIlRvIHNldCBpbml0aWFsIGRhdGEgcGxlYXNlIHVzZSB0aGUgJ2RhdGEnIHByb3BlcnR5IGluIHRoZSB0YWJsZSBjb25zdHJ1Y3Rvci5cIik7XG5cdFx0XG5cdFx0cmV0dXJuIHRoaXMuZGF0YUxvYWRlci5sb2FkKGRhdGEsIHBhcmFtcywgY29uZmlnLCBmYWxzZSk7XG5cdH1cblx0XG5cdC8vY2xlYXIgZGF0YVxuXHRjbGVhckRhdGEoKXtcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdHRoaXMuZGF0YUxvYWRlci5ibG9ja0FjdGl2ZUxvYWQoKTtcblx0XHR0aGlzLnJvd01hbmFnZXIuY2xlYXJEYXRhKCk7XG5cdH1cblx0XG5cdC8vZ2V0IHRhYmxlIGRhdGEgYXJyYXlcblx0Z2V0RGF0YShhY3RpdmUpe1xuXHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0RGF0YShhY3RpdmUpO1xuXHR9XG5cdFxuXHQvL2dldCB0YWJsZSBkYXRhIGFycmF5IGNvdW50XG5cdGdldERhdGFDb3VudChhY3RpdmUpe1xuXHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0RGF0YUNvdW50KGFjdGl2ZSk7XG5cdH1cblx0XG5cdC8vcmVwbGFjZSBkYXRhLCBrZWVwaW5nIHRhYmxlIGluIHBvc2l0aW9uIHdpdGggc2FtZSBzb3J0XG5cdHJlcGxhY2VEYXRhKGRhdGEsIHBhcmFtcywgY29uZmlnKXtcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdHJldHVybiB0aGlzLmRhdGFMb2FkZXIubG9hZChkYXRhLCBwYXJhbXMsIGNvbmZpZywgdHJ1ZSwgdHJ1ZSk7XG5cdH1cblx0XG5cdC8vdXBkYXRlIHRhYmxlIGRhdGFcblx0dXBkYXRlRGF0YShkYXRhKXtcblx0XHR2YXIgcmVzcG9uc2VzID0gMDtcblx0XHRcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHR0aGlzLmRhdGFMb2FkZXIuYmxvY2tBY3RpdmVMb2FkKCk7XG5cdFx0XHRcblx0XHRcdGlmKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKXtcblx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKXtcblx0XHRcdFx0ZGF0YS5mb3JFYWNoKChpdGVtKSA9PiB7XG5cdFx0XHRcdFx0dmFyIHJvdyA9IHRoaXMucm93TWFuYWdlci5maW5kUm93KGl0ZW1bdGhpcy5vcHRpb25zLmluZGV4XSk7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYocm93KXtcblx0XHRcdFx0XHRcdHJlc3BvbnNlcysrO1xuXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRyb3cudXBkYXRlRGF0YShpdGVtKVxuXHRcdFx0XHRcdFx0XHQudGhlbigoKT0+e1xuXHRcdFx0XHRcdFx0XHRcdHJlc3BvbnNlcy0tO1xuXHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdFx0XHRpZighcmVzcG9uc2VzKXtcblx0XHRcdFx0XHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHRcdC5jYXRjaCgoZSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdHJlamVjdChcIlVwZGF0ZSBFcnJvciAtIFVuYWJsZSB0byB1cGRhdGUgcm93XCIsIGl0ZW0sIGUpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHRyZWplY3QoXCJVcGRhdGUgRXJyb3IgLSBVbmFibGUgdG8gZmluZCByb3dcIiwgaXRlbSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiVXBkYXRlIEVycm9yIC0gTm8gZGF0YSBwcm92aWRlZFwiKTtcblx0XHRcdFx0cmVqZWN0KFwiVXBkYXRlIEVycm9yIC0gTm8gZGF0YSBwcm92aWRlZFwiKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXHRcblx0YWRkRGF0YShkYXRhLCBwb3MsIGluZGV4KXtcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHR0aGlzLmRhdGFMb2FkZXIuYmxvY2tBY3RpdmVMb2FkKCk7XG5cdFx0XHRcblx0XHRcdGlmKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKXtcblx0XHRcdFx0ZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKGRhdGEpe1xuXHRcdFx0XHR0aGlzLnJvd01hbmFnZXIuYWRkUm93cyhkYXRhLCBwb3MsIGluZGV4KVxuXHRcdFx0XHRcdC50aGVuKChyb3dzKSA9PiB7XG5cdFx0XHRcdFx0XHR2YXIgb3V0cHV0ID0gW107XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHRyb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KXtcblx0XHRcdFx0XHRcdFx0b3V0cHV0LnB1c2gocm93LmdldENvbXBvbmVudCgpKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0cmVzb2x2ZShvdXRwdXQpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJVcGRhdGUgRXJyb3IgLSBObyBkYXRhIHByb3ZpZGVkXCIpO1xuXHRcdFx0XHRyZWplY3QoXCJVcGRhdGUgRXJyb3IgLSBObyBkYXRhIHByb3ZpZGVkXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHQvL3VwZGF0ZSB0YWJsZSBkYXRhXG5cdHVwZGF0ZU9yQWRkRGF0YShkYXRhKXtcblx0XHR2YXIgcm93cyA9IFtdLFxuXHRcdHJlc3BvbnNlcyA9IDA7XG5cdFx0XG5cdFx0dGhpcy5pbml0R3VhcmQoKTtcblx0XHRcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0dGhpcy5kYXRhTG9hZGVyLmJsb2NrQWN0aXZlTG9hZCgpO1xuXHRcdFx0XG5cdFx0XHRpZih0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIil7XG5cdFx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZihkYXRhICYmIGRhdGEubGVuZ3RoID4gMCl7XG5cdFx0XHRcdGRhdGEuZm9yRWFjaCgoaXRlbSkgPT4ge1xuXHRcdFx0XHRcdHZhciByb3cgPSB0aGlzLnJvd01hbmFnZXIuZmluZFJvdyhpdGVtW3RoaXMub3B0aW9ucy5pbmRleF0pO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdHJlc3BvbnNlcysrO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKHJvdyl7XG5cdFx0XHRcdFx0XHRyb3cudXBkYXRlRGF0YShpdGVtKVxuXHRcdFx0XHRcdFx0XHQudGhlbigoKT0+e1xuXHRcdFx0XHRcdFx0XHRcdHJlc3BvbnNlcy0tO1xuXHRcdFx0XHRcdFx0XHRcdHJvd3MucHVzaChyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdFx0XHRpZighcmVzcG9uc2VzKXtcblx0XHRcdFx0XHRcdFx0XHRcdHJlc29sdmUocm93cyk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdFx0XHR0aGlzLnJvd01hbmFnZXIuYWRkUm93cyhpdGVtKVxuXHRcdFx0XHRcdFx0XHQudGhlbigobmV3Um93cyk9Pntcblx0XHRcdFx0XHRcdFx0XHRyZXNwb25zZXMtLTtcblx0XHRcdFx0XHRcdFx0XHRyb3dzLnB1c2gobmV3Um93c1swXS5nZXRDb21wb25lbnQoKSk7XG5cdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0XHRcdGlmKCFyZXNwb25zZXMpe1xuXHRcdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShyb3dzKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihcIlVwZGF0ZSBFcnJvciAtIE5vIGRhdGEgcHJvdmlkZWRcIik7XG5cdFx0XHRcdHJlamVjdChcIlVwZGF0ZSBFcnJvciAtIE5vIGRhdGEgcHJvdmlkZWRcIik7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblx0XG5cdC8vZ2V0IHJvdyBvYmplY3Rcblx0Z2V0Um93KGluZGV4KXtcblx0XHR2YXIgcm93ID0gdGhpcy5yb3dNYW5hZ2VyLmZpbmRSb3coaW5kZXgpO1xuXHRcdFxuXHRcdGlmKHJvdyl7XG5cdFx0XHRyZXR1cm4gcm93LmdldENvbXBvbmVudCgpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkZpbmQgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGluZGV4KTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblx0XG5cdC8vZ2V0IHJvdyBvYmplY3Rcblx0Z2V0Um93RnJvbVBvc2l0aW9uKHBvc2l0aW9uKXtcblx0XHR2YXIgcm93ID0gdGhpcy5yb3dNYW5hZ2VyLmdldFJvd0Zyb21Qb3NpdGlvbihwb3NpdGlvbik7XG5cdFx0XG5cdFx0aWYocm93KXtcblx0XHRcdHJldHVybiByb3cuZ2V0Q29tcG9uZW50KCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiRmluZCBFcnJvciAtIE5vIG1hdGNoaW5nIHJvdyBmb3VuZDpcIiwgcG9zaXRpb24pO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fVxuXHRcblx0Ly9kZWxldGUgcm93IGZyb20gdGFibGVcblx0ZGVsZXRlUm93KGluZGV4KXtcblx0XHR2YXIgZm91bmRSb3dzID0gW107XG5cdFx0XG5cdFx0dGhpcy5pbml0R3VhcmQoKTtcblx0XHRcblx0XHRpZighQXJyYXkuaXNBcnJheShpbmRleCkpe1xuXHRcdFx0aW5kZXggPSBbaW5kZXhdO1xuXHRcdH1cblx0XHRcblx0XHQvL2ZpbmQgbWF0Y2hpbmcgcm93c1xuXHRcdGZvcihsZXQgaXRlbSBvZiBpbmRleCl7XG5cdFx0XHRsZXQgcm93ID0gdGhpcy5yb3dNYW5hZ2VyLmZpbmRSb3coaXRlbSwgdHJ1ZSk7XG5cdFx0XHRcblx0XHRcdGlmKHJvdyl7XG5cdFx0XHRcdGZvdW5kUm93cy5wdXNoKHJvdyk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJEZWxldGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGl0ZW0pO1xuXHRcdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoXCJEZWxldGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmRcIik7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdFxuXHRcdC8vc29ydCByb3dzIGludG8gY29ycmVjdCBvcmRlciB0byBlbnN1cmUgc21vb3RoIGRlbGV0ZSBmcm9tIHRhYmxlXG5cdFx0Zm91bmRSb3dzLnNvcnQoKGEsIGIpID0+IHtcblx0XHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIucm93cy5pbmRleE9mKGEpID4gdGhpcy5yb3dNYW5hZ2VyLnJvd3MuaW5kZXhPZihiKSA/IDEgOiAtMTtcblx0XHR9KTtcblx0XHRcblx0XHQvL2RlbGV0ZSByb3dzXG5cdFx0Zm91bmRSb3dzLmZvckVhY2goKHJvdykgPT57XG5cdFx0XHRyb3cuZGVsZXRlKCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0dGhpcy5yb3dNYW5hZ2VyLnJlUmVuZGVySW5Qb3NpdGlvbigpO1xuXHRcdFxuXHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblx0fVxuXHRcblx0Ly9hZGQgcm93IHRvIHRhYmxlXG5cdGFkZFJvdyhkYXRhLCBwb3MsIGluZGV4KXtcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdGlmKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKXtcblx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gdGhpcy5yb3dNYW5hZ2VyLmFkZFJvd3MoZGF0YSwgcG9zLCBpbmRleCwgdHJ1ZSlcblx0XHRcdC50aGVuKChyb3dzKT0+e1xuXHRcdFx0XHRyZXR1cm4gcm93c1swXS5nZXRDb21wb25lbnQoKTtcblx0XHRcdH0pO1xuXHR9XG5cdFxuXHQvL3VwZGF0ZSBhIHJvdyBpZiBpdCBleGlzdHMgb3RoZXJ3aXNlIGNyZWF0ZSBpdFxuXHR1cGRhdGVPckFkZFJvdyhpbmRleCwgZGF0YSl7XG5cdFx0dmFyIHJvdyA9IHRoaXMucm93TWFuYWdlci5maW5kUm93KGluZGV4KTtcblx0XHRcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdGlmKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKXtcblx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdH1cblx0XHRcblx0XHRpZihyb3cpe1xuXHRcdFx0cmV0dXJuIHJvdy51cGRhdGVEYXRhKGRhdGEpXG5cdFx0XHRcdC50aGVuKCgpPT57XG5cdFx0XHRcdFx0cmV0dXJuIHJvdy5nZXRDb21wb25lbnQoKTtcblx0XHRcdFx0fSk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0cmV0dXJuIHRoaXMucm93TWFuYWdlci5hZGRSb3dzKGRhdGEpXG5cdFx0XHRcdC50aGVuKChyb3dzKT0+e1xuXHRcdFx0XHRcdHJldHVybiByb3dzWzBdLmdldENvbXBvbmVudCgpO1xuXHRcdFx0XHR9KTtcblx0XHR9XG5cdH1cblx0XG5cdC8vdXBkYXRlIHJvdyBkYXRhXG5cdHVwZGF0ZVJvdyhpbmRleCwgZGF0YSl7XG5cdFx0dmFyIHJvdyA9IHRoaXMucm93TWFuYWdlci5maW5kUm93KGluZGV4KTtcblx0XHRcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdGlmKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKXtcblx0XHRcdGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdH1cblx0XHRcblx0XHRpZihyb3cpe1xuXHRcdFx0cmV0dXJuIHJvdy51cGRhdGVEYXRhKGRhdGEpXG5cdFx0XHRcdC50aGVuKCgpPT57XG5cdFx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZShyb3cuZ2V0Q29tcG9uZW50KCkpO1xuXHRcdFx0XHR9KTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJVcGRhdGUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGluZGV4KTtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChcIlVwZGF0ZSBFcnJvciAtIE5vIG1hdGNoaW5nIHJvdyBmb3VuZFwiKTtcblx0XHR9XG5cdH1cblx0XG5cdC8vc2Nyb2xsIHRvIHJvdyBpbiBET01cblx0c2Nyb2xsVG9Sb3coaW5kZXgsIHBvc2l0aW9uLCBpZlZpc2libGUpe1xuXHRcdHZhciByb3cgPSB0aGlzLnJvd01hbmFnZXIuZmluZFJvdyhpbmRleCk7XG5cdFx0XG5cdFx0aWYocm93KXtcblx0XHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuc2Nyb2xsVG9Sb3cocm93LCBwb3NpdGlvbiwgaWZWaXNpYmxlKTtcblx0XHR9ZWxzZSB7XG5cdFx0XHRjb25zb2xlLndhcm4oXCJTY3JvbGwgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGluZGV4KTtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdChcIlNjcm9sbCBFcnJvciAtIE5vIG1hdGNoaW5nIHJvdyBmb3VuZFwiKTtcblx0XHR9XG5cdH1cblx0XG5cdG1vdmVSb3coZnJvbSwgdG8sIGFmdGVyKXtcblx0XHR2YXIgZnJvbVJvdyA9IHRoaXMucm93TWFuYWdlci5maW5kUm93KGZyb20pO1xuXHRcdFxuXHRcdHRoaXMuaW5pdEd1YXJkKCk7XG5cdFx0XG5cdFx0aWYoZnJvbVJvdyl7XG5cdFx0XHRmcm9tUm93Lm1vdmVUb1Jvdyh0bywgYWZ0ZXIpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIk1vdmUgRXJyb3IgLSBObyBtYXRjaGluZyByb3cgZm91bmQ6XCIsIGZyb20pO1xuXHRcdH1cblx0fVxuXHRcblx0Z2V0Um93cyhhY3RpdmUpe1xuXHRcdHJldHVybiB0aGlzLnJvd01hbmFnZXIuZ2V0Q29tcG9uZW50cyhhY3RpdmUpO1x0XG5cdH1cblx0XG5cdC8vZ2V0IHBvc2l0aW9uIG9mIHJvdyBpbiB0YWJsZVxuXHRnZXRSb3dQb3NpdGlvbihpbmRleCl7XG5cdFx0dmFyIHJvdyA9IHRoaXMucm93TWFuYWdlci5maW5kUm93KGluZGV4KTtcblx0XHRcblx0XHRpZihyb3cpe1xuXHRcdFx0cmV0dXJuIHJvdy5nZXRQb3NpdGlvbigpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIlBvc2l0aW9uIEVycm9yIC0gTm8gbWF0Y2hpbmcgcm93IGZvdW5kOlwiLCBpbmRleCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8vLy8gQ29sdW1uIEZ1bmN0aW9ucyAgLy8vLy8vLy8vLy8vLy8vXG5cdHNldENvbHVtbnMoZGVmaW5pdGlvbil7XG5cdFx0dGhpcy5pbml0R3VhcmQoZmFsc2UsIFwiVG8gc2V0IGluaXRpYWwgY29sdW1ucyBwbGVhc2UgdXNlIHRoZSAnY29sdW1ucycgcHJvcGVydHkgaW4gdGhlIHRhYmxlIGNvbnN0cnVjdG9yXCIpO1xuXHRcdFxuXHRcdHRoaXMuY29sdW1uTWFuYWdlci5zZXRDb2x1bW5zKGRlZmluaXRpb24pO1xuXHR9XG5cdFxuXHRnZXRDb2x1bW5zKHN0cnVjdHVyZWQpe1xuXHRcdHJldHVybiB0aGlzLmNvbHVtbk1hbmFnZXIuZ2V0Q29tcG9uZW50cyhzdHJ1Y3R1cmVkKTtcblx0fVxuXHRcblx0Z2V0Q29sdW1uKGZpZWxkKXtcblx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXHRcdFxuXHRcdGlmKGNvbHVtbil7XG5cdFx0XHRyZXR1cm4gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkZpbmQgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblx0XG5cdGdldENvbHVtbkRlZmluaXRpb25zKCl7XG5cdFx0cmV0dXJuIHRoaXMuY29sdW1uTWFuYWdlci5nZXREZWZpbml0aW9uVHJlZSgpO1xuXHR9XG5cdFxuXHRzaG93Q29sdW1uKGZpZWxkKXtcblx0XHR2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmZpbmRDb2x1bW4oZmllbGQpO1xuXHRcdFxuXHRcdHRoaXMuaW5pdEd1YXJkKCk7XG5cdFx0XG5cdFx0aWYoY29sdW1uKXtcblx0XHRcdGNvbHVtbi5zaG93KCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIFNob3cgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblx0XG5cdGhpZGVDb2x1bW4oZmllbGQpe1xuXHRcdHZhciBjb2x1bW4gPSB0aGlzLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmaWVsZCk7IFxuXHRcdFxuXHRcdHRoaXMuaW5pdEd1YXJkKCk7XG5cdFx0XG5cdFx0aWYoY29sdW1uKXtcblx0XHRcdGNvbHVtbi5oaWRlKCk7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIEhpZGUgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblx0XG5cdHRvZ2dsZUNvbHVtbihmaWVsZCl7XG5cdFx0dmFyIGNvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGZpZWxkKTtcblx0XHRcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdGlmKGNvbHVtbil7XG5cdFx0XHRpZihjb2x1bW4udmlzaWJsZSl7XG5cdFx0XHRcdGNvbHVtbi5oaWRlKCk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdGNvbHVtbi5zaG93KCk7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIFZpc2liaWxpdHkgVG9nZ2xlIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCBmaWVsZCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cdFxuXHRhZGRDb2x1bW4oZGVmaW5pdGlvbiwgYmVmb3JlLCBmaWVsZCl7XG5cdFx0dmFyIGNvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGZpZWxkKTtcblx0XHRcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdHJldHVybiB0aGlzLmNvbHVtbk1hbmFnZXIuYWRkQ29sdW1uKGRlZmluaXRpb24sIGJlZm9yZSwgY29sdW1uKVxuXHRcdFx0LnRoZW4oKGNvbHVtbikgPT4ge1xuXHRcdFx0XHRyZXR1cm4gY29sdW1uLmdldENvbXBvbmVudCgpO1xuXHRcdFx0fSk7XG5cdH1cblx0XG5cdGRlbGV0ZUNvbHVtbihmaWVsZCl7XG5cdFx0dmFyIGNvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGZpZWxkKTtcblx0XHRcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdGlmKGNvbHVtbil7XG5cdFx0XHRyZXR1cm4gY29sdW1uLmRlbGV0ZSgpO1xuXHRcdH1lbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihcIkNvbHVtbiBEZWxldGUgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblx0XHRcdHJldHVybiBQcm9taXNlLnJlamVjdCgpO1xuXHRcdH1cblx0fVxuXHRcblx0dXBkYXRlQ29sdW1uRGVmaW5pdGlvbihmaWVsZCwgZGVmaW5pdGlvbil7XG5cdFx0dmFyIGNvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGZpZWxkKTtcblx0XHRcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdGlmKGNvbHVtbil7XG5cdFx0XHRyZXR1cm4gY29sdW1uLnVwZGF0ZURlZmluaXRpb24oZGVmaW5pdGlvbik7XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiQ29sdW1uIFVwZGF0ZSBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZmllbGQpO1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG5cdFx0fVxuXHR9XG5cdFxuXHRtb3ZlQ29sdW1uKGZyb20sIHRvLCBhZnRlcil7XG5cdFx0dmFyIGZyb21Db2x1bW4gPSB0aGlzLmNvbHVtbk1hbmFnZXIuZmluZENvbHVtbihmcm9tKSxcblx0XHR0b0NvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKHRvKTtcblx0XHRcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXHRcdFxuXHRcdGlmKGZyb21Db2x1bW4pe1xuXHRcdFx0aWYodG9Db2x1bW4pe1xuXHRcdFx0XHR0aGlzLmNvbHVtbk1hbmFnZXIubW92ZUNvbHVtbihmcm9tQ29sdW1uLCB0b0NvbHVtbiwgYWZ0ZXIpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJNb3ZlIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kOlwiLCB0b0NvbHVtbik7XG5cdFx0XHR9XG5cdFx0fWVsc2Uge1xuXHRcdFx0Y29uc29sZS53YXJuKFwiTW92ZSBFcnJvciAtIE5vIG1hdGNoaW5nIGNvbHVtbiBmb3VuZDpcIiwgZnJvbSk7XG5cdFx0fVxuXHR9XG5cdFxuXHQvL3Njcm9sbCB0byBjb2x1bW4gaW4gRE9NXG5cdHNjcm9sbFRvQ29sdW1uKGZpZWxkLCBwb3NpdGlvbiwgaWZWaXNpYmxlKXtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0dmFyIGNvbHVtbiA9IHRoaXMuY29sdW1uTWFuYWdlci5maW5kQ29sdW1uKGZpZWxkKTtcblx0XHRcdFxuXHRcdFx0aWYoY29sdW1uKXtcblx0XHRcdFx0cmV0dXJuIHRoaXMuY29sdW1uTWFuYWdlci5zY3JvbGxUb0NvbHVtbihjb2x1bW4sIHBvc2l0aW9uLCBpZlZpc2libGUpO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLndhcm4oXCJTY3JvbGwgRXJyb3IgLSBObyBtYXRjaGluZyBjb2x1bW4gZm91bmQ6XCIsIGZpZWxkKTtcblx0XHRcdFx0cmV0dXJuIFByb21pc2UucmVqZWN0KFwiU2Nyb2xsIEVycm9yIC0gTm8gbWF0Y2hpbmcgY29sdW1uIGZvdW5kXCIpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cdFxuXHQvLy8vLy8vLy8vLy8gR2VuZXJhbCBQdWJsaWMgRnVuY3Rpb25zIC8vLy8vLy8vLy8vL1xuXHQvL3JlZHJhdyBsaXN0IHdpdGhvdXQgdXBkYXRpbmcgZGF0YVxuXHRyZWRyYXcoZm9yY2Upe1xuXHRcdHRoaXMuaW5pdEd1YXJkKCk7XG5cblx0XHR0aGlzLmNvbHVtbk1hbmFnZXIucmVkcmF3KGZvcmNlKTtcblx0XHR0aGlzLnJvd01hbmFnZXIucmVkcmF3KGZvcmNlKTtcblx0fVxuXHRcblx0c2V0SGVpZ2h0KGhlaWdodCl7XG5cdFx0dGhpcy5vcHRpb25zLmhlaWdodCA9IGlzTmFOKGhlaWdodCkgPyBoZWlnaHQgOiBoZWlnaHQgKyBcInB4XCI7XG5cdFx0dGhpcy5lbGVtZW50LnN0eWxlLmhlaWdodCA9IHRoaXMub3B0aW9ucy5oZWlnaHQ7XG5cdFx0dGhpcy5yb3dNYW5hZ2VyLmluaXRpYWxpemVSZW5kZXJlcigpO1xuXHRcdHRoaXMucm93TWFuYWdlci5yZWRyYXcodHJ1ZSk7XG5cdH1cblx0XG5cdC8vLy8vLy8vLy8vLy8vLy8vLy8vIEV2ZW50IEJ1cyAvLy8vLy8vLy8vLy8vLy8vLy8vXG5cdFxuXHRvbihrZXksIGNhbGxiYWNrKXtcblx0XHR0aGlzLmV4dGVybmFsRXZlbnRzLnN1YnNjcmliZShrZXksIGNhbGxiYWNrKTtcblx0fVxuXHRcblx0b2ZmKGtleSwgY2FsbGJhY2spe1xuXHRcdHRoaXMuZXh0ZXJuYWxFdmVudHMudW5zdWJzY3JpYmUoa2V5LCBjYWxsYmFjayk7XG5cdH1cblx0XG5cdGRpc3BhdGNoRXZlbnQoKXtcblx0XHR2YXIgYXJncyA9IEFycmF5LmZyb20oYXJndW1lbnRzKTtcblx0XHRhcmdzLnNoaWZ0KCk7XG5cdFx0XG5cdFx0dGhpcy5leHRlcm5hbEV2ZW50cy5kaXNwYXRjaCguLi5hcmd1bWVudHMpO1xuXHR9XG5cblx0Ly8vLy8vLy8vLy8vLy8vLy8vLy8gQWxlcnRzIC8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXHRhbGVydChjb250ZW50cywgdHlwZSl7XG5cdFx0dGhpcy5pbml0R3VhcmQoKTtcblxuXHRcdHRoaXMuYWxlcnRNYW5hZ2VyLmFsZXJ0KGNvbnRlbnRzLCB0eXBlKTtcblx0fVxuXG5cdGNsZWFyQWxlcnQoKXtcblx0XHR0aGlzLmluaXRHdWFyZCgpO1xuXG5cdFx0dGhpcy5hbGVydE1hbmFnZXIuY2xlYXIoKTtcblx0fVxuXHRcblx0Ly8vLy8vLy8vLy8vLy8gRXh0ZW5zaW9uIE1hbmFnZW1lbnQgLy8vLy8vLy8vLy8vLy9cblx0bW9kRXhpc3RzKHBsdWdpbiwgcmVxdWlyZWQpe1xuXHRcdGlmKHRoaXMubW9kdWxlc1twbHVnaW5dKXtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1lbHNlIHtcblx0XHRcdGlmKHJlcXVpcmVkKXtcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIlRhYnVsYXRvciBNb2R1bGUgTm90IEluc3RhbGxlZDogXCIgKyBwbHVnaW4pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fVxuXHRcblx0bW9kdWxlKGtleSl7XG5cdFx0dmFyIG1vZCA9IHRoaXMubW9kdWxlc1trZXldO1xuXHRcdFxuXHRcdGlmKCFtb2Qpe1xuXHRcdFx0Y29uc29sZS5lcnJvcihcIlRhYnVsYXRvciBtb2R1bGUgbm90IGluc3RhbGxlZDogXCIgKyBrZXkpO1xuXHRcdH1cblx0XHRcblx0XHRyZXR1cm4gbW9kO1xuXHR9XG59XG5cbnZhciBUYWJ1bGF0b3IkMSA9IFRhYnVsYXRvcjtcblxuLy90YWJ1bGF0b3Igd2l0aCBhbGwgbW9kdWxlcyBpbnN0YWxsZWRcblxuY2xhc3MgVGFidWxhdG9yRnVsbCBleHRlbmRzIFRhYnVsYXRvciQxIHtcblx0c3RhdGljIGV4dGVuZE1vZHVsZSgpe1xuXHRcdFRhYnVsYXRvciQxLmluaXRpYWxpemVNb2R1bGVCaW5kZXIoYWxsTW9kdWxlcyk7XG5cdFx0VGFidWxhdG9yJDEuX2V4dGVuZE1vZHVsZSguLi5hcmd1bWVudHMpO1xuXHR9XG5cblx0c3RhdGljIHJlZ2lzdGVyTW9kdWxlKCl7XG5cdFx0VGFidWxhdG9yJDEuaW5pdGlhbGl6ZU1vZHVsZUJpbmRlcihhbGxNb2R1bGVzKTtcblx0XHRUYWJ1bGF0b3IkMS5fcmVnaXN0ZXJNb2R1bGUoLi4uYXJndW1lbnRzKTtcblx0fVxuXG5cdGNvbnN0cnVjdG9yKGVsZW1lbnQsIG9wdGlvbnMsIG1vZHVsZXMpe1xuXHRcdHN1cGVyKGVsZW1lbnQsIG9wdGlvbnMsIGFsbE1vZHVsZXMpO1xuXHR9XG59XG5cbnZhciBUYWJ1bGF0b3JGdWxsJDEgPSBUYWJ1bGF0b3JGdWxsO1xuXG5jbGFzcyBQc2V1ZG9Sb3cge1xuXG5cdGNvbnN0cnVjdG9yICh0eXBlKXtcblx0XHR0aGlzLnR5cGUgPSB0eXBlO1xuXHRcdHRoaXMuZWxlbWVudCA9IHRoaXMuX2NyZWF0ZUVsZW1lbnQoKTtcblx0fVxuXG5cdF9jcmVhdGVFbGVtZW50KCl7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblx0XHRlbC5jbGFzc0xpc3QuYWRkKFwidGFidWxhdG9yLXJvd1wiKTtcblx0XHRyZXR1cm4gZWw7XG5cdH1cblxuXHRnZXRFbGVtZW50KCl7XG5cdFx0cmV0dXJuIHRoaXMuZWxlbWVudDtcblx0fVxuXG5cdGdldENvbXBvbmVudCgpe1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdGdldERhdGEoKXtcblx0XHRyZXR1cm4ge307XG5cdH1cblxuXHRnZXRIZWlnaHQoKXtcblx0XHRyZXR1cm4gdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0O1xuXHR9XG5cblx0aW5pdGlhbGl6ZSgpe31cblxuXHRyZWluaXRpYWxpemUoKXt9XG5cblx0bm9ybWFsaXplSGVpZ2h0KCl7fVxuXG5cdGdlbmVyYXRlQ2VsbHMoKXt9XG5cblx0cmVpbml0aWFsaXplSGVpZ2h0KCl7fVxuXG5cdGNhbGNIZWlnaHQoKXt9XG5cblx0c2V0Q2VsbEhlaWdodCgpe31cblxuXHRjbGVhckNlbGxIZWlnaHQoKXt9XG5cblx0cmVuZGVyZWQoKXt9XG59XG5cbmV4cG9ydCB7IEFjY2Vzc29yIGFzIEFjY2Vzc29yTW9kdWxlLCBBamF4IGFzIEFqYXhNb2R1bGUsIENhbGNDb21wb25lbnQsIENlbGxDb21wb25lbnQsIENsaXBib2FyZCBhcyBDbGlwYm9hcmRNb2R1bGUsIENvbHVtbkNhbGNzIGFzIENvbHVtbkNhbGNzTW9kdWxlLCBDb2x1bW5Db21wb25lbnQsIERhdGFUcmVlIGFzIERhdGFUcmVlTW9kdWxlLCBEb3dubG9hZCBhcyBEb3dubG9hZE1vZHVsZSwgRWRpdCBhcyBFZGl0TW9kdWxlLCBFeHBvcnQgYXMgRXhwb3J0TW9kdWxlLCBGaWx0ZXIgYXMgRmlsdGVyTW9kdWxlLCBGb3JtYXQgYXMgRm9ybWF0TW9kdWxlLCBGcm96ZW5Db2x1bW5zIGFzIEZyb3plbkNvbHVtbnNNb2R1bGUsIEZyb3plblJvd3MgYXMgRnJvemVuUm93c01vZHVsZSwgR3JvdXBDb21wb25lbnQsIEdyb3VwUm93cyBhcyBHcm91cFJvd3NNb2R1bGUsIEhpc3RvcnkgYXMgSGlzdG9yeU1vZHVsZSwgSHRtbFRhYmxlSW1wb3J0IGFzIEh0bWxUYWJsZUltcG9ydE1vZHVsZSwgSW1wb3J0IGFzIEltcG9ydE1vZHVsZSwgSW50ZXJhY3Rpb24gYXMgSW50ZXJhY3Rpb25Nb2R1bGUsIEtleWJpbmRpbmdzIGFzIEtleWJpbmRpbmdzTW9kdWxlLCBNZW51IGFzIE1lbnVNb2R1bGUsIE1vZHVsZSwgTW92ZUNvbHVtbnMgYXMgTW92ZUNvbHVtbnNNb2R1bGUsIE1vdmVSb3dzIGFzIE1vdmVSb3dzTW9kdWxlLCBNdXRhdG9yIGFzIE11dGF0b3JNb2R1bGUsIFBhZ2UgYXMgUGFnZU1vZHVsZSwgUGVyc2lzdGVuY2UgYXMgUGVyc2lzdGVuY2VNb2R1bGUsIFBvcHVwIGFzIFBvcHVwTW9kdWxlLCBQcmludCBhcyBQcmludE1vZHVsZSwgUHNldWRvUm93LCBSYW5nZUNvbXBvbmVudCwgUmVhY3RpdmVEYXRhIGFzIFJlYWN0aXZlRGF0YU1vZHVsZSwgUmVuZGVyZXIsIFJlc2l6ZUNvbHVtbnMgYXMgUmVzaXplQ29sdW1uc01vZHVsZSwgUmVzaXplUm93cyBhcyBSZXNpemVSb3dzTW9kdWxlLCBSZXNpemVUYWJsZSBhcyBSZXNpemVUYWJsZU1vZHVsZSwgUmVzcG9uc2l2ZUxheW91dCBhcyBSZXNwb25zaXZlTGF5b3V0TW9kdWxlLCBSb3dDb21wb25lbnQsIFNlbGVjdFJhbmdlIGFzIFNlbGVjdFJhbmdlTW9kdWxlLCBTZWxlY3RSb3cgYXMgU2VsZWN0Um93TW9kdWxlLCBTaGVldENvbXBvbmVudCwgU29ydCBhcyBTb3J0TW9kdWxlLCBTcHJlYWRzaGVldCBhcyBTcHJlYWRzaGVldE1vZHVsZSwgVGFidWxhdG9yJDEgYXMgVGFidWxhdG9yLCBUYWJ1bGF0b3JGdWxsJDEgYXMgVGFidWxhdG9yRnVsbCwgVG9vbHRpcCBhcyBUb29sdGlwTW9kdWxlLCBWYWxpZGF0ZSBhcyBWYWxpZGF0ZU1vZHVsZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGFidWxhdG9yX2VzbS5tanMubWFwXG4iLCJpbXBvcnQgY2xpZW50IGZyb20gJ2d3MmFwaS1jbGllbnQnO1xyXG5pbXBvcnQgY2FjaGVNZW1vcnkgZnJvbSAnZ3cyYXBpLWNsaWVudC9zcmMvY2FjaGUvbWVtb3J5LmpzJztcclxuaW1wb3J0IGNhY2hlQnJvd3NlclN0b3JhZ2UgZnJvbSAnZ3cyYXBpLWNsaWVudC9zcmMvY2FjaGUvYnJvd3Nlci5qcyc7XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVDbGllbnQoa2V5KSB7XHJcbiAgICBjb25zdCBjID0gY2xpZW50KCk7XHJcbiAgICBjLnNjaGVtYShcIjIwMjQtMDctMjBUMDE6MDA6MDAuMDAwWlwiKTtcclxuICAgIGMubGFuZ3VhZ2UoXCJlblwiKTtcclxuICAgIGlmKGtleSkgYy5hdXRoZW50aWNhdGUoa2V5KTtcclxuICAgIGMuY2FjaGVTdG9yYWdlKFtcclxuICAgICAgICBjYWNoZU1lbW9yeSh7IGdjVGljazogNSAqIDYwICogMTAwMCB9KSxcclxuICAgICAgICBjYWNoZUJyb3dzZXJTdG9yYWdlKHtcclxuICAgICAgICAgICAgc3RvcmFnZUtleTogYGd3MmFwaS1jYWNoZV8ke2tleX1gLFxyXG4gICAgICAgICAgICBnY1RpY2s6IDMgKiA2MCAqIDEwMDBcclxuICAgICAgICB9KVxyXG4gICAgXSk7XHJcbiAgICByZXR1cm4gYztcclxufVxyXG5cclxuY2xhc3MgUGxheWVyIHtcclxuICAgIGFwaTtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGVtb2ppLCBpY29uVXJsLCBrZXkpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuZW1vamkgPSBlbW9qaTtcclxuICAgICAgICB0aGlzLmljb25VcmwgPSBpY29uVXJsO1xyXG4gICAgICAgIHRoaXMua2V5ID0ga2V5O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKCFuYW1lKSB0aHJvdyBcIlBsZWFzZSBuYW1lIHRoZSBwbGF5ZXJzXCI7XHJcbiAgICAgICAgaWYoIWVtb2ppKSB0aHJvdyBgJHtuYW1lfSBuZWVkcyBlbW9qaWA7XHJcbiAgICAgICAgaWYoIWtleSkgdGhyb3cgYCR7bmFtZX0gbmVlZHMga2V5YDtcclxuXHJcbiAgICAgICAgdGhpcy5hcGkgPSBjcmVhdGVDbGllbnQoa2V5KTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0QXBpSG9sZGVyKCkge1xyXG4gICAgaWYoIXdpbmRvdy5hcGlIb2xkZXIpIHtcclxuICAgICAgICBjb25zdCBwbGF5ZXJzID0gcmVhZFBsYXllcnMoKTtcclxuICAgICAgICB3aW5kb3cuYXBpSG9sZGVyID0ge1xyXG4gICAgICAgICAgICBwbGF5ZXJzOiBwbGF5ZXJzLFxyXG4gICAgICAgICAgICBhcGk6IGNyZWF0ZUNsaWVudChudWxsKVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gd2luZG93LmFwaUhvbGRlcjtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVhZFBsYXllcnMoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcInRvZG8gcmVhZHBsYXllcnNcIik7XHJcbiAgICB2YXIgcGxheWVycyA9IFtdO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBsZXQgc3RvcmVkVmFsdWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImd3Mi1uby1udWFuY2UtcGxheWVyc1wiKTtcclxuICAgICAgICBpZihzdG9yZWRWYWx1ZSlcclxuICAgICAgICAgICAgZm9yKHZhciBwIG9mIEpTT04ucGFyc2Uoc3RvcmVkVmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJzLnB1c2gobmV3IFBsYXllcihwLm5hbWUsIHAuZW1vamksIHAuaWNvblVybCwgcC5rZXkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgfSBjYXRjaChlKSB7XHJcbiAgICAgICAgYWxlcnQoZSk7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyhwbGF5ZXJzKTtcclxuICAgIHJldHVybiBwbGF5ZXJzO1xyXG59XHJcblxyXG5mdW5jdGlvbiB3cml0ZVBsYXllcnMocGxheWVycykge1xyXG4gICAgY29uc29sZS5sb2coXCJzYXZlcGxheWVycyB0b2RvXCIpO1xyXG4gICAgY29uc29sZS5sb2cocGxheWVycyk7XHJcbiAgICBsZXQgc3RvcmVkVmFsdWUgPSBKU09OLnN0cmluZ2lmeShwbGF5ZXJzLCAoa2V5LHZhbHVlKSA9PiB7IGlmIChrZXk9PVwiYXBpXCIpIHJldHVybiB1bmRlZmluZWQ7IGVsc2UgcmV0dXJuIHZhbHVlOyB9KTtcclxuICAgIC8vIGNvbnNvbGUubG9nKHN0b3JlZFZhbHVlKTtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiZ3cyLW5vLW51YW5jZS1wbGF5ZXJzXCIsIHN0b3JlZFZhbHVlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gYXBpSG9sZGVyU2V0dXBIdG1sKGVsZW1lbnRJZCkge1xyXG4gICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XHJcbiAgICBlbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XHJcblxyXG4gICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGFibGVcIik7XHJcbiAgICBlbGVtZW50LmFwcGVuZENoaWxkKHRhYmxlKTtcclxuXHJcbiAgICAvL2NvbnN0IHRoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhlYWRlclwiKTtcclxuICAgIGNvbnN0IHRoZWFkZXJSb3cgPSAgdGFibGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpKTtcclxuICAgIHRoZWFkZXJSb3cuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRoXCIpKS5pbm5lclRleHQgPSBcIlBsYXllciBuYW1lXCI7XHJcbiAgICB0aGVhZGVyUm93LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0aFwiKSkuaW5uZXJUZXh0ID0gXCJFbW9qaVwiO1xyXG4gICAgdGhlYWRlclJvdy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhcIikpLmlubmVyVGV4dCA9IFwiSWNvbiBVUkxcIjtcclxuICAgIHRoZWFkZXJSb3cuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRoXCIpKS5pbm5lclRleHQgPSBcIkFQSSBLZXlcIjtcclxuICAgIHRoZWFkZXJSb3cuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRoXCIpKS5pbm5lclRleHQgPSBcIlwiO1xyXG4gICAgLy90YWJsZS5hcHBlbmRDaGlsZCh0aGVhZGVyKTtcclxuXHJcbiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0Ym9keVwiKTtcclxuICAgIHRhYmxlLmFwcGVuZENoaWxkKHRib2R5KTtcclxuXHJcbiAgICBjb25zdCBidXR0b25BZGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgYnV0dG9uQWRkLmlubmVyVGV4dCA9IFwiQWRkIHJvd1wiO1xyXG4gICAgY29uc3QgYnV0dG9uU2F2ZT0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgIGJ1dHRvblNhdmUuaW5uZXJUZXh0ID0gXCJTYXZlXCI7XHJcblxyXG4gICAgZWxlbWVudC5hcHBlbmRDaGlsZChidXR0b25BZGQpO1xyXG4gICAgZWxlbWVudC5hcHBlbmRDaGlsZChidXR0b25TYXZlKTtcclxuXHJcbiAgICBjb25zdCBhZGRSb3cgPSBmdW5jdGlvbihwbGF5ZXIpIHtcclxuICAgICAgICBjb25zdCByb3cgPSB0YWJsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIikpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ3JlYXRpbmcgcm93IGZvciBwbGF5ZXI6XCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHBsYXllcik7XHJcbiAgICAgICAgcm93LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKSkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpKS52YWx1ZSA9IHBsYXllcj8ubmFtZSAgICA/PyBcIlwiO1xyXG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIikpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKSkudmFsdWUgPSBwbGF5ZXI/LmVtb2ppICAgPz8gXCJcIjtcclxuICAgICAgICByb3cuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpKS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIikpLnZhbHVlID0gcGxheWVyPy5pY29uVXJsID8/IFwiXCI7XHJcbiAgICAgICAgcm93LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKSkuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpKS52YWx1ZSA9IHBsYXllcj8ua2V5ICAgICA/PyBcIlwiO1xyXG4gICAgICAgIGNvbnN0IGRlbCA9IHJvdy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIikpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIikpO1xyXG4gICAgICAgIGRlbC5pbm5lclRleHQgPSBcIuKdjFwiXHJcbiAgICAgICAgZGVsLm9uY2xpY2sgPSAoKSA9PiB7IHJvdy5yZW1vdmUoKTsgfTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IodmFyIHBsYXllciBvZiByZWFkUGxheWVycygpKSB7XHJcbiAgICAgICAgYWRkUm93KHBsYXllcik7XHJcbiAgICB9XHJcblxyXG4gICAgYnV0dG9uQWRkLm9uY2xpY2sgPSAoKSA9PiB7IGFkZFJvdyhudWxsKTsgfTtcclxuICAgIGJ1dHRvblNhdmUub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBwbGF5ZXJzID0gW107XHJcbiAgICAgICAgZm9yKHZhciBpIGluIHRhYmxlLnJvd3MpIHtcclxuICAgICAgICAgICAgaWYoaT09MCkgY29udGludWU7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyID0gdGFibGUucm93c1tpXTtcclxuICAgICAgICAgICAgaWYodHIubG9jYWxOYW1lIT1cInRyXCIpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICBjb25zdCBpMCA9IHRyLmNlbGxzWzBdLmNoaWxkcmVuWzBdLnZhbHVlXHJcbiAgICAgICAgICAgIGNvbnN0IGkxID0gdHIuY2VsbHNbMV0uY2hpbGRyZW5bMF0udmFsdWVcclxuICAgICAgICAgICAgY29uc3QgaTIgPSB0ci5jZWxsc1syXS5jaGlsZHJlblswXS52YWx1ZVxyXG4gICAgICAgICAgICBjb25zdCBpMyA9IHRyLmNlbGxzWzNdLmNoaWxkcmVuWzBdLnZhbHVlXHJcbiAgICAgICAgICAgIHBsYXllcnMucHVzaChuZXcgUGxheWVyKGkwLGkxLGkyLGkzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHdyaXRlUGxheWVycyhwbGF5ZXJzKTtcclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICAgIGdldEFwaUhvbGRlcjogZ2V0QXBpSG9sZGVyLFxyXG4gICAgYXBpSG9sZGVyU2V0dXBIdG1sOiBhcGlIb2xkZXJTZXR1cEh0bWwsXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBwcmludE1lKCkge1xyXG4gIGNvbnNvbGUubG9nKCdJIGdldCBjYWxsZWQgZnJvbSBwcmludC5qcyEnKTtcclxufVxyXG4iLCIvLyBodHRwczovL2RhdGF0YWJsZXMubmV0L21hbnVhbC9pbnN0YWxsYXRpb25cclxuXHJcbmltcG9ydCB7VGFidWxhdG9yLCBIdG1sVGFibGVJbXBvcnRNb2R1bGUsIEZpbHRlck1vZHVsZSwgRWRpdE1vZHVsZSwgRm9ybWF0TW9kdWxlLCBDb2x1bW5DYWxjc01vZHVsZSwgTXV0YXRvck1vZHVsZSwgR3JvdXBSb3dzTW9kdWxlfSBmcm9tICd0YWJ1bGF0b3ItdGFibGVzJztcclxuaW1wb3J0IGFwaUhvbGRlciBmcm9tICcuL2FwaS1ob2xkZXIuanMnO1xyXG5cclxuVGFidWxhdG9yLnJlZ2lzdGVyTW9kdWxlKFtIdG1sVGFibGVJbXBvcnRNb2R1bGUsIEZpbHRlck1vZHVsZSwgRWRpdE1vZHVsZSwgRm9ybWF0TW9kdWxlLCBDb2x1bW5DYWxjc01vZHVsZSwgTXV0YXRvck1vZHVsZSwgR3JvdXBSb3dzTW9kdWxlXSk7XHJcblxyXG4vKipcclxuICogXHJcbiAqIEBwYXJhbSB0YWJsZUVsZW1lbnQgXHJcbiAqIEBwYXJhbSBjb2x1bW5zIFNlZSBodHRwczovL3RhYnVsYXRvci5pbmZvL2RvY3MvNi4zL2NvbHVtbnMsIFRMO0RSOiBhcnJheSBvZiBvYmplY3RzLCBlYWNoIHNob3VsZCBoYXZlIFwidGl0bGVcIiArIFwiZmllbGRcIlxyXG4gKiBAcGFyYW0gdGFibGVEYXRhIGFycmF5IG9mIG9iamVjdHNcclxuICogQHJldHVybnMgXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVUYWJsZUZyb21EYXRhKFxyXG4gICAgdGFibGVFbGVtZW50LFxyXG4gICAgY29sdW1ucyxcclxuICAgIHRhYmxlRGF0YSxcclxuKSB7XHJcbiAgICBsZXQgdGFibGUgPSBuZXcgVGFidWxhdG9yKHRhYmxlRWxlbWVudCwge1xyXG4gICAgICAgIGxheW91dDogXCJmaXREYXRhRmlsbFwiLFxyXG4gICAgICAgIGNvbHVtbnM6IGNvbHVtbnMsXHJcbiAgICAgICAgZGF0YTogdGFibGVEYXRhXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdGFibGU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBcclxuICogQ3JlYXRlcyBhIHRhYmxlIGZyb20gYW4gSFRNTCB0YWJsZSBlbGVtZW50LCBhbmQgYWRkcyBhIGNvbHVtbiBmb3IgZWFjaCBwbGF5ZXIuXHJcbiAqIFRoZSBlbGVtZW50IE1VU1QgaGF2ZSBhbiBpZCBjb2x1bW4uXHJcbiAqIFxyXG4gKiBAcGFyYW0geyp9IHRhYmxlRWxlbWVudCBcclxuICogQHJldHVybnMgXHJcbiAqL1xyXG5mdW5jdGlvbiBjcmVhdGVUYWJsZVdpdGhQbGF5ZXJDb2x1bW5zKFxyXG4gICAgdGFibGVFbGVtZW50LFxyXG5cclxuKSB7XHJcbiAgICBsZXQgdGFibGUgPSBuZXcgVGFidWxhdG9yKHRhYmxlRWxlbWVudCwge1xyXG4gICAgICAgIGxheW91dDogXCJmaXREYXRhRmlsbFwiLFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGFibGUub24oXCJ0YWJsZUJ1aWx0XCIsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgLy8gdG9kbyBoaWRlIGlkIGNvbHVtblxyXG4gICAgICAgIGZvcihsZXQgcGxheWVyIG9mIGFwaUhvbGRlci5nZXRBcGlIb2xkZXIoKS5wbGF5ZXJzKSB7XHJcbiAgICAgICAgICAgIHRhYmxlLmFkZENvbHVtbih7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogcGxheWVyLmVtb2ppLFxyXG4gICAgICAgICAgICAgICAgZmllbGQ6IHBsYXllci5uYW1lLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVySG96QWxpZ246IFwiY2VudGVyXCIsXHJcbiAgICAgICAgICAgICAgICBob3pBbGlnbjogXCJjZW50ZXJcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlckZpbHRlcjpcImlucHV0XCIsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBwbGF5ZXIuYXBpLmFjY291bnQoKS5hY2hpZXZlbWVudHMoKS5nZXQoKS50aGVuKChhY2NvdW50QWNoaWV2ZW1lbnRzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgYWEgPSBhY2NvdW50QWNoaWV2ZW1lbnRzLnJlZHVjZSgobWFwLG9iaik9PnsgbWFwW29iai5pZF0gPSBvYmo7IHJldHVybiBtYXA7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvcihsZXQgciBvZiB0YWJsZS5nZXREYXRhKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgYSA9IGFhW3IuaWRdO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0eHQgPSBcIi1cIjtcclxuICAgICAgICAgICAgICAgICAgICBpZihhPy5kb25lKSB0eHQgPSBcIuKchVwiXHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGE/Lm1heCkgdHh0ID0gYCR7YT8uY3VycmVudD8/MH0vJHthPy5tYXh9YDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRbcGxheWVyLm5hbWVdID0gdHh0O1xyXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLnVwZGF0ZVJvdyhyLmlkLCBkKVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHRhYmxlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVEYXRhVGFibGUodGFibGVFbGVtZW50KSB7XHJcbiAgICBsZXQgdGFibGUgPSBuZXcgVGFidWxhdG9yKHRhYmxlRWxlbWVudCwge1xyXG4gICAgICAgIGxheW91dDogXCJmaXREYXRhRmlsbFwiLFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGFibGUub24oXCJ0YWJsZUJ1aWx0XCIsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgZm9yKGxldCBwbGF5ZXIgb2YgYXBpSG9sZGVyLmdldEFwaUhvbGRlcigpLnBsYXllcnMpIHtcclxuICAgICAgICAgICAgdGFibGUuYWRkQ29sdW1uKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBwbGF5ZXIuZW1vamksXHJcbiAgICAgICAgICAgICAgICBmaWVsZDogcGxheWVyLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJIb3pBbGlnbjogXCJjZW50ZXJcIixcclxuICAgICAgICAgICAgICAgIGhvekFsaWduOiBcImNlbnRlclwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyRmlsdGVyOlwiaW5wdXRcIixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHBsYXllci5hcGkuYWNjb3VudCgpLmFjaGlldmVtZW50cygpLmdldCgpLnRoZW4oKGFjY291bnRBY2hpZXZlbWVudHMpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBhYSA9IGFjY291bnRBY2hpZXZlbWVudHMucmVkdWNlKChtYXAsb2JqKT0+eyBtYXBbb2JqLmlkXSA9IG9iajsgcmV0dXJuIG1hcDsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yKGxldCByIG9mIHRhYmxlLmdldERhdGEoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBhID0gYWFbci5pZF07XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGQgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR4dCA9IFwiLVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGE/LmRvbmUpIHR4dCA9IFwi4pyFXCJcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYT8ubWF4KSB0eHQgPSBgJHthPy5jdXJyZW50Pz8wfS8ke2E/Lm1heH1gO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZFtwbGF5ZXIubmFtZV0gPSB0eHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFibGUudXBkYXRlUm93KHIuaWQsIGQpXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdGFibGU7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICAgIHRhYnVsYXRvcjogVGFidWxhdG9yLFxyXG4gICAgY3JlYXRlRGF0YVRhYmxlOiBjcmVhdGVEYXRhVGFibGUsXHJcbiAgICBjcmVhdGVUYWJsZUZyb21EYXRhOiBjcmVhdGVUYWJsZUZyb21EYXRhLFxyXG59XHJcbiIsIlxuY2xhc3MgQ29pbnMge1xuICAgIGc7XG4gICAgcztcbiAgICBjO1xuICAgIC8vIHVzZSBuIGluIGNhbGN1bGF0aW9uc1xuICAgIG47XG4gICAgLy8gbiwgYnV0IGFic29sdXRlXG4gICAgbkFic29sdXRlO1xuICAgIHNpZ247XG4gICAgY29uc3RydWN0b3Iobikge1xuICAgICAgICB0aGlzLm4gICAgICAgICA9IE1hdGgudHJ1bmMobik7XG4gICAgICAgIHRoaXMubkFic29sdXRlID0gTWF0aC5hYnModGhpcy5uKTtcbiAgICAgICAgdGhpcy5zaWduICAgICAgPSBNYXRoLnNpZ24odGhpcy5uKTtcbiAgICAgICAgdGhpcy5nID0gTWF0aC5mbG9vcih0aGlzLm5BYnNvbHV0ZSAvIDEwMDAwKTtcbiAgICAgICAgdGhpcy5zID0gTWF0aC5mbG9vcih0aGlzLm5BYnNvbHV0ZSAvIDEwMCkgJSAxMDA7XG4gICAgICAgIHRoaXMuYyA9IHRoaXMubkFic29sdXRlICUgMTAwO1xuXG4gICAgICAgIGxldCBwYWQgPSAoaSkgPT4gaS50b1N0cmluZygpLnBhZFN0YXJ0KDIsXCIwXCIpO1xuICAgICAgICBsZXQgc2duID0gXCJcIjsgaWYodGhpcy5zaWduIDwgMCkgc2duID0gXCItXCI7XG5cbiAgICAgICAgaWYgICAgICh0aGlzLmcgPiAwKSB0aGlzLnR4dCA9IGAke3Nnbn0ke3RoaXMuZ33wn5+hICR7cGFkKHRoaXMucyl94pqqICR7cGFkKHRoaXMuYyl98J+foGA7XG4gICAgICAgIGVsc2UgaWYodGhpcy5zID4gMCkgdGhpcy50eHQgPSBgJHtzZ259JHt0aGlzLnN94pqqICR7cGFkKHRoaXMuYyl98J+foGA7XG4gICAgICAgIGVsc2UgICAgICAgICAgICAgICAgdGhpcy50eHQgPSBgJHtzZ259JHt0aGlzLmN98J+foGA7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVTcGlubmVyKCkge1xuICAgIGxldCBpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlcIik7XG4gICAgaS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImZhcyBmYS1zcGlubmVyIGZhLXB1bHNlXCIpO1xuICAgIHJldHVybiBpO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gICAgaW50MmNvaW5zOiAobik9Pm5ldyBDb2lucyhuKSxcbiAgICBjcmVhdGVTcGlubmVyOiBjcmVhdGVTcGlubmVyLFxufVxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsImltcG9ydCBwcmludE1lIGZyb20gJy4vcHJpbnQuanMnO1xyXG5cclxuaW1wb3J0ICcuL2FwaS1ob2xkZXIuanMnO1xyXG5pbXBvcnQgYXBpSG9sZGVyIGZyb20gJy4vYXBpLWhvbGRlci5qcyc7XHJcbmltcG9ydCB0YWJsZXMgZnJvbSAnLi90YWJsZXMuanMnO1xyXG5pbXBvcnQgdXRpbCBmcm9tICcuL3V0aWwuanMnO1xyXG5cclxuY29uc29sZS5sb2coXCJIRUxMTyFcIik7XHJcblxyXG5mdW5jdGlvbiBoZWxsbygpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiSGVsbG8gZnJvbSBmdW5jdGlvbiFcIik7XHJcbn1cclxuXHJcbndpbmRvdy5ndzIgPSB7XHJcbiAgICBhcGlIb2xkZXI6IGFwaUhvbGRlcixcclxuICAgIHRhYmxlczogdGFibGVzLFxyXG4gICAgdXRpbDogdXRpbCxcclxufVxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=